(function(){const te=document.createElement("link").relList;if(te&&te.supports&&te.supports("modulepreload"))return;for(const ae of document.querySelectorAll('link[rel="modulepreload"]'))_(ae);new MutationObserver(ae=>{for(const ve of ae)if(ve.type==="childList")for(const we of ve.addedNodes)we.tagName==="LINK"&&we.rel==="modulepreload"&&_(we)}).observe(document,{childList:!0,subtree:!0});function oe(ae){const ve={};return ae.integrity&&(ve.integrity=ae.integrity),ae.referrerPolicy&&(ve.referrerPolicy=ae.referrerPolicy),ae.crossOrigin==="use-credentials"?ve.credentials="include":ae.crossOrigin==="anonymous"?ve.credentials="omit":ve.credentials="same-origin",ve}function _(ae){if(ae.ep)return;ae.ep=!0;const ve=oe(ae);fetch(ae.href,ve)}})();function getDefaultExportFromCjs(Te){return Te&&Te.__esModule&&Object.prototype.hasOwnProperty.call(Te,"default")?Te.default:Te}var jsxRuntimeExports={},jsxRuntime={get exports(){return jsxRuntimeExports},set exports(Te){jsxRuntimeExports=Te}},reactJsxRuntime_production_min={},reactExports={},react={get exports(){return reactExports},set exports(Te){reactExports=Te}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$1=Symbol.for("react.element"),n$1=Symbol.for("react.portal"),p$1=Symbol.for("react.fragment"),q$1=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),t=Symbol.for("react.provider"),u=Symbol.for("react.context"),v=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),z=Symbol.iterator;function A(Te){return Te===null||typeof Te!="object"?null:(Te=z&&Te[z]||Te["@@iterator"],typeof Te=="function"?Te:null)}var B={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C=Object.assign,D={};function E(Te,te,oe){this.props=Te,this.context=te,this.refs=D,this.updater=oe||B}E.prototype.isReactComponent={};E.prototype.setState=function(Te,te){if(typeof Te!="object"&&typeof Te!="function"&&Te!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Te,te,"setState")};E.prototype.forceUpdate=function(Te){this.updater.enqueueForceUpdate(this,Te,"forceUpdate")};function F(){}F.prototype=E.prototype;function G(Te,te,oe){this.props=Te,this.context=te,this.refs=D,this.updater=oe||B}var H=G.prototype=new F;H.constructor=G;C(H,E.prototype);H.isPureReactComponent=!0;var I=Array.isArray,J=Object.prototype.hasOwnProperty,K={current:null},L={key:!0,ref:!0,__self:!0,__source:!0};function M(Te,te,oe){var _,ae={},ve=null,we=null;if(te!=null)for(_ in te.ref!==void 0&&(we=te.ref),te.key!==void 0&&(ve=""+te.key),te)J.call(te,_)&&!L.hasOwnProperty(_)&&(ae[_]=te[_]);var Me=arguments.length-2;if(Me===1)ae.children=oe;else if(1<Me){for(var ke=Array(Me),Le=0;Le<Me;Le++)ke[Le]=arguments[Le+2];ae.children=ke}if(Te&&Te.defaultProps)for(_ in Me=Te.defaultProps,Me)ae[_]===void 0&&(ae[_]=Me[_]);return{$$typeof:l$1,type:Te,key:ve,ref:we,props:ae,_owner:K.current}}function N(Te,te){return{$$typeof:l$1,type:Te.type,key:te,ref:Te.ref,props:Te.props,_owner:Te._owner}}function O(Te){return typeof Te=="object"&&Te!==null&&Te.$$typeof===l$1}function escape$1(Te){var te={"=":"=0",":":"=2"};return"$"+Te.replace(/[=:]/g,function(oe){return te[oe]})}var P=/\/+/g;function Q(Te,te){return typeof Te=="object"&&Te!==null&&Te.key!=null?escape$1(""+Te.key):te.toString(36)}function R(Te,te,oe,_,ae){var ve=typeof Te;(ve==="undefined"||ve==="boolean")&&(Te=null);var we=!1;if(Te===null)we=!0;else switch(ve){case"string":case"number":we=!0;break;case"object":switch(Te.$$typeof){case l$1:case n$1:we=!0}}if(we)return we=Te,ae=ae(we),Te=_===""?"."+Q(we,0):_,I(ae)?(oe="",Te!=null&&(oe=Te.replace(P,"$&/")+"/"),R(ae,te,oe,"",function(Le){return Le})):ae!=null&&(O(ae)&&(ae=N(ae,oe+(!ae.key||we&&we.key===ae.key?"":(""+ae.key).replace(P,"$&/")+"/")+Te)),te.push(ae)),1;if(we=0,_=_===""?".":_+":",I(Te))for(var Me=0;Me<Te.length;Me++){ve=Te[Me];var ke=_+Q(ve,Me);we+=R(ve,te,oe,ke,ae)}else if(ke=A(Te),typeof ke=="function")for(Te=ke.call(Te),Me=0;!(ve=Te.next()).done;)ve=ve.value,ke=_+Q(ve,Me++),we+=R(ve,te,oe,ke,ae);else if(ve==="object")throw te=String(Te),Error("Objects are not valid as a React child (found: "+(te==="[object Object]"?"object with keys {"+Object.keys(Te).join(", ")+"}":te)+"). If you meant to render a collection of children, use an array instead.");return we}function S(Te,te,oe){if(Te==null)return Te;var _=[],ae=0;return R(Te,_,"","",function(ve){return te.call(oe,ve,ae++)}),_}function T(Te){if(Te._status===-1){var te=Te._result;te=te(),te.then(function(oe){(Te._status===0||Te._status===-1)&&(Te._status=1,Te._result=oe)},function(oe){(Te._status===0||Te._status===-1)&&(Te._status=2,Te._result=oe)}),Te._status===-1&&(Te._status=0,Te._result=te)}if(Te._status===1)return Te._result.default;throw Te._result}var U={current:null},V={transition:null},W={ReactCurrentDispatcher:U,ReactCurrentBatchConfig:V,ReactCurrentOwner:K};react_production_min.Children={map:S,forEach:function(Te,te,oe){S(Te,function(){te.apply(this,arguments)},oe)},count:function(Te){var te=0;return S(Te,function(){te++}),te},toArray:function(Te){return S(Te,function(te){return te})||[]},only:function(Te){if(!O(Te))throw Error("React.Children.only expected to receive a single React element child.");return Te}};react_production_min.Component=E;react_production_min.Fragment=p$1;react_production_min.Profiler=r;react_production_min.PureComponent=G;react_production_min.StrictMode=q$1;react_production_min.Suspense=w;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W;react_production_min.cloneElement=function(Te,te,oe){if(Te==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Te+".");var _=C({},Te.props),ae=Te.key,ve=Te.ref,we=Te._owner;if(te!=null){if(te.ref!==void 0&&(ve=te.ref,we=K.current),te.key!==void 0&&(ae=""+te.key),Te.type&&Te.type.defaultProps)var Me=Te.type.defaultProps;for(ke in te)J.call(te,ke)&&!L.hasOwnProperty(ke)&&(_[ke]=te[ke]===void 0&&Me!==void 0?Me[ke]:te[ke])}var ke=arguments.length-2;if(ke===1)_.children=oe;else if(1<ke){Me=Array(ke);for(var Le=0;Le<ke;Le++)Me[Le]=arguments[Le+2];_.children=Me}return{$$typeof:l$1,type:Te.type,key:ae,ref:ve,props:_,_owner:we}};react_production_min.createContext=function(Te){return Te={$$typeof:u,_currentValue:Te,_currentValue2:Te,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Te.Provider={$$typeof:t,_context:Te},Te.Consumer=Te};react_production_min.createElement=M;react_production_min.createFactory=function(Te){var te=M.bind(null,Te);return te.type=Te,te};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(Te){return{$$typeof:v,render:Te}};react_production_min.isValidElement=O;react_production_min.lazy=function(Te){return{$$typeof:y,_payload:{_status:-1,_result:Te},_init:T}};react_production_min.memo=function(Te,te){return{$$typeof:x,type:Te,compare:te===void 0?null:te}};react_production_min.startTransition=function(Te){var te=V.transition;V.transition={};try{Te()}finally{V.transition=te}};react_production_min.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};react_production_min.useCallback=function(Te,te){return U.current.useCallback(Te,te)};react_production_min.useContext=function(Te){return U.current.useContext(Te)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(Te){return U.current.useDeferredValue(Te)};react_production_min.useEffect=function(Te,te){return U.current.useEffect(Te,te)};react_production_min.useId=function(){return U.current.useId()};react_production_min.useImperativeHandle=function(Te,te,oe){return U.current.useImperativeHandle(Te,te,oe)};react_production_min.useInsertionEffect=function(Te,te){return U.current.useInsertionEffect(Te,te)};react_production_min.useLayoutEffect=function(Te,te){return U.current.useLayoutEffect(Te,te)};react_production_min.useMemo=function(Te,te){return U.current.useMemo(Te,te)};react_production_min.useReducer=function(Te,te,oe){return U.current.useReducer(Te,te,oe)};react_production_min.useRef=function(Te){return U.current.useRef(Te)};react_production_min.useState=function(Te){return U.current.useState(Te)};react_production_min.useSyncExternalStore=function(Te,te,oe){return U.current.useSyncExternalStore(Te,te,oe)};react_production_min.useTransition=function(){return U.current.useTransition()};react_production_min.version="18.2.0";(function(Te){Te.exports=react_production_min})(react);const React=getDefaultExportFromCjs(reactExports);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f=reactExports,k=Symbol.for("react.element"),l=Symbol.for("react.fragment"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};function q(Te,te,oe){var _,ae={},ve=null,we=null;oe!==void 0&&(ve=""+oe),te.key!==void 0&&(ve=""+te.key),te.ref!==void 0&&(we=te.ref);for(_ in te)m.call(te,_)&&!p.hasOwnProperty(_)&&(ae[_]=te[_]);if(Te&&Te.defaultProps)for(_ in te=Te.defaultProps,te)ae[_]===void 0&&(ae[_]=te[_]);return{$$typeof:k,type:Te,key:ve,ref:we,props:ae,_owner:n.current}}reactJsxRuntime_production_min.Fragment=l;reactJsxRuntime_production_min.jsx=q;reactJsxRuntime_production_min.jsxs=q;(function(Te){Te.exports=reactJsxRuntime_production_min})(jsxRuntime);const jsx=jsxRuntimeExports.jsx,jsxs=jsxRuntimeExports.jsxs;/*! For license information please see bundle.m.js.LICENSE.txt */var __webpackgi_modules__={44:function(Te,te,oe){var _=oe(352),ae=oe.n(_)()(function(ve){return ve[1]});ae.push([Te.id,"#assetManagerLoadingBar{z-index:400;position:absolute;top:0;left:0;right:0;width:100%;background-color:transparent;height:auto}#assetManagerLoadingBarContent{color:#fff;position:absolute;left:0;right:0;margin:auto;transition:width .5s;background-color:#222222aa;text-align:center;font-size:.5rem;line-height:.6rem;height:.6rem;border-radius:0 0 .125rem .125rem;border-bottom:#999 1px solid}.processState{font-weight:bold}",""]),te.Z=ae},798:function(Te,te,oe){var _=oe(352),ae=oe.n(_)()(function(ve){return ve[1]});ae.push([Te.id,"#assetManagerPopup{z-index:300;position:absolute;bottom:2rem;right:2rem;-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);color:#fff;background-blend-mode:luminosity;background-color:#28223CAA;padding:1.5rem;font-size:1rem;width:-webkit-max-content;width:-moz-max-content;width:max-content;max-width:80vw;max-height:80vh;overflow-y:scroll;border-radius:.5rem;height:-webkit-max-content;height:-moz-max-content;height:max-content}#assetManagerPopupClose{position:absolute;top:0;right:0;padding:.5rem;cursor:pointer}#assetManagerPopupContent{padding-top:.5rem}.processState{font-weight:bold}",""]),te.Z=ae},898:function(Te,te,oe){var _=oe(352),ae=oe.n(_)()(function(ve){return ve[1]});ae.push([Te.id,':root{--tp-blade-unit-size: 24px;--tp-element-border-radius: 0.25rem;--tp-base-background-color: #28223C;--tp-base-shadow-color: hsla(0, 0%, 0%, 0.2);--tp-button-background-color: hsla(230, 10%, 80%, 1.00);--tp-button-background-color-active: hsla(230, 10%, 95%, 1.00);--tp-button-background-color-focus: hsla(230, 10%, 90%, 1.00);--tp-button-background-color-hover: hsla(230, 10%, 85%, 1.00);--tp-button-foreground-color: hsla(230, 20%, 11%, 1.00);--tp-container-background-color: hsla(230, 25%, 16%, 0.65);--tp-container-background-color-active: hsla(230, 25%, 31%, 0.65);--tp-container-background-color-focus: hsla(230, 25%, 26%, 0.65);--tp-container-background-color-hover: hsla(230, 25%, 21%, 0.65);--tp-container-foreground-color: hsl(240, 10%, 92%);--tp-groove-foreground-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color-active: hsla(230, 28%, 23%, 1.00);--tp-input-background-color-focus: hsla(230, 28%, 18%, 1.00);--tp-input-background-color-hover: hsla(230, 20%, 13%, 1.00);--tp-input-foreground-color: hsla(230, 10%, 80%, 1.00);--tp-monitor-background-color: hsla(230, 20%, 8%, 1.00);--tp-monitor-foreground-color: hsla(230, 12%, 48%, 1.00);--tp-label-foreground-color: #E4E2ED;--tp-font-family: "Inter"}.tp-fldv{margin-top:.25rem;margin-bottom:.25rem;background-blend-mode:luminosity;position:relative}.tp-fldv .tp-fldv{margin-top:.5rem;margin-bottom:.5rem}.tp-fldv .tp-brkv{background-color:rgba(32,32,50,.85)}.tp-fldv .tp-fldv .tp-brkv{background-color:rgba(32,32,50,.25) !important}.tp-fldv-expanded>.tp-fldv_b{background-color:rgba(32,32,50,.8) !important}.tp-fldv_b{height:calc(var(--bld-us)*1.5 + 4px) !important;font-size:.85rem !important}.tp-fldv_b+.tp-brkv .tp-fldv_b{height:calc(var(--bld-us)*1.1 + 4px) !important;font-size:.65rem !important}.tp-lblv_l{font-size:.7rem !important;font-weight:400 !important;flex-grow:1 !important;flex-basis:20% !important}.tp-lblv_v{flex-grow:1 !important;flex-basis:50% !important}.tp-txtv_i{font-size:.7rem !important;font-weight:400 !important}.tp-fldv_t{font-weight:400 !important;padding-left:1.5rem !important}.tp-fldv_m{right:auto !important;left:.75rem;opacity:1 !important}.pluginOptionsButton{position:absolute;right:0;top:.75rem;padding-left:.5rem;padding-right:.5rem;height:-webkit-min-content;height:-moz-min-content;height:min-content;background:transparent;color:#eee;border:none}',""]),te.Z=ae},513:function(Te,te,oe){var _=oe(352),ae=oe.n(_)()(function(ve){return ve[1]});ae.push([Te.id,".wwise-perspective{perspective:1000px;position:fixed;left:0;top:0;width:100vw;height:100vh}.wwise-wrapper{position:fixed;width:0;height:0;font-weight:400}.wwise-wrapper.v-center{top:50%}.wwise-wrapper.h-center{left:50%}.wwise-wrapper.left{left:0}.wwise-wrapper.right{right:0}.wwise-wrapper.top{top:0}.wwise-wrapper.bottom{bottom:0}.wwise *.preset{color:#fafafa}.wwise *.preset.ok{background:rgba(45,193,80,.95)}.wwise *.preset.error{background:rgba(190,17,51,.95)}.wwise *.preset.info{background:rgba(40,34,60,.95)}.wwise *.preset.caution{background:rgba(239,128,0,.95)}.wwise-no-scroll{position:relative;overflow:hidden}.wwise-overlay{position:fixed;left:0;top:0;width:100vw;height:100vh;background:rgba(50,50,50,.5)}.wwise{position:absolute;left:0;top:0;display:flex;flex-direction:column;border-radius:5px;box-shadow:1px 1px 10px rgba(150,150,150,.5);box-sizing:border-box}.wwise.no-radius{border-radius:0}.wwise *{box-sizing:border-box}.wwise .clear{clear:both}.wwise>.content{padding:0;margin:0;flex-grow:1;border-radius:0 0 4px 4px;background:#fff;color:#333;box-shadow:0 1px 3px rgba(200,200,200,.5) inset}.wwise>.content.no-topbar{border-radius:4px;box-shadow:none}.wwise.no-radius>.content,.wwise.no-radius>.content.no-topbar{border-radius:0}.wwise .modal>.main{width:90vw;max-width:400px;border-radius:4px 4px 0 0;text-align:center;padding-bottom:10px;color:#fff}.wwise .modal>.main .icon{display:block;margin:0 auto;fill:#fff;width:100px}.wwise .modal>.main .title{font-size:30px}.wwise .modal>.main .text{margin:10px 0;font-weight:300;font-size:16px}.wwise .modal>.main.no-op{border-radius:4px}.wwise .modal>.main.ok{background:#2dc150}.wwise .modal>.main.error{background:#be1133}.wwise .modal>.main.info{background:#28223c}.wwise .modal>.main.caution{background:#ef8000}.wwise .modal>.operation .button-wrapper{text-align:center;margin:30px 0 20px 0}.wwise .modal>.operation .button{display:inline-block;line-height:18px;padding:8px 10px;margin:0 15px;line-height:18px;width:100px;border-radius:4px;border:1px solid #eee;box-shadow:1px 1px 3px rgba(220,220,220,.8);color:#555;transition:all ease .2s}.wwise .modal>.operation .button:hover{background:#f5f5f5;cursor:pointer}.wwise .modal>.operation .button.main{color:#fff}.wwise .modal>.operation.ok .main{background:#2dc150}.wwise .modal>.operation.ok .main:hover{background:#23983f}.wwise .modal>.operation.error .main{background:#be1133}.wwise .modal>.operation.error .main:hover{background:#8f0d26}.wwise .modal>.operation.info .main{background:#28223c}.wwise .modal>.operation.info .main:hover{background:#12101b}.wwise .modal>.operation.caution .main{background:#ef8000}.wwise .modal>.operation.caution .main:hover{background:#bc6500}.wwise .input-wrapper{margin:15px auto -15px auto}.wwise .input-wrapper .input{display:block;margin:0 auto;width:95%;max-width:300px;outline:none;border:none;background:#f3f3f3;padding:15px;font-size:16px;border-radius:5px}.wwise .input-wrapper .error{width:95%;text-align:center;margin-top:10px;color:red}div:has(>.wwise-wrapper){position:absolute !important}.wwise-wrapper{position:absolute !important}.wwise .modal>.main{padding-top:10px}",""]),te.Z=ae},476:function(Te){var te;te=function(){return function(oe){var _={};function ae(ve){if(_[ve])return _[ve].exports;var we=_[ve]={i:ve,l:!1,exports:{}};return oe[ve].call(we.exports,we,we.exports,ae),we.l=!0,we.exports}return ae.m=oe,ae.c=_,ae.i=function(ve){return ve},ae.d=function(ve,we,Me){ae.o(ve,we)||Object.defineProperty(ve,we,{configurable:!1,enumerable:!0,get:Me})},ae.n=function(ve){var we=ve&&ve.__esModule?function(){return ve.default}:function(){return ve};return ae.d(we,"a",we),we},ae.o=function(ve,we){return Object.prototype.hasOwnProperty.call(ve,we)},ae.p="",ae(ae.s=5)}([function(oe,_,ae){Object.defineProperty(_,"__esModule",{value:!0});var ve={convertToObject:function(we){var Me=we.substring(we.indexOf("{")+1).trim().slice(0,-1),ke={};return Me.split(";").map(function(Le){if(Le=Le.trim()){var Ye=Le.split(":");ke[Ye[0].trim()]=Ye[1].trim()}}),ke},getFromSheets:function(we){var Me=document.styleSheets;for(var ke in Me){var Le=null;try{Le=Me[ke].rules||Me[ke].cssRules}catch{}if(Le){for(var Ye in Le)if(Le[Ye].selectorText&&Le[Ye].selectorText.split(",").indexOf(we)!=-1)return Le[Ye].cssText?ve.convertToObject(Le[Ye].cssText):ve.convertToObject(Le[Ye].style.cssText)}}return{}},getPropertyDefault:function(we){return we=="timing-function"?"ease":we=="iteration-count"?1:we=="direction"?"normal":we=="fill-mode"?"none":null}};_.default=ve},function(oe,_,ae){Object.defineProperty(_,"__esModule",{value:!0});var ve={generateId:function(){for(var we="",Me="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",ke=0;ke<8;++ke)we+=Me.charAt(Math.floor(Math.random()*Me.length));return we},frameToString:function(we){var Me="";for(var ke in we)Me+=ke+":"+we[ke]+";";return Me},convertTimeToMs:function(we){if(!we)return 0;if(typeof we=="number")return we;var Me=parseFloat(we);return we.indexOf("ms")!=-1?Me:1e3*Me},prefixes:["","-webkit-","-moz-","-o-"]};_.default=ve},function(oe,_,ae){Object.defineProperty(_,"__esModule",{value:!0});var ve,we=(ve=ae(0))&&ve.__esModule?ve:{default:ve};_.default=function Me(ke,Le){if(function(Ke,Ge){if(!(Ke instanceof Ge))throw new TypeError("Cannot call a class as a function")}(this,Me),this.styles=typeof ke=="string"?we.default.getFromSheets(ke):ke,typeof Le=="string"){var Ye=we.default.getFromSheets(Le);for(var tt in this.options={},Ye)this.options[tt.replace("animation-","")]=Ye[tt]}else this.options=typeof Le=="number"?{duration:Le}:Le}},function(oe,_,ae){Object.defineProperty(_,"__esModule",{value:!0});var ve=function(){function tt(Ke,Ge){for(var et=0;et<Ge.length;et++){var Ue=Ge[et];Ue.enumerable=Ue.enumerable||!1,Ue.configurable=!0,"value"in Ue&&(Ue.writable=!0),Object.defineProperty(Ke,Ue.key,Ue)}}return function(Ke,Ge,et){return Ge&&tt(Ke.prototype,Ge),et&&tt(Ke,et),Ke}}(),we=Le(ae(4)),Me=Le(ae(1)),ke=Le(ae(0));function Le(tt){return tt&&tt.__esModule?tt:{default:tt}}var Ye=function(){function tt(Ke,Ge,et,Ue){if(function(Ze,st){if(!(Ze instanceof st))throw new TypeError("Cannot call a class as a function")}(this,tt),Ke.constructor===Array?this.doms=Ke:this.doms=[Ke],Ge.constructor===Array?this.frames=Ge:this.frames=[Ge],this.options={startFrom:0,pauseAt:[],prefix:!1,count:1,clear:!0,applyOnEnd:!1,instant:!1},et!=null&&et!=null)if(typeof et=="boolean")this.options.instant=et;else if(typeof et=="number")this.options.count=et,typeof Ue=="boolean"&&(this.options.instant=Ue);else for(var nt in et)nt=="pauseAt"&&et.pauseAt.constructor!==Array?this.options[nt]=[et[nt]]:this.options[nt]=et[nt];for(var He in this.promiseSupported=typeof Promise<"u"&&Promise.toString().indexOf("[native code]")!==-1,this.countRemainder=[],this.animations=[],this.styleDoms=[],this.superSets=[],this.eventHandler=[],this.options.prefix?this.prefixes=Me.default.prefixes:this.prefixes=[""],Ke)this.countRemainder[He]=this.options.count-1;this.options.instant&&this.play()}return ve(tt,[{key:"play",value:function(){var Ke=this;for(var Ge in this.clear(),this.promiseSupported&&(this.promise=new Promise(function(Ue){Ke.promiseResolve=Ue})),this.doms){var et=this.makeAnimation(this.doms[Ge]);this.animations[Ge]=et.names,this.styleDoms[Ge]=et.styleDom,this.superSets[Ge]=this.makeSuperSet(this.doms[Ge],this.animations[Ge]),this.playAnimation(this.doms[Ge],this.superSets[Ge]),this.eventHandler[Ge]=this.handleAnimationEnd.bind(this,Ge),this.doms[Ge].addEventListener("animationend",this.eventHandler[Ge])}if(this.promiseSupported)return this.promise}},{key:"clear",value:function(Ke){if(!Ke){for(var Ge in this.doms)this.clear(Ge);return this.animationEnded=0,this.promise=void 0,void(this.promiseResolve=void 0)}var et=this.styleDoms[Ke];for(var Ue in et&&et.parentNode&&et.parentNode.removeChild(et),this.superSets[Ke])for(var nt in this.prefixes)this.doms[Ke].style[this.prefixes[nt]+"animation-"+Ue]=null;for(var He in this.prefixes)this.doms[Ke].style[this.prefixes[He]+"animation-play-state"]=null;this.doms[Ke].removeEventListener("animationend",this.eventHandler[Ke]),this.countRemainder[Ke]=this.options.count-1}},{key:"replay",value:function(Ke){var Ge=this.doms[Ke],et=Ge.cloneNode(!0);Ge.parentNode.replaceChild(et,Ge),this.doms[Ke].removeEventListener("animationend",this.eventHandler[Ke]),this.doms[Ke]=et,this.doms[Ke].addEventListener("animationend",this.eventHandler[Ke])}},{key:"pause",value:function(){for(var Ke in this.doms)this.pauseDom(this.doms[Ke])}},{key:"resume",value:function(){for(var Ke in this.doms)this.resumeDom(this.doms[Ke])}},{key:"getPromise",value:function(){return this.promise}},{key:"handleAnimationEnd",value:function(Ke,Ge){var et=Ge.animationName,Ue=et.substring(et.lastIndexOf("-")+1);this.options.pauseAt.includes(parseInt(Ue))&&this.pauseDom(this.doms[Ke]),Ue==this.frames.length&&(this.countRemainder[Ke]==-1?this.replay(Ke):this.countRemainder[Ke]>0?(this.countRemainder[Ke]--,this.replay(Ke)):(this.options.applyOnEnd&&this.applyOnEnd(Ke),this.animationEnded++,this.animationEnded==this.doms.length&&(this.promiseSupported&&this.promiseResolve(),this.options.clear&&this.clear())))}},{key:"pauseDom",value:function(Ke){for(var Ge in this.prefixes)Ke.style[this.prefixes[Ge]+"animation-play-state"]="paused"}},{key:"resumeDom",value:function(Ke){for(var Ge in this.prefixes)Ke.style[this.prefixes[Ge]+"animation-play-state"]="running"}},{key:"applyOnEnd",value:function(Ke){var Ge=this.newFrames[this.frames.length];for(var et in Ge)this.doms[Ke].style[et]=Ge[et]}},{key:"makeAnimation",value:function(Ke){var Ge={},et=[],Ue={};for(var nt in this.frames)for(var He in et.push(this.frames[nt].styles),et[nt])Ue[He]=!0;var Ze=window.getComputedStyle(Ke);for(var st in Ue)Ge[st]=Ze[st];et.unshift(Ge);for(var Et=[et[0]],rt=1;rt<et.length;++rt){var bt=JSON.parse(JSON.stringify(Et[rt-1]));for(var Ne in et[rt])bt[Ne]=et[rt][Ne];Et.push(bt)}return this.newFrames=Et,we.default.make(Et,this.prefixes)}},{key:"makeSuperSet",value:function(Ke,Ge){var et=0,Ue={};for(var nt in this.frames)for(var He in this.frames[nt].options)Ue[He]="";Ue.name="",Ue.duration="",Ue.delay="";for(var Ze=0;Ze<this.frames.length;++Ze){if(Ze)for(var st in Ue)Ue[st]+=",";var Et=Me.default.convertTimeToMs(this.frames[Ze].options.duration),rt=Me.default.convertTimeToMs(this.frames[Ze].options.delay);for(var bt in Ze<this.options.startFrom&&(Et=0,rt=0),Ue.name+=Ge[Ze],Ue.duration+=Et+"ms",Ue.delay+=et+rt+"ms",Ue)bt!="name"&&bt!="duration"&&bt!="delay"&&(Ue[bt]+=this.frames[Ze].options[bt]?this.frames[Ze].options[bt]:ke.default.getPropertyDefault(bt));var Ne=this.frames[Ze].options["iteration-count"];et+=Et*parseInt(Ne||1)+rt}return Ue}},{key:"playAnimation",value:function(Ke,Ge){for(var et in Ge)for(var Ue in this.prefixes)Ke.style[this.prefixes[Ue]+"animation-"+et]=Ge[et];this.options.pauseAt.includes(0)&&this.pauseDom(Ke)}}]),tt}();_.default=Ye},function(oe,_,ae){Object.defineProperty(_,"__esModule",{value:!0});var ve,we=(ve=ae(1))&&ve.__esModule?ve:{default:ve},Me={make:function(ke,Le){for(var Ye=[],tt="",Ke="atr-"+we.default.generateId(),Ge=document.createElement("style"),et=0;et<ke.length-1;++et)Ye.push(Ke+"-"+(et+1)),tt+=Me.makeFromTwoFrames(ke[et],ke[et+1],Ye[et],Le);return Ge.innerHTML=tt,Ge.class="foo",document.getElementsByTagName("head")[0].appendChild(Ge),{names:Ye,styleDom:Ge}},makeFromTwoFrames:function(ke,Le,Ye,tt){var Ke="";for(var Ge in tt)Ke+="@"+tt[Ge]+"keyframes "+Ye+" {",Ke+="0%",Ke+="{"+we.default.frameToString(ke)+"}",Ke+="100%",Ke+="{"+we.default.frameToString(Le)+"}",Ke+="}";return Ke}};_.default=Me},function(oe,_,ae){Object.defineProperty(_,"__esModule",{value:!0}),_.Queue=_.Frame=void 0;var ve=Me(ae(2)),we=Me(ae(3));function Me(ke){return ke&&ke.__esModule?ke:{default:ke}}_.Frame=ve.default,_.Queue=we.default}])},Te.exports=te()},352:function(Te){Te.exports=function(te){var oe=[];return oe.toString=function(){return this.map(function(_){var ae=te(_);return _[2]?"@media ".concat(_[2]," {").concat(ae,"}"):ae}).join("")},oe.i=function(_,ae,ve){typeof _=="string"&&(_=[[null,_,""]]);var we={};if(ve)for(var Me=0;Me<this.length;Me++){var ke=this[Me][0];ke!=null&&(we[ke]=!0)}for(var Le=0;Le<_.length;Le++){var Ye=[].concat(_[Le]);ve&&we[Ye[0]]||(ae&&(Ye[2]?Ye[2]="".concat(ae," and ").concat(Ye[2]):Ye[2]=ae),oe.push(Ye))}},oe}},388:function(Te){Te.exports=function te(oe,_,ae){function ve(ke,Le){if(!_[ke]){if(!oe[ke]){if(we)return we(ke,!0);throw new Error("Cannot find module '"+ke+"'")}var Ye=_[ke]={exports:{}};oe[ke][0].call(Ye.exports,function(tt){return ve(oe[ke][1][tt]||tt)},Ye,Ye.exports,te,oe,_,ae)}return _[ke].exports}for(var we=void 0,Me=0;Me<ae.length;Me++)ve(ae[Me]);return ve}({1:[function(te,oe,_){(function(ae,ve,we,Me,ke,Le,Ye,tt,Ke){var Ge=te("crypto");function et(rt,bt){return function(Ne,Qe){var We;if((We=Qe.algorithm!=="passthrough"?Ge.createHash(Qe.algorithm):new Et).write===void 0&&(We.write=We.update,We.end=We.update),st(Qe,We).dispatch(Ne),We.update||We.end(""),We.digest)return We.digest(Qe.encoding==="buffer"?void 0:Qe.encoding);var _t=We.read();return Qe.encoding!=="buffer"?_t.toString(Qe.encoding):_t}(rt,bt=He(rt,bt))}(_=oe.exports=et).sha1=function(rt){return et(rt)},_.keys=function(rt){return et(rt,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},_.MD5=function(rt){return et(rt,{algorithm:"md5",encoding:"hex"})},_.keysMD5=function(rt){return et(rt,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var Ue=Ge.getHashes?Ge.getHashes().slice():["sha1","md5"];Ue.push("passthrough");var nt=["buffer","hex","binary","base64"];function He(rt,bt){bt=bt||{};var Ne={};if(Ne.algorithm=bt.algorithm||"sha1",Ne.encoding=bt.encoding||"hex",Ne.excludeValues=!!bt.excludeValues,Ne.algorithm=Ne.algorithm.toLowerCase(),Ne.encoding=Ne.encoding.toLowerCase(),Ne.ignoreUnknown=bt.ignoreUnknown===!0,Ne.respectType=bt.respectType!==!1,Ne.respectFunctionNames=bt.respectFunctionNames!==!1,Ne.respectFunctionProperties=bt.respectFunctionProperties!==!1,Ne.unorderedArrays=bt.unorderedArrays===!0,Ne.unorderedSets=bt.unorderedSets!==!1,Ne.unorderedObjects=bt.unorderedObjects!==!1,Ne.replacer=bt.replacer||void 0,Ne.excludeKeys=bt.excludeKeys||void 0,rt===void 0)throw new Error("Object argument required.");for(var Qe=0;Qe<Ue.length;++Qe)Ue[Qe].toLowerCase()===Ne.algorithm.toLowerCase()&&(Ne.algorithm=Ue[Qe]);if(Ue.indexOf(Ne.algorithm)===-1)throw new Error('Algorithm "'+Ne.algorithm+'"  not supported. supported values: '+Ue.join(", "));if(nt.indexOf(Ne.encoding)===-1&&Ne.algorithm!=="passthrough")throw new Error('Encoding "'+Ne.encoding+'"  not supported. supported values: '+nt.join(", "));return Ne}function Ze(rt){if(typeof rt=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(rt))!=null}function st(rt,bt,Ne){function Qe(We){return bt.update?bt.update(We,"utf8"):bt.write(We,"utf8")}return Ne=Ne||[],{dispatch:function(We){return rt.replacer&&(We=rt.replacer(We)),this["_"+(We===null?"null":typeof We)](We)},_object:function(We){var _t,lt=Object.prototype.toString.call(We),Ut=/\[object (.*)\]/i.exec(lt);if(Ut=(Ut=Ut?Ut[1]:"unknown:["+lt+"]").toLowerCase(),0<=(_t=Ne.indexOf(We)))return this.dispatch("[CIRCULAR:"+_t+"]");if(Ne.push(We),we!==void 0&&we.isBuffer&&we.isBuffer(We))return Qe("buffer:"),Qe(We);if(Ut==="object"||Ut==="function"||Ut==="asyncfunction"){var dn=Object.keys(We);rt.unorderedObjects&&(dn=dn.sort()),rt.respectType===!1||Ze(We)||dn.splice(0,0,"prototype","__proto__","constructor"),rt.excludeKeys&&(dn=dn.filter(function(un){return!rt.excludeKeys(un)})),Qe("object:"+dn.length+":");var nn=this;return dn.forEach(function(un){nn.dispatch(un),Qe(":"),rt.excludeValues||nn.dispatch(We[un]),Qe(",")})}if(!this["_"+Ut]){if(rt.ignoreUnknown)return Qe("["+Ut+"]");throw new Error('Unknown object type "'+Ut+'"')}this["_"+Ut](We)},_array:function(We,_t){_t=_t!==void 0?_t:rt.unorderedArrays!==!1;var lt=this;if(Qe("array:"+We.length+":"),!_t||We.length<=1)return We.forEach(function(nn){return lt.dispatch(nn)});var Ut=[],dn=We.map(function(nn){var un=new Et,Zt=Ne.slice();return st(rt,un,Zt).dispatch(nn),Ut=Ut.concat(Zt.slice(Ne.length)),un.read().toString()});return Ne=Ne.concat(Ut),dn.sort(),this._array(dn,!1)},_date:function(We){return Qe("date:"+We.toJSON())},_symbol:function(We){return Qe("symbol:"+We.toString())},_error:function(We){return Qe("error:"+We.toString())},_boolean:function(We){return Qe("bool:"+We.toString())},_string:function(We){Qe("string:"+We.length+":"),Qe(We.toString())},_function:function(We){Qe("fn:"),Ze(We)?this.dispatch("[native]"):this.dispatch(We.toString()),rt.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(We.name)),rt.respectFunctionProperties&&this._object(We)},_number:function(We){return Qe("number:"+We.toString())},_xml:function(We){return Qe("xml:"+We.toString())},_null:function(){return Qe("Null")},_undefined:function(){return Qe("Undefined")},_regexp:function(We){return Qe("regex:"+We.toString())},_uint8array:function(We){return Qe("uint8array:"),this.dispatch(Array.prototype.slice.call(We))},_uint8clampedarray:function(We){return Qe("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(We))},_int8array:function(We){return Qe("uint8array:"),this.dispatch(Array.prototype.slice.call(We))},_uint16array:function(We){return Qe("uint16array:"),this.dispatch(Array.prototype.slice.call(We))},_int16array:function(We){return Qe("uint16array:"),this.dispatch(Array.prototype.slice.call(We))},_uint32array:function(We){return Qe("uint32array:"),this.dispatch(Array.prototype.slice.call(We))},_int32array:function(We){return Qe("uint32array:"),this.dispatch(Array.prototype.slice.call(We))},_float32array:function(We){return Qe("float32array:"),this.dispatch(Array.prototype.slice.call(We))},_float64array:function(We){return Qe("float64array:"),this.dispatch(Array.prototype.slice.call(We))},_arraybuffer:function(We){return Qe("arraybuffer:"),this.dispatch(new Uint8Array(We))},_url:function(We){return Qe("url:"+We.toString())},_map:function(We){Qe("map:");var _t=Array.from(We);return this._array(_t,rt.unorderedSets!==!1)},_set:function(We){Qe("set:");var _t=Array.from(We);return this._array(_t,rt.unorderedSets!==!1)},_file:function(We){return Qe("file:"),this.dispatch([We.name,We.size,We.type,We.lastModfied])},_blob:function(){if(rt.ignoreUnknown)return Qe("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return Qe("domwindow")},_bigint:function(We){return Qe("bigint:"+We.toString())},_process:function(){return Qe("process")},_timer:function(){return Qe("timer")},_pipe:function(){return Qe("pipe")},_tcp:function(){return Qe("tcp")},_udp:function(){return Qe("udp")},_tty:function(){return Qe("tty")},_statwatcher:function(){return Qe("statwatcher")},_securecontext:function(){return Qe("securecontext")},_connection:function(){return Qe("connection")},_zlib:function(){return Qe("zlib")},_context:function(){return Qe("context")},_nodescript:function(){return Qe("nodescript")},_httpparser:function(){return Qe("httpparser")},_dataview:function(){return Qe("dataview")},_signal:function(){return Qe("signal")},_fsevent:function(){return Qe("fsevent")},_tlswrap:function(){return Qe("tlswrap")}}}function Et(){return{buf:"",write:function(rt){this.buf+=rt},end:function(rt){this.buf+=rt},read:function(){return this.buf}}}_.writeToStream=function(rt,bt,Ne){return Ne===void 0&&(Ne=bt,bt={}),st(bt=He(rt,bt),Ne).dispatch(rt)}}).call(this,te("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},te("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_7eac155c.js","/")},{buffer:3,crypto:5,lYpoI2:10}],2:[function(te,oe,_){(function(ae,ve,we,Me,ke,Le,Ye,tt,Ke){(function(Ge){var et=typeof Uint8Array<"u"?Uint8Array:Array,Ue="+".charCodeAt(0),nt="/".charCodeAt(0),He="0".charCodeAt(0),Ze="a".charCodeAt(0),st="A".charCodeAt(0),Et="-".charCodeAt(0),rt="_".charCodeAt(0);function bt(Ne){var Qe=Ne.charCodeAt(0);return Qe===Ue||Qe===Et?62:Qe===nt||Qe===rt?63:Qe<He?-1:Qe<He+10?Qe-He+26+26:Qe<st+26?Qe-st:Qe<Ze+26?Qe-Ze+26:void 0}Ge.toByteArray=function(Ne){var Qe,We;if(0<Ne.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var _t=Ne.length,lt=Ne.charAt(_t-2)==="="?2:Ne.charAt(_t-1)==="="?1:0,Ut=new et(3*Ne.length/4-lt),dn=0<lt?Ne.length-4:Ne.length,nn=0;function un(Zt){Ut[nn++]=Zt}for(Qe=0;Qe<dn;Qe+=4,0)un((16711680&(We=bt(Ne.charAt(Qe))<<18|bt(Ne.charAt(Qe+1))<<12|bt(Ne.charAt(Qe+2))<<6|bt(Ne.charAt(Qe+3))))>>16),un((65280&We)>>8),un(255&We);return lt==2?un(255&(We=bt(Ne.charAt(Qe))<<2|bt(Ne.charAt(Qe+1))>>4)):lt==1&&(un((We=bt(Ne.charAt(Qe))<<10|bt(Ne.charAt(Qe+1))<<4|bt(Ne.charAt(Qe+2))>>2)>>8&255),un(255&We)),Ut},Ge.fromByteArray=function(Ne){var Qe,We,_t,lt,Ut=Ne.length%3,dn="";function nn(un){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(un)}for(Qe=0,_t=Ne.length-Ut;Qe<_t;Qe+=3)dn+=nn((lt=We=(Ne[Qe]<<16)+(Ne[Qe+1]<<8)+Ne[Qe+2])>>18&63)+nn(lt>>12&63)+nn(lt>>6&63)+nn(63&lt);switch(Ut){case 1:dn+=nn((We=Ne[Ne.length-1])>>2),dn+=nn(We<<4&63),dn+="==";break;case 2:dn+=nn((We=(Ne[Ne.length-2]<<8)+Ne[Ne.length-1])>>10),dn+=nn(We>>4&63),dn+=nn(We<<2&63),dn+="="}return dn}})(_===void 0?this.base64js={}:_)}).call(this,te("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},te("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:10}],3:[function(te,oe,_){(function(ae,ve,Ue,Me,ke,Le,Ye,tt,Ke){var Ge=te("base64-js"),et=te("ieee754");function Ue(Je,ot,Rt){if(!(this instanceof Ue))return new Ue(Je,ot,Rt);var Mn,Pn,Rn,hi,$n,ji=typeof Je;if(ot==="base64"&&ji=="string")for(Je=(Mn=Je).trim?Mn.trim():Mn.replace(/^\s+|\s+$/g,"");Je.length%4!=0;)Je+="=";if(ji=="number")Pn=nn(Je);else if(ji=="string")Pn=Ue.byteLength(Je,ot);else{if(ji!="object")throw new Error("First argument needs to be a number, array or string.");Pn=nn(Je.length)}if(Ue._useTypedArrays?Rn=Ue._augment(new Uint8Array(Pn)):((Rn=this).length=Pn,Rn._isBuffer=!0),Ue._useTypedArrays&&typeof Je.byteLength=="number")Rn._set(Je);else if(un($n=Je)||Ue.isBuffer($n)||$n&&typeof $n=="object"&&typeof $n.length=="number")for(hi=0;hi<Pn;hi++)Ue.isBuffer(Je)?Rn[hi]=Je.readUInt8(hi):Rn[hi]=Je[hi];else if(ji=="string")Rn.write(Je,0,ot);else if(ji=="number"&&!Ue._useTypedArrays&&!Rt)for(hi=0;hi<Pn;hi++)Rn[hi]=0;return Rn}function nt(Je,ot,Rt,Mn){Mn||(Vt(typeof Rt=="boolean","missing or invalid endian"),Vt(ot!=null,"missing offset"),Vt(ot+1<Je.length,"Trying to read beyond buffer length"));var Pn,Rn=Je.length;if(!(Rn<=ot))return Rt?(Pn=Je[ot],ot+1<Rn&&(Pn|=Je[ot+1]<<8)):(Pn=Je[ot]<<8,ot+1<Rn&&(Pn|=Je[ot+1])),Pn}function He(Je,ot,Rt,Mn){Mn||(Vt(typeof Rt=="boolean","missing or invalid endian"),Vt(ot!=null,"missing offset"),Vt(ot+3<Je.length,"Trying to read beyond buffer length"));var Pn,Rn=Je.length;if(!(Rn<=ot))return Rt?(ot+2<Rn&&(Pn=Je[ot+2]<<16),ot+1<Rn&&(Pn|=Je[ot+1]<<8),Pn|=Je[ot],ot+3<Rn&&(Pn+=Je[ot+3]<<24>>>0)):(ot+1<Rn&&(Pn=Je[ot+1]<<16),ot+2<Rn&&(Pn|=Je[ot+2]<<8),ot+3<Rn&&(Pn|=Je[ot+3]),Pn+=Je[ot]<<24>>>0),Pn}function Ze(Je,ot,Rt,Mn){if(Mn||(Vt(typeof Rt=="boolean","missing or invalid endian"),Vt(ot!=null,"missing offset"),Vt(ot+1<Je.length,"Trying to read beyond buffer length")),!(Je.length<=ot)){var Pn=nt(Je,ot,Rt,!0);return 32768&Pn?-1*(65535-Pn+1):Pn}}function st(Je,ot,Rt,Mn){if(Mn||(Vt(typeof Rt=="boolean","missing or invalid endian"),Vt(ot!=null,"missing offset"),Vt(ot+3<Je.length,"Trying to read beyond buffer length")),!(Je.length<=ot)){var Pn=He(Je,ot,Rt,!0);return 2147483648&Pn?-1*(4294967295-Pn+1):Pn}}function Et(Je,ot,Rt,Mn){return Mn||(Vt(typeof Rt=="boolean","missing or invalid endian"),Vt(ot+3<Je.length,"Trying to read beyond buffer length")),et.read(Je,ot,Rt,23,4)}function rt(Je,ot,Rt,Mn){return Mn||(Vt(typeof Rt=="boolean","missing or invalid endian"),Vt(ot+7<Je.length,"Trying to read beyond buffer length")),et.read(Je,ot,Rt,52,8)}function bt(Je,ot,Rt,Mn,Pn){Pn||(Vt(ot!=null,"missing value"),Vt(typeof Mn=="boolean","missing or invalid endian"),Vt(Rt!=null,"missing offset"),Vt(Rt+1<Je.length,"trying to write beyond buffer length"),Jt(ot,65535));var Rn=Je.length;if(!(Rn<=Rt))for(var hi=0,$n=Math.min(Rn-Rt,2);hi<$n;hi++)Je[Rt+hi]=(ot&255<<8*(Mn?hi:1-hi))>>>8*(Mn?hi:1-hi)}function Ne(Je,ot,Rt,Mn,Pn){Pn||(Vt(ot!=null,"missing value"),Vt(typeof Mn=="boolean","missing or invalid endian"),Vt(Rt!=null,"missing offset"),Vt(Rt+3<Je.length,"trying to write beyond buffer length"),Jt(ot,4294967295));var Rn=Je.length;if(!(Rn<=Rt))for(var hi=0,$n=Math.min(Rn-Rt,4);hi<$n;hi++)Je[Rt+hi]=ot>>>8*(Mn?hi:3-hi)&255}function Qe(Je,ot,Rt,Mn,Pn){Pn||(Vt(ot!=null,"missing value"),Vt(typeof Mn=="boolean","missing or invalid endian"),Vt(Rt!=null,"missing offset"),Vt(Rt+1<Je.length,"Trying to write beyond buffer length"),en(ot,32767,-32768)),Je.length<=Rt||bt(Je,0<=ot?ot:65535+ot+1,Rt,Mn,Pn)}function We(Je,ot,Rt,Mn,Pn){Pn||(Vt(ot!=null,"missing value"),Vt(typeof Mn=="boolean","missing or invalid endian"),Vt(Rt!=null,"missing offset"),Vt(Rt+3<Je.length,"Trying to write beyond buffer length"),en(ot,2147483647,-2147483648)),Je.length<=Rt||Ne(Je,0<=ot?ot:4294967295+ot+1,Rt,Mn,Pn)}function _t(Je,ot,Rt,Mn,Pn){Pn||(Vt(ot!=null,"missing value"),Vt(typeof Mn=="boolean","missing or invalid endian"),Vt(Rt!=null,"missing offset"),Vt(Rt+3<Je.length,"Trying to write beyond buffer length"),Cn(ot,34028234663852886e22,-34028234663852886e22)),Je.length<=Rt||et.write(Je,ot,Rt,Mn,23,4)}function lt(Je,ot,Rt,Mn,Pn){Pn||(Vt(ot!=null,"missing value"),Vt(typeof Mn=="boolean","missing or invalid endian"),Vt(Rt!=null,"missing offset"),Vt(Rt+7<Je.length,"Trying to write beyond buffer length"),Cn(ot,17976931348623157e292,-17976931348623157e292)),Je.length<=Rt||et.write(Je,ot,Rt,Mn,52,8)}_.Buffer=Ue,_.SlowBuffer=Ue,_.INSPECT_MAX_BYTES=50,Ue.poolSize=8192,Ue._useTypedArrays=function(){try{var Je=new ArrayBuffer(0),ot=new Uint8Array(Je);return ot.foo=function(){return 42},ot.foo()===42&&typeof ot.subarray=="function"}catch{return!1}}(),Ue.isEncoding=function(Je){switch(String(Je).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Ue.isBuffer=function(Je){return!(Je==null||!Je._isBuffer)},Ue.byteLength=function(Je,ot){var Rt;switch(Je+="",ot||"utf8"){case"hex":Rt=Je.length/2;break;case"utf8":case"utf-8":Rt=pn(Je).length;break;case"ascii":case"binary":case"raw":Rt=Je.length;break;case"base64":Rt=ln(Je).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Rt=2*Je.length;break;default:throw new Error("Unknown encoding")}return Rt},Ue.concat=function(Je,ot){if(Vt(un(Je),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),Je.length===0)return new Ue(0);if(Je.length===1)return Je[0];if(typeof ot!="number")for(Pn=ot=0;Pn<Je.length;Pn++)ot+=Je[Pn].length;for(var Rt=new Ue(ot),Mn=0,Pn=0;Pn<Je.length;Pn++){var Rn=Je[Pn];Rn.copy(Rt,Mn),Mn+=Rn.length}return Rt},Ue.prototype.write=function(Je,ot,Rt,Mn){var Pn;isFinite(ot)?isFinite(Rt)||(Mn=Rt,Rt=void 0):(Pn=Mn,Mn=ot,ot=Rt,Rt=Pn),ot=Number(ot)||0;var Rn,hi,$n,ji,Li,dr,Ri,$t=this.length-ot;switch((!Rt||$t<(Rt=Number(Rt)))&&(Rt=$t),Mn=String(Mn||"utf8").toLowerCase()){case"hex":Rn=function(ir,or,ms,Rr){ms=Number(ms)||0;var Cr=ir.length-ms;(!Rr||Cr<(Rr=Number(Rr)))&&(Rr=Cr);var Mr=or.length;Vt(Mr%2==0,"Invalid hex string"),Mr/2<Rr&&(Rr=Mr/2);for(var Tr=0;Tr<Rr;Tr++){var Is=parseInt(or.substr(2*Tr,2),16);Vt(!isNaN(Is),"Invalid hex string"),ir[ms+Tr]=Is}return Ue._charsWritten=2*Tr,Tr}(this,Je,ot,Rt);break;case"utf8":case"utf-8":Li=Je,dr=ot,Ri=Rt,Rn=Ue._charsWritten=vn(pn(Li),this,dr,Ri);break;case"ascii":case"binary":Rn=function(ir,or,ms,Rr){return Ue._charsWritten=vn(function(Cr){for(var Mr=[],Tr=0;Tr<Cr.length;Tr++)Mr.push(255&Cr.charCodeAt(Tr));return Mr}(or),ir,ms,Rr)}(this,Je,ot,Rt);break;case"base64":hi=Je,$n=ot,ji=Rt,Rn=Ue._charsWritten=vn(ln(hi),this,$n,ji);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Rn=function(ir,or,ms,Rr){return Ue._charsWritten=vn(function(Cr){for(var Mr,Tr,Is,pr=[],rr=0;rr<Cr.length;rr++)Tr=(Mr=Cr.charCodeAt(rr))>>8,Is=Mr%256,pr.push(Is),pr.push(Tr);return pr}(or),ir,ms,Rr)}(this,Je,ot,Rt);break;default:throw new Error("Unknown encoding")}return Rn},Ue.prototype.toString=function(Je,ot,Rt){var Mn,Pn,Rn,hi,$n=this;if(Je=String(Je||"utf8").toLowerCase(),ot=Number(ot)||0,(Rt=Rt!==void 0?Number(Rt):Rt=$n.length)===ot)return"";switch(Je){case"hex":Mn=function(ji,Li,dr){var Ri=ji.length;(!Li||Li<0)&&(Li=0),(!dr||dr<0||Ri<dr)&&(dr=Ri);for(var $t="",ir=Li;ir<dr;ir++)$t+=Zt(ji[ir]);return $t}($n,ot,Rt);break;case"utf8":case"utf-8":Mn=function(ji,Li,dr){var Ri="",$t="";dr=Math.min(ji.length,dr);for(var ir=Li;ir<dr;ir++)ji[ir]<=127?(Ri+=ht($t)+String.fromCharCode(ji[ir]),$t=""):$t+="%"+ji[ir].toString(16);return Ri+ht($t)}($n,ot,Rt);break;case"ascii":case"binary":Mn=function(ji,Li,dr){var Ri="";dr=Math.min(ji.length,dr);for(var $t=Li;$t<dr;$t++)Ri+=String.fromCharCode(ji[$t]);return Ri}($n,ot,Rt);break;case"base64":Pn=$n,hi=Rt,Mn=(Rn=ot)===0&&hi===Pn.length?Ge.fromByteArray(Pn):Ge.fromByteArray(Pn.slice(Rn,hi));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Mn=function(ji,Li,dr){for(var Ri=ji.slice(Li,dr),$t="",ir=0;ir<Ri.length;ir+=2)$t+=String.fromCharCode(Ri[ir]+256*Ri[ir+1]);return $t}($n,ot,Rt);break;default:throw new Error("Unknown encoding")}return Mn},Ue.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},Ue.prototype.copy=function(Je,ot,Rt,Mn){if(Rt=Rt||0,Mn||Mn===0||(Mn=this.length),ot=ot||0,Mn!==Rt&&Je.length!==0&&this.length!==0){Vt(Rt<=Mn,"sourceEnd < sourceStart"),Vt(0<=ot&&ot<Je.length,"targetStart out of bounds"),Vt(0<=Rt&&Rt<this.length,"sourceStart out of bounds"),Vt(0<=Mn&&Mn<=this.length,"sourceEnd out of bounds"),Mn>this.length&&(Mn=this.length),Je.length-ot<Mn-Rt&&(Mn=Je.length-ot+Rt);var Pn=Mn-Rt;if(Pn<100||!Ue._useTypedArrays)for(var Rn=0;Rn<Pn;Rn++)Je[Rn+ot]=this[Rn+Rt];else Je._set(this.subarray(Rt,Rt+Pn),ot)}},Ue.prototype.slice=function(Je,ot){var Rt=this.length;if(Je=dn(Je,Rt,0),ot=dn(ot,Rt,Rt),Ue._useTypedArrays)return Ue._augment(this.subarray(Je,ot));for(var Mn=ot-Je,Pn=new Ue(Mn,void 0,!0),Rn=0;Rn<Mn;Rn++)Pn[Rn]=this[Rn+Je];return Pn},Ue.prototype.get=function(Je){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(Je)},Ue.prototype.set=function(Je,ot){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(Je,ot)},Ue.prototype.readUInt8=function(Je,ot){if(ot||(Vt(Je!=null,"missing offset"),Vt(Je<this.length,"Trying to read beyond buffer length")),!(Je>=this.length))return this[Je]},Ue.prototype.readUInt16LE=function(Je,ot){return nt(this,Je,!0,ot)},Ue.prototype.readUInt16BE=function(Je,ot){return nt(this,Je,!1,ot)},Ue.prototype.readUInt32LE=function(Je,ot){return He(this,Je,!0,ot)},Ue.prototype.readUInt32BE=function(Je,ot){return He(this,Je,!1,ot)},Ue.prototype.readInt8=function(Je,ot){if(ot||(Vt(Je!=null,"missing offset"),Vt(Je<this.length,"Trying to read beyond buffer length")),!(Je>=this.length))return 128&this[Je]?-1*(255-this[Je]+1):this[Je]},Ue.prototype.readInt16LE=function(Je,ot){return Ze(this,Je,!0,ot)},Ue.prototype.readInt16BE=function(Je,ot){return Ze(this,Je,!1,ot)},Ue.prototype.readInt32LE=function(Je,ot){return st(this,Je,!0,ot)},Ue.prototype.readInt32BE=function(Je,ot){return st(this,Je,!1,ot)},Ue.prototype.readFloatLE=function(Je,ot){return Et(this,Je,!0,ot)},Ue.prototype.readFloatBE=function(Je,ot){return Et(this,Je,!1,ot)},Ue.prototype.readDoubleLE=function(Je,ot){return rt(this,Je,!0,ot)},Ue.prototype.readDoubleBE=function(Je,ot){return rt(this,Je,!1,ot)},Ue.prototype.writeUInt8=function(Je,ot,Rt){Rt||(Vt(Je!=null,"missing value"),Vt(ot!=null,"missing offset"),Vt(ot<this.length,"trying to write beyond buffer length"),Jt(Je,255)),ot>=this.length||(this[ot]=Je)},Ue.prototype.writeUInt16LE=function(Je,ot,Rt){bt(this,Je,ot,!0,Rt)},Ue.prototype.writeUInt16BE=function(Je,ot,Rt){bt(this,Je,ot,!1,Rt)},Ue.prototype.writeUInt32LE=function(Je,ot,Rt){Ne(this,Je,ot,!0,Rt)},Ue.prototype.writeUInt32BE=function(Je,ot,Rt){Ne(this,Je,ot,!1,Rt)},Ue.prototype.writeInt8=function(Je,ot,Rt){Rt||(Vt(Je!=null,"missing value"),Vt(ot!=null,"missing offset"),Vt(ot<this.length,"Trying to write beyond buffer length"),en(Je,127,-128)),ot>=this.length||(0<=Je?this.writeUInt8(Je,ot,Rt):this.writeUInt8(255+Je+1,ot,Rt))},Ue.prototype.writeInt16LE=function(Je,ot,Rt){Qe(this,Je,ot,!0,Rt)},Ue.prototype.writeInt16BE=function(Je,ot,Rt){Qe(this,Je,ot,!1,Rt)},Ue.prototype.writeInt32LE=function(Je,ot,Rt){We(this,Je,ot,!0,Rt)},Ue.prototype.writeInt32BE=function(Je,ot,Rt){We(this,Je,ot,!1,Rt)},Ue.prototype.writeFloatLE=function(Je,ot,Rt){_t(this,Je,ot,!0,Rt)},Ue.prototype.writeFloatBE=function(Je,ot,Rt){_t(this,Je,ot,!1,Rt)},Ue.prototype.writeDoubleLE=function(Je,ot,Rt){lt(this,Je,ot,!0,Rt)},Ue.prototype.writeDoubleBE=function(Je,ot,Rt){lt(this,Je,ot,!1,Rt)},Ue.prototype.fill=function(Je,ot,Rt){if(Je=Je||0,ot=ot||0,Rt=Rt||this.length,typeof Je=="string"&&(Je=Je.charCodeAt(0)),Vt(typeof Je=="number"&&!isNaN(Je),"value is not a number"),Vt(ot<=Rt,"end < start"),Rt!==ot&&this.length!==0){Vt(0<=ot&&ot<this.length,"start out of bounds"),Vt(0<=Rt&&Rt<=this.length,"end out of bounds");for(var Mn=ot;Mn<Rt;Mn++)this[Mn]=Je}},Ue.prototype.inspect=function(){for(var Je=[],ot=this.length,Rt=0;Rt<ot;Rt++)if(Je[Rt]=Zt(this[Rt]),Rt===_.INSPECT_MAX_BYTES){Je[Rt+1]="...";break}return"<Buffer "+Je.join(" ")+">"},Ue.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(Ue._useTypedArrays)return new Ue(this).buffer;for(var Je=new Uint8Array(this.length),ot=0,Rt=Je.length;ot<Rt;ot+=1)Je[ot]=this[ot];return Je.buffer};var Ut=Ue.prototype;function dn(Je,ot,Rt){return typeof Je!="number"?Rt:ot<=(Je=~~Je)?ot:0<=Je||0<=(Je+=ot)?Je:0}function nn(Je){return(Je=~~Math.ceil(+Je))<0?0:Je}function un(Je){return(Array.isArray||function(ot){return Object.prototype.toString.call(ot)==="[object Array]"})(Je)}function Zt(Je){return Je<16?"0"+Je.toString(16):Je.toString(16)}function pn(Je){for(var ot=[],Rt=0;Rt<Je.length;Rt++){var Mn=Je.charCodeAt(Rt);if(Mn<=127)ot.push(Je.charCodeAt(Rt));else{var Pn=Rt;55296<=Mn&&Mn<=57343&&Rt++;for(var Rn=encodeURIComponent(Je.slice(Pn,Rt+1)).substr(1).split("%"),hi=0;hi<Rn.length;hi++)ot.push(parseInt(Rn[hi],16))}}return ot}function ln(Je){return Ge.toByteArray(Je)}function vn(Je,ot,Rt,Mn){for(var Pn=0;Pn<Mn&&!(Pn+Rt>=ot.length||Pn>=Je.length);Pn++)ot[Pn+Rt]=Je[Pn];return Pn}function ht(Je){try{return decodeURIComponent(Je)}catch{return String.fromCharCode(65533)}}function Jt(Je,ot){Vt(typeof Je=="number","cannot write a non-number as a number"),Vt(0<=Je,"specified a negative value for writing an unsigned value"),Vt(Je<=ot,"value is larger than maximum value for type"),Vt(Math.floor(Je)===Je,"value has a fractional component")}function en(Je,ot,Rt){Vt(typeof Je=="number","cannot write a non-number as a number"),Vt(Je<=ot,"value larger than maximum allowed value"),Vt(Rt<=Je,"value smaller than minimum allowed value"),Vt(Math.floor(Je)===Je,"value has a fractional component")}function Cn(Je,ot,Rt){Vt(typeof Je=="number","cannot write a non-number as a number"),Vt(Je<=ot,"value larger than maximum allowed value"),Vt(Rt<=Je,"value smaller than minimum allowed value")}function Vt(Je,ot){if(!Je)throw new Error(ot||"Failed assertion")}Ue._augment=function(Je){return Je._isBuffer=!0,Je._get=Je.get,Je._set=Je.set,Je.get=Ut.get,Je.set=Ut.set,Je.write=Ut.write,Je.toString=Ut.toString,Je.toLocaleString=Ut.toString,Je.toJSON=Ut.toJSON,Je.copy=Ut.copy,Je.slice=Ut.slice,Je.readUInt8=Ut.readUInt8,Je.readUInt16LE=Ut.readUInt16LE,Je.readUInt16BE=Ut.readUInt16BE,Je.readUInt32LE=Ut.readUInt32LE,Je.readUInt32BE=Ut.readUInt32BE,Je.readInt8=Ut.readInt8,Je.readInt16LE=Ut.readInt16LE,Je.readInt16BE=Ut.readInt16BE,Je.readInt32LE=Ut.readInt32LE,Je.readInt32BE=Ut.readInt32BE,Je.readFloatLE=Ut.readFloatLE,Je.readFloatBE=Ut.readFloatBE,Je.readDoubleLE=Ut.readDoubleLE,Je.readDoubleBE=Ut.readDoubleBE,Je.writeUInt8=Ut.writeUInt8,Je.writeUInt16LE=Ut.writeUInt16LE,Je.writeUInt16BE=Ut.writeUInt16BE,Je.writeUInt32LE=Ut.writeUInt32LE,Je.writeUInt32BE=Ut.writeUInt32BE,Je.writeInt8=Ut.writeInt8,Je.writeInt16LE=Ut.writeInt16LE,Je.writeInt16BE=Ut.writeInt16BE,Je.writeInt32LE=Ut.writeInt32LE,Je.writeInt32BE=Ut.writeInt32BE,Je.writeFloatLE=Ut.writeFloatLE,Je.writeFloatBE=Ut.writeFloatBE,Je.writeDoubleLE=Ut.writeDoubleLE,Je.writeDoubleBE=Ut.writeDoubleBE,Je.fill=Ut.fill,Je.inspect=Ut.inspect,Je.toArrayBuffer=Ut.toArrayBuffer,Je}}).call(this,te("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},te("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:11,lYpoI2:10}],4:[function(te,oe,_){(function(ae,ve,we,Me,ke,Le,Ye,tt,Ke){we=te("buffer").Buffer;var Ge=new we(4);Ge.fill(0),oe.exports={hash:function(et,Ue,nt,He){return we.isBuffer(et)||(et=new we(et)),function(Ze,st,Et){for(var rt=new we(st),bt=Et?rt.writeInt32BE:rt.writeInt32LE,Ne=0;Ne<Ze.length;Ne++)bt.call(rt,Ze[Ne],4*Ne,!0);return rt}(Ue(function(Ze,st){var Et;Ze.length%4!=0&&(Et=Ze.length+(4-Ze.length%4),Ze=we.concat([Ze,Ge],Et));for(var rt=[],bt=st?Ze.readInt32BE:Ze.readInt32LE,Ne=0;Ne<Ze.length;Ne+=4)rt.push(bt.call(Ze,Ne));return rt}(et,He),8*et.length),nt,He)}}}).call(this,te("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},te("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],5:[function(te,oe,_){(function(ae,ve,we,Me,ke,Le,Ye,tt,Ke){we=te("buffer").Buffer;var Ge=te("./sha"),et=te("./sha256"),Ue=te("./rng"),nt={sha1:Ge,sha256:et,md5:te("./md5")},He=64,Ze=new we(He);function st(rt,bt){var Ne=nt[rt=rt||"sha1"],Qe=[];return Ne||Et("algorithm:",rt,"is not yet supported"),{update:function(We){return we.isBuffer(We)||(We=new we(We)),Qe.push(We),We.length,this},digest:function(We){var _t=we.concat(Qe),lt=bt?function(Ut,dn,nn){we.isBuffer(dn)||(dn=new we(dn)),we.isBuffer(nn)||(nn=new we(nn)),dn.length>He?dn=Ut(dn):dn.length<He&&(dn=we.concat([dn,Ze],He));for(var un=new we(He),Zt=new we(He),pn=0;pn<He;pn++)un[pn]=54^dn[pn],Zt[pn]=92^dn[pn];var ln=Ut(we.concat([un,nn]));return Ut(we.concat([Zt,ln]))}(Ne,bt,_t):Ne(_t);return Qe=null,We?lt.toString(We):lt}}}function Et(){var rt=[].slice.call(arguments).join(" ");throw new Error([rt,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}Ze.fill(0),_.createHash=function(rt){return st(rt)},_.createHmac=st,_.randomBytes=function(rt,bt){if(!bt||!bt.call)return new we(Ue(rt));try{bt.call(this,void 0,new we(Ue(rt)))}catch(Ne){bt(Ne)}},function(rt,bt){for(var Ne in rt)bt(rt[Ne])}(["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],function(rt){_[rt]=function(){Et("sorry,",rt,"is not implemented yet")}})}).call(this,te("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},te("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:10}],6:[function(te,oe,_){(function(ae,ve,we,Me,ke,Le,Ye,tt,Ke){var Ge=te("./helpers");function et(rt,bt){rt[bt>>5]|=128<<bt%32,rt[14+(bt+64>>>9<<4)]=bt;for(var Ne=1732584193,Qe=-271733879,We=-1732584194,_t=271733878,lt=0;lt<rt.length;lt+=16){var Ut=Ne,dn=Qe,nn=We,un=_t;Ne=nt(Ne,Qe,We,_t,rt[lt+0],7,-680876936),_t=nt(_t,Ne,Qe,We,rt[lt+1],12,-389564586),We=nt(We,_t,Ne,Qe,rt[lt+2],17,606105819),Qe=nt(Qe,We,_t,Ne,rt[lt+3],22,-1044525330),Ne=nt(Ne,Qe,We,_t,rt[lt+4],7,-176418897),_t=nt(_t,Ne,Qe,We,rt[lt+5],12,1200080426),We=nt(We,_t,Ne,Qe,rt[lt+6],17,-1473231341),Qe=nt(Qe,We,_t,Ne,rt[lt+7],22,-45705983),Ne=nt(Ne,Qe,We,_t,rt[lt+8],7,1770035416),_t=nt(_t,Ne,Qe,We,rt[lt+9],12,-1958414417),We=nt(We,_t,Ne,Qe,rt[lt+10],17,-42063),Qe=nt(Qe,We,_t,Ne,rt[lt+11],22,-1990404162),Ne=nt(Ne,Qe,We,_t,rt[lt+12],7,1804603682),_t=nt(_t,Ne,Qe,We,rt[lt+13],12,-40341101),We=nt(We,_t,Ne,Qe,rt[lt+14],17,-1502002290),Ne=He(Ne,Qe=nt(Qe,We,_t,Ne,rt[lt+15],22,1236535329),We,_t,rt[lt+1],5,-165796510),_t=He(_t,Ne,Qe,We,rt[lt+6],9,-1069501632),We=He(We,_t,Ne,Qe,rt[lt+11],14,643717713),Qe=He(Qe,We,_t,Ne,rt[lt+0],20,-373897302),Ne=He(Ne,Qe,We,_t,rt[lt+5],5,-701558691),_t=He(_t,Ne,Qe,We,rt[lt+10],9,38016083),We=He(We,_t,Ne,Qe,rt[lt+15],14,-660478335),Qe=He(Qe,We,_t,Ne,rt[lt+4],20,-405537848),Ne=He(Ne,Qe,We,_t,rt[lt+9],5,568446438),_t=He(_t,Ne,Qe,We,rt[lt+14],9,-1019803690),We=He(We,_t,Ne,Qe,rt[lt+3],14,-187363961),Qe=He(Qe,We,_t,Ne,rt[lt+8],20,1163531501),Ne=He(Ne,Qe,We,_t,rt[lt+13],5,-1444681467),_t=He(_t,Ne,Qe,We,rt[lt+2],9,-51403784),We=He(We,_t,Ne,Qe,rt[lt+7],14,1735328473),Ne=Ze(Ne,Qe=He(Qe,We,_t,Ne,rt[lt+12],20,-1926607734),We,_t,rt[lt+5],4,-378558),_t=Ze(_t,Ne,Qe,We,rt[lt+8],11,-2022574463),We=Ze(We,_t,Ne,Qe,rt[lt+11],16,1839030562),Qe=Ze(Qe,We,_t,Ne,rt[lt+14],23,-35309556),Ne=Ze(Ne,Qe,We,_t,rt[lt+1],4,-1530992060),_t=Ze(_t,Ne,Qe,We,rt[lt+4],11,1272893353),We=Ze(We,_t,Ne,Qe,rt[lt+7],16,-155497632),Qe=Ze(Qe,We,_t,Ne,rt[lt+10],23,-1094730640),Ne=Ze(Ne,Qe,We,_t,rt[lt+13],4,681279174),_t=Ze(_t,Ne,Qe,We,rt[lt+0],11,-358537222),We=Ze(We,_t,Ne,Qe,rt[lt+3],16,-722521979),Qe=Ze(Qe,We,_t,Ne,rt[lt+6],23,76029189),Ne=Ze(Ne,Qe,We,_t,rt[lt+9],4,-640364487),_t=Ze(_t,Ne,Qe,We,rt[lt+12],11,-421815835),We=Ze(We,_t,Ne,Qe,rt[lt+15],16,530742520),Ne=st(Ne,Qe=Ze(Qe,We,_t,Ne,rt[lt+2],23,-995338651),We,_t,rt[lt+0],6,-198630844),_t=st(_t,Ne,Qe,We,rt[lt+7],10,1126891415),We=st(We,_t,Ne,Qe,rt[lt+14],15,-1416354905),Qe=st(Qe,We,_t,Ne,rt[lt+5],21,-57434055),Ne=st(Ne,Qe,We,_t,rt[lt+12],6,1700485571),_t=st(_t,Ne,Qe,We,rt[lt+3],10,-1894986606),We=st(We,_t,Ne,Qe,rt[lt+10],15,-1051523),Qe=st(Qe,We,_t,Ne,rt[lt+1],21,-2054922799),Ne=st(Ne,Qe,We,_t,rt[lt+8],6,1873313359),_t=st(_t,Ne,Qe,We,rt[lt+15],10,-30611744),We=st(We,_t,Ne,Qe,rt[lt+6],15,-1560198380),Qe=st(Qe,We,_t,Ne,rt[lt+13],21,1309151649),Ne=st(Ne,Qe,We,_t,rt[lt+4],6,-145523070),_t=st(_t,Ne,Qe,We,rt[lt+11],10,-1120210379),We=st(We,_t,Ne,Qe,rt[lt+2],15,718787259),Qe=st(Qe,We,_t,Ne,rt[lt+9],21,-343485551),Ne=Et(Ne,Ut),Qe=Et(Qe,dn),We=Et(We,nn),_t=Et(_t,un)}return Array(Ne,Qe,We,_t)}function Ue(rt,bt,Ne,Qe,We,_t){return Et((lt=Et(Et(bt,rt),Et(Qe,_t)))<<(Ut=We)|lt>>>32-Ut,Ne);var lt,Ut}function nt(rt,bt,Ne,Qe,We,_t,lt){return Ue(bt&Ne|~bt&Qe,rt,bt,We,_t,lt)}function He(rt,bt,Ne,Qe,We,_t,lt){return Ue(bt&Qe|Ne&~Qe,rt,bt,We,_t,lt)}function Ze(rt,bt,Ne,Qe,We,_t,lt){return Ue(bt^Ne^Qe,rt,bt,We,_t,lt)}function st(rt,bt,Ne,Qe,We,_t,lt){return Ue(Ne^(bt|~Qe),rt,bt,We,_t,lt)}function Et(rt,bt){var Ne=(65535&rt)+(65535&bt);return(rt>>16)+(bt>>16)+(Ne>>16)<<16|65535&Ne}oe.exports=function(rt){return Ge.hash(rt,et,16)}}).call(this,te("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},te("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],7:[function(te,oe,_){(function(ae,ve,we,Me,ke,Le,Ye,tt,Ke){var Ge;Ge=function(et){for(var Ue,nt=new Array(et),He=0;He<et;He++)!(3&He)&&(Ue=4294967296*Math.random()),nt[He]=Ue>>>((3&He)<<3)&255;return nt},oe.exports=Ge}).call(this,te("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},te("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],8:[function(te,oe,_){(function(ae,ve,we,Me,ke,Le,Ye,tt,Ke){var Ge=te("./helpers");function et(He,Ze){He[Ze>>5]|=128<<24-Ze%32,He[15+(Ze+64>>9<<4)]=Ze;for(var st,Et,rt,bt,Ne,Qe=Array(80),We=1732584193,_t=-271733879,lt=-1732584194,Ut=271733878,dn=-1009589776,nn=0;nn<He.length;nn+=16){for(var un=We,Zt=_t,pn=lt,ln=Ut,vn=dn,ht=0;ht<80;ht++){Qe[ht]=ht<16?He[nn+ht]:nt(Qe[ht-3]^Qe[ht-8]^Qe[ht-14]^Qe[ht-16],1);var Jt=Ue(Ue(nt(We,5),(rt=_t,bt=lt,Ne=Ut,(Et=ht)<20?rt&bt|~rt&Ne:!(Et<40)&&Et<60?rt&bt|rt&Ne|bt&Ne:rt^bt^Ne)),Ue(Ue(dn,Qe[ht]),(st=ht)<20?1518500249:st<40?1859775393:st<60?-1894007588:-899497514));dn=Ut,Ut=lt,lt=nt(_t,30),_t=We,We=Jt}We=Ue(We,un),_t=Ue(_t,Zt),lt=Ue(lt,pn),Ut=Ue(Ut,ln),dn=Ue(dn,vn)}return Array(We,_t,lt,Ut,dn)}function Ue(He,Ze){var st=(65535&He)+(65535&Ze);return(He>>16)+(Ze>>16)+(st>>16)<<16|65535&st}function nt(He,Ze){return He<<Ze|He>>>32-Ze}oe.exports=function(He){return Ge.hash(He,et,20,!0)}}).call(this,te("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},te("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],9:[function(te,oe,_){(function(ae,ve,we,Me,ke,Le,Ye,tt,Ke){function Ge(He,Ze){var st=(65535&He)+(65535&Ze);return(He>>16)+(Ze>>16)+(st>>16)<<16|65535&st}function et(He,Ze){return He>>>Ze|He<<32-Ze}function Ue(He,Ze){var st,Et,rt,bt,Ne,Qe,We,_t,lt,Ut,dn=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),nn=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),un=new Array(64);He[Ze>>5]|=128<<24-Ze%32,He[15+(Ze+64>>9<<4)]=Ze;for(var Zt,pn,ln,vn,ht,Jt,en,Cn,Vt=0;Vt<He.length;Vt+=16){st=nn[0],Et=nn[1],rt=nn[2],bt=nn[3],Ne=nn[4],Qe=nn[5],We=nn[6],_t=nn[7];for(var Je=0;Je<64;Je++)un[Je]=Je<16?He[Je+Vt]:Ge(Ge(Ge(et(Cn=un[Je-2],17)^et(Cn,19)^Cn>>>10,un[Je-7]),et(en=un[Je-15],7)^et(en,18)^en>>>3),un[Je-16]),lt=Ge(Ge(Ge(Ge(_t,et(Jt=Ne,6)^et(Jt,11)^et(Jt,25)),(ht=Ne)&Qe^~ht&We),dn[Je]),un[Je]),Ut=Ge(et(vn=st,2)^et(vn,13)^et(vn,22),(Zt=st)&(pn=Et)^Zt&(ln=rt)^pn&ln),_t=We,We=Qe,Qe=Ne,Ne=Ge(bt,lt),bt=rt,rt=Et,Et=st,st=Ge(lt,Ut);nn[0]=Ge(st,nn[0]),nn[1]=Ge(Et,nn[1]),nn[2]=Ge(rt,nn[2]),nn[3]=Ge(bt,nn[3]),nn[4]=Ge(Ne,nn[4]),nn[5]=Ge(Qe,nn[5]),nn[6]=Ge(We,nn[6]),nn[7]=Ge(_t,nn[7])}return nn}var nt=te("./helpers");oe.exports=function(He){return nt.hash(He,Ue,32,!0)}}).call(this,te("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},te("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],10:[function(te,oe,_){(function(ae,ve,we,Me,ke,Le,Ye,tt,Ke){function Ge(){}(ae=oe.exports={}).nextTick=function(){var et=typeof window<"u"&&window.setImmediate,Ue=typeof window<"u"&&window.postMessage&&window.addEventListener;if(et)return function(He){return window.setImmediate(He)};if(Ue){var nt=[];return window.addEventListener("message",function(He){var Ze=He.source;Ze!==window&&Ze!==null||He.data!=="process-tick"||(He.stopPropagation(),0<nt.length&&nt.shift()())},!0),function(He){nt.push(He),window.postMessage("process-tick","*")}}return function(He){setTimeout(He,0)}}(),ae.title="browser",ae.browser=!0,ae.env={},ae.argv=[],ae.on=Ge,ae.addListener=Ge,ae.once=Ge,ae.off=Ge,ae.removeListener=Ge,ae.removeAllListeners=Ge,ae.emit=Ge,ae.binding=function(et){throw new Error("process.binding is not supported")},ae.cwd=function(){return"/"},ae.chdir=function(et){throw new Error("process.chdir is not supported")}}).call(this,te("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},te("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:10}],11:[function(te,oe,_){(function(ae,ve,we,Me,ke,Le,Ye,tt,Ke){_.read=function(Ge,et,Ue,nt,He){var Ze,st,Et=8*He-nt-1,rt=(1<<Et)-1,bt=rt>>1,Ne=-7,Qe=Ue?He-1:0,We=Ue?-1:1,_t=Ge[et+Qe];for(Qe+=We,Ze=_t&(1<<-Ne)-1,_t>>=-Ne,Ne+=Et;0<Ne;Ze=256*Ze+Ge[et+Qe],Qe+=We,Ne-=8);for(st=Ze&(1<<-Ne)-1,Ze>>=-Ne,Ne+=nt;0<Ne;st=256*st+Ge[et+Qe],Qe+=We,Ne-=8);if(Ze===0)Ze=1-bt;else{if(Ze===rt)return st?NaN:1/0*(_t?-1:1);st+=Math.pow(2,nt),Ze-=bt}return(_t?-1:1)*st*Math.pow(2,Ze-nt)},_.write=function(Ge,et,Ue,nt,He,Ze){var st,Et,rt,bt=8*Ze-He-1,Ne=(1<<bt)-1,Qe=Ne>>1,We=He===23?Math.pow(2,-24)-Math.pow(2,-77):0,_t=nt?0:Ze-1,lt=nt?1:-1,Ut=et<0||et===0&&1/et<0?1:0;for(et=Math.abs(et),isNaN(et)||et===1/0?(Et=isNaN(et)?1:0,st=Ne):(st=Math.floor(Math.log(et)/Math.LN2),et*(rt=Math.pow(2,-st))<1&&(st--,rt*=2),2<=(et+=1<=st+Qe?We/rt:We*Math.pow(2,1-Qe))*rt&&(st++,rt/=2),Ne<=st+Qe?(Et=0,st=Ne):1<=st+Qe?(Et=(et*rt-1)*Math.pow(2,He),st+=Qe):(Et=et*Math.pow(2,Qe-1)*Math.pow(2,He),st=0));8<=He;Ge[Ue+_t]=255&Et,_t+=lt,Et/=256,He-=8);for(st=st<<He|Et,bt+=He;0<bt;Ge[Ue+_t]=255&st,_t+=lt,st/=256,bt-=8);Ge[Ue+_t-lt]|=128*Ut}}).call(this,te("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},te("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/ieee754/index.js","/node_modules/ieee754")},{buffer:3,lYpoI2:10}]},{},[1])(1)},654:function(Te){var te=function(){function oe(Ue){return Ye(Ue,tt(Le(Ke(Ue.length),Ue),1/Ue.length))}function _(Ue){return Le(Ge(Ue),Ue)}function ae(Ue,nt){return tt(Ue,nt?1/(Ue.length-1):1/Ue.length)}function ve(Ue){var nt=function(Ze){var st,Et=Math.pow(2,-52),rt=1e-64/Et,bt=0,Ne=0,Qe=0,We=0,_t=0,lt=et(Ze),Ut=lt.length,dn=lt[0].length;if(Ut<dn)throw"Need more rows than columns";var nn=new Array(dn),un=new Array(dn);for(Ne=0;Ne<dn;Ne++)nn[Ne]=un[Ne]=0;var Zt=function Mn(Pn,Rn,hi){hi===void 0&&(hi=0);var $n,ji=Pn[hi],Li=Array(ji);if(hi===Pn.length-1){for($n=ji-2;$n>=0;$n-=2)Li[$n+1]=Rn,Li[$n]=Rn;return $n===-1&&(Li[0]=Rn),Li}for($n=ji-1;$n>=0;$n--)Li[$n]=Mn(Pn,Rn,hi+1);return Li}([dn,dn],0);function pn(Mn,Pn){return(Mn=Math.abs(Mn))>(Pn=Math.abs(Pn))?Mn*Math.sqrt(1+Pn*Pn/Mn/Mn):Pn==0?Mn:Pn*Math.sqrt(1+Mn*Mn/Pn/Pn)}var ln=0,vn=0,ht=0,Jt=0,en=0,Cn=0,Vt=0;for(Ne=0;Ne<dn;Ne++){for(nn[Ne]=vn,Vt=0,_t=Ne+1,Qe=Ne;Qe<Ut;Qe++)Vt+=lt[Qe][Ne]*lt[Qe][Ne];if(Vt<=rt)vn=0;else for(ln=lt[Ne][Ne],vn=Math.sqrt(Vt),ln>=0&&(vn=-vn),ht=ln*vn-Vt,lt[Ne][Ne]=ln-vn,Qe=_t;Qe<dn;Qe++){for(Vt=0,We=Ne;We<Ut;We++)Vt+=lt[We][Ne]*lt[We][Qe];for(ln=Vt/ht,We=Ne;We<Ut;We++)lt[We][Qe]+=ln*lt[We][Ne]}for(un[Ne]=vn,Vt=0,Qe=_t;Qe<dn;Qe++)Vt+=lt[Ne][Qe]*lt[Ne][Qe];if(Vt<=rt)vn=0;else{for(ln=lt[Ne][Ne+1],vn=Math.sqrt(Vt),ln>=0&&(vn=-vn),ht=ln*vn-Vt,lt[Ne][Ne+1]=ln-vn,Qe=_t;Qe<dn;Qe++)nn[Qe]=lt[Ne][Qe]/ht;for(Qe=_t;Qe<Ut;Qe++){for(Vt=0,We=_t;We<dn;We++)Vt+=lt[Qe][We]*lt[Ne][We];for(We=_t;We<dn;We++)lt[Qe][We]+=Vt*nn[We]}}(en=Math.abs(un[Ne])+Math.abs(nn[Ne]))>Jt&&(Jt=en)}for(Ne=dn-1;Ne!=-1;Ne+=-1){if(vn!=0){for(ht=vn*lt[Ne][Ne+1],Qe=_t;Qe<dn;Qe++)Zt[Qe][Ne]=lt[Ne][Qe]/ht;for(Qe=_t;Qe<dn;Qe++){for(Vt=0,We=_t;We<dn;We++)Vt+=lt[Ne][We]*Zt[We][Qe];for(We=_t;We<dn;We++)Zt[We][Qe]+=Vt*Zt[We][Ne]}}for(Qe=_t;Qe<dn;Qe++)Zt[Ne][Qe]=0,Zt[Qe][Ne]=0;Zt[Ne][Ne]=1,vn=nn[Ne],_t=Ne}for(Ne=dn-1;Ne!=-1;Ne+=-1){for(_t=Ne+1,vn=un[Ne],Qe=_t;Qe<dn;Qe++)lt[Ne][Qe]=0;if(vn!=0){for(ht=lt[Ne][Ne]*vn,Qe=_t;Qe<dn;Qe++){for(Vt=0,We=_t;We<Ut;We++)Vt+=lt[We][Ne]*lt[We][Qe];for(ln=Vt/ht,We=Ne;We<Ut;We++)lt[We][Qe]+=ln*lt[We][Ne]}for(Qe=Ne;Qe<Ut;Qe++)lt[Qe][Ne]=lt[Qe][Ne]/vn}else for(Qe=Ne;Qe<Ut;Qe++)lt[Qe][Ne]=0;lt[Ne][Ne]+=1}for(Et*=Jt,We=dn-1;We!=-1;We+=-1)for(var Je=0;Je<50;Je++){var ot=!1;for(_t=We;_t!=-1;_t+=-1){if(Math.abs(nn[_t])<=Et){ot=!0;break}if(Math.abs(un[_t-1])<=Et)break}if(!ot){bt=0,Vt=1;var Rt=_t-1;for(Ne=_t;Ne<We+1&&(ln=Vt*nn[Ne],nn[Ne]=bt*nn[Ne],!(Math.abs(ln)<=Et));Ne++)for(ht=pn(ln,vn=un[Ne]),un[Ne]=ht,bt=vn/ht,Vt=-ln/ht,Qe=0;Qe<Ut;Qe++)en=lt[Qe][Rt],Cn=lt[Qe][Ne],lt[Qe][Rt]=en*bt+Cn*Vt,lt[Qe][Ne]=-en*Vt+Cn*bt}if(Cn=un[We],_t==We){if(Cn<0)for(un[We]=-Cn,Qe=0;Qe<dn;Qe++)Zt[Qe][We]=-Zt[Qe][We];break}if(Je>=49)throw"Error: no convergence.";for(Jt=un[_t],vn=pn(ln=(((en=un[We-1])-Cn)*(en+Cn)+((vn=nn[We-1])-(ht=nn[We]))*(vn+ht))/(2*ht*en),1),ln=ln<0?((Jt-Cn)*(Jt+Cn)+ht*(en/(ln-vn)-ht))/Jt:((Jt-Cn)*(Jt+Cn)+ht*(en/(ln+vn)-ht))/Jt,bt=1,Vt=1,Ne=_t+1;Ne<We+1;Ne++){for(vn=nn[Ne],en=un[Ne],ht=Vt*vn,vn*=bt,Cn=pn(ln,ht),nn[Ne-1]=Cn,ln=Jt*(bt=ln/Cn)+vn*(Vt=ht/Cn),vn=-Jt*Vt+vn*bt,ht=en*Vt,en*=bt,Qe=0;Qe<dn;Qe++)Jt=Zt[Qe][Ne-1],Cn=Zt[Qe][Ne],Zt[Qe][Ne-1]=Jt*bt+Cn*Vt,Zt[Qe][Ne]=-Jt*Vt+Cn*bt;for(Cn=pn(ln,ht),un[Ne-1]=Cn,ln=(bt=ln/Cn)*vn+(Vt=ht/Cn)*en,Jt=-Vt*vn+bt*en,Qe=0;Qe<Ut;Qe++)en=lt[Qe][Ne-1],Cn=lt[Qe][Ne],lt[Qe][Ne-1]=en*bt+Cn*Vt,lt[Qe][Ne]=-en*Vt+Cn*bt}nn[_t]=0,nn[We]=ln,un[We]=Jt}for(Ne=0;Ne<un.length;Ne++)un[Ne]<Et&&(un[Ne]=0);for(Ne=0;Ne<dn;Ne++)for(Qe=Ne-1;Qe>=0;Qe--)if(un[Qe]<un[Ne]){for(bt=un[Qe],un[Qe]=un[Ne],un[Ne]=bt,We=0;We<lt.length;We++)st=lt[We][Ne],lt[We][Ne]=lt[We][Qe],lt[We][Qe]=st;for(We=0;We<Zt.length;We++)st=Zt[We][Ne],Zt[We][Ne]=Zt[We][Qe],Zt[We][Qe]=st;Ne=Qe}return{U:lt,S:un,V:Zt}}(Ue);console.log(nt);var He=nt.U;return nt.S.map(function(Ze,st){var Et={};return Et.eigenvalue=Ze,Et.vector=He.map(function(rt,bt){return-1*rt[st]}),Et})}function we(Ue,...nt){var He=nt.map(function(Et){return Et.vector}),Ze=Le(He,Ge(oe(Ue))),st=tt(Le(Ke(Ue.length),Ue),-1/Ue.length);return{adjustedData:Ze,formattedAdjustedData:ke(Ze,2),avgData:st,selectedVectors:He}}function Me(Ue){return ve(ae(_(oe(Ue)),!1))}function ke(Ue,nt){var He=Math.pow(10,nt||2);return Ue.map(function(Ze,st){return Ze.map(function(Et){return Math.round(Et*He)/He})})}function Le(Ue,nt){if(!(Ue[0]&&nt[0]&&Ue.length&&nt.length))throw new Error("Both A and B should be matrices");if(nt.length!==Ue[0].length)throw new Error("Columns in A should be the same as the number of rows in B");for(var He=[],Ze=0;Ze<Ue.length;Ze++){He[Ze]=[];for(var st=0;st<nt[0].length;st++)for(var Et=0;Et<Ue[0].length;Et++)He[Ze][st]=He[Ze][st]?He[Ze][st]+Ue[Ze][Et]*nt[Et][st]:Ue[Ze][Et]*nt[Et][st]}return He}function Ye(Ue,nt){if(Ue.length!==nt.length||Ue[0].length!==nt[0].length)throw new Error("Both A and B should have the same dimensions");for(var He=[],Ze=0;Ze<Ue.length;Ze++){He[Ze]=[];for(var st=0;st<nt[0].length;st++)He[Ze][st]=Ue[Ze][st]-nt[Ze][st]}return He}function tt(Ue,nt){for(var He=[],Ze=0;Ze<Ue.length;Ze++){He[Ze]=[];for(var st=0;st<Ue[0].length;st++)He[Ze][st]=Ue[Ze][st]*nt}return He}function Ke(Ue){for(var nt=[],He=0;He<Ue;He++){nt[He]=[];for(var Ze=0;Ze<Ue;Ze++)nt[He][Ze]=1}return nt}function Ge(Ue){return et(Ue)[0].map(function(nt,He){return Ue.map(function(Ze){return Ze[He]})})}function et(Ue){var nt=JSON.stringify(Ue);return JSON.parse(nt)}return{computeDeviationScores:_,computeDeviationMatrix:oe,computeSVD:ve,computePercentageExplained:function(Ue,...nt){var He=Ue.map(function(Ze){return Ze.eigenvalue}).reduce(function(Ze,st){return Ze+st});return nt.map(function(Ze){return Ze.eigenvalue}).reduce(function(Ze,st){return Ze+st})/He},computeOriginalData:function(Ue,nt,He){var Ze=Ye(Ge(Le(Ge(nt),Ue)),He);return{originalData:Ze,formattedOriginalData:ke(Ze,2)}},computeVarianceCovariance:ae,computeAdjustedData:we,getEigenVectors:Me,analyseTopResult:function(Ue){var nt=Me(Ue).sort(function(He,Ze){return Ze.eigenvalue-He.eigenvalue});return console.log("Sorted Vectors",nt),we(Ue,nt[0].vector)},transpose:Ge,multiply:Le,clone:et,scale:tt}}();Te.exports=te},701:function(Te){var te=[];function oe(ve){for(var we=-1,Me=0;Me<te.length;Me++)if(te[Me].identifier===ve){we=Me;break}return we}function _(ve,we){for(var Me={},ke=[],Le=0;Le<ve.length;Le++){var Ye=ve[Le],tt=we.base?Ye[0]+we.base:Ye[0],Ke=Me[tt]||0,Ge="".concat(tt," ").concat(Ke);Me[tt]=Ke+1;var et=oe(Ge),Ue={css:Ye[1],media:Ye[2],sourceMap:Ye[3],supports:Ye[4],layer:Ye[5]};if(et!==-1)te[et].references++,te[et].updater(Ue);else{var nt=ae(Ue,we);we.byIndex=Le,te.splice(Le,0,{identifier:Ge,updater:nt,references:1})}ke.push(Ge)}return ke}function ae(ve,we){var Me=we.domAPI(we);return Me.update(ve),function(ke){if(ke){if(ke.css===ve.css&&ke.media===ve.media&&ke.sourceMap===ve.sourceMap&&ke.supports===ve.supports&&ke.layer===ve.layer)return;Me.update(ve=ke)}else Me.remove()}}Te.exports=function(ve,we){var Me=_(ve=ve||[],we=we||{});return function(ke){ke=ke||[];for(var Le=0;Le<Me.length;Le++){var Ye=oe(Me[Le]);te[Ye].references--}for(var tt=_(ke,we),Ke=0;Ke<Me.length;Ke++){var Ge=oe(Me[Ke]);te[Ge].references===0&&(te[Ge].updater(),te.splice(Ge,1))}Me=tt}}},182:function(Te){Te.exports=function(te){var oe=document.createElement("style");return te.setAttributes(oe,te.attributes),te.insert(oe,te.options),oe}},850:function(Te,te,oe){Te.exports=function(_){var ae=oe.nc;ae&&_.setAttribute("nonce",ae)}},236:function(Te){Te.exports=function(te){var oe=te.insertStyleElement(te);return{update:function(_){(function(ae,ve,we){var Me="";we.supports&&(Me+="@supports (".concat(we.supports,") {")),we.media&&(Me+="@media ".concat(we.media," {"));var ke=we.layer!==void 0;ke&&(Me+="@layer".concat(we.layer.length>0?" ".concat(we.layer):""," {")),Me+=we.css,ke&&(Me+="}"),we.media&&(Me+="}"),we.supports&&(Me+="}");var Le=we.sourceMap;Le&&typeof btoa<"u"&&(Me+=`
/`,Me+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(Le))))," *"),Me+="/"),ve.styleTagTransform(Me,ae,ve.options)})(oe,te,_)},remove:function(){(function(_){if(_.parentNode===null)return!1;_.parentNode.removeChild(_)})(oe)}}}},213:function(Te){Te.exports=function(te,oe){if(oe.styleSheet)oe.styleSheet.cssText=te;else{for(;oe.firstChild;)oe.removeChild(oe.firstChild);oe.appendChild(document.createTextNode(te))}}},1:function(Te){Te.exports=function(){var te={820:function(ve,we,Me){var ke=Me(537),Le=Me.n(ke),Ye=Me(645),tt=Me.n(Ye)()(Le());tt.push([ve.id,`.treejs {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.treejs *:after,
.treejs *:before {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.treejs > .treejs-node {
  padding-left: 0;
}
.treejs .treejs-nodes {
  list-style: none;
  padding-left: 18px;
  margin: 0;
  overflow: hidden;
  -webkit-transition: height 150ms ease-out, opacity 150ms ease-out;
  -o-transition: height 150ms ease-out, opacity 150ms ease-out;
  transition: height 150ms ease-out, opacity 150ms ease-out;
}
.treejs .treejs-node {
  cursor: pointer;
  overflow: hidden;
}
.treejs .treejs-node.treejs-placeholder {
  padding-left: 18px;
}
.treejs .treejs-switcher {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
  -webkit-transition: -webkit-transform 150ms ease-out;
  transition: -webkit-transform 150ms ease-out;
  -o-transition: transform 150ms ease-out;
  transition: transform 150ms ease-out;
  transition: transform 150ms ease-out, -webkit-transform 150ms ease-out;
}
.treejs .treejs-switcher:before {
  position: absolute;
  top: 8px;
  left: 6px;
  display: block;
  content: ' ';
  border: 4px solid transparent;
  border-top: 4px solid rgba(245, 245, 245, 0.7);
  -webkit-transition: border-color 150ms;
  -o-transition: border-color 150ms;
  transition: border-color 150ms;
}
.treejs .treejs-switcher:hover:before {
  border-top: 4px solid rgba(245, 245, 245, 0.96);
}
.treejs .treejs-node__close > .treejs-switcher {
  -webkit-transform: rotate(-90deg);
      -ms-transform: rotate(-90deg);
          transform: rotate(-90deg);
}
.treejs .treejs-node__close > .treejs-nodes {
  height: 0;
}
.treejs .treejs-checkbox {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
}
.treejs .treejs-checkbox:before {
  -webkit-transition: all 0.3s;
  -o-transition: all 0.3s;
  transition: all 0.3s;
  cursor: pointer;
  position: absolute;
  top: 2px;
  content: ' ';
  display: block;
  width: 16px;
  height: 16px;
  border: 1px solid #d9d9d9;
  border-radius: 2px;
}
.treejs .treejs-checkbox:hover:before {
  -webkit-box-shadow: 0 0 2px 1px #1890ff;
          box-shadow: 0 0 2px 1px #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 4px;
  left: 5px;
  width: 5px;
  height: 9px;
  border: 2px solid #fff;
  border-top: none;
  border-left: none;
  -webkit-transform: rotate(45deg);
      -ms-transform: rotate(45deg);
          transform: rotate(45deg);
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 9px;
  left: 3px;
  width: 10px;
  height: 2px;
  background-color: #fff;
}
.treejs .treejs-node__disabled {
  cursor: not-allowed;
  color: rgba(255, 255, 255, 0.25);
}
.treejs .treejs-node__disabled .treejs-checkbox {
  cursor: not-allowed;
}
.treejs .treejs-node__disabled .treejs-checkbox:before {
  cursor: not-allowed;
  border-color: #d9d9d9 !important;
  background-color: #f5f5f5 !important;
}
.treejs .treejs-node__disabled .treejs-checkbox:hover:before {
  -webkit-box-shadow: none !important;
          box-shadow: none !important;
}
.treejs .treejs-node__disabled .treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled .treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-label {
  vertical-align: middle;
}
`,"",{version:3,sources:["webpack://./src/index.less"],names:[],mappings:"AAKA;EACE,8BAAA;UAAA,sBAAA;EACA,eAAA;EACA,kBAAA;EACA,yBAAA;KAAA,sBAAA;MAAA,qBAAA;UAAA,iBAAA;AAJF;AAAA;;EAQI,8BAAA;UAAA,sBAAA;AAJJ;AAOE;EACE,eAAA;AALJ;AAPA;EAgBI,gBAAA;EACA,kBAAA;EACA,SAAA;EACA,gBAAA;EACA,iEAAA;EAAA,4DAAA;EAAA,yDAAA;AANJ;AAdA;EAwBI,eAAA;EACA,gBAAA;AAPJ;AASI;EACE,kBAAA;AAPN;AArBA;EAiCI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;EACA,oDAAA;EAAA,4CAAA;EAAA,uCAAA;EAAA,oCAAA;EAAA,sEAAA;AATJ;AAWI;EACE,kBAAA;EACA,QAAA;EACA,SAAA;EACA,cAAA;EACA,YAAA;EACA,6BAAA;EACA,8CAAA;EACA,sCAAA;EAAA,iCAAA;EAAA,8BAAA;AATN;AAWI;EACE,+CAAA;AATN;AA3CA;EAwDI,iCAAA;MAAA,6BAAA;UAAA,yBAAA;AAVJ;AA9CA;EA2DI,SAAA;AAVJ;AAjDA;EA+DI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;AAXJ;AAaI;EACE,4BAAA;EAAA,uBAAA;EAAA,oBAAA;EACA,eAAA;EACA,kBAAA;EACA,QAAA;EACA,YAAA;EACA,cAAA;EACA,WAAA;EACA,YAAA;EACA,yBAAA;EACA,kBAAA;AAXN;AAaI;EACE,uCAAA;UAAA,+BAAA;AAXN;AAgBM;EACE,yBAAA;EACA,qBAAA;AAdR;AAgBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,UAAA;EACA,WAAA;EACA,sBAAA;EACA,gBAAA;EACA,iBAAA;EACA,gCAAA;MAAA,4BAAA;UAAA,wBAAA;AAdR;AAoBM;EACE,yBAAA;EACA,qBAAA;AAlBR;AAoBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,WAAA;EACA,WAAA;EACA,sBAAA;AAlBR;AAvGA;EA+HI,mBAAA;EACA,gCAAA;AArBJ;AA3GA;EAkIM,mBAAA;AApBN;AAqBM;EACE,mBAAA;EACA,gCAAA;EACA,oCAAA;AAnBR;AAqBM;EACE,mCAAA;UAAA,2BAAA;AAnBR;AAwBQ;EACE,qBAAA;AAtBV;AA4BQ;EACE,yBAAA;AA1BV;AAiCM;EACE,qBAAA;AA/BR;AAqCM;EACE,yBAAA;AAnCR;AAlIA;EA2KI,sBAAA;AAtCJ",sourcesContent:[`@color-disable: #d4d4d4;
@bgcolor-disable: #f5f5f5;
@greyborder: #d9d9d9;
@bluebg: #1890ff;

.treejs {
  box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  user-select: none;

  *:after,
  *:before {
    box-sizing: border-box;
  }

  & > .treejs-node {
    padding-left: 0;
  }

  .treejs-nodes {
    list-style: none;
    padding-left: 18px;
    margin: 0; //  for default ul...
    overflow: hidden;
    transition: height 150ms ease-out, opacity 150ms ease-out;
  }

  .treejs-node {
    cursor: pointer;
    overflow: hidden;

    &.treejs-placeholder {
      padding-left: 18px;
    }
  }

  .treejs-switcher {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;
    transition: transform 150ms ease-out;

    &:before {
      position: absolute;
      top: 8px;
      left: 6px;
      display: block;
      content: ' ';
      border: 4px solid transparent;
      border-top: 4px solid rgba(245, 245, 245, 0.7);
      transition: border-color 150ms;
    }
    &:hover:before {
      border-top: 4px solid rgba(245, 245, 245, 0.96);
    }
  }
  .treejs-node__close > .treejs-switcher {
    transform: rotate(-90deg);
  }
  .treejs-node__close > .treejs-nodes {
    height: 0;
  }

  .treejs-checkbox {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;

    &:before {
      transition: all 0.3s;
      cursor: pointer;
      position: absolute;
      top: 2px;
      content: ' ';
      display: block;
      width: 16px;
      height: 16px;
      border: 1px solid @greyborder;
      border-radius: 2px;
    }
    &:hover:before {
      box-shadow: 0 0 2px 1px @bluebg;
    }
  }
  .treejs-node__checked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 4px;
        left: 5px;
        width: 5px;
        height: 9px;
        border: 2px solid #fff;
        border-top: none;
        border-left: none;
        transform: rotate(45deg);
      }
    }
  }
  .treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 9px;
        left: 3px;
        width: 10px;
        height: 2px;
        background-color: #fff;
      }
    }
  }

  .treejs-node__disabled {
    cursor: not-allowed;
    color: rgba(255, 255, 255, 0.25);
    .treejs-checkbox {
      cursor: not-allowed;
      &:before {
        cursor: not-allowed;
        border-color: @greyborder !important;
        background-color: @bgcolor-disable !important;
      }
      &:hover:before {
        box-shadow: none !important;
      }
    }
    .treejs-node__checked {
      & > .treejs-checkbox {
        &:after {
          border-color: @greyborder;
        }
      }
    }
    .treejs-node__halfchecked {
      & > .treejs-checkbox {
        &:after {
          background-color: @greyborder;
        }
      }
    }
  }
  .treejs-node__disabled.treejs-node__checked {
    & > .treejs-checkbox {
      &:after {
        border-color: @greyborder;
      }
    }
  }
  .treejs-node__disabled.treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:after {
        background-color: @greyborder;
      }
    }
  }

  .treejs-label {
    vertical-align: middle;
  }
}
`],sourceRoot:""}]),we.Z=tt},645:function(ve){ve.exports=function(we){var Me=[];return Me.toString=function(){return this.map(function(ke){var Le="",Ye=ke[5]!==void 0;return ke[4]&&(Le+="@supports (".concat(ke[4],") {")),ke[2]&&(Le+="@media ".concat(ke[2]," {")),Ye&&(Le+="@layer".concat(ke[5].length>0?" ".concat(ke[5]):""," {")),Le+=we(ke),Ye&&(Le+="}"),ke[2]&&(Le+="}"),ke[4]&&(Le+="}"),Le}).join("")},Me.i=function(ke,Le,Ye,tt,Ke){typeof ke=="string"&&(ke=[[null,ke,void 0]]);var Ge={};if(Ye)for(var et=0;et<this.length;et++){var Ue=this[et][0];Ue!=null&&(Ge[Ue]=!0)}for(var nt=0;nt<ke.length;nt++){var He=[].concat(ke[nt]);Ye&&Ge[He[0]]||(Ke!==void 0&&(He[5]===void 0||(He[1]="@layer".concat(He[5].length>0?" ".concat(He[5]):""," {").concat(He[1],"}")),He[5]=Ke),Le&&(He[2]&&(He[1]="@media ".concat(He[2]," {").concat(He[1],"}")),He[2]=Le),tt&&(He[4]?(He[1]="@supports (".concat(He[4],") {").concat(He[1],"}"),He[4]=tt):He[4]="".concat(tt)),Me.push(He))}},Me}},537:function(ve){ve.exports=function(we){var Me=we[1],ke=we[3];if(!ke)return Me;if(typeof btoa=="function"){var Le=btoa(unescape(encodeURIComponent(JSON.stringify(ke)))),Ye="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(Le),tt="/*# ".concat(Ye," */"),Ke=ke.sources.map(function(Ge){return"/*# sourceURL=".concat(ke.sourceRoot||"").concat(Ge," */")});return[Me].concat(Ke).concat([tt]).join(`
`)}return[Me].join(`
`)}},379:function(ve){var we=[];function Me(Ye){for(var tt=-1,Ke=0;Ke<we.length;Ke++)if(we[Ke].identifier===Ye){tt=Ke;break}return tt}function ke(Ye,tt){for(var Ke={},Ge=[],et=0;et<Ye.length;et++){var Ue=Ye[et],nt=tt.base?Ue[0]+tt.base:Ue[0],He=Ke[nt]||0,Ze="".concat(nt," ").concat(He);Ke[nt]=He+1;var st=Me(Ze),Et={css:Ue[1],media:Ue[2],sourceMap:Ue[3],supports:Ue[4],layer:Ue[5]};if(st!==-1)we[st].references++,we[st].updater(Et);else{var rt=Le(Et,tt);tt.byIndex=et,we.splice(et,0,{identifier:Ze,updater:rt,references:1})}Ge.push(Ze)}return Ge}function Le(Ye,tt){var Ke=tt.domAPI(tt);return Ke.update(Ye),function(Ge){if(Ge){if(Ge.css===Ye.css&&Ge.media===Ye.media&&Ge.sourceMap===Ye.sourceMap&&Ge.supports===Ye.supports&&Ge.layer===Ye.layer)return;Ke.update(Ye=Ge)}else Ke.remove()}}ve.exports=function(Ye,tt){var Ke=ke(Ye=Ye||[],tt=tt||{});return function(Ge){Ge=Ge||[];for(var et=0;et<Ke.length;et++){var Ue=Me(Ke[et]);we[Ue].references--}for(var nt=ke(Ge,tt),He=0;He<Ke.length;He++){var Ze=Me(Ke[He]);we[Ze].references===0&&(we[Ze].updater(),we.splice(Ze,1))}Ke=nt}}},216:function(ve){ve.exports=function(we){var Me=document.createElement("style");return we.setAttributes(Me,we.attributes),we.insert(Me,we.options),Me}},636:function(ve,we,Me){ve.exports=function(ke){var Le=Me.nc;Le&&ke.setAttribute("nonce",Le)}},795:function(ve){ve.exports=function(we){var Me=we.insertStyleElement(we);return{update:function(ke){(function(Le,Ye,tt){var Ke="";tt.supports&&(Ke+="@supports (".concat(tt.supports,") {")),tt.media&&(Ke+="@media ".concat(tt.media," {"));var Ge=tt.layer!==void 0;Ge&&(Ke+="@layer".concat(tt.layer.length>0?" ".concat(tt.layer):""," {")),Ke+=tt.css,Ge&&(Ke+="}"),tt.media&&(Ke+="}"),tt.supports&&(Ke+="}");var et=tt.sourceMap;et&&typeof btoa<"u"&&(Ke+=`
/`,Ke+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(et))))," *"),Ke+="/"),Ye.styleTagTransform(Ke,Le,Ye.options)})(Me,we,ke)},remove:function(){(function(ke){if(ke.parentNode===null)return!1;ke.parentNode.removeChild(ke)})(Me)}}}},589:function(ve){ve.exports=function(we,Me){if(Me.styleSheet)Me.styleSheet.cssText=we;else{for(;Me.firstChild;)Me.removeChild(Me.firstChild);Me.appendChild(document.createTextNode(we))}}}},oe={};function _(ve){var we=oe[ve];if(we!==void 0)return we.exports;var Me=oe[ve]={id:ve,exports:{}};return te[ve](Me,Me.exports,_),Me.exports}_.n=function(ve){var we=ve&&ve.__esModule?function(){return ve.default}:function(){return ve};return _.d(we,{a:we}),we},_.d=function(ve,we){for(var Me in we)_.o(we,Me)&&!_.o(ve,Me)&&Object.defineProperty(ve,Me,{enumerable:!0,get:we[Me]})},_.o=function(ve,we){return Object.prototype.hasOwnProperty.call(ve,we)},_.nc=void 0;var ae={};return function(){_.d(ae,{default:function(){return un}});var ve=_(379),we=_.n(ve),Me=_(795),ke=_.n(Me),Le=_(636),Ye=_.n(Le),tt=_(216),Ke=_.n(tt),Ge=_(589),et=_.n(Ge),Ue=_(820),nt={};Ue.Z&&Ue.Z.locals&&(nt.locals=Ue.Z.locals);var He,Ze=0,st={};st.styleTagTransform=et(),st.setAttributes=Ye(),st.insert=function(Zt,pn){(pn.target||document.head).appendChild(Zt)},st.domAPI=ke(),st.insertStyleElement=Ke(),nt.use=function(Zt){return st.options=Zt||{},Ze++||(He=we()(Ue.Z,st)),nt},nt.unuse=function(){Ze>0&&!--Ze&&(He(),He=null)};var Et=nt;function rt(Zt,pn){return function(ln){if(Array.isArray(ln))return ln}(Zt)||function(ln,vn){var ht=ln==null?null:typeof Symbol<"u"&&ln[Symbol.iterator]||ln["@@iterator"];if(ht!=null){var Jt,en,Cn=[],Vt=!0,Je=!1;try{for(ht=ht.call(ln);!(Vt=(Jt=ht.next()).done)&&(Cn.push(Jt.value),!vn||Cn.length!==vn);Vt=!0);}catch(ot){Je=!0,en=ot}finally{try{Vt||ht.return==null||ht.return()}finally{if(Je)throw en}}return Cn}}(Zt,pn)||function(ln,vn){if(ln){if(typeof ln=="string")return bt(ln,vn);var ht=Object.prototype.toString.call(ln).slice(8,-1);return ht==="Object"&&ln.constructor&&(ht=ln.constructor.name),ht==="Map"||ht==="Set"?Array.from(ln):ht==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(ht)?bt(ln,vn):void 0}}(Zt,pn)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function bt(Zt,pn){(pn==null||pn>Zt.length)&&(pn=Zt.length);for(var ln=0,vn=new Array(pn);ln<pn;ln++)vn[ln]=Zt[ln];return vn}function Ne(Zt,pn){var ln=Object.keys(Zt);if(Object.getOwnPropertySymbols){var vn=Object.getOwnPropertySymbols(Zt);pn&&(vn=vn.filter(function(ht){return Object.getOwnPropertyDescriptor(Zt,ht).enumerable})),ln.push.apply(ln,vn)}return ln}function Qe(Zt){for(var pn=1;pn<arguments.length;pn++){var ln=arguments[pn]!=null?arguments[pn]:{};pn%2?Ne(Object(ln),!0).forEach(function(vn){We(Zt,vn,ln[vn])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Zt,Object.getOwnPropertyDescriptors(ln)):Ne(Object(ln)).forEach(function(vn){Object.defineProperty(Zt,vn,Object.getOwnPropertyDescriptor(ln,vn))})}return Zt}function We(Zt,pn,ln){return pn in Zt?Object.defineProperty(Zt,pn,{value:ln,enumerable:!0,configurable:!0,writable:!0}):Zt[pn]=ln,Zt}function _t(Zt,pn){for(var ln=0;ln<pn.length;ln++){var vn=pn[ln];vn.enumerable=vn.enumerable||!1,vn.configurable=!0,"value"in vn&&(vn.writable=!0),Object.defineProperty(Zt,vn.key,vn)}}function lt(Zt){var pn={};return Zt.reduce(function(ln,vn){return pn[vn]||(pn[vn]=!0,ln.push(vn)),ln},[])}function Ut(Zt,pn){requestAnimationFrame(function(){pn.enter(),requestAnimationFrame(function(){pn.active(),setTimeout(function(){pn.leave()},Zt)})})}function dn(Zt,pn){try{var ln=Zt.liElementsById[pn.parent.id];ln.classList.contains("treejs-node__close")||ln.getElementsByClassName("treejs-switcher")[0].click()}catch{return}Object.prototype.hasOwnProperty.call(pn,"parent")&&dn(Zt,pn.parent)}function nn(Zt,pn){var ln=Zt.liElementsById[pn.id];ln.classList.contains("treejs-node__close")&&ln.getElementsByClassName("treejs-switcher")[0].click(),Object.prototype.hasOwnProperty.call(pn,"children")&&pn.children.forEach(function(vn){return nn(Zt,vn)})}var un=function(){function Zt(ht,Jt){(function(en,Cn){if(!(en instanceof Cn))throw new TypeError("Cannot call a class as a function")})(this,Zt),Et.use({target:typeof this.container=="string"?document.querySelector(this.container):this.container}),this.treeNodes=[],this.nodesById={},this.leafNodesById={},this.liElementsById={},this.willUpdateNodesById={},this.container=ht,this.options=Object.assign({values:[],disables:[],loaded:null,closeDepth:null},Jt),Object.defineProperties(this,{values:{get:function(){return this.getValues()},set:function(en){this.setValues(lt(en))}},disables:{get:function(){return this.getDisables()},set:function(en){this.setDisables(lt(en))}},selectedNodes:{get:function(){var en=[],Cn=this.nodesById;return Object.keys(Cn).forEach(function(Vt){if(Object.prototype.hasOwnProperty.call(Cn,Vt)&&(Cn[Vt].status===1||Cn[Vt].status===2)){var Je=Qe({},Cn[Vt]);delete Je.parent,delete Je.children,en.push(Je)}}),en}},disabledNodes:{get:function(){var en=[],Cn=this.nodesById;return Object.keys(Cn).forEach(function(Vt){if(Object.prototype.hasOwnProperty.call(Cn,Vt)&&Cn[Vt].disabled){var Je=Qe({},Cn[Vt]);delete Je.parent,en.push(Je)}}),en}}}),this.init(this.options.data)}var pn,ln,vn;return pn=Zt,vn=[{key:"onSwitcherClick",value:function(ht){var Jt=ht.parentNode,en=Jt.lastChild,Cn=en.scrollHeight;Jt.classList.contains("treejs-node__close")?Ut(150,{enter:function(){en.style.height=0,en.style.opacity=0},active:function(){en.style.height="".concat(Cn,"px"),en.style.opacity=1},leave:function(){en.style.height="",en.style.opacity="",Jt.classList.remove("treejs-node__close")}}):Ut(150,{enter:function(){en.style.height="".concat(Cn,"px"),en.style.opacity=1},active:function(){en.style.height=0,en.style.opacity=0},leave:function(){en.style.height="",en.style.opacity="",Jt.classList.add("treejs-node__close")}})}},{key:"parseTreeData",value:function(ht){var Jt,en=(Jt=ht,JSON.parse(JSON.stringify(Jt))),Cn={},Vt={},Je=[],ot=[];return function Rt(Mn,Pn){Mn.forEach(function(Rn){Cn[Rn.id]=Rn,Rn.checked&&Je.push(Rn.id),Rn.disabled&&ot.push(Rn.id),Pn&&(Rn.parent=Pn),Rn.children&&Rn.children.length?Rt(Rn.children,Rn):Vt[Rn.id]=Rn})}(en),{treeNodes:en,nodesById:Cn,leafNodesById:Vt,defaultValues:Je,defaultDisables:ot}}},{key:"createRootEle",value:function(){var ht=document.createElement("div");return ht.classList.add("treejs"),ht}},{key:"createUlEle",value:function(){var ht=document.createElement("ul");return ht.classList.add("treejs-nodes"),ht}},{key:"createLiEle",value:function(ht,Jt){var en=document.createElement("li");if(en.classList.add("treejs-node"),Jt&&en.classList.add("treejs-node__close"),ht.children&&ht.children.length){var Cn=document.createElement("span");Cn.classList.add("treejs-switcher"),en.appendChild(Cn)}else en.classList.add("treejs-placeholder");var Vt=document.createElement("span");Vt.classList.add("treejs-checkbox"),en.appendChild(Vt);var Je=document.createElement("span");Je.classList.add("treejs-label");var ot=document.createTextNode(ht.text);return Je.appendChild(ot),en.appendChild(Je),en.nodeId=ht.id,en}}],(ln=[{key:"init",value:function(ht){var Jt=Zt.parseTreeData(ht),en=Jt.treeNodes,Cn=Jt.nodesById,Vt=Jt.leafNodesById,Je=Jt.defaultValues,ot=Jt.defaultDisables;this.treeNodes=en,this.nodesById=Cn,this.leafNodesById=Vt,this.render(this.treeNodes);var Rt=this.options,Mn=Rt.values,Pn=Rt.disables,Rn=Rt.loaded;Mn&&Mn.length?this.setValues(Mn):Je&&Je.length&&this.setValues(Je),Pn&&Pn.length?this.setDisables(Pn):ot&&ot.length&&this.setDisables(ot),typeof Rn=="function"&&Rn.call(this)}},{key:"render",value:function(ht){var Jt=Zt.createRootEle();Jt.appendChild(this.buildTree(ht,0)),this.bindEvent(Jt);var en=typeof this.container=="string"?document.querySelector(this.container):this.container;(function(Cn){for(;Cn.firstChild;)Cn.removeChild(Cn.firstChild)})(en),en.appendChild(Jt)}},{key:"buildTree",value:function(ht,Jt){var en=this,Cn=Zt.createUlEle();return ht&&ht.length&&ht.forEach(function(Vt){var Je=Zt.createLiEle(Vt,Jt===en.options.closeDepth-1);en.liElementsById[Vt.id]=Je;var ot=null;Vt.children&&Vt.children.length&&(ot=en.buildTree(Vt.children,Jt+1)),ot&&Je.appendChild(ot),Cn.appendChild(Je)}),Cn}},{key:"bindEvent",value:function(ht){var Jt=this;ht.addEventListener("click",function(en){var Cn=en.target;Cn.nodeName==="SPAN"&&Cn.classList.contains("treejs-checkbox")?Jt.onItemClick(Cn.parentNode.nodeId):Cn.nodeName==="SPAN"&&Cn.classList.contains("treejs-label")?Jt.onItemLabelClick(Cn.parentNode.nodeId):Cn.nodeName==="LI"&&Cn.classList.contains("treejs-node")?Jt.onItemClick(Cn.nodeId):Cn.nodeName==="SPAN"&&Cn.classList.contains("treejs-switcher")&&Zt.onSwitcherClick(Cn)},!1)}},{key:"onItemClick",value:function(ht){var Jt=this.nodesById[ht],en=this.options.onChange;Jt.disabled||(this.setValue(ht),this.updateLiElements()),en&&en.call(this)}},{key:"onItemLabelClick",value:function(ht){var Jt=this.options.onItemLabelClick;Jt&&Jt.call(this,ht)}},{key:"setValue",value:function(ht){var Jt=this.nodesById[ht];if(Jt){var en=Jt.status,Cn=en===1||en===2?0:2;Jt.status=Cn,this.markWillUpdateNode(Jt),this.walkUp(Jt,"status"),this.walkDown(Jt,"status")}}},{key:"getValues",value:function(){var ht=this,Jt=[];return Object.keys(this.leafNodesById).forEach(function(en){Object.prototype.hasOwnProperty.call(ht.leafNodesById,en)&&(ht.leafNodesById[en].status!==1&&ht.leafNodesById[en].status!==2||Jt.push(en))}),Jt}},{key:"setValues",value:function(ht){var Jt=this;this.emptyNodesCheckStatus(),ht.forEach(function(Cn){Jt.setValue(Cn)}),this.updateLiElements();var en=this.options.onChange;en&&en.call(this)}},{key:"setDisable",value:function(ht){var Jt=this.nodesById[ht];Jt&&(Jt.disabled||(Jt.disabled=!0,this.markWillUpdateNode(Jt),this.walkUp(Jt,"disabled"),this.walkDown(Jt,"disabled")))}},{key:"getDisables",value:function(){var ht=this,Jt=[];return Object.keys(this.leafNodesById).forEach(function(en){Object.prototype.hasOwnProperty.call(ht.leafNodesById,en)&&ht.leafNodesById[en].disabled&&Jt.push(en)}),Jt}},{key:"setDisables",value:function(ht){var Jt=this;this.emptyNodesDisable(),ht.forEach(function(en){Jt.setDisable(en)}),this.updateLiElements()}},{key:"emptyNodesCheckStatus",value:function(){this.willUpdateNodesById=this.getSelectedNodesById(),Object.values(this.willUpdateNodesById).forEach(function(ht){ht.disabled||(ht.status=0)})}},{key:"emptyNodesDisable",value:function(){this.willUpdateNodesById=this.getDisabledNodesById(),Object.values(this.willUpdateNodesById).forEach(function(ht){ht.disabled=!1})}},{key:"getSelectedNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(ht,Jt){var en=rt(Jt,2),Cn=en[0],Vt=en[1];return Vt.status!==1&&Vt.status!==2||(ht[Cn]=Vt),ht},{})}},{key:"getDisabledNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(ht,Jt){var en=rt(Jt,2),Cn=en[0],Vt=en[1];return Vt.disabled&&(ht[Cn]=Vt),ht},{})}},{key:"updateLiElements",value:function(){var ht=this;Object.values(this.willUpdateNodesById).forEach(function(Jt){ht.updateLiElement(Jt)}),this.willUpdateNodesById={}}},{key:"markWillUpdateNode",value:function(ht){this.willUpdateNodesById[ht.id]=ht}},{key:"walkUp",value:function(ht,Jt){var en=ht.parent;if(en){if(Jt==="status"){var Cn,Vt=en.children.reduce(function(ot,Rt){return Number.isNaN(Rt.status)?ot:ot+Rt.status},0);if(Cn=Vt?Vt===2*en.children.length?2:1:0,en.status===Cn)return;en.status=Cn}else{var Je=en.children.reduce(function(ot,Rt){return ot&&Rt.disabled},!0);if(en.disabled===Je)return;en.disabled=Je}this.markWillUpdateNode(en),this.walkUp(en,Jt)}}},{key:"walkDown",value:function(ht,Jt){var en=this;ht.children&&ht.children.length&&ht.children.forEach(function(Cn){Jt==="status"&&Cn.disabled||(Cn[Jt]=ht[Jt],en.markWillUpdateNode(Cn),en.walkDown(Cn,Jt))})}},{key:"updateLiElement",value:function(ht){var Jt=this.liElementsById[ht.id].classList;switch(ht.status){case 0:Jt.remove("treejs-node__halfchecked","treejs-node__checked");break;case 1:Jt.remove("treejs-node__checked"),Jt.add("treejs-node__halfchecked");break;case 2:Jt.remove("treejs-node__halfchecked"),Jt.add("treejs-node__checked")}switch(ht.disabled){case!0:Jt.contains("treejs-node__disabled")||Jt.add("treejs-node__disabled");break;case!1:Jt.contains("treejs-node__disabled")&&Jt.remove("treejs-node__disabled")}}},{key:"collapseAll",value:function(){var ht=this;Object.keys(this.leafNodesById).forEach(function(Jt){var en=ht.leafNodesById[Jt];dn(ht,en)})}},{key:"expandAll",value:function(){nn(this,this.treeNodes[0])}}])&&_t(pn.prototype,ln),vn&&_t(pn,vn),Object.defineProperty(pn,"prototype",{writable:!1}),Zt}()}(),ae.default}()},819:function(Te,te){(function(oe){const _="tp";function ae(nt){return He=>Ze=>{if(!He&&Ze===void 0)return{succeeded:!1,value:void 0};if(He&&Ze===void 0)return{succeeded:!0,value:void 0};const st=nt(Ze);return st!==void 0?{succeeded:!0,value:st}:{succeeded:!1,value:void 0}}}function ve(nt){return{custom:He=>ae(He)(nt),boolean:ae(He=>typeof He=="boolean"?He:void 0)(nt),number:ae(He=>typeof He=="number"?He:void 0)(nt),string:ae(He=>typeof He=="string"?He:void 0)(nt),function:ae(He=>typeof He=="function"?He:void 0)(nt),constant:He=>ae(Ze=>Ze===He?He:void 0)(nt),raw:ae(He=>He)(nt),object:He=>ae(Ze=>{if((st=Ze)!==null&&typeof st=="object")return function(Et,rt){return Object.keys(rt).reduce((bt,Ne)=>{if(bt===void 0)return;const Qe=(0,rt[Ne])(Et[Ne]);return Qe.succeeded?Object.assign(Object.assign({},bt),{[Ne]:Qe.value}):void 0},{})}(Ze,He);var st})(nt),array:He=>ae(Ze=>{if(Array.isArray(Ze))return st=He,Ze.reduce((Et,rt)=>{if(Et===void 0)return;const bt=st(rt);return bt.succeeded&&bt.value!==void 0?[...Et,bt.value]:void 0},[]);var st})(nt)}}const we={optional:ve(!0),required:ve(!1)};function Me(nt,He,Ze,st){return new(Ze||(Ze=Promise))(function(Et,rt){function bt(We){try{Qe(st.next(We))}catch(_t){rt(_t)}}function Ne(We){try{Qe(st.throw(We))}catch(_t){rt(_t)}}function Qe(We){var _t;We.done?Et(We.value):(_t=We.value,_t instanceof Ze?_t:new Ze(function(lt){lt(_t)})).then(bt,Ne)}Qe((st=st.apply(nt,He||[])).next())})}function ke(nt){return Me(this,void 0,void 0,function*(){const He=new Image;return He.crossOrigin="anonymous",new Promise((Ze,st)=>{He.src=nt,He.onload=()=>{Ze(He)},He.onerror=st})})}const Le=(Ye="img",(nt,He)=>[_,"-",Ye,"v",nt?`_${nt}`:"",He?`-${He}`:""].join(""));var Ye;class tt{constructor(He,Ze){this.element=He.createElement("div"),this.element.classList.add(Le()),Ze.viewProps.bindClassModifiers(this.element),this.input=He.createElement("input"),this.input.classList.add(Le("input")),this.input.setAttribute("type","file"),this.input.setAttribute("accept",Ze.extensions.join(",")),this.image_=He.createElement("img"),this.image_.classList.add(Le("image")),this.image_.classList.add(Le(`image_${Ze.imageFit}`)),this.image_.crossOrigin="anonymous",this.image_.onclick=st=>{Ze.clickCallback?Ze.clickCallback(st,this.input):this.input.click()},this.element.classList.add(Le("area_root")),this.element.appendChild(this.image_),this.element.appendChild(this.input)}changeImage(He){this.image_.src=He}changeDraggingState(He){const Ze=this.element;He?Ze==null||Ze.classList.add(Le("area_dragging")):Ze==null||Ze.classList.remove(Le("area_dragging"))}}let Ke=null;class Ge{constructor(He,Ze){this.value=Ze.value,this.viewProps=Ze.viewProps,this.view=new tt(He,{viewProps:this.viewProps,extensions:Ze.extensions,imageFit:Ze.imageFit,clickCallback:Ze.clickCallback}),this.onFile=this.onFile.bind(this),this.onDrop=this.onDrop.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.view.input.addEventListener("change",this.onFile),this.view.element.addEventListener("drop",this.onDrop),this.view.element.addEventListener("dragover",this.onDragOver),this.view.element.addEventListener("dragleave",this.onDragLeave),this.viewProps.handleDispose(()=>{this.view.input.removeEventListener("change",this.onFile),this.view.input.removeEventListener("drop",this.onDrop),this.view.input.removeEventListener("dragover",this.onDragOver),this.view.input.removeEventListener("dragleave",this.onDragLeave)}),this.value.emitter.on("change",this.handleValueChange.bind(this)),this.handleValueChange()}onFile(He){const Ze=(He==null?void 0:He.target).files;if(!Ze||!Ze.length)return;const st=Ze[0];this.setValue(st)}onDrop(He){return Me(this,void 0,void 0,function*(){He.preventDefault();try{const{dataTransfer:Ze}=He,st=Ze==null?void 0:Ze.files[0];if(st)this.setValue(st);else{const Et=Ze==null?void 0:Ze.getData("url");if(!Et)throw new Error("No url");this.setValue(Et)}}catch(Ze){console.error("Could not parse the dropped image",Ze)}finally{this.view.changeDraggingState(!1)}})}onDragOver(He){He.preventDefault(),this.view.changeDraggingState(!0)}onDragLeave(){this.view.changeDraggingState(!1)}handleImage(He){return Me(this,void 0,void 0,function*(){He instanceof HTMLImageElement?this.updateImage(He.src):typeof He!="string"&&He?yield this.setValue(He):(He!=="placeholder"&&He||(He=(yield this.handlePlaceholderImage()).src),this.updateImage(He))})}updateImage(He){this.view.changeImage(He)}setValue(He){return Me(this,void 0,void 0,function*(){if(He instanceof HTMLImageElement)this.value.setRawValue(He);else if(He instanceof File){const Ze=URL.createObjectURL(He)+"#"+He.name;He.src=Ze;const st=yield ke(Ze).catch(()=>{});this.value.setRawValue(st||He)}else He?this.value.setRawValue(yield ke(He)):this.value.setRawValue(yield this.handlePlaceholderImage())})}handleValueChange(){this.handleImage(this.value.rawValue)}handlePlaceholderImage(){return Me(this,void 0,void 0,function*(){return Ke||(Ke=yield function(){const He=document.createElement("canvas");He.width=320,He.height=50;const Ze=He.getContext("2d");return Ze.fillStyle="#00000004",Ze.fillRect(0,0,He.width,He.height),Ze.fillStyle="#eee",Ze.font='1.25rem "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace',Ze.textAlign="center",Ze.textBaseline="middle",Ze.fillText("No image",.5*He.width,.5*He.height),new Promise(st=>{He.toBlob(Et=>{const rt=new Image;rt.src=URL.createObjectURL(Et),rt.isPlaceholder=!0,rt.onload=()=>{st(rt)}})})}()),Ke})}}const et=[".jpg",".png",".gif"],Ue={id:"input-image",type:"input",css:".tp-imgv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-imgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-imgv:hover{background-color:var(--in-bg-h)}.tp-imgv:focus{background-color:var(--in-bg-f)}.tp-imgv:active{background-color:var(--in-bg-a)}.tp-imgv:disabled{opacity:0.5}:root{--tp-plugin-image-dragging-color: hsla(230, 100%, 66%, 1.00)}.tp-imgv{cursor:pointer;display:inline-flex;height:auto !important;max-height:calc(var(--bld-us) * 3);border-radius:4px;position:relative}.tp-imgv.tp-v-disabled{opacity:0.5}.tp-imgv_input{width:0;height:0;pointer-events:none;visibility:hidden}.tp-imgv_image{width:100%;height:-webkit-max-content;height:-moz-max-content;height:max-content;max-height:calc(var(--bld-us) * 3);border:0}.tp-imgv_image_contain{-o-object-fit:contain;object-fit:contain}.tp-imgv_image_cover{-o-object-fit:cover;object-fit:cover}.tp-imgv_area_root{transition:opacity 0.16s ease-in-out}.tp-imgv_area_dragging{border:2px dashed var(--tp-plugin-image-dragging-color);border-radius:4px;opacity:0.6}",accept(nt,He){if(!(nt instanceof HTMLImageElement||typeof nt=="string"))return null;const Ze=we,st=function(Et,rt){const bt=we.required.object(rt)(Et);return bt.succeeded?bt.value:void 0}(He,{view:Ze.required.constant("input-image"),acceptUrl:Ze.optional.boolean,clickCallback:Ze.optional.function,imageFit:Ze.optional.custom(Et=>Et==="contain"||Et==="cover"?Et:void 0),extensions:Ze.optional.array(Ze.required.string)});return st?{initialValue:nt,params:st}:null},binding:{reader:nt=>He=>He.src!==void 0?He.src===""?"placeholder":He.src:He,writer:nt=>(He,Ze)=>{He.write(Ze)}},controller(nt){var He,Ze;return new Ge(nt.document,{value:nt.value,imageFit:(He=nt.params.imageFit)!==null&&He!==void 0?He:"cover",clickCallback:nt.params.clickCallback,viewProps:nt.viewProps,extensions:(Ze=nt.params.extensions)!==null&&Ze!==void 0?Ze:et})}};oe.plugin=Ue,Object.defineProperty(oe,"__esModule",{value:!0})})(te)},665:function(Te,te){(function(oe){class _{constructor(ne){this.controller_=ne}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(ne){this.controller_.viewProps.set("disabled",ne)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(ne){this.controller_.viewProps.set("hidden",ne)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class ae{constructor(ne){this.target=ne}}class ve extends ae{constructor(ne,ce,Se,qe){super(ne),this.value=ce,this.presetKey=Se,this.last=qe==null||qe}}class we extends ae{constructor(ne,ce,Se){super(ne),this.value=ce,this.presetKey=Se}}class Me extends ae{constructor(ne,ce){super(ne),this.expanded=ce}}function ke(_e){return _e==null}function Le(_e,ne){if(_e.length!==ne.length)return!1;for(let ce=0;ce<_e.length;ce++)if(_e[ce]!==ne[ce])return!1;return!0}const Ye={alreadydisposed:()=>"View has been already disposed",invalidparams:_e=>`Invalid parameters for '${_e.name}'`,nomatchingcontroller:_e=>`No matching controller for '${_e.key}'`,nomatchingview:_e=>`No matching view for '${JSON.stringify(_e.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:_e=>`Property '${_e.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class tt{constructor(ne){var ce;this.message=(ce=Ye[ne.type](ne.context))!==null&&ce!==void 0?ce:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=ne.type}static alreadyDisposed(){return new tt({type:"alreadydisposed"})}static notBindable(){return new tt({type:"notbindable"})}static propertyNotFound(ne){return new tt({type:"propertynotfound",context:{name:ne}})}static shouldNeverHappen(){return new tt({type:"shouldneverhappen"})}}class Ke{constructor(ne,ce,Se){this.obj_=ne,this.key_=ce,this.presetKey_=Se??ce}static isBindable(ne){return ne!==null&&typeof ne=="object"}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(ne){this.obj_[this.key_]=ne}writeProperty(ne,ce){const Se=this.read();if(!Ke.isBindable(Se))throw tt.notBindable();if(!(ne in Se))throw tt.propertyNotFound(ne);Se[ne]=ce}}class Ge extends _{get label(){return this.controller_.props.get("label")}set label(ne){this.controller_.props.set("label",ne)}get title(){var ne;return(ne=this.controller_.valueController.props.get("title"))!==null&&ne!==void 0?ne:""}set title(ne){this.controller_.valueController.props.set("title",ne)}on(ne,ce){const Se=ce.bind(this);return this.controller_.valueController.emitter.on(ne,()=>{Se(new ae(this))}),this}}class et{constructor(){this.observers_={}}on(ne,ce){let Se=this.observers_[ne];return Se||(Se=this.observers_[ne]=[]),Se.push({handler:ce}),this}off(ne,ce){const Se=this.observers_[ne];return Se&&(this.observers_[ne]=Se.filter(qe=>qe.handler!==ce)),this}emit(ne,ce){const Se=this.observers_[ne];Se&&Se.forEach(qe=>{qe.handler(ce)})}}const Ue="tp";function nt(_e){return(ne,ce)=>[Ue,"-",_e,"v",ne?`_${ne}`:"",ce?`-${ce}`:""].join("")}function He(_e){return _e.rawValue}function Ze(_e,ne){var ce,Se;_e.emitter.on("change",(ce=He,Se=ne,qe=>Se(ce(qe)))),ne(_e.rawValue)}function st(_e,ne,ce){Ze(_e.value(ne),ce)}function Et(_e,ne){return ce=>{(function(Se,qe,gt){gt?Se.classList.add(qe):Se.classList.remove(qe)})(_e,ne,ce)}}function rt(_e,ne){Ze(_e,ce=>{ne.textContent=ce??""})}const bt=nt("btn");class Ne{constructor(ne,ce){this.element=ne.createElement("div"),this.element.classList.add(bt()),ce.viewProps.bindClassModifiers(this.element);const Se=ne.createElement("button");Se.classList.add(bt("b")),ce.viewProps.bindDisabled(Se),this.element.appendChild(Se),this.buttonElement=Se;const qe=ne.createElement("div");qe.classList.add(bt("t")),rt(ce.props.value("title"),qe),this.buttonElement.appendChild(qe)}}class Qe{constructor(ne,ce){this.emitter=new et,this.onClick_=this.onClick_.bind(this),this.props=ce.props,this.viewProps=ce.viewProps,this.view=new Ne(ne,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class We{constructor(ne,ce){var Se;this.constraint_=ce==null?void 0:ce.constraint,this.equals_=(Se=ce==null?void 0:ce.equals)!==null&&Se!==void 0?Se:(qe,gt)=>qe===gt,this.emitter=new et,this.rawValue_=ne}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(ne){this.setRawValue(ne,{forceEmit:!1,last:!0})}setRawValue(ne,ce){const Se=ce??{forceEmit:!1,last:!0},qe=this.constraint_?this.constraint_.constrain(ne):ne;(!this.equals_(this.rawValue_,qe)||Se.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=qe,this.emitter.emit("change",{options:Se,rawValue:qe,sender:this}))}}class _t{constructor(ne){this.emitter=new et,this.value_=ne}get rawValue(){return this.value_}set rawValue(ne){this.setRawValue(ne,{forceEmit:!1,last:!0})}setRawValue(ne,ce){const Se=ce??{forceEmit:!1,last:!0};(this.value_!==ne||Se.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=ne,this.emitter.emit("change",{options:Se,rawValue:this.value_,sender:this}))}}function lt(_e,ne){const ce=ne==null?void 0:ne.constraint,Se=ne==null?void 0:ne.equals;return ce||Se?new We(_e,ne):new _t(_e)}class Ut{constructor(ne){this.emitter=new et,this.valMap_=ne;for(const ce in this.valMap_)this.valMap_[ce].emitter.on("change",()=>{this.emitter.emit("change",{key:ce,sender:this})})}static createCore(ne){return Object.keys(ne).reduce((ce,Se)=>Object.assign(ce,{[Se]:lt(ne[Se])}),{})}static fromObject(ne){const ce=this.createCore(ne);return new Ut(ce)}get(ne){return this.valMap_[ne].rawValue}set(ne,ce){this.valMap_[ne].rawValue=ce}value(ne){return this.valMap_[ne]}}function dn(_e){return ne=>ce=>{if(!ne&&ce===void 0)return{succeeded:!1,value:void 0};if(ne&&ce===void 0)return{succeeded:!0,value:void 0};const Se=_e(ce);return Se!==void 0?{succeeded:!0,value:Se}:{succeeded:!1,value:void 0}}}function nn(_e){return{custom:ne=>dn(ne)(_e),boolean:dn(ne=>typeof ne=="boolean"?ne:void 0)(_e),number:dn(ne=>typeof ne=="number"?ne:void 0)(_e),string:dn(ne=>typeof ne=="string"?ne:void 0)(_e),function:dn(ne=>typeof ne=="function"?ne:void 0)(_e),constant:ne=>dn(ce=>ce===ne?ne:void 0)(_e),raw:dn(ne=>ne)(_e),object:ne=>dn(ce=>{if((Se=ce)!==null&&typeof Se=="object")return function(qe,gt){return Object.keys(gt).reduce((Pt,cn)=>{if(Pt===void 0)return;const Vn=(0,gt[cn])(qe[cn]);return Vn.succeeded?Object.assign(Object.assign({},Pt),{[cn]:Vn.value}):void 0},{})}(ce,ne);var Se})(_e),array:ne=>dn(ce=>{if(Array.isArray(ce))return Se=ne,ce.reduce((qe,gt)=>{if(qe===void 0)return;const Pt=Se(gt);return Pt.succeeded&&Pt.value!==void 0?[...qe,Pt.value]:void 0},[]);var Se})(_e)}}const un={optional:nn(!0),required:nn(!1)};function Zt(_e,ne){const ce=un.required.object(ne)(_e);return ce.succeeded?ce.value:void 0}const pn=nt(""),ln={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class vn{constructor(ne){this.parent_=null,this.blade=ne.blade,this.view=ne.view,this.viewProps=ne.viewProps;const ce=this.view.element;this.blade.value("positions").emitter.on("change",()=>{["veryfirst","first","last","verylast"].forEach(Se=>{ce.classList.remove(pn(void 0,ln[Se]))}),this.blade.get("positions").forEach(Se=>{ce.classList.add(pn(void 0,ln[Se]))})}),this.viewProps.handleDispose(()=>{(function(Se){Se&&Se.parentElement&&Se.parentElement.removeChild(Se)})(ce)})}get parent(){return this.parent_}}const ht="http://www.w3.org/2000/svg";function Jt(_e){_e.offsetHeight}function en(_e){return _e.ontouchstart!==void 0}function Cn(){return new Function("return this")().document}const Vt={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Je(_e,ne){const ce=_e.createElementNS(ht,"svg");return ce.innerHTML=Vt[ne],ce}function ot(_e,ne,ce){_e.insertBefore(ne,_e.children[ce])}function Rt(_e){_e.parentElement&&_e.parentElement.removeChild(_e)}function Mn(_e){for(;_e.children.length>0;)_e.removeChild(_e.children[0])}function Pn(_e){return _e.relatedTarget?_e.relatedTarget:"explicitOriginalTarget"in _e?_e.explicitOriginalTarget:null}const Rn=nt("lbl");class hi{constructor(ne,ce){this.element=ne.createElement("div"),this.element.classList.add(Rn()),ce.viewProps.bindClassModifiers(this.element);const Se=ne.createElement("div");Se.classList.add(Rn("l")),st(ce.props,"label",gt=>{ke(gt)?this.element.classList.add(Rn(void 0,"nol")):(this.element.classList.remove(Rn(void 0,"nol")),function(Pt){for(;Pt.childNodes.length>0;)Pt.removeChild(Pt.childNodes[0])}(Se),Se.appendChild(function(Pt,cn){const Vn=Pt.createDocumentFragment();return cn.split(`
`).map(vi=>Pt.createTextNode(vi)).forEach((vi,Ti)=>{Ti>0&&Vn.appendChild(Pt.createElement("br")),Vn.appendChild(vi)}),Vn}(ne,gt)))}),this.element.appendChild(Se),this.labelElement=Se;const qe=ne.createElement("div");qe.classList.add(Rn("v")),this.element.appendChild(qe),this.valueElement=qe}}class $n extends vn{constructor(ne,ce){const Se=ce.valueController.viewProps;super(Object.assign(Object.assign({},ce),{view:new hi(ne,{props:ce.props,viewProps:Se}),viewProps:Se})),this.props=ce.props,this.valueController=ce.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const ji={id:"button",type:"blade",accept(_e){const ne=un,ce=Zt(_e,{title:ne.required.string,view:ne.required.constant("button"),label:ne.optional.string});return ce?{params:ce}:null},controller:_e=>new $n(_e.document,{blade:_e.blade,props:Ut.fromObject({label:_e.params.label}),valueController:new Qe(_e.document,{props:Ut.fromObject({title:_e.params.title}),viewProps:_e.viewProps})}),api:_e=>_e.controller instanceof $n&&_e.controller.valueController instanceof Qe?new Ge(_e.controller):null};class Li extends vn{constructor(ne){super(ne),this.value=ne.value}}function dr(){return new Ut({positions:lt([],{equals:Le})})}class Ri extends Ut{constructor(ne){super(ne)}static create(ne){const ce={completed:!0,expanded:ne,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},Se=Ut.createCore(ce);return new Ri(Se)}get styleExpanded(){var ne;return(ne=this.get("temporaryExpanded"))!==null&&ne!==void 0?ne:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const ne=this.get("expandedHeight");return this.get("shouldFixHeight")&&!ke(ne)?`${ne}px`:"auto"}bindExpandedClass(ne,ce){const Se=()=>{this.styleExpanded?ne.classList.add(ce):ne.classList.remove(ce)};st(this,"expanded",Se),st(this,"temporaryExpanded",Se)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function $t(_e,ne){ne.style.height=_e.styleHeight}function ir(_e,ne){_e.value("expanded").emitter.on("beforechange",()=>{_e.set("completed",!1),ke(_e.get("expandedHeight"))&&_e.set("expandedHeight",function(ce,Se){let qe=0;return function(gt,Pt){const cn=gt.style.transition;gt.style.transition="none",Pt(),gt.style.transition=cn}(Se,()=>{ce.set("expandedHeight",null),ce.set("temporaryExpanded",!0),Jt(Se),qe=Se.clientHeight,ce.set("temporaryExpanded",null),Jt(Se)}),qe}(_e,ne)),_e.set("shouldFixHeight",!0),Jt(ne)}),_e.emitter.on("change",()=>{$t(_e,ne)}),$t(_e,ne),ne.addEventListener("transitionend",ce=>{ce.propertyName==="height"&&_e.cleanUpTransition()})}class or extends _{constructor(ne,ce){super(ne),this.rackApi_=ce}}class ms{constructor(ne){this.emitter=new et,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=ne}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(ne){for(const ce of this.allItems())if(ne(ce))return ce;return null}includes(ne){return this.cache_.has(ne)}add(ne,ce){if(this.includes(ne))throw tt.shouldNeverHappen();const Se=ce!==void 0?ce:this.items_.length;this.items_.splice(Se,0,ne),this.cache_.add(ne);const qe=this.extract_(ne);qe&&(qe.emitter.on("add",this.onSubListAdd_),qe.emitter.on("remove",this.onSubListRemove_),qe.allItems().forEach(gt=>{this.cache_.add(gt)})),this.emitter.emit("add",{index:Se,item:ne,root:this,target:this})}remove(ne){const ce=this.items_.indexOf(ne);if(ce<0)return;this.items_.splice(ce,1),this.cache_.delete(ne);const Se=this.extract_(ne);Se&&(Se.emitter.off("add",this.onSubListAdd_),Se.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:ce,item:ne,root:this,target:this})}onSubListAdd_(ne){this.cache_.add(ne.item),this.emitter.emit("add",{index:ne.index,item:ne.item,root:this,target:ne.target})}onSubListRemove_(ne){this.cache_.delete(ne.item),this.emitter.emit("remove",{index:ne.index,item:ne.item,root:this,target:ne.target})}}class Rr extends _{constructor(ne){super(ne),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new et,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(ne){this.controller_.props.set("label",ne)}on(ne,ce){const Se=ce.bind(this);return this.emitter_.on(ne,qe=>{Se(qe.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(ne){const ce=ne.sender.target.read();this.emitter_.emit("change",{event:new ve(this,ce,this.controller_.binding.target.presetKey,ne.options.last)})}}class Cr extends $n{constructor(ne,ce){super(ne,ce),this.binding=ce.binding}}class Mr extends _{constructor(ne){super(ne),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new et,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(ne){this.controller_.props.set("label",ne)}on(ne,ce){const Se=ce.bind(this);return this.emitter_.on(ne,qe=>{Se(qe.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(ne){const ce=ne.sender.target.read();this.emitter_.emit("update",{event:new we(this,ce,this.controller_.binding.target.presetKey)})}}class Tr extends $n{constructor(ne,ce){super(ne,ce),this.binding=ce.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function Is(_e){return _e instanceof ss?_e.apiSet_:_e instanceof or?_e.rackApi_.apiSet_:null}function pr(_e,ne){const ce=_e.find(Se=>Se.controller_===ne);if(!ce)throw tt.shouldNeverHappen();return ce}function rr(_e,ne,ce){if(!Ke.isBindable(_e))throw tt.notBindable();return new Ke(_e,ne,ce)}class ss extends _{constructor(ne,ce){super(ne),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new et,this.apiSet_=new ms(Is),this.pool_=ce;const Se=this.controller_.rack;Se.emitter.on("add",this.onRackAdd_),Se.emitter.on("remove",this.onRackRemove_),Se.emitter.on("inputchange",this.onRackInputChange_),Se.emitter.on("monitorupdate",this.onRackMonitorUpdate_),Se.children.forEach(qe=>{this.setUpApi_(qe)})}get children(){return this.controller_.rack.children.map(ne=>pr(this.apiSet_,ne))}addInput(ne,ce,Se){const qe=Se||{},gt=this.controller_.view.element.ownerDocument,Pt=this.pool_.createInput(gt,rr(ne,ce,qe.presetKey),qe),cn=new Rr(Pt);return this.add(cn,qe.index)}addMonitor(ne,ce,Se){const qe=Se||{},gt=this.controller_.view.element.ownerDocument,Pt=this.pool_.createMonitor(gt,rr(ne,ce),qe),cn=new Mr(Pt);return this.add(cn,qe.index)}addFolder(ne){return function(ce,Se){return ce.addBlade(Object.assign(Object.assign({},Se),{view:"folder"}))}(this,ne)}addButton(ne){return function(ce,Se){return ce.addBlade(Object.assign(Object.assign({},Se),{view:"button"}))}(this,ne)}addSeparator(ne){return function(ce,Se){const qe=Se||{};return ce.addBlade(Object.assign(Object.assign({},qe),{view:"separator"}))}(this,ne)}addTab(ne){return function(ce,Se){return ce.addBlade(Object.assign(Object.assign({},Se),{view:"tab"}))}(this,ne)}add(ne,ce){this.controller_.rack.add(ne.controller_,ce);const Se=this.apiSet_.find(qe=>qe.controller_===ne.controller_);return Se&&this.apiSet_.remove(Se),this.apiSet_.add(ne),ne}remove(ne){this.controller_.rack.remove(ne.controller_)}addBlade(ne){const ce=this.controller_.view.element.ownerDocument,Se=this.pool_.createBlade(ce,ne),qe=this.pool_.createBladeApi(Se);return this.add(qe,ne.index)}on(ne,ce){const Se=ce.bind(this);return this.emitter_.on(ne,qe=>{Se(qe.event)}),this}setUpApi_(ne){this.apiSet_.find(ce=>ce.controller_===ne)||this.apiSet_.add(this.pool_.createBladeApi(ne))}onRackAdd_(ne){this.setUpApi_(ne.bladeController)}onRackRemove_(ne){if(ne.isRoot){const ce=pr(this.apiSet_,ne.bladeController);this.apiSet_.remove(ce)}}onRackInputChange_(ne){const ce=ne.bladeController;if(ce instanceof Cr){const Se=pr(this.apiSet_,ce),qe=ce.binding;this.emitter_.emit("change",{event:new ve(Se,qe.target.read(),qe.target.presetKey,ne.options.last)})}else if(ce instanceof Li){const Se=pr(this.apiSet_,ce);this.emitter_.emit("change",{event:new ve(Se,ce.value.rawValue,void 0,ne.options.last)})}}onRackMonitorUpdate_(ne){if(!(ne.bladeController instanceof Tr))throw tt.shouldNeverHappen();const ce=pr(this.apiSet_,ne.bladeController),Se=ne.bladeController.binding;this.emitter_.emit("update",{event:new we(ce,Se.target.read(),Se.target.presetKey)})}}class Gr extends or{constructor(ne,ce){super(ne,new ss(ne.rackController,ce)),this.emitter_=new et,this.controller_.foldable.value("expanded").emitter.on("change",Se=>{this.emitter_.emit("fold",{event:new Me(this,Se.sender.rawValue)})}),this.rackApi_.on("change",Se=>{this.emitter_.emit("change",{event:Se})}),this.rackApi_.on("update",Se=>{this.emitter_.emit("update",{event:Se})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(ne){this.controller_.foldable.set("expanded",ne)}get title(){return this.controller_.props.get("title")}set title(ne){this.controller_.props.set("title",ne)}get children(){return this.rackApi_.children}addInput(ne,ce,Se){return this.rackApi_.addInput(ne,ce,Se)}addMonitor(ne,ce,Se){return this.rackApi_.addMonitor(ne,ce,Se)}addFolder(ne){return this.rackApi_.addFolder(ne)}addButton(ne){return this.rackApi_.addButton(ne)}addSeparator(ne){return this.rackApi_.addSeparator(ne)}addTab(ne){return this.rackApi_.addTab(ne)}add(ne,ce){return this.rackApi_.add(ne,ce)}remove(ne){this.rackApi_.remove(ne)}addBlade(ne){return this.rackApi_.addBlade(ne)}on(ne,ce){const Se=ce.bind(this);return this.emitter_.on(ne,qe=>{Se(qe.event)}),this}}class Br extends vn{constructor(ne){super({blade:ne.blade,view:ne.view,viewProps:ne.rackController.viewProps}),this.rackController=ne.rackController}}class pa{constructor(ne,ce){const Se=nt(ce.viewName);this.element=ne.createElement("div"),this.element.classList.add(Se()),ce.viewProps.bindClassModifiers(this.element)}}function Qr(_e){return _e instanceof ho?_e.rack:_e instanceof Br?_e.rackController.rack:null}function Hs(_e){const ne=Qr(_e);return ne?ne.bcSet_:null}class Ur{constructor(ne){var ce;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new et,this.blade_=ne??null,(ce=this.blade_)===null||ce===void 0||ce.value("positions").emitter.on("change",this.onBladePositionsChange_),this.bcSet_=new ms(Hs),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(ne,ce){ne.parent&&ne.parent.remove(ne),ne.parent_=this,this.bcSet_.add(ne,ce)}remove(ne){ne.parent_=null,this.bcSet_.remove(ne)}find(ne){return this.bcSet_.allItems().filter(ce=>ce instanceof ne)}onSetAdd_(ne){this.updatePositions_();const ce=ne.target===ne.root;if(this.emitter.emit("add",{bladeController:ne.item,index:ne.index,isRoot:ce,sender:this}),!ce)return;const Se=ne.item;if(Se.viewProps.emitter.on("change",this.onChildViewPropsChange_),Se.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),Se.viewProps.handleDispose(this.onChildDispose_),Se instanceof Cr)Se.binding.emitter.on("change",this.onChildInputChange_);else if(Se instanceof Tr)Se.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(Se instanceof Li)Se.value.emitter.on("change",this.onChildValueChange_);else{const qe=Qr(Se);if(qe){const gt=qe.emitter;gt.on("layout",this.onDescendantLayout_),gt.on("inputchange",this.onDescendantInputChange_),gt.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(ne){this.updatePositions_();const ce=ne.target===ne.root;if(this.emitter.emit("remove",{bladeController:ne.item,isRoot:ce,sender:this}),!ce)return;const Se=ne.item;if(Se instanceof Cr)Se.binding.emitter.off("change",this.onChildInputChange_);else if(Se instanceof Tr)Se.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(Se instanceof Li)Se.value.emitter.off("change",this.onChildValueChange_);else{const qe=Qr(Se);if(qe){const gt=qe.emitter;gt.off("layout",this.onDescendantLayout_),gt.off("inputchange",this.onDescendantInputChange_),gt.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const ne=this.bcSet_.items.filter(qe=>!qe.viewProps.get("hidden")),ce=ne[0],Se=ne[ne.length-1];this.bcSet_.items.forEach(qe=>{const gt=[];qe===ce&&(gt.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||gt.push("veryfirst")),qe===Se&&(gt.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||gt.push("verylast")),qe.blade.set("positions",gt)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(ne){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(ne=>ne.viewProps.get("disposed")).forEach(ne=>{this.bcSet_.remove(ne)})}onChildInputChange_(ne){const ce=function(Se,qe){for(let gt=0;gt<Se.length;gt++){const Pt=Se[gt];if(Pt instanceof Cr&&Pt.binding===qe)return Pt}return null}(this.find(Cr),ne.sender);if(!ce)throw tt.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:ce,options:ne.options,sender:this})}onChildMonitorUpdate_(ne){const ce=function(Se,qe){for(let gt=0;gt<Se.length;gt++){const Pt=Se[gt];if(Pt instanceof Tr&&Pt.binding===qe)return Pt}return null}(this.find(Tr),ne.sender);if(!ce)throw tt.shouldNeverHappen();this.emitter.emit("monitorupdate",{bladeController:ce,sender:this})}onChildValueChange_(ne){const ce=function(Se,qe){for(let gt=0;gt<Se.length;gt++){const Pt=Se[gt];if(Pt instanceof Li&&Pt.value===qe)return Pt}return null}(this.find(Li),ne.sender);if(!ce)throw tt.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:ce,options:ne.options,sender:this})}onDescendantLayout_(ne){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(ne){this.emitter.emit("inputchange",{bladeController:ne.bladeController,options:ne.options,sender:this})}onDescendantMonitorUpdate_(ne){this.emitter.emit("monitorupdate",{bladeController:ne.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class ho extends vn{constructor(ne,ce){super(Object.assign(Object.assign({},ce),{view:new pa(ne,{viewName:"brk",viewProps:ce.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const Se=new Ur(ce.root?void 0:ce.blade);Se.emitter.on("add",this.onRackAdd_),Se.emitter.on("remove",this.onRackRemove_),this.rack=Se,this.viewProps.handleDispose(()=>{for(let qe=this.rack.children.length-1;qe>=0;qe--)this.rack.children[qe].viewProps.set("disposed",!0)})}onRackAdd_(ne){ne.isRoot&&ot(this.view.element,ne.bladeController.view.element,ne.index)}onRackRemove_(ne){ne.isRoot&&Rt(ne.bladeController.view.element)}}const fa=nt("cnt");class oi{constructor(ne,ce){this.className_=nt(ce.viewName||"fld"),this.element=ne.createElement("div"),this.element.classList.add(this.className_(),fa()),ce.viewProps.bindClassModifiers(this.element),this.foldable_=ce.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),st(this.foldable_,"completed",Et(this.element,this.className_(void 0,"cpl")));const Se=ne.createElement("button");Se.classList.add(this.className_("b")),st(ce.props,"title",cn=>{ke(cn)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),ce.viewProps.bindDisabled(Se),this.element.appendChild(Se),this.buttonElement=Se;const qe=ne.createElement("div");qe.classList.add(this.className_("t")),rt(ce.props.value("title"),qe),this.buttonElement.appendChild(qe),this.titleElement=qe;const gt=ne.createElement("div");gt.classList.add(this.className_("m")),this.buttonElement.appendChild(gt);const Pt=ce.containerElement;Pt.classList.add(this.className_("c")),this.element.appendChild(Pt),this.containerElement=Pt}}class Er extends Br{constructor(ne,ce){var Se;const qe=Ri.create((Se=ce.expanded)===null||Se===void 0||Se),gt=new ho(ne,{blade:ce.blade,root:ce.root,viewProps:ce.viewProps});super(Object.assign(Object.assign({},ce),{rackController:gt,view:new oi(ne,{containerElement:gt.view.element,foldable:qe,props:ce.props,viewName:ce.root?"rot":void 0,viewProps:ce.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=ce.props,this.foldable=qe,ir(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const Bs={id:"folder",type:"blade",accept(_e){const ne=un,ce=Zt(_e,{title:ne.required.string,view:ne.required.constant("folder"),expanded:ne.optional.boolean});return ce?{params:ce}:null},controller:_e=>new Er(_e.document,{blade:_e.blade,expanded:_e.params.expanded,props:Ut.fromObject({title:_e.params.title}),viewProps:_e.viewProps}),api:_e=>_e.controller instanceof Er?new Gr(_e.controller,_e.pool):null};class as extends Li{constructor(ne,ce){const Se=ce.valueController.viewProps;super(Object.assign(Object.assign({},ce),{value:ce.valueController.value,view:new hi(ne,{props:ce.props,viewProps:Se}),viewProps:Se})),this.props=ce.props,this.valueController=ce.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class po extends _{}const io=nt("spr");class ea{constructor(ne,ce){this.element=ne.createElement("div"),this.element.classList.add(io()),ce.viewProps.bindClassModifiers(this.element);const Se=ne.createElement("hr");Se.classList.add(io("r")),this.element.appendChild(Se)}}class kt extends vn{constructor(ne,ce){super(Object.assign(Object.assign({},ce),{view:new ea(ne,{viewProps:ce.viewProps})}))}}const Zr={id:"separator",type:"blade",accept(_e){const ne=Zt(_e,{view:un.required.constant("separator")});return ne?{params:ne}:null},controller:_e=>new kt(_e.document,{blade:_e.blade,viewProps:_e.viewProps}),api:_e=>_e.controller instanceof kt?new po(_e.controller):null},To=nt("");function Bi(_e,ne){return Et(_e,To(void 0,ne))}class qn extends Ut{constructor(ne){super(ne)}static create(ne){var ce,Se;const qe=ne??{},gt={disabled:(ce=qe.disabled)!==null&&ce!==void 0&&ce,disposed:!1,hidden:(Se=qe.hidden)!==null&&Se!==void 0&&Se},Pt=Ut.createCore(gt);return new qn(Pt)}bindClassModifiers(ne){st(this,"disabled",Bi(ne,"disabled")),st(this,"hidden",Bi(ne,"hidden"))}bindDisabled(ne){st(this,"disabled",ce=>{ne.disabled=ce})}bindTabIndex(ne){st(this,"disabled",ce=>{ne.tabIndex=ce?-1:0})}handleDispose(ne){this.value("disposed").emitter.on("change",ce=>{ce&&ne()})}}const bn=nt("tbi");class Mi{constructor(ne,ce){this.element=ne.createElement("div"),this.element.classList.add(bn()),ce.viewProps.bindClassModifiers(this.element),st(ce.props,"selected",gt=>{gt?this.element.classList.add(bn(void 0,"sel")):this.element.classList.remove(bn(void 0,"sel"))});const Se=ne.createElement("button");Se.classList.add(bn("b")),ce.viewProps.bindDisabled(Se),this.element.appendChild(Se),this.buttonElement=Se;const qe=ne.createElement("div");qe.classList.add(bn("t")),rt(ce.props.value("title"),qe),this.buttonElement.appendChild(qe),this.titleElement=qe}}class ki{constructor(ne,ce){this.emitter=new et,this.onClick_=this.onClick_.bind(this),this.props=ce.props,this.viewProps=ce.viewProps,this.view=new Mi(ne,{props:ce.props,viewProps:ce.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Ii{constructor(ne,ce){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new ki(ne,{props:ce.itemProps,viewProps:qn.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new ho(ne,{blade:dr(),viewProps:qn.create()}),this.props=ce.props,st(this.props,"selected",Se=>{this.itemController.props.set("selected",Se),this.contentController.viewProps.set("hidden",!Se)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class Fr{constructor(ne,ce){this.controller_=ne,this.rackApi_=ce}get title(){var ne;return(ne=this.controller_.itemController.props.get("title"))!==null&&ne!==void 0?ne:""}set title(ne){this.controller_.itemController.props.set("title",ne)}get selected(){return this.controller_.props.get("selected")}set selected(ne){this.controller_.props.set("selected",ne)}get children(){return this.rackApi_.children}addButton(ne){return this.rackApi_.addButton(ne)}addFolder(ne){return this.rackApi_.addFolder(ne)}addSeparator(ne){return this.rackApi_.addSeparator(ne)}addTab(ne){return this.rackApi_.addTab(ne)}add(ne,ce){this.rackApi_.add(ne,ce)}remove(ne){this.rackApi_.remove(ne)}addInput(ne,ce,Se){return this.rackApi_.addInput(ne,ce,Se)}addMonitor(ne,ce,Se){return this.rackApi_.addMonitor(ne,ce,Se)}addBlade(ne){return this.rackApi_.addBlade(ne)}}class Sr extends or{constructor(ne,ce){super(ne,new ss(ne.rackController,ce)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.emitter_=new et,this.pageApiMap_=new Map,this.rackApi_.on("change",Se=>{this.emitter_.emit("change",{event:Se})}),this.rackApi_.on("update",Se=>{this.emitter_.emit("update",{event:Se})}),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(Se=>{this.setUpPageApi_(Se)})}get pages(){return this.controller_.pageSet.items.map(ne=>{const ce=this.pageApiMap_.get(ne);if(!ce)throw tt.shouldNeverHappen();return ce})}addPage(ne){const ce=this.controller_.view.element.ownerDocument,Se=new Ii(ce,{itemProps:Ut.fromObject({selected:!1,title:ne.title}),props:Ut.fromObject({selected:!1})});this.controller_.add(Se,ne.index);const qe=this.pageApiMap_.get(Se);if(!qe)throw tt.shouldNeverHappen();return qe}removePage(ne){this.controller_.remove(ne)}on(ne,ce){const Se=ce.bind(this);return this.emitter_.on(ne,qe=>{Se(qe.event)}),this}setUpPageApi_(ne){const ce=this.rackApi_.apiSet_.find(qe=>qe.controller_===ne.contentController);if(!ce)throw tt.shouldNeverHappen();const Se=new Fr(ne,ce);this.pageApiMap_.set(ne,Se)}onPageAdd_(ne){this.setUpPageApi_(ne.item)}onPageRemove_(ne){if(!this.pageApiMap_.get(ne.item))throw tt.shouldNeverHappen();this.pageApiMap_.delete(ne.item)}}const _r=nt("tab");class ls{constructor(ne,ce){this.element=ne.createElement("div"),this.element.classList.add(_r(),fa()),ce.viewProps.bindClassModifiers(this.element),Ze(ce.empty,Et(this.element,_r(void 0,"nop")));const Se=ne.createElement("div");Se.classList.add(_r("i")),this.element.appendChild(Se),this.itemsElement=Se;const qe=ce.contentsElement;qe.classList.add(_r("c")),this.element.appendChild(qe),this.contentsElement=qe}}class Ss extends Br{constructor(ne,ce){const Se=new ho(ne,{blade:ce.blade,viewProps:ce.viewProps}),qe=lt(!0);super({blade:ce.blade,rackController:Se,view:new ls(ne,{contentsElement:Se.view.element,empty:qe,viewProps:ce.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onPageSelectedChange_=this.onPageSelectedChange_.bind(this),this.pageSet_=new ms(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.empty_=qe,this.applyPages_()}get pageSet(){return this.pageSet_}add(ne,ce){this.pageSet_.add(ne,ce??this.pageSet_.items.length)}remove(ne){this.pageSet_.remove(this.pageSet_.items[ne])}applyPages_(){this.keepSelection_(),this.empty_.rawValue=this.pageSet_.items.length===0}onPageAdd_(ne){const ce=ne.item;ot(this.view.itemsElement,ce.itemController.view.element,ne.index),this.rackController.rack.add(ce.contentController,ne.index),ce.props.value("selected").emitter.on("change",this.onPageSelectedChange_),this.applyPages_()}onPageRemove_(ne){const ce=ne.item;Rt(ce.itemController.view.element),this.rackController.rack.remove(ce.contentController),ce.props.value("selected").emitter.off("change",this.onPageSelectedChange_),this.applyPages_()}keepSelection_(){if(this.pageSet_.items.length===0)return;const ne=this.pageSet_.items.findIndex(ce=>ce.props.get("selected"));ne<0?this.pageSet_.items.forEach((ce,Se)=>{ce.props.set("selected",Se===0)}):this.pageSet_.items.forEach((ce,Se)=>{ce.props.set("selected",Se===ne)})}onPageSelectedChange_(ne){if(ne.rawValue){const ce=this.pageSet_.items.findIndex(Se=>Se.props.value("selected")===ne.sender);this.pageSet_.items.forEach((Se,qe)=>{Se.props.set("selected",qe===ce)})}else this.keepSelection_()}}const Ir={id:"tab",type:"blade",accept(_e){const ne=un,ce=Zt(_e,{pages:ne.required.array(ne.required.object({title:ne.required.string})),view:ne.required.constant("tab")});return ce&&ce.pages.length!==0?{params:ce}:null},controller(_e){const ne=new Ss(_e.document,{blade:_e.blade,viewProps:_e.viewProps});return _e.params.pages.forEach(ce=>{const Se=new Ii(_e.document,{itemProps:Ut.fromObject({selected:!1,title:ce.title}),props:Ut.fromObject({selected:!1})});ne.add(Se)}),ne},api:_e=>_e.controller instanceof Ss?new Sr(_e.controller,_e.pool):null};class es{constructor(){this.disabled=!1,this.emitter=new et}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class Io{constructor(ne,ce){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=ne,this.emitter=new et,this.interval_=ce,this.setTimer_()}get disabled(){return this.disabled_}set disabled(ne){this.disabled_=ne,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const ne=this.doc_.defaultView;ne&&ne.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const ne=this.doc_.defaultView;ne&&(this.timerId_=ne.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Cs{constructor(ne){this.constraints=ne}constrain(ne){return this.constraints.reduce((ce,Se)=>Se.constrain(ce),ne)}}function kr(_e,ne){if(_e instanceof ne)return _e;if(_e instanceof Cs){const ce=_e.constraints.reduce((Se,qe)=>Se||(qe instanceof ne?qe:null),null);if(ce)return ce}return null}class Hr{constructor(ne){this.options=ne}constrain(ne){const ce=this.options;return ce.length===0||ce.filter(Se=>Se.value===ne).length>0?ne:ce[0].value}}class Vi{constructor(ne){this.maxValue=ne.max,this.minValue=ne.min}constrain(ne){let ce=ne;return ke(this.minValue)||(ce=Math.max(ce,this.minValue)),ke(this.maxValue)||(ce=Math.min(ce,this.maxValue)),ce}}class Ys{constructor(ne){this.step=ne}constrain(ne){return(ne<0?-Math.round(-ne/this.step):Math.round(ne/this.step))*this.step}}const Ms=nt("lst");class os{constructor(ne,ce){this.onValueChange_=this.onValueChange_.bind(this),this.props_=ce.props,this.element=ne.createElement("div"),this.element.classList.add(Ms()),ce.viewProps.bindClassModifiers(this.element);const Se=ne.createElement("select");Se.classList.add(Ms("s")),st(this.props_,"options",gt=>{Mn(Se),gt.forEach((Pt,cn)=>{const Vn=ne.createElement("option");Vn.dataset.index=String(cn),Vn.textContent=Pt.text,Vn.value=String(Pt.value),Se.appendChild(Vn)})}),ce.viewProps.bindDisabled(Se),this.element.appendChild(Se),this.selectElement=Se;const qe=ne.createElement("div");qe.classList.add(Ms("m")),qe.appendChild(Je(ne,"dropdown")),this.element.appendChild(qe),ce.value.emitter.on("change",this.onValueChange_),this.value_=ce.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class vr{constructor(ne,ce){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=ce.props,this.value=ce.value,this.viewProps=ce.viewProps,this.view=new os(ne,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(ne){const ce=ne.currentTarget.selectedOptions.item(0);if(!ce)return;const Se=Number(ce.dataset.index);this.value.rawValue=this.props.get("options")[Se].value}}const Xn=nt("pop");class Ha{constructor(ne,ce){this.element=ne.createElement("div"),this.element.classList.add(Xn()),ce.viewProps.bindClassModifiers(this.element),Ze(ce.shows,Et(this.element,Xn(void 0,"v")))}}class ai{constructor(ne,ce){this.shows=lt(!1),this.viewProps=ce.viewProps,this.view=new Ha(ne,{shows:this.shows,viewProps:this.viewProps})}}const fo=nt("txt");class Xs{constructor(ne,ce){this.onChange_=this.onChange_.bind(this),this.element=ne.createElement("div"),this.element.classList.add(fo()),ce.viewProps.bindClassModifiers(this.element),this.props_=ce.props,this.props_.emitter.on("change",this.onChange_);const Se=ne.createElement("input");Se.classList.add(fo("i")),Se.type="text",ce.viewProps.bindDisabled(Se),this.element.appendChild(Se),this.inputElement=Se,ce.value.emitter.on("change",this.onChange_),this.value_=ce.value,this.refresh()}refresh(){const ne=this.props_.get("formatter");this.inputElement.value=ne(this.value_.rawValue)}onChange_(){this.refresh()}}class lr{constructor(ne,ce){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=ce.parser,this.props=ce.props,this.value=ce.value,this.viewProps=ce.viewProps,this.view=new Xs(ne,{props:ce.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(ne){const ce=ne.currentTarget.value,Se=this.parser_(ce);ke(Se)||(this.value.rawValue=Se),this.view.refresh()}}function cr(_e){return _e!=="false"&&!!_e}function ml(_e){return function(ne){return String(ne)}(_e)}class su{constructor(ne){this.text=ne}evaluate(){return Number(this.text)}toString(){return this.text}}const Ec={"**":(_e,ne)=>Math.pow(_e,ne),"*":(_e,ne)=>_e*ne,"/":(_e,ne)=>_e/ne,"%":(_e,ne)=>_e%ne,"+":(_e,ne)=>_e+ne,"-":(_e,ne)=>_e-ne,"<<":(_e,ne)=>_e<<ne,">>":(_e,ne)=>_e>>ne,">>>":(_e,ne)=>_e>>>ne,"&":(_e,ne)=>_e&ne,"^":(_e,ne)=>_e^ne,"|":(_e,ne)=>_e|ne};class ou{constructor(ne,ce,Se){this.left=ce,this.operator=ne,this.right=Se}evaluate(){const ne=Ec[this.operator];if(!ne)throw new Error(`unexpected binary operator: '${this.operator}`);return ne(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const ur={"+":_e=>_e,"-":_e=>-_e,"~":_e=>~_e};class Ju{constructor(ne,ce){this.operator=ne,this.expression=ce}evaluate(){const ne=ur[this.operator];if(!ne)throw new Error(`unexpected unary operator: '${this.operator}`);return ne(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function $u(_e){return(ne,ce)=>{for(let Se=0;Se<_e.length;Se++){const qe=_e[Se](ne,ce);if(qe!=="")return qe}return""}}function jl(_e,ne){var ce;const Se=_e.substr(ne).match(/^\s+/);return(ce=Se&&Se[0])!==null&&ce!==void 0?ce:""}function Sc(_e,ne){var ce;const Se=_e.substr(ne).match(/^[0-9]+/);return(ce=Se&&Se[0])!==null&&ce!==void 0?ce:""}function Zu(_e,ne){const ce=_e.substr(ne,1);if(ne+=1,ce.toLowerCase()!=="e")return"";const Se=function(qe,gt){const Pt=Sc(qe,gt);if(Pt!=="")return Pt;const cn=qe.substr(gt,1);if(cn!=="-"&&cn!=="+")return"";const Vn=Sc(qe,gt+=1);return Vn===""?"":cn+Vn}(_e,ne);return Se===""?"":ce+Se}function Xr(_e,ne){const ce=_e.substr(ne,1);if(ce==="0")return ce;const Se=function(qe,gt){const Pt=qe.substr(gt,1);return Pt.match(/^[1-9]$/)?Pt:""}(_e,ne);return ne+=Se.length,Se===""?"":Se+Sc(_e,ne)}const jr=$u([function(_e,ne){const ce=Xr(_e,ne);if(ne+=ce.length,ce==="")return"";const Se=_e.substr(ne,1);if(ne+=Se.length,Se!==".")return"";const qe=Sc(_e,ne);return ce+Se+qe+Zu(_e,ne+=qe.length)},function(_e,ne){const ce=_e.substr(ne,1);if(ne+=ce.length,ce!==".")return"";const Se=Sc(_e,ne);return ne+=Se.length,Se===""?"":ce+Se+Zu(_e,ne)},function(_e,ne){const ce=Xr(_e,ne);return ne+=ce.length,ce===""?"":ce+Zu(_e,ne)}]),Cc=$u([function(_e,ne){const ce=_e.substr(ne,2);if(ne+=ce.length,ce.toLowerCase()!=="0b")return"";const Se=function(qe,gt){var Pt;const cn=qe.substr(gt).match(/^[01]+/);return(Pt=cn&&cn[0])!==null&&Pt!==void 0?Pt:""}(_e,ne);return Se===""?"":ce+Se},function(_e,ne){const ce=_e.substr(ne,2);if(ne+=ce.length,ce.toLowerCase()!=="0o")return"";const Se=function(qe,gt){var Pt;const cn=qe.substr(gt).match(/^[0-7]+/);return(Pt=cn&&cn[0])!==null&&Pt!==void 0?Pt:""}(_e,ne);return Se===""?"":ce+Se},function(_e,ne){const ce=_e.substr(ne,2);if(ne+=ce.length,ce.toLowerCase()!=="0x")return"";const Se=function(qe,gt){var Pt;const cn=qe.substr(gt).match(/^[0-9a-f]+/i);return(Pt=cn&&cn[0])!==null&&Pt!==void 0?Pt:""}(_e,ne);return Se===""?"":ce+Se}]),ta=$u([Cc,jr]);function fp(_e,ne){return function(ce,Se){const qe=ta(ce,Se);return Se+=qe.length,qe===""?null:{evaluable:new su(qe),cursor:Se}}(_e,ne)||function(ce,Se){const qe=ce.substr(Se,1);if(Se+=qe.length,qe!=="(")return null;const gt=eh(ce,Se);if(!gt)return null;Se=gt.cursor,Se+=jl(ce,Se).length;const Pt=ce.substr(Se,1);return Se+=Pt.length,Pt!==")"?null:{evaluable:gt.evaluable,cursor:Se}}(_e,ne)}function gl(_e,ne,ce){ce+=jl(ne,ce).length;const Se=_e.filter(qe=>ne.startsWith(qe,ce))[0];return Se?(ce+=Se.length,{cursor:ce+=jl(ne,ce).length,operator:Se}):null}const au=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((_e,ne)=>function(ce,Se){return(qe,gt)=>{const Pt=ce(qe,gt);if(!Pt)return null;gt=Pt.cursor;let cn=Pt.evaluable;for(;;){const Vn=gl(Se,qe,gt);if(!Vn)break;gt=Vn.cursor;const vi=ce(qe,gt);if(!vi)return null;gt=vi.cursor,cn=new ou(Vn.operator,cn,vi.evaluable)}return cn?{cursor:gt,evaluable:cn}:null}}(_e,ne),function _e(ne,ce){const Se=fp(ne,ce);if(Se)return Se;const qe=ne.substr(ce,1);if(ce+=qe.length,qe!=="+"&&qe!=="-"&&qe!=="~")return null;const gt=_e(ne,ce);return gt?{cursor:ce=gt.cursor,evaluable:new Ju(qe,gt.evaluable)}:null});function eh(_e,ne){return ne+=jl(_e,ne).length,au(_e,ne)}function ts(_e){var ne;const ce=function(Se){const qe=eh(Se,0);return qe?qe.cursor+jl(Se,qe.cursor).length!==Se.length?null:qe.evaluable:null}(_e);return(ne=ce==null?void 0:ce.evaluate())!==null&&ne!==void 0?ne:null}function Pa(_e){if(typeof _e=="number")return _e;if(typeof _e=="string"){const ne=ts(_e);if(!ke(ne))return ne}return 0}function zl(_e){return String(_e)}function ro(_e){return ne=>ne.toFixed(Math.max(Math.min(_e,20),0))}const ma=ro(0);function $h(_e){return ma(_e)+"%"}function th(_e){return String(_e)}function Mf(_e){return _e}function na(_e,ne){for(;_e.length<ne;)_e.push(void 0)}function cs(_e){const ne=[];return na(ne,_e),lt(ne)}function ia(_e){const ne=_e.indexOf(void 0);return ne<0?_e:_e.slice(0,ne)}function Mc({primary:_e,secondary:ne,forward:ce,backward:Se}){let qe=!1;function gt(Pt){qe||(qe=!0,Pt(),qe=!1)}_e.emitter.on("change",Pt=>{gt(()=>{ne.setRawValue(ce(_e,ne),Pt.options)})}),ne.emitter.on("change",Pt=>{gt(()=>{_e.setRawValue(Se(_e,ne),Pt.options)}),gt(()=>{ne.setRawValue(ce(_e,ne),Pt.options)})}),gt(()=>{ne.setRawValue(ce(_e,ne),{forceEmit:!1,last:!0})})}function Do(_e,ne){const ce=_e*(ne.altKey?.1:1)*(ne.shiftKey?10:1);return ne.upKey?+ce:ne.downKey?-ce:0}function Tc(_e){return{altKey:_e.altKey,downKey:_e.key==="ArrowDown",shiftKey:_e.shiftKey,upKey:_e.key==="ArrowUp"}}function Ks(_e){return{altKey:_e.altKey,downKey:_e.key==="ArrowLeft",shiftKey:_e.shiftKey,upKey:_e.key==="ArrowRight"}}function mp(_e){return function(ne){return ne==="ArrowUp"||ne==="ArrowDown"}(_e)||_e==="ArrowLeft"||_e==="ArrowRight"}function Tf(_e,ne){const ce=ne.ownerDocument.defaultView,Se=ne.getBoundingClientRect();return{x:_e.pageX-((ce&&ce.scrollX||0)+Se.left),y:_e.pageY-((ce&&ce.scrollY||0)+Se.top)}}class mo{constructor(ne){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=ne,this.emitter=new et,ne.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),ne.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),ne.addEventListener("touchend",this.onTouchEnd_),ne.addEventListener("mousedown",this.onMouseDown_)}computePosition_(ne){const ce=this.elem_.getBoundingClientRect();return{bounds:{width:ce.width,height:ce.height},point:ne?{x:ne.x,y:ne.y}:null}}onMouseDown_(ne){var ce;ne.preventDefault(),(ce=ne.currentTarget)===null||ce===void 0||ce.focus();const Se=this.elem_.ownerDocument;Se.addEventListener("mousemove",this.onDocumentMouseMove_),Se.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:ne.altKey,data:this.computePosition_(Tf(ne,this.elem_)),sender:this,shiftKey:ne.shiftKey})}onDocumentMouseMove_(ne){this.emitter.emit("move",{altKey:ne.altKey,data:this.computePosition_(Tf(ne,this.elem_)),sender:this,shiftKey:ne.shiftKey})}onDocumentMouseUp_(ne){const ce=this.elem_.ownerDocument;ce.removeEventListener("mousemove",this.onDocumentMouseMove_),ce.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:ne.altKey,data:this.computePosition_(Tf(ne,this.elem_)),sender:this,shiftKey:ne.shiftKey})}onTouchStart_(ne){ne.preventDefault();const ce=ne.targetTouches.item(0),Se=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:ne.altKey,data:this.computePosition_(ce?{x:ce.clientX-Se.left,y:ce.clientY-Se.top}:void 0),sender:this,shiftKey:ne.shiftKey}),this.lastTouch_=ce}onTouchMove_(ne){const ce=ne.targetTouches.item(0),Se=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:ne.altKey,data:this.computePosition_(ce?{x:ce.clientX-Se.left,y:ce.clientY-Se.top}:void 0),sender:this,shiftKey:ne.shiftKey}),this.lastTouch_=ce}onTouchEnd_(ne){var ce;const Se=(ce=ne.targetTouches.item(0))!==null&&ce!==void 0?ce:this.lastTouch_,qe=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:ne.altKey,data:this.computePosition_(Se?{x:Se.clientX-qe.left,y:Se.clientY-qe.top}:void 0),sender:this,shiftKey:ne.shiftKey})}}function zr(_e,ne,ce,Se,qe){return Se+(_e-ne)/(ce-ne)*(qe-Se)}function If(_e){return String(_e.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function tr(_e,ne,ce){return Math.min(Math.max(_e,ne),ce)}function lu(_e,ne){return(_e%ne+ne)%ne}const ga=nt("txt");class nh{constructor(ne,ce){this.onChange_=this.onChange_.bind(this),this.props_=ce.props,this.props_.emitter.on("change",this.onChange_),this.element=ne.createElement("div"),this.element.classList.add(ga(),ga(void 0,"num")),ce.arrayPosition&&this.element.classList.add(ga(void 0,ce.arrayPosition)),ce.viewProps.bindClassModifiers(this.element);const Se=ne.createElement("input");Se.classList.add(ga("i")),Se.type="text",ce.viewProps.bindDisabled(Se),this.element.appendChild(Se),this.inputElement=Se,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=ce.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(ga()),this.inputElement.classList.add(ga("i"));const qe=ne.createElement("div");qe.classList.add(ga("k")),this.element.appendChild(qe),this.knobElement=qe;const gt=ne.createElementNS(ht,"svg");gt.classList.add(ga("g")),this.knobElement.appendChild(gt);const Pt=ne.createElementNS(ht,"path");Pt.classList.add(ga("gb")),gt.appendChild(Pt),this.guideBodyElem_=Pt;const cn=ne.createElementNS(ht,"path");cn.classList.add(ga("gh")),gt.appendChild(cn),this.guideHeadElem_=cn;const Vn=ne.createElement("div");Vn.classList.add(nt("tt")()),this.knobElement.appendChild(Vn),this.tooltipElem_=Vn,ce.value.emitter.on("change",this.onChange_),this.value=ce.value,this.refresh()}onDraggingChange_(ne){if(ne.rawValue===null)return void this.element.classList.remove(ga(void 0,"drg"));this.element.classList.add(ga(void 0,"drg"));const ce=ne.rawValue/this.props_.get("draggingScale"),Se=ce+(ce>0?-1:ce<0?1:0),qe=tr(-Se,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${Se+qe},0 L${Se},4 L${Se+qe},8`,`M ${ce},-1 L${ce},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${ce},4`);const gt=this.props_.get("formatter");this.tooltipElem_.textContent=gt(this.value.rawValue),this.tooltipElem_.style.left=`${ce}px`}refresh(){const ne=this.props_.get("formatter");this.inputElement.value=ne(this.value.rawValue)}onChange_(){this.refresh()}}class Fs{constructor(ne,ce){this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=ce.baseStep,this.parser_=ce.parser,this.props=ce.props,this.value=ce.value,this.viewProps=ce.viewProps,this.dragging_=lt(null),this.view=new nh(ne,{arrayPosition:ce.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const Se=new mo(this.view.knobElement);Se.emitter.on("down",this.onPointerDown_),Se.emitter.on("move",this.onPointerMove_),Se.emitter.on("up",this.onPointerUp_)}onInputChange_(ne){const ce=ne.currentTarget.value,Se=this.parser_(ce);ke(Se)||(this.value.rawValue=Se),this.view.refresh()}onInputKeyDown_(ne){const ce=Do(this.baseStep_,Tc(ne));ce!==0&&this.value.setRawValue(this.value.rawValue+ce,{forceEmit:!1,last:!1})}onInputKeyUp_(ne){Do(this.baseStep_,Tc(ne))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(ne){if(!ne.point)return null;const ce=ne.point.x-ne.bounds.width/2;return this.originRawValue_+ce*this.props.get("draggingScale")}onPointerMove_(ne){const ce=this.computeDraggingValue_(ne.data);ce!==null&&(this.value.setRawValue(ce,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(ne){const ce=this.computeDraggingValue_(ne.data);ce!==null&&(this.value.setRawValue(ce,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const ih=nt("sld");class dg{constructor(ne,ce){this.onChange_=this.onChange_.bind(this),this.props_=ce.props,this.props_.emitter.on("change",this.onChange_),this.element=ne.createElement("div"),this.element.classList.add(ih()),ce.viewProps.bindClassModifiers(this.element);const Se=ne.createElement("div");Se.classList.add(ih("t")),ce.viewProps.bindTabIndex(Se),this.element.appendChild(Se),this.trackElement=Se;const qe=ne.createElement("div");qe.classList.add(ih("k")),this.trackElement.appendChild(qe),this.knobElement=qe,ce.value.emitter.on("change",this.onChange_),this.value=ce.value,this.update_()}update_(){const ne=tr(zr(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${ne}%`}onChange_(){this.update_()}}class xv{constructor(ne,ce){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=ce.baseStep,this.value=ce.value,this.viewProps=ce.viewProps,this.props=ce.props,this.view=new dg(ne,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new mo(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(ne,ce){ne.point&&this.value.setRawValue(zr(tr(ne.point.x,0,ne.bounds.width),0,ne.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),ce)}onPointerDownOrMove_(ne){this.handlePointerEvent_(ne.data,{forceEmit:!1,last:!1})}onPointerUp_(ne){this.handlePointerEvent_(ne.data,{forceEmit:!0,last:!0})}onKeyDown_(ne){const ce=Do(this.baseStep_,Ks(ne));ce!==0&&this.value.setRawValue(this.value.rawValue+ce,{forceEmit:!1,last:!1})}onKeyUp_(ne){Do(this.baseStep_,Ks(ne))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Wa=nt("sldtxt");class Df{constructor(ne,ce){this.element=ne.createElement("div"),this.element.classList.add(Wa());const Se=ne.createElement("div");Se.classList.add(Wa("s")),this.sliderView_=ce.sliderView,Se.appendChild(this.sliderView_.element),this.element.appendChild(Se);const qe=ne.createElement("div");qe.classList.add(Wa("t")),this.textView_=ce.textView,qe.appendChild(this.textView_.element),this.element.appendChild(qe)}}class gs{constructor(ne,ce){this.value=ce.value,this.viewProps=ce.viewProps,this.sliderC_=new xv(ne,{baseStep:ce.baseStep,props:ce.sliderProps,value:ce.value,viewProps:this.viewProps}),this.textC_=new Fs(ne,{baseStep:ce.baseStep,parser:ce.parser,props:ce.textProps,value:ce.value,viewProps:ce.viewProps}),this.view=new Df(ne,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function cu(_e,ne){_e.write(ne)}function rh(_e){const ne=un;return Array.isArray(_e)?ne.required.array(ne.required.object({text:ne.required.string,value:ne.required.raw}))(_e).value:typeof _e=="object"?ne.required.raw(_e).value:void 0}function jo(_e){if(_e==="inline"||_e==="popup")return _e}function qa(_e){const ne=un;return ne.required.object({max:ne.optional.number,min:ne.optional.number,step:ne.optional.number})(_e).value}function zo(_e){if(Array.isArray(_e))return _e;const ne=[];return Object.keys(_e).forEach(ce=>{ne.push({text:ce,value:_e[ce]})}),ne}function sh(_e){return ke(_e)?null:new Hr(zo(_e))}function Zh(_e){const ne=_e?kr(_e,Hr):null;return ne?ne.options:null}function gp(_e,ne){const ce=_e&&kr(_e,Ys);return ce?If(ce.step):Math.max(If(ne),2)}function uu(_e){const ne=function(ce){const Se=ce?kr(ce,Ys):null;return Se?Se.step:null}(_e);return ne??1}function hu(_e,ne){var ce;const Se=_e&&kr(_e,Ys),qe=Math.abs((ce=Se==null?void 0:Se.step)!==null&&ce!==void 0?ce:ne);return qe===0?.1:Math.pow(10,Math.floor(Math.log10(qe))-1)}const _s=nt("ckb");class pg{constructor(ne,ce){this.onValueChange_=this.onValueChange_.bind(this),this.element=ne.createElement("div"),this.element.classList.add(_s()),ce.viewProps.bindClassModifiers(this.element);const Se=ne.createElement("label");Se.classList.add(_s("l")),this.element.appendChild(Se);const qe=ne.createElement("input");qe.classList.add(_s("i")),qe.type="checkbox",Se.appendChild(qe),this.inputElement=qe,ce.viewProps.bindDisabled(this.inputElement);const gt=ne.createElement("div");gt.classList.add(_s("w")),Se.appendChild(gt);const Pt=Je(ne,"check");gt.appendChild(Pt),ce.value.emitter.on("change",this.onValueChange_),this.value=ce.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class Ev{constructor(ne,ce){this.onInputChange_=this.onInputChange_.bind(this),this.value=ce.value,this.viewProps=ce.viewProps,this.view=new pg(ne,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(ne){const ce=ne.currentTarget;this.value.rawValue=ce.checked}}const _p={id:"input-bool",type:"input",accept:(_e,ne)=>{if(typeof _e!="boolean")return null;const ce=Zt(ne,{options:un.optional.custom(rh)});return ce?{initialValue:_e,params:ce}:null},binding:{reader:_e=>cr,constraint:_e=>function(ne){const ce=[],Se=sh(ne.options);return Se&&ce.push(Se),new Cs(ce)}(_e.params),writer:_e=>cu},controller:_e=>{var ne;const ce=_e.document,Se=_e.value,qe=_e.constraint;return qe&&kr(qe,Hr)?new vr(ce,{props:Ut.fromObject({options:(ne=Zh(qe))!==null&&ne!==void 0?ne:[]}),value:Se,viewProps:_e.viewProps}):new Ev(ce,{value:Se,viewProps:_e.viewProps})}},_l=nt("col");class oh{constructor(ne,ce){this.element=ne.createElement("div"),this.element.classList.add(_l()),ce.foldable.bindExpandedClass(this.element,_l(void 0,"expanded")),st(ce.foldable,"completed",Et(this.element,_l(void 0,"cpl")));const Se=ne.createElement("div");Se.classList.add(_l("h")),this.element.appendChild(Se);const qe=ne.createElement("div");qe.classList.add(_l("s")),Se.appendChild(qe),this.swatchElement=qe;const gt=ne.createElement("div");if(gt.classList.add(_l("t")),Se.appendChild(gt),this.textElement=gt,ce.pickerLayout==="inline"){const Pt=ne.createElement("div");Pt.classList.add(_l("p")),this.element.appendChild(Pt),this.pickerElement=Pt}else this.pickerElement=null}}function va(_e,ne,ce){const Se=lu(_e,360),qe=tr(ne/100,0,1),gt=tr(ce/100,0,1),Pt=gt*qe,cn=Pt*(1-Math.abs(Se/60%2-1)),Vn=gt-Pt;let vi,Ti,yi;return[vi,Ti,yi]=Se>=0&&Se<60?[Pt,cn,0]:Se>=60&&Se<120?[cn,Pt,0]:Se>=120&&Se<180?[0,Pt,cn]:Se>=180&&Se<240?[0,cn,Pt]:Se>=240&&Se<300?[cn,0,Pt]:[Pt,0,cn],[255*(vi+Vn),255*(Ti+Vn),255*(yi+Vn)]}function js(_e){return[_e[0],_e[1],_e[2]]}function vp(_e,ne){return[_e[0],_e[1],_e[2],ne]}const du={hsl:{hsl:(_e,ne,ce)=>[_e,ne,ce],hsv:function(_e,ne,ce){const Se=ce+ne*(100-Math.abs(2*ce-100))/200;return[_e,Se!==0?ne*(100-Math.abs(2*ce-100))/Se:0,ce+ne*(100-Math.abs(2*ce-100))/200]},rgb:function(_e,ne,ce){const Se=(_e%360+360)%360,qe=tr(ne/100,0,1),gt=tr(ce/100,0,1),Pt=(1-Math.abs(2*gt-1))*qe,cn=Pt*(1-Math.abs(Se/60%2-1)),Vn=gt-Pt/2;let vi,Ti,yi;return[vi,Ti,yi]=Se>=0&&Se<60?[Pt,cn,0]:Se>=60&&Se<120?[cn,Pt,0]:Se>=120&&Se<180?[0,Pt,cn]:Se>=180&&Se<240?[0,cn,Pt]:Se>=240&&Se<300?[cn,0,Pt]:[Pt,0,cn],[255*(vi+Vn),255*(Ti+Vn),255*(yi+Vn)]}},hsv:{hsl:function(_e,ne,ce){const Se=100-Math.abs(ce*(200-ne)/100-100);return[_e,Se!==0?ne*ce/Se:0,ce*(200-ne)/200]},hsv:(_e,ne,ce)=>[_e,ne,ce],rgb:va},rgb:{hsl:function(_e,ne,ce){const Se=tr(_e/255,0,1),qe=tr(ne/255,0,1),gt=tr(ce/255,0,1),Pt=Math.max(Se,qe,gt),cn=Math.min(Se,qe,gt),Vn=Pt-cn;let vi=0,Ti=0;const yi=(cn+Pt)/2;return Vn!==0&&(Ti=Vn/(1-Math.abs(Pt+cn-1)),vi=Se===Pt?(qe-gt)/Vn:qe===Pt?2+(gt-Se)/Vn:4+(Se-qe)/Vn,vi=vi/6+(vi<0?1:0)),[360*vi,100*Ti,100*yi]},hsv:function(_e,ne,ce){const Se=tr(_e/255,0,1),qe=tr(ne/255,0,1),gt=tr(ce/255,0,1),Pt=Math.max(Se,qe,gt),cn=Pt-Math.min(Se,qe,gt);let Vn;return Vn=cn===0?0:Pt===Se?((qe-gt)/cn%6+6)%6*60:Pt===qe?60*((gt-Se)/cn+2):60*((Se-qe)/cn+4),[Vn,100*(Pt===0?0:cn/Pt),100*Pt]},rgb:(_e,ne,ce)=>[_e,ne,ce]}},ed={hsl:_e=>{var ne;return[lu(_e[0],360),tr(_e[1],0,100),tr(_e[2],0,100),tr((ne=_e[3])!==null&&ne!==void 0?ne:1,0,1)]},hsv:_e=>{var ne;return[lu(_e[0],360),tr(_e[1],0,100),tr(_e[2],0,100),tr((ne=_e[3])!==null&&ne!==void 0?ne:1,0,1)]},rgb:_e=>{var ne;return[tr(_e[0],0,255),tr(_e[1],0,255),tr(_e[2],0,255),tr((ne=_e[3])!==null&&ne!==void 0?ne:1,0,1)]}};function Oi(_e,ne){return typeof _e=="object"&&!ke(_e)&&ne in _e&&typeof _e[ne]=="number"}class Si{constructor(ne,ce){this.mode_=ce,this.comps_=ed[ce](ne)}static black(){return new Si([0,0,0],"rgb")}static fromObject(ne){const ce="a"in ne?[ne.r,ne.g,ne.b,ne.a]:[ne.r,ne.g,ne.b];return new Si(ce,"rgb")}static toRgbaObject(ne){return ne.toRgbaObject()}static isRgbColorObject(ne){return Oi(ne,"r")&&Oi(ne,"g")&&Oi(ne,"b")}static isRgbaColorObject(ne){return this.isRgbColorObject(ne)&&Oi(ne,"a")}static isColorObject(ne){return this.isRgbColorObject(ne)}static equals(ne,ce){if(ne.mode_!==ce.mode_)return!1;const Se=ne.comps_,qe=ce.comps_;for(let gt=0;gt<Se.length;gt++)if(Se[gt]!==qe[gt])return!1;return!0}get mode(){return this.mode_}getComponents(ne){return vp((ce=js(this.comps_),Se=this.mode_,qe=ne||this.mode_,du[Se][qe](...ce)),this.comps_[3]);var ce,Se,qe}toRgbaObject(){const ne=this.getComponents("rgb");return{r:ne[0],g:ne[1],b:ne[2],a:ne[3]}}}const vl=nt("colp");class td{constructor(ne,ce){this.alphaViews_=null,this.element=ne.createElement("div"),this.element.classList.add(vl());const Se=ne.createElement("div");Se.classList.add(vl("hsv"));const qe=ne.createElement("div");qe.classList.add(vl("sv")),this.svPaletteView_=ce.svPaletteView,qe.appendChild(this.svPaletteView_.element),Se.appendChild(qe);const gt=ne.createElement("div");gt.classList.add(vl("h")),this.hPaletteView_=ce.hPaletteView,gt.appendChild(this.hPaletteView_.element),Se.appendChild(gt),this.element.appendChild(Se);const Pt=ne.createElement("div");if(Pt.classList.add(vl("rgb")),this.textView_=ce.textView,Pt.appendChild(this.textView_.element),this.element.appendChild(Pt),ce.alphaViews){this.alphaViews_={palette:ce.alphaViews.palette,text:ce.alphaViews.text};const cn=ne.createElement("div");cn.classList.add(vl("a"));const Vn=ne.createElement("div");Vn.classList.add(vl("ap")),Vn.appendChild(this.alphaViews_.palette.element),cn.appendChild(Vn);const vi=ne.createElement("div");vi.classList.add(vl("at")),vi.appendChild(this.alphaViews_.text.element),cn.appendChild(vi),this.element.appendChild(cn)}}get allFocusableElements(){const ne=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(ce=>ce.inputElement)];return this.alphaViews_&&ne.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),ne}}function nd(_e){const ne=un;return Zt(_e,{alpha:ne.optional.boolean,expanded:ne.optional.boolean,picker:ne.optional.custom(jo)})}function Ic(_e){return _e?.1:1}function Vo(_e,ne){const ce=_e.match(/^(.+)%$/);return Math.min(ce?.01*parseFloat(ce[1])*ne:parseFloat(_e),ne)}const Vl={deg:_e=>_e,grad:_e=>360*_e/400,rad:_e=>360*_e/(2*Math.PI),turn:_e=>360*_e};function ns(_e){const ne=_e.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!ne)return parseFloat(_e);const ce=parseFloat(ne[1]),Se=ne[2];return Vl[Se](ce)}const Pf={"func.rgb":_e=>{const ne=_e.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!ne)return null;const ce=[Vo(ne[1],255),Vo(ne[2],255),Vo(ne[3],255)];return isNaN(ce[0])||isNaN(ce[1])||isNaN(ce[2])?null:new Si(ce,"rgb")},"func.rgba":_e=>{const ne=_e.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!ne)return null;const ce=[Vo(ne[1],255),Vo(ne[2],255),Vo(ne[3],255),Vo(ne[4],1)];return isNaN(ce[0])||isNaN(ce[1])||isNaN(ce[2])||isNaN(ce[3])?null:new Si(ce,"rgb")},"func.hsl":_e=>{const ne=_e.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!ne)return null;const ce=[ns(ne[1]),Vo(ne[2],100),Vo(ne[3],100)];return isNaN(ce[0])||isNaN(ce[1])||isNaN(ce[2])?null:new Si(ce,"hsl")},"func.hsla":_e=>{const ne=_e.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!ne)return null;const ce=[ns(ne[1]),Vo(ne[2],100),Vo(ne[3],100),Vo(ne[4],1)];return isNaN(ce[0])||isNaN(ce[1])||isNaN(ce[2])||isNaN(ce[3])?null:new Si(ce,"hsl")},"hex.rgb":_e=>{const ne=_e.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(ne)return new Si([parseInt(ne[1]+ne[1],16),parseInt(ne[2]+ne[2],16),parseInt(ne[3]+ne[3],16)],"rgb");const ce=_e.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return ce?new Si([parseInt(ce[1],16),parseInt(ce[2],16),parseInt(ce[3],16)],"rgb"):null},"hex.rgba":_e=>{const ne=_e.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(ne)return new Si([parseInt(ne[1]+ne[1],16),parseInt(ne[2]+ne[2],16),parseInt(ne[3]+ne[3],16),zr(parseInt(ne[4]+ne[4],16),0,255,0,1)],"rgb");const ce=_e.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return ce?new Si([parseInt(ce[1],16),parseInt(ce[2],16),parseInt(ce[3],16),zr(parseInt(ce[4],16),0,255,0,1)],"rgb"):null}};function Bn(_e){return Object.keys(Pf).reduce((ne,ce)=>ne||((0,Pf[ce])(_e)?ce:null),null)}const go=_e=>{const ne=Bn(_e);return ne?Pf[ne](_e):null};function fg(_e){return _e==="func.hsla"||_e==="func.rgba"||_e==="hex.rgba"}function Sv(_e){if(typeof _e=="string"){const ne=go(_e);if(ne)return ne}return Si.black()}function Dc(_e){const ne=tr(Math.floor(_e),0,255).toString(16);return ne.length===1?`0${ne}`:ne}function pu(_e,ne="#"){return`${ne}${js(_e.getComponents("rgb")).map(Dc).join("")}`}function Al(_e,ne="#"){const ce=_e.getComponents("rgb");return`${ne}${[ce[0],ce[1],ce[2],255*ce[3]].map(Dc).join("")}`}function id(_e){const ne=ro(0);return`rgb(${js(_e.getComponents("rgb")).map(ce=>ne(ce)).join(", ")})`}function Pc(_e){const ne=ro(2),ce=ro(0);return`rgba(${_e.getComponents("rgb").map((Se,qe)=>(qe===3?ne:ce)(Se)).join(", ")})`}const Ra={"func.hsl":function(_e){const ne=[ro(0),$h,$h];return`hsl(${js(_e.getComponents("hsl")).map((ce,Se)=>ne[Se](ce)).join(", ")})`},"func.hsla":function(_e){const ne=[ro(0),$h,$h,ro(2)];return`hsla(${_e.getComponents("hsl").map((ce,Se)=>ne[Se](ce)).join(", ")})`},"func.rgb":id,"func.rgba":Pc,"hex.rgb":pu,"hex.rgba":Al};function Rf(_e){return Ra[_e]}const Ts=nt("apl");class Ya{constructor(ne,ce){this.onValueChange_=this.onValueChange_.bind(this),this.value=ce.value,this.value.emitter.on("change",this.onValueChange_),this.element=ne.createElement("div"),this.element.classList.add(Ts()),ce.viewProps.bindTabIndex(this.element);const Se=ne.createElement("div");Se.classList.add(Ts("b")),this.element.appendChild(Se);const qe=ne.createElement("div");qe.classList.add(Ts("c")),Se.appendChild(qe),this.colorElem_=qe;const gt=ne.createElement("div");gt.classList.add(Ts("m")),this.element.appendChild(gt),this.markerElem_=gt;const Pt=ne.createElement("div");Pt.classList.add(Ts("p")),this.markerElem_.appendChild(Pt),this.previewElem_=Pt,this.update_()}update_(){const ne=this.value.rawValue,ce=ne.getComponents("rgb"),Se=new Si([ce[0],ce[1],ce[2],0],"rgb"),qe=new Si([ce[0],ce[1],ce[2],255],"rgb"),gt=["to right",Pc(Se),Pc(qe)];this.colorElem_.style.background=`linear-gradient(${gt.join(",")})`,this.previewElem_.style.backgroundColor=Pc(ne);const Pt=zr(ce[3],0,1,0,100);this.markerElem_.style.left=`${Pt}%`}onValueChange_(){this.update_()}}class Ap{constructor(ne,ce){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=ce.value,this.viewProps=ce.viewProps,this.view=new Ya(ne,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new mo(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(ne,ce){if(!ne.point)return;const Se=ne.point.x/ne.bounds.width,qe=this.value.rawValue,[gt,Pt,cn]=qe.getComponents("hsv");this.value.setRawValue(new Si([gt,Pt,cn,Se],"hsv"),ce)}onPointerDown_(ne){this.handlePointerEvent_(ne.data,{forceEmit:!1,last:!1})}onPointerMove_(ne){this.handlePointerEvent_(ne.data,{forceEmit:!1,last:!1})}onPointerUp_(ne){this.handlePointerEvent_(ne.data,{forceEmit:!0,last:!0})}onKeyDown_(ne){const ce=Do(Ic(!0),Ks(ne));if(ce===0)return;const Se=this.value.rawValue,[qe,gt,Pt,cn]=Se.getComponents("hsv");this.value.setRawValue(new Si([qe,gt,Pt,cn+ce],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(ne){Do(Ic(!0),Ks(ne))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Ba=nt("coltxt");class rd{constructor(ne,ce){this.element=ne.createElement("div"),this.element.classList.add(Ba());const Se=ne.createElement("div");Se.classList.add(Ba("m")),this.modeElem_=function(Pt){const cn=Pt.createElement("select");return cn.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}].reduce((Vn,vi)=>{const Ti=Pt.createElement("option");return Ti.textContent=vi.text,Ti.value=vi.value,Vn.appendChild(Ti),Vn},Pt.createDocumentFragment())),cn}(ne),this.modeElem_.classList.add(Ba("ms")),Se.appendChild(this.modeSelectElement);const qe=ne.createElement("div");qe.classList.add(Ba("mm")),qe.appendChild(Je(ne,"dropdown")),Se.appendChild(qe),this.element.appendChild(Se);const gt=ne.createElement("div");gt.classList.add(Ba("w")),this.element.appendChild(gt),this.textsElem_=gt,this.textViews_=ce.textViews,this.applyTextViews_(),Ze(ce.colorMode,Pt=>{this.modeElem_.value=Pt})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(ne){this.textViews_=ne,this.applyTextViews_()}applyTextViews_(){Mn(this.textsElem_);const ne=this.element.ownerDocument;this.textViews_.forEach(ce=>{const Se=ne.createElement("div");Se.classList.add(Ba("c")),Se.appendChild(ce.element),this.textsElem_.appendChild(Se)})}}const ci=ro(0),fu={rgb:()=>new Vi({min:0,max:255}),hsl:_e=>new Vi(_e===0?{min:0,max:360}:{min:0,max:100}),hsv:_e=>new Vi(_e===0?{min:0,max:360}:{min:0,max:100})};function mu(_e,ne,ce){return new Fs(_e,{arrayPosition:ce===0?"fst":ce===2?"lst":"mid",baseStep:Ic(!1),parser:ne.parser,props:Ut.fromObject({draggingScale:1,formatter:ci}),value:lt(0,{constraint:fu[ne.colorMode](ce)}),viewProps:ne.viewProps})}class ka{constructor(ne,ce){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.parser_=ce.parser,this.value=ce.value,this.viewProps=ce.viewProps,this.colorMode=lt(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(ne),this.view=new rd(ne,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(ne){const ce={colorMode:this.colorMode.rawValue,parser:this.parser_,viewProps:this.viewProps},Se=[mu(ne,ce,0),mu(ne,ce,1),mu(ne,ce,2)];return Se.forEach((qe,gt)=>{Mc({primary:this.value,secondary:qe.value,forward:Pt=>Pt.rawValue.getComponents(this.colorMode.rawValue)[gt],backward:(Pt,cn)=>{const Vn=this.colorMode.rawValue,vi=Pt.rawValue.getComponents(Vn);return vi[gt]=cn.rawValue,new Si(vp(js(vi),vi[3]),Vn)}})}),Se}onModeSelectChange_(ne){const ce=ne.currentTarget;this.colorMode.rawValue=ce.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const sd=nt("hpl");class ah{constructor(ne,ce){this.onValueChange_=this.onValueChange_.bind(this),this.value=ce.value,this.value.emitter.on("change",this.onValueChange_),this.element=ne.createElement("div"),this.element.classList.add(sd()),ce.viewProps.bindTabIndex(this.element);const Se=ne.createElement("div");Se.classList.add(sd("c")),this.element.appendChild(Se);const qe=ne.createElement("div");qe.classList.add(sd("m")),this.element.appendChild(qe),this.markerElem_=qe,this.update_()}update_(){const ne=this.value.rawValue,[ce]=ne.getComponents("hsv");this.markerElem_.style.backgroundColor=id(new Si([ce,100,100],"hsv"));const Se=zr(ce,0,360,0,100);this.markerElem_.style.left=`${Se}%`}onValueChange_(){this.update_()}}class vs{constructor(ne,ce){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=ce.value,this.viewProps=ce.viewProps,this.view=new ah(ne,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new mo(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(ne,ce){if(!ne.point)return;const Se=zr(tr(ne.point.x,0,ne.bounds.width),0,ne.bounds.width,0,359),qe=this.value.rawValue,[,gt,Pt,cn]=qe.getComponents("hsv");this.value.setRawValue(new Si([Se,gt,Pt,cn],"hsv"),ce)}onPointerDown_(ne){this.handlePointerEvent_(ne.data,{forceEmit:!1,last:!1})}onPointerMove_(ne){this.handlePointerEvent_(ne.data,{forceEmit:!1,last:!1})}onPointerUp_(ne){this.handlePointerEvent_(ne.data,{forceEmit:!0,last:!0})}onKeyDown_(ne){const ce=Do(Ic(!1),Ks(ne));if(ce===0)return;const Se=this.value.rawValue,[qe,gt,Pt,cn]=Se.getComponents("hsv");this.value.setRawValue(new Si([qe+ce,gt,Pt,cn],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(ne){Do(Ic(!1),Ks(ne))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Vr=nt("svp");class Aa{constructor(ne,ce){this.onValueChange_=this.onValueChange_.bind(this),this.value=ce.value,this.value.emitter.on("change",this.onValueChange_),this.element=ne.createElement("div"),this.element.classList.add(Vr()),ce.viewProps.bindTabIndex(this.element);const Se=ne.createElement("canvas");Se.height=64,Se.width=64,Se.classList.add(Vr("c")),this.element.appendChild(Se),this.canvasElement=Se;const qe=ne.createElement("div");qe.classList.add(Vr("m")),this.element.appendChild(qe),this.markerElem_=qe,this.update_()}update_(){const ne=function(vi){const Ti=vi.ownerDocument.defaultView;return Ti&&"document"in Ti?vi.getContext("2d"):null}(this.canvasElement);if(!ne)return;const ce=this.value.rawValue.getComponents("hsv"),Se=this.canvasElement.width,qe=this.canvasElement.height,gt=ne.getImageData(0,0,Se,qe),Pt=gt.data;for(let vi=0;vi<qe;vi++)for(let Ti=0;Ti<Se;Ti++){const yi=zr(Ti,0,Se,0,100),Go=zr(vi,0,qe,100,0),rs=va(ce[0],yi,Go),Ka=4*(vi*Se+Ti);Pt[Ka]=rs[0],Pt[Ka+1]=rs[1],Pt[Ka+2]=rs[2],Pt[Ka+3]=255}ne.putImageData(gt,0,0);const cn=zr(ce[1],0,100,0,100);this.markerElem_.style.left=`${cn}%`;const Vn=zr(ce[2],0,100,100,0);this.markerElem_.style.top=`${Vn}%`}onValueChange_(){this.update_()}}class lh{constructor(ne,ce){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=ce.value,this.viewProps=ce.viewProps,this.view=new Aa(ne,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new mo(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(ne,ce){if(!ne.point)return;const Se=zr(ne.point.x,0,ne.bounds.width,0,100),qe=zr(ne.point.y,0,ne.bounds.height,100,0),[gt,,,Pt]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new Si([gt,Se,qe,Pt],"hsv"),ce)}onPointerDown_(ne){this.handlePointerEvent_(ne.data,{forceEmit:!1,last:!1})}onPointerMove_(ne){this.handlePointerEvent_(ne.data,{forceEmit:!1,last:!1})}onPointerUp_(ne){this.handlePointerEvent_(ne.data,{forceEmit:!0,last:!0})}onKeyDown_(ne){mp(ne.key)&&ne.preventDefault();const[ce,Se,qe,gt]=this.value.rawValue.getComponents("hsv"),Pt=Ic(!1),cn=Do(Pt,Ks(ne)),Vn=Do(Pt,Tc(ne));cn===0&&Vn===0||this.value.setRawValue(new Si([ce,Se+cn,qe+Vn,gt],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(ne){const ce=Ic(!1),Se=Do(ce,Ks(ne)),qe=Do(ce,Tc(ne));Se===0&&qe===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Bf{constructor(ne,ce){this.value=ce.value,this.viewProps=ce.viewProps,this.hPaletteC_=new vs(ne,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new lh(ne,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=ce.supportsAlpha?{palette:new Ap(ne,{value:this.value,viewProps:this.viewProps}),text:new Fs(ne,{parser:ts,baseStep:.1,props:Ut.fromObject({draggingScale:.01,formatter:ro(2)}),value:lt(0,{constraint:new Vi({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Mc({primary:this.value,secondary:this.alphaIcs_.text.value,forward:Se=>Se.rawValue.getComponents()[3],backward:(Se,qe)=>{const gt=Se.rawValue.getComponents();return gt[3]=qe.rawValue,new Si(gt,Se.rawValue.mode)}}),this.textC_=new ka(ne,{parser:ts,value:this.value,viewProps:this.viewProps}),this.view=new td(ne,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:ce.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}const ch=nt("colsw");class mg{constructor(ne,ce){this.onValueChange_=this.onValueChange_.bind(this),ce.value.emitter.on("change",this.onValueChange_),this.value=ce.value,this.element=ne.createElement("div"),this.element.classList.add(ch()),ce.viewProps.bindClassModifiers(this.element);const Se=ne.createElement("div");Se.classList.add(ch("sw")),this.element.appendChild(Se),this.swatchElem_=Se;const qe=ne.createElement("button");qe.classList.add(ch("b")),ce.viewProps.bindDisabled(qe),this.element.appendChild(qe),this.buttonElement=qe,this.update_()}update_(){const ne=this.value.rawValue;this.swatchElem_.style.backgroundColor=Al(ne)}onValueChange_(){this.update_()}}class gg{constructor(ne,ce){this.value=ce.value,this.viewProps=ce.viewProps,this.view=new mg(ne,{value:this.value,viewProps:this.viewProps})}}class _o{constructor(ne,ce){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=ce.value,this.viewProps=ce.viewProps,this.foldable_=Ri.create(ce.expanded),this.swatchC_=new gg(ne,{value:this.value,viewProps:this.viewProps});const Se=this.swatchC_.view.buttonElement;Se.addEventListener("blur",this.onButtonBlur_),Se.addEventListener("click",this.onButtonClick_),this.textC_=new lr(ne,{parser:ce.parser,props:Ut.fromObject({formatter:ce.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new oh(ne,{foldable:this.foldable_,pickerLayout:ce.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=ce.pickerLayout==="popup"?new ai(ne,{viewProps:this.viewProps}):null;const qe=new Bf(ne,{supportsAlpha:ce.supportsAlpha,value:this.value,viewProps:this.viewProps});qe.view.allFocusableElements.forEach(gt=>{gt.addEventListener("blur",this.onPopupChildBlur_),gt.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=qe,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(qe.view.element),Mc({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:gt=>gt.rawValue,backward:(gt,Pt)=>Pt.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),ir(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(ne){if(!this.popC_)return;const ce=this.view.element,Se=ne.relatedTarget;Se&&ce.contains(Se)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(ne){if(!this.popC_)return;const ce=this.popC_.view.element,Se=Pn(ne);Se&&ce.contains(Se)||Se&&Se===this.swatchC_.view.buttonElement&&!en(ce.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(ne){this.popC_?ne.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&ne.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function vt(_e){return Si.isColorObject(_e)?Si.fromObject(_e):Si.black()}function yp(_e){return js(_e.getComponents("rgb")).reduce((ne,ce)=>ne<<8|255&Math.floor(ce),0)}function od(_e){return _e.getComponents("rgb").reduce((ne,ce,Se)=>ne<<8|255&Math.floor(Se===3?255*ce:ce),0)>>>0}function so(_e){return typeof _e!="number"?Si.black():new Si([(ne=_e)>>16&255,ne>>8&255,255&ne],"rgb");var ne}function yl(_e){return typeof _e!="number"?Si.black():new Si([(ne=_e)>>24&255,ne>>16&255,ne>>8&255,zr(255&ne,0,255,0,1)],"rgb");var ne}function ya(_e,ne){const ce=ne.toRgbaObject();_e.writeProperty("r",ce.r),_e.writeProperty("g",ce.g),_e.writeProperty("b",ce.b),_e.writeProperty("a",ce.a)}function Gl(_e,ne){const ce=ne.toRgbaObject();_e.writeProperty("r",ce.r),_e.writeProperty("g",ce.g),_e.writeProperty("b",ce.b)}function oo(_e){return"alpha"in _e&&_e.alpha===!0}function uh(_e){return _e?ne=>Al(ne,"0x"):ne=>pu(ne,"0x")}const hh={id:"input-color-number",type:"input",accept:(_e,ne)=>{if(typeof _e!="number"||!("view"in ne)||ne.view!=="color")return null;const ce=nd(ne);return ce?{initialValue:_e,params:ce}:null},binding:{reader:_e=>oo(_e.params)?yl:so,equals:Si.equals,writer:_e=>function(ne){const ce=ne?od:yp;return(Se,qe)=>{cu(Se,ce(qe))}}(oo(_e.params))},controller:_e=>{const ne=oo(_e.params),ce="expanded"in _e.params?_e.params.expanded:void 0,Se="picker"in _e.params?_e.params.picker:void 0;return new _o(_e.document,{expanded:ce!=null&&ce,formatter:uh(ne),parser:go,pickerLayout:Se??"popup",supportsAlpha:ne,value:_e.value,viewProps:_e.viewProps})}},Rc={id:"input-color-object",type:"input",accept:(_e,ne)=>{if(!Si.isColorObject(_e))return null;const ce=nd(ne);return ce?{initialValue:_e,params:ce}:null},binding:{reader:_e=>vt,equals:Si.equals,writer:_e=>{return ne=_e.initialValue,Si.isRgbaColorObject(ne)?ya:Gl;var ne}},controller:_e=>{const ne=Si.isRgbaColorObject(_e.initialValue),ce="expanded"in _e.params?_e.params.expanded:void 0,Se="picker"in _e.params?_e.params.picker:void 0,qe=ne?Al:pu;return new _o(_e.document,{expanded:ce!=null&&ce,formatter:qe,parser:go,pickerLayout:Se??"popup",supportsAlpha:ne,value:_e.value,viewProps:_e.viewProps})}},Ql={id:"input-color-string",type:"input",accept:(_e,ne)=>{if(typeof _e!="string"||"view"in ne&&ne.view==="text"||!Bn(_e))return null;const ce=nd(ne);return ce?{initialValue:_e,params:ce}:null},binding:{reader:_e=>Sv,equals:Si.equals,writer:_e=>{const ne=Bn(_e.initialValue);if(!ne)throw tt.shouldNeverHappen();return function(ce){const Se=Rf(ce);return(qe,gt)=>{cu(qe,Se(gt))}}(ne)}},controller:_e=>{const ne=Bn(_e.initialValue);if(!ne)throw tt.shouldNeverHappen();const ce=Rf(ne),Se="expanded"in _e.params?_e.params.expanded:void 0,qe="picker"in _e.params?_e.params.picker:void 0;return new _o(_e.document,{expanded:Se!=null&&Se,formatter:ce,parser:go,pickerLayout:qe??"popup",supportsAlpha:fg(ne),value:_e.value,viewProps:_e.viewProps})}};class vo{constructor(ne){this.components=ne.components,this.asm_=ne.assembly}constrain(ne){const ce=this.asm_.toComponents(ne).map((Se,qe)=>{var gt,Pt;return(Pt=(gt=this.components[qe])===null||gt===void 0?void 0:gt.constrain(Se))!==null&&Pt!==void 0?Pt:Se});return this.asm_.fromComponents(ce)}}const Bc=nt("pndtxt");class gu{constructor(ne,ce){this.textViews=ce.textViews,this.element=ne.createElement("div"),this.element.classList.add(Bc()),this.textViews.forEach(Se=>{const qe=ne.createElement("div");qe.classList.add(Bc("a")),qe.appendChild(Se.element),this.element.appendChild(qe)})}}class Hl{constructor(ne,ce){this.value=ce.value,this.viewProps=ce.viewProps,this.acs_=ce.axes.map((Se,qe)=>function(gt,Pt,cn){return new Fs(gt,{arrayPosition:cn===0?"fst":cn===Pt.axes.length-1?"lst":"mid",baseStep:Pt.axes[cn].baseStep,parser:Pt.parser,props:Pt.axes[cn].textProps,value:lt(0,{constraint:Pt.axes[cn].constraint}),viewProps:Pt.viewProps})}(ne,ce,qe)),this.acs_.forEach((Se,qe)=>{Mc({primary:this.value,secondary:Se.value,forward:gt=>ce.assembly.toComponents(gt.rawValue)[qe],backward:(gt,Pt)=>{const cn=ce.assembly.toComponents(gt.rawValue);return cn[qe]=Pt.rawValue,ce.assembly.fromComponents(cn)}})}),this.view=new gu(ne,{textViews:this.acs_.map(Se=>Se.view)})}}function _u(_e){const ne=[],ce=function(gt){return"step"in gt&&!ke(gt.step)?new Ys(gt.step):null}(_e);ce&&ne.push(ce);const Se=function(gt){return"max"in gt&&!ke(gt.max)||"min"in gt&&!ke(gt.min)?new Vi({max:gt.max,min:gt.min}):null}(_e);Se&&ne.push(Se);const qe=sh(_e.options);return qe&&ne.push(qe),new Cs(ne)}function kf(_e){const[ne,ce]=function(Se){const qe=Se?kr(Se,Vi):null;return qe?[qe.minValue,qe.maxValue]:[void 0,void 0]}(_e);return[ne??0,ce??100]}const Cv={id:"input-number",type:"input",accept:(_e,ne)=>{if(typeof _e!="number")return null;const ce=un,Se=Zt(ne,{format:ce.optional.function,max:ce.optional.number,min:ce.optional.number,options:ce.optional.custom(rh),step:ce.optional.number});return Se?{initialValue:_e,params:Se}:null},binding:{reader:_e=>Pa,constraint:_e=>_u(_e.params),writer:_e=>cu},controller:_e=>{var ne,ce;const Se=_e.value,qe=_e.constraint;if(qe&&kr(qe,Hr))return new vr(_e.document,{props:Ut.fromObject({options:(ne=Zh(qe))!==null&&ne!==void 0?ne:[]}),value:Se,viewProps:_e.viewProps});const gt=(ce="format"in _e.params?_e.params.format:void 0)!==null&&ce!==void 0?ce:ro(gp(qe,Se.rawValue));if(qe&&kr(qe,Vi)){const[Pt,cn]=kf(qe);return new gs(_e.document,{baseStep:uu(qe),parser:ts,sliderProps:Ut.fromObject({maxValue:cn,minValue:Pt}),textProps:Ut.fromObject({draggingScale:hu(qe,Se.rawValue),formatter:gt}),value:Se,viewProps:_e.viewProps})}return new Fs(_e.document,{baseStep:uu(qe),parser:ts,props:Ut.fromObject({draggingScale:hu(qe,Se.rawValue),formatter:gt}),value:Se,viewProps:_e.viewProps})}};class Wl{constructor(ne=0,ce=0){this.x=ne,this.y=ce}getComponents(){return[this.x,this.y]}static isObject(ne){if(ke(ne))return!1;const ce=ne.x,Se=ne.y;return typeof ce=="number"&&typeof Se=="number"}static equals(ne,ce){return ne.x===ce.x&&ne.y===ce.y}toObject(){return{x:this.x,y:this.y}}}const dh={toComponents:_e=>_e.getComponents(),fromComponents:_e=>new Wl(..._e)},ql=nt("p2d");class kc{constructor(ne,ce){this.element=ne.createElement("div"),this.element.classList.add(ql()),ce.viewProps.bindClassModifiers(this.element),Ze(ce.expanded,Et(this.element,ql(void 0,"expanded")));const Se=ne.createElement("div");Se.classList.add(ql("h")),this.element.appendChild(Se);const qe=ne.createElement("button");qe.classList.add(ql("b")),qe.appendChild(Je(ne,"p2dpad")),ce.viewProps.bindDisabled(qe),Se.appendChild(qe),this.buttonElement=qe;const gt=ne.createElement("div");if(gt.classList.add(ql("t")),Se.appendChild(gt),this.textElement=gt,ce.pickerLayout==="inline"){const Pt=ne.createElement("div");Pt.classList.add(ql("p")),this.element.appendChild(Pt),this.pickerElement=Pt}else this.pickerElement=null}}const Ni=nt("p2dp");class Ws{constructor(ne,ce){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=ce.invertsY,this.maxValue_=ce.maxValue,this.element=ne.createElement("div"),this.element.classList.add(Ni()),ce.layout==="popup"&&this.element.classList.add(Ni(void 0,"p"));const Se=ne.createElement("div");Se.classList.add(Ni("p")),ce.viewProps.bindTabIndex(Se),this.element.appendChild(Se),this.padElement=Se;const qe=ne.createElementNS(ht,"svg");qe.classList.add(Ni("g")),this.padElement.appendChild(qe),this.svgElem_=qe;const gt=ne.createElementNS(ht,"line");gt.classList.add(Ni("ax")),gt.setAttributeNS(null,"x1","0"),gt.setAttributeNS(null,"y1","50%"),gt.setAttributeNS(null,"x2","100%"),gt.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(gt);const Pt=ne.createElementNS(ht,"line");Pt.classList.add(Ni("ax")),Pt.setAttributeNS(null,"x1","50%"),Pt.setAttributeNS(null,"y1","0"),Pt.setAttributeNS(null,"x2","50%"),Pt.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(Pt);const cn=ne.createElementNS(ht,"line");cn.classList.add(Ni("l")),cn.setAttributeNS(null,"x1","50%"),cn.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(cn),this.lineElem_=cn;const Vn=ne.createElement("div");Vn.classList.add(Ni("m")),this.padElement.appendChild(Vn),this.markerElem_=Vn,ce.value.emitter.on("change",this.onValueChange_),this.value=ce.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[ne,ce]=this.value.rawValue.getComponents(),Se=this.maxValue_,qe=zr(ne,-Se,+Se,0,100),gt=zr(ce,-Se,+Se,0,100),Pt=this.invertsY_?100-gt:gt;this.lineElem_.setAttributeNS(null,"x2",`${qe}%`),this.lineElem_.setAttributeNS(null,"y2",`${Pt}%`),this.markerElem_.style.left=`${qe}%`,this.markerElem_.style.top=`${Pt}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Oa(_e,ne,ce){return[Do(ne[0],Ks(_e)),Do(ne[1],Tc(_e))*(ce?1:-1)]}class ba{constructor(ne,ce){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=ce.value,this.viewProps=ce.viewProps,this.baseSteps_=ce.baseSteps,this.maxValue_=ce.maxValue,this.invertsY_=ce.invertsY,this.view=new Ws(ne,{invertsY:this.invertsY_,layout:ce.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new mo(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(ne,ce){if(!ne.point)return;const Se=this.maxValue_,qe=zr(ne.point.x,0,ne.bounds.width,-Se,+Se),gt=zr(this.invertsY_?ne.bounds.height-ne.point.y:ne.point.y,0,ne.bounds.height,-Se,+Se);this.value.setRawValue(new Wl(qe,gt),ce)}onPointerDown_(ne){this.handlePointerEvent_(ne.data,{forceEmit:!1,last:!1})}onPointerMove_(ne){this.handlePointerEvent_(ne.data,{forceEmit:!1,last:!1})}onPointerUp_(ne){this.handlePointerEvent_(ne.data,{forceEmit:!0,last:!0})}onPadKeyDown_(ne){mp(ne.key)&&ne.preventDefault();const[ce,Se]=Oa(ne,this.baseSteps_,this.invertsY_);ce===0&&Se===0||this.value.setRawValue(new Wl(this.value.rawValue.x+ce,this.value.rawValue.y+Se),{forceEmit:!1,last:!1})}onPadKeyUp_(ne){const[ce,Se]=Oa(ne,this.baseSteps_,this.invertsY_);ce===0&&Se===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Oc{constructor(ne,ce){var Se,qe;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=ce.value,this.viewProps=ce.viewProps,this.foldable_=Ri.create(ce.expanded),this.popC_=ce.pickerLayout==="popup"?new ai(ne,{viewProps:this.viewProps}):null;const gt=new ba(ne,{baseSteps:[ce.axes[0].baseStep,ce.axes[1].baseStep],invertsY:ce.invertsY,layout:ce.pickerLayout,maxValue:ce.maxValue,value:this.value,viewProps:this.viewProps});gt.view.allFocusableElements.forEach(Pt=>{Pt.addEventListener("blur",this.onPopupChildBlur_),Pt.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=gt,this.textC_=new Hl(ne,{assembly:dh,axes:ce.axes,parser:ce.parser,value:this.value,viewProps:this.viewProps}),this.view=new kc(ne,{expanded:this.foldable_.value("expanded"),pickerLayout:ce.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(Se=this.view.buttonElement)===null||Se===void 0||Se.addEventListener("blur",this.onPadButtonBlur_),(qe=this.view.buttonElement)===null||qe===void 0||qe.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Mc({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:Pt=>Pt.rawValue,backward:(Pt,cn)=>cn.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),ir(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(ne){if(!this.popC_)return;const ce=this.view.element,Se=ne.relatedTarget;Se&&ce.contains(Se)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(ne){if(!this.popC_)return;const ce=this.popC_.view.element,Se=Pn(ne);Se&&ce.contains(Se)||Se&&Se===this.view.buttonElement&&!en(ce.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(ne){this.popC_?ne.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&ne.key==="Escape"&&this.view.buttonElement.focus()}}function Lc(_e){return Wl.isObject(_e)?new Wl(_e.x,_e.y):new Wl}function bp(_e,ne){_e.writeProperty("x",ne.x),_e.writeProperty("y",ne.y)}function vu(_e){if(!_e)return;const ne=[];return ke(_e.step)||ne.push(new Ys(_e.step)),ke(_e.max)&&ke(_e.min)||ne.push(new Vi({max:_e.max,min:_e.min})),new Cs(ne)}function Yi(_e,ne){const ce=_e&&kr(_e,Vi);if(ce)return Math.max(Math.abs(ce.minValue||0),Math.abs(ce.maxValue||0));const Se=uu(_e);return Math.max(10*Math.abs(Se),10*Math.abs(ne))}function Yl(_e,ne){const ce=ne instanceof vo?ne.components[0]:void 0,Se=ne instanceof vo?ne.components[1]:void 0,qe=Yi(ce,_e.x),gt=Yi(Se,_e.y);return Math.max(qe,gt)}function wa(_e,ne){return{baseStep:uu(ne),constraint:ne,textProps:Ut.fromObject({draggingScale:hu(ne,_e),formatter:ro(gp(ne,_e))})}}function _g(_e){if(!("y"in _e))return!1;const ne=_e.y;return!!ne&&"inverted"in ne&&!!ne.inverted}const Of={id:"input-point2d",type:"input",accept:(_e,ne)=>{if(!Wl.isObject(_e))return null;const ce=un,Se=Zt(ne,{expanded:ce.optional.boolean,picker:ce.optional.custom(jo),x:ce.optional.custom(qa),y:ce.optional.object({inverted:ce.optional.boolean,max:ce.optional.number,min:ce.optional.number,step:ce.optional.number})});return Se?{initialValue:_e,params:Se}:null},binding:{reader:_e=>Lc,constraint:_e=>{return ne=_e.params,new vo({assembly:dh,components:[vu("x"in ne?ne.x:void 0),vu("y"in ne?ne.y:void 0)]});var ne},equals:Wl.equals,writer:_e=>bp},controller:_e=>{const ne=_e.document,ce=_e.value,Se=_e.constraint;if(!(Se instanceof vo))throw tt.shouldNeverHappen();const qe="expanded"in _e.params?_e.params.expanded:void 0,gt="picker"in _e.params?_e.params.picker:void 0;return new Oc(ne,{axes:[wa(ce.rawValue.x,Se.components[0]),wa(ce.rawValue.y,Se.components[1])],expanded:qe!=null&&qe,invertsY:_g(_e.params),maxValue:Yl(ce.rawValue,Se),parser:ts,pickerLayout:gt??"popup",value:ce,viewProps:_e.viewProps})}};class Ao{constructor(ne=0,ce=0,Se=0){this.x=ne,this.y=ce,this.z=Se}getComponents(){return[this.x,this.y,this.z]}static isObject(ne){if(ke(ne))return!1;const ce=ne.x,Se=ne.y,qe=ne.z;return typeof ce=="number"&&typeof Se=="number"&&typeof qe=="number"}static equals(ne,ce){return ne.x===ce.x&&ne.y===ce.y&&ne.z===ce.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const Kr={toComponents:_e=>_e.getComponents(),fromComponents:_e=>new Ao(..._e)};function Js(_e){return Ao.isObject(_e)?new Ao(_e.x,_e.y,_e.z):new Ao}function xa(_e,ne){_e.writeProperty("x",ne.x),_e.writeProperty("y",ne.y),_e.writeProperty("z",ne.z)}function La(_e){if(!_e)return;const ne=[];return ke(_e.step)||ne.push(new Ys(_e.step)),ke(_e.max)&&ke(_e.min)||ne.push(new Vi({max:_e.max,min:_e.min})),new Cs(ne)}function Ea(_e,ne){return{baseStep:uu(ne),constraint:ne,textProps:Ut.fromObject({draggingScale:hu(ne,_e),formatter:ro(gp(ne,_e))})}}const ad={id:"input-point3d",type:"input",accept:(_e,ne)=>{if(!Ao.isObject(_e))return null;const ce=un,Se=Zt(ne,{x:ce.optional.custom(qa),y:ce.optional.custom(qa),z:ce.optional.custom(qa)});return Se?{initialValue:_e,params:Se}:null},binding:{reader:_e=>Js,constraint:_e=>{return ne=_e.params,new vo({assembly:Kr,components:[La("x"in ne?ne.x:void 0),La("y"in ne?ne.y:void 0),La("z"in ne?ne.z:void 0)]});var ne},equals:Ao.equals,writer:_e=>xa},controller:_e=>{const ne=_e.value,ce=_e.constraint;if(!(ce instanceof vo))throw tt.shouldNeverHappen();return new Hl(_e.document,{assembly:Kr,axes:[Ea(ne.rawValue.x,ce.components[0]),Ea(ne.rawValue.y,ce.components[1]),Ea(ne.rawValue.z,ce.components[2])],parser:ts,value:ne,viewProps:_e.viewProps})}};class Au{constructor(ne=0,ce=0,Se=0,qe=0){this.x=ne,this.y=ce,this.z=Se,this.w=qe}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(ne){if(ke(ne))return!1;const ce=ne.x,Se=ne.y,qe=ne.z,gt=ne.w;return typeof ce=="number"&&typeof Se=="number"&&typeof qe=="number"&&typeof gt=="number"}static equals(ne,ce){return ne.x===ce.x&&ne.y===ce.y&&ne.z===ce.z&&ne.w===ce.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const wp={toComponents:_e=>_e.getComponents(),fromComponents:_e=>new Au(..._e)};function yu(_e){return Au.isObject(_e)?new Au(_e.x,_e.y,_e.z,_e.w):new Au}function Na(_e,ne){_e.writeProperty("x",ne.x),_e.writeProperty("y",ne.y),_e.writeProperty("z",ne.z),_e.writeProperty("w",ne.w)}function ao(_e){if(!_e)return;const ne=[];return ke(_e.step)||ne.push(new Ys(_e.step)),ke(_e.max)&&ke(_e.min)||ne.push(new Vi({max:_e.max,min:_e.min})),new Cs(ne)}const Nc={id:"input-point4d",type:"input",accept:(_e,ne)=>{if(!Au.isObject(_e))return null;const ce=un,Se=Zt(ne,{x:ce.optional.custom(qa),y:ce.optional.custom(qa),z:ce.optional.custom(qa),w:ce.optional.custom(qa)});return Se?{initialValue:_e,params:Se}:null},binding:{reader:_e=>yu,constraint:_e=>{return ne=_e.params,new vo({assembly:wp,components:[ao("x"in ne?ne.x:void 0),ao("y"in ne?ne.y:void 0),ao("z"in ne?ne.z:void 0),ao("w"in ne?ne.w:void 0)]});var ne},equals:Au.equals,writer:_e=>Na},controller:_e=>{const ne=_e.value,ce=_e.constraint;if(!(ce instanceof vo))throw tt.shouldNeverHappen();return new Hl(_e.document,{assembly:wp,axes:ne.rawValue.getComponents().map((Se,qe)=>{return gt=Se,{baseStep:uu(Pt=ce.components[qe]),constraint:Pt,textProps:Ut.fromObject({draggingScale:hu(Pt,gt),formatter:ro(gp(Pt,gt))})};var gt,Pt}),parser:ts,value:ne,viewProps:_e.viewProps})}},ld={id:"input-string",type:"input",accept:(_e,ne)=>{if(typeof _e!="string")return null;const ce=Zt(ne,{options:un.optional.custom(rh)});return ce?{initialValue:_e,params:ce}:null},binding:{reader:_e=>th,constraint:_e=>function(ne){const ce=[],Se=sh(ne.options);return Se&&ce.push(Se),new Cs(ce)}(_e.params),writer:_e=>cu},controller:_e=>{var ne;const ce=_e.document,Se=_e.value,qe=_e.constraint;return qe&&kr(qe,Hr)?new vr(ce,{props:Ut.fromObject({options:(ne=Zh(qe))!==null&&ne!==void 0?ne:[]}),value:Se,viewProps:_e.viewProps}):new lr(ce,{parser:gt=>gt,props:Ut.fromObject({formatter:Mf}),value:Se,viewProps:_e.viewProps})}},Po={defaultInterval:200,defaultLineCount:3},bu=nt("mll");class Xa{constructor(ne,ce){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=ce.formatter,this.element=ne.createElement("div"),this.element.classList.add(bu()),ce.viewProps.bindClassModifiers(this.element);const Se=ne.createElement("textarea");Se.classList.add(bu("i")),Se.style.height=`calc(var(--bld-us) * ${ce.lineCount})`,Se.readOnly=!0,ce.viewProps.bindDisabled(Se),this.element.appendChild(Se),this.textareaElem_=Se,ce.value.emitter.on("change",this.onValueUpdate_),this.value=ce.value,this.update_()}update_(){const ne=this.textareaElem_,ce=ne.scrollTop===ne.scrollHeight-ne.clientHeight,Se=[];this.value.rawValue.forEach(qe=>{qe!==void 0&&Se.push(this.formatter_(qe))}),ne.textContent=Se.join(`
`),ce&&(ne.scrollTop=ne.scrollHeight)}onValueUpdate_(){this.update_()}}class Xl{constructor(ne,ce){this.value=ce.value,this.viewProps=ce.viewProps,this.view=new Xa(ne,{formatter:ce.formatter,lineCount:ce.lineCount,value:this.value,viewProps:this.viewProps})}}const cd=nt("sgl");class ud{constructor(ne,ce){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=ce.formatter,this.element=ne.createElement("div"),this.element.classList.add(cd()),ce.viewProps.bindClassModifiers(this.element);const Se=ne.createElement("input");Se.classList.add(cd("i")),Se.readOnly=!0,Se.type="text",ce.viewProps.bindDisabled(Se),this.element.appendChild(Se),this.inputElement=Se,ce.value.emitter.on("change",this.onValueUpdate_),this.value=ce.value,this.update_()}update_(){const ne=this.value.rawValue,ce=ne[ne.length-1];this.inputElement.value=ce!==void 0?this.formatter_(ce):""}onValueUpdate_(){this.update_()}}class Ar{constructor(ne,ce){this.value=ce.value,this.viewProps=ce.viewProps,this.view=new ud(ne,{formatter:ce.formatter,value:this.value,viewProps:this.viewProps})}}const Ro={id:"monitor-bool",type:"monitor",accept:(_e,ne)=>{if(typeof _e!="boolean")return null;const ce=Zt(ne,{lineCount:un.optional.number});return ce?{initialValue:_e,params:ce}:null},binding:{reader:_e=>cr},controller:_e=>{var ne;return _e.value.rawValue.length===1?new Ar(_e.document,{formatter:ml,value:_e.value,viewProps:_e.viewProps}):new Xl(_e.document,{formatter:ml,lineCount:(ne=_e.params.lineCount)!==null&&ne!==void 0?ne:Po.defaultLineCount,value:_e.value,viewProps:_e.viewProps})}};class Sa{constructor(){this.emitter=new et,this.index_=-1}get index(){return this.index_}set index(ne){this.index_!==ne&&(this.index_=ne,this.emitter.emit("change",{index:ne,sender:this}))}}const Ua=nt("grl");class bl{constructor(ne,ce){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=ne.createElement("div"),this.element.classList.add(Ua()),ce.viewProps.bindClassModifiers(this.element),this.formatter_=ce.formatter,this.minValue_=ce.minValue,this.maxValue_=ce.maxValue,this.cursor_=ce.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const Se=ne.createElementNS(ht,"svg");Se.classList.add(Ua("g")),Se.style.height=`calc(var(--bld-us) * ${ce.lineCount})`,this.element.appendChild(Se),this.svgElem_=Se;const qe=ne.createElementNS(ht,"polyline");this.svgElem_.appendChild(qe),this.lineElem_=qe;const gt=ne.createElement("div");gt.classList.add(Ua("t"),nt("tt")()),this.element.appendChild(gt),this.tooltipElem_=gt,ce.value.emitter.on("change",this.onValueUpdate_),this.value=ce.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const ne=this.svgElem_.getBoundingClientRect(),ce=this.value.rawValue.length-1,Se=this.minValue_,qe=this.maxValue_,gt=[];this.value.rawValue.forEach((Ti,yi)=>{if(Ti===void 0)return;const Go=zr(yi,0,ce,0,ne.width),rs=zr(Ti,Se,qe,ne.height,0);gt.push([Go,rs].join(","))}),this.lineElem_.setAttributeNS(null,"points",gt.join(" "));const Pt=this.tooltipElem_,cn=this.value.rawValue[this.cursor_.index];if(cn===void 0)return void Pt.classList.remove(Ua("t","a"));const Vn=zr(this.cursor_.index,0,ce,0,ne.width),vi=zr(cn,Se,qe,ne.height,0);Pt.style.left=`${Vn}px`,Pt.style.top=`${vi}px`,Pt.textContent=`${this.formatter_(cn)}`,Pt.classList.contains(Ua("t","a"))||(Pt.classList.add(Ua("t","a"),Ua("t","in")),Jt(Pt),Pt.classList.remove(Ua("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class ra{constructor(ne,ce){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.value=ce.value,this.viewProps=ce.viewProps,this.cursor_=new Sa,this.view=new bl(ne,{cursor:this.cursor_,formatter:ce.formatter,lineCount:ce.lineCount,maxValue:ce.maxValue,minValue:ce.minValue,value:this.value,viewProps:this.viewProps}),en(ne)){const Se=new mo(this.view.element);Se.emitter.on("down",this.onGraphPointerDown_),Se.emitter.on("move",this.onGraphPointerMove_),Se.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}onGraphMouseLeave_(){this.cursor_.index=-1}onGraphMouseMove_(ne){const ce=this.view.element.getBoundingClientRect();this.cursor_.index=Math.floor(zr(ne.offsetX,0,ce.width,0,this.value.rawValue.length))}onGraphPointerDown_(ne){this.onGraphPointerMove_(ne)}onGraphPointerMove_(ne){ne.data.point?this.cursor_.index=Math.floor(zr(ne.data.point.x,0,ne.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.index=-1}onGraphPointerUp_(){this.cursor_.index=-1}}function Kl(_e){return"format"in _e&&!ke(_e.format)?_e.format:ro(2)}function xp(_e){return"view"in _e&&_e.view==="graph"}const Uc={id:"monitor-number",type:"monitor",accept:(_e,ne)=>{if(typeof _e!="number")return null;const ce=un,Se=Zt(ne,{format:ce.optional.function,lineCount:ce.optional.number,max:ce.optional.number,min:ce.optional.number,view:ce.optional.string});return Se?{initialValue:_e,params:Se}:null},binding:{defaultBufferSize:_e=>xp(_e)?64:1,reader:_e=>Pa},controller:_e=>xp(_e.params)?function(ne){var ce,Se,qe;return new ra(ne.document,{formatter:Kl(ne.params),lineCount:(ce=ne.params.lineCount)!==null&&ce!==void 0?ce:Po.defaultLineCount,maxValue:(Se="max"in ne.params?ne.params.max:null)!==null&&Se!==void 0?Se:100,minValue:(qe="min"in ne.params?ne.params.min:null)!==null&&qe!==void 0?qe:0,value:ne.value,viewProps:ne.viewProps})}(_e):function(ne){var ce;return ne.value.rawValue.length===1?new Ar(ne.document,{formatter:Kl(ne.params),value:ne.value,viewProps:ne.viewProps}):new Xl(ne.document,{formatter:Kl(ne.params),lineCount:(ce=ne.params.lineCount)!==null&&ce!==void 0?ce:Po.defaultLineCount,value:ne.value,viewProps:ne.viewProps})}(_e)},hd={id:"monitor-string",type:"monitor",accept:(_e,ne)=>{if(typeof _e!="string")return null;const ce=un,Se=Zt(ne,{lineCount:ce.optional.number,multiline:ce.optional.boolean});return Se?{initialValue:_e,params:Se}:null},binding:{reader:_e=>th},controller:_e=>{var ne;const ce=_e.value;return ce.rawValue.length>1||"multiline"in _e.params&&_e.params.multiline?new Xl(_e.document,{formatter:Mf,lineCount:(ne=_e.params.lineCount)!==null&&ne!==void 0?ne:Po.defaultLineCount,value:ce,viewProps:_e.viewProps}):new Ar(_e.document,{formatter:Mf,value:ce,viewProps:_e.viewProps})}};class Jl{constructor(ne){this.onValueChange_=this.onValueChange_.bind(this),this.reader=ne.reader,this.writer=ne.writer,this.emitter=new et,this.value=ne.value,this.value.emitter.on("change",this.onValueChange_),this.target=ne.target,this.read()}read(){const ne=this.target.read();ne!==void 0&&(this.value.rawValue=this.reader(ne))}write_(ne){this.writer(this.target,ne)}onValueChange_(ne){this.write_(ne.rawValue),this.emitter.emit("change",{options:ne.options,rawValue:ne.rawValue,sender:this})}}class Bo{constructor(ne){this.onTick_=this.onTick_.bind(this),this.reader_=ne.reader,this.target=ne.target,this.emitter=new et,this.value=ne.value,this.ticker=ne.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const ne=this.target.read();if(ne===void 0)return;const ce=this.value.rawValue,Se=this.reader_(ne);this.value.rawValue=function(qe,gt){const Pt=[...ia(qe),gt];return Pt.length>qe.length?Pt.splice(0,Pt.length-qe.length):na(Pt,qe.length),Pt}(ce,Se),this.emitter.emit("update",{rawValue:Se,sender:this})}onTick_(ne){this.read()}}function vg(_e,ne){return ne===0?new es:new Io(_e,ne??Po.defaultInterval)}class $s{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(ne){ne.type==="blade"?this.pluginsMap_.blades.unshift(ne):ne.type==="input"?this.pluginsMap_.inputs.unshift(ne):ne.type==="monitor"&&this.pluginsMap_.monitors.unshift(ne)}createInput(ne,ce,Se){if(ke(ce.read()))throw new tt({context:{key:ce.key},type:"nomatchingcontroller"});const qe=this.pluginsMap_.inputs.reduce((gt,Pt)=>gt||function(cn,Vn){const vi=cn.accept(Vn.target.read(),Vn.params);if(ke(vi))return null;const Ti=un,yi={target:Vn.target,initialValue:vi.initialValue,params:vi.params},Go=cn.binding.reader(yi),rs=cn.binding.constraint?cn.binding.constraint(yi):void 0,Ka=lt(Go(vi.initialValue),{constraint:rs,equals:cn.binding.equals}),Fa=new Jl({reader:Go,target:Vn.target,value:Ka,writer:cn.binding.writer(yi)}),sa=Ti.optional.boolean(Vn.params.disabled).value,Ds=Ti.optional.boolean(Vn.params.hidden).value,jc=cn.controller({constraint:rs,document:Vn.document,initialValue:vi.initialValue,params:vi.params,value:Fa.value,viewProps:qn.create({disabled:sa,hidden:Ds})}),wu=Ti.optional.string(Vn.params.label).value;return new Cr(Vn.document,{binding:Fa,blade:dr(),props:Ut.fromObject({label:wu||Vn.target.key}),valueController:jc})}(Pt,{document:ne,target:ce,params:Se}),null);if(qe)return qe;throw new tt({context:{key:ce.key},type:"nomatchingcontroller"})}createMonitor(ne,ce,Se){const qe=this.pluginsMap_.monitors.reduce((gt,Pt)=>gt||function(cn,Vn){var vi,Ti,yi;const Go=un,rs=cn.accept(Vn.target.read(),Vn.params);if(ke(rs))return null;const Ka={target:Vn.target,initialValue:rs.initialValue,params:rs.params},Fa=cn.binding.reader(Ka),sa=(Ti=(vi=Go.optional.number(Vn.params.bufferSize).value)!==null&&vi!==void 0?vi:cn.binding.defaultBufferSize&&cn.binding.defaultBufferSize(rs.params))!==null&&Ti!==void 0?Ti:1,Ds=Go.optional.number(Vn.params.interval).value,jc=new Bo({reader:Fa,target:Vn.target,ticker:vg(Vn.document,Ds),value:cs(sa)}),wu=Go.optional.boolean(Vn.params.disabled).value,zc=Go.optional.boolean(Vn.params.hidden).value,xu=cn.controller({document:Vn.document,params:rs.params,value:jc.value,viewProps:qn.create({disabled:wu,hidden:zc})}),dd=(yi=Go.optional.string(Vn.params.label).value)!==null&&yi!==void 0?yi:Vn.target.key;return new Tr(Vn.document,{binding:jc,blade:dr(),props:Ut.fromObject({label:dd}),valueController:xu})}(Pt,{document:ne,params:Se,target:ce}),null);if(qe)return qe;throw new tt({context:{key:ce.key},type:"nomatchingcontroller"})}createBlade(ne,ce){const Se=this.pluginsMap_.blades.reduce((qe,gt)=>qe||function(Pt,cn){const Vn=Pt.accept(cn.params);if(!Vn)return null;const vi=un.optional.boolean(cn.params.disabled).value,Ti=un.optional.boolean(cn.params.hidden).value;return Pt.controller({blade:dr(),document:cn.document,params:Object.assign(Object.assign({},Vn.params),{disabled:vi,hidden:Ti}),viewProps:qn.create({disabled:vi,hidden:Ti})})}(gt,{document:ne,params:ce}),null);if(!Se)throw new tt({type:"nomatchingview",context:{params:ce}});return Se}createBladeApi(ne){if(ne instanceof Cr)return new Rr(ne);if(ne instanceof Tr)return new Mr(ne);if(ne instanceof ho)return new ss(ne,this);const ce=this.pluginsMap_.blades.reduce((Se,qe)=>Se||qe.api({controller:ne,pool:this}),null);if(!ce)throw tt.shouldNeverHappen();return ce}}class wl extends _{constructor(ne){super(ne),this.emitter_=new et,this.controller_.valueController.value.emitter.on("change",ce=>{this.emitter_.emit("change",{event:new ve(this,ce.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(ne){this.controller_.props.set("label",ne)}get options(){return this.controller_.valueController.props.get("options")}set options(ne){this.controller_.valueController.props.set("options",ne)}get value(){return this.controller_.valueController.value.rawValue}set value(ne){this.controller_.valueController.value.rawValue=ne}on(ne,ce){const Se=ce.bind(this);return this.emitter_.on(ne,qe=>{Se(qe.event)}),this}}class us extends _{constructor(ne){super(ne),this.emitter_=new et,this.controller_.valueController.value.emitter.on("change",ce=>{this.emitter_.emit("change",{event:new ve(this,ce.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(ne){this.controller_.props.set("label",ne)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(ne){this.controller_.valueController.sliderController.props.set("maxValue",ne)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(ne){this.controller_.valueController.sliderController.props.set("minValue",ne)}get value(){return this.controller_.valueController.value.rawValue}set value(ne){this.controller_.valueController.value.rawValue=ne}on(ne,ce){const Se=ce.bind(this);return this.emitter_.on(ne,qe=>{Se(qe.event)}),this}}class xl extends _{constructor(ne){super(ne),this.emitter_=new et,this.controller_.valueController.value.emitter.on("change",ce=>{this.emitter_.emit("change",{event:new ve(this,ce.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(ne){this.controller_.props.set("label",ne)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(ne){this.controller_.valueController.props.set("formatter",ne)}get value(){return this.controller_.valueController.value.rawValue}set value(ne){this.controller_.valueController.value.rawValue=ne}on(ne,ce){const Se=ce.bind(this);return this.emitter_.on(ne,qe=>{Se(qe.event)}),this}}const is={id:"list",type:"blade",accept(_e){const ne=un,ce=Zt(_e,{options:ne.required.custom(rh),value:ne.required.raw,view:ne.required.constant("list"),label:ne.optional.string});return ce?{params:ce}:null},controller(_e){const ne=new vr(_e.document,{props:Ut.fromObject({options:zo(_e.params.options)}),value:lt(_e.params.value),viewProps:_e.viewProps});return new as(_e.document,{blade:_e.blade,props:Ut.fromObject({label:_e.params.label}),valueController:ne})},api:_e=>_e.controller instanceof as&&_e.controller.valueController instanceof vr?new wl(_e.controller):null};class Ag extends Gr{constructor(ne,ce){super(ne,ce)}get element(){return this.controller_.view.element}importPreset(ne){(function(ce,Se){ce.forEach(qe=>{const gt=Se[qe.presetKey];gt!==void 0&&qe.write(gt)})})(this.controller_.rackController.rack.find(Cr).map(ce=>ce.binding.target),ne),this.refresh()}exportPreset(){return this.controller_.rackController.rack.find(Cr).map(ne=>ne.binding.target).reduce((ne,ce)=>Object.assign(ne,{[ce.presetKey]:ce.read()}),{})}refresh(){this.controller_.rackController.rack.find(Cr).forEach(ne=>{ne.binding.read()}),this.controller_.rackController.rack.find(Tr).forEach(ne=>{ne.binding.read()})}}class yg extends Er{constructor(ne,ce){super(ne,{expanded:ce.expanded,blade:ce.blade,props:ce.props,root:!0,viewProps:ce.viewProps})}}const bg={id:"slider",type:"blade",accept(_e){const ne=un,ce=Zt(_e,{max:ne.required.number,min:ne.required.number,view:ne.required.constant("slider"),format:ne.optional.function,label:ne.optional.string,value:ne.optional.number});return ce?{params:ce}:null},controller(_e){var ne,ce;const Se=(ne=_e.params.value)!==null&&ne!==void 0?ne:0,qe=new gs(_e.document,{baseStep:1,parser:ts,sliderProps:Ut.fromObject({maxValue:_e.params.max,minValue:_e.params.min}),textProps:Ut.fromObject({draggingScale:hu(void 0,Se),formatter:(ce=_e.params.format)!==null&&ce!==void 0?ce:zl}),value:lt(Se),viewProps:_e.viewProps});return new as(_e.document,{blade:_e.blade,props:Ut.fromObject({label:_e.params.label}),valueController:qe})},api:_e=>_e.controller instanceof as&&_e.controller.valueController instanceof gs?new us(_e.controller):null},Fc={id:"text",type:"blade",accept(_e){const ne=un,ce=Zt(_e,{parse:ne.required.function,value:ne.required.raw,view:ne.required.constant("text"),format:ne.optional.function,label:ne.optional.string});return ce?{params:ce}:null},controller(_e){var ne;const ce=new lr(_e.document,{parser:_e.params.parse,props:Ut.fromObject({formatter:(ne=_e.params.format)!==null&&ne!==void 0?ne:Se=>String(Se)}),value:lt(_e.params.value),viewProps:_e.viewProps});return new as(_e.document,{blade:_e.blade,props:Ut.fromObject({label:_e.params.label}),valueController:ce})},api:_e=>_e.controller instanceof as&&_e.controller.valueController instanceof lr?new xl(_e.controller):null};function ph(_e,ne,ce){if(_e.querySelector(`style[data-tp-style=${ne}]`))return;const Se=_e.createElement("style");Se.dataset.tpStyle=ne,Se.textContent=ce,_e.head.appendChild(Se)}const fh=new class{constructor(_e){const[ne,ce]=_e.split("-"),Se=ne.split(".");this.major=parseInt(Se[0],10),this.minor=parseInt(Se[1],10),this.patch=parseInt(Se[2],10),this.prerelease=ce??null}toString(){const _e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[_e,this.prerelease].join("-"):_e}}("3.0.8");oe.BladeApi=_,oe.ButtonApi=Ge,oe.FolderApi=Gr,oe.InputBindingApi=Rr,oe.ListApi=wl,oe.MonitorBindingApi=Mr,oe.Pane=class extends Ag{constructor(_e){var ne;const ce=_e||{},Se=(ne=ce.document)!==null&&ne!==void 0?ne:Cn(),qe=function(){const gt=new $s;return[Of,ad,Nc,ld,Cv,Ql,Rc,hh,_p,Ro,hd,Uc,ji,Bs,Zr,Ir].forEach(Pt=>{gt.register(Pt)}),gt}();super(new yg(Se,{expanded:ce.expanded,blade:dr(),props:Ut.fromObject({title:ce.title}),viewProps:qn.create()}),qe),this.pool_=qe,this.containerElem_=ce.container||function(gt){const Pt=gt.createElement("div");return Pt.classList.add(nt("dfw")()),gt.body&&gt.body.appendChild(Pt),Pt}(Se),this.containerElem_.appendChild(this.element),this.doc_=Se,this.usesDefaultWrapper_=!ce.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw tt.alreadyDisposed();return this.doc_}dispose(){const _e=this.containerElem_;if(!_e)throw tt.alreadyDisposed();if(this.usesDefaultWrapper_){const ne=_e.parentElement;ne&&ne.removeChild(_e)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(_e){("plugin"in _e?[_e.plugin]:"plugins"in _e?_e.plugins:[]).forEach(ne=>{this.pool_.register(ne),this.embedPluginStyle_(ne)})}embedPluginStyle_(_e){_e.css&&ph(this.document,`plugin-${_e.id}`,_e.css)}setUpDefaultPlugins_(){ph(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor transparent;scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:transparent}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:transparent solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #28292e);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #28292e);--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i,.tp-fldv_c>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(_e=>{this.embedPluginStyle_(_e)}),this.registerPlugin({plugins:[bg,is,Ir,Fc]})}},oe.SeparatorApi=po,oe.SliderApi=us,oe.TabApi=Sr,oe.TabPageApi=Fr,oe.TextApi=xl,oe.TpChangeEvent=ve,oe.VERSION=fh,Object.defineProperty(oe,"__esModule",{value:!0})})(te)},23:function(__unused_webpack_module,__webpackgi_exports__,__webpackgi_require__){__webpackgi_require__.d(__webpackgi_exports__,{Q:function(){return DRACOLoader2}});var three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__=__webpackgi_require__(553),three__WEBPACK_IMPORTED_MODULE_1__=__webpackgi_require__(988);class DRACOLoader2 extends three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__._{constructor(Te){super(Te),this.encoderPending=null,this.encoderConfig={type:"js"},this.setDecoderPath("https://cdn.jsdelivr.net/gh/google/draco@1.4.1/javascript/"),this.setDecoderConfig({type:"js"})}async loadAsync(Te,te){const oe=await super.loadAsync(Te,te);return oe?new three__WEBPACK_IMPORTED_MODULE_1__.Kj0(oe,new three__WEBPACK_IMPORTED_MODULE_1__.Wid):void 0}preload(Te=!0,te=!1){return Te&&super.preload(),te&&this.initEncoder(),this}async initEncoder(){if(this.encoderPending)return this.encoderPending;const useJS=typeof WebAssembly!="object"||this.encoderConfig.type==="js",librariesPending=[],libLoader=this._loadLibrary.bind(this);return useJS?librariesPending.push(libLoader("draco_encoder.js","text")):(librariesPending.push(libLoader("draco_wasm_wrapper.js","text")),librariesPending.push(libLoader("draco_encoder.wasm","arraybuffer"))),this.encoderPending=Promise.all(librariesPending).then(libraries=>{var _a;const jsContent=libraries[0];return useJS||(this.encoderConfig.wasmBinary=libraries[1]),(_a=eval(jsContent+`
DracoEncoderModule;`))===null||_a===void 0?void 0:_a()}),this.encoderPending}async initDecoder(){var _a;await this._initDecoder();const jsContent=await fetch(this.workerSourceURL).then(async Te=>Te.text()).then(Te=>{const te=Te.indexOf("/* worker */");if(te<1)throw new Error("unable to load decoder module");return Te.substring(0,te-1)});return(_a=eval(jsContent+`
DracoDecoderModule;`))===null||_a===void 0?void 0:_a()}}},87:function(){},263:function(){},988:function(Te,te,oe){oe.d(te,{$TI:function(){return E_},$V:function(){return ef},$Vf:function(){return af},$YQ:function(){return qg},A5E:function(){return jy},AHu:function(){return zy},AXT:function(){return h0},Aip:function(){return Uu},B02:function(){return Le},BFQ:function(){return Hr},BG$:function(){return Ec},BKK:function(){return lf},BVF:function(){return Cn},BVQ:function(){return sc},BbS:function(){return $p},Bf4:function(){return Tr},BtG:function(){return Uf},CJI:function(){return Bo},CN8:function(){return Gy},CP7:function(){return Kv},CaW:function(){return Xn},CdI:function(){return Ri},Cne:function(){return Wy},CtA:function(){return Io},CtF:function(){return qc},D1R:function(){return oi},D9w:function(){return Ir},DT1:function(){return $c},Djp:function(){return su},DqL:function(){return Kp},DvJ:function(){return Eu},E2K:function(){return Cs},EB7:function(){return fy},EJi:function(){return yy},EoG:function(){return dr},F5T:function(){return $s},FDw:function(){return Er},FE5:function(){return qp},FIo:function(){return _m},FM8:function(){return Bn},FT0:function(){return xy},FUD:function(){return Sc},FvO:function(){return C0},GG6:function(){return $u},GQ:function(){return D_},GUF:function(){return zr},GVz:function(){return Bf},GZb:function(){return k_},Gih:function(){return jl},Gql:function(){return __},H$k:function(){return mm},HTd:function(){return pa},HW6:function(){return Qy},HgB:function(){return _s},HkE:function(){return Wg},Hmr:function(){return Jp},Hw6:function(){return ka},Hy8:function(){return vn},Hyl:function(){return $a},IEO:function(){return kp},IFH:function(){return ro},IKL:function(){return v0},ILR:function(){return Ys},IOt:function(){return Ks},Ilk:function(){return ci},Inb:function(){return Mc},Ir4:function(){return hu},JOQ:function(){return Cu},JQ4:function(){return kt},JUT:function(){return ch},JWc:function(){return gp},KI_:function(){return mo},Kgo:function(){return Qp},KhW:function(){return nn},Kj0:function(){return lo},Kz5:function(){return ea},L5g:function(){return Hy},L5s:function(){return Dy},LBq:function(){return C_},LSk:function(){return _l},LY2:function(){return ir},L_r:function(){return oh},Lcc:function(){return O0},LgE:function(){return ia},LgZ:function(){return pn},LsT:function(){return io},Ltg:function(){return Vr},Lun:function(){return Sd},M5h:function(){return rt},M6v:function(){return Rn},M8C:function(){return Pf},Mig:function(){return Iy},MyG:function(){return xv},N$j:function(){return bh},N4l:function(){return Et},NDo:function(){return ji},NMF:function(){return au},NYV:function(){return ou},Ns1:function(){return hi},NwF:function(){return jd},Ny0:function(){return xh},O7d:function(){return Nd},OAl:function(){return cu},OM3:function(){return Se},OTo:function(){return Mi},OdW:function(){return Op},OoA:function(){return ss},Ox3:function(){return p_},PA7:function(){return mp},PMe:function(){return My},Pa4:function(){return vt},PeU:function(){return we},Pnf:function(){return ts},PpQ:function(){return mu},QM0:function(){return uu},QRU:function(){return tl},QZ1:function(){return Zh},QmN:function(){return ve},Qpg:function(){return Ax},R2R:function(){return Am},REq:function(){return B0},RNb:function(){return Ag},ROQ:function(){return my},RSm:function(){return Ml},Rki:function(){return Rm},RlZ:function(){return en},RsA:function(){return ae},RvT:function(){return rh},S2y:function(){return ke},S3k:function(){return hc},S9g:function(){return ad},SJI:function(){return _x},SPe:function(){return t0},SUY:function(){return Em},Se2:function(){return Vt},Sm8:function(){return lt},So8:function(){return A_},SvJ:function(){return Xr},Syv:function(){return gl},T95:function(){return as},TOt:function(){return Os},TUj:function(){return M_},TUv:function(){return Bp},T_1:function(){return Dl},T_J:function(){return ih},T__:function(){return n_},T_f:function(){return f_},TlE:function(){return is},Tme:function(){return Ar},Tn7:function(){return c_},TyD:function(){return Gr},U7:function(){return zp},UCm:function(){return ki},USm:function(){return Ea},UY4:function(){return Zg},UZH:function(){return _},Uk6:function(){return l_},UlW:function(){return th},Uol:function(){return Qc},V1s:function(){return gd},V4E:function(){return k0},VLJ:function(){return Uy},VYz:function(){return ku},Vdb:function(){return ht},Vj0:function(){return Zs},Vkp:function(){return go},VzW:function(){return Zr},W2J:function(){return zo},WMw:function(){return st},WTc:function(){return yg},WXh:function(){return ca},Wbm:function(){return Qe},WdD:function(){return fr},Wid:function(){return ua},Wjw:function(){return B_},Wl3:function(){return et},Wpd:function(){return Jt},Wqd:function(){return s_},WwZ:function(){return $h},Wzm:function(){return py},XZw:function(){return cf},Xaj:function(){return bt},Xcj:function(){return Ou},XvJ:function(){return gm},Y8D:function(){return Fr},YBo:function(){return u_},YGz:function(){return $t},YKA:function(){return ta},YLQ:function(){return Br},YN5:function(){return R_},YT8:function(){return gy},Ywn:function(){return mg},Z6B:function(){return Ev},ZAu:function(){return Tu},ZQ6:function(){return lm},ZRs:function(){return ga},ZZA:function(){return Ey},Zp0:function(){return E0},Zr5:function(){return Je},ZzF:function(){return so},Zzh:function(){return T_},_12:function(){return _d},_3:function(){return Rl},_AM:function(){return Ms},_C8:function(){return Xp},_Li:function(){return Ue},_MY:function(){return Ye},_YM:function(){return ys},_YX:function(){return rf},_am:function(){return SA},_fP:function(){return _o},_iA:function(){return tt},_kC:function(){return Il},_lf:function(){return Pa},_sL:function(){return zl},a$l:function(){return ce},aCh:function(){return Tf},aH4:function(){return Qr},aLr:function(){return kc},aNw:function(){return Ga},aVm:function(){return Fc},ad5:function(){return If},anP:function(){return jf},aq0:function(){return I0},av9:function(){return es},b5g:function(){return Jv},bGH:function(){return Ne},b_z:function(){return br},bdR:function(){return Ze},blk:function(){return hy},bnF:function(){return kd},brP:function(){return ls},bsb:function(){return jr},c8b:function(){return Ut},cBI:function(){return Lu},cBK:function(){return Tl},cJO:function(){return fm},cLu:function(){return To},cPb:function(){return ko},cRx:function(){return Sr},cU9:function(){return Sy},ce8:function(){return lu},cek:function(){return dc},cum:function(){return qa},dSO:function(){return Mr},dUE:function(){return Ud},dYG:function(){return Pu},dZ3:function(){return or},dd2:function(){return Aa},dj0:function(){return sh},dpR:function(){return dx},dwk:function(){return Ge},e62:function(){return ne},eD:function(){return Rt},eMJ:function(){return dg},eaV:function(){return vr},ehD:function(){return nt},ejS:function(){return rc},ekQ:function(){return fo},epp:function(){return Ra},fHI:function(){return Bd},fO1:function(){return dy},fQA:function(){return P0},fQK:function(){return Yv},fSK:function(){return ln},fY$:function(){return Rr},fto:function(){return Ha},g8_:function(){return Is},gH0:function(){return Im},gSk:function(){return ma},g_z:function(){return i_},ghN:function(){return dn},gi4:function(){return ml},gti:function(){return cm},hEm:function(){return Ss},hH6:function(){return uc},iAb:function(){return po},iDF:function(){return Oo},iKG:function(){return Tg},iLg:function(){return Fd},iMs:function(){return S_},iUV:function(){return hr},iWC:function(){return un},iWj:function(){return $l},i_9:function(){return mx},iiP:function(){return Zu},irR:function(){return qn},j4z:function(){return jo},j87:function(){return fh},jAl:function(){return Cc},jFi:function(){return He},jZA:function(){return lr},jfJ:function(){return nh},jwo:function(){return Df},jyi:function(){return Rp},jyz:function(){return El},k0A:function(){return Bi},k74:function(){return Zt},kB5:function(){return _h},kFz:function(){return gg},kaV:function(){return wy},knz:function(){return cs},kqm:function(){return ky},ksN:function(){return Mn},l0P:function(){return ai},l8J:function(){return pg},lCJ:function(){return _e},lDi:function(){return m_},lLk:function(){return cc},lRF:function(){return Jf},lRj:function(){return fa},lb7:function(){return Dd},lfu:function(){return Ls},lk7:function(){return g_},m7l:function(){return lc},mSO:function(){return Tc},mTL:function(){return fx},mXe:function(){return eo},m_w:function(){return Om},mzJ:function(){return x_},nls:function(){return oa},ntZ:function(){return Ke},nvb:function(){return Pl},o8S:function(){return Wp},oAp:function(){return Eg},oa8:function(){return la},oqc:function(){return Fs},p3g:function(){return lh},p7A:function(){return Vy},p7y:function(){return Gc},pBf:function(){return va},pIN:function(){return eh},pKu:function(){return Ju},pQR:function(){return Hp},ptH:function(){return Xs},qhX:function(){return $n},qkB:function(){return _r},qlB:function(){return ph},qyh:function(){return ho},rAo:function(){return bg},rBU:function(){return Zn},rDY:function(){return Mv},rOj:function(){return We},r_:function(){return _t},rnI:function(){return na},rpg:function(){return pr},s4_:function(){return Py},sYA:function(){return Gd},tEQ:function(){return Vd},tGC:function(){return Ps},tJx:function(){return Fy},tUh:function(){return Vs},tf:function(){return b_},tm_:function(){return Me},trn:function(){return km},u37:function(){return gx},u7G:function(){return Hd},u9r:function(){return yi},uEv:function(){return fp},uL9:function(){return Li},uWy:function(){return rr},uXU:function(){return Wa},ujx:function(){return Lm},v3W:function(){return Vi},v9Y:function(){return _p},vBJ:function(){return wl},vCF:function(){return ot},vCx:function(){return os},vZf:function(){return Hs},vmT:function(){return ha},vpT:function(){return em},vxC:function(){return Cr},w$m:function(){return Pn},wJv:function(){return bn},wem:function(){return Ur},wk1:function(){return Ii},woe:function(){return Fp},wuA:function(){return kr},x12:function(){return wh},x5V:function(){return tr},xEZ:function(){return vs},xG9:function(){return Ly},xJs:function(){return ur},xWb:function(){return Tm},xeV:function(){return Cd},xfE:function(){return ms},xo$:function(){return Eh},xoR:function(){return by},xsS:function(){return $v},y$t:function(){return Vp},y2t:function(){return cr},y8_:function(){return $d},yC1:function(){return zd},yGw:function(){return Yi},ybr:function(){return gh},yj7:function(){return d0},ylh:function(){return Yd},yo9:function(){return Zf},yt0:function(){return gs},ywz:function(){return Bs},yxD:function(){return hx},z$h:function(){return Mf},z81:function(){return Do},z8B:function(){return Zv},zHn:function(){return vu},zbs:function(){return Cy},zf8:function(){return Gp},zob:function(){return P_}});const _="144dev",ae={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},ve={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},we=0,Me=1,ke=2,Le=3,Ye=0,tt=1,Ke=2,Ge=3,et=0,Ue=1,nt=2,He=0,Ze=1,st=2,Et=3,rt=4,bt=5,Ne=100,Qe=101,We=102,_t=103,lt=104,Ut=200,dn=201,nn=202,un=203,Zt=204,pn=205,ln=206,vn=207,ht=208,Jt=209,en=210,Cn=0,Vt=1,Je=2,ot=3,Rt=4,Mn=5,Pn=6,Rn=7,hi=0,$n=1,ji=2,Li=0,dr=1,Ri=2,$t=3,ir=4,or=5,ms=300,Rr=301,Cr=302,Mr=303,Tr=304,Is=306,pr=1e3,rr=1001,ss=1002,Gr=1003,Br=1004,pa=1004,Qr=1005,Hs=1005,Ur=1006,ho=1007,fa=1007,oi=1008,Er=1008,Bs=1009,as=1010,po=1011,io=1012,ea=1013,kt=1014,Zr=1015,To=1016,Bi=1017,qn=1018,bn=1020,Mi=1021,ki=1022,Ii=1023,Fr=1024,Sr=1025,_r=1026,ls=1027,Ss=1028,Ir=1029,es=1030,Io=1031,Cs=1033,kr=33776,Hr=33777,Vi=33778,Ys=33779,Ms=35840,os=35841,vr=35842,Xn=35843,Ha=36196,ai=37492,fo=37496,Xs=37808,lr=37809,cr=37810,ml=37811,su=37812,Ec=37813,ou=37814,ur=37815,Ju=37816,$u=37817,jl=37818,Sc=37819,Zu=37820,Xr=37821,jr=36492,Cc=2200,ta=2201,fp=2202,gl=2300,au=2301,eh=2302,ts=2400,Pa=2401,zl=2402,ro=2500,ma=2501,$h=0,th=1,Mf=2,na=3e3,cs=3001,ia=3004,Mc=3005,Do=3200,Tc=3201,Ks=0,mp=1,Tf="",mo="srgb",zr="srgb-linear",If=0,tr=7680,lu=7681,ga=7682,nh=7683,Fs=34055,ih=34056,dg=5386,xv=512,Wa=513,Df=514,gs=515,cu=516,rh=517,jo=518,qa=519,zo=35044,sh=35048,Zh=35040,gp=35045,uu=35049,hu=35041,_s=35046,pg=35050,Ev=35042,_p="100",_l="300 es",oh=1035;class va{addEventListener(o,g){this._listeners===void 0&&(this._listeners={});const j=this._listeners;j[o]===void 0&&(j[o]=[]),j[o].indexOf(g)===-1&&j[o].push(g)}hasEventListener(o,g){if(this._listeners===void 0)return!1;const j=this._listeners;return j[o]!==void 0&&j[o].indexOf(g)!==-1}removeEventListener(o,g){if(this._listeners===void 0)return;const j=this._listeners[o];if(j!==void 0){const Y=j.indexOf(g);Y!==-1&&j.splice(Y,1)}}dispatchEvent(o){if(this._listeners===void 0)return;const g=this._listeners[o.type];if(g!==void 0){o.target=this;const j=g.slice(0);for(let Y=0,ee=j.length;Y<ee;Y++)j[Y].call(this,o);o.target=null}}}const js=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let vp=1234567;const du=Math.PI/180,ed=180/Math.PI;function Oi(){const ue=4294967295*Math.random()|0,o=4294967295*Math.random()|0,g=4294967295*Math.random()|0,j=4294967295*Math.random()|0;return(js[255&ue]+js[ue>>8&255]+js[ue>>16&255]+js[ue>>24&255]+"-"+js[255&o]+js[o>>8&255]+"-"+js[o>>16&15|64]+js[o>>24&255]+"-"+js[63&g|128]+js[g>>8&255]+"-"+js[g>>16&255]+js[g>>24&255]+js[255&j]+js[j>>8&255]+js[j>>16&255]+js[j>>24&255]).toLowerCase()}function Si(ue,o,g){return Math.max(o,Math.min(g,ue))}function vl(ue,o){return(ue%o+o)%o}function td(ue,o,g){return(1-g)*ue+g*o}function nd(ue){return(ue&ue-1)==0&&ue!==0}function Ic(ue){return Math.pow(2,Math.ceil(Math.log(ue)/Math.LN2))}function Vo(ue){return Math.pow(2,Math.floor(Math.log(ue)/Math.LN2))}function Vl(ue,o){switch(o.constructor){case Float32Array:return ue;case Uint16Array:return ue/65535;case Uint8Array:return ue/255;case Int16Array:return Math.max(ue/32767,-1);case Int8Array:return Math.max(ue/127,-1);default:throw new Error("Invalid component type.")}}function ns(ue,o){switch(o.constructor){case Float32Array:return ue;case Uint16Array:return Math.round(65535*ue);case Uint8Array:return Math.round(255*ue);case Int16Array:return Math.round(32767*ue);case Int8Array:return Math.round(127*ue);default:throw new Error("Invalid component type.")}}var Pf=Object.freeze({__proto__:null,DEG2RAD:du,RAD2DEG:ed,generateUUID:Oi,clamp:Si,euclideanModulo:vl,mapLinear:function(ue,o,g,j,Y){return j+(ue-o)*(Y-j)/(g-o)},inverseLerp:function(ue,o,g){return ue!==o?(g-ue)/(o-ue):0},lerp:td,damp:function(ue,o,g,j){return td(ue,o,1-Math.exp(-g*j))},pingpong:function(ue,o=1){return o-Math.abs(vl(ue,2*o)-o)},smoothstep:function(ue,o,g){return ue<=o?0:ue>=g?1:(ue=(ue-o)/(g-o))*ue*(3-2*ue)},smootherstep:function(ue,o,g){return ue<=o?0:ue>=g?1:(ue=(ue-o)/(g-o))*ue*ue*(ue*(6*ue-15)+10)},randInt:function(ue,o){return ue+Math.floor(Math.random()*(o-ue+1))},randFloat:function(ue,o){return ue+Math.random()*(o-ue)},randFloatSpread:function(ue){return ue*(.5-Math.random())},seededRandom:function(ue){ue!==void 0&&(vp=ue);let o=vp+=1831565813;return o=Math.imul(o^o>>>15,1|o),o^=o+Math.imul(o^o>>>7,61|o),((o^o>>>14)>>>0)/4294967296},degToRad:function(ue){return ue*du},radToDeg:function(ue){return ue*ed},isPowerOfTwo:nd,ceilPowerOfTwo:Ic,floorPowerOfTwo:Vo,setQuaternionFromProperEuler:function(ue,o,g,j,Y){const ee=Math.cos,ie=Math.sin,se=ee(g/2),de=ie(g/2),pe=ee((o+j)/2),be=ie((o+j)/2),Ce=ee((o-j)/2),xe=ie((o-j)/2),Ie=ee((j-o)/2),Re=ie((j-o)/2);switch(Y){case"XYX":ue.set(se*be,de*Ce,de*xe,se*pe);break;case"YZY":ue.set(de*xe,se*be,de*Ce,se*pe);break;case"ZXZ":ue.set(de*Ce,de*xe,se*be,se*pe);break;case"XZX":ue.set(se*be,de*Re,de*Ie,se*pe);break;case"YXY":ue.set(de*Ie,se*be,de*Re,se*pe);break;case"ZYZ":ue.set(de*Re,de*Ie,se*be,se*pe);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+Y)}},normalize:ns,denormalize:Vl});class Bn{constructor(o=0,g=0){Bn.prototype.isVector2=!0,this.x=o,this.y=g}get width(){return this.x}set width(o){this.x=o}get height(){return this.y}set height(o){this.y=o}set(o,g){return this.x=o,this.y=g,this}setScalar(o){return this.x=o,this.y=o,this}setX(o){return this.x=o,this}setY(o){return this.y=o,this}setComponent(o,g){switch(o){case 0:this.x=g;break;case 1:this.y=g;break;default:throw new Error("index is out of range: "+o)}return this}getComponent(o){switch(o){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+o)}}clone(){return new this.constructor(this.x,this.y)}copy(o){return this.x=o.x,this.y=o.y,this}add(o){return this.x+=o.x,this.y+=o.y,this}addScalar(o){return this.x+=o,this.y+=o,this}addVectors(o,g){return this.x=o.x+g.x,this.y=o.y+g.y,this}addScaledVector(o,g){return this.x+=o.x*g,this.y+=o.y*g,this}sub(o){return this.x-=o.x,this.y-=o.y,this}subScalar(o){return this.x-=o,this.y-=o,this}subVectors(o,g){return this.x=o.x-g.x,this.y=o.y-g.y,this}multiply(o){return this.x*=o.x,this.y*=o.y,this}multiplyScalar(o){return this.x*=o,this.y*=o,this}divide(o){return this.x/=o.x,this.y/=o.y,this}divideScalar(o){return this.multiplyScalar(1/o)}applyMatrix3(o){const g=this.x,j=this.y,Y=o.elements;return this.x=Y[0]*g+Y[3]*j+Y[6],this.y=Y[1]*g+Y[4]*j+Y[7],this}min(o){return this.x=Math.min(this.x,o.x),this.y=Math.min(this.y,o.y),this}max(o){return this.x=Math.max(this.x,o.x),this.y=Math.max(this.y,o.y),this}clamp(o,g){return this.x=Math.max(o.x,Math.min(g.x,this.x)),this.y=Math.max(o.y,Math.min(g.y,this.y)),this}clampScalar(o,g){return this.x=Math.max(o,Math.min(g,this.x)),this.y=Math.max(o,Math.min(g,this.y)),this}clampLength(o,g){const j=this.length();return this.divideScalar(j||1).multiplyScalar(Math.max(o,Math.min(g,j)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(o){return this.x*o.x+this.y*o.y}cross(o){return this.x*o.y-this.y*o.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(o){return Math.sqrt(this.distanceToSquared(o))}distanceToSquared(o){const g=this.x-o.x,j=this.y-o.y;return g*g+j*j}manhattanDistanceTo(o){return Math.abs(this.x-o.x)+Math.abs(this.y-o.y)}setLength(o){return this.normalize().multiplyScalar(o)}lerp(o,g){return this.x+=(o.x-this.x)*g,this.y+=(o.y-this.y)*g,this}lerpVectors(o,g,j){return this.x=o.x+(g.x-o.x)*j,this.y=o.y+(g.y-o.y)*j,this}equals(o){return o.x===this.x&&o.y===this.y}fromArray(o,g=0){return this.x=o[g],this.y=o[g+1],this}toArray(o=[],g=0){return o[g]=this.x,o[g+1]=this.y,o}fromBufferAttribute(o,g){return this.x=o.getX(g),this.y=o.getY(g),this}rotateAround(o,g){const j=Math.cos(g),Y=Math.sin(g),ee=this.x-o.x,ie=this.y-o.y;return this.x=ee*j-ie*Y+o.x,this.y=ee*Y+ie*j+o.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class go{constructor(){go.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(o,g,j,Y,ee,ie,se,de,pe){const be=this.elements;return be[0]=o,be[1]=Y,be[2]=se,be[3]=g,be[4]=ee,be[5]=de,be[6]=j,be[7]=ie,be[8]=pe,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(o){const g=this.elements,j=o.elements;return g[0]=j[0],g[1]=j[1],g[2]=j[2],g[3]=j[3],g[4]=j[4],g[5]=j[5],g[6]=j[6],g[7]=j[7],g[8]=j[8],this}extractBasis(o,g,j){return o.setFromMatrix3Column(this,0),g.setFromMatrix3Column(this,1),j.setFromMatrix3Column(this,2),this}setFromMatrix4(o){const g=o.elements;return this.set(g[0],g[4],g[8],g[1],g[5],g[9],g[2],g[6],g[10]),this}multiply(o){return this.multiplyMatrices(this,o)}premultiply(o){return this.multiplyMatrices(o,this)}multiplyMatrices(o,g){const j=o.elements,Y=g.elements,ee=this.elements,ie=j[0],se=j[3],de=j[6],pe=j[1],be=j[4],Ce=j[7],xe=j[2],Ie=j[5],Re=j[8],De=Y[0],ze=Y[3],je=Y[6],Ve=Y[1],$e=Y[4],ct=Y[7],dt=Y[2],ft=Y[5],Bt=Y[8];return ee[0]=ie*De+se*Ve+de*dt,ee[3]=ie*ze+se*$e+de*ft,ee[6]=ie*je+se*ct+de*Bt,ee[1]=pe*De+be*Ve+Ce*dt,ee[4]=pe*ze+be*$e+Ce*ft,ee[7]=pe*je+be*ct+Ce*Bt,ee[2]=xe*De+Ie*Ve+Re*dt,ee[5]=xe*ze+Ie*$e+Re*ft,ee[8]=xe*je+Ie*ct+Re*Bt,this}multiplyScalar(o){const g=this.elements;return g[0]*=o,g[3]*=o,g[6]*=o,g[1]*=o,g[4]*=o,g[7]*=o,g[2]*=o,g[5]*=o,g[8]*=o,this}determinant(){const o=this.elements,g=o[0],j=o[1],Y=o[2],ee=o[3],ie=o[4],se=o[5],de=o[6],pe=o[7],be=o[8];return g*ie*be-g*se*pe-j*ee*be+j*se*de+Y*ee*pe-Y*ie*de}invert(){const o=this.elements,g=o[0],j=o[1],Y=o[2],ee=o[3],ie=o[4],se=o[5],de=o[6],pe=o[7],be=o[8],Ce=be*ie-se*pe,xe=se*de-be*ee,Ie=pe*ee-ie*de,Re=g*Ce+j*xe+Y*Ie;if(Re===0)return this.set(0,0,0,0,0,0,0,0,0);const De=1/Re;return o[0]=Ce*De,o[1]=(Y*pe-be*j)*De,o[2]=(se*j-Y*ie)*De,o[3]=xe*De,o[4]=(be*g-Y*de)*De,o[5]=(Y*ee-se*g)*De,o[6]=Ie*De,o[7]=(j*de-pe*g)*De,o[8]=(ie*g-j*ee)*De,this}transpose(){let o;const g=this.elements;return o=g[1],g[1]=g[3],g[3]=o,o=g[2],g[2]=g[6],g[6]=o,o=g[5],g[5]=g[7],g[7]=o,this}getNormalMatrix(o){return this.setFromMatrix4(o).invert().transpose()}transposeIntoArray(o){const g=this.elements;return o[0]=g[0],o[1]=g[3],o[2]=g[6],o[3]=g[1],o[4]=g[4],o[5]=g[7],o[6]=g[2],o[7]=g[5],o[8]=g[8],this}setUvTransform(o,g,j,Y,ee,ie,se){const de=Math.cos(ee),pe=Math.sin(ee);return this.set(j*de,j*pe,-j*(de*ie+pe*se)+ie+o,-Y*pe,Y*de,-Y*(-pe*ie+de*se)+se+g,0,0,1),this}scale(o,g){const j=this.elements;return j[0]*=o,j[3]*=o,j[6]*=o,j[1]*=g,j[4]*=g,j[7]*=g,this}rotate(o){const g=Math.cos(o),j=Math.sin(o),Y=this.elements,ee=Y[0],ie=Y[3],se=Y[6],de=Y[1],pe=Y[4],be=Y[7];return Y[0]=g*ee+j*de,Y[3]=g*ie+j*pe,Y[6]=g*se+j*be,Y[1]=-j*ee+g*de,Y[4]=-j*ie+g*pe,Y[7]=-j*se+g*be,this}translate(o,g){const j=this.elements;return j[0]+=o*j[2],j[3]+=o*j[5],j[6]+=o*j[8],j[1]+=g*j[2],j[4]+=g*j[5],j[7]+=g*j[8],this}equals(o){const g=this.elements,j=o.elements;for(let Y=0;Y<9;Y++)if(g[Y]!==j[Y])return!1;return!0}fromArray(o,g=0){for(let j=0;j<9;j++)this.elements[j]=o[j+g];return this}toArray(o=[],g=0){const j=this.elements;return o[g]=j[0],o[g+1]=j[1],o[g+2]=j[2],o[g+3]=j[3],o[g+4]=j[4],o[g+5]=j[5],o[g+6]=j[6],o[g+7]=j[7],o[g+8]=j[8],o}clone(){return new this.constructor().fromArray(this.elements)}}function fg(ue){for(let o=ue.length-1;o>=0;--o)if(ue[o]>65535)return!0;return!1}const Sv={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Dc(ue,o){return new Sv[ue](o)}function pu(ue){return document.createElementNS("http://www.w3.org/1999/xhtml",ue)}function Al(ue){return ue<.04045?.0773993808*ue:Math.pow(.9478672986*ue+.0521327014,2.4)}function id(ue){return ue<.0031308?12.92*ue:1.055*Math.pow(ue,.41666)-.055}const Pc={[mo]:{[zr]:Al},[zr]:{[mo]:id}},Ra={legacyMode:!0,get workingColorSpace(){return zr},set workingColorSpace(ue){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(ue,o,g){if(this.legacyMode||o===g||!o||!g)return ue;if(Pc[o]&&Pc[o][g]!==void 0){const j=Pc[o][g];return ue.r=j(ue.r),ue.g=j(ue.g),ue.b=j(ue.b),ue}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(ue,o){return this.convert(ue,this.workingColorSpace,o)},toWorkingColorSpace:function(ue,o){return this.convert(ue,o,this.workingColorSpace)}},Rf={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ts={r:0,g:0,b:0},Ya={h:0,s:0,l:0},Ap={h:0,s:0,l:0};function Ba(ue,o,g){return g<0&&(g+=1),g>1&&(g-=1),g<1/6?ue+6*(o-ue)*g:g<.5?o:g<2/3?ue+6*(o-ue)*(2/3-g):ue}function rd(ue,o){return o.r=ue.r,o.g=ue.g,o.b=ue.b,o}class ci{constructor(o,g,j){return this.isColor=!0,this.r=1,this.g=1,this.b=1,g===void 0&&j===void 0?this.set(o):this.setRGB(o,g,j)}set(o){return o&&o.isColor?this.copy(o):typeof o=="number"?this.setHex(o):typeof o=="string"&&this.setStyle(o),this}setScalar(o){return this.r=o,this.g=o,this.b=o,this}setHex(o,g=mo){return o=Math.floor(o),this.r=(o>>16&255)/255,this.g=(o>>8&255)/255,this.b=(255&o)/255,Ra.toWorkingColorSpace(this,g),this}setRGB(o,g,j,Y=zr){return this.r=o,this.g=g,this.b=j,Ra.toWorkingColorSpace(this,Y),this}setHSL(o,g,j,Y=zr){if(o=vl(o,1),g=Si(g,0,1),j=Si(j,0,1),g===0)this.r=this.g=this.b=j;else{const ee=j<=.5?j*(1+g):j+g-j*g,ie=2*j-ee;this.r=Ba(ie,ee,o+1/3),this.g=Ba(ie,ee,o),this.b=Ba(ie,ee,o-1/3)}return Ra.toWorkingColorSpace(this,Y),this}setStyle(o,g=mo){function j(ee){ee!==void 0&&parseFloat(ee)<1&&console.warn("THREE.Color: Alpha component of "+o+" will be ignored.")}let Y;if(Y=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(o)){let ee;const ie=Y[1],se=Y[2];switch(ie){case"rgb":case"rgba":if(ee=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(se))return this.r=Math.min(255,parseInt(ee[1],10))/255,this.g=Math.min(255,parseInt(ee[2],10))/255,this.b=Math.min(255,parseInt(ee[3],10))/255,Ra.toWorkingColorSpace(this,g),j(ee[4]),this;if(ee=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(se))return this.r=Math.min(100,parseInt(ee[1],10))/100,this.g=Math.min(100,parseInt(ee[2],10))/100,this.b=Math.min(100,parseInt(ee[3],10))/100,Ra.toWorkingColorSpace(this,g),j(ee[4]),this;break;case"hsl":case"hsla":if(ee=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(se)){const de=parseFloat(ee[1])/360,pe=parseFloat(ee[2])/100,be=parseFloat(ee[3])/100;return j(ee[4]),this.setHSL(de,pe,be,g)}}}else if(Y=/^\#([A-Fa-f\d]+)$/.exec(o)){const ee=Y[1],ie=ee.length;if(ie===3)return this.r=parseInt(ee.charAt(0)+ee.charAt(0),16)/255,this.g=parseInt(ee.charAt(1)+ee.charAt(1),16)/255,this.b=parseInt(ee.charAt(2)+ee.charAt(2),16)/255,Ra.toWorkingColorSpace(this,g),this;if(ie===6)return this.r=parseInt(ee.charAt(0)+ee.charAt(1),16)/255,this.g=parseInt(ee.charAt(2)+ee.charAt(3),16)/255,this.b=parseInt(ee.charAt(4)+ee.charAt(5),16)/255,Ra.toWorkingColorSpace(this,g),this}return o&&o.length>0?this.setColorName(o,g):this}setColorName(o,g=mo){const j=Rf[o.toLowerCase()];return j!==void 0?this.setHex(j,g):console.warn("THREE.Color: Unknown color "+o),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(o){return this.r=o.r,this.g=o.g,this.b=o.b,this}copySRGBToLinear(o){return this.r=Al(o.r),this.g=Al(o.g),this.b=Al(o.b),this}copyLinearToSRGB(o){return this.r=id(o.r),this.g=id(o.g),this.b=id(o.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(o=mo){return Ra.fromWorkingColorSpace(rd(this,Ts),o),Si(255*Ts.r,0,255)<<16^Si(255*Ts.g,0,255)<<8^Si(255*Ts.b,0,255)<<0}getHexString(o=mo){return("000000"+this.getHex(o).toString(16)).slice(-6)}getHSL(o,g=zr){Ra.fromWorkingColorSpace(rd(this,Ts),g);const j=Ts.r,Y=Ts.g,ee=Ts.b,ie=Math.max(j,Y,ee),se=Math.min(j,Y,ee);let de,pe;const be=(se+ie)/2;if(se===ie)de=0,pe=0;else{const Ce=ie-se;switch(pe=be<=.5?Ce/(ie+se):Ce/(2-ie-se),ie){case j:de=(Y-ee)/Ce+(Y<ee?6:0);break;case Y:de=(ee-j)/Ce+2;break;case ee:de=(j-Y)/Ce+4}de/=6}return o.h=de,o.s=pe,o.l=be,o}getRGB(o,g=zr){return Ra.fromWorkingColorSpace(rd(this,Ts),g),o.r=Ts.r,o.g=Ts.g,o.b=Ts.b,o}getStyle(o=mo){return Ra.fromWorkingColorSpace(rd(this,Ts),o),o!==mo?`color(${o} ${Ts.r} ${Ts.g} ${Ts.b})`:`rgb(${255*Ts.r|0},${255*Ts.g|0},${255*Ts.b|0})`}offsetHSL(o,g,j){return this.getHSL(Ya),Ya.h+=o,Ya.s+=g,Ya.l+=j,this.setHSL(Ya.h,Ya.s,Ya.l),this}add(o){return this.r+=o.r,this.g+=o.g,this.b+=o.b,this}addColors(o,g){return this.r=o.r+g.r,this.g=o.g+g.g,this.b=o.b+g.b,this}addScalar(o){return this.r+=o,this.g+=o,this.b+=o,this}sub(o){return this.r=Math.max(0,this.r-o.r),this.g=Math.max(0,this.g-o.g),this.b=Math.max(0,this.b-o.b),this}multiply(o){return this.r*=o.r,this.g*=o.g,this.b*=o.b,this}multiplyScalar(o){return this.r*=o,this.g*=o,this.b*=o,this}lerp(o,g){return this.r+=(o.r-this.r)*g,this.g+=(o.g-this.g)*g,this.b+=(o.b-this.b)*g,this}lerpColors(o,g,j){return this.r=o.r+(g.r-o.r)*j,this.g=o.g+(g.g-o.g)*j,this.b=o.b+(g.b-o.b)*j,this}lerpHSL(o,g){this.getHSL(Ya),o.getHSL(Ap);const j=td(Ya.h,Ap.h,g),Y=td(Ya.s,Ap.s,g),ee=td(Ya.l,Ap.l,g);return this.setHSL(j,Y,ee),this}equals(o){return o.r===this.r&&o.g===this.g&&o.b===this.b}fromArray(o,g=0){return this.r=o[g],this.g=o[g+1],this.b=o[g+2],this}toArray(o=[],g=0){return o[g]=this.r,o[g+1]=this.g,o[g+2]=this.b,o}fromBufferAttribute(o,g){return this.r=o.getX(g),this.g=o.getY(g),this.b=o.getZ(g),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let fu;ci.NAMES=Rf;class mu{static getDataURL(o,g=!1){if(/^data:/i.test(o.src)||typeof HTMLCanvasElement>"u")return o.src;let j;if(o instanceof HTMLCanvasElement)j=o;else{fu===void 0&&(fu=pu("canvas")),fu.width=o.width,fu.height=o.height;const Y=fu.getContext("2d");o instanceof ImageData?Y.putImageData(o,0,0):Y.drawImage(o,0,0,o.width,o.height),j=fu}return!g&&(j.width>2048||j.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",o),j.toDataURL("image/jpeg",.6)):j.toDataURL("image/png")}static sRGBToLinear(o){if(typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&o instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&o instanceof ImageBitmap){const g=pu("canvas");g.width=o.width,g.height=o.height;const j=g.getContext("2d");j.drawImage(o,0,0,o.width,o.height);const Y=j.getImageData(0,0,o.width,o.height),ee=Y.data;for(let ie=0;ie<ee.length;ie++)ee[ie]=255*Al(ee[ie]/255);return j.putImageData(Y,0,0),g}if(o.data){const g=o.data.slice(0);for(let j=0;j<g.length;j++)g instanceof Uint8Array||g instanceof Uint8ClampedArray?g[j]=Math.floor(255*Al(g[j]/255)):g[j]=Al(g[j]);return{data:g,width:o.width,height:o.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),o}}class ka{constructor(o=null){this.isSource=!0,this.uuid=Oi(),this.data=o,this.version=0}set needsUpdate(o){o===!0&&this.version++}toJSON(o){const g=o===void 0||typeof o=="string";if(!g&&o.images[this.uuid]!==void 0)return o.images[this.uuid];const j={uuid:this.uuid,url:""},Y=this.data;if(Y!==null){let ee;if(Array.isArray(Y)){ee=[];for(let ie=0,se=Y.length;ie<se;ie++)Y[ie].isDataTexture?ee.push(sd(Y[ie].image)):ee.push(sd(Y[ie]))}else ee=sd(Y);j.url=ee}return g||(o.images[this.uuid]=j),j}}function sd(ue){if(typeof HTMLImageElement<"u"&&ue instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ue instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&ue instanceof ImageBitmap)return mu.getDataURL(ue);if(ue.data){let o=[];try{o=Array.from(ue.data)}catch(g){g.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(g),o=ue.data}return{data:o,width:ue.width,height:ue.height,type:ue.data.constructor.name}}return console.warn("THREE.Texture: Unable to serialize Texture."),{}}let ah=0;class vs extends va{constructor(o=vs.DEFAULT_IMAGE,g=vs.DEFAULT_MAPPING,j=rr,Y=rr,ee=Ur,ie=oi,se=Ii,de=Bs,pe=1,be=na){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:ah++}),this.uuid=Oi(),this.name="",this.source=new ka(o),this.mipmaps=[],this.mapping=g,this.wrapS=j,this.wrapT=Y,this.magFilter=ee,this.minFilter=ie,this.anisotropy=pe,this.format=se,this.internalFormat=null,this.type=de,this.offset=new Bn(0,0),this.repeat=new Bn(1,1),this.center=new Bn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new go,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=be,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(o){this.source.data=o}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(o){return this.name=o.name,this.source=o.source,this.mipmaps=o.mipmaps.slice(0),this.mapping=o.mapping,this.wrapS=o.wrapS,this.wrapT=o.wrapT,this.magFilter=o.magFilter,this.minFilter=o.minFilter,this.anisotropy=o.anisotropy,this.format=o.format,this.internalFormat=o.internalFormat,this.type=o.type,this.offset.copy(o.offset),this.repeat.copy(o.repeat),this.center.copy(o.center),this.rotation=o.rotation,this.matrixAutoUpdate=o.matrixAutoUpdate,this.matrix.copy(o.matrix),this.generateMipmaps=o.generateMipmaps,this.premultiplyAlpha=o.premultiplyAlpha,this.flipY=o.flipY,this.unpackAlignment=o.unpackAlignment,this.encoding=o.encoding,this.userData=JSON.parse(JSON.stringify(o.userData)),this.needsUpdate=!0,this}toJSON(o){const g=o===void 0||typeof o=="string";if(!g&&o.textures[this.uuid]!==void 0)return o.textures[this.uuid];const j={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(o).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(j.userData=this.userData),g||(o.textures[this.uuid]=j),j}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(o){if(this.mapping!==ms)return o;if(o.applyMatrix3(this.matrix),o.x<0||o.x>1)switch(this.wrapS){case pr:o.x=o.x-Math.floor(o.x);break;case rr:o.x=o.x<0?0:1;break;case ss:Math.abs(Math.floor(o.x)%2)===1?o.x=Math.ceil(o.x)-o.x:o.x=o.x-Math.floor(o.x)}if(o.y<0||o.y>1)switch(this.wrapT){case pr:o.y=o.y-Math.floor(o.y);break;case rr:o.y=o.y<0?0:1;break;case ss:Math.abs(Math.floor(o.y)%2)===1?o.y=Math.ceil(o.y)-o.y:o.y=o.y-Math.floor(o.y)}return this.flipY&&(o.y=1-o.y),o}set needsUpdate(o){o===!0&&(this.version++,this.source.needsUpdate=!0)}}vs.DEFAULT_IMAGE=null,vs.DEFAULT_MAPPING=ms;class Vr{constructor(o=0,g=0,j=0,Y=1){Vr.prototype.isVector4=!0,this.x=o,this.y=g,this.z=j,this.w=Y}get width(){return this.z}set width(o){this.z=o}get height(){return this.w}set height(o){this.w=o}set(o,g,j,Y){return this.x=o,this.y=g,this.z=j,this.w=Y,this}setScalar(o){return this.x=o,this.y=o,this.z=o,this.w=o,this}setX(o){return this.x=o,this}setY(o){return this.y=o,this}setZ(o){return this.z=o,this}setW(o){return this.w=o,this}setComponent(o,g){switch(o){case 0:this.x=g;break;case 1:this.y=g;break;case 2:this.z=g;break;case 3:this.w=g;break;default:throw new Error("index is out of range: "+o)}return this}getComponent(o){switch(o){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+o)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(o){return this.x=o.x,this.y=o.y,this.z=o.z,this.w=o.w!==void 0?o.w:1,this}add(o){return this.x+=o.x,this.y+=o.y,this.z+=o.z,this.w+=o.w,this}addScalar(o){return this.x+=o,this.y+=o,this.z+=o,this.w+=o,this}addVectors(o,g){return this.x=o.x+g.x,this.y=o.y+g.y,this.z=o.z+g.z,this.w=o.w+g.w,this}addScaledVector(o,g){return this.x+=o.x*g,this.y+=o.y*g,this.z+=o.z*g,this.w+=o.w*g,this}sub(o){return this.x-=o.x,this.y-=o.y,this.z-=o.z,this.w-=o.w,this}subScalar(o){return this.x-=o,this.y-=o,this.z-=o,this.w-=o,this}subVectors(o,g){return this.x=o.x-g.x,this.y=o.y-g.y,this.z=o.z-g.z,this.w=o.w-g.w,this}multiply(o){return this.x*=o.x,this.y*=o.y,this.z*=o.z,this.w*=o.w,this}multiplyScalar(o){return this.x*=o,this.y*=o,this.z*=o,this.w*=o,this}applyMatrix4(o){const g=this.x,j=this.y,Y=this.z,ee=this.w,ie=o.elements;return this.x=ie[0]*g+ie[4]*j+ie[8]*Y+ie[12]*ee,this.y=ie[1]*g+ie[5]*j+ie[9]*Y+ie[13]*ee,this.z=ie[2]*g+ie[6]*j+ie[10]*Y+ie[14]*ee,this.w=ie[3]*g+ie[7]*j+ie[11]*Y+ie[15]*ee,this}divideScalar(o){return this.multiplyScalar(1/o)}setAxisAngleFromQuaternion(o){this.w=2*Math.acos(o.w);const g=Math.sqrt(1-o.w*o.w);return g<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=o.x/g,this.y=o.y/g,this.z=o.z/g),this}setAxisAngleFromRotationMatrix(o){let g,j,Y,ee;const de=o.elements,pe=de[0],be=de[4],Ce=de[8],xe=de[1],Ie=de[5],Re=de[9],De=de[2],ze=de[6],je=de[10];if(Math.abs(be-xe)<.01&&Math.abs(Ce-De)<.01&&Math.abs(Re-ze)<.01){if(Math.abs(be+xe)<.1&&Math.abs(Ce+De)<.1&&Math.abs(Re+ze)<.1&&Math.abs(pe+Ie+je-3)<.1)return this.set(1,0,0,0),this;g=Math.PI;const $e=(pe+1)/2,ct=(Ie+1)/2,dt=(je+1)/2,ft=(be+xe)/4,Bt=(Ce+De)/4,Lt=(Re+ze)/4;return $e>ct&&$e>dt?$e<.01?(j=0,Y=.707106781,ee=.707106781):(j=Math.sqrt($e),Y=ft/j,ee=Bt/j):ct>dt?ct<.01?(j=.707106781,Y=0,ee=.707106781):(Y=Math.sqrt(ct),j=ft/Y,ee=Lt/Y):dt<.01?(j=.707106781,Y=.707106781,ee=0):(ee=Math.sqrt(dt),j=Bt/ee,Y=Lt/ee),this.set(j,Y,ee,g),this}let Ve=Math.sqrt((ze-Re)*(ze-Re)+(Ce-De)*(Ce-De)+(xe-be)*(xe-be));return Math.abs(Ve)<.001&&(Ve=1),this.x=(ze-Re)/Ve,this.y=(Ce-De)/Ve,this.z=(xe-be)/Ve,this.w=Math.acos((pe+Ie+je-1)/2),this}min(o){return this.x=Math.min(this.x,o.x),this.y=Math.min(this.y,o.y),this.z=Math.min(this.z,o.z),this.w=Math.min(this.w,o.w),this}max(o){return this.x=Math.max(this.x,o.x),this.y=Math.max(this.y,o.y),this.z=Math.max(this.z,o.z),this.w=Math.max(this.w,o.w),this}clamp(o,g){return this.x=Math.max(o.x,Math.min(g.x,this.x)),this.y=Math.max(o.y,Math.min(g.y,this.y)),this.z=Math.max(o.z,Math.min(g.z,this.z)),this.w=Math.max(o.w,Math.min(g.w,this.w)),this}clampScalar(o,g){return this.x=Math.max(o,Math.min(g,this.x)),this.y=Math.max(o,Math.min(g,this.y)),this.z=Math.max(o,Math.min(g,this.z)),this.w=Math.max(o,Math.min(g,this.w)),this}clampLength(o,g){const j=this.length();return this.divideScalar(j||1).multiplyScalar(Math.max(o,Math.min(g,j)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(o){return this.x*o.x+this.y*o.y+this.z*o.z+this.w*o.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(o){return this.normalize().multiplyScalar(o)}lerp(o,g){return this.x+=(o.x-this.x)*g,this.y+=(o.y-this.y)*g,this.z+=(o.z-this.z)*g,this.w+=(o.w-this.w)*g,this}lerpVectors(o,g,j){return this.x=o.x+(g.x-o.x)*j,this.y=o.y+(g.y-o.y)*j,this.z=o.z+(g.z-o.z)*j,this.w=o.w+(g.w-o.w)*j,this}equals(o){return o.x===this.x&&o.y===this.y&&o.z===this.z&&o.w===this.w}fromArray(o,g=0){return this.x=o[g],this.y=o[g+1],this.z=o[g+2],this.w=o[g+3],this}toArray(o=[],g=0){return o[g]=this.x,o[g+1]=this.y,o[g+2]=this.z,o[g+3]=this.w,o}fromBufferAttribute(o,g){return this.x=o.getX(g),this.y=o.getY(g),this.z=o.getZ(g),this.w=o.getW(g),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Aa extends va{constructor(o,g,j={}){super(),this.isWebGLRenderTarget=!0,this.width=o,this.height=g,this.depth=1,this.scissor=new Vr(0,0,o,g),this.scissorTest=!1,this.viewport=new Vr(0,0,o,g);const Y={width:o,height:g,depth:1};this.texture=new vs(Y,j.mapping,j.wrapS,j.wrapT,j.magFilter,j.minFilter,j.format,j.type,j.anisotropy,j.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=j.generateMipmaps!==void 0&&j.generateMipmaps,this.texture.internalFormat=j.internalFormat!==void 0?j.internalFormat:null,this.texture.minFilter=j.minFilter!==void 0?j.minFilter:Ur,this.depthBuffer=j.depthBuffer===void 0||j.depthBuffer,this.stencilBuffer=j.stencilBuffer!==void 0&&j.stencilBuffer,this.depthTexture=j.depthTexture!==void 0?j.depthTexture:null,this.samples=j.samples!==void 0?j.samples:0}setSize(o,g,j=1){this.width===o&&this.height===g&&this.depth===j||(this.width=o,this.height=g,this.depth=j,this.texture.image.width=o,this.texture.image.height=g,this.texture.image.depth=j,this.dispose()),this.viewport.set(0,0,o,g),this.scissor.set(0,0,o,g)}clone(){return new this.constructor().copy(this)}copy(o){this.width=o.width,this.height=o.height,this.depth=o.depth,this.viewport.copy(o.viewport),this.texture=o.texture.clone(),this.texture.isRenderTargetTexture=!0;const g=Object.assign({},o.texture.image);return this.texture.source=new ka(g),this.depthBuffer=o.depthBuffer,this.stencilBuffer=o.stencilBuffer,o.depthTexture!==null&&(this.depthTexture=o.depthTexture.clone()),this.samples=o.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class lh extends vs{constructor(o=null,g=1,j=1,Y=1){super(null),this.isDataArrayTexture=!0,this.image={data:o,width:g,height:j,depth:Y},this.magFilter=Gr,this.minFilter=Gr,this.wrapR=rr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Bf extends Aa{constructor(o,g,j){super(o,g),this.isWebGLArrayRenderTarget=!0,this.depth=j,this.texture=new lh(null,o,g,j),this.texture.isRenderTargetTexture=!0}}class ch extends vs{constructor(o=null,g=1,j=1,Y=1){super(null),this.isData3DTexture=!0,this.image={data:o,width:g,height:j,depth:Y},this.magFilter=Gr,this.minFilter=Gr,this.wrapR=rr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class mg extends Aa{constructor(o,g,j){super(o,g),this.isWebGL3DRenderTarget=!0,this.depth=j,this.texture=new ch(null,o,g,j),this.texture.isRenderTargetTexture=!0}}class gg extends Aa{constructor(o,g,j,Y={}){super(o,g,Y),this.isWebGLMultipleRenderTargets=!0;const ee=this.texture;this.texture=[];for(let ie=0;ie<j;ie++)this.texture[ie]=ee.clone(),this.texture[ie].isRenderTargetTexture=!0}setSize(o,g,j=1){if(this.width!==o||this.height!==g||this.depth!==j){this.width=o,this.height=g,this.depth=j;for(let Y=0,ee=this.texture.length;Y<ee;Y++)this.texture[Y].image.width=o,this.texture[Y].image.height=g,this.texture[Y].image.depth=j;this.dispose()}return this.viewport.set(0,0,o,g),this.scissor.set(0,0,o,g),this}copy(o){this.dispose(),this.width=o.width,this.height=o.height,this.depth=o.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=o.depthBuffer,this.stencilBuffer=o.stencilBuffer,o.depthTexture!==null&&(this.depthTexture=o.depthTexture.clone()),this.texture.length=0;for(let g=0,j=o.texture.length;g<j;g++)this.texture[g]=o.texture[g].clone(),this.texture[g].isRenderTargetTexture=!0;return this}}class _o{constructor(o=0,g=0,j=0,Y=1){this.isQuaternion=!0,this._x=o,this._y=g,this._z=j,this._w=Y}static slerpFlat(o,g,j,Y,ee,ie,se){let de=j[Y+0],pe=j[Y+1],be=j[Y+2],Ce=j[Y+3];const xe=ee[ie+0],Ie=ee[ie+1],Re=ee[ie+2],De=ee[ie+3];if(se===0)return o[g+0]=de,o[g+1]=pe,o[g+2]=be,void(o[g+3]=Ce);if(se===1)return o[g+0]=xe,o[g+1]=Ie,o[g+2]=Re,void(o[g+3]=De);if(Ce!==De||de!==xe||pe!==Ie||be!==Re){let ze=1-se;const je=de*xe+pe*Ie+be*Re+Ce*De,Ve=je>=0?1:-1,$e=1-je*je;if($e>Number.EPSILON){const dt=Math.sqrt($e),ft=Math.atan2(dt,je*Ve);ze=Math.sin(ze*ft)/dt,se=Math.sin(se*ft)/dt}const ct=se*Ve;if(de=de*ze+xe*ct,pe=pe*ze+Ie*ct,be=be*ze+Re*ct,Ce=Ce*ze+De*ct,ze===1-se){const dt=1/Math.sqrt(de*de+pe*pe+be*be+Ce*Ce);de*=dt,pe*=dt,be*=dt,Ce*=dt}}o[g]=de,o[g+1]=pe,o[g+2]=be,o[g+3]=Ce}static multiplyQuaternionsFlat(o,g,j,Y,ee,ie){const se=j[Y],de=j[Y+1],pe=j[Y+2],be=j[Y+3],Ce=ee[ie],xe=ee[ie+1],Ie=ee[ie+2],Re=ee[ie+3];return o[g]=se*Re+be*Ce+de*Ie-pe*xe,o[g+1]=de*Re+be*xe+pe*Ce-se*Ie,o[g+2]=pe*Re+be*Ie+se*xe-de*Ce,o[g+3]=be*Re-se*Ce-de*xe-pe*Ie,o}get x(){return this._x}set x(o){this._x=o,this._onChangeCallback()}get y(){return this._y}set y(o){this._y=o,this._onChangeCallback()}get z(){return this._z}set z(o){this._z=o,this._onChangeCallback()}get w(){return this._w}set w(o){this._w=o,this._onChangeCallback()}set(o,g,j,Y){return this._x=o,this._y=g,this._z=j,this._w=Y,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(o){return this._x=o.x,this._y=o.y,this._z=o.z,this._w=o.w,this._onChangeCallback(),this}setFromEuler(o,g){const j=o._x,Y=o._y,ee=o._z,ie=o._order,se=Math.cos,de=Math.sin,pe=se(j/2),be=se(Y/2),Ce=se(ee/2),xe=de(j/2),Ie=de(Y/2),Re=de(ee/2);switch(ie){case"XYZ":this._x=xe*be*Ce+pe*Ie*Re,this._y=pe*Ie*Ce-xe*be*Re,this._z=pe*be*Re+xe*Ie*Ce,this._w=pe*be*Ce-xe*Ie*Re;break;case"YXZ":this._x=xe*be*Ce+pe*Ie*Re,this._y=pe*Ie*Ce-xe*be*Re,this._z=pe*be*Re-xe*Ie*Ce,this._w=pe*be*Ce+xe*Ie*Re;break;case"ZXY":this._x=xe*be*Ce-pe*Ie*Re,this._y=pe*Ie*Ce+xe*be*Re,this._z=pe*be*Re+xe*Ie*Ce,this._w=pe*be*Ce-xe*Ie*Re;break;case"ZYX":this._x=xe*be*Ce-pe*Ie*Re,this._y=pe*Ie*Ce+xe*be*Re,this._z=pe*be*Re-xe*Ie*Ce,this._w=pe*be*Ce+xe*Ie*Re;break;case"YZX":this._x=xe*be*Ce+pe*Ie*Re,this._y=pe*Ie*Ce+xe*be*Re,this._z=pe*be*Re-xe*Ie*Ce,this._w=pe*be*Ce-xe*Ie*Re;break;case"XZY":this._x=xe*be*Ce-pe*Ie*Re,this._y=pe*Ie*Ce-xe*be*Re,this._z=pe*be*Re+xe*Ie*Ce,this._w=pe*be*Ce+xe*Ie*Re;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+ie)}return g!==!1&&this._onChangeCallback(),this}setFromAxisAngle(o,g){const j=g/2,Y=Math.sin(j);return this._x=o.x*Y,this._y=o.y*Y,this._z=o.z*Y,this._w=Math.cos(j),this._onChangeCallback(),this}setFromRotationMatrix(o){const g=o.elements,j=g[0],Y=g[4],ee=g[8],ie=g[1],se=g[5],de=g[9],pe=g[2],be=g[6],Ce=g[10],xe=j+se+Ce;if(xe>0){const Ie=.5/Math.sqrt(xe+1);this._w=.25/Ie,this._x=(be-de)*Ie,this._y=(ee-pe)*Ie,this._z=(ie-Y)*Ie}else if(j>se&&j>Ce){const Ie=2*Math.sqrt(1+j-se-Ce);this._w=(be-de)/Ie,this._x=.25*Ie,this._y=(Y+ie)/Ie,this._z=(ee+pe)/Ie}else if(se>Ce){const Ie=2*Math.sqrt(1+se-j-Ce);this._w=(ee-pe)/Ie,this._x=(Y+ie)/Ie,this._y=.25*Ie,this._z=(de+be)/Ie}else{const Ie=2*Math.sqrt(1+Ce-j-se);this._w=(ie-Y)/Ie,this._x=(ee+pe)/Ie,this._y=(de+be)/Ie,this._z=.25*Ie}return this._onChangeCallback(),this}setFromUnitVectors(o,g){let j=o.dot(g)+1;return j<Number.EPSILON?(j=0,Math.abs(o.x)>Math.abs(o.z)?(this._x=-o.y,this._y=o.x,this._z=0,this._w=j):(this._x=0,this._y=-o.z,this._z=o.y,this._w=j)):(this._x=o.y*g.z-o.z*g.y,this._y=o.z*g.x-o.x*g.z,this._z=o.x*g.y-o.y*g.x,this._w=j),this.normalize()}angleTo(o){return 2*Math.acos(Math.abs(Si(this.dot(o),-1,1)))}rotateTowards(o,g){const j=this.angleTo(o);if(j===0)return this;const Y=Math.min(1,g/j);return this.slerp(o,Y),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(o){return this._x*o._x+this._y*o._y+this._z*o._z+this._w*o._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let o=this.length();return o===0?(this._x=0,this._y=0,this._z=0,this._w=1):(o=1/o,this._x=this._x*o,this._y=this._y*o,this._z=this._z*o,this._w=this._w*o),this._onChangeCallback(),this}multiply(o){return this.multiplyQuaternions(this,o)}premultiply(o){return this.multiplyQuaternions(o,this)}multiplyQuaternions(o,g){const j=o._x,Y=o._y,ee=o._z,ie=o._w,se=g._x,de=g._y,pe=g._z,be=g._w;return this._x=j*be+ie*se+Y*pe-ee*de,this._y=Y*be+ie*de+ee*se-j*pe,this._z=ee*be+ie*pe+j*de-Y*se,this._w=ie*be-j*se-Y*de-ee*pe,this._onChangeCallback(),this}slerp(o,g){if(g===0)return this;if(g===1)return this.copy(o);const j=this._x,Y=this._y,ee=this._z,ie=this._w;let se=ie*o._w+j*o._x+Y*o._y+ee*o._z;if(se<0?(this._w=-o._w,this._x=-o._x,this._y=-o._y,this._z=-o._z,se=-se):this.copy(o),se>=1)return this._w=ie,this._x=j,this._y=Y,this._z=ee,this;const de=1-se*se;if(de<=Number.EPSILON){const Ie=1-g;return this._w=Ie*ie+g*this._w,this._x=Ie*j+g*this._x,this._y=Ie*Y+g*this._y,this._z=Ie*ee+g*this._z,this.normalize(),this._onChangeCallback(),this}const pe=Math.sqrt(de),be=Math.atan2(pe,se),Ce=Math.sin((1-g)*be)/pe,xe=Math.sin(g*be)/pe;return this._w=ie*Ce+this._w*xe,this._x=j*Ce+this._x*xe,this._y=Y*Ce+this._y*xe,this._z=ee*Ce+this._z*xe,this._onChangeCallback(),this}slerpQuaternions(o,g,j){return this.copy(o).slerp(g,j)}random(){const o=Math.random(),g=Math.sqrt(1-o),j=Math.sqrt(o),Y=2*Math.PI*Math.random(),ee=2*Math.PI*Math.random();return this.set(g*Math.cos(Y),j*Math.sin(ee),j*Math.cos(ee),g*Math.sin(Y))}equals(o){return o._x===this._x&&o._y===this._y&&o._z===this._z&&o._w===this._w}fromArray(o,g=0){return this._x=o[g],this._y=o[g+1],this._z=o[g+2],this._w=o[g+3],this._onChangeCallback(),this}toArray(o=[],g=0){return o[g]=this._x,o[g+1]=this._y,o[g+2]=this._z,o[g+3]=this._w,o}fromBufferAttribute(o,g){return this._x=o.getX(g),this._y=o.getY(g),this._z=o.getZ(g),this._w=o.getW(g),this}_onChange(o){return this._onChangeCallback=o,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class vt{constructor(o=0,g=0,j=0){vt.prototype.isVector3=!0,this.x=o,this.y=g,this.z=j}set(o,g,j){return j===void 0&&(j=this.z),this.x=o,this.y=g,this.z=j,this}setScalar(o){return this.x=o,this.y=o,this.z=o,this}setX(o){return this.x=o,this}setY(o){return this.y=o,this}setZ(o){return this.z=o,this}setComponent(o,g){switch(o){case 0:this.x=g;break;case 1:this.y=g;break;case 2:this.z=g;break;default:throw new Error("index is out of range: "+o)}return this}getComponent(o){switch(o){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+o)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(o){return this.x=o.x,this.y=o.y,this.z=o.z,this}add(o){return this.x+=o.x,this.y+=o.y,this.z+=o.z,this}addScalar(o){return this.x+=o,this.y+=o,this.z+=o,this}addVectors(o,g){return this.x=o.x+g.x,this.y=o.y+g.y,this.z=o.z+g.z,this}addScaledVector(o,g){return this.x+=o.x*g,this.y+=o.y*g,this.z+=o.z*g,this}sub(o){return this.x-=o.x,this.y-=o.y,this.z-=o.z,this}subScalar(o){return this.x-=o,this.y-=o,this.z-=o,this}subVectors(o,g){return this.x=o.x-g.x,this.y=o.y-g.y,this.z=o.z-g.z,this}multiply(o){return this.x*=o.x,this.y*=o.y,this.z*=o.z,this}multiplyScalar(o){return this.x*=o,this.y*=o,this.z*=o,this}multiplyVectors(o,g){return this.x=o.x*g.x,this.y=o.y*g.y,this.z=o.z*g.z,this}applyEuler(o){return this.applyQuaternion(od.setFromEuler(o))}applyAxisAngle(o,g){return this.applyQuaternion(od.setFromAxisAngle(o,g))}applyMatrix3(o){const g=this.x,j=this.y,Y=this.z,ee=o.elements;return this.x=ee[0]*g+ee[3]*j+ee[6]*Y,this.y=ee[1]*g+ee[4]*j+ee[7]*Y,this.z=ee[2]*g+ee[5]*j+ee[8]*Y,this}applyNormalMatrix(o){return this.applyMatrix3(o).normalize()}applyMatrix4(o){const g=this.x,j=this.y,Y=this.z,ee=o.elements,ie=1/(ee[3]*g+ee[7]*j+ee[11]*Y+ee[15]);return this.x=(ee[0]*g+ee[4]*j+ee[8]*Y+ee[12])*ie,this.y=(ee[1]*g+ee[5]*j+ee[9]*Y+ee[13])*ie,this.z=(ee[2]*g+ee[6]*j+ee[10]*Y+ee[14])*ie,this}applyQuaternion(o){const g=this.x,j=this.y,Y=this.z,ee=o.x,ie=o.y,se=o.z,de=o.w,pe=de*g+ie*Y-se*j,be=de*j+se*g-ee*Y,Ce=de*Y+ee*j-ie*g,xe=-ee*g-ie*j-se*Y;return this.x=pe*de+xe*-ee+be*-se-Ce*-ie,this.y=be*de+xe*-ie+Ce*-ee-pe*-se,this.z=Ce*de+xe*-se+pe*-ie-be*-ee,this}project(o){return this.applyMatrix4(o.matrixWorldInverse).applyMatrix4(o.projectionMatrix)}unproject(o){return this.applyMatrix4(o.projectionMatrixInverse).applyMatrix4(o.matrixWorld)}transformDirection(o){const g=this.x,j=this.y,Y=this.z,ee=o.elements;return this.x=ee[0]*g+ee[4]*j+ee[8]*Y,this.y=ee[1]*g+ee[5]*j+ee[9]*Y,this.z=ee[2]*g+ee[6]*j+ee[10]*Y,this.normalize()}divide(o){return this.x/=o.x,this.y/=o.y,this.z/=o.z,this}divideScalar(o){return this.multiplyScalar(1/o)}min(o){return this.x=Math.min(this.x,o.x),this.y=Math.min(this.y,o.y),this.z=Math.min(this.z,o.z),this}max(o){return this.x=Math.max(this.x,o.x),this.y=Math.max(this.y,o.y),this.z=Math.max(this.z,o.z),this}clamp(o,g){return this.x=Math.max(o.x,Math.min(g.x,this.x)),this.y=Math.max(o.y,Math.min(g.y,this.y)),this.z=Math.max(o.z,Math.min(g.z,this.z)),this}clampScalar(o,g){return this.x=Math.max(o,Math.min(g,this.x)),this.y=Math.max(o,Math.min(g,this.y)),this.z=Math.max(o,Math.min(g,this.z)),this}clampLength(o,g){const j=this.length();return this.divideScalar(j||1).multiplyScalar(Math.max(o,Math.min(g,j)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(o){return this.x*o.x+this.y*o.y+this.z*o.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(o){return this.normalize().multiplyScalar(o)}lerp(o,g){return this.x+=(o.x-this.x)*g,this.y+=(o.y-this.y)*g,this.z+=(o.z-this.z)*g,this}lerpVectors(o,g,j){return this.x=o.x+(g.x-o.x)*j,this.y=o.y+(g.y-o.y)*j,this.z=o.z+(g.z-o.z)*j,this}cross(o){return this.crossVectors(this,o)}crossVectors(o,g){const j=o.x,Y=o.y,ee=o.z,ie=g.x,se=g.y,de=g.z;return this.x=Y*de-ee*se,this.y=ee*ie-j*de,this.z=j*se-Y*ie,this}projectOnVector(o){const g=o.lengthSq();if(g===0)return this.set(0,0,0);const j=o.dot(this)/g;return this.copy(o).multiplyScalar(j)}projectOnPlane(o){return yp.copy(this).projectOnVector(o),this.sub(yp)}reflect(o){return this.sub(yp.copy(o).multiplyScalar(2*this.dot(o)))}angleTo(o){const g=Math.sqrt(this.lengthSq()*o.lengthSq());if(g===0)return Math.PI/2;const j=this.dot(o)/g;return Math.acos(Si(j,-1,1))}distanceTo(o){return Math.sqrt(this.distanceToSquared(o))}distanceToSquared(o){const g=this.x-o.x,j=this.y-o.y,Y=this.z-o.z;return g*g+j*j+Y*Y}manhattanDistanceTo(o){return Math.abs(this.x-o.x)+Math.abs(this.y-o.y)+Math.abs(this.z-o.z)}setFromSpherical(o){return this.setFromSphericalCoords(o.radius,o.phi,o.theta)}setFromSphericalCoords(o,g,j){const Y=Math.sin(g)*o;return this.x=Y*Math.sin(j),this.y=Math.cos(g)*o,this.z=Y*Math.cos(j),this}setFromCylindrical(o){return this.setFromCylindricalCoords(o.radius,o.theta,o.y)}setFromCylindricalCoords(o,g,j){return this.x=o*Math.sin(g),this.y=j,this.z=o*Math.cos(g),this}setFromMatrixPosition(o){const g=o.elements;return this.x=g[12],this.y=g[13],this.z=g[14],this}setFromMatrixScale(o){const g=this.setFromMatrixColumn(o,0).length(),j=this.setFromMatrixColumn(o,1).length(),Y=this.setFromMatrixColumn(o,2).length();return this.x=g,this.y=j,this.z=Y,this}setFromMatrixColumn(o,g){return this.fromArray(o.elements,4*g)}setFromMatrix3Column(o,g){return this.fromArray(o.elements,3*g)}setFromEuler(o){return this.x=o._x,this.y=o._y,this.z=o._z,this}equals(o){return o.x===this.x&&o.y===this.y&&o.z===this.z}fromArray(o,g=0){return this.x=o[g],this.y=o[g+1],this.z=o[g+2],this}toArray(o=[],g=0){return o[g]=this.x,o[g+1]=this.y,o[g+2]=this.z,o}fromBufferAttribute(o,g){return this.x=o.getX(g),this.y=o.getY(g),this.z=o.getZ(g),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const o=2*(Math.random()-.5),g=Math.random()*Math.PI*2,j=Math.sqrt(1-o**2);return this.x=j*Math.cos(g),this.y=j*Math.sin(g),this.z=o,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const yp=new vt,od=new _o;class so{constructor(o=new vt(1/0,1/0,1/0),g=new vt(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=o,this.max=g}set(o,g){return this.min.copy(o),this.max.copy(g),this}setFromArray(o){let g=1/0,j=1/0,Y=1/0,ee=-1/0,ie=-1/0,se=-1/0;for(let de=0,pe=o.length;de<pe;de+=3){const be=o[de],Ce=o[de+1],xe=o[de+2];be<g&&(g=be),Ce<j&&(j=Ce),xe<Y&&(Y=xe),be>ee&&(ee=be),Ce>ie&&(ie=Ce),xe>se&&(se=xe)}return this.min.set(g,j,Y),this.max.set(ee,ie,se),this}setFromBufferAttribute(o){let g=1/0,j=1/0,Y=1/0,ee=-1/0,ie=-1/0,se=-1/0;for(let de=0,pe=o.count;de<pe;de++){const be=o.getX(de),Ce=o.getY(de),xe=o.getZ(de);be<g&&(g=be),Ce<j&&(j=Ce),xe<Y&&(Y=xe),be>ee&&(ee=be),Ce>ie&&(ie=Ce),xe>se&&(se=xe)}return this.min.set(g,j,Y),this.max.set(ee,ie,se),this}setFromPoints(o){this.makeEmpty();for(let g=0,j=o.length;g<j;g++)this.expandByPoint(o[g]);return this}setFromCenterAndSize(o,g){const j=ya.copy(g).multiplyScalar(.5);return this.min.copy(o).sub(j),this.max.copy(o).add(j),this}setFromObject(o,g=!1){return this.makeEmpty(),this.expandByObject(o,g)}clone(){return new this.constructor().copy(this)}copy(o){return this.min.copy(o.min),this.max.copy(o.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(o){return this.isEmpty()?o.set(0,0,0):o.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(o){return this.isEmpty()?o.set(0,0,0):o.subVectors(this.max,this.min)}expandByPoint(o){return this.min.min(o),this.max.max(o),this}expandByVector(o){return this.min.sub(o),this.max.add(o),this}expandByScalar(o){return this.min.addScalar(-o),this.max.addScalar(o),this}expandByObject(o,g=!1){o.updateWorldMatrix(!1,!1);const j=o.geometry;if(j!==void 0)if(g&&j.attributes!=null&&j.attributes.position!==void 0){const ee=j.attributes.position;for(let ie=0,se=ee.count;ie<se;ie++)ya.fromBufferAttribute(ee,ie).applyMatrix4(o.matrixWorld),this.expandByPoint(ya)}else j.boundingBox===null&&j.computeBoundingBox(),Gl.copy(j.boundingBox),Gl.applyMatrix4(o.matrixWorld),this.union(Gl);const Y=o.children;for(let ee=0,ie=Y.length;ee<ie;ee++)this.expandByObject(Y[ee],g);return this}containsPoint(o){return!(o.x<this.min.x||o.x>this.max.x||o.y<this.min.y||o.y>this.max.y||o.z<this.min.z||o.z>this.max.z)}containsBox(o){return this.min.x<=o.min.x&&o.max.x<=this.max.x&&this.min.y<=o.min.y&&o.max.y<=this.max.y&&this.min.z<=o.min.z&&o.max.z<=this.max.z}getParameter(o,g){return g.set((o.x-this.min.x)/(this.max.x-this.min.x),(o.y-this.min.y)/(this.max.y-this.min.y),(o.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(o){return!(o.max.x<this.min.x||o.min.x>this.max.x||o.max.y<this.min.y||o.min.y>this.max.y||o.max.z<this.min.z||o.min.z>this.max.z)}intersectsSphere(o){return this.clampPoint(o.center,ya),ya.distanceToSquared(o.center)<=o.radius*o.radius}intersectsPlane(o){let g,j;return o.normal.x>0?(g=o.normal.x*this.min.x,j=o.normal.x*this.max.x):(g=o.normal.x*this.max.x,j=o.normal.x*this.min.x),o.normal.y>0?(g+=o.normal.y*this.min.y,j+=o.normal.y*this.max.y):(g+=o.normal.y*this.max.y,j+=o.normal.y*this.min.y),o.normal.z>0?(g+=o.normal.z*this.min.z,j+=o.normal.z*this.max.z):(g+=o.normal.z*this.max.z,j+=o.normal.z*this.min.z),g<=-o.constant&&j>=-o.constant}intersectsTriangle(o){if(this.isEmpty())return!1;this.getCenter(Bc),gu.subVectors(this.max,Bc),oo.subVectors(o.a,Bc),uh.subVectors(o.b,Bc),hh.subVectors(o.c,Bc),Rc.subVectors(uh,oo),Ql.subVectors(hh,uh),vo.subVectors(oo,hh);let g=[0,-Rc.z,Rc.y,0,-Ql.z,Ql.y,0,-vo.z,vo.y,Rc.z,0,-Rc.x,Ql.z,0,-Ql.x,vo.z,0,-vo.x,-Rc.y,Rc.x,0,-Ql.y,Ql.x,0,-vo.y,vo.x,0];return!!kf(g,oo,uh,hh,gu)&&(g=[1,0,0,0,1,0,0,0,1],!!kf(g,oo,uh,hh,gu)&&(Hl.crossVectors(Rc,Ql),g=[Hl.x,Hl.y,Hl.z],kf(g,oo,uh,hh,gu)))}clampPoint(o,g){return g.copy(o).clamp(this.min,this.max)}distanceToPoint(o){return ya.copy(o).clamp(this.min,this.max).sub(o).length()}getBoundingSphere(o){return this.getCenter(o.center),o.radius=.5*this.getSize(ya).length(),o}intersect(o){return this.min.max(o.min),this.max.min(o.max),this.isEmpty()&&this.makeEmpty(),this}union(o){return this.min.min(o.min),this.max.max(o.max),this}applyMatrix4(o){return this.isEmpty()||(yl[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(o),yl[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(o),yl[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(o),yl[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(o),yl[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(o),yl[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(o),yl[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(o),yl[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(o),this.setFromPoints(yl)),this}translate(o){return this.min.add(o),this.max.add(o),this}equals(o){return o.min.equals(this.min)&&o.max.equals(this.max)}}const yl=[new vt,new vt,new vt,new vt,new vt,new vt,new vt,new vt],ya=new vt,Gl=new so,oo=new vt,uh=new vt,hh=new vt,Rc=new vt,Ql=new vt,vo=new vt,Bc=new vt,gu=new vt,Hl=new vt,_u=new vt;function kf(ue,o,g,j,Y){for(let ee=0,ie=ue.length-3;ee<=ie;ee+=3){_u.fromArray(ue,ee);const se=Y.x*Math.abs(_u.x)+Y.y*Math.abs(_u.y)+Y.z*Math.abs(_u.z),de=o.dot(_u),pe=g.dot(_u),be=j.dot(_u);if(Math.max(-Math.max(de,pe,be),Math.min(de,pe,be))>se)return!1}return!0}const Cv=new so,Wl=new vt,dh=new vt,ql=new vt;class kc{constructor(o=new vt,g=-1){this.center=o,this.radius=g}set(o,g){return this.center.copy(o),this.radius=g,this}setFromPoints(o,g){const j=this.center;g!==void 0?j.copy(g):Cv.setFromPoints(o).getCenter(j);let Y=0;for(let ee=0,ie=o.length;ee<ie;ee++)Y=Math.max(Y,j.distanceToSquared(o[ee]));return this.radius=Math.sqrt(Y),this}copy(o){return this.center.copy(o.center),this.radius=o.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(o){return o.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(o){return o.distanceTo(this.center)-this.radius}intersectsSphere(o){const g=this.radius+o.radius;return o.center.distanceToSquared(this.center)<=g*g}intersectsBox(o){return o.intersectsSphere(this)}intersectsPlane(o){return Math.abs(o.distanceToPoint(this.center))<=this.radius}clampPoint(o,g){const j=this.center.distanceToSquared(o);return g.copy(o),j>this.radius*this.radius&&(g.sub(this.center).normalize(),g.multiplyScalar(this.radius).add(this.center)),g}getBoundingBox(o){return this.isEmpty()?(o.makeEmpty(),o):(o.set(this.center,this.center),o.expandByScalar(this.radius),o)}applyMatrix4(o){return this.center.applyMatrix4(o),this.radius=this.radius*o.getMaxScaleOnAxis(),this}translate(o){return this.center.add(o),this}expandByPoint(o){ql.subVectors(o,this.center);const g=ql.lengthSq();if(g>this.radius*this.radius){const j=Math.sqrt(g),Y=.5*(j-this.radius);this.center.add(ql.multiplyScalar(Y/j)),this.radius+=Y}return this}union(o){return this.center.equals(o.center)===!0?dh.set(0,0,1).multiplyScalar(o.radius):dh.subVectors(o.center,this.center).normalize().multiplyScalar(o.radius),this.expandByPoint(Wl.copy(o.center).add(dh)),this.expandByPoint(Wl.copy(o.center).sub(dh)),this}equals(o){return o.center.equals(this.center)&&o.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Ni=new vt,Ws=new vt,Oa=new vt,ba=new vt,Oc=new vt,Lc=new vt,bp=new vt;class vu{constructor(o=new vt,g=new vt(0,0,-1)){this.origin=o,this.direction=g}set(o,g){return this.origin.copy(o),this.direction.copy(g),this}copy(o){return this.origin.copy(o.origin),this.direction.copy(o.direction),this}at(o,g){return g.copy(this.direction).multiplyScalar(o).add(this.origin)}lookAt(o){return this.direction.copy(o).sub(this.origin).normalize(),this}recast(o){return this.origin.copy(this.at(o,Ni)),this}closestPointToPoint(o,g){g.subVectors(o,this.origin);const j=g.dot(this.direction);return j<0?g.copy(this.origin):g.copy(this.direction).multiplyScalar(j).add(this.origin)}distanceToPoint(o){return Math.sqrt(this.distanceSqToPoint(o))}distanceSqToPoint(o){const g=Ni.subVectors(o,this.origin).dot(this.direction);return g<0?this.origin.distanceToSquared(o):(Ni.copy(this.direction).multiplyScalar(g).add(this.origin),Ni.distanceToSquared(o))}distanceSqToSegment(o,g,j,Y){Ws.copy(o).add(g).multiplyScalar(.5),Oa.copy(g).sub(o).normalize(),ba.copy(this.origin).sub(Ws);const ee=.5*o.distanceTo(g),ie=-this.direction.dot(Oa),se=ba.dot(this.direction),de=-ba.dot(Oa),pe=ba.lengthSq(),be=Math.abs(1-ie*ie);let Ce,xe,Ie,Re;if(be>0)if(Ce=ie*de-se,xe=ie*se-de,Re=ee*be,Ce>=0)if(xe>=-Re)if(xe<=Re){const De=1/be;Ce*=De,xe*=De,Ie=Ce*(Ce+ie*xe+2*se)+xe*(ie*Ce+xe+2*de)+pe}else xe=ee,Ce=Math.max(0,-(ie*xe+se)),Ie=-Ce*Ce+xe*(xe+2*de)+pe;else xe=-ee,Ce=Math.max(0,-(ie*xe+se)),Ie=-Ce*Ce+xe*(xe+2*de)+pe;else xe<=-Re?(Ce=Math.max(0,-(-ie*ee+se)),xe=Ce>0?-ee:Math.min(Math.max(-ee,-de),ee),Ie=-Ce*Ce+xe*(xe+2*de)+pe):xe<=Re?(Ce=0,xe=Math.min(Math.max(-ee,-de),ee),Ie=xe*(xe+2*de)+pe):(Ce=Math.max(0,-(ie*ee+se)),xe=Ce>0?ee:Math.min(Math.max(-ee,-de),ee),Ie=-Ce*Ce+xe*(xe+2*de)+pe);else xe=ie>0?-ee:ee,Ce=Math.max(0,-(ie*xe+se)),Ie=-Ce*Ce+xe*(xe+2*de)+pe;return j&&j.copy(this.direction).multiplyScalar(Ce).add(this.origin),Y&&Y.copy(Oa).multiplyScalar(xe).add(Ws),Ie}intersectSphere(o,g){Ni.subVectors(o.center,this.origin);const j=Ni.dot(this.direction),Y=Ni.dot(Ni)-j*j,ee=o.radius*o.radius;if(Y>ee)return null;const ie=Math.sqrt(ee-Y),se=j-ie,de=j+ie;return se<0&&de<0?null:se<0?this.at(de,g):this.at(se,g)}intersectsSphere(o){return this.distanceSqToPoint(o.center)<=o.radius*o.radius}distanceToPlane(o){const g=o.normal.dot(this.direction);if(g===0)return o.distanceToPoint(this.origin)===0?0:null;const j=-(this.origin.dot(o.normal)+o.constant)/g;return j>=0?j:null}intersectPlane(o,g){const j=this.distanceToPlane(o);return j===null?null:this.at(j,g)}intersectsPlane(o){const g=o.distanceToPoint(this.origin);return g===0||o.normal.dot(this.direction)*g<0}intersectBox(o,g){let j,Y,ee,ie,se,de;const pe=1/this.direction.x,be=1/this.direction.y,Ce=1/this.direction.z,xe=this.origin;return pe>=0?(j=(o.min.x-xe.x)*pe,Y=(o.max.x-xe.x)*pe):(j=(o.max.x-xe.x)*pe,Y=(o.min.x-xe.x)*pe),be>=0?(ee=(o.min.y-xe.y)*be,ie=(o.max.y-xe.y)*be):(ee=(o.max.y-xe.y)*be,ie=(o.min.y-xe.y)*be),j>ie||ee>Y?null:((ee>j||j!=j)&&(j=ee),(ie<Y||Y!=Y)&&(Y=ie),Ce>=0?(se=(o.min.z-xe.z)*Ce,de=(o.max.z-xe.z)*Ce):(se=(o.max.z-xe.z)*Ce,de=(o.min.z-xe.z)*Ce),j>de||se>Y?null:((se>j||j!=j)&&(j=se),(de<Y||Y!=Y)&&(Y=de),Y<0?null:this.at(j>=0?j:Y,g)))}intersectsBox(o){return this.intersectBox(o,Ni)!==null}intersectTriangle(o,g,j,Y,ee){Oc.subVectors(g,o),Lc.subVectors(j,o),bp.crossVectors(Oc,Lc);let ie,se=this.direction.dot(bp);if(se>0){if(Y)return null;ie=1}else{if(!(se<0))return null;ie=-1,se=-se}ba.subVectors(this.origin,o);const de=ie*this.direction.dot(Lc.crossVectors(ba,Lc));if(de<0)return null;const pe=ie*this.direction.dot(Oc.cross(ba));if(pe<0||de+pe>se)return null;const be=-ie*ba.dot(bp);return be<0?null:this.at(be/se,ee)}applyMatrix4(o){return this.origin.applyMatrix4(o),this.direction.transformDirection(o),this}equals(o){return o.origin.equals(this.origin)&&o.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Yi{constructor(){Yi.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(o,g,j,Y,ee,ie,se,de,pe,be,Ce,xe,Ie,Re,De,ze){const je=this.elements;return je[0]=o,je[4]=g,je[8]=j,je[12]=Y,je[1]=ee,je[5]=ie,je[9]=se,je[13]=de,je[2]=pe,je[6]=be,je[10]=Ce,je[14]=xe,je[3]=Ie,je[7]=Re,je[11]=De,je[15]=ze,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Yi().fromArray(this.elements)}copy(o){const g=this.elements,j=o.elements;return g[0]=j[0],g[1]=j[1],g[2]=j[2],g[3]=j[3],g[4]=j[4],g[5]=j[5],g[6]=j[6],g[7]=j[7],g[8]=j[8],g[9]=j[9],g[10]=j[10],g[11]=j[11],g[12]=j[12],g[13]=j[13],g[14]=j[14],g[15]=j[15],this}copyPosition(o){const g=this.elements,j=o.elements;return g[12]=j[12],g[13]=j[13],g[14]=j[14],this}setFromMatrix3(o){const g=o.elements;return this.set(g[0],g[3],g[6],0,g[1],g[4],g[7],0,g[2],g[5],g[8],0,0,0,0,1),this}extractBasis(o,g,j){return o.setFromMatrixColumn(this,0),g.setFromMatrixColumn(this,1),j.setFromMatrixColumn(this,2),this}makeBasis(o,g,j){return this.set(o.x,g.x,j.x,0,o.y,g.y,j.y,0,o.z,g.z,j.z,0,0,0,0,1),this}extractRotation(o){const g=this.elements,j=o.elements,Y=1/Yl.setFromMatrixColumn(o,0).length(),ee=1/Yl.setFromMatrixColumn(o,1).length(),ie=1/Yl.setFromMatrixColumn(o,2).length();return g[0]=j[0]*Y,g[1]=j[1]*Y,g[2]=j[2]*Y,g[3]=0,g[4]=j[4]*ee,g[5]=j[5]*ee,g[6]=j[6]*ee,g[7]=0,g[8]=j[8]*ie,g[9]=j[9]*ie,g[10]=j[10]*ie,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,this}makeRotationFromEuler(o){const g=this.elements,j=o.x,Y=o.y,ee=o.z,ie=Math.cos(j),se=Math.sin(j),de=Math.cos(Y),pe=Math.sin(Y),be=Math.cos(ee),Ce=Math.sin(ee);if(o.order==="XYZ"){const xe=ie*be,Ie=ie*Ce,Re=se*be,De=se*Ce;g[0]=de*be,g[4]=-de*Ce,g[8]=pe,g[1]=Ie+Re*pe,g[5]=xe-De*pe,g[9]=-se*de,g[2]=De-xe*pe,g[6]=Re+Ie*pe,g[10]=ie*de}else if(o.order==="YXZ"){const xe=de*be,Ie=de*Ce,Re=pe*be,De=pe*Ce;g[0]=xe+De*se,g[4]=Re*se-Ie,g[8]=ie*pe,g[1]=ie*Ce,g[5]=ie*be,g[9]=-se,g[2]=Ie*se-Re,g[6]=De+xe*se,g[10]=ie*de}else if(o.order==="ZXY"){const xe=de*be,Ie=de*Ce,Re=pe*be,De=pe*Ce;g[0]=xe-De*se,g[4]=-ie*Ce,g[8]=Re+Ie*se,g[1]=Ie+Re*se,g[5]=ie*be,g[9]=De-xe*se,g[2]=-ie*pe,g[6]=se,g[10]=ie*de}else if(o.order==="ZYX"){const xe=ie*be,Ie=ie*Ce,Re=se*be,De=se*Ce;g[0]=de*be,g[4]=Re*pe-Ie,g[8]=xe*pe+De,g[1]=de*Ce,g[5]=De*pe+xe,g[9]=Ie*pe-Re,g[2]=-pe,g[6]=se*de,g[10]=ie*de}else if(o.order==="YZX"){const xe=ie*de,Ie=ie*pe,Re=se*de,De=se*pe;g[0]=de*be,g[4]=De-xe*Ce,g[8]=Re*Ce+Ie,g[1]=Ce,g[5]=ie*be,g[9]=-se*be,g[2]=-pe*be,g[6]=Ie*Ce+Re,g[10]=xe-De*Ce}else if(o.order==="XZY"){const xe=ie*de,Ie=ie*pe,Re=se*de,De=se*pe;g[0]=de*be,g[4]=-Ce,g[8]=pe*be,g[1]=xe*Ce+De,g[5]=ie*be,g[9]=Ie*Ce-Re,g[2]=Re*Ce-Ie,g[6]=se*be,g[10]=De*Ce+xe}return g[3]=0,g[7]=0,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,this}makeRotationFromQuaternion(o){return this.compose(_g,o,Of)}lookAt(o,g,j){const Y=this.elements;return Js.subVectors(o,g),Js.lengthSq()===0&&(Js.z=1),Js.normalize(),Ao.crossVectors(j,Js),Ao.lengthSq()===0&&(Math.abs(j.z)===1?Js.x+=1e-4:Js.z+=1e-4,Js.normalize(),Ao.crossVectors(j,Js)),Ao.normalize(),Kr.crossVectors(Js,Ao),Y[0]=Ao.x,Y[4]=Kr.x,Y[8]=Js.x,Y[1]=Ao.y,Y[5]=Kr.y,Y[9]=Js.y,Y[2]=Ao.z,Y[6]=Kr.z,Y[10]=Js.z,this}multiply(o){return this.multiplyMatrices(this,o)}premultiply(o){return this.multiplyMatrices(o,this)}multiplyMatrices(o,g){const j=o.elements,Y=g.elements,ee=this.elements,ie=j[0],se=j[4],de=j[8],pe=j[12],be=j[1],Ce=j[5],xe=j[9],Ie=j[13],Re=j[2],De=j[6],ze=j[10],je=j[14],Ve=j[3],$e=j[7],ct=j[11],dt=j[15],ft=Y[0],Bt=Y[4],Lt=Y[8],Wt=Y[12],qt=Y[1],Ot=Y[5],En=Y[9],Ln=Y[13],wn=Y[2],jn=Y[6],Wn=Y[10],hn=Y[14],fn=Y[3],Gn=Y[7],Sn=Y[11],Hn=Y[15];return ee[0]=ie*ft+se*qt+de*wn+pe*fn,ee[4]=ie*Bt+se*Ot+de*jn+pe*Gn,ee[8]=ie*Lt+se*En+de*Wn+pe*Sn,ee[12]=ie*Wt+se*Ln+de*hn+pe*Hn,ee[1]=be*ft+Ce*qt+xe*wn+Ie*fn,ee[5]=be*Bt+Ce*Ot+xe*jn+Ie*Gn,ee[9]=be*Lt+Ce*En+xe*Wn+Ie*Sn,ee[13]=be*Wt+Ce*Ln+xe*hn+Ie*Hn,ee[2]=Re*ft+De*qt+ze*wn+je*fn,ee[6]=Re*Bt+De*Ot+ze*jn+je*Gn,ee[10]=Re*Lt+De*En+ze*Wn+je*Sn,ee[14]=Re*Wt+De*Ln+ze*hn+je*Hn,ee[3]=Ve*ft+$e*qt+ct*wn+dt*fn,ee[7]=Ve*Bt+$e*Ot+ct*jn+dt*Gn,ee[11]=Ve*Lt+$e*En+ct*Wn+dt*Sn,ee[15]=Ve*Wt+$e*Ln+ct*hn+dt*Hn,this}multiplyScalar(o){const g=this.elements;return g[0]*=o,g[4]*=o,g[8]*=o,g[12]*=o,g[1]*=o,g[5]*=o,g[9]*=o,g[13]*=o,g[2]*=o,g[6]*=o,g[10]*=o,g[14]*=o,g[3]*=o,g[7]*=o,g[11]*=o,g[15]*=o,this}determinant(){const o=this.elements,g=o[0],j=o[4],Y=o[8],ee=o[12],ie=o[1],se=o[5],de=o[9],pe=o[13],be=o[2],Ce=o[6],xe=o[10],Ie=o[14];return o[3]*(+ee*de*Ce-Y*pe*Ce-ee*se*xe+j*pe*xe+Y*se*Ie-j*de*Ie)+o[7]*(+g*de*Ie-g*pe*xe+ee*ie*xe-Y*ie*Ie+Y*pe*be-ee*de*be)+o[11]*(+g*pe*Ce-g*se*Ie-ee*ie*Ce+j*ie*Ie+ee*se*be-j*pe*be)+o[15]*(-Y*se*be-g*de*Ce+g*se*xe+Y*ie*Ce-j*ie*xe+j*de*be)}transpose(){const o=this.elements;let g;return g=o[1],o[1]=o[4],o[4]=g,g=o[2],o[2]=o[8],o[8]=g,g=o[6],o[6]=o[9],o[9]=g,g=o[3],o[3]=o[12],o[12]=g,g=o[7],o[7]=o[13],o[13]=g,g=o[11],o[11]=o[14],o[14]=g,this}setPosition(o,g,j){const Y=this.elements;return o.isVector3?(Y[12]=o.x,Y[13]=o.y,Y[14]=o.z):(Y[12]=o,Y[13]=g,Y[14]=j),this}invert(){const o=this.elements,g=o[0],j=o[1],Y=o[2],ee=o[3],ie=o[4],se=o[5],de=o[6],pe=o[7],be=o[8],Ce=o[9],xe=o[10],Ie=o[11],Re=o[12],De=o[13],ze=o[14],je=o[15],Ve=Ce*ze*pe-De*xe*pe+De*de*Ie-se*ze*Ie-Ce*de*je+se*xe*je,$e=Re*xe*pe-be*ze*pe-Re*de*Ie+ie*ze*Ie+be*de*je-ie*xe*je,ct=be*De*pe-Re*Ce*pe+Re*se*Ie-ie*De*Ie-be*se*je+ie*Ce*je,dt=Re*Ce*de-be*De*de-Re*se*xe+ie*De*xe+be*se*ze-ie*Ce*ze,ft=g*Ve+j*$e+Y*ct+ee*dt;if(ft===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Bt=1/ft;return o[0]=Ve*Bt,o[1]=(De*xe*ee-Ce*ze*ee-De*Y*Ie+j*ze*Ie+Ce*Y*je-j*xe*je)*Bt,o[2]=(se*ze*ee-De*de*ee+De*Y*pe-j*ze*pe-se*Y*je+j*de*je)*Bt,o[3]=(Ce*de*ee-se*xe*ee-Ce*Y*pe+j*xe*pe+se*Y*Ie-j*de*Ie)*Bt,o[4]=$e*Bt,o[5]=(be*ze*ee-Re*xe*ee+Re*Y*Ie-g*ze*Ie-be*Y*je+g*xe*je)*Bt,o[6]=(Re*de*ee-ie*ze*ee-Re*Y*pe+g*ze*pe+ie*Y*je-g*de*je)*Bt,o[7]=(ie*xe*ee-be*de*ee+be*Y*pe-g*xe*pe-ie*Y*Ie+g*de*Ie)*Bt,o[8]=ct*Bt,o[9]=(Re*Ce*ee-be*De*ee-Re*j*Ie+g*De*Ie+be*j*je-g*Ce*je)*Bt,o[10]=(ie*De*ee-Re*se*ee+Re*j*pe-g*De*pe-ie*j*je+g*se*je)*Bt,o[11]=(be*se*ee-ie*Ce*ee-be*j*pe+g*Ce*pe+ie*j*Ie-g*se*Ie)*Bt,o[12]=dt*Bt,o[13]=(be*De*Y-Re*Ce*Y+Re*j*xe-g*De*xe-be*j*ze+g*Ce*ze)*Bt,o[14]=(Re*se*Y-ie*De*Y-Re*j*de+g*De*de+ie*j*ze-g*se*ze)*Bt,o[15]=(ie*Ce*Y-be*se*Y+be*j*de-g*Ce*de-ie*j*xe+g*se*xe)*Bt,this}scale(o){const g=this.elements,j=o.x,Y=o.y,ee=o.z;return g[0]*=j,g[4]*=Y,g[8]*=ee,g[1]*=j,g[5]*=Y,g[9]*=ee,g[2]*=j,g[6]*=Y,g[10]*=ee,g[3]*=j,g[7]*=Y,g[11]*=ee,this}getMaxScaleOnAxis(){const o=this.elements,g=o[0]*o[0]+o[1]*o[1]+o[2]*o[2],j=o[4]*o[4]+o[5]*o[5]+o[6]*o[6],Y=o[8]*o[8]+o[9]*o[9]+o[10]*o[10];return Math.sqrt(Math.max(g,j,Y))}makeTranslation(o,g,j){return this.set(1,0,0,o,0,1,0,g,0,0,1,j,0,0,0,1),this}makeRotationX(o){const g=Math.cos(o),j=Math.sin(o);return this.set(1,0,0,0,0,g,-j,0,0,j,g,0,0,0,0,1),this}makeRotationY(o){const g=Math.cos(o),j=Math.sin(o);return this.set(g,0,j,0,0,1,0,0,-j,0,g,0,0,0,0,1),this}makeRotationZ(o){const g=Math.cos(o),j=Math.sin(o);return this.set(g,-j,0,0,j,g,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(o,g){const j=Math.cos(g),Y=Math.sin(g),ee=1-j,ie=o.x,se=o.y,de=o.z,pe=ee*ie,be=ee*se;return this.set(pe*ie+j,pe*se-Y*de,pe*de+Y*se,0,pe*se+Y*de,be*se+j,be*de-Y*ie,0,pe*de-Y*se,be*de+Y*ie,ee*de*de+j,0,0,0,0,1),this}makeScale(o,g,j){return this.set(o,0,0,0,0,g,0,0,0,0,j,0,0,0,0,1),this}makeShear(o,g,j,Y,ee,ie){return this.set(1,j,ee,0,o,1,ie,0,g,Y,1,0,0,0,0,1),this}compose(o,g,j){const Y=this.elements,ee=g._x,ie=g._y,se=g._z,de=g._w,pe=ee+ee,be=ie+ie,Ce=se+se,xe=ee*pe,Ie=ee*be,Re=ee*Ce,De=ie*be,ze=ie*Ce,je=se*Ce,Ve=de*pe,$e=de*be,ct=de*Ce,dt=j.x,ft=j.y,Bt=j.z;return Y[0]=(1-(De+je))*dt,Y[1]=(Ie+ct)*dt,Y[2]=(Re-$e)*dt,Y[3]=0,Y[4]=(Ie-ct)*ft,Y[5]=(1-(xe+je))*ft,Y[6]=(ze+Ve)*ft,Y[7]=0,Y[8]=(Re+$e)*Bt,Y[9]=(ze-Ve)*Bt,Y[10]=(1-(xe+De))*Bt,Y[11]=0,Y[12]=o.x,Y[13]=o.y,Y[14]=o.z,Y[15]=1,this}decompose(o,g,j){const Y=this.elements;let ee=Yl.set(Y[0],Y[1],Y[2]).length();const ie=Yl.set(Y[4],Y[5],Y[6]).length(),se=Yl.set(Y[8],Y[9],Y[10]).length();this.determinant()<0&&(ee=-ee),o.x=Y[12],o.y=Y[13],o.z=Y[14],wa.copy(this);const de=1/ee,pe=1/ie,be=1/se;return wa.elements[0]*=de,wa.elements[1]*=de,wa.elements[2]*=de,wa.elements[4]*=pe,wa.elements[5]*=pe,wa.elements[6]*=pe,wa.elements[8]*=be,wa.elements[9]*=be,wa.elements[10]*=be,g.setFromRotationMatrix(wa),j.x=ee,j.y=ie,j.z=se,this}makePerspective(o,g,j,Y,ee,ie){const se=this.elements,de=2*ee/(g-o),pe=2*ee/(j-Y),be=(g+o)/(g-o),Ce=(j+Y)/(j-Y),xe=-(ie+ee)/(ie-ee),Ie=-2*ie*ee/(ie-ee);return se[0]=de,se[4]=0,se[8]=be,se[12]=0,se[1]=0,se[5]=pe,se[9]=Ce,se[13]=0,se[2]=0,se[6]=0,se[10]=xe,se[14]=Ie,se[3]=0,se[7]=0,se[11]=-1,se[15]=0,this}makeOrthographic(o,g,j,Y,ee,ie){const se=this.elements,de=1/(g-o),pe=1/(j-Y),be=1/(ie-ee),Ce=(g+o)*de,xe=(j+Y)*pe,Ie=(ie+ee)*be;return se[0]=2*de,se[4]=0,se[8]=0,se[12]=-Ce,se[1]=0,se[5]=2*pe,se[9]=0,se[13]=-xe,se[2]=0,se[6]=0,se[10]=-2*be,se[14]=-Ie,se[3]=0,se[7]=0,se[11]=0,se[15]=1,this}equals(o){const g=this.elements,j=o.elements;for(let Y=0;Y<16;Y++)if(g[Y]!==j[Y])return!1;return!0}fromArray(o,g=0){for(let j=0;j<16;j++)this.elements[j]=o[j+g];return this}toArray(o=[],g=0){const j=this.elements;return o[g]=j[0],o[g+1]=j[1],o[g+2]=j[2],o[g+3]=j[3],o[g+4]=j[4],o[g+5]=j[5],o[g+6]=j[6],o[g+7]=j[7],o[g+8]=j[8],o[g+9]=j[9],o[g+10]=j[10],o[g+11]=j[11],o[g+12]=j[12],o[g+13]=j[13],o[g+14]=j[14],o[g+15]=j[15],o}}const Yl=new vt,wa=new Yi,_g=new vt(0,0,0),Of=new vt(1,1,1),Ao=new vt,Kr=new vt,Js=new vt,xa=new Yi,La=new _o;class Ea{constructor(o=0,g=0,j=0,Y=Ea.DefaultOrder){this.isEuler=!0,this._x=o,this._y=g,this._z=j,this._order=Y}get x(){return this._x}set x(o){this._x=o,this._onChangeCallback()}get y(){return this._y}set y(o){this._y=o,this._onChangeCallback()}get z(){return this._z}set z(o){this._z=o,this._onChangeCallback()}get order(){return this._order}set order(o){this._order=o,this._onChangeCallback()}set(o,g,j,Y=this._order){return this._x=o,this._y=g,this._z=j,this._order=Y,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(o){return this._x=o._x,this._y=o._y,this._z=o._z,this._order=o._order,this._onChangeCallback(),this}setFromRotationMatrix(o,g=this._order,j=!0){const Y=o.elements,ee=Y[0],ie=Y[4],se=Y[8],de=Y[1],pe=Y[5],be=Y[9],Ce=Y[2],xe=Y[6],Ie=Y[10];switch(g){case"XYZ":this._y=Math.asin(Si(se,-1,1)),Math.abs(se)<.9999999?(this._x=Math.atan2(-be,Ie),this._z=Math.atan2(-ie,ee)):(this._x=Math.atan2(xe,pe),this._z=0);break;case"YXZ":this._x=Math.asin(-Si(be,-1,1)),Math.abs(be)<.9999999?(this._y=Math.atan2(se,Ie),this._z=Math.atan2(de,pe)):(this._y=Math.atan2(-Ce,ee),this._z=0);break;case"ZXY":this._x=Math.asin(Si(xe,-1,1)),Math.abs(xe)<.9999999?(this._y=Math.atan2(-Ce,Ie),this._z=Math.atan2(-ie,pe)):(this._y=0,this._z=Math.atan2(de,ee));break;case"ZYX":this._y=Math.asin(-Si(Ce,-1,1)),Math.abs(Ce)<.9999999?(this._x=Math.atan2(xe,Ie),this._z=Math.atan2(de,ee)):(this._x=0,this._z=Math.atan2(-ie,pe));break;case"YZX":this._z=Math.asin(Si(de,-1,1)),Math.abs(de)<.9999999?(this._x=Math.atan2(-be,pe),this._y=Math.atan2(-Ce,ee)):(this._x=0,this._y=Math.atan2(se,Ie));break;case"XZY":this._z=Math.asin(-Si(ie,-1,1)),Math.abs(ie)<.9999999?(this._x=Math.atan2(xe,pe),this._y=Math.atan2(se,ee)):(this._x=Math.atan2(-be,Ie),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+g)}return this._order=g,j===!0&&this._onChangeCallback(),this}setFromQuaternion(o,g,j){return xa.makeRotationFromQuaternion(o),this.setFromRotationMatrix(xa,g,j)}setFromVector3(o,g=this._order){return this.set(o.x,o.y,o.z,g)}reorder(o){return La.setFromEuler(this),this.setFromQuaternion(La,o)}equals(o){return o._x===this._x&&o._y===this._y&&o._z===this._z&&o._order===this._order}fromArray(o){return this._x=o[0],this._y=o[1],this._z=o[2],o[3]!==void 0&&(this._order=o[3]),this._onChangeCallback(),this}toArray(o=[],g=0){return o[g]=this._x,o[g+1]=this._y,o[g+2]=this._z,o[g+3]=this._order,o}_onChange(o){return this._onChangeCallback=o,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}Ea.DefaultOrder="XYZ",Ea.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class ad{constructor(){this.mask=1}set(o){this.mask=(1<<o|0)>>>0}enable(o){this.mask|=1<<o|0}enableAll(){this.mask=-1}toggle(o){this.mask^=1<<o|0}disable(o){this.mask&=~(1<<o|0)}disableAll(){this.mask=0}test(o){return(this.mask&o.mask)!=0}isEnabled(o){return(this.mask&(1<<o|0))!=0}}let Au=0;const wp=new vt,yu=new _o,Na=new Yi,ao=new vt,Nc=new vt,ld=new vt,Po=new _o,bu=new vt(1,0,0),Xa=new vt(0,1,0),Xl=new vt(0,0,1),cd={type:"added"},ud={type:"removed"};class Ar extends va{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Au++}),this.uuid=Oi(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ar.DefaultUp.clone();const o=new vt,g=new Ea,j=new _o,Y=new vt(1,1,1);g._onChange(function(){j.setFromEuler(g,!1)}),j._onChange(function(){g.setFromQuaternion(j,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:o},rotation:{configurable:!0,enumerable:!0,value:g},quaternion:{configurable:!0,enumerable:!0,value:j},scale:{configurable:!0,enumerable:!0,value:Y},modelViewMatrix:{value:new Yi},normalMatrix:{value:new go}}),this.matrix=new Yi,this.matrixWorld=new Yi,this.matrixAutoUpdate=Ar.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Ar.DefaultMatrixWorldAutoUpdate,this.layers=new ad,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(o,g,j,Y,ee,ie){this.dispatchEvent({type:"beforeRender",renderer:o,scene:g,camera:j,geometry:Y,material:ee,group:ie})}onAfterRender(){}applyMatrix4(o){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(o),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(o){return this.quaternion.premultiply(o),this}setRotationFromAxisAngle(o,g){this.quaternion.setFromAxisAngle(o,g)}setRotationFromEuler(o){this.quaternion.setFromEuler(o,!0)}setRotationFromMatrix(o){this.quaternion.setFromRotationMatrix(o)}setRotationFromQuaternion(o){this.quaternion.copy(o)}rotateOnAxis(o,g){return yu.setFromAxisAngle(o,g),this.quaternion.multiply(yu),this}rotateOnWorldAxis(o,g){return yu.setFromAxisAngle(o,g),this.quaternion.premultiply(yu),this}rotateX(o){return this.rotateOnAxis(bu,o)}rotateY(o){return this.rotateOnAxis(Xa,o)}rotateZ(o){return this.rotateOnAxis(Xl,o)}translateOnAxis(o,g){return wp.copy(o).applyQuaternion(this.quaternion),this.position.add(wp.multiplyScalar(g)),this}translateX(o){return this.translateOnAxis(bu,o)}translateY(o){return this.translateOnAxis(Xa,o)}translateZ(o){return this.translateOnAxis(Xl,o)}localToWorld(o){return o.applyMatrix4(this.matrixWorld)}worldToLocal(o){return o.applyMatrix4(Na.copy(this.matrixWorld).invert())}lookAt(o,g,j){o.isVector3?ao.copy(o):ao.set(o,g,j);const Y=this.parent;this.updateWorldMatrix(!0,!1),Nc.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Na.lookAt(Nc,ao,this.up):Na.lookAt(ao,Nc,this.up),this.quaternion.setFromRotationMatrix(Na),Y&&(Na.extractRotation(Y.matrixWorld),yu.setFromRotationMatrix(Na),this.quaternion.premultiply(yu.invert()))}add(o){if(arguments.length>1){for(let g=0;g<arguments.length;g++)this.add(arguments[g]);return this}return o===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",o),this):(o&&o.isObject3D?(o.parent!==null&&o.parent.remove(o),o.parent=this,this.children.push(o),o.dispatchEvent(cd)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",o),this)}remove(o){if(arguments.length>1){for(let j=0;j<arguments.length;j++)this.remove(arguments[j]);return this}const g=this.children.indexOf(o);return g!==-1&&(o.parent=null,this.children.splice(g,1),o.dispatchEvent(ud)),this}removeFromParent(){const o=this.parent;return o!==null&&o.remove(this),this}clear(){for(let o=0;o<this.children.length;o++){const g=this.children[o];g.parent=null,g.dispatchEvent(ud)}return this.children.length=0,this}attach(o){return this.updateWorldMatrix(!0,!1),Na.copy(this.matrixWorld).invert(),o.parent!==null&&(o.parent.updateWorldMatrix(!0,!1),Na.multiply(o.parent.matrixWorld)),o.applyMatrix4(Na),this.add(o),o.updateWorldMatrix(!1,!0),this}getObjectById(o){return this.getObjectByProperty("id",o)}getObjectByName(o){return this.getObjectByProperty("name",o)}getObjectByProperty(o,g){if(this[o]===g)return this;for(let j=0,Y=this.children.length;j<Y;j++){const ee=this.children[j].getObjectByProperty(o,g);if(ee!==void 0)return ee}}getWorldPosition(o){return this.updateWorldMatrix(!0,!1),o.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(o){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Nc,o,ld),o}getWorldScale(o){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Nc,Po,o),o}getWorldDirection(o){this.updateWorldMatrix(!0,!1);const g=this.matrixWorld.elements;return o.set(g[8],g[9],g[10]).normalize()}raycast(){}traverse(o){o(this);const g=this.children;for(let j=0,Y=g.length;j<Y;j++)g[j].traverse(o)}traverseVisible(o){if(this.visible===!1)return;o(this);const g=this.children;for(let j=0,Y=g.length;j<Y;j++)g[j].traverseVisible(o)}traverseAncestors(o){const g=this.parent;g!==null&&(o(g),g.traverseAncestors(o))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(o){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||o)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,o=!0);const g=this.children;for(let j=0,Y=g.length;j<Y;j++){const ee=g[j];ee.matrixWorldAutoUpdate!==!0&&o!==!0||ee.updateMatrixWorld(o)}}updateWorldMatrix(o,g){const j=this.parent;if(o===!0&&j!==null&&j.matrixWorldAutoUpdate===!0&&j.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),g===!0){const Y=this.children;for(let ee=0,ie=Y.length;ee<ie;ee++){const se=Y[ee];se.matrixWorldAutoUpdate===!0&&se.updateWorldMatrix(!1,!0)}}}toJSON(o){const g=o===void 0||typeof o=="string",j={};g&&(o={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},j.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const Y={};function ee(se,de){return se[de.uuid]===void 0&&(se[de.uuid]=de.toJSON(o)),de.uuid}if(Y.uuid=this.uuid,Y.type=this.type,this.name!==""&&(Y.name=this.name),this.castShadow===!0&&(Y.castShadow=!0),this.receiveShadow===!0&&(Y.receiveShadow=!0),this.visible===!1&&(Y.visible=!1),this.frustumCulled===!1&&(Y.frustumCulled=!1),this.renderOrder!==0&&(Y.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(Y.userData=this.userData),Y.layers=this.layers.mask,Y.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(Y.matrixAutoUpdate=!1),this.isInstancedMesh&&(Y.type="InstancedMesh",Y.count=this.count,Y.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(Y.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?Y.background=this.background.toJSON():this.background.isTexture&&(Y.background=this.background.toJSON(o).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(Y.environment=this.environment.toJSON(o).uuid);else if(this.isMesh||this.isLine||this.isPoints){Y.geometry=ee(o.geometries,this.geometry);const se=this.geometry.parameters;if(se!==void 0&&se.shapes!==void 0){const de=se.shapes;if(Array.isArray(de))for(let pe=0,be=de.length;pe<be;pe++){const Ce=de[pe];ee(o.shapes,Ce)}else ee(o.shapes,de)}}if(this.isSkinnedMesh&&(Y.bindMode=this.bindMode,Y.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(ee(o.skeletons,this.skeleton),Y.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const se=[];for(let de=0,pe=this.material.length;de<pe;de++)se.push(ee(o.materials,this.material[de]));Y.material=se}else Y.material=ee(o.materials,this.material);if(this.children.length>0){Y.children=[];for(let se=0;se<this.children.length;se++)Y.children.push(this.children[se].toJSON(o).object)}if(this.animations.length>0){Y.animations=[];for(let se=0;se<this.animations.length;se++){const de=this.animations[se];Y.animations.push(ee(o.animations,de))}}if(g){const se=ie(o.geometries),de=ie(o.materials),pe=ie(o.textures),be=ie(o.images),Ce=ie(o.shapes),xe=ie(o.skeletons),Ie=ie(o.animations),Re=ie(o.nodes);se.length>0&&(j.geometries=se),de.length>0&&(j.materials=de),pe.length>0&&(j.textures=pe),be.length>0&&(j.images=be),Ce.length>0&&(j.shapes=Ce),xe.length>0&&(j.skeletons=xe),Ie.length>0&&(j.animations=Ie),Re.length>0&&(j.nodes=Re)}return j.object=Y,j;function ie(se){const de=[];for(const pe in se){const be=se[pe];delete be.metadata,de.push(be)}return de}}clone(o){return new this.constructor().copy(this,o)}copy(o,g=!0){this.name=o.name,this.up.copy(o.up),this.position.copy(o.position),this.rotation.order=o.rotation.order,this.quaternion.copy(o.quaternion),this.scale.copy(o.scale),this.matrix.copy(o.matrix),this.matrixWorld.copy(o.matrixWorld),this.matrixAutoUpdate=o.matrixAutoUpdate,this.matrixWorldNeedsUpdate=o.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=o.matrixWorldAutoUpdate,this.layers.mask=o.layers.mask,this.visible=o.visible,this.castShadow=o.castShadow,this.receiveShadow=o.receiveShadow,this.frustumCulled=o.frustumCulled,this.renderOrder=o.renderOrder,this.userData={};for(const[j,Y]of Object.entries(o.userData))this.userData[j]=!Y||Y&&(Y.isTexture||Y.isObject3D)?Y:JSON.parse(JSON.stringify(Y));if(g===!0)for(let j=0;j<o.children.length;j++){const Y=o.children[j];this.add(Y.clone())}return this}}Ar.DefaultUp=new vt(0,1,0),Ar.DefaultMatrixAutoUpdate=!0,Ar.DefaultMatrixWorldAutoUpdate=!0;const Ro=new vt,Sa=new vt,Ua=new vt,bl=new vt,ra=new vt,Kl=new vt,xp=new vt,Uc=new vt,hd=new vt,Jl=new vt;class Bo{constructor(o=new vt,g=new vt,j=new vt){this.a=o,this.b=g,this.c=j}static getNormal(o,g,j,Y){Y.subVectors(j,g),Ro.subVectors(o,g),Y.cross(Ro);const ee=Y.lengthSq();return ee>0?Y.multiplyScalar(1/Math.sqrt(ee)):Y.set(0,0,0)}static getBarycoord(o,g,j,Y,ee){Ro.subVectors(Y,g),Sa.subVectors(j,g),Ua.subVectors(o,g);const ie=Ro.dot(Ro),se=Ro.dot(Sa),de=Ro.dot(Ua),pe=Sa.dot(Sa),be=Sa.dot(Ua),Ce=ie*pe-se*se;if(Ce===0)return ee.set(-2,-1,-1);const xe=1/Ce,Ie=(pe*de-se*be)*xe,Re=(ie*be-se*de)*xe;return ee.set(1-Ie-Re,Re,Ie)}static containsPoint(o,g,j,Y){return this.getBarycoord(o,g,j,Y,bl),bl.x>=0&&bl.y>=0&&bl.x+bl.y<=1}static getUV(o,g,j,Y,ee,ie,se,de){return this.getBarycoord(o,g,j,Y,bl),de.set(0,0),de.addScaledVector(ee,bl.x),de.addScaledVector(ie,bl.y),de.addScaledVector(se,bl.z),de}static isFrontFacing(o,g,j,Y){return Ro.subVectors(j,g),Sa.subVectors(o,g),Ro.cross(Sa).dot(Y)<0}set(o,g,j){return this.a.copy(o),this.b.copy(g),this.c.copy(j),this}setFromPointsAndIndices(o,g,j,Y){return this.a.copy(o[g]),this.b.copy(o[j]),this.c.copy(o[Y]),this}setFromAttributeAndIndices(o,g,j,Y){return this.a.fromBufferAttribute(o,g),this.b.fromBufferAttribute(o,j),this.c.fromBufferAttribute(o,Y),this}clone(){return new this.constructor().copy(this)}copy(o){return this.a.copy(o.a),this.b.copy(o.b),this.c.copy(o.c),this}getArea(){return Ro.subVectors(this.c,this.b),Sa.subVectors(this.a,this.b),.5*Ro.cross(Sa).length()}getMidpoint(o){return o.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(o){return Bo.getNormal(this.a,this.b,this.c,o)}getPlane(o){return o.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(o,g){return Bo.getBarycoord(o,this.a,this.b,this.c,g)}getUV(o,g,j,Y,ee){return Bo.getUV(o,this.a,this.b,this.c,g,j,Y,ee)}containsPoint(o){return Bo.containsPoint(o,this.a,this.b,this.c)}isFrontFacing(o){return Bo.isFrontFacing(this.a,this.b,this.c,o)}intersectsBox(o){return o.intersectsTriangle(this)}closestPointToPoint(o,g){const j=this.a,Y=this.b,ee=this.c;let ie,se;ra.subVectors(Y,j),Kl.subVectors(ee,j),Uc.subVectors(o,j);const de=ra.dot(Uc),pe=Kl.dot(Uc);if(de<=0&&pe<=0)return g.copy(j);hd.subVectors(o,Y);const be=ra.dot(hd),Ce=Kl.dot(hd);if(be>=0&&Ce<=be)return g.copy(Y);const xe=de*Ce-be*pe;if(xe<=0&&de>=0&&be<=0)return ie=de/(de-be),g.copy(j).addScaledVector(ra,ie);Jl.subVectors(o,ee);const Ie=ra.dot(Jl),Re=Kl.dot(Jl);if(Re>=0&&Ie<=Re)return g.copy(ee);const De=Ie*pe-de*Re;if(De<=0&&pe>=0&&Re<=0)return se=pe/(pe-Re),g.copy(j).addScaledVector(Kl,se);const ze=be*Re-Ie*Ce;if(ze<=0&&Ce-be>=0&&Ie-Re>=0)return xp.subVectors(ee,Y),se=(Ce-be)/(Ce-be+(Ie-Re)),g.copy(Y).addScaledVector(xp,se);const je=1/(ze+De+xe);return ie=De*je,se=xe*je,g.copy(j).addScaledVector(ra,ie).addScaledVector(Kl,se)}equals(o){return o.a.equals(this.a)&&o.b.equals(this.b)&&o.c.equals(this.c)}}let vg=0;class $s extends va{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:vg++}),this.uuid=Oi(),this.name="",this.type="Material",this.blending=Ze,this.side=et,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=Zt,this.blendDst=pn,this.blendEquation=Ne,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=ot,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=qa,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=tr,this.stencilZFail=tr,this.stencilZPass=tr,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(o){this._alphaTest>0!=o>0&&this.version++,this._alphaTest=o}onBuild(){}onBeforeRender(){}onAfterRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(o){if(o!==void 0)for(const g in o){const j=o[g];if(j===void 0){console.warn("THREE.Material: '"+g+"' parameter is undefined.");continue}const Y=this[g];Y!==void 0&&(Y&&Y.isColor?Y.set(j):Y&&Y.isVector3&&j&&j.isVector3?Y.copy(j):this[g]=j)}}toJSON(o){const g=o===void 0||typeof o=="string";g&&(o={textures:{},images:{}});const j={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function Y(ee){const ie=[];for(const se in ee){const de=ee[se];delete de.metadata,ie.push(de)}return ie}if(j.uuid=this.uuid,j.type=this.type,this.name!==""&&(j.name=this.name),this.color&&this.color.isColor&&(j.color=this.color.getHex()),this.roughness!==void 0&&(j.roughness=this.roughness),this.metalness!==void 0&&(j.metalness=this.metalness),this.sheen!==void 0&&(j.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(j.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(j.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(j.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(j.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(j.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(j.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(j.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(j.shininess=this.shininess),this.clearcoat!==void 0&&(j.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(j.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(j.clearcoatMap=this.clearcoatMap.toJSON(o).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(j.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(o).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(j.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(o).uuid,j.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(j.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(j.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(j.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(j.iridescenceMap=this.iridescenceMap.toJSON(o).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(j.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(o).uuid),this.map&&this.map.isTexture&&(j.map=this.map.toJSON(o).uuid),this.matcap&&this.matcap.isTexture&&(j.matcap=this.matcap.toJSON(o).uuid),this.alphaMap&&this.alphaMap.isTexture&&(j.alphaMap=this.alphaMap.toJSON(o).uuid),this.lightMap&&this.lightMap.isTexture&&(j.lightMap=this.lightMap.toJSON(o).uuid,j.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(j.aoMap=this.aoMap.toJSON(o).uuid,j.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(j.bumpMap=this.bumpMap.toJSON(o).uuid,j.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(j.normalMap=this.normalMap.toJSON(o).uuid,j.normalMapType=this.normalMapType,j.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(j.displacementMap=this.displacementMap.toJSON(o).uuid,j.displacementScale=this.displacementScale,j.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(j.roughnessMap=this.roughnessMap.toJSON(o).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(j.metalnessMap=this.metalnessMap.toJSON(o).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(j.emissiveMap=this.emissiveMap.toJSON(o).uuid),this.specularMap&&this.specularMap.isTexture&&(j.specularMap=this.specularMap.toJSON(o).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(j.specularIntensityMap=this.specularIntensityMap.toJSON(o).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(j.specularColorMap=this.specularColorMap.toJSON(o).uuid),this.envMap&&this.envMap.isTexture&&(j.envMap=this.envMap.toJSON(o).uuid,this.combine!==void 0&&(j.combine=this.combine)),this.envMapIntensity!==void 0&&(j.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(j.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(j.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(j.gradientMap=this.gradientMap.toJSON(o).uuid),this.transmission!==void 0&&(j.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(j.transmissionMap=this.transmissionMap.toJSON(o).uuid),this.thickness!==void 0&&(j.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(j.thicknessMap=this.thicknessMap.toJSON(o).uuid),this.attenuationDistance!==void 0&&(j.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(j.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(j.size=this.size),this.shadowSide!==null&&(j.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(j.sizeAttenuation=this.sizeAttenuation),this.blending!==Ze&&(j.blending=this.blending),this.side!==et&&(j.side=this.side),this.vertexColors&&(j.vertexColors=!0),this.opacity<1&&(j.opacity=this.opacity),this.transparent===!0&&(j.transparent=this.transparent),j.depthFunc=this.depthFunc,j.depthTest=this.depthTest,j.depthWrite=this.depthWrite,j.colorWrite=this.colorWrite,j.stencilWrite=this.stencilWrite,j.stencilWriteMask=this.stencilWriteMask,j.stencilFunc=this.stencilFunc,j.stencilRef=this.stencilRef,j.stencilFuncMask=this.stencilFuncMask,j.stencilFail=this.stencilFail,j.stencilZFail=this.stencilZFail,j.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(j.rotation=this.rotation),this.polygonOffset===!0&&(j.polygonOffset=!0),this.polygonOffsetFactor!==0&&(j.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(j.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(j.linewidth=this.linewidth),this.dashSize!==void 0&&(j.dashSize=this.dashSize),this.gapSize!==void 0&&(j.gapSize=this.gapSize),this.scale!==void 0&&(j.scale=this.scale),this.dithering===!0&&(j.dithering=!0),this.alphaTest>0&&(j.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(j.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(j.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(j.wireframe=this.wireframe),this.wireframeLinewidth>1&&(j.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(j.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(j.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(j.flatShading=this.flatShading),this.visible===!1&&(j.visible=!1),this.toneMapped===!1&&(j.toneMapped=!1),this.fog===!1&&(j.fog=!1),JSON.stringify(this.userData)!=="{}"&&(j.userData=this.userData),g){const ee=Y(o.textures),ie=Y(o.images);ee.length>0&&(j.textures=ee),ie.length>0&&(j.images=ie)}return j}clone(){return new this.constructor().copy(this)}copy(o){this.name=o.name,this.blending=o.blending,this.side=o.side,this.vertexColors=o.vertexColors,this.opacity=o.opacity,this.transparent=o.transparent,this.blendSrc=o.blendSrc,this.blendDst=o.blendDst,this.blendEquation=o.blendEquation,this.blendSrcAlpha=o.blendSrcAlpha,this.blendDstAlpha=o.blendDstAlpha,this.blendEquationAlpha=o.blendEquationAlpha,this.depthFunc=o.depthFunc,this.depthTest=o.depthTest,this.depthWrite=o.depthWrite,this.stencilWriteMask=o.stencilWriteMask,this.stencilFunc=o.stencilFunc,this.stencilRef=o.stencilRef,this.stencilFuncMask=o.stencilFuncMask,this.stencilFail=o.stencilFail,this.stencilZFail=o.stencilZFail,this.stencilZPass=o.stencilZPass,this.stencilWrite=o.stencilWrite;const g=o.clippingPlanes;let j=null;if(g!==null){const Y=g.length;j=new Array(Y);for(let ee=0;ee!==Y;++ee)j[ee]=g[ee].clone()}this.clippingPlanes=j,this.clipIntersection=o.clipIntersection,this.clipShadows=o.clipShadows,this.shadowSide=o.shadowSide,this.colorWrite=o.colorWrite,this.precision=o.precision,this.polygonOffset=o.polygonOffset,this.polygonOffsetFactor=o.polygonOffsetFactor,this.polygonOffsetUnits=o.polygonOffsetUnits,this.dithering=o.dithering,this.alphaTest=o.alphaTest,this.alphaToCoverage=o.alphaToCoverage,this.premultipliedAlpha=o.premultipliedAlpha,this.visible=o.visible,this.toneMapped=o.toneMapped,this.userData={};for(const[Y,ee]of Object.entries(o.userData))this.userData[Y]=!ee||ee&&(ee.isTexture||ee.isObject3D)?ee:JSON.parse(JSON.stringify(ee));return this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(o){o===!0&&this.version++}}class wl extends $s{constructor(o){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ci(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=hi,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.specularMap=o.specularMap,this.alphaMap=o.alphaMap,this.envMap=o.envMap,this.combine=o.combine,this.reflectivity=o.reflectivity,this.refractionRatio=o.refractionRatio,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.fog=o.fog,this}}const us=new vt,xl=new Bn;class is{constructor(o,g,j){if(Array.isArray(o))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=o,this.itemSize=g,this.count=o!==void 0?o.length/g:0,this.normalized=j===!0,this.usage=zo,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(o){o===!0&&this.version++}setUsage(o){return this.usage=o,this}copy(o){return this.name=o.name,this.array=new o.array.constructor(o.array),this.itemSize=o.itemSize,this.count=o.count,this.normalized=o.normalized,this.usage=o.usage,this}copyAt(o,g,j){o*=this.itemSize,j*=g.itemSize;for(let Y=0,ee=this.itemSize;Y<ee;Y++)this.array[o+Y]=g.array[j+Y];return this}copyArray(o){return this.array.set(o),this}applyMatrix3(o){if(this.itemSize===2)for(let g=0,j=this.count;g<j;g++)xl.fromBufferAttribute(this,g),xl.applyMatrix3(o),this.setXY(g,xl.x,xl.y);else if(this.itemSize===3)for(let g=0,j=this.count;g<j;g++)us.fromBufferAttribute(this,g),us.applyMatrix3(o),this.setXYZ(g,us.x,us.y,us.z);return this}applyMatrix4(o){for(let g=0,j=this.count;g<j;g++)us.fromBufferAttribute(this,g),us.applyMatrix4(o),this.setXYZ(g,us.x,us.y,us.z);return this}applyNormalMatrix(o){for(let g=0,j=this.count;g<j;g++)us.fromBufferAttribute(this,g),us.applyNormalMatrix(o),this.setXYZ(g,us.x,us.y,us.z);return this}transformDirection(o){for(let g=0,j=this.count;g<j;g++)us.fromBufferAttribute(this,g),us.transformDirection(o),this.setXYZ(g,us.x,us.y,us.z);return this}set(o,g=0){return this.array.set(o,g),this}getX(o){let g=this.array[o*this.itemSize];return this.normalized&&(g=Vl(g,this.array)),g}setX(o,g){return this.normalized&&(g=ns(g,this.array)),this.array[o*this.itemSize]=g,this}getY(o){let g=this.array[o*this.itemSize+1];return this.normalized&&(g=Vl(g,this.array)),g}setY(o,g){return this.normalized&&(g=ns(g,this.array)),this.array[o*this.itemSize+1]=g,this}getZ(o){let g=this.array[o*this.itemSize+2];return this.normalized&&(g=Vl(g,this.array)),g}setZ(o,g){return this.normalized&&(g=ns(g,this.array)),this.array[o*this.itemSize+2]=g,this}getW(o){let g=this.array[o*this.itemSize+3];return this.normalized&&(g=Vl(g,this.array)),g}setW(o,g){return this.normalized&&(g=ns(g,this.array)),this.array[o*this.itemSize+3]=g,this}setXY(o,g,j){return o*=this.itemSize,this.normalized&&(g=ns(g,this.array),j=ns(j,this.array)),this.array[o+0]=g,this.array[o+1]=j,this}setXYZ(o,g,j,Y){return o*=this.itemSize,this.normalized&&(g=ns(g,this.array),j=ns(j,this.array),Y=ns(Y,this.array)),this.array[o+0]=g,this.array[o+1]=j,this.array[o+2]=Y,this}setXYZW(o,g,j,Y,ee){return o*=this.itemSize,this.normalized&&(g=ns(g,this.array),j=ns(j,this.array),Y=ns(Y,this.array),ee=ns(ee,this.array)),this.array[o+0]=g,this.array[o+1]=j,this.array[o+2]=Y,this.array[o+3]=ee,this}onUpload(o){return this.onUploadCallback=o,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const o={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(o.name=this.name),this.usage!==zo&&(o.usage=this.usage),this.updateRange.offset===0&&this.updateRange.count===-1||(o.updateRange=this.updateRange),o}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class Ag extends is{constructor(o,g,j){super(new Int8Array(o),g,j)}}class yg extends is{constructor(o,g,j){super(new Uint8Array(o),g,j)}}class bg extends is{constructor(o,g,j){super(new Uint8ClampedArray(o),g,j)}}class Fc extends is{constructor(o,g,j){super(new Int16Array(o),g,j)}}class ph extends is{constructor(o,g,j){super(new Uint16Array(o),g,j)}}class fh extends is{constructor(o,g,j){super(new Int32Array(o),g,j)}}class _e extends is{constructor(o,g,j){super(new Uint32Array(o),g,j)}}class ne extends is{constructor(o,g,j){super(new Uint16Array(o),g,j),this.isFloat16BufferAttribute=!0}}class ce extends is{constructor(o,g,j){super(new Float32Array(o),g,j)}}class Se extends is{constructor(o,g,j){super(new Float64Array(o),g,j)}}let qe=0;const gt=new Yi,Pt=new Ar,cn=new vt,Vn=new so,vi=new so,Ti=new vt;class yi extends va{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:qe++}),this.uuid=Oi(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(o){return Array.isArray(o)?this.index=new(fg(o)?_e:ph)(o,1):this.index=o,this}getAttribute(o){return this.attributes[o]}setAttribute(o,g){return this.attributes[o]=g,this}deleteAttribute(o){return delete this.attributes[o],this}hasAttribute(o){return this.attributes[o]!==void 0}addGroup(o,g,j=0){this.groups.push({start:o,count:g,materialIndex:j})}clearGroups(){this.groups=[]}setDrawRange(o,g){this.drawRange.start=o,this.drawRange.count=g}applyMatrix4(o){const g=this.attributes.position;g!==void 0&&(g.applyMatrix4(o),g.needsUpdate=!0);const j=this.attributes.normal;if(j!==void 0){const ee=new go().getNormalMatrix(o);j.applyNormalMatrix(ee),j.needsUpdate=!0}const Y=this.attributes.tangent;return Y!==void 0&&(Y.transformDirection(o),Y.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(o){return gt.makeRotationFromQuaternion(o),this.applyMatrix4(gt),this}rotateX(o){return gt.makeRotationX(o),this.applyMatrix4(gt),this}rotateY(o){return gt.makeRotationY(o),this.applyMatrix4(gt),this}rotateZ(o){return gt.makeRotationZ(o),this.applyMatrix4(gt),this}translate(o,g,j){return gt.makeTranslation(o,g,j),this.applyMatrix4(gt),this}scale(o,g,j){return gt.makeScale(o,g,j),this.applyMatrix4(gt),this}lookAt(o){return Pt.lookAt(o),Pt.updateMatrix(),this.applyMatrix4(Pt.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(cn).negate(),this.translate(cn.x,cn.y,cn.z),this}setFromPoints(o){const g=[];for(let j=0,Y=o.length;j<Y;j++){const ee=o[j];g.push(ee.x,ee.y,ee.z||0)}return this.setAttribute("position",new ce(g,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new so);const o=this.attributes.position,g=this.morphAttributes.position;if(o&&o.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new vt(-1/0,-1/0,-1/0),new vt(1/0,1/0,1/0));if(o!==void 0){if(this.boundingBox.setFromBufferAttribute(o),g)for(let j=0,Y=g.length;j<Y;j++){const ee=g[j];Vn.setFromBufferAttribute(ee),this.morphTargetsRelative?(Ti.addVectors(this.boundingBox.min,Vn.min),this.boundingBox.expandByPoint(Ti),Ti.addVectors(this.boundingBox.max,Vn.max),this.boundingBox.expandByPoint(Ti)):(this.boundingBox.expandByPoint(Vn.min),this.boundingBox.expandByPoint(Vn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new kc);const o=this.attributes.position,g=this.morphAttributes.position;if(o&&o.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new vt,1/0);if(o){const j=this.boundingSphere.center;if(Vn.setFromBufferAttribute(o),g)for(let ee=0,ie=g.length;ee<ie;ee++){const se=g[ee];vi.setFromBufferAttribute(se),this.morphTargetsRelative?(Ti.addVectors(Vn.min,vi.min),Vn.expandByPoint(Ti),Ti.addVectors(Vn.max,vi.max),Vn.expandByPoint(Ti)):(Vn.expandByPoint(vi.min),Vn.expandByPoint(vi.max))}Vn.getCenter(j);let Y=0;for(let ee=0,ie=o.count;ee<ie;ee++)Ti.fromBufferAttribute(o,ee),Y=Math.max(Y,j.distanceToSquared(Ti));if(g)for(let ee=0,ie=g.length;ee<ie;ee++){const se=g[ee],de=this.morphTargetsRelative;for(let pe=0,be=se.count;pe<be;pe++)Ti.fromBufferAttribute(se,pe),de&&(cn.fromBufferAttribute(o,pe),Ti.add(cn)),Y=Math.max(Y,j.distanceToSquared(Ti))}this.boundingSphere.radius=Math.sqrt(Y),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const o=this.index,g=this.attributes;if(o===null||g.position===void 0||g.normal===void 0||g.uv===void 0)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const j=o.array,Y=g.position.array,ee=g.normal.array,ie=g.uv.array,se=Y.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new is(new Float32Array(4*se),4));const de=this.getAttribute("tangent").array,pe=[],be=[];for(let qt=0;qt<se;qt++)pe[qt]=new vt,be[qt]=new vt;const Ce=new vt,xe=new vt,Ie=new vt,Re=new Bn,De=new Bn,ze=new Bn,je=new vt,Ve=new vt;function $e(qt,Ot,En){Ce.fromArray(Y,3*qt),xe.fromArray(Y,3*Ot),Ie.fromArray(Y,3*En),Re.fromArray(ie,2*qt),De.fromArray(ie,2*Ot),ze.fromArray(ie,2*En),xe.sub(Ce),Ie.sub(Ce),De.sub(Re),ze.sub(Re);const Ln=1/(De.x*ze.y-ze.x*De.y);isFinite(Ln)&&(je.copy(xe).multiplyScalar(ze.y).addScaledVector(Ie,-De.y).multiplyScalar(Ln),Ve.copy(Ie).multiplyScalar(De.x).addScaledVector(xe,-ze.x).multiplyScalar(Ln),pe[qt].add(je),pe[Ot].add(je),pe[En].add(je),be[qt].add(Ve),be[Ot].add(Ve),be[En].add(Ve))}let ct=this.groups;ct.length===0&&(ct=[{start:0,count:j.length}]);for(let qt=0,Ot=ct.length;qt<Ot;++qt){const En=ct[qt],Ln=En.start;for(let wn=Ln,jn=Ln+En.count;wn<jn;wn+=3)$e(j[wn+0],j[wn+1],j[wn+2])}const dt=new vt,ft=new vt,Bt=new vt,Lt=new vt;function Wt(qt){Bt.fromArray(ee,3*qt),Lt.copy(Bt);const Ot=pe[qt];dt.copy(Ot),dt.sub(Bt.multiplyScalar(Bt.dot(Ot))).normalize(),ft.crossVectors(Lt,Ot);const En=ft.dot(be[qt])<0?-1:1;de[4*qt]=dt.x,de[4*qt+1]=dt.y,de[4*qt+2]=dt.z,de[4*qt+3]=En}for(let qt=0,Ot=ct.length;qt<Ot;++qt){const En=ct[qt],Ln=En.start;for(let wn=Ln,jn=Ln+En.count;wn<jn;wn+=3)Wt(j[wn+0]),Wt(j[wn+1]),Wt(j[wn+2])}}computeVertexNormals(){const o=this.index,g=this.getAttribute("position");if(g!==void 0){let j=this.getAttribute("normal");if(j===void 0)j=new is(new Float32Array(3*g.count),3),this.setAttribute("normal",j);else for(let xe=0,Ie=j.count;xe<Ie;xe++)j.setXYZ(xe,0,0,0);const Y=new vt,ee=new vt,ie=new vt,se=new vt,de=new vt,pe=new vt,be=new vt,Ce=new vt;if(o)for(let xe=0,Ie=o.count;xe<Ie;xe+=3){const Re=o.getX(xe+0),De=o.getX(xe+1),ze=o.getX(xe+2);Y.fromBufferAttribute(g,Re),ee.fromBufferAttribute(g,De),ie.fromBufferAttribute(g,ze),be.subVectors(ie,ee),Ce.subVectors(Y,ee),be.cross(Ce),se.fromBufferAttribute(j,Re),de.fromBufferAttribute(j,De),pe.fromBufferAttribute(j,ze),se.add(be),de.add(be),pe.add(be),j.setXYZ(Re,se.x,se.y,se.z),j.setXYZ(De,de.x,de.y,de.z),j.setXYZ(ze,pe.x,pe.y,pe.z)}else for(let xe=0,Ie=g.count;xe<Ie;xe+=3)Y.fromBufferAttribute(g,xe+0),ee.fromBufferAttribute(g,xe+1),ie.fromBufferAttribute(g,xe+2),be.subVectors(ie,ee),Ce.subVectors(Y,ee),be.cross(Ce),j.setXYZ(xe+0,be.x,be.y,be.z),j.setXYZ(xe+1,be.x,be.y,be.z),j.setXYZ(xe+2,be.x,be.y,be.z);this.normalizeNormals(),j.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const o=this.attributes.normal;for(let g=0,j=o.count;g<j;g++)Ti.fromBufferAttribute(o,g),Ti.normalize(),o.setXYZ(g,Ti.x,Ti.y,Ti.z)}toNonIndexed(){function o(se,de){const pe=se.array,be=se.itemSize,Ce=se.normalized,xe=new pe.constructor(de.length*be);let Ie=0,Re=0;for(let De=0,ze=de.length;De<ze;De++){Ie=se.isInterleavedBufferAttribute?de[De]*se.data.stride+se.offset:de[De]*be;for(let je=0;je<be;je++)xe[Re++]=pe[Ie++]}return new is(xe,be,Ce)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const g=new yi,j=this.index.array,Y=this.attributes;for(const se in Y){const de=o(Y[se],j);g.setAttribute(se,de)}const ee=this.morphAttributes;for(const se in ee){const de=[],pe=ee[se];for(let be=0,Ce=pe.length;be<Ce;be++){const xe=o(pe[be],j);de.push(xe)}g.morphAttributes[se]=de}g.morphTargetsRelative=this.morphTargetsRelative;const ie=this.groups;for(let se=0,de=ie.length;se<de;se++){const pe=ie[se];g.addGroup(pe.start,pe.count,pe.materialIndex)}return g}toJSON(){const o={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(o.uuid=this.uuid,o.type=this.type,this.name!==""&&(o.name=this.name),Object.keys(this.userData).length>0&&(o.userData=this.userData),this.parameters!==void 0){const de=this.parameters;for(const pe in de)de[pe]!==void 0&&(o[pe]=de[pe]);return o}o.data={attributes:{}};const g=this.index;g!==null&&(o.data.index={type:g.array.constructor.name,array:Array.prototype.slice.call(g.array)});const j=this.attributes;for(const de in j){const pe=j[de];o.data.attributes[de]=pe.toJSON(o.data)}const Y={};let ee=!1;for(const de in this.morphAttributes){const pe=this.morphAttributes[de],be=[];for(let Ce=0,xe=pe.length;Ce<xe;Ce++){const Ie=pe[Ce];be.push(Ie.toJSON(o.data))}be.length>0&&(Y[de]=be,ee=!0)}ee&&(o.data.morphAttributes=Y,o.data.morphTargetsRelative=this.morphTargetsRelative);const ie=this.groups;ie.length>0&&(o.data.groups=JSON.parse(JSON.stringify(ie)));const se=this.boundingSphere;return se!==null&&(o.data.boundingSphere={center:se.center.toArray(),radius:se.radius}),o}clone(){return new this.constructor().copy(this)}copy(o){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const g={};this.name=o.name;const j=o.index;j!==null&&this.setIndex(j.clone(g));const Y=o.attributes;for(const pe in Y){const be=Y[pe];this.setAttribute(pe,be.clone(g))}const ee=o.morphAttributes;for(const pe in ee){const be=[],Ce=ee[pe];for(let xe=0,Ie=Ce.length;xe<Ie;xe++)be.push(Ce[xe].clone(g));this.morphAttributes[pe]=be}this.morphTargetsRelative=o.morphTargetsRelative;const ie=o.groups;for(let pe=0,be=ie.length;pe<be;pe++){const Ce=ie[pe];this.addGroup(Ce.start,Ce.count,Ce.materialIndex)}const se=o.boundingBox;se!==null&&(this.boundingBox=se.clone());const de=o.boundingSphere;return de!==null&&(this.boundingSphere=de.clone()),this.drawRange.start=o.drawRange.start,this.drawRange.count=o.drawRange.count,this.userData=o.userData,o.parameters!==void 0&&(this.parameters=Object.assign({},o.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const Go=new Yi,rs=new vu,Ka=new kc,Fa=new vt,sa=new vt,Ds=new vt,jc=new vt,wu=new vt,zc=new vt,xu=new vt,dd=new vt,Lf=new vt,pd=new Bn,fd=new Bn,Nf=new Bn,wg=new vt,md=new vt;class lo extends Ar{constructor(o=new yi,g=new wl){super(),this.isMesh=!0,this.type="Mesh",this.geometry=o,this.material=g,this.updateMorphTargets()}copy(o,g){return super.copy(o,g),o.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=o.morphTargetInfluences.slice()),o.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},o.morphTargetDictionary)),this.material=o.material,this.geometry=o.geometry,this}updateMorphTargets(){const o=this.geometry.morphAttributes,g=Object.keys(o);if(g.length>0){const j=o[g[0]];if(j!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let Y=0,ee=j.length;Y<ee;Y++){const ie=j[Y].name||String(Y);this.morphTargetInfluences.push(0),this.morphTargetDictionary[ie]=Y}}}}raycast(o,g){const j=this.geometry,Y=this.material,ee=this.matrixWorld;if(Y===void 0||(j.boundingSphere===null&&j.computeBoundingSphere(),Ka.copy(j.boundingSphere),Ka.applyMatrix4(ee),o.ray.intersectsSphere(Ka)===!1)||(Go.copy(ee).invert(),rs.copy(o.ray).applyMatrix4(Go),j.boundingBox!==null&&rs.intersectsBox(j.boundingBox)===!1))return;let ie;const se=j.index,de=j.attributes.position,pe=j.morphAttributes.position,be=j.morphTargetsRelative,Ce=j.attributes.uv,xe=j.attributes.uv2,Ie=j.groups,Re=j.drawRange;if(se!==null)if(Array.isArray(Y))for(let De=0,ze=Ie.length;De<ze;De++){const je=Ie[De],Ve=Y[je.materialIndex];for(let $e=Math.max(je.start,Re.start),ct=Math.min(se.count,Math.min(je.start+je.count,Re.start+Re.count));$e<ct;$e+=3){const dt=se.getX($e),ft=se.getX($e+1),Bt=se.getX($e+2);ie=xg(this,Ve,o,rs,de,pe,be,Ce,xe,dt,ft,Bt),ie&&(ie.faceIndex=Math.floor($e/3),ie.face.materialIndex=je.materialIndex,g.push(ie))}}else for(let De=Math.max(0,Re.start),ze=Math.min(se.count,Re.start+Re.count);De<ze;De+=3){const je=se.getX(De),Ve=se.getX(De+1),$e=se.getX(De+2);ie=xg(this,Y,o,rs,de,pe,be,Ce,xe,je,Ve,$e),ie&&(ie.faceIndex=Math.floor(De/3),g.push(ie))}else if(de!==void 0)if(Array.isArray(Y))for(let De=0,ze=Ie.length;De<ze;De++){const je=Ie[De],Ve=Y[je.materialIndex];for(let $e=Math.max(je.start,Re.start),ct=Math.min(de.count,Math.min(je.start+je.count,Re.start+Re.count));$e<ct;$e+=3)ie=xg(this,Ve,o,rs,de,pe,be,Ce,xe,$e,$e+1,$e+2),ie&&(ie.faceIndex=Math.floor($e/3),ie.face.materialIndex=je.materialIndex,g.push(ie))}else for(let De=Math.max(0,Re.start),ze=Math.min(de.count,Re.start+Re.count);De<ze;De+=3)ie=xg(this,Y,o,rs,de,pe,be,Ce,xe,De,De+1,De+2),ie&&(ie.faceIndex=Math.floor(De/3),g.push(ie))}}function xg(ue,o,g,j,Y,ee,ie,se,de,pe,be,Ce){Fa.fromBufferAttribute(Y,pe),sa.fromBufferAttribute(Y,be),Ds.fromBufferAttribute(Y,Ce);const xe=ue.morphTargetInfluences;if(ee&&xe){xu.set(0,0,0),dd.set(0,0,0),Lf.set(0,0,0);for(let Re=0,De=ee.length;Re<De;Re++){const ze=xe[Re],je=ee[Re];ze!==0&&(jc.fromBufferAttribute(je,pe),wu.fromBufferAttribute(je,be),zc.fromBufferAttribute(je,Ce),ie?(xu.addScaledVector(jc,ze),dd.addScaledVector(wu,ze),Lf.addScaledVector(zc,ze)):(xu.addScaledVector(jc.sub(Fa),ze),dd.addScaledVector(wu.sub(sa),ze),Lf.addScaledVector(zc.sub(Ds),ze)))}Fa.add(xu),sa.add(dd),Ds.add(Lf)}ue.isSkinnedMesh&&(ue.boneTransform(pe,Fa),ue.boneTransform(be,sa),ue.boneTransform(Ce,Ds));const Ie=function(Re,De,ze,je,Ve,$e,ct,dt){let ft;if(ft=De.side===Ue?je.intersectTriangle(ct,$e,Ve,!0,dt):je.intersectTriangle(Ve,$e,ct,De.side!==nt,dt),ft===null)return null;md.copy(dt),md.applyMatrix4(Re.matrixWorld);const Bt=ze.ray.origin.distanceTo(md);return Bt<ze.near||Bt>ze.far?null:{distance:Bt,point:md.clone(),object:Re}}(ue,o,g,j,Fa,sa,Ds,wg);if(Ie){se&&(pd.fromBufferAttribute(se,pe),fd.fromBufferAttribute(se,be),Nf.fromBufferAttribute(se,Ce),Ie.uv=Bo.getUV(wg,Fa,sa,Ds,pd,fd,Nf,new Bn)),de&&(pd.fromBufferAttribute(de,pe),fd.fromBufferAttribute(de,be),Nf.fromBufferAttribute(de,Ce),Ie.uv2=Bo.getUV(wg,Fa,sa,Ds,pd,fd,Nf,new Bn));const Re={a:pe,b:be,c:Ce,normal:new vt,materialIndex:0};Bo.getNormal(Fa,sa,Ds,Re.normal),Ie.face=Re}return Ie}class Eu extends yi{constructor(o=1,g=1,j=1,Y=1,ee=1,ie=1){super(),this.type="BoxGeometry",this.parameters={width:o,height:g,depth:j,widthSegments:Y,heightSegments:ee,depthSegments:ie};const se=this;Y=Math.floor(Y),ee=Math.floor(ee),ie=Math.floor(ie);const de=[],pe=[],be=[],Ce=[];let xe=0,Ie=0;function Re(De,ze,je,Ve,$e,ct,dt,ft,Bt,Lt,Wt){const qt=ct/Bt,Ot=dt/Lt,En=ct/2,Ln=dt/2,wn=ft/2,jn=Bt+1,Wn=Lt+1;let hn=0,fn=0;const Gn=new vt;for(let Sn=0;Sn<Wn;Sn++){const Hn=Sn*Ot-Ln;for(let di=0;di<jn;di++){const nr=di*qt-En;Gn[De]=nr*Ve,Gn[ze]=Hn*$e,Gn[je]=wn,pe.push(Gn.x,Gn.y,Gn.z),Gn[De]=0,Gn[ze]=0,Gn[je]=ft>0?1:-1,be.push(Gn.x,Gn.y,Gn.z),Ce.push(di/Bt),Ce.push(1-Sn/Lt),hn+=1}}for(let Sn=0;Sn<Lt;Sn++)for(let Hn=0;Hn<Bt;Hn++){const di=xe+Hn+jn*Sn,nr=xe+Hn+jn*(Sn+1),Ci=xe+(Hn+1)+jn*(Sn+1),sr=xe+(Hn+1)+jn*Sn;de.push(di,nr,sr),de.push(nr,Ci,sr),fn+=6}se.addGroup(Ie,fn,Wt),Ie+=fn,xe+=hn}Re("z","y","x",-1,-1,j,g,o,ie,ee,0),Re("z","y","x",1,-1,j,g,-o,ie,ee,1),Re("x","z","y",1,1,o,j,g,Y,ie,2),Re("x","z","y",1,-1,o,j,-g,Y,ie,3),Re("x","y","z",1,-1,o,g,j,Y,ee,4),Re("x","y","z",-1,-1,o,g,-j,Y,ee,5),this.setIndex(de),this.setAttribute("position",new ce(pe,3)),this.setAttribute("normal",new ce(be,3)),this.setAttribute("uv",new ce(Ce,2))}static fromJSON(o){return new Eu(o.width,o.height,o.depth,o.widthSegments,o.heightSegments,o.depthSegments)}}function Su(ue){const o={};for(const g in ue){o[g]={};for(const j in ue[g]){const Y=ue[g][j];Y&&(Y.isColor||Y.isMatrix3||Y.isMatrix4||Y.isVector2||Y.isVector3||Y.isVector4||Y.isTexture||Y.isQuaternion)?o[g][j]=Y.clone():Array.isArray(Y)?o[g][j]=Y.slice():o[g][j]=Y}}return o}function yo(ue){const o={};for(let g=0;g<ue.length;g++){const j=Su(ue[g]);for(const Y in j)o[Y]=j[Y]}return o}const Mv={clone:Su,merge:yo};class El extends $s{constructor(o){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,o!==void 0&&this.setValues(o)}copy(o){return super.copy(o),this.fragmentShader=o.fragmentShader,this.vertexShader=o.vertexShader,this.uniforms=Su(o.uniforms),this.uniformsGroups=function(g){const j=[];for(let Y=0;Y<g.length;Y++)j.push(g[Y].clone());return j}(o.uniformsGroups),this.defines=Object.assign({},o.defines),this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.fog=o.fog,this.lights=o.lights,this.clipping=o.clipping,this.extensions=Object.assign({},o.extensions),this.glslVersion=o.glslVersion,this}toJSON(o){const g=super.toJSON(o);g.glslVersion=this.glslVersion,g.uniforms={};for(const Y in this.uniforms){const ee=this.uniforms[Y].value;ee&&ee.isTexture?g.uniforms[Y]={type:"t",value:ee.toJSON(o).uuid}:ee&&ee.isColor?g.uniforms[Y]={type:"c",value:ee.getHex()}:ee&&ee.isVector2?g.uniforms[Y]={type:"v2",value:ee.toArray()}:ee&&ee.isVector3?g.uniforms[Y]={type:"v3",value:ee.toArray()}:ee&&ee.isVector4?g.uniforms[Y]={type:"v4",value:ee.toArray()}:ee&&ee.isMatrix3?g.uniforms[Y]={type:"m3",value:ee.toArray()}:ee&&ee.isMatrix4?g.uniforms[Y]={type:"m4",value:ee.toArray()}:g.uniforms[Y]={value:ee}}Object.keys(this.defines).length>0&&(g.defines=this.defines),g.vertexShader=this.vertexShader,g.fragmentShader=this.fragmentShader;const j={};for(const Y in this.extensions)this.extensions[Y]===!0&&(j[Y]=!0);return Object.keys(j).length>0&&(g.extensions=j),g}}class gd extends Ar{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Yi,this.projectionMatrix=new Yi,this.projectionMatrixInverse=new Yi}copy(o,g){return super.copy(o,g),this.matrixWorldInverse.copy(o.matrixWorldInverse),this.projectionMatrix.copy(o.projectionMatrix),this.projectionMatrixInverse.copy(o.projectionMatrixInverse),this}getWorldDirection(o){this.updateWorldMatrix(!0,!1);const g=this.matrixWorld.elements;return o.set(-g[8],-g[9],-g[10]).normalize()}updateMatrixWorld(o){super.updateMatrixWorld(o),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(o,g){super.updateWorldMatrix(o,g),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class ko extends gd{constructor(o=50,g=1,j=.1,Y=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=o,this.zoom=1,this.near=j,this.far=Y,this.focus=10,this.aspect=g,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(o,g){return super.copy(o,g),this.fov=o.fov,this.zoom=o.zoom,this.near=o.near,this.far=o.far,this.focus=o.focus,this.aspect=o.aspect,this.view=o.view===null?null:Object.assign({},o.view),this.filmGauge=o.filmGauge,this.filmOffset=o.filmOffset,this}setFocalLength(o){const g=.5*this.getFilmHeight()/o;this.fov=2*ed*Math.atan(g),this.updateProjectionMatrix()}getFocalLength(){const o=Math.tan(.5*du*this.fov);return .5*this.getFilmHeight()/o}getEffectiveFOV(){return 2*ed*Math.atan(Math.tan(.5*du*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(o,g,j,Y,ee,ie){this.aspect=o/g,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=o,this.view.fullHeight=g,this.view.offsetX=j,this.view.offsetY=Y,this.view.width=ee,this.view.height=ie,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const o=this.near;let g=o*Math.tan(.5*du*this.fov)/this.zoom,j=2*g,Y=this.aspect*j,ee=-.5*Y;const ie=this.view;if(this.view!==null&&this.view.enabled){const de=ie.fullWidth,pe=ie.fullHeight;ee+=ie.offsetX*Y/de,g-=ie.offsetY*j/pe,Y*=ie.width/de,j*=ie.height/pe}const se=this.filmOffset;se!==0&&(ee+=o*se/this.getFilmWidth()),this.projectionMatrix.makePerspective(ee,ee+Y,g,g-j,o,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(o){const g=super.toJSON(o);return g.object.fov=this.fov,g.object.zoom=this.zoom,g.object.near=this.near,g.object.far=this.far,g.object.focus=this.focus,g.object.aspect=this.aspect,this.view!==null&&(g.object.view=Object.assign({},this.view)),g.object.filmGauge=this.filmGauge,g.object.filmOffset=this.filmOffset,g}}const Ep=90;class SA extends Ar{constructor(o,g,j){super(),this.type="CubeCamera",this.renderTarget=j;const Y=new ko(Ep,1,o,g);Y.layers=this.layers,Y.up.set(0,-1,0),Y.lookAt(new vt(1,0,0)),this.add(Y);const ee=new ko(Ep,1,o,g);ee.layers=this.layers,ee.up.set(0,-1,0),ee.lookAt(new vt(-1,0,0)),this.add(ee);const ie=new ko(Ep,1,o,g);ie.layers=this.layers,ie.up.set(0,0,1),ie.lookAt(new vt(0,1,0)),this.add(ie);const se=new ko(Ep,1,o,g);se.layers=this.layers,se.up.set(0,0,-1),se.lookAt(new vt(0,-1,0)),this.add(se);const de=new ko(Ep,1,o,g);de.layers=this.layers,de.up.set(0,-1,0),de.lookAt(new vt(0,0,1)),this.add(de);const pe=new ko(Ep,1,o,g);pe.layers=this.layers,pe.up.set(0,-1,0),pe.lookAt(new vt(0,0,-1)),this.add(pe)}update(o,g){this.parent===null&&this.updateMatrixWorld();const j=this.renderTarget,[Y,ee,ie,se,de,pe]=this.children,be=o.getRenderTarget(),Ce=o.toneMapping,xe=o.xr.enabled;o.toneMapping=Li,o.xr.enabled=!1;const Ie=j.texture.generateMipmaps;j.texture.generateMipmaps=!1,o.setRenderTarget(j,0),o.render(g,Y),o.setRenderTarget(j,1),o.render(g,ee),o.setRenderTarget(j,2),o.render(g,ie),o.setRenderTarget(j,3),o.render(g,se),o.setRenderTarget(j,4),o.render(g,de),j.texture.generateMipmaps=Ie,o.setRenderTarget(j,5),o.render(g,pe),o.setRenderTarget(be),o.toneMapping=Ce,o.xr.enabled=xe,j.texture.needsPMREMUpdate=!0}}class Uf extends vs{constructor(o,g,j,Y,ee,ie,se,de,pe,be){super(o=o!==void 0?o:[],g=g!==void 0?g:Rr,j,Y,ee,ie,se,de,pe,be),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(o){this.image=o}}class Eg extends Aa{constructor(o,g={}){super(o,o,g),this.isWebGLCubeRenderTarget=!0;const j={width:o,height:o,depth:1},Y=[j,j,j,j,j,j];this.texture=new Uf(Y,g.mapping,g.wrapS,g.wrapT,g.magFilter,g.minFilter,g.format,g.type,g.anisotropy,g.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=g.generateMipmaps!==void 0&&g.generateMipmaps,this.texture.minFilter=g.minFilter!==void 0?g.minFilter:Ur}fromEquirectangularTexture(o,g){this.texture.type=g.type,this.texture.encoding=g.encoding,this.texture.generateMipmaps=g.generateMipmaps,this.texture.minFilter=g.minFilter,this.texture.magFilter=g.magFilter;const j={tEquirect:{value:null}},Y=`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,ee=`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`,ie=new Eu(5,5,5),se=new El({name:"CubemapFromEquirect",uniforms:Su(j),vertexShader:Y,fragmentShader:ee,side:Ue,blending:He});se.uniforms.tEquirect.value=g;const de=new lo(ie,se),pe=g.minFilter;return g.minFilter===oi&&(g.minFilter=Ur),new SA(1,10,this).update(o,de),g.minFilter=pe,de.geometry.dispose(),de.material.dispose(),this}clear(o,g,j,Y){const ee=o.getRenderTarget();for(let ie=0;ie<6;ie++)o.setRenderTarget(this,ie),o.clear(g,j,Y);o.setRenderTarget(ee)}}const Sg=new vt,Tv=new vt,CA=new go;class Cu{constructor(o=new vt(1,0,0),g=0){this.isPlane=!0,this.normal=o,this.constant=g}set(o,g){return this.normal.copy(o),this.constant=g,this}setComponents(o,g,j,Y){return this.normal.set(o,g,j),this.constant=Y,this}setFromNormalAndCoplanarPoint(o,g){return this.normal.copy(o),this.constant=-g.dot(this.normal),this}setFromCoplanarPoints(o,g,j){const Y=Sg.subVectors(j,g).cross(Tv.subVectors(o,g)).normalize();return this.setFromNormalAndCoplanarPoint(Y,o),this}copy(o){return this.normal.copy(o.normal),this.constant=o.constant,this}normalize(){const o=1/this.normal.length();return this.normal.multiplyScalar(o),this.constant*=o,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(o){return this.normal.dot(o)+this.constant}distanceToSphere(o){return this.distanceToPoint(o.center)-o.radius}projectPoint(o,g){return g.copy(this.normal).multiplyScalar(-this.distanceToPoint(o)).add(o)}intersectLine(o,g){const j=o.delta(Sg),Y=this.normal.dot(j);if(Y===0)return this.distanceToPoint(o.start)===0?g.copy(o.start):null;const ee=-(o.start.dot(this.normal)+this.constant)/Y;return ee<0||ee>1?null:g.copy(j).multiplyScalar(ee).add(o.start)}intersectsLine(o){const g=this.distanceToPoint(o.start),j=this.distanceToPoint(o.end);return g<0&&j>0||j<0&&g>0}intersectsBox(o){return o.intersectsPlane(this)}intersectsSphere(o){return o.intersectsPlane(this)}coplanarPoint(o){return o.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(o,g){const j=g||CA.getNormalMatrix(o),Y=this.coplanarPoint(Sg).applyMatrix4(o),ee=this.normal.applyMatrix3(j).normalize();return this.constant=-Y.dot(ee),this}translate(o){return this.constant-=o.dot(this.normal),this}equals(o){return o.normal.equals(this.normal)&&o.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Sp=new kc,Cg=new vt;class $l{constructor(o=new Cu,g=new Cu,j=new Cu,Y=new Cu,ee=new Cu,ie=new Cu){this.planes=[o,g,j,Y,ee,ie]}set(o,g,j,Y,ee,ie){const se=this.planes;return se[0].copy(o),se[1].copy(g),se[2].copy(j),se[3].copy(Y),se[4].copy(ee),se[5].copy(ie),this}copy(o){const g=this.planes;for(let j=0;j<6;j++)g[j].copy(o.planes[j]);return this}setFromProjectionMatrix(o){const g=this.planes,j=o.elements,Y=j[0],ee=j[1],ie=j[2],se=j[3],de=j[4],pe=j[5],be=j[6],Ce=j[7],xe=j[8],Ie=j[9],Re=j[10],De=j[11],ze=j[12],je=j[13],Ve=j[14],$e=j[15];return g[0].setComponents(se-Y,Ce-de,De-xe,$e-ze).normalize(),g[1].setComponents(se+Y,Ce+de,De+xe,$e+ze).normalize(),g[2].setComponents(se+ee,Ce+pe,De+Ie,$e+je).normalize(),g[3].setComponents(se-ee,Ce-pe,De-Ie,$e-je).normalize(),g[4].setComponents(se-ie,Ce-be,De-Re,$e-Ve).normalize(),g[5].setComponents(se+ie,Ce+be,De+Re,$e+Ve).normalize(),this}intersectsObject(o){const g=o.geometry;return g.boundingSphere===null&&g.computeBoundingSphere(),Sp.copy(g.boundingSphere).applyMatrix4(o.matrixWorld),this.intersectsSphere(Sp)}intersectsSprite(o){return Sp.center.set(0,0,0),Sp.radius=.7071067811865476,Sp.applyMatrix4(o.matrixWorld),this.intersectsSphere(Sp)}intersectsSphere(o){const g=this.planes,j=o.center,Y=-o.radius;for(let ee=0;ee<6;ee++)if(g[ee].distanceToPoint(j)<Y)return!1;return!0}intersectsBox(o){const g=this.planes;for(let j=0;j<6;j++){const Y=g[j];if(Cg.x=Y.normal.x>0?o.max.x:o.min.x,Cg.y=Y.normal.y>0?o.max.y:o.min.y,Cg.z=Y.normal.z>0?o.max.z:o.min.z,Y.distanceToPoint(Cg)<0)return!1}return!0}containsPoint(o){const g=this.planes;for(let j=0;j<6;j++)if(g[j].distanceToPoint(o)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function Mg(){let ue=null,o=!1,g=null,j=null;function Y(ee,ie){g(ee,ie),j=ue.requestAnimationFrame(Y)}return{start:function(){o!==!0&&g!==null&&(j=ue.requestAnimationFrame(Y),o=!0)},stop:function(){ue.cancelAnimationFrame(j),o=!1},setAnimationLoop:function(ee){g=ee},setContext:function(ee){ue=ee}}}function MA(ue,o){const g=o.isWebGL2,j=new WeakMap;return{get:function(Y){return Y.isInterleavedBufferAttribute&&(Y=Y.data),j.get(Y)},remove:function(Y){Y.isInterleavedBufferAttribute&&(Y=Y.data);const ee=j.get(Y);ee&&(ue.deleteBuffer(ee.buffer),j.delete(Y))},update:function(Y,ee){if(Y.isGLBufferAttribute){const se=j.get(Y);return void((!se||se.version<Y.version)&&j.set(Y,{buffer:Y.buffer,type:Y.type,bytesPerElement:Y.elementSize,version:Y.version}))}Y.isInterleavedBufferAttribute&&(Y=Y.data);const ie=j.get(Y);ie===void 0?j.set(Y,function(se,de){const pe=se.array,be=se.usage,Ce=ue.createBuffer();let xe;if(ue.bindBuffer(de,Ce),ue.bufferData(de,pe,be),se.onUploadCallback(),pe instanceof Float32Array)xe=5126;else if(pe instanceof Uint16Array)if(se.isFloat16BufferAttribute){if(!g)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");xe=5131}else xe=5123;else if(pe instanceof Int16Array)xe=5122;else if(pe instanceof Uint32Array)xe=5125;else if(pe instanceof Int32Array)xe=5124;else if(pe instanceof Int8Array)xe=5120;else if(pe instanceof Uint8Array)xe=5121;else{if(!(pe instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+pe);xe=5121}return{buffer:Ce,type:xe,bytesPerElement:pe.BYTES_PER_ELEMENT,version:se.version}}(Y,ee)):ie.version<Y.version&&(function(se,de,pe){const be=de.array,Ce=de.updateRange;ue.bindBuffer(pe,se),Ce.count===-1?ue.bufferSubData(pe,0,be):(g?ue.bufferSubData(pe,Ce.offset*be.BYTES_PER_ELEMENT,be,Ce.offset,Ce.count):ue.bufferSubData(pe,Ce.offset*be.BYTES_PER_ELEMENT,be.subarray(Ce.offset,Ce.offset+Ce.count)),Ce.count=-1)}(ie.buffer,Y,ee),ie.version=Y.version)}}}class _d extends yi{constructor(o=1,g=1,j=1,Y=1){super(),this.type="PlaneGeometry",this.parameters={width:o,height:g,widthSegments:j,heightSegments:Y};const ee=o/2,ie=g/2,se=Math.floor(j),de=Math.floor(Y),pe=se+1,be=de+1,Ce=o/se,xe=g/de,Ie=[],Re=[],De=[],ze=[];for(let je=0;je<be;je++){const Ve=je*xe-ie;for(let $e=0;$e<pe;$e++){const ct=$e*Ce-ee;Re.push(ct,-Ve,0),De.push(0,0,1),ze.push($e/se),ze.push(1-je/de)}}for(let je=0;je<de;je++)for(let Ve=0;Ve<se;Ve++){const $e=Ve+pe*je,ct=Ve+pe*(je+1),dt=Ve+1+pe*(je+1),ft=Ve+1+pe*je;Ie.push($e,ct,ft),Ie.push(ct,dt,ft)}this.setIndex(Ie),this.setAttribute("position",new ce(Re,3)),this.setAttribute("normal",new ce(De,3)),this.setAttribute("uv",new ce(ze,2))}static fromJSON(o){return new _d(o.width,o.height,o.widthSegments,o.heightSegments)}}const fr={alphamap_fragment:`#ifdef USE_ALPHAMAP
	#if defined(INVERSE_ALPHAMAP) && INVERSE_ALPHAMAP >= 1
	diffuseColor.a *= 1.0-texture2D( alphaMap, vUv ).g;
	#else
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
	#endif
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,alphatest_pars_fragment:`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,iridescence_fragment:`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment:`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex:`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common:`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	reflectVec = transformDirection1(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	vec3 transformDirection1( in vec3 dir, in mat4 matrix ) {
		return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
	}
	mat4 rotationMatrix(vec3 axis, float angle) {
		axis = normalize(axis);
		float s = sin(angle);
		float c = cos(angle);
		float oc = 1.0 - c;
		return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,
					oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,
					oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,
					0.0,                                0.0,                                0.0,                                1.0);
	}
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform float envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			worldNormal = transformDirection1(worldNormal, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			reflectVec = transformDirection1(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_fragment:`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment:`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment:`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert
#define Material_LightProbeLOD( material )	(0)`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment:`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphcolor_vertex:`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,normal_fragment_begin:`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps:`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex:`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,clearcoat_pars_fragment:`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,iridescence_pars_fragment:`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,output_fragment:`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
diffuseColor.a = min(max(diffuseColor.a, 0.), 1.);
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex:`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment:`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,transmission_pars_fragment:`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return transmissionSamplerMapTexelToLinear ( texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod ) );
		#else
			return transmissionSamplerMapTexelToLinear ( texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod ) );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,uv_pars_fragment:`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,uv_pars_vertex:`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,uv_vertex:`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,uv2_pars_fragment:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,uv2_pars_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,uv2_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
uniform bool flipX;
uniform bool flipY;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
    vUv = flipX ? vec2( 1.0 - vUv.x, vUv.y ) : vUv;
    vUv = flipY ? vec2( vUv.x, 1.0 - vUv.y ) : vUv;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );
	#endif
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`},Zn={common:{diffuse:{value:new ci(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new go},uv2Transform:{value:new go},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},envMapRotation:{value:0},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Bn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ci(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ci(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new go}},sprite:{diffuse:{value:new ci(16777215)},opacity:{value:1},center:{value:new Bn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new go}}},Zs={basic:{uniforms:yo([Zn.common,Zn.specularmap,Zn.envmap,Zn.aomap,Zn.lightmap,Zn.fog]),vertexShader:fr.meshbasic_vert,fragmentShader:fr.meshbasic_frag},lambert:{uniforms:yo([Zn.common,Zn.specularmap,Zn.envmap,Zn.aomap,Zn.lightmap,Zn.emissivemap,Zn.bumpmap,Zn.normalmap,Zn.displacementmap,Zn.fog,Zn.lights,{emissive:{value:new ci(0)}}]),vertexShader:fr.meshlambert_vert,fragmentShader:fr.meshlambert_frag},phong:{uniforms:yo([Zn.common,Zn.specularmap,Zn.envmap,Zn.aomap,Zn.lightmap,Zn.emissivemap,Zn.bumpmap,Zn.normalmap,Zn.displacementmap,Zn.fog,Zn.lights,{emissive:{value:new ci(0)},specular:{value:new ci(1118481)},shininess:{value:30}}]),vertexShader:fr.meshphong_vert,fragmentShader:fr.meshphong_frag},standard:{uniforms:yo([Zn.common,Zn.envmap,Zn.aomap,Zn.lightmap,Zn.emissivemap,Zn.bumpmap,Zn.normalmap,Zn.displacementmap,Zn.roughnessmap,Zn.metalnessmap,Zn.fog,Zn.lights,{emissive:{value:new ci(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:fr.meshphysical_vert,fragmentShader:fr.meshphysical_frag},toon:{uniforms:yo([Zn.common,Zn.aomap,Zn.lightmap,Zn.emissivemap,Zn.bumpmap,Zn.normalmap,Zn.displacementmap,Zn.gradientmap,Zn.fog,Zn.lights,{emissive:{value:new ci(0)}}]),vertexShader:fr.meshtoon_vert,fragmentShader:fr.meshtoon_frag},matcap:{uniforms:yo([Zn.common,Zn.bumpmap,Zn.normalmap,Zn.displacementmap,Zn.fog,{matcap:{value:null}}]),vertexShader:fr.meshmatcap_vert,fragmentShader:fr.meshmatcap_frag},points:{uniforms:yo([Zn.points,Zn.fog]),vertexShader:fr.points_vert,fragmentShader:fr.points_frag},dashed:{uniforms:yo([Zn.common,Zn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:fr.linedashed_vert,fragmentShader:fr.linedashed_frag},depth:{uniforms:yo([Zn.common,Zn.displacementmap]),vertexShader:fr.depth_vert,fragmentShader:fr.depth_frag},normal:{uniforms:yo([Zn.common,Zn.bumpmap,Zn.normalmap,Zn.displacementmap,{opacity:{value:1}}]),vertexShader:fr.meshnormal_vert,fragmentShader:fr.meshnormal_frag},sprite:{uniforms:yo([Zn.sprite,Zn.fog]),vertexShader:fr.sprite_vert,fragmentShader:fr.sprite_frag},background:{uniforms:{uvTransform:{value:new go},t2D:{value:null},flipX:{value:!1},flipY:{value:!1}},vertexShader:fr.background_vert,fragmentShader:fr.background_frag},cube:{uniforms:yo([Zn.envmap,{opacity:{value:1}}]),vertexShader:fr.cube_vert,fragmentShader:fr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:fr.equirect_vert,fragmentShader:fr.equirect_frag},distanceRGBA:{uniforms:yo([Zn.common,Zn.displacementmap,{referencePosition:{value:new vt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:fr.distanceRGBA_vert,fragmentShader:fr.distanceRGBA_frag},shadow:{uniforms:yo([Zn.lights,Zn.fog,{color:{value:new ci(0)},opacity:{value:1}}]),vertexShader:fr.shadow_vert,fragmentShader:fr.shadow_frag}};function Cp(ue,o,g,j,Y,ee){const ie=new ci(0);let se,de,pe=Y===!0?0:1,be=null,Ce=0,xe=null;function Ie(Re,De){g.buffers.color.setClear(Re.r,Re.g,Re.b,De,ee)}return{getClearColor:function(){return ie},setClearColor:function(Re,De=1){ie.set(Re),pe=De,Ie(ie,pe)},getClearAlpha:function(){return pe},setClearAlpha:function(Re){pe=Re,Ie(ie,pe)},getPlaneMesh:function(){return se},getBoxMesh:function(){return de},getBoxMesh2:function(){return de===void 0&&(de=new lo(new Eu(1,1,1),new El({name:"BackgroundCubeMaterial",uniforms:Su(Zs.cube.uniforms),vertexShader:Zs.cube.vertexShader,fragmentShader:Zs.cube.fragmentShader,side:Ue,depthTest:!1,depthWrite:!1,fog:!1})),de.geometry.deleteAttribute("normal"),de.geometry.deleteAttribute("uv"),de.onBeforeRender=function(Re,De,ze){this.matrixWorld.copyPosition(ze.matrixWorld)},Object.defineProperty(de.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),j.update(de)),de},render:function(Re,De){let ze=!1,je=De.isScene===!0?De.background:null;je&&je.isTexture&&(je=o.get(je));const Ve=ue.xr,$e=Ve.getSession&&Ve.getSession();$e&&$e.environmentBlendMode==="additive"&&(je=null),je===null?Ie(ie,pe):je&&je.isColor&&(Ie(je,1),ze=!0),(ue.autoClear||ze)&&ue.clear(ue.autoClearColor,ue.autoClearDepth,ue.autoClearStencil),je&&(je.isCubeTexture||je.mapping===Is)?(de===void 0&&(de=new lo(new Eu(1,1,1),new El({name:"BackgroundCubeMaterial",uniforms:Su(Zs.cube.uniforms),vertexShader:Zs.cube.vertexShader,fragmentShader:Zs.cube.fragmentShader,side:Ue,depthTest:!1,depthWrite:!1,fog:!1})),de.geometry.deleteAttribute("normal"),de.geometry.deleteAttribute("uv"),de.onBeforeRender=function(ct,dt,ft){this.matrixWorld.copyPosition(ft.matrixWorld)},Object.defineProperty(de.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),j.update(de)),de.material.uniforms.envMap.value=je,de.material.uniforms.envMapRotation.value=je.rotation||0,de.material.uniforms.flipEnvMap.value=je.isCubeTexture&&je.isRenderTargetTexture===!1?-1:1,be===je&&Ce===je.version&&xe===ue.toneMapping||(de.material.needsUpdate=!0,be=je,Ce=je.version,xe=ue.toneMapping),de.layers.enableAll(),Re.unshift(de,de.geometry,de.material,0,0,null)):je&&je.isTexture&&(se===void 0&&(se=new lo(new _d(2,2),new El({name:"BackgroundMaterial",uniforms:Su(Zs.background.uniforms),vertexShader:Zs.background.vertexShader,fragmentShader:Zs.background.fragmentShader,side:et,depthTest:!1,depthWrite:!1,fog:!1})),se.geometry.deleteAttribute("normal"),Object.defineProperty(se.material,"map",{get:function(){return this.uniforms.t2D.value}}),j.update(se)),se.material.uniforms.t2D.value=je,se.material.uniforms.flipX.value=je.userData.flipX||!1,se.material.uniforms.flipY.value=je.userData.flipY||!1,je.matrixAutoUpdate===!0&&je.updateMatrix(),se.material.uniforms.uvTransform.value.copy(je.matrix),be===je&&Ce===je.version&&xe===ue.toneMapping||(se.material.needsUpdate=!0,be=je,Ce=je.version,xe=ue.toneMapping),se.layers.enableAll(),Re.unshift(se,se.geometry,se.material,0,0,null))}}}function Iv(ue,o,g,j){const Y=ue.getParameter(34921),ee=j.isWebGL2?null:o.get("OES_vertex_array_object"),ie=j.isWebGL2||ee!==null,se={},de=Ie(null);let pe=de,be=!1;function Ce(dt){return j.isWebGL2?ue.bindVertexArray(dt):ee.bindVertexArrayOES(dt)}function xe(dt){return j.isWebGL2?ue.deleteVertexArray(dt):ee.deleteVertexArrayOES(dt)}function Ie(dt){const ft=[],Bt=[],Lt=[];for(let Wt=0;Wt<Y;Wt++)ft[Wt]=0,Bt[Wt]=0,Lt[Wt]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:ft,enabledAttributes:Bt,attributeDivisors:Lt,object:dt,attributes:{},index:null}}function Re(){const dt=pe.newAttributes;for(let ft=0,Bt=dt.length;ft<Bt;ft++)dt[ft]=0}function De(dt){ze(dt,0)}function ze(dt,ft){const Bt=pe.newAttributes,Lt=pe.enabledAttributes,Wt=pe.attributeDivisors;Bt[dt]=1,Lt[dt]===0&&(ue.enableVertexAttribArray(dt),Lt[dt]=1),Wt[dt]!==ft&&((j.isWebGL2?ue:o.get("ANGLE_instanced_arrays"))[j.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](dt,ft),Wt[dt]=ft)}function je(){const dt=pe.newAttributes,ft=pe.enabledAttributes;for(let Bt=0,Lt=ft.length;Bt<Lt;Bt++)ft[Bt]!==dt[Bt]&&(ue.disableVertexAttribArray(Bt),ft[Bt]=0)}function Ve(dt,ft,Bt,Lt,Wt,qt){j.isWebGL2!==!0||Bt!==5124&&Bt!==5125?ue.vertexAttribPointer(dt,ft,Bt,Lt,Wt,qt):ue.vertexAttribIPointer(dt,ft,Bt,Wt,qt)}function $e(){ct(),be=!0,pe!==de&&(pe=de,Ce(pe.object))}function ct(){de.geometry=null,de.program=null,de.wireframe=!1}return{setup:function(dt,ft,Bt,Lt,Wt){let qt=!1;if(ie){const Ot=function(En,Ln,wn){const jn=wn.wireframe===!0;let Wn=se[En.id];Wn===void 0&&(Wn={},se[En.id]=Wn);let hn=Wn[Ln.id];hn===void 0&&(hn={},Wn[Ln.id]=hn);let fn=hn[jn];return fn===void 0&&(fn=Ie(j.isWebGL2?ue.createVertexArray():ee.createVertexArrayOES()),hn[jn]=fn),fn}(Lt,Bt,ft);pe!==Ot&&(pe=Ot,Ce(pe.object)),qt=function(En,Ln,wn,jn){const Wn=pe.attributes,hn=Ln.attributes;let fn=0;const Gn=wn.getAttributes();for(const Sn in Gn)if(Gn[Sn].location>=0){const Hn=Wn[Sn];let di=hn[Sn];if(di===void 0&&(Sn==="instanceMatrix"&&En.instanceMatrix&&(di=En.instanceMatrix),Sn==="instanceColor"&&En.instanceColor&&(di=En.instanceColor)),Hn===void 0||Hn.attribute!==di||di&&Hn.data!==di.data)return!0;fn++}return pe.attributesNum!==fn||pe.index!==jn}(dt,Lt,Bt,Wt),qt&&function(En,Ln,wn,jn){const Wn={},hn=Ln.attributes;let fn=0;const Gn=wn.getAttributes();for(const Sn in Gn)if(Gn[Sn].location>=0){let Hn=hn[Sn];Hn===void 0&&(Sn==="instanceMatrix"&&En.instanceMatrix&&(Hn=En.instanceMatrix),Sn==="instanceColor"&&En.instanceColor&&(Hn=En.instanceColor));const di={};di.attribute=Hn,Hn&&Hn.data&&(di.data=Hn.data),Wn[Sn]=di,fn++}pe.attributes=Wn,pe.attributesNum=fn,pe.index=jn}(dt,Lt,Bt,Wt)}else{const Ot=ft.wireframe===!0;pe.geometry===Lt.id&&pe.program===Bt.id&&pe.wireframe===Ot||(pe.geometry=Lt.id,pe.program=Bt.id,pe.wireframe=Ot,qt=!0)}Wt!==null&&g.update(Wt,34963),(qt||be)&&(be=!1,function(Ot,En,Ln,wn){if(j.isWebGL2===!1&&(Ot.isInstancedMesh||wn.isInstancedBufferGeometry)&&o.get("ANGLE_instanced_arrays")===null)return;Re();const jn=wn.attributes,Wn=Ln.getAttributes(),hn=En.defaultAttributeValues;for(const fn in Wn){const Gn=Wn[fn];if(Gn.location>=0){let Sn=jn[fn];if(Sn===void 0&&(fn==="instanceMatrix"&&Ot.instanceMatrix&&(Sn=Ot.instanceMatrix),fn==="instanceColor"&&Ot.instanceColor&&(Sn=Ot.instanceColor)),Sn!==void 0){const Hn=Sn.normalized,di=Sn.itemSize,nr=g.get(Sn);if(nr===void 0)continue;const Ci=nr.buffer,sr=nr.type,Dt=nr.bytesPerElement;if(Sn.isInterleavedBufferAttribute){const xt=Sn.data,tn=xt.stride,Qt=Sn.offset;if(xt.isInstancedInterleavedBuffer){for(let It=0;It<Gn.locationSize;It++)ze(Gn.location+It,xt.meshPerAttribute);Ot.isInstancedMesh!==!0&&wn._maxInstanceCount===void 0&&(wn._maxInstanceCount=xt.meshPerAttribute*xt.count)}else for(let It=0;It<Gn.locationSize;It++)De(Gn.location+It);ue.bindBuffer(34962,Ci);for(let It=0;It<Gn.locationSize;It++)Ve(Gn.location+It,di/Gn.locationSize,sr,Hn,tn*Dt,(Qt+di/Gn.locationSize*It)*Dt)}else{if(Sn.isInstancedBufferAttribute){for(let xt=0;xt<Gn.locationSize;xt++)ze(Gn.location+xt,Sn.meshPerAttribute);Ot.isInstancedMesh!==!0&&wn._maxInstanceCount===void 0&&(wn._maxInstanceCount=Sn.meshPerAttribute*Sn.count)}else for(let xt=0;xt<Gn.locationSize;xt++)De(Gn.location+xt);ue.bindBuffer(34962,Ci);for(let xt=0;xt<Gn.locationSize;xt++)Ve(Gn.location+xt,di/Gn.locationSize,sr,Hn,di*Dt,di/Gn.locationSize*xt*Dt)}}else if(hn!==void 0){const Hn=hn[fn];if(Hn!==void 0)switch(Hn.length){case 2:ue.vertexAttrib2fv(Gn.location,Hn);break;case 3:ue.vertexAttrib3fv(Gn.location,Hn);break;case 4:ue.vertexAttrib4fv(Gn.location,Hn);break;default:ue.vertexAttrib1fv(Gn.location,Hn)}}}}je()}(dt,ft,Bt,Lt),Wt!==null&&ue.bindBuffer(34963,g.get(Wt).buffer))},reset:$e,resetDefaultState:ct,dispose:function(){$e();for(const dt in se){const ft=se[dt];for(const Bt in ft){const Lt=ft[Bt];for(const Wt in Lt)xe(Lt[Wt].object),delete Lt[Wt];delete ft[Bt]}delete se[dt]}},releaseStatesOfGeometry:function(dt){if(se[dt.id]===void 0)return;const ft=se[dt.id];for(const Bt in ft){const Lt=ft[Bt];for(const Wt in Lt)xe(Lt[Wt].object),delete Lt[Wt];delete ft[Bt]}delete se[dt.id]},releaseStatesOfProgram:function(dt){for(const ft in se){const Bt=se[ft];if(Bt[dt.id]===void 0)continue;const Lt=Bt[dt.id];for(const Wt in Lt)xe(Lt[Wt].object),delete Lt[Wt];delete Bt[dt.id]}},initAttributes:Re,enableAttribute:De,disableUnusedAttributes:je}}function Ff(ue,o,g,j){const Y=j.isWebGL2;let ee;this.setMode=function(ie){ee=ie},this.render=function(ie,se){ue.drawArrays(ee,ie,se),g.update(se,ee,1)},this.renderInstances=function(ie,se,de){if(de===0)return;let pe,be;if(Y)pe=ue,be="drawArraysInstanced";else if(pe=o.get("ANGLE_instanced_arrays"),be="drawArraysInstancedANGLE",pe===null)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");pe[be](ee,ie,se,de),g.update(se,ee,de)}}function qw(ue,o,g){let j;function Y(ct){if(ct==="highp"){if(ue.getShaderPrecisionFormat(35633,36338).precision>0&&ue.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";ct="mediump"}return ct==="mediump"&&ue.getShaderPrecisionFormat(35633,36337).precision>0&&ue.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const ee=typeof WebGL2RenderingContext<"u"&&ue instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&ue instanceof WebGL2ComputeRenderingContext;let ie=g.precision!==void 0?g.precision:"highp";const se=Y(ie);se!==ie&&(console.warn("THREE.WebGLRenderer:",ie,"not supported, using",se,"instead."),ie=se);const de=ee||o.has("WEBGL_draw_buffers"),pe=g.logarithmicDepthBuffer===!0,be=ue.getParameter(34930),Ce=ue.getParameter(35660),xe=ue.getParameter(3379),Ie=ue.getParameter(34076),Re=ue.getParameter(34921),De=ue.getParameter(36347),ze=ue.getParameter(36348),je=ue.getParameter(36349),Ve=Ce>0,$e=ee||o.has("OES_texture_float");return{isWebGL2:ee,drawBuffers:de,getMaxAnisotropy:function(){if(j!==void 0)return j;if(o.has("EXT_texture_filter_anisotropic")===!0){const ct=o.get("EXT_texture_filter_anisotropic");j=ue.getParameter(ct.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else j=0;return j},getMaxPrecision:Y,precision:ie,logarithmicDepthBuffer:pe,maxTextures:be,maxVertexTextures:Ce,maxTextureSize:xe,maxCubemapSize:Ie,maxAttributes:Re,maxVertexUniforms:De,maxVaryings:ze,maxFragmentUniforms:je,vertexTextures:Ve,floatFragmentTextures:$e,floatVertexTextures:Ve&&$e,maxSamples:ee?ue.getParameter(36183):0}}function Yw(ue){const o=this;let g=null,j=0,Y=!1,ee=!1;const ie=new Cu,se=new go,de={value:null,needsUpdate:!1};function pe(){de.value!==g&&(de.value=g,de.needsUpdate=j>0),o.numPlanes=j,o.numIntersection=0}function be(Ce,xe,Ie,Re){const De=Ce!==null?Ce.length:0;let ze=null;if(De!==0){if(ze=de.value,Re!==!0||ze===null){const je=Ie+4*De,Ve=xe.matrixWorldInverse;se.getNormalMatrix(Ve),(ze===null||ze.length<je)&&(ze=new Float32Array(je));for(let $e=0,ct=Ie;$e!==De;++$e,ct+=4)ie.copy(Ce[$e]).applyMatrix4(Ve,se),ie.normal.toArray(ze,ct),ze[ct+3]=ie.constant}de.value=ze,de.needsUpdate=!0}return o.numPlanes=De,o.numIntersection=0,ze}this.uniform=de,this.numPlanes=0,this.numIntersection=0,this.init=function(Ce,xe,Ie){const Re=Ce.length!==0||xe||j!==0||Y;return Y=xe,g=be(Ce,Ie,0),j=Ce.length,Re},this.beginShadows=function(){ee=!0,be(null)},this.endShadows=function(){ee=!1,pe()},this.setState=function(Ce,xe,Ie){const Re=Ce.clippingPlanes,De=Ce.clipIntersection,ze=Ce.clipShadows,je=ue.get(Ce);if(!Y||Re===null||Re.length===0||ee&&!ze)ee?be(null):pe();else{const Ve=ee?0:j,$e=4*Ve;let ct=je.clippingState||null;de.value=ct,ct=be(Re,xe,$e,Ie);for(let dt=0;dt!==$e;++dt)ct[dt]=g[dt];je.clippingState=ct,this.numIntersection=De?this.numPlanes:0,this.numPlanes+=Ve}}}function Xw(ue){let o=new WeakMap;function g(Y,ee){return ee===Mr?Y.mapping=Rr:ee===Tr&&(Y.mapping=Cr),Y}function j(Y){const ee=Y.target;ee.removeEventListener("dispose",j);const ie=o.get(ee);ie!==void 0&&(o.delete(ee),ie.dispose())}return{get:function(Y){if(Y&&Y.isTexture&&Y.isRenderTargetTexture===!1){const ee=Y.mapping;if(ee===Mr||ee===Tr){if(o.has(Y)){const ie=o.get(Y).texture;return ie.rotation=Y.rotation,g(ie,Y.mapping)}{const ie=Y.image;if(ie&&ie.height>0){const se=new Eg(ie.height/2);return se.fromEquirectangularTexture(ue,Y),se.texture.rotation=Y.rotation,o.set(Y,se),Y.addEventListener("dispose",j),g(se.texture,Y.mapping)}return null}}}return Y},dispose:function(){o=new WeakMap}}}Zs.physical={uniforms:yo([Zs.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Bn(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new ci(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Bn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new ci(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new ci(1,1,1)},specularColorMap:{value:null}}]),vertexShader:fr.meshphysical_vert,fragmentShader:fr.meshphysical_frag};class Tg extends gd{constructor(o=-1,g=1,j=1,Y=-1,ee=.1,ie=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=o,this.right=g,this.top=j,this.bottom=Y,this.near=ee,this.far=ie,this.updateProjectionMatrix()}copy(o,g){return super.copy(o,g),this.left=o.left,this.right=o.right,this.top=o.top,this.bottom=o.bottom,this.near=o.near,this.far=o.far,this.zoom=o.zoom,this.view=o.view===null?null:Object.assign({},o.view),this}setViewOffset(o,g,j,Y,ee,ie){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=o,this.view.fullHeight=g,this.view.offsetX=j,this.view.offsetY=Y,this.view.width=ee,this.view.height=ie,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const o=(this.right-this.left)/(2*this.zoom),g=(this.top-this.bottom)/(2*this.zoom),j=(this.right+this.left)/2,Y=(this.top+this.bottom)/2;let ee=j-o,ie=j+o,se=Y+g,de=Y-g;if(this.view!==null&&this.view.enabled){const pe=(this.right-this.left)/this.view.fullWidth/this.zoom,be=(this.top-this.bottom)/this.view.fullHeight/this.zoom;ee+=pe*this.view.offsetX,ie=ee+pe*this.view.width,se-=be*this.view.offsetY,de=se-be*this.view.height}this.projectionMatrix.makeOrthographic(ee,ie,se,de,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(o){const g=super.toJSON(o);return g.object.zoom=this.zoom,g.object.left=this.left,g.object.right=this.right,g.object.top=this.top,g.object.bottom=this.bottom,g.object.near=this.near,g.object.far=this.far,this.view!==null&&(g.object.view=Object.assign({},this.view)),g}}const Dv=[.125,.215,.35,.446,.526,.582],Ig=new Tg,TA=new ci;let Pv=null;const vd=(1+Math.sqrt(5))/2,Mp=1/vd,Rv=[new vt(1,1,1),new vt(-1,1,1),new vt(1,1,-1),new vt(-1,1,-1),new vt(0,vd,Mp),new vt(0,vd,-Mp),new vt(Mp,0,vd),new vt(-Mp,0,vd),new vt(vd,Mp,0),new vt(-vd,Mp,0)];class jf{constructor(o){this._renderer=o,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(o,g=0,j=.1,Y=100){Pv=this._renderer.getRenderTarget(),this._setSize(256);const ee=this._allocateTargets();return ee.depthBuffer=!0,this._sceneToCubeUV(o,j,Y,ee),g>0&&this._blur(ee,0,0,g),this._applyPMREM(ee),this._cleanup(ee),ee}fromEquirectangular(o,g=null){return this._fromTexture(o,g)}fromCubemap(o,g=null){return this._fromTexture(o,g)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Ov(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=kv(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(o){this._lodMax=Math.floor(Math.log2(o)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let o=0;o<this._lodPlanes.length;o++)this._lodPlanes[o].dispose()}_cleanup(o){this._renderer.setRenderTarget(Pv),o.scissorTest=!1,Ad(o,0,0,o.width,o.height)}_fromTexture(o,g){o.mapping===Rr||o.mapping===Cr?this._setSize(o.image.length===0?16:o.image[0].width||o.image[0].image.width):this._setSize(o.image.width/4),Pv=this._renderer.getRenderTarget();const j=g||this._allocateTargets();return this._textureToCubeUV(o,j),this._applyPMREM(j),this._cleanup(j),j}_allocateTargets(){const o=3*Math.max(this._cubeSize,112),g=4*this._cubeSize,j={magFilter:Ur,minFilter:Ur,generateMipmaps:!1,type:To,format:Ii,encoding:na,depthBuffer:!1},Y=Bv(o,g,j);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==o){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Bv(o,g,j);const{_lodMax:ee}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(ie){const se=[],de=[],pe=[];let be=ie;const Ce=ie-4+1+Dv.length;for(let xe=0;xe<Ce;xe++){const Ie=Math.pow(2,be);de.push(Ie);let Re=1/Ie;xe>ie-4?Re=Dv[xe-ie+4-1]:xe===0&&(Re=0),pe.push(Re);const De=1/(Ie-2),ze=-De,je=1+De,Ve=[ze,ze,je,ze,je,je,ze,ze,je,je,ze,je],$e=6,ct=6,dt=3,ft=2,Bt=1,Lt=new Float32Array(dt*ct*$e),Wt=new Float32Array(ft*ct*$e),qt=new Float32Array(Bt*ct*$e);for(let En=0;En<$e;En++){const Ln=En%3*2/3-1,wn=En>2?0:-1,jn=[Ln,wn,0,Ln+2/3,wn,0,Ln+2/3,wn+1,0,Ln,wn,0,Ln+2/3,wn+1,0,Ln,wn+1,0];Lt.set(jn,dt*ct*En),Wt.set(Ve,ft*ct*En);const Wn=[En,En,En,En,En,En];qt.set(Wn,Bt*ct*En)}const Ot=new yi;Ot.setAttribute("position",new is(Lt,dt)),Ot.setAttribute("uv",new is(Wt,ft)),Ot.setAttribute("faceIndex",new is(qt,Bt)),se.push(Ot),be>4&&be--}return{lodPlanes:se,sizeLods:de,sigmas:pe}}(ee)),this._blurMaterial=function(ie,se,de){const pe=new Float32Array(20),be=new vt(0,1,0);return new El({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/se,CUBEUV_TEXEL_HEIGHT:1/de,CUBEUV_MAX_MIP:`${ie}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:pe},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:be}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:He,depthTest:!1,depthWrite:!1})}(ee,o,g)}return Y}_compileMaterial(o){const g=new lo(this._lodPlanes[0],o);this._renderer.compile(g,Ig)}_sceneToCubeUV(o,g,j,Y){const ee=new ko(90,1,g,j),ie=[1,-1,1,1,1,1],se=[1,1,1,-1,-1,-1],de=this._renderer,pe=de.autoClear,be=de.toneMapping;de.getClearColor(TA),de.toneMapping=Li,de.autoClear=!1;const Ce=new wl({name:"PMREM.Background",side:Ue,depthWrite:!1,depthTest:!1}),xe=new lo(new Eu,Ce);let Ie=!1;const Re=o.background;Re?Re.isColor&&(Ce.color.copy(Re),o.background=null,Ie=!0):(Ce.color.copy(TA),Ie=!0);for(let De=0;De<6;De++){const ze=De%3;ze===0?(ee.up.set(0,ie[De],0),ee.lookAt(se[De],0,0)):ze===1?(ee.up.set(0,0,ie[De]),ee.lookAt(0,se[De],0)):(ee.up.set(0,ie[De],0),ee.lookAt(0,0,se[De]));const je=this._cubeSize;Ad(Y,ze*je,De>2?je:0,je,je),de.setRenderTarget(Y),Ie&&de.render(xe,ee),de.render(o,ee)}xe.geometry.dispose(),xe.material.dispose(),de.toneMapping=be,de.autoClear=pe,o.background=Re}_textureToCubeUV(o,g){const j=this._renderer,Y=o.mapping===Rr||o.mapping===Cr;Y?(this._cubemapMaterial===null&&(this._cubemapMaterial=Ov()),this._cubemapMaterial.uniforms.flipEnvMap.value=o.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=kv());const ee=Y?this._cubemapMaterial:this._equirectMaterial,ie=new lo(this._lodPlanes[0],ee);ee.uniforms.envMap.value=o;const se=this._cubeSize;Ad(g,0,0,3*se,2*se),j.setRenderTarget(g),j.render(ie,Ig)}_applyPMREM(o){const g=this._renderer,j=g.autoClear;g.autoClear=!1;for(let Y=1;Y<this._lodPlanes.length;Y++){const ee=Math.sqrt(this._sigmas[Y]*this._sigmas[Y]-this._sigmas[Y-1]*this._sigmas[Y-1]),ie=Rv[(Y-1)%Rv.length];this._blur(o,Y-1,Y,ee,ie)}g.autoClear=j}_blur(o,g,j,Y,ee){const ie=this._pingPongRenderTarget;this._halfBlur(o,ie,g,j,Y,"latitudinal",ee),this._halfBlur(ie,o,j,j,Y,"longitudinal",ee)}_halfBlur(o,g,j,Y,ee,ie,se){const de=this._renderer,pe=this._blurMaterial;ie!=="latitudinal"&&ie!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const be=new lo(this._lodPlanes[Y],pe),Ce=pe.uniforms,xe=this._sizeLods[j]-1,Ie=isFinite(ee)?Math.PI/(2*xe):2*Math.PI/39,Re=ee/Ie,De=isFinite(ee)?1+Math.floor(3*Re):20;De>20&&console.warn(`sigmaRadians, ${ee}, is too large and will clip, as it requested ${De} samples when the maximum is set to 20`);const ze=[];let je=0;for(let ct=0;ct<20;++ct){const dt=ct/Re,ft=Math.exp(-dt*dt/2);ze.push(ft),ct===0?je+=ft:ct<De&&(je+=2*ft)}for(let ct=0;ct<ze.length;ct++)ze[ct]=ze[ct]/je;Ce.envMap.value=o.texture,Ce.samples.value=De,Ce.weights.value=ze,Ce.latitudinal.value=ie==="latitudinal",se&&(Ce.poleAxis.value=se);const{_lodMax:Ve}=this;Ce.dTheta.value=Ie,Ce.mipInt.value=Ve-j;const $e=this._sizeLods[Y];Ad(g,3*$e*(Y>Ve-4?Y-Ve+4:0),4*(this._cubeSize-$e),3*$e,2*$e),de.setRenderTarget(g),de.render(be,Ig)}}function Bv(ue,o,g){const j=new Aa(ue,o,g);return j.texture.mapping=Is,j.texture.name="PMREM.cubeUv",j.scissorTest=!0,j}function Ad(ue,o,g,j,Y){ue.viewport.set(o,g,j,Y),ue.scissor.set(o,g,j,Y)}function kv(){return new El({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:He,depthTest:!1,depthWrite:!1})}function Ov(){return new El({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:He,depthTest:!1,depthWrite:!1})}function IA(ue){let o=new WeakMap,g=null;function j(Y){const ee=Y.target;ee.removeEventListener("dispose",j);const ie=o.get(ee);ie!==void 0&&(o.delete(ee),ie.dispose())}return{get:function(Y){if(Y&&Y.isTexture){const ee=Y.mapping,ie=ee===Mr||ee===Tr,se=ee===Rr||ee===Cr;if(ie||se){if(Y.isRenderTargetTexture&&Y.needsPMREMUpdate===!0){Y.needsPMREMUpdate=!1;let de=o.get(Y);return g===null&&(g=new jf(ue)),de=ie?g.fromEquirectangular(Y,de):g.fromCubemap(Y,de),o.set(Y,de),de.texture}if(o.has(Y))return o.get(Y).texture;{const de=Y.image;if(ie&&de&&de.height>0||se&&de&&function(pe){let be=0;for(let Ce=0;Ce<6;Ce++)pe[Ce]!==void 0&&be++;return be===6}(de)){g===null&&(g=new jf(ue));const pe=ie?g.fromEquirectangular(Y):g.fromCubemap(Y);return o.set(Y,pe),Y.addEventListener("dispose",j),pe.texture}return null}}}return Y},dispose:function(){o=new WeakMap,g!==null&&(g.dispose(),g=null)}}}function Kw(ue){const o={};function g(j){if(o[j]!==void 0)return o[j];let Y;switch(j){case"WEBGL_depth_texture":Y=ue.getExtension("WEBGL_depth_texture")||ue.getExtension("MOZ_WEBGL_depth_texture")||ue.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":Y=ue.getExtension("EXT_texture_filter_anisotropic")||ue.getExtension("MOZ_EXT_texture_filter_anisotropic")||ue.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":Y=ue.getExtension("WEBGL_compressed_texture_s3tc")||ue.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||ue.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":Y=ue.getExtension("WEBGL_compressed_texture_pvrtc")||ue.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:Y=ue.getExtension(j)}return o[j]=Y,Y}return{has:function(j){return g(j)!==null},init:function(j){j.isWebGL2?g("EXT_color_buffer_float"):(g("WEBGL_depth_texture"),g("OES_texture_float"),g("OES_texture_half_float"),g("OES_texture_half_float_linear"),g("OES_standard_derivatives"),g("OES_element_index_uint"),g("OES_vertex_array_object"),g("ANGLE_instanced_arrays")),g("OES_texture_float_linear"),g("EXT_color_buffer_half_float"),g("WEBGL_multisampled_render_to_texture")},get:function(j){const Y=g(j);return Y===null&&console.warn("THREE.WebGLRenderer: "+j+" extension not supported."),Y}}}function Jw(ue,o,g,j){const Y={},ee=new WeakMap;function ie(de){const pe=de.target;pe.index!==null&&o.remove(pe.index);for(const Ce in pe.attributes)o.remove(pe.attributes[Ce]);pe.removeEventListener("dispose",ie),delete Y[pe.id];const be=ee.get(pe);be&&(o.remove(be),ee.delete(pe)),j.releaseStatesOfGeometry(pe),pe.isInstancedBufferGeometry===!0&&delete pe._maxInstanceCount,g.memory.geometries--}function se(de){const pe=[],be=de.index,Ce=de.attributes.position;let xe=0;if(be!==null){const De=be.array;xe=be.version;for(let ze=0,je=De.length;ze<je;ze+=3){const Ve=De[ze+0],$e=De[ze+1],ct=De[ze+2];pe.push(Ve,$e,$e,ct,ct,Ve)}}else{const De=Ce.array;xe=Ce.version;for(let ze=0,je=De.length/3-1;ze<je;ze+=3){const Ve=ze+0,$e=ze+1,ct=ze+2;pe.push(Ve,$e,$e,ct,ct,Ve)}}const Ie=new(fg(pe)?_e:ph)(pe,1);Ie.version=xe;const Re=ee.get(de);Re&&o.remove(Re),ee.set(de,Ie)}return{get:function(de,pe){return Y[pe.id]===!0||(pe.addEventListener("dispose",ie),Y[pe.id]=!0,g.memory.geometries++),pe},update:function(de){const pe=de.attributes;for(const Ce in pe)o.update(pe[Ce],34962);const be=de.morphAttributes;for(const Ce in be){const xe=be[Ce];for(let Ie=0,Re=xe.length;Ie<Re;Ie++)o.update(xe[Ie],34962)}},getWireframeAttribute:function(de){const pe=ee.get(de);if(pe){const be=de.index;be!==null&&pe.version<be.version&&se(de)}else se(de);return ee.get(de)}}}function yr(ue,o,g,j){const Y=j.isWebGL2;let ee,ie,se;this.setMode=function(de){ee=de},this.setIndex=function(de){ie=de.type,se=de.bytesPerElement},this.render=function(de,pe){ue.drawElements(ee,pe,ie,de*se),g.update(pe,ee,1)},this.renderInstances=function(de,pe,be){if(be===0)return;let Ce,xe;if(Y)Ce=ue,xe="drawElementsInstanced";else if(Ce=o.get("ANGLE_instanced_arrays"),xe="drawElementsInstancedANGLE",Ce===null)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");Ce[xe](ee,pe,ie,de*se,be),g.update(pe,ee,be)}}function Lv(ue){const o={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:o,programs:null,autoReset:!0,reset:function(){o.frame++,o.calls=0,o.triangles=0,o.points=0,o.lines=0},update:function(g,j,Y){switch(o.calls++,j){case 4:o.triangles+=Y*(g/3);break;case 1:o.lines+=Y*(g/2);break;case 3:o.lines+=Y*(g-1);break;case 2:o.lines+=Y*g;break;case 0:o.points+=Y*g;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",j)}}}}function DA(ue,o){return ue[0]-o[0]}function PA(ue,o){return Math.abs(o[1])-Math.abs(ue[1])}function Kn(ue,o,g){const j={},Y=new Float32Array(8),ee=new WeakMap,ie=new Vr,se=[];for(let de=0;de<8;de++)se[de]=[de,0];return{update:function(de,pe,be,Ce){const xe=de.morphTargetInfluences;if(o.isWebGL2===!0){const Ie=pe.morphAttributes.position||pe.morphAttributes.normal||pe.morphAttributes.color,Re=Ie!==void 0?Ie.length:0;let De=ee.get(pe);if(De===void 0||De.count!==Re){De!==void 0&&De.texture.dispose();const Ve=pe.morphAttributes.position!==void 0,$e=pe.morphAttributes.normal!==void 0,ct=pe.morphAttributes.color!==void 0,dt=pe.morphAttributes.position||[],ft=pe.morphAttributes.normal||[],Bt=pe.morphAttributes.color||[];let Lt=0;Ve===!0&&(Lt=1),$e===!0&&(Lt=2),ct===!0&&(Lt=3);let Wt=pe.attributes.position.count*Lt,qt=1;Wt>o.maxTextureSize&&(qt=Math.ceil(Wt/o.maxTextureSize),Wt=o.maxTextureSize);const Ot=new Float32Array(Wt*qt*4*Re),En=new lh(Ot,Wt,qt,Re);En.type=Zr,En.needsUpdate=!0;const Ln=4*Lt;for(let wn=0;wn<Re;wn++){const jn=dt[wn],Wn=ft[wn],hn=Bt[wn],fn=Wt*qt*4*wn;for(let Gn=0;Gn<jn.count;Gn++){const Sn=Gn*Ln;Ve===!0&&(ie.fromBufferAttribute(jn,Gn),Ot[fn+Sn+0]=ie.x,Ot[fn+Sn+1]=ie.y,Ot[fn+Sn+2]=ie.z,Ot[fn+Sn+3]=0),$e===!0&&(ie.fromBufferAttribute(Wn,Gn),Ot[fn+Sn+4]=ie.x,Ot[fn+Sn+5]=ie.y,Ot[fn+Sn+6]=ie.z,Ot[fn+Sn+7]=0),ct===!0&&(ie.fromBufferAttribute(hn,Gn),Ot[fn+Sn+8]=ie.x,Ot[fn+Sn+9]=ie.y,Ot[fn+Sn+10]=ie.z,Ot[fn+Sn+11]=hn.itemSize===4?ie.w:1)}}De={count:Re,texture:En,size:new Bn(Wt,qt)},ee.set(pe,De),pe.addEventListener("dispose",function wn(){En.dispose(),ee.delete(pe),pe.removeEventListener("dispose",wn)})}let ze=0;for(let Ve=0;Ve<xe.length;Ve++)ze+=xe[Ve];const je=pe.morphTargetsRelative?1:1-ze;Ce.getUniforms().setValue(ue,"morphTargetBaseInfluence",je),Ce.getUniforms().setValue(ue,"morphTargetInfluences",xe),Ce.getUniforms().setValue(ue,"morphTargetsTexture",De.texture,g),Ce.getUniforms().setValue(ue,"morphTargetsTextureSize",De.size)}else{const Ie=xe===void 0?0:xe.length;let Re=j[pe.id];if(Re===void 0||Re.length!==Ie){Re=[];for(let $e=0;$e<Ie;$e++)Re[$e]=[$e,0];j[pe.id]=Re}for(let $e=0;$e<Ie;$e++){const ct=Re[$e];ct[0]=$e,ct[1]=xe[$e]}Re.sort(PA);for(let $e=0;$e<8;$e++)$e<Ie&&Re[$e][1]?(se[$e][0]=Re[$e][0],se[$e][1]=Re[$e][1]):(se[$e][0]=Number.MAX_SAFE_INTEGER,se[$e][1]=0);se.sort(DA);const De=pe.morphAttributes.position,ze=pe.morphAttributes.normal;let je=0;for(let $e=0;$e<8;$e++){const ct=se[$e],dt=ct[0],ft=ct[1];dt!==Number.MAX_SAFE_INTEGER&&ft?(De&&pe.getAttribute("morphTarget"+$e)!==De[dt]&&pe.setAttribute("morphTarget"+$e,De[dt]),ze&&pe.getAttribute("morphNormal"+$e)!==ze[dt]&&pe.setAttribute("morphNormal"+$e,ze[dt]),Y[$e]=ft,je+=ft):(De&&pe.hasAttribute("morphTarget"+$e)===!0&&pe.deleteAttribute("morphTarget"+$e),ze&&pe.hasAttribute("morphNormal"+$e)===!0&&pe.deleteAttribute("morphNormal"+$e),Y[$e]=0)}const Ve=pe.morphTargetsRelative?1:1-je;Ce.getUniforms().setValue(ue,"morphTargetBaseInfluence",Ve),Ce.getUniforms().setValue(ue,"morphTargetInfluences",Y)}}}}function Xi(ue,o,g,j){let Y=new WeakMap;function ee(ie){const se=ie.target;se.removeEventListener("dispose",ee),g.remove(se.instanceMatrix),se.instanceColor!==null&&g.remove(se.instanceColor)}return{update:function(ie){const se=j.render.frame,de=ie.geometry,pe=o.get(ie,de);return Y.get(pe)!==se&&(o.update(pe),Y.set(pe,se)),ie.isInstancedMesh&&(ie.hasEventListener("dispose",ee)===!1&&ie.addEventListener("dispose",ee),g.update(ie.instanceMatrix,34962),ie.instanceColor!==null&&g.update(ie.instanceColor,34962)),pe},dispose:function(){Y=new WeakMap}}}const yd=new vs,Sl=new lh,Dg=new ch,Pg=new Uf,Nv=[],Or=[],RA=new Float32Array(16),Uv=new Float32Array(9),Fv=new Float32Array(4);function bd(ue,o,g){const j=ue[0];if(j<=0||j>0)return ue;const Y=o*g;let ee=Nv[Y];if(ee===void 0&&(ee=new Float32Array(Y),Nv[Y]=ee),o!==0){j.toArray(ee,0);for(let ie=1,se=0;ie!==o;++ie)se+=g,ue[ie].toArray(ee,se)}return ee}function Ca(ue,o){if(ue.length!==o.length)return!1;for(let g=0,j=ue.length;g<j;g++)if(ue[g]!==o[g])return!1;return!0}function Qo(ue,o){for(let g=0,j=o.length;g<j;g++)ue[g]=o[g]}function zf(ue,o){let g=Or[o];g===void 0&&(g=new Int32Array(o),Or[o]=g);for(let j=0;j!==o;++j)g[j]=ue.allocateTextureUnit();return g}function Zl(ue,o){const g=this.cache;g[0]!==o&&(ue.uniform1f(this.addr,o),g[0]=o)}function Vc(ue,o){const g=this.cache;if(o.x!==void 0)g[0]===o.x&&g[1]===o.y||(ue.uniform2f(this.addr,o.x,o.y),g[0]=o.x,g[1]=o.y);else{if(Ca(g,o))return;ue.uniform2fv(this.addr,o),Qo(g,o)}}function $w(ue,o){const g=this.cache;if(o.x!==void 0)g[0]===o.x&&g[1]===o.y&&g[2]===o.z||(ue.uniform3f(this.addr,o.x,o.y,o.z),g[0]=o.x,g[1]=o.y,g[2]=o.z);else if(o.r!==void 0)g[0]===o.r&&g[1]===o.g&&g[2]===o.b||(ue.uniform3f(this.addr,o.r,o.g,o.b),g[0]=o.r,g[1]=o.g,g[2]=o.b);else{if(Ca(g,o))return;ue.uniform3fv(this.addr,o),Qo(g,o)}}function Rg(ue,o){const g=this.cache;if(o.x!==void 0)g[0]===o.x&&g[1]===o.y&&g[2]===o.z&&g[3]===o.w||(ue.uniform4f(this.addr,o.x,o.y,o.z,o.w),g[0]=o.x,g[1]=o.y,g[2]=o.z,g[3]=o.w);else{if(Ca(g,o))return;ue.uniform4fv(this.addr,o),Qo(g,o)}}function Mu(ue,o){const g=this.cache,j=o.elements;if(j===void 0){if(Ca(g,o))return;ue.uniformMatrix2fv(this.addr,!1,o),Qo(g,o)}else{if(Ca(g,j))return;Fv.set(j),ue.uniformMatrix2fv(this.addr,!1,Fv),Qo(g,j)}}function BA(ue,o){const g=this.cache,j=o.elements;if(j===void 0){if(Ca(g,o))return;ue.uniformMatrix3fv(this.addr,!1,o),Qo(g,o)}else{if(Ca(g,j))return;Uv.set(j),ue.uniformMatrix3fv(this.addr,!1,Uv),Qo(g,j)}}function Vf(ue,o){const g=this.cache,j=o.elements;if(j===void 0){if(Ca(g,o))return;ue.uniformMatrix4fv(this.addr,!1,o),Qo(g,o)}else{if(Ca(g,j))return;RA.set(j),ue.uniformMatrix4fv(this.addr,!1,RA),Qo(g,j)}}function jv(ue,o){const g=this.cache;g[0]!==o&&(ue.uniform1i(this.addr,o),g[0]=o)}function Gf(ue,o){const g=this.cache;Ca(g,o)||(ue.uniform2iv(this.addr,o),Qo(g,o))}function kA(ue,o){const g=this.cache;Ca(g,o)||(ue.uniform3iv(this.addr,o),Qo(g,o))}function zv(ue,o){const g=this.cache;Ca(g,o)||(ue.uniform4iv(this.addr,o),Qo(g,o))}function Ho(ue,o){const g=this.cache;g[0]!==o&&(ue.uniform1ui(this.addr,o),g[0]=o)}function ec(ue,o){const g=this.cache;Ca(g,o)||(ue.uniform2uiv(this.addr,o),Qo(g,o))}function Qf(ue,o){const g=this.cache;Ca(g,o)||(ue.uniform3uiv(this.addr,o),Qo(g,o))}function Bg(ue,o){const g=this.cache;Ca(g,o)||(ue.uniform4uiv(this.addr,o),Qo(g,o))}function tc(ue,o,g){const j=this.cache,Y=g.allocateTextureUnit();j[0]!==Y&&(ue.uniform1i(this.addr,Y),j[0]=Y),g.setTexture2D(o||yd,Y)}function Vv(ue,o,g){const j=this.cache,Y=g.allocateTextureUnit();j[0]!==Y&&(ue.uniform1i(this.addr,Y),j[0]=Y),g.setTexture3D(o||Dg,Y)}function kg(ue,o,g){const j=this.cache,Y=g.allocateTextureUnit();j[0]!==Y&&(ue.uniform1i(this.addr,Y),j[0]=Y),g.setTextureCube(o||Pg,Y)}function OA(ue,o,g){const j=this.cache,Y=g.allocateTextureUnit();j[0]!==Y&&(ue.uniform1i(this.addr,Y),j[0]=Y),g.setTexture2DArray(o||Sl,Y)}function Og(ue,o){ue.uniform1fv(this.addr,o)}function nc(ue,o){const g=bd(o,this.size,2);ue.uniform2fv(this.addr,g)}function Ja(ue,o){const g=bd(o,this.size,3);ue.uniform3fv(this.addr,g)}function Lg(ue,o){const g=bd(o,this.size,4);ue.uniform4fv(this.addr,g)}function LA(ue,o){const g=bd(o,this.size,4);ue.uniformMatrix2fv(this.addr,!1,g)}function Ng(ue,o){const g=bd(o,this.size,9);ue.uniformMatrix3fv(this.addr,!1,g)}function NA(ue,o){const g=bd(o,this.size,16);ue.uniformMatrix4fv(this.addr,!1,g)}function Gv(ue,o){ue.uniform1iv(this.addr,o)}function Ug(ue,o){ue.uniform2iv(this.addr,o)}function UA(ue,o){ue.uniform3iv(this.addr,o)}function FA(ue,o){ue.uniform4iv(this.addr,o)}function Zw(ue,o){ue.uniform1uiv(this.addr,o)}function jA(ue,o){ue.uniform2uiv(this.addr,o)}function zA(ue,o){ue.uniform3uiv(this.addr,o)}function VA(ue,o){ue.uniform4uiv(this.addr,o)}function ja(ue,o,g){const j=o.length,Y=zf(g,j);ue.uniform1iv(this.addr,Y);for(let ee=0;ee!==j;++ee)g.setTexture2D(o[ee]||yd,Y[ee])}function hs(ue,o,g){const j=o.length,Y=zf(g,j);ue.uniform1iv(this.addr,Y);for(let ee=0;ee!==j;++ee)g.setTexture3D(o[ee]||Dg,Y[ee])}function GA(ue,o,g){const j=o.length,Y=zf(g,j);ue.uniform1iv(this.addr,Y);for(let ee=0;ee!==j;++ee)g.setTextureCube(o[ee]||Pg,Y[ee])}function wd(ue,o,g){const j=o.length,Y=zf(g,j);ue.uniform1iv(this.addr,Y);for(let ee=0;ee!==j;++ee)g.setTexture2DArray(o[ee]||Sl,Y[ee])}class za{constructor(o,g,j){this.id=o,this.addr=j,this.cache=[],this.setValue=function(Y){switch(Y){case 5126:return Zl;case 35664:return Vc;case 35665:return $w;case 35666:return Rg;case 35674:return Mu;case 35675:return BA;case 35676:return Vf;case 5124:case 35670:return jv;case 35667:case 35671:return Gf;case 35668:case 35672:return kA;case 35669:case 35673:return zv;case 5125:return Ho;case 36294:return ec;case 36295:return Qf;case 36296:return Bg;case 35678:case 36198:case 36298:case 36306:case 35682:return tc;case 35679:case 36299:case 36307:return Vv;case 35680:case 36300:case 36308:case 36293:return kg;case 36289:case 36303:case 36311:case 36292:return OA}}(g.type)}}class mh{constructor(o,g,j){this.id=o,this.addr=j,this.cache=[],this.size=g.size,this.setValue=function(Y){switch(Y){case 5126:return Og;case 35664:return nc;case 35665:return Ja;case 35666:return Lg;case 35674:return LA;case 35675:return Ng;case 35676:return NA;case 5124:case 35670:return Gv;case 35667:case 35671:return Ug;case 35668:case 35672:return UA;case 35669:case 35673:return FA;case 5125:return Zw;case 36294:return jA;case 36295:return zA;case 36296:return VA;case 35678:case 36198:case 36298:case 36306:case 35682:return ja;case 35679:case 36299:case 36307:return hs;case 35680:case 36300:case 36308:case 36293:return GA;case 36289:case 36303:case 36311:case 36292:return wd}}(g.type)}}class ks{constructor(o){this.id=o,this.seq=[],this.map={}}setValue(o,g,j){const Y=this.seq;for(let ee=0,ie=Y.length;ee!==ie;++ee){const se=Y[ee];se.setValue(o,g[se.id],j)}}}const Fg=/(\w+)(\])?(\[|\.)?/g;function jg(ue,o){ue.seq.push(o),ue.map[o.id]=o}function QA(ue,o,g){const j=ue.name,Y=j.length;for(Fg.lastIndex=0;;){const ee=Fg.exec(j),ie=Fg.lastIndex;let se=ee[1];const de=ee[2]==="]",pe=ee[3];if(de&&(se|=0),pe===void 0||pe==="["&&ie+2===Y){jg(g,pe===void 0?new za(se,ue,o):new mh(se,ue,o));break}{let be=g.map[se];be===void 0&&(be=new ks(se),jg(g,be)),g=be}}}class Hf{constructor(o,g){this.seq=[],this.map={};const j=o.getProgramParameter(g,35718);for(let Y=0;Y<j;++Y){const ee=o.getActiveUniform(g,Y);QA(ee,o.getUniformLocation(g,ee.name),this)}}setValue(o,g,j,Y){const ee=this.map[g];ee!==void 0&&ee.setValue(o,j,Y)}setOptional(o,g,j){const Y=g[j];Y!==void 0&&this.setValue(o,j,Y)}static upload(o,g,j,Y){for(let ee=0,ie=g.length;ee!==ie;++ee){const se=g[ee],de=j[se.id];de.needsUpdate!==!1&&se.setValue(o,de.value,Y)}}static seqWithValue(o,g){const j=[];for(let Y=0,ee=o.length;Y!==ee;++Y){const ie=o[Y];ie.id in g&&j.push(ie)}return j}}function Qv(ue,o,g){const j=ue.createShader(o);return ue.shaderSource(j,g),ue.compileShader(j),j}let ex=0;function HA(ue){switch(ue){case na:return["Linear","( value )"];case cs:return["sRGB","( value )"];case Mc:return["RGBM","( value, 16.0 )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",ue),["Linear","( value )"]}}function WA(ue,o,g){const j=ue.getShaderParameter(o,35713),Y=ue.getShaderInfoLog(o).trim();if(j&&Y==="")return"";const ee=/ERROR: 0:(\d+)/.exec(Y);if(ee){const ie=parseInt(ee[1]);return g.toUpperCase()+`

`+Y+`

`+function(se,de){const pe=se.split(`
`),be=[],Ce=Math.max(de-6,0),xe=Math.min(de+6,pe.length);for(let Ie=Ce;Ie<xe;Ie++){const Re=Ie+1;be.push(`${Re===de?">":" "} ${Re}: ${pe[Ie]}`)}return be.join(`
`)}(ue.getShaderSource(o),ie)}return Y}function tx(ue,o){const g=HA(o);return"vec4 "+ue+"( vec4 value ) { return "+g[0]+"ToLinear"+g[1]+"; }"}function nx(ue,o){const g=HA(o);return"vec4 "+ue+"( vec4 value ) { return LinearTo"+g[0]+g[1]+"; }"}function ix(ue,o){let g;switch(o){case dr:g="Linear";break;case Ri:g="Reinhard";break;case $t:g="OptimizedCineon";break;case ir:g="ACESFilmic";break;case or:g="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",o),g="Linear"}return"vec3 "+ue+"( vec3 color ) { return "+g+"ToneMapping( color ); }"}function xd(ue){return ue!==""}function Wf(ue,o){const g=o.numSpotLightShadows+o.numSpotLightMaps-o.numSpotLightShadowsWithMaps;return ue.replace(/NUM_DIR_LIGHTS/g,o.numDirLights).replace(/NUM_SPOT_LIGHTS/g,o.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,o.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,g).replace(/NUM_RECT_AREA_LIGHTS/g,o.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,o.numPointLights).replace(/NUM_HEMI_LIGHTS/g,o.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,o.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,o.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,o.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,o.numPointLightShadows)}function ds(ue,o){return ue.replace(/NUM_CLIPPING_PLANES/g,o.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,o.numClippingPlanes-o.numClipIntersection)}const qA=/^[ \t]*#include +<([\w\d./]+)>/gm;function zg(ue){return ue.replace(qA,Vg)}function Vg(ue,o){const g=fr[o];if(g===void 0)throw new Error("Can not resolve #include <"+o+">");return zg(g)}const Gg=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function ic(ue){return ue.replace(Gg,YA)}function YA(ue,o,g,j){let Y="";for(let ee=parseInt(o);ee<parseInt(g);ee++)Y+=j.replace(/\[\s*i\s*\]/g,"[ "+ee+" ]").replace(/UNROLLED_LOOP_INDEX/g,ee);return Y}function Tp(ue){let o="precision "+ue.precision+` float;
precision `+ue.precision+" int;";return ue.precision==="highp"?o+=`
#define HIGH_PRECISION`:ue.precision==="mediump"?o+=`
#define MEDIUM_PRECISION`:ue.precision==="lowp"&&(o+=`
#define LOW_PRECISION`),o}function Ed(ue,o,g,j){const Y=ue.getContext(),ee=g.defines;let ie=g.vertexShader,se=g.fragmentShader;const de=function(Lt){let Wt="SHADOWMAP_TYPE_BASIC";return Lt.shadowMapType===tt?Wt="SHADOWMAP_TYPE_PCF":Lt.shadowMapType===Ke?Wt="SHADOWMAP_TYPE_PCF_SOFT":Lt.shadowMapType===Ge&&(Wt="SHADOWMAP_TYPE_VSM"),Wt}(g),pe=function(Lt){let Wt="ENVMAP_TYPE_CUBE";if(Lt.envMap)switch(Lt.envMapMode){case Rr:case Cr:Wt="ENVMAP_TYPE_CUBE";break;case Is:Wt="ENVMAP_TYPE_CUBE_UV"}return Wt}(g),be=function(Lt){let Wt="ENVMAP_MODE_REFLECTION";return Lt.envMap&&Lt.envMapMode===Cr&&(Wt="ENVMAP_MODE_REFRACTION"),Wt}(g),Ce=function(Lt){let Wt="ENVMAP_BLENDING_NONE";if(Lt.envMap)switch(Lt.combine){case hi:Wt="ENVMAP_BLENDING_MULTIPLY";break;case $n:Wt="ENVMAP_BLENDING_MIX";break;case ji:Wt="ENVMAP_BLENDING_ADD"}return Wt}(g),xe=function(Lt){const Wt=Lt.envMapCubeUVHeight;if(Wt===null)return null;const qt=Math.log2(Wt)-2,Ot=1/Wt;return{texelWidth:1/(3*Math.max(Math.pow(2,qt),112)),texelHeight:Ot,maxMip:qt}}(g),Ie=g.isWebGL2?"":function(Lt){return[Lt.extensionDerivatives||Lt.envMapCubeUVHeight||Lt.bumpMap||Lt.tangentSpaceNormalMap||Lt.clearcoatNormalMap||Lt.flatShading||Lt.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(Lt.extensionFragDepth||Lt.logarithmicDepthBuffer)&&Lt.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",Lt.extensionDrawBuffers&&Lt.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(Lt.extensionShaderTextureLOD||Lt.envMap||Lt.transmission)&&Lt.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(xd).join(`
`)}(g),Re=function(Lt){const Wt=[];for(const qt in Lt){const Ot=Lt[qt];Ot!==!1&&Wt.push("#define "+qt+" "+Ot)}return Wt.join(`
`)}(ee),De=Y.createProgram();let ze,je,Ve=g.glslVersion?"#version "+g.glslVersion+`
`:"";g.isRawShaderMaterial?(ze=[Re].filter(xd).join(`
`),ze.length>0&&(ze+=`
`),je=[Ie,Re].filter(xd).join(`
`),je.length>0&&(je+=`
`)):(ze=[Tp(g),"#define SHADER_NAME "+g.shaderName,Re,g.instancing?"#define USE_INSTANCING":"",g.instancingColor?"#define USE_INSTANCING_COLOR":"",g.supportsVertexTextures?"#define VERTEX_TEXTURES":"",g.useFog&&g.fog?"#define USE_FOG":"",g.useFog&&g.fogExp2?"#define FOG_EXP2":"",g.map?"#define USE_MAP":"",g.envMap?"#define USE_ENVMAP":"",g.envMap?"#define "+be:"",g.lightMap?"#define USE_LIGHTMAP":"",g.aoMap?"#define USE_AOMAP":"",g.emissiveMap?"#define USE_EMISSIVEMAP":"",g.bumpMap?"#define USE_BUMPMAP":"",g.normalMap?"#define USE_NORMALMAP":"",g.normalMap&&g.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",g.normalMap&&g.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",g.clearcoatMap?"#define USE_CLEARCOATMAP":"",g.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",g.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",g.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",g.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",g.displacementMap&&g.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",g.specularMap?"#define USE_SPECULARMAP":"",g.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",g.specularColorMap?"#define USE_SPECULARCOLORMAP":"",g.roughnessMap?"#define USE_ROUGHNESSMAP":"",g.metalnessMap?"#define USE_METALNESSMAP":"",g.alphaMap?"#define USE_ALPHAMAP":"",g.transmission?"#define USE_TRANSMISSION":"",g.transmissionMap?"#define USE_TRANSMISSIONMAP":"",g.thicknessMap?"#define USE_THICKNESSMAP":"",g.sheenColorMap?"#define USE_SHEENCOLORMAP":"",g.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",g.vertexTangents?"#define USE_TANGENT":"",g.vertexColors?"#define USE_COLOR":"",g.vertexAlphas?"#define USE_COLOR_ALPHA":"",g.vertexUvs?"#define USE_UV":"",g.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",g.flatShading?"#define FLAT_SHADED":"",g.skinning?"#define USE_SKINNING":"",g.morphTargets?"#define USE_MORPHTARGETS":"",g.morphNormals&&g.flatShading===!1?"#define USE_MORPHNORMALS":"",g.morphColors&&g.isWebGL2?"#define USE_MORPHCOLORS":"",g.morphTargetsCount>0&&g.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",g.morphTargetsCount>0&&g.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+g.morphTextureStride:"",g.morphTargetsCount>0&&g.isWebGL2?"#define MORPHTARGETS_COUNT "+g.morphTargetsCount:"",g.doubleSided?"#define DOUBLE_SIDED":"",g.flipSided?"#define FLIP_SIDED":"",g.shadowMapEnabled?"#define USE_SHADOWMAP":"",g.shadowMapEnabled?"#define "+de:"",g.sizeAttenuation?"#define USE_SIZEATTENUATION":"",g.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",g.logarithmicDepthBuffer&&g.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(xd).join(`
`),je=[Ie,Tp(g),"#define SHADER_NAME "+g.shaderName,Re,g.useFog&&g.fog?"#define USE_FOG":"",g.useFog&&g.fogExp2?"#define FOG_EXP2":"",g.map?"#define USE_MAP":"",g.matcap?"#define USE_MATCAP":"",g.envMap?"#define USE_ENVMAP":"",g.envMap?"#define "+pe:"",g.envMap?"#define "+be:"",g.envMap?"#define "+Ce:"",xe?"#define CUBEUV_TEXEL_WIDTH "+xe.texelWidth:"",xe?"#define CUBEUV_TEXEL_HEIGHT "+xe.texelHeight:"",xe?"#define CUBEUV_MAX_MIP "+xe.maxMip+".0":"",g.lightMap?"#define USE_LIGHTMAP":"",g.aoMap?"#define USE_AOMAP":"",g.emissiveMap?"#define USE_EMISSIVEMAP":"",g.bumpMap?"#define USE_BUMPMAP":"",g.normalMap?"#define USE_NORMALMAP":"",g.normalMap&&g.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",g.normalMap&&g.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",g.clearcoat?"#define USE_CLEARCOAT":"",g.clearcoatMap?"#define USE_CLEARCOATMAP":"",g.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",g.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",g.iridescence?"#define USE_IRIDESCENCE":"",g.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",g.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",g.specularMap?"#define USE_SPECULARMAP":"",g.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",g.specularColorMap?"#define USE_SPECULARCOLORMAP":"",g.roughnessMap?"#define USE_ROUGHNESSMAP":"",g.metalnessMap?"#define USE_METALNESSMAP":"",g.alphaMap?"#define USE_ALPHAMAP":"",g.alphaTest?"#define USE_ALPHATEST":"",g.sheen?"#define USE_SHEEN":"",g.sheenColorMap?"#define USE_SHEENCOLORMAP":"",g.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",g.transmission?"#define USE_TRANSMISSION":"",g.transmissionMap?"#define USE_TRANSMISSIONMAP":"",g.thicknessMap?"#define USE_THICKNESSMAP":"",g.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",g.vertexTangents?"#define USE_TANGENT":"",g.vertexColors||g.instancingColor?"#define USE_COLOR":"",g.vertexAlphas?"#define USE_COLOR_ALPHA":"",g.vertexUvs?"#define USE_UV":"",g.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",g.gradientMap?"#define USE_GRADIENTMAP":"",g.flatShading?"#define FLAT_SHADED":"",g.doubleSided?"#define DOUBLE_SIDED":"",g.flipSided?"#define FLIP_SIDED":"",g.shadowMapEnabled?"#define USE_SHADOWMAP":"",g.shadowMapEnabled?"#define "+de:"",g.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",g.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",g.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",g.logarithmicDepthBuffer&&g.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",g.toneMapping!==Li?"#define TONE_MAPPING":"",g.toneMapping!==Li?fr.tonemapping_pars_fragment:"",g.toneMapping!==Li?ix("toneMapping",g.toneMapping):"",g.dithering?"#define DITHERING":"",g.opaque?"#define OPAQUE":"",fr.encodings_pars_fragment,nx("linearToOutputTexel",g.outputEncoding),g.transmissionSamplerMapEncoding?tx("transmissionSamplerMapTexelToLinear",g.transmissionSamplerMapEncoding):"",g.useDepthPacking?"#define DEPTH_PACKING "+g.depthPacking:"",`
`].filter(xd).join(`
`)),ie=zg(ie),ie=Wf(ie,g),ie=ds(ie,g),se=zg(se),se=Wf(se,g),se=ds(se,g),ie=ic(ie),se=ic(se),g.isWebGL2&&g.isRawShaderMaterial!==!0&&(Ve=`#version 300 es
`,ze=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+ze,je=["#define varying in",g.glslVersion===_l?"":"layout(location = 0) out highp vec4 pc_fragColor;",g.glslVersion===_l?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+je);const $e=Ve+je+se,ct=Qv(Y,35633,Ve+ze+ie),dt=Qv(Y,35632,$e);if(Y.attachShader(De,ct),Y.attachShader(De,dt),g.index0AttributeName!==void 0?Y.bindAttribLocation(De,0,g.index0AttributeName):g.morphTargets===!0&&Y.bindAttribLocation(De,0,"position"),Y.linkProgram(De),ue.debug.checkShaderErrors){const Lt=Y.getProgramInfoLog(De).trim(),Wt=Y.getShaderInfoLog(ct).trim(),qt=Y.getShaderInfoLog(dt).trim();let Ot=!0,En=!0;if(Y.getProgramParameter(De,35714)===!1){Ot=!1;const Ln=WA(Y,ct,"vertex"),wn=WA(Y,dt,"fragment");console.error("THREE.WebGLProgram: Shader Error "+Y.getError()+" - VALIDATE_STATUS "+Y.getProgramParameter(De,35715)+`

Program Info Log: `+Lt+`
`+Ln+`
`+wn)}else Lt!==""?console.warn("THREE.WebGLProgram: Program Info Log:",Lt):Wt!==""&&qt!==""||(En=!1);En&&(this.diagnostics={runnable:Ot,programLog:Lt,vertexShader:{log:Wt,prefix:ze},fragmentShader:{log:qt,prefix:je}})}let ft,Bt;return Y.deleteShader(ct),Y.deleteShader(dt),this.getUniforms=function(){return ft===void 0&&(ft=new Hf(Y,De)),ft},this.getAttributes=function(){return Bt===void 0&&(Bt=function(Lt,Wt){const qt={},Ot=Lt.getProgramParameter(Wt,35721);for(let En=0;En<Ot;En++){const Ln=Lt.getActiveAttrib(Wt,En),wn=Ln.name;let jn=1;Ln.type===35674&&(jn=2),Ln.type===35675&&(jn=3),Ln.type===35676&&(jn=4),qt[wn]={type:Ln.type,location:Lt.getAttribLocation(Wt,wn),locationSize:jn}}return qt}(Y,De)),Bt},this.destroy=function(){j.releaseStatesOfProgram(this),Y.deleteProgram(De),this.program=void 0},this.name=g.shaderName,this.id=ex++,this.cacheKey=o,this.usedTimes=1,this.program=De,this.vertexShader=ct,this.fragmentShader=dt,this}let qf=0;class Qg{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(o){const g=o.vertexShader,j=o.fragmentShader,Y=this._getShaderStage(g),ee=this._getShaderStage(j),ie=this._getShaderCacheForMaterial(o);return ie.has(Y)===!1&&(ie.add(Y),Y.usedTimes++),ie.has(ee)===!1&&(ie.add(ee),ee.usedTimes++),this}remove(o){const g=this.materialCache.get(o);for(const j of g)j.usedTimes--,j.usedTimes===0&&this.shaderCache.delete(j.code);return this.materialCache.delete(o),this}getVertexShaderID(o){return this._getShaderStage(o.vertexShader).id}getFragmentShaderID(o){return this._getShaderStage(o.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(o){const g=this.materialCache;let j=g.get(o);return j===void 0&&(j=new Set,g.set(o,j)),j}_getShaderStage(o){const g=this.shaderCache;let j=g.get(o);return j===void 0&&(j=new Yf(o),g.set(o,j)),j}}class Yf{constructor(o){this.id=qf++,this.code=o,this.usedTimes=0}}function Xf(ue,o,g,j,Y,ee,ie){const se=new ad,de=new Qg,pe=[],be=Y.isWebGL2,Ce=Y.logarithmicDepthBuffer,xe=Y.vertexTextures;let Ie=Y.precision;const Re={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(De,ze,je,Ve,$e){const ct=Ve.fog,dt=$e.geometry,ft=De.isMeshStandardMaterial?Ve.environment:null,Bt=(De.isMeshStandardMaterial?g:o).get(De.envMap||ft),Lt=Bt&&Bt.mapping===Is?Bt.image.height:null,Wt=Re[De.type];De.precision!==null&&(Ie=Y.getMaxPrecision(De.precision),Ie!==De.precision&&console.warn("THREE.WebGLProgram.getParameters:",De.precision,"not supported, using",Ie,"instead."));const qt=dt.morphAttributes.position||dt.morphAttributes.normal||dt.morphAttributes.color,Ot=qt!==void 0?qt.length:0;let En,Ln,wn,jn,Wn=0;if(dt.morphAttributes.position!==void 0&&(Wn=1),dt.morphAttributes.normal!==void 0&&(Wn=2),dt.morphAttributes.color!==void 0&&(Wn=3),Wt){const di=Zs[Wt];En=di.vertexShader,Ln=di.fragmentShader}else En=De.vertexShader,Ln=De.fragmentShader,de.update(De),wn=de.getVertexShaderID(De),jn=de.getFragmentShaderID(De);const hn=ue.getRenderTarget(),fn=ue.userData&&ue.userData.transmissionRenderTarget,Gn=De.alphaTest>0,Sn=De.clearcoat>0,Hn=De.iridescence>0;return{isWebGL2:be,shaderID:Wt,shaderName:De.type,vertexShader:En,fragmentShader:Ln,defines:De.defines,customVertexShaderID:wn,customFragmentShaderID:jn,isRawShaderMaterial:De.isRawShaderMaterial===!0,glslVersion:De.glslVersion,precision:Ie,instancing:$e.isInstancedMesh===!0,instancingColor:$e.isInstancedMesh===!0&&$e.instanceColor!==null,supportsVertexTextures:xe,outputEncoding:hn===null?ue.outputEncoding:hn.isXRRenderTarget===!0||hn.texture.encoding!==cs?hn.texture.encoding:na,map:!!De.map,matcap:!!De.matcap,envMap:!!Bt,envMapMode:Bt&&Bt.mapping,envMapCubeUVHeight:Lt,lightMap:!!De.lightMap,aoMap:!!De.aoMap,emissiveMap:!!De.emissiveMap,bumpMap:!!De.bumpMap,normalMap:!!De.normalMap,objectSpaceNormalMap:De.normalMapType===mp,tangentSpaceNormalMap:De.normalMapType===Ks,decodeVideoTexture:!!De.map&&De.map.isVideoTexture===!0&&De.map.encoding===cs,clearcoat:Sn,clearcoatMap:Sn&&!!De.clearcoatMap,clearcoatRoughnessMap:Sn&&!!De.clearcoatRoughnessMap,clearcoatNormalMap:Sn&&!!De.clearcoatNormalMap,iridescence:Hn,iridescenceMap:Hn&&!!De.iridescenceMap,iridescenceThicknessMap:Hn&&!!De.iridescenceThicknessMap,displacementMap:!!De.displacementMap,roughnessMap:!!De.roughnessMap,metalnessMap:!!De.metalnessMap,specularMap:!!De.specularMap,specularIntensityMap:!!De.specularIntensityMap,specularColorMap:!!De.specularColorMap,opaque:De.transparent===!1&&De.blending===Ze&&!(De.transmission>0),alphaMap:!!De.alphaMap,alphaTest:Gn,gradientMap:!!De.gradientMap,sheen:De.sheen>0,sheenColorMap:!!De.sheenColorMap,sheenRoughnessMap:!!De.sheenRoughnessMap,transmission:De.transmission>0,transmissionMap:!!De.transmissionMap,transmissionSamplerMapEncoding:fn?fn.texture.encoding:na,thicknessMap:!!De.thicknessMap,combine:De.combine,vertexTangents:!!De.normalMap&&!!dt.attributes.tangent,vertexColors:De.vertexColors,vertexAlphas:De.vertexColors===!0&&!!dt.attributes.color&&dt.attributes.color.itemSize===4,vertexUvs:!!(De.map||De.bumpMap||De.normalMap||De.specularMap||De.alphaMap||De.emissiveMap||De.roughnessMap||De.metalnessMap||De.clearcoatMap||De.clearcoatRoughnessMap||De.clearcoatNormalMap||De.iridescenceMap||De.iridescenceThicknessMap||De.displacementMap||De.transmissionMap||De.thicknessMap||De.specularIntensityMap||De.specularColorMap||De.sheenColorMap||De.sheenRoughnessMap),uvsVertexOnly:!(De.map||De.bumpMap||De.normalMap||De.specularMap||De.alphaMap||De.emissiveMap||De.roughnessMap||De.metalnessMap||De.clearcoatNormalMap||De.iridescenceMap||De.iridescenceThicknessMap||De.transmission>0||De.transmissionMap||De.thicknessMap||De.specularIntensityMap||De.specularColorMap||De.sheen>0||De.sheenColorMap||De.sheenRoughnessMap||!De.displacementMap),fog:!!ct,useFog:De.fog===!0,fogExp2:ct&&ct.isFogExp2,flatShading:!!De.flatShading,sizeAttenuation:De.sizeAttenuation,logarithmicDepthBuffer:Ce,skinning:$e.isSkinnedMesh===!0,morphTargets:dt.morphAttributes.position!==void 0,morphNormals:dt.morphAttributes.normal!==void 0,morphColors:dt.morphAttributes.color!==void 0,morphTargetsCount:Ot,morphTextureStride:Wn,numDirLights:ze.directional.length,numPointLights:ze.point.length,numSpotLights:ze.spot.length,numSpotLightMaps:ze.spotLightMap.length,numRectAreaLights:ze.rectArea.length,numHemiLights:ze.hemi.length,numDirLightShadows:ze.directionalShadowMap.length,numPointLightShadows:ze.pointShadowMap.length,numSpotLightShadows:ze.spotShadowMap.length,numSpotLightShadowsWithMaps:ze.numSpotLightShadowsWithMaps,numClippingPlanes:ie.numPlanes,numClipIntersection:ie.numIntersection,dithering:De.dithering,shadowMapEnabled:ue.shadowMap.enabled&&je.length>0,shadowMapType:ue.shadowMap.type,toneMapping:De.toneMapped?ue.toneMapping:Li,physicallyCorrectLights:ue.physicallyCorrectLights,premultipliedAlpha:De.premultipliedAlpha,doubleSided:De.side===nt,flipSided:De.side===Ue,useDepthPacking:!!De.depthPacking,depthPacking:De.depthPacking||0,index0AttributeName:De.index0AttributeName,extensionDerivatives:De.extensions&&De.extensions.derivatives,extensionFragDepth:De.extensions&&De.extensions.fragDepth,extensionDrawBuffers:De.extensions&&De.extensions.drawBuffers,extensionShaderTextureLOD:De.extensions&&De.extensions.shaderTextureLOD,rendererExtensionFragDepth:be||j.has("EXT_frag_depth"),rendererExtensionDrawBuffers:be||j.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:be||j.has("EXT_shader_texture_lod"),customProgramCacheKey:De.customProgramCacheKey()}},getProgramCacheKey:function(De){const ze=[];if(De.shaderID?ze.push(De.shaderID):(ze.push(De.customVertexShaderID),ze.push(De.customFragmentShaderID)),De.defines!==void 0)for(const je in De.defines)ze.push(je),ze.push(De.defines[je]);return De.isRawShaderMaterial===!1&&(function(je,Ve){je.push(Ve.precision),je.push(Ve.outputEncoding),je.push(Ve.envMapMode),je.push(Ve.envMapCubeUVHeight),je.push(Ve.combine),je.push(Ve.vertexUvs),je.push(Ve.fogExp2),je.push(Ve.sizeAttenuation),je.push(Ve.morphTargetsCount),je.push(Ve.morphAttributeCount),je.push(Ve.numDirLights),je.push(Ve.numPointLights),je.push(Ve.numSpotLights),je.push(Ve.numSpotLightMaps),je.push(Ve.numHemiLights),je.push(Ve.numRectAreaLights),je.push(Ve.numDirLightShadows),je.push(Ve.numPointLightShadows),je.push(Ve.numSpotLightShadows),je.push(Ve.numSpotLightShadowsWithMaps),je.push(Ve.shadowMapType),je.push(Ve.toneMapping),je.push(Ve.numClippingPlanes),je.push(Ve.numClipIntersection),je.push(Ve.depthPacking)}(ze,De),function(je,Ve){se.disableAll(),Ve.isWebGL2&&se.enable(0),Ve.supportsVertexTextures&&se.enable(1),Ve.instancing&&se.enable(2),Ve.instancingColor&&se.enable(3),Ve.map&&se.enable(4),Ve.matcap&&se.enable(5),Ve.envMap&&se.enable(6),Ve.lightMap&&se.enable(7),Ve.aoMap&&se.enable(8),Ve.emissiveMap&&se.enable(9),Ve.bumpMap&&se.enable(10),Ve.normalMap&&se.enable(11),Ve.objectSpaceNormalMap&&se.enable(12),Ve.tangentSpaceNormalMap&&se.enable(13),Ve.clearcoat&&se.enable(14),Ve.clearcoatMap&&se.enable(15),Ve.clearcoatRoughnessMap&&se.enable(16),Ve.clearcoatNormalMap&&se.enable(17),Ve.iridescence&&se.enable(18),Ve.iridescenceMap&&se.enable(19),Ve.iridescenceThicknessMap&&se.enable(20),Ve.displacementMap&&se.enable(21),Ve.specularMap&&se.enable(22),Ve.roughnessMap&&se.enable(23),Ve.metalnessMap&&se.enable(24),Ve.gradientMap&&se.enable(25),Ve.alphaMap&&se.enable(26),Ve.alphaTest&&se.enable(27),Ve.vertexColors&&se.enable(28),Ve.vertexAlphas&&se.enable(29),Ve.vertexUvs&&se.enable(30),Ve.vertexTangents&&se.enable(31),Ve.uvsVertexOnly&&se.enable(32),je.push(se.mask),se.disableAll(),Ve.fog&&se.enable(0),Ve.useFog&&se.enable(1),Ve.flatShading&&se.enable(2),Ve.logarithmicDepthBuffer&&se.enable(3),Ve.skinning&&se.enable(4),Ve.morphTargets&&se.enable(5),Ve.morphNormals&&se.enable(6),Ve.morphColors&&se.enable(7),Ve.premultipliedAlpha&&se.enable(8),Ve.shadowMapEnabled&&se.enable(9),Ve.physicallyCorrectLights&&se.enable(10),Ve.doubleSided&&se.enable(11),Ve.flipSided&&se.enable(12),Ve.useDepthPacking&&se.enable(13),Ve.dithering&&se.enable(14),Ve.specularIntensityMap&&se.enable(15),Ve.specularColorMap&&se.enable(16),Ve.transmission&&se.enable(17),Ve.transmissionMap&&se.enable(18),Ve.thicknessMap&&se.enable(19),Ve.sheen&&se.enable(20),Ve.sheenColorMap&&se.enable(21),Ve.sheenRoughnessMap&&se.enable(22),Ve.decodeVideoTexture&&se.enable(23),Ve.opaque&&se.enable(24),je.push(se.mask)}(ze,De),ze.push(ue.outputEncoding)),ze.push(De.customProgramCacheKey),ze.join()},getUniforms:function(De){const ze=Re[De.type];let je;if(ze){const Ve=Zs[ze];je=Mv.clone(Ve.uniforms)}else je=De.uniforms;return je},acquireProgram:function(De,ze){let je;for(let Ve=0,$e=pe.length;Ve<$e;Ve++){const ct=pe[Ve];if(ct.cacheKey===ze){je=ct,++je.usedTimes;break}}return je===void 0&&(je=new Ed(ue,ze,De,ee),pe.push(je)),je},releaseProgram:function(De){if(--De.usedTimes==0){const ze=pe.indexOf(De);pe[ze]=pe[pe.length-1],pe.pop(),De.destroy()}},releaseShaderCache:function(De){de.remove(De)},programs:pe,dispose:function(){de.dispose()}}}function rx(){let ue=new WeakMap;return{get:function(o){let g=ue.get(o);return g===void 0&&(g={},ue.set(o,g)),g},remove:function(o){ue.delete(o)},update:function(o,g,j){ue.get(o)[g]=j},dispose:function(){ue=new WeakMap}}}function sx(ue,o){return ue.groupOrder!==o.groupOrder?ue.groupOrder-o.groupOrder:ue.renderOrder!==o.renderOrder?ue.renderOrder-o.renderOrder:ue.material.id!==o.material.id?ue.material.id-o.material.id:ue.z!==o.z?ue.z-o.z:ue.id-o.id}function Hv(ue,o){return ue.groupOrder!==o.groupOrder?ue.groupOrder-o.groupOrder:ue.renderOrder!==o.renderOrder?ue.renderOrder-o.renderOrder:ue.z!==o.z?o.z-ue.z:ue.id-o.id}function Kf(){const ue=[];let o=0;const g=[],j=[],Y=[];function ee(ie,se,de,pe,be,Ce){let xe=ue[o];return xe===void 0?(xe={id:ie.id,object:ie,geometry:se,material:de,groupOrder:pe,renderOrder:ie.renderOrder,z:be,group:Ce},ue[o]=xe):(xe.id=ie.id,xe.object=ie,xe.geometry=se,xe.material=de,xe.groupOrder=pe,xe.renderOrder=ie.renderOrder,xe.z=be,xe.group=Ce),o++,xe}return{opaque:g,transmissive:j,transparent:Y,init:function(){o=0,g.length=0,j.length=0,Y.length=0},push:function(ie,se,de,pe,be,Ce){const xe=ee(ie,se,de,pe,be,Ce);de.transmission>0?j.push(xe):de.transparent===!0?Y.push(xe):g.push(xe)},unshift:function(ie,se,de,pe,be,Ce){const xe=ee(ie,se,de,pe,be,Ce);de.transmission>0?j.unshift(xe):de.transparent===!0?Y.unshift(xe):g.unshift(xe)},finish:function(){for(let ie=o,se=ue.length;ie<se;ie++){const de=ue[ie];if(de.id===null)break;de.id=null,de.object=null,de.geometry=null,de.material=null,de.group=null}},sort:function(ie,se){g.length>1&&g.sort(ie||sx),j.length>1&&j.sort(se||Hv),Y.length>1&&Y.sort(se||Hv)}}}function XA(){let ue=new WeakMap;return{get:function(o,g){const j=ue.get(o);let Y;return j===void 0?(Y=new Kf,ue.set(o,[Y])):g>=j.length?(Y=new Kf,j.push(Y)):Y=j[g],Y},dispose:function(){ue=new WeakMap}}}function ox(){const ue={};return{get:function(o){if(ue[o.id]!==void 0)return ue[o.id];let g;switch(o.type){case"DirectionalLight":g={direction:new vt,color:new ci};break;case"SpotLight":g={position:new vt,direction:new vt,color:new ci,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":g={position:new vt,color:new ci,distance:0,decay:0};break;case"HemisphereLight":g={direction:new vt,skyColor:new ci,groundColor:new ci};break;case"RectAreaLight":g={color:new ci,position:new vt,halfWidth:new vt,halfHeight:new vt}}return ue[o.id]=g,g}}}let KA=0;function JA(ue,o){return(o.castShadow?2:0)-(ue.castShadow?2:0)+(o.map?1:0)-(ue.map?1:0)}function $A(ue,o){const g=new ox,j=function(){const de={};return{get:function(pe){if(de[pe.id]!==void 0)return de[pe.id];let be;switch(pe.type){case"DirectionalLight":case"SpotLight":be={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Bn};break;case"PointLight":be={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Bn,shadowCameraNear:1,shadowCameraFar:1e3}}return de[pe.id]=be,be}}}(),Y={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let de=0;de<9;de++)Y.probe.push(new vt);const ee=new vt,ie=new Yi,se=new Yi;return{setup:function(de,pe){let be=0,Ce=0,xe=0;for(let Wt=0;Wt<9;Wt++)Y.probe[Wt].set(0,0,0);let Ie=0,Re=0,De=0,ze=0,je=0,Ve=0,$e=0,ct=0,dt=0,ft=0;de.sort(JA);const Bt=pe!==!0?Math.PI:1;for(let Wt=0,qt=de.length;Wt<qt;Wt++){const Ot=de[Wt],En=Ot.color,Ln=Ot.intensity,wn=Ot.distance,jn=Ot.shadow&&Ot.shadow.map?Ot.shadow.map.texture:null;if(Ot.isAmbientLight)be+=En.r*Ln*Bt,Ce+=En.g*Ln*Bt,xe+=En.b*Ln*Bt;else if(Ot.isLightProbe)for(let Wn=0;Wn<9;Wn++)Y.probe[Wn].addScaledVector(Ot.sh.coefficients[Wn],Ln);else if(Ot.isDirectionalLight){const Wn=g.get(Ot);if(Wn.color.copy(Ot.color).multiplyScalar(Ot.intensity*Bt),Ot.castShadow){const hn=Ot.shadow,fn=j.get(Ot);fn.shadowBias=hn.bias,fn.shadowNormalBias=hn.normalBias,fn.shadowRadius=hn.radius,fn.shadowMapSize=hn.mapSize,Y.directionalShadow[Ie]=fn,Y.directionalShadowMap[Ie]=jn,Y.directionalShadowMatrix[Ie]=Ot.shadow.matrix,Ve++}Y.directional[Ie]=Wn,Ie++}else if(Ot.isSpotLight){const Wn=g.get(Ot);Wn.position.setFromMatrixPosition(Ot.matrixWorld),Wn.color.copy(En).multiplyScalar(Ln*Bt),Wn.distance=wn,Wn.coneCos=Math.cos(Ot.angle),Wn.penumbraCos=Math.cos(Ot.angle*(1-Ot.penumbra)),Wn.decay=Ot.decay,Y.spot[De]=Wn;const hn=Ot.shadow;if(Ot.map&&(Y.spotLightMap[dt]=Ot.map,dt++,hn.updateMatrices(Ot),Ot.castShadow&&ft++),Y.spotLightMatrix[De]=hn.matrix,Ot.castShadow){const fn=j.get(Ot);fn.shadowBias=hn.bias,fn.shadowNormalBias=hn.normalBias,fn.shadowRadius=hn.radius,fn.shadowMapSize=hn.mapSize,Y.spotShadow[De]=fn,Y.spotShadowMap[De]=jn,ct++}De++}else if(Ot.isRectAreaLight){const Wn=g.get(Ot);Wn.color.copy(En).multiplyScalar(Ln),Wn.halfWidth.set(.5*Ot.width,0,0),Wn.halfHeight.set(0,.5*Ot.height,0),Y.rectArea[ze]=Wn,ze++}else if(Ot.isPointLight){const Wn=g.get(Ot);if(Wn.color.copy(Ot.color).multiplyScalar(Ot.intensity*Bt),Wn.distance=Ot.distance,Wn.decay=Ot.decay,Ot.castShadow){const hn=Ot.shadow,fn=j.get(Ot);fn.shadowBias=hn.bias,fn.shadowNormalBias=hn.normalBias,fn.shadowRadius=hn.radius,fn.shadowMapSize=hn.mapSize,fn.shadowCameraNear=hn.camera.near,fn.shadowCameraFar=hn.camera.far,Y.pointShadow[Re]=fn,Y.pointShadowMap[Re]=jn,Y.pointShadowMatrix[Re]=Ot.shadow.matrix,$e++}Y.point[Re]=Wn,Re++}else if(Ot.isHemisphereLight){const Wn=g.get(Ot);Wn.skyColor.copy(Ot.color).multiplyScalar(Ln*Bt),Wn.groundColor.copy(Ot.groundColor).multiplyScalar(Ln*Bt),Y.hemi[je]=Wn,je++}}ze>0&&(o.isWebGL2||ue.has("OES_texture_float_linear")===!0?(Y.rectAreaLTC1=Zn.LTC_FLOAT_1,Y.rectAreaLTC2=Zn.LTC_FLOAT_2):ue.has("OES_texture_half_float_linear")===!0?(Y.rectAreaLTC1=Zn.LTC_HALF_1,Y.rectAreaLTC2=Zn.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),Y.ambient[0]=be,Y.ambient[1]=Ce,Y.ambient[2]=xe;const Lt=Y.hash;Lt.directionalLength===Ie&&Lt.pointLength===Re&&Lt.spotLength===De&&Lt.rectAreaLength===ze&&Lt.hemiLength===je&&Lt.numDirectionalShadows===Ve&&Lt.numPointShadows===$e&&Lt.numSpotShadows===ct&&Lt.numSpotMaps===dt||(Y.directional.length=Ie,Y.spot.length=De,Y.rectArea.length=ze,Y.point.length=Re,Y.hemi.length=je,Y.directionalShadow.length=Ve,Y.directionalShadowMap.length=Ve,Y.pointShadow.length=$e,Y.pointShadowMap.length=$e,Y.spotShadow.length=ct,Y.spotShadowMap.length=ct,Y.directionalShadowMatrix.length=Ve,Y.pointShadowMatrix.length=$e,Y.spotLightMatrix.length=ct+dt-ft,Y.spotLightMap.length=dt,Y.numSpotLightShadowsWithMaps=ft,Lt.directionalLength=Ie,Lt.pointLength=Re,Lt.spotLength=De,Lt.rectAreaLength=ze,Lt.hemiLength=je,Lt.numDirectionalShadows=Ve,Lt.numPointShadows=$e,Lt.numSpotShadows=ct,Lt.numSpotMaps=dt,Y.version=KA++)},setupView:function(de,pe){let be=0,Ce=0,xe=0,Ie=0,Re=0;const De=pe.matrixWorldInverse;for(let ze=0,je=de.length;ze<je;ze++){const Ve=de[ze];if(Ve.isDirectionalLight){const $e=Y.directional[be];$e.direction.setFromMatrixPosition(Ve.matrixWorld),ee.setFromMatrixPosition(Ve.target.matrixWorld),$e.direction.sub(ee),$e.direction.transformDirection(De),be++}else if(Ve.isSpotLight){const $e=Y.spot[xe];$e.position.setFromMatrixPosition(Ve.matrixWorld),$e.position.applyMatrix4(De),$e.direction.setFromMatrixPosition(Ve.matrixWorld),ee.setFromMatrixPosition(Ve.target.matrixWorld),$e.direction.sub(ee),$e.direction.transformDirection(De),xe++}else if(Ve.isRectAreaLight){const $e=Y.rectArea[Ie];$e.position.setFromMatrixPosition(Ve.matrixWorld),$e.position.applyMatrix4(De),se.identity(),ie.copy(Ve.matrixWorld),ie.premultiply(De),se.extractRotation(ie),$e.halfWidth.set(.5*Ve.width,0,0),$e.halfHeight.set(0,.5*Ve.height,0),$e.halfWidth.applyMatrix4(se),$e.halfHeight.applyMatrix4(se),Ie++}else if(Ve.isPointLight){const $e=Y.point[Ce];$e.position.setFromMatrixPosition(Ve.matrixWorld),$e.position.applyMatrix4(De),Ce++}else if(Ve.isHemisphereLight){const $e=Y.hemi[Re];$e.direction.setFromMatrixPosition(Ve.matrixWorld),$e.direction.transformDirection(De),Re++}}},state:Y}}function ZA(ue,o){const g=new $A(ue,o),j=[],Y=[];return{init:function(){j.length=0,Y.length=0},state:{lightsArray:j,shadowsArray:Y,lights:g},setupLights:function(ee){g.setup(j,ee)},setupLightsView:function(ee){g.setupView(j,ee)},pushLight:function(ee){j.push(ee)},pushShadow:function(ee){Y.push(ee)}}}function Wv(ue,o){let g=new WeakMap;return{get:function(j,Y=0){const ee=g.get(j);let ie;return ee===void 0?(ie=new ZA(ue,o),g.set(j,[ie])):Y>=ee.length?(ie=new ZA(ue,o),ee.push(ie)):ie=ee[Y],ie},dispose:function(){g=new WeakMap}}}class Jf extends $s{constructor(o){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Do,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(o)}copy(o){return super.copy(o),this.depthPacking=o.depthPacking,this.map=o.map,this.alphaMap=o.alphaMap,this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this}}class Sd extends $s{constructor(o){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new vt,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(o)}copy(o){return super.copy(o),this.referencePosition.copy(o.referencePosition),this.nearDistance=o.nearDistance,this.farDistance=o.farDistance,this.map=o.map,this.alphaMap=o.alphaMap,this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this}}function Hg(ue,o,g){let j=new $l;const Y=new Bn,ee=new Bn,ie=new Vr,se=new Jf({depthPacking:Tc}),de=new Sd,pe={},be=g.maxTextureSize,Ce={0:Ue,1:et,2:nt},xe=new El({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Bn},radius:{value:4}},vertexShader:`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragmentShader:`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`}),Ie=xe.clone();Ie.defines.HORIZONTAL_PASS=1;const Re=new yi;Re.setAttribute("position",new is(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const De=new lo(Re,xe),ze=this;function je(ct,dt){const ft=o.update(De);xe.defines.VSM_SAMPLES!==ct.blurSamples&&(xe.defines.VSM_SAMPLES=ct.blurSamples,Ie.defines.VSM_SAMPLES=ct.blurSamples,xe.needsUpdate=!0,Ie.needsUpdate=!0),ct.mapPass===null&&(ct.mapPass=new Aa(Y.x,Y.y)),xe.uniforms.shadow_pass.value=ct.map.texture,xe.uniforms.resolution.value=ct.mapSize,xe.uniforms.radius.value=ct.radius,ue.setRenderTarget(ct.mapPass),ue.clear(),ue.renderBufferDirect(dt,null,ft,xe,De,null),Ie.uniforms.shadow_pass.value=ct.mapPass.texture,Ie.uniforms.resolution.value=ct.mapSize,Ie.uniforms.radius.value=ct.radius,ue.setRenderTarget(ct.map),ue.clear(),ue.renderBufferDirect(dt,null,ft,Ie,De,null)}function Ve(ct,dt,ft,Bt,Lt,Wt){let qt=null;const Ot=ft.isPointLight===!0?ct.customDistanceMaterial:ct.customDepthMaterial;if(qt=Ot!==void 0?Ot:ft.isPointLight===!0?de:se,ue.localClippingEnabled&&dt.clipShadows===!0&&Array.isArray(dt.clippingPlanes)&&dt.clippingPlanes.length!==0||dt.displacementMap&&dt.displacementScale!==0||dt.alphaMap&&dt.alphaTest>0){const En=qt.uuid,Ln=dt.uuid;let wn=pe[En];wn===void 0&&(wn={},pe[En]=wn);let jn=wn[Ln];jn===void 0&&(jn=qt.clone(),wn[Ln]=jn),qt=jn}return qt.visible=dt.visible,qt.wireframe=dt.wireframe,qt.side=Wt===Ge?dt.shadowSide!==null?dt.shadowSide:dt.side:dt.shadowSide!==null?dt.shadowSide:Ce[dt.side],qt.alphaMap=dt.alphaMap,qt.alphaTest=dt.alphaTest,qt.clipShadows=dt.clipShadows,qt.clippingPlanes=dt.clippingPlanes,qt.clipIntersection=dt.clipIntersection,qt.displacementMap=dt.displacementMap,qt.displacementScale=dt.displacementScale,qt.displacementBias=dt.displacementBias,qt.wireframeLinewidth=dt.wireframeLinewidth,qt.linewidth=dt.linewidth,ft.isPointLight===!0&&qt.isMeshDistanceMaterial===!0&&(qt.referencePosition.setFromMatrixPosition(ft.matrixWorld),qt.nearDistance=Bt,qt.farDistance=Lt),qt}function $e(ct,dt,ft,Bt,Lt){if(ct.visible===!1)return;if(ct.layers.test(dt.layers)&&(ct.isMesh||ct.isLine||ct.isPoints)&&(ct.castShadow||ct.receiveShadow&&Lt===Ge)&&(!ct.frustumCulled||j.intersectsObject(ct))){ct.modelViewMatrix.multiplyMatrices(ft.matrixWorldInverse,ct.matrixWorld);const qt=o.update(ct),Ot=ct.material;if(Array.isArray(Ot)){const En=qt.groups;for(let Ln=0,wn=En.length;Ln<wn;Ln++){const jn=En[Ln],Wn=Ot[jn.materialIndex];if(Wn&&Wn.visible){const hn=Ve(ct,Wn,Bt,ft.near,ft.far,Lt);ue.renderBufferDirect(ft,null,qt,hn,ct,jn)}}}else if(Ot.visible){const En=Ve(ct,Ot,Bt,ft.near,ft.far,Lt);ue.renderBufferDirect(ft,null,qt,En,ct,null)}}const Wt=ct.children;for(let qt=0,Ot=Wt.length;qt<Ot;qt++)$e(Wt[qt],dt,ft,Bt,Lt)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=tt,this.render=function(ct,dt,ft){if(ze.enabled===!1||ze.autoUpdate===!1&&ze.needsUpdate===!1||ct.length===0)return;const Bt=ue.getRenderTarget(),Lt=ue.getActiveCubeFace(),Wt=ue.getActiveMipmapLevel(),qt=ue.state;qt.setBlending(He),qt.buffers.color.setClear(1,1,1,1),qt.buffers.depth.setTest(!0),qt.setScissorTest(!1);for(let Ot=0,En=ct.length;Ot<En;Ot++){const Ln=ct[Ot],wn=Ln.shadow;if(wn===void 0){console.warn("THREE.WebGLShadowMap:",Ln,"has no shadow.");continue}if(wn.autoUpdate===!1&&wn.needsUpdate===!1)continue;Y.copy(wn.mapSize);const jn=wn.getFrameExtents();if(Y.multiply(jn),ee.copy(wn.mapSize),(Y.x>be||Y.y>be)&&(Y.x>be&&(ee.x=Math.floor(be/jn.x),Y.x=ee.x*jn.x,wn.mapSize.x=ee.x),Y.y>be&&(ee.y=Math.floor(be/jn.y),Y.y=ee.y*jn.y,wn.mapSize.y=ee.y)),wn.map===null){const hn=this.type!==Ge?{minFilter:Gr,magFilter:Gr}:{};wn.map=new Aa(Y.x,Y.y,hn),wn.map.texture.name=Ln.name+".shadowMap",wn.camera.updateProjectionMatrix()}ue.setRenderTarget(wn.map),ue.clear();const Wn=wn.getViewportCount();for(let hn=0;hn<Wn;hn++){const fn=wn.getViewport(hn);ie.set(ee.x*fn.x,ee.y*fn.y,ee.x*fn.z,ee.y*fn.w),qt.viewport(ie),wn.updateMatrices(Ln,hn),j=wn.getFrustum(),$e(dt,ft,wn.camera,Ln,this.type)}wn.isPointLightShadow!==!0&&this.type===Ge&&je(wn,ft),wn.needsUpdate=!1}ze.needsUpdate=!1,ue.setRenderTarget(Bt,Lt,Wt)}}function ey(ue,o,g){const j=g.isWebGL2,Y=new function(){let it=!1;const on=new Vr;let Xt=null;const xn=new Vr(0,0,0,0);return{setMask:function(Nn){Xt===Nn||it||(ue.colorMask(Nn,Nn,Nn,Nn),Xt=Nn)},setLocked:function(Nn){it=Nn},setClear:function(Nn,ti,wi,Gi,Ki){Ki===!0&&(Nn*=Gi,ti*=Gi,wi*=Gi),on.set(Nn,ti,wi,Gi),xn.equals(on)===!1&&(ue.clearColor(Nn,ti,wi,Gi),xn.copy(on))},reset:function(){it=!1,Xt=null,xn.set(-1,0,0,0)}}},ee=new function(){let it=!1,on=null,Xt=null,xn=null;return{setTest:function(Nn){Nn?Ci(2929):sr(2929)},setMask:function(Nn){on===Nn||it||(ue.depthMask(Nn),on=Nn)},setFunc:function(Nn){if(Xt!==Nn){if(Nn)switch(Nn){case Cn:ue.depthFunc(512);break;case Vt:ue.depthFunc(519);break;case Je:ue.depthFunc(513);break;case ot:ue.depthFunc(515);break;case Rt:ue.depthFunc(514);break;case Mn:ue.depthFunc(518);break;case Pn:ue.depthFunc(516);break;case Rn:ue.depthFunc(517);break;default:ue.depthFunc(515)}else ue.depthFunc(515);Xt=Nn}},setLocked:function(Nn){it=Nn},setClear:function(Nn){xn!==Nn&&(ue.clearDepth(Nn),xn=Nn)},reset:function(){it=!1,on=null,Xt=null,xn=null}}},ie=new function(){let it=!1,on=null,Xt=null,xn=null,Nn=null,ti=null,wi=null,Gi=null,Ki=null;return{setTest:function(Di){it||(Di?Ci(2960):sr(2960))},setMask:function(Di){on===Di||it||(ue.stencilMask(Di),on=Di)},setFunc:function(Di,Ui,Wr){Xt===Di&&xn===Ui&&Nn===Wr||(ue.stencilFunc(Di,Ui,Wr),Xt=Di,xn=Ui,Nn=Wr)},setOp:function(Di,Ui,Wr){ti===Di&&wi===Ui&&Gi===Wr||(ue.stencilOp(Di,Ui,Wr),ti=Di,wi=Ui,Gi=Wr)},setLocked:function(Di){it=Di},setClear:function(Di){Ki!==Di&&(ue.clearStencil(Di),Ki=Di)},reset:function(){it=!1,on=null,Xt=null,xn=null,Nn=null,ti=null,wi=null,Gi=null,Ki=null}}},se=new WeakMap,de=new WeakMap;let pe={},be={},Ce=new WeakMap,xe=[],Ie=null,Re=!1,De=null,ze=null,je=null,Ve=null,$e=null,ct=null,dt=null,ft=!1,Bt=null,Lt=null,Wt=null,qt=null,Ot=null;const En=ue.getParameter(35661);let Ln=!1,wn=0;const jn=ue.getParameter(7938);jn.indexOf("WebGL")!==-1?(wn=parseFloat(/^WebGL (\d)/.exec(jn)[1]),Ln=wn>=1):jn.indexOf("OpenGL ES")!==-1&&(wn=parseFloat(/^OpenGL ES (\d)/.exec(jn)[1]),Ln=wn>=2);let Wn=null,hn={};const fn=ue.getParameter(3088),Gn=ue.getParameter(2978),Sn=new Vr().fromArray(fn),Hn=new Vr().fromArray(Gn);function di(it,on,Xt){const xn=new Uint8Array(4),Nn=ue.createTexture();ue.bindTexture(it,Nn),ue.texParameteri(it,10241,9728),ue.texParameteri(it,10240,9728);for(let ti=0;ti<Xt;ti++)ue.texImage2D(on+ti,0,6408,1,1,0,6408,5121,xn);return Nn}const nr={};function Ci(it){pe[it]!==!0&&(ue.enable(it),pe[it]=!0)}function sr(it){pe[it]!==!1&&(ue.disable(it),pe[it]=!1)}nr[3553]=di(3553,3553,1),nr[34067]=di(34067,34069,6),Y.setClear(0,0,0,1),ee.setClear(1),ie.setClear(0),Ci(2929),ee.setFunc(ot),Qt(!1),It(Me),Ci(2884),tn(He);const Dt={[Ne]:32774,[Qe]:32778,[We]:32779};if(j)Dt[_t]=32775,Dt[lt]=32776;else{const it=o.get("EXT_blend_minmax");it!==null&&(Dt[_t]=it.MIN_EXT,Dt[lt]=it.MAX_EXT)}const xt={[Ut]:0,[dn]:1,[nn]:768,[Zt]:770,[en]:776,[ht]:774,[ln]:772,[un]:769,[pn]:771,[Jt]:775,[vn]:773};function tn(it,on,Xt,xn,Nn,ti,wi,Gi){if(it!==He){if(Re===!1&&(Ci(3042),Re=!0),it===bt)Nn=Nn||on,ti=ti||Xt,wi=wi||xn,on===ze&&Nn===$e||(ue.blendEquationSeparate(Dt[on],Dt[Nn]),ze=on,$e=Nn),Xt===je&&xn===Ve&&ti===ct&&wi===dt||(ue.blendFuncSeparate(xt[Xt],xt[xn],xt[ti],xt[wi]),je=Xt,Ve=xn,ct=ti,dt=wi),De=it,ft=null;else if(it!==De||Gi!==ft){if(ze===Ne&&$e===Ne||(ue.blendEquation(32774),ze=Ne,$e=Ne),Gi)switch(it){case Ze:ue.blendFuncSeparate(1,771,1,771);break;case st:ue.blendFunc(1,1);break;case Et:ue.blendFuncSeparate(0,769,0,1);break;case rt:ue.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",it)}else switch(it){case Ze:ue.blendFuncSeparate(770,771,1,771);break;case st:ue.blendFunc(770,1);break;case Et:ue.blendFuncSeparate(0,769,0,1);break;case rt:ue.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",it)}je=null,Ve=null,ct=null,dt=null,De=it,ft=Gi}}else Re===!0&&(sr(3042),Re=!1)}function Qt(it){Bt!==it&&(it?ue.frontFace(2304):ue.frontFace(2305),Bt=it)}function It(it){it!==we?(Ci(2884),it!==Lt&&(it===Me?ue.cullFace(1029):it===ke?ue.cullFace(1028):ue.cullFace(1032))):sr(2884),Lt=it}function Ht(it,on,Xt){it?(Ci(32823),qt===on&&Ot===Xt||(ue.polygonOffset(on,Xt),qt=on,Ot=Xt)):sr(32823)}function _n(it){it===void 0&&(it=33984+En-1),Wn!==it&&(ue.activeTexture(it),Wn=it)}return{buffers:{color:Y,depth:ee,stencil:ie},enable:Ci,disable:sr,bindFramebuffer:function(it,on){return be[it]!==on&&(ue.bindFramebuffer(it,on),be[it]=on,j&&(it===36009&&(be[36160]=on),it===36160&&(be[36009]=on)),!0)},drawBuffers:function(it,on){let Xt=xe,xn=!1;if(it)if(Xt=Ce.get(on),Xt===void 0&&(Xt=[],Ce.set(on,Xt)),it.isWebGLMultipleRenderTargets){const Nn=it.texture;if(Xt.length!==Nn.length||Xt[0]!==36064){for(let ti=0,wi=Nn.length;ti<wi;ti++)Xt[ti]=36064+ti;Xt.length=Nn.length,xn=!0}}else Xt[0]!==36064&&(Xt[0]=36064,xn=!0);else Xt[0]!==1029&&(Xt[0]=1029,xn=!0);xn&&(g.isWebGL2?ue.drawBuffers(Xt):o.get("WEBGL_draw_buffers").drawBuffersWEBGL(Xt))},useProgram:function(it){return Ie!==it&&(ue.useProgram(it),Ie=it,!0)},setBlending:tn,setMaterial:function(it,on){it.side===nt?sr(2884):Ci(2884);let Xt=it.side===Ue;on&&(Xt=!Xt),Qt(Xt),it.blending===Ze&&it.transparent===!1?tn(He):tn(it.blending,it.blendEquation,it.blendSrc,it.blendDst,it.blendEquationAlpha,it.blendSrcAlpha,it.blendDstAlpha,it.premultipliedAlpha),ee.setFunc(it.depthFunc),ee.setTest(it.depthTest),ee.setMask(it.depthWrite),Y.setMask(it.colorWrite);const xn=it.stencilWrite;ie.setTest(xn),xn&&(ie.setMask(it.stencilWriteMask),ie.setFunc(it.stencilFunc,it.stencilRef,it.stencilFuncMask),ie.setOp(it.stencilFail,it.stencilZFail,it.stencilZPass)),Ht(it.polygonOffset,it.polygonOffsetFactor,it.polygonOffsetUnits),it.alphaToCoverage===!0?Ci(32926):sr(32926)},setFlipSided:Qt,setCullFace:It,setLineWidth:function(it){it!==Wt&&(Ln&&ue.lineWidth(it),Wt=it)},setPolygonOffset:Ht,setScissorTest:function(it){it?Ci(3089):sr(3089)},activeTexture:_n,bindTexture:function(it,on){Wn===null&&_n();let Xt=hn[Wn];Xt===void 0&&(Xt={type:void 0,texture:void 0},hn[Wn]=Xt),Xt.type===it&&Xt.texture===on||(ue.bindTexture(it,on||nr[it]),Xt.type=it,Xt.texture=on)},unbindTexture:function(){const it=hn[Wn];it!==void 0&&it.type!==void 0&&(ue.bindTexture(it.type,null),it.type=void 0,it.texture=void 0)},compressedTexImage2D:function(){try{ue.compressedTexImage2D.apply(ue,arguments)}catch(it){console.error("THREE.WebGLState:",it)}},texImage2D:function(){try{ue.texImage2D.apply(ue,arguments)}catch(it){console.error("THREE.WebGLState:",it)}},texImage3D:function(){try{ue.texImage3D.apply(ue,arguments)}catch(it){console.error("THREE.WebGLState:",it)}},updateUBOMapping:function(it,on){let Xt=de.get(on);Xt===void 0&&(Xt=new WeakMap,de.set(on,Xt));let xn=Xt.get(it);xn===void 0&&(xn=ue.getUniformBlockIndex(on,it.name),Xt.set(it,xn))},uniformBlockBinding:function(it,on){const Xt=de.get(on).get(it);se.get(it)!==Xt&&(ue.uniformBlockBinding(on,Xt,it.__bindingPointIndex),se.set(it,Xt))},texStorage2D:function(){try{ue.texStorage2D.apply(ue,arguments)}catch(it){console.error("THREE.WebGLState:",it)}},texStorage3D:function(){try{ue.texStorage3D.apply(ue,arguments)}catch(it){console.error("THREE.WebGLState:",it)}},texSubImage2D:function(){try{ue.texSubImage2D.apply(ue,arguments)}catch(it){console.error("THREE.WebGLState:",it)}},texSubImage3D:function(){try{ue.texSubImage3D.apply(ue,arguments)}catch(it){console.error("THREE.WebGLState:",it)}},compressedTexSubImage2D:function(){try{ue.compressedTexSubImage2D.apply(ue,arguments)}catch(it){console.error("THREE.WebGLState:",it)}},scissor:function(it){Sn.equals(it)===!1&&(ue.scissor(it.x,it.y,it.z,it.w),Sn.copy(it))},viewport:function(it){Hn.equals(it)===!1&&(ue.viewport(it.x,it.y,it.z,it.w),Hn.copy(it))},reset:function(){ue.disable(3042),ue.disable(2884),ue.disable(2929),ue.disable(32823),ue.disable(3089),ue.disable(2960),ue.disable(32926),ue.blendEquation(32774),ue.blendFunc(1,0),ue.blendFuncSeparate(1,0,1,0),ue.colorMask(!0,!0,!0,!0),ue.clearColor(0,0,0,0),ue.depthMask(!0),ue.depthFunc(513),ue.clearDepth(1),ue.stencilMask(4294967295),ue.stencilFunc(519,0,4294967295),ue.stencilOp(7680,7680,7680),ue.clearStencil(0),ue.cullFace(1029),ue.frontFace(2305),ue.polygonOffset(0,0),ue.activeTexture(33984),ue.bindFramebuffer(36160,null),j===!0&&(ue.bindFramebuffer(36009,null),ue.bindFramebuffer(36008,null)),ue.useProgram(null),ue.lineWidth(1),ue.scissor(0,0,ue.canvas.width,ue.canvas.height),ue.viewport(0,0,ue.canvas.width,ue.canvas.height),pe={},Wn=null,hn={},be={},Ce=new WeakMap,xe=[],Ie=null,Re=!1,De=null,ze=null,je=null,Ve=null,$e=null,ct=null,dt=null,ft=!1,Bt=null,Lt=null,Wt=null,qt=null,Ot=null,Sn.set(0,0,ue.canvas.width,ue.canvas.height),Hn.set(0,0,ue.canvas.width,ue.canvas.height),Y.reset(),ee.reset(),ie.reset()}}}function qv(ue,o,g,j,Y,ee,ie){const se=Y.isWebGL2,de=Y.maxTextures,pe=Y.maxCubemapSize,be=Y.maxTextureSize,Ce=Y.maxSamples,xe=o.has("WEBGL_multisampled_render_to_texture")?o.get("WEBGL_multisampled_render_to_texture"):null,Ie=/OculusBrowser/g.test(navigator.userAgent),Re=new WeakMap;let De;const ze=new WeakMap;let je=!1;try{je=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function Ve(Dt,xt){return je?new OffscreenCanvas(Dt,xt):pu("canvas")}function $e(Dt,xt,tn,Qt){let It=1;if((Dt.width>Qt||Dt.height>Qt)&&(It=Qt/Math.max(Dt.width,Dt.height)),It<1||xt===!0){if(typeof HTMLImageElement<"u"&&Dt instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Dt instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Dt instanceof ImageBitmap){const Ht=xt?Vo:Math.floor,_n=Ht(It*Dt.width),it=Ht(It*Dt.height);De===void 0&&(De=Ve(_n,it));const on=tn?Ve(_n,it):De;return on.width=_n,on.height=it,on.getContext("2d").drawImage(Dt,0,0,_n,it),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Dt.width+"x"+Dt.height+") to ("+_n+"x"+it+")."),on}return"data"in Dt&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Dt.width+"x"+Dt.height+")."),Dt}return Dt}function ct(Dt){return nd(Dt.width)&&nd(Dt.height)}function dt(Dt,xt){return Dt.generateMipmaps&&xt&&Dt.minFilter!==Gr&&Dt.minFilter!==Ur}function ft(Dt){ue.generateMipmap(Dt)}function Bt(Dt,xt,tn,Qt,It=!1){if(se===!1)return xt;if(Dt!==null){if(ue[Dt]!==void 0)return ue[Dt];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Dt+"'")}let Ht=xt;return xt===6403&&(tn===5126&&(Ht=33326),tn===5131&&(Ht=33325),tn===5121&&(Ht=33321)),xt===33319&&(tn===5126&&(Ht=33328),tn===5131&&(Ht=33327),tn===5121&&(Ht=33323)),xt===6408&&(tn===5126&&(Ht=34836),tn===5131&&(Ht=34842),tn===5121&&(Ht=Qt===cs&&It===!1?35907:32856),tn===32819&&(Ht=32854),tn===32820&&(Ht=32855)),Ht!==33325&&Ht!==33326&&Ht!==33327&&Ht!==33328&&Ht!==34842&&Ht!==34836||o.get("EXT_color_buffer_float"),Ht}function Lt(Dt,xt,tn){return dt(Dt,tn)===!0||Dt.isFramebufferTexture&&Dt.minFilter!==Gr&&Dt.minFilter!==Ur?Math.log2(Math.max(xt.width,xt.height))+1:Dt.mipmaps!==void 0&&Dt.mipmaps.length>0?Dt.mipmaps.length:Dt.isCompressedTexture&&Array.isArray(Dt.image)?xt.mipmaps.length:1}function Wt(Dt){return Dt===Gr||Dt===Br||Dt===Qr?9728:9729}function qt(Dt){const xt=Dt.target;xt.removeEventListener("dispose",qt),function(tn){const Qt=j.get(tn);if(Qt.__webglInit===void 0)return;const It=tn.source,Ht=ze.get(It);if(Ht){const _n=Ht[Qt.__cacheKey];_n.usedTimes--,_n.usedTimes===0&&En(tn),Object.keys(Ht).length===0&&ze.delete(It)}j.remove(tn)}(xt),xt.isVideoTexture&&Re.delete(xt)}function Ot(Dt){const xt=Dt.target;xt.removeEventListener("dispose",Ot),function(tn){const Qt=tn.texture,It=j.get(tn),Ht=j.get(Qt);if(Ht.__webglTexture!==void 0&&(ue.deleteTexture(Ht.__webglTexture),ie.memory.textures--),tn.depthTexture&&tn.depthTexture.dispose(),tn.isWebGLCubeRenderTarget)for(let _n=0;_n<6;_n++)ue.deleteFramebuffer(It.__webglFramebuffer[_n]),It.__webglDepthbuffer&&ue.deleteRenderbuffer(It.__webglDepthbuffer[_n]);else{if(ue.deleteFramebuffer(It.__webglFramebuffer),It.__webglDepthbuffer&&ue.deleteRenderbuffer(It.__webglDepthbuffer),It.__webglMultisampledFramebuffer&&ue.deleteFramebuffer(It.__webglMultisampledFramebuffer),It.__webglColorRenderbuffer)for(let _n=0;_n<It.__webglColorRenderbuffer.length;_n++)It.__webglColorRenderbuffer[_n]&&ue.deleteRenderbuffer(It.__webglColorRenderbuffer[_n]);It.__webglDepthRenderbuffer&&ue.deleteRenderbuffer(It.__webglDepthRenderbuffer)}if(tn.isWebGLMultipleRenderTargets)for(let _n=0,it=Qt.length;_n<it;_n++){const on=j.get(Qt[_n]);on.__webglTexture&&(ue.deleteTexture(on.__webglTexture),ie.memory.textures--),j.remove(Qt[_n])}j.remove(Qt),j.remove(tn)}(xt)}function En(Dt){const xt=j.get(Dt);ue.deleteTexture(xt.__webglTexture);const tn=Dt.source;delete ze.get(tn)[xt.__cacheKey],ie.memory.textures--}let Ln=0;function wn(Dt,xt){const tn=j.get(Dt);if(Dt.isVideoTexture&&function(Qt){const It=ie.render.frame;Re.get(Qt)!==It&&(Re.set(Qt,It),Qt.update())}(Dt),Dt.isRenderTargetTexture===!1&&Dt.version>0&&tn.__version!==Dt.version){const Qt=Dt.image;if(Qt===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(Qt.complete!==!1)return void Gn(tn,Dt,xt);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}g.activeTexture(33984+xt),g.bindTexture(3553,tn.__webglTexture)}const jn={[pr]:10497,[rr]:33071,[ss]:33648},Wn={[Gr]:9728,[Br]:9984,[Qr]:9986,[Ur]:9729,[ho]:9985,[oi]:9987};function hn(Dt,xt,tn){if(tn?(ue.texParameteri(Dt,10242,jn[xt.wrapS]),ue.texParameteri(Dt,10243,jn[xt.wrapT]),Dt!==32879&&Dt!==35866||ue.texParameteri(Dt,32882,jn[xt.wrapR]),ue.texParameteri(Dt,10240,Wn[xt.magFilter]),ue.texParameteri(Dt,10241,Wn[xt.minFilter])):(ue.texParameteri(Dt,10242,33071),ue.texParameteri(Dt,10243,33071),Dt!==32879&&Dt!==35866||ue.texParameteri(Dt,32882,33071),xt.wrapS===rr&&xt.wrapT===rr||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),ue.texParameteri(Dt,10240,Wt(xt.magFilter)),ue.texParameteri(Dt,10241,Wt(xt.minFilter)),xt.minFilter!==Gr&&xt.minFilter!==Ur&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),o.has("EXT_texture_filter_anisotropic")===!0){const Qt=o.get("EXT_texture_filter_anisotropic");if(xt.type===Zr&&o.has("OES_texture_float_linear")===!1||se===!1&&xt.type===To&&o.has("OES_texture_half_float_linear")===!1)return;(xt.anisotropy>1||j.get(xt).__currentAnisotropy)&&(ue.texParameterf(Dt,Qt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(xt.anisotropy,Y.getMaxAnisotropy())),j.get(xt).__currentAnisotropy=xt.anisotropy)}}function fn(Dt,xt){let tn=!1;Dt.__webglInit===void 0&&(Dt.__webglInit=!0,xt.addEventListener("dispose",qt));const Qt=xt.source;let It=ze.get(Qt);It===void 0&&(It={},ze.set(Qt,It));const Ht=function(_n){const it=[];return it.push(_n.wrapS),it.push(_n.wrapT),it.push(_n.magFilter),it.push(_n.minFilter),it.push(_n.anisotropy),it.push(_n.internalFormat),it.push(_n.format),it.push(_n.type),it.push(_n.generateMipmaps),it.push(_n.premultiplyAlpha),it.push(_n.flipY),it.push(_n.unpackAlignment),it.push(_n.encoding),it.join()}(xt);if(Ht!==Dt.__cacheKey){It[Ht]===void 0&&(It[Ht]={texture:ue.createTexture(),usedTimes:0},ie.memory.textures++,tn=!0),It[Ht].usedTimes++;const _n=It[Dt.__cacheKey];_n!==void 0&&(It[Dt.__cacheKey].usedTimes--,_n.usedTimes===0&&En(xt)),Dt.__cacheKey=Ht,Dt.__webglTexture=It[Ht].texture}return tn}function Gn(Dt,xt,tn){let Qt=3553;xt.isDataArrayTexture&&(Qt=35866),xt.isData3DTexture&&(Qt=32879);const It=fn(Dt,xt),Ht=xt.source;if(g.activeTexture(33984+tn),g.bindTexture(Qt,Dt.__webglTexture),Ht.version!==Ht.__currentVersion||It===!0){ue.pixelStorei(37440,xt.flipY),ue.pixelStorei(37441,xt.premultiplyAlpha),ue.pixelStorei(3317,xt.unpackAlignment),ue.pixelStorei(37443,0);const _n=function(Ui){return!se&&(Ui.wrapS!==rr||Ui.wrapT!==rr||Ui.minFilter!==Gr&&Ui.minFilter!==Ur)}(xt)&&ct(xt.image)===!1;let it=$e(xt.image,_n,!1,be);it=sr(xt,it);const on=ct(it)||se,Xt=ee.convert(xt.format,xt.encoding);let xn,Nn=ee.convert(xt.type),ti=Bt(xt.internalFormat,Xt,Nn,xt.encoding,xt.isVideoTexture);hn(Qt,xt,on);const wi=xt.mipmaps,Gi=se&&xt.isVideoTexture!==!0,Ki=Ht.__currentVersion===void 0||It===!0,Di=Lt(xt,it,on);if(xt.isDepthTexture)ti=6402,se?ti=xt.type===Zr?36012:xt.type===kt?33190:xt.type===bn?35056:33189:xt.type===Zr&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),xt.format===_r&&ti===6402&&xt.type!==io&&xt.type!==kt&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),xt.type=kt,Nn=ee.convert(xt.type)),xt.format===ls&&ti===6402&&(ti=34041,xt.type!==bn&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),xt.type=bn,Nn=ee.convert(xt.type))),Ki&&(Gi?g.texStorage2D(3553,1,ti,it.width,it.height):g.texImage2D(3553,0,ti,it.width,it.height,0,Xt,Nn,null));else if(xt.isDataTexture)if(wi.length>0&&on){Gi&&Ki&&g.texStorage2D(3553,Di,ti,wi[0].width,wi[0].height);for(let Ui=0,Wr=wi.length;Ui<Wr;Ui++)xn=wi[Ui],Gi?g.texSubImage2D(3553,Ui,0,0,xn.width,xn.height,Xt,Nn,xn.data):g.texImage2D(3553,Ui,ti,xn.width,xn.height,0,Xt,Nn,xn.data);xt.generateMipmaps=!1}else Gi?(Ki&&g.texStorage2D(3553,Di,ti,it.width,it.height),g.texSubImage2D(3553,0,0,0,it.width,it.height,Xt,Nn,it.data)):g.texImage2D(3553,0,ti,it.width,it.height,0,Xt,Nn,it.data);else if(xt.isCompressedTexture){Gi&&Ki&&g.texStorage2D(3553,Di,ti,wi[0].width,wi[0].height);for(let Ui=0,Wr=wi.length;Ui<Wr;Ui++)xn=wi[Ui],xt.format!==Ii?Xt!==null?Gi?g.compressedTexSubImage2D(3553,Ui,0,0,xn.width,xn.height,Xt,xn.data):g.compressedTexImage2D(3553,Ui,ti,xn.width,xn.height,0,xn.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Gi?g.texSubImage2D(3553,Ui,0,0,xn.width,xn.height,Xt,Nn,xn.data):g.texImage2D(3553,Ui,ti,xn.width,xn.height,0,Xt,Nn,xn.data)}else if(xt.isDataArrayTexture)Gi?(Ki&&g.texStorage3D(35866,Di,ti,it.width,it.height,it.depth),g.texSubImage3D(35866,0,0,0,0,it.width,it.height,it.depth,Xt,Nn,it.data)):g.texImage3D(35866,0,ti,it.width,it.height,it.depth,0,Xt,Nn,it.data);else if(xt.isData3DTexture)Gi?(Ki&&g.texStorage3D(32879,Di,ti,it.width,it.height,it.depth),g.texSubImage3D(32879,0,0,0,0,it.width,it.height,it.depth,Xt,Nn,it.data)):g.texImage3D(32879,0,ti,it.width,it.height,it.depth,0,Xt,Nn,it.data);else if(xt.isFramebufferTexture){if(Ki)if(Gi)g.texStorage2D(3553,Di,ti,it.width,it.height);else{let Ui=it.width,Wr=it.height;for(let rl=0;rl<Di;rl++)g.texImage2D(3553,rl,ti,Ui,Wr,0,Xt,Nn,null),Ui>>=1,Wr>>=1}}else if(wi.length>0&&on){Gi&&Ki&&g.texStorage2D(3553,Di,ti,wi[0].width,wi[0].height);for(let Ui=0,Wr=wi.length;Ui<Wr;Ui++)xn=wi[Ui],Gi?g.texSubImage2D(3553,Ui,0,0,Xt,Nn,xn):g.texImage2D(3553,Ui,ti,Xt,Nn,xn);xt.generateMipmaps=!1}else Gi?(Ki&&g.texStorage2D(3553,Di,ti,it.width,it.height),g.texSubImage2D(3553,0,0,0,Xt,Nn,it)):g.texImage2D(3553,0,ti,Xt,Nn,it);dt(xt,on)&&ft(Qt),Ht.__currentVersion=Ht.version,xt.onUpdate&&xt.onUpdate(xt)}Dt.__version=xt.version}function Sn(Dt,xt,tn,Qt,It){const Ht=ee.convert(tn.format,tn.encoding),_n=ee.convert(tn.type),it=Bt(tn.internalFormat,Ht,_n,tn.encoding);j.get(xt).__hasExternalTextures||(It===32879||It===35866?g.texImage3D(It,0,it,xt.width,xt.height,xt.depth,0,Ht,_n,null):g.texImage2D(It,0,it,xt.width,xt.height,0,Ht,_n,null)),g.bindFramebuffer(36160,Dt),Ci(xt)?xe.framebufferTexture2DMultisampleEXT(36160,Qt,It,j.get(tn).__webglTexture,0,nr(xt)):ue.framebufferTexture2D(36160,Qt,It,j.get(tn).__webglTexture,0),g.bindFramebuffer(36160,null)}function Hn(Dt,xt,tn){if(ue.bindRenderbuffer(36161,Dt),xt.depthBuffer&&!xt.stencilBuffer){let Qt=33189;if(tn||Ci(xt)){const It=xt.depthTexture;It&&It.isDepthTexture&&(It.type===Zr?Qt=36012:It.type===kt&&(Qt=33190));const Ht=nr(xt);Ci(xt)?xe.renderbufferStorageMultisampleEXT(36161,Ht,Qt,xt.width,xt.height):ue.renderbufferStorageMultisample(36161,Ht,Qt,xt.width,xt.height)}else ue.renderbufferStorage(36161,Qt,xt.width,xt.height);ue.framebufferRenderbuffer(36160,36096,36161,Dt)}else if(xt.depthBuffer&&xt.stencilBuffer){const Qt=nr(xt);tn&&Ci(xt)===!1?ue.renderbufferStorageMultisample(36161,Qt,35056,xt.width,xt.height):Ci(xt)?xe.renderbufferStorageMultisampleEXT(36161,Qt,35056,xt.width,xt.height):ue.renderbufferStorage(36161,34041,xt.width,xt.height),ue.framebufferRenderbuffer(36160,33306,36161,Dt)}else{const Qt=xt.isWebGLMultipleRenderTargets===!0?xt.texture:[xt.texture];for(let It=0;It<Qt.length;It++){const Ht=Qt[It],_n=ee.convert(Ht.format,Ht.encoding),it=ee.convert(Ht.type),on=Bt(Ht.internalFormat,_n,it,Ht.encoding),Xt=nr(xt);tn&&Ci(xt)===!1?ue.renderbufferStorageMultisample(36161,Xt,on,xt.width,xt.height):Ci(xt)?xe.renderbufferStorageMultisampleEXT(36161,Xt,on,xt.width,xt.height):ue.renderbufferStorage(36161,on,xt.width,xt.height)}}ue.bindRenderbuffer(36161,null)}function di(Dt){const xt=j.get(Dt),tn=Dt.isWebGLCubeRenderTarget===!0;if(Dt.depthTexture&&!xt.__autoAllocateDepthBuffer){if(tn)throw new Error("target.depthTexture not supported in Cube render targets");(function(Qt,It){if(It&&It.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(g.bindFramebuffer(36160,Qt),!It.depthTexture||!It.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");j.get(It.depthTexture).__webglTexture&&It.depthTexture.image.width===It.width&&It.depthTexture.image.height===It.height||(It.depthTexture.image.width=It.width,It.depthTexture.image.height=It.height,It.depthTexture.needsUpdate=!0),wn(It.depthTexture,0);const Ht=j.get(It.depthTexture).__webglTexture,_n=nr(It);if(It.depthTexture.format===_r)Ci(It)?xe.framebufferTexture2DMultisampleEXT(36160,36096,3553,Ht,0,_n):ue.framebufferTexture2D(36160,36096,3553,Ht,0);else{if(It.depthTexture.format!==ls)throw new Error("Unknown depthTexture format");Ci(It)?xe.framebufferTexture2DMultisampleEXT(36160,33306,3553,Ht,0,_n):ue.framebufferTexture2D(36160,33306,3553,Ht,0)}})(xt.__webglFramebuffer,Dt)}else if(tn){xt.__webglDepthbuffer=[];for(let Qt=0;Qt<6;Qt++)g.bindFramebuffer(36160,xt.__webglFramebuffer[Qt]),xt.__webglDepthbuffer[Qt]=ue.createRenderbuffer(),Hn(xt.__webglDepthbuffer[Qt],Dt,!1)}else g.bindFramebuffer(36160,xt.__webglFramebuffer),xt.__webglDepthbuffer=ue.createRenderbuffer(),Hn(xt.__webglDepthbuffer,Dt,!1);g.bindFramebuffer(36160,null)}function nr(Dt){return Math.min(Ce,Dt.samples)}function Ci(Dt){const xt=j.get(Dt);return se&&Dt.samples>0&&o.has("WEBGL_multisampled_render_to_texture")===!0&&xt.__useRenderToTexture!==!1}function sr(Dt,xt){const tn=Dt.encoding,Qt=Dt.format,It=Dt.type;return Dt.isCompressedTexture===!0||Dt.isVideoTexture===!0||Dt.format===oh||tn!==na&&(tn===cs?se===!1?o.has("EXT_sRGB")===!0&&Qt===Ii?(Dt.format=oh,Dt.minFilter=Ur,Dt.generateMipmaps=!1):xt=mu.sRGBToLinear(xt):Qt===Ii&&It===Bs||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):tn===RGBM16Encoding||console.error("THREE.WebGLTextures: Unsupported texture encoding:",tn)),xt}this.allocateTextureUnit=function(){const Dt=Ln;return Dt>=de&&console.warn("THREE.WebGLTextures: Trying to use "+Dt+" texture units while this GPU supports only "+de),Ln+=1,Dt},this.resetTextureUnits=function(){Ln=0},this.setTexture2D=wn,this.setTexture2DArray=function(Dt,xt){const tn=j.get(Dt);Dt.version>0&&tn.__version!==Dt.version?Gn(tn,Dt,xt):(g.activeTexture(33984+xt),g.bindTexture(35866,tn.__webglTexture))},this.setTexture3D=function(Dt,xt){const tn=j.get(Dt);Dt.version>0&&tn.__version!==Dt.version?Gn(tn,Dt,xt):(g.activeTexture(33984+xt),g.bindTexture(32879,tn.__webglTexture))},this.setTextureCube=function(Dt,xt){const tn=j.get(Dt);Dt.version>0&&tn.__version!==Dt.version?function(Qt,It,Ht){if(It.image.length!==6)return;const _n=fn(Qt,It),it=It.source;if(g.activeTexture(33984+Ht),g.bindTexture(34067,Qt.__webglTexture),it.version!==it.__currentVersion||_n===!0){ue.pixelStorei(37440,It.flipY),ue.pixelStorei(37441,It.premultiplyAlpha),ue.pixelStorei(3317,It.unpackAlignment),ue.pixelStorei(37443,0);const on=It.isCompressedTexture||It.image[0].isCompressedTexture,Xt=It.image[0]&&It.image[0].isDataTexture,xn=[];for(let zi=0;zi<6;zi++)xn[zi]=on||Xt?Xt?It.image[zi].image:It.image[zi]:$e(It.image[zi],!1,!0,pe),xn[zi]=sr(It,xn[zi]);const Nn=xn[0],ti=ct(Nn)||se,wi=ee.convert(It.format,It.encoding),Gi=ee.convert(It.type),Ki=Bt(It.internalFormat,wi,Gi,It.encoding),Di=se&&It.isVideoTexture!==!0,Ui=it.__currentVersion===void 0||_n===!0;let Wr,rl=Lt(It,Nn,ti);if(hn(34067,It,ti),on){Di&&Ui&&g.texStorage2D(34067,rl,Ki,Nn.width,Nn.height);for(let zi=0;zi<6;zi++){Wr=xn[zi].mipmaps;for(let qr=0;qr<Wr.length;qr++){const Jr=Wr[qr];It.format!==Ii?wi!==null?Di?g.compressedTexSubImage2D(34069+zi,qr,0,0,Jr.width,Jr.height,wi,Jr.data):g.compressedTexImage2D(34069+zi,qr,Ki,Jr.width,Jr.height,0,Jr.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Di?g.texSubImage2D(34069+zi,qr,0,0,Jr.width,Jr.height,wi,Gi,Jr.data):g.texImage2D(34069+zi,qr,Ki,Jr.width,Jr.height,0,wi,Gi,Jr.data)}}}else{Wr=It.mipmaps,Di&&Ui&&(Wr.length>0&&rl++,g.texStorage2D(34067,rl,Ki,xn[0].width,xn[0].height));for(let zi=0;zi<6;zi++)if(Xt){Di?g.texSubImage2D(34069+zi,0,0,0,xn[zi].width,xn[zi].height,wi,Gi,xn[zi].data):g.texImage2D(34069+zi,0,Ki,xn[zi].width,xn[zi].height,0,wi,Gi,xn[zi].data);for(let qr=0;qr<Wr.length;qr++){const Jr=Wr[qr].image[zi].image;Di?g.texSubImage2D(34069+zi,qr+1,0,0,Jr.width,Jr.height,wi,Gi,Jr.data):g.texImage2D(34069+zi,qr+1,Ki,Jr.width,Jr.height,0,wi,Gi,Jr.data)}}else{Di?g.texSubImage2D(34069+zi,0,0,0,wi,Gi,xn[zi]):g.texImage2D(34069+zi,0,Ki,wi,Gi,xn[zi]);for(let qr=0;qr<Wr.length;qr++){const Jr=Wr[qr];Di?g.texSubImage2D(34069+zi,qr+1,0,0,wi,Gi,Jr.image[zi]):g.texImage2D(34069+zi,qr+1,Ki,wi,Gi,Jr.image[zi])}}}dt(It,ti)&&ft(34067),it.__currentVersion=it.version,It.onUpdate&&It.onUpdate(It)}Qt.__version=It.version}(tn,Dt,xt):(g.activeTexture(33984+xt),g.bindTexture(34067,tn.__webglTexture))},this.rebindTextures=function(Dt,xt,tn){const Qt=j.get(Dt);xt!==void 0&&Sn(Qt.__webglFramebuffer,Dt,Dt.texture,36064,3553),tn!==void 0&&di(Dt)},this.setupRenderTarget=function(Dt){const xt=Dt.texture,tn=j.get(Dt),Qt=j.get(xt);Dt.addEventListener("dispose",Ot),Dt.isWebGLMultipleRenderTargets!==!0&&(Qt.__webglTexture===void 0&&(Qt.__webglTexture=ue.createTexture()),Qt.__version=xt.version,ie.memory.textures++);const It=Dt.isWebGLCubeRenderTarget===!0,Ht=Dt.isWebGLMultipleRenderTargets===!0,_n=ct(Dt)||se;if(It){tn.__webglFramebuffer=[];for(let it=0;it<6;it++)tn.__webglFramebuffer[it]=ue.createFramebuffer()}else{if(tn.__webglFramebuffer=ue.createFramebuffer(),Ht)if(Y.drawBuffers){const it=Dt.texture;for(let on=0,Xt=it.length;on<Xt;on++){const xn=j.get(it[on]);xn.__webglTexture===void 0&&(xn.__webglTexture=ue.createTexture(),ie.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(se&&Dt.samples>0&&Ci(Dt)===!1){const it=Ht?xt:[xt];tn.__webglMultisampledFramebuffer=ue.createFramebuffer(),tn.__webglColorRenderbuffer=[],g.bindFramebuffer(36160,tn.__webglMultisampledFramebuffer);for(let on=0;on<it.length;on++){const Xt=it[on];tn.__webglColorRenderbuffer[on]=ue.createRenderbuffer(),ue.bindRenderbuffer(36161,tn.__webglColorRenderbuffer[on]);const xn=ee.convert(Xt.format,Xt.encoding),Nn=ee.convert(Xt.type),ti=Bt(Xt.internalFormat,xn,Nn,Xt.encoding),wi=nr(Dt);ue.renderbufferStorageMultisample(36161,wi,ti,Dt.width,Dt.height),ue.framebufferRenderbuffer(36160,36064+on,36161,tn.__webglColorRenderbuffer[on])}ue.bindRenderbuffer(36161,null),Dt.depthBuffer&&(tn.__webglDepthRenderbuffer=ue.createRenderbuffer(),Hn(tn.__webglDepthRenderbuffer,Dt,!0)),g.bindFramebuffer(36160,null)}}if(It){g.bindTexture(34067,Qt.__webglTexture),hn(34067,xt,_n);for(let it=0;it<6;it++)Sn(tn.__webglFramebuffer[it],Dt,xt,36064,34069+it);dt(xt,_n)&&ft(34067),g.unbindTexture()}else if(Ht){const it=Dt.texture;for(let on=0,Xt=it.length;on<Xt;on++){const xn=it[on],Nn=j.get(xn);g.bindTexture(3553,Nn.__webglTexture),hn(3553,xn,_n),Sn(tn.__webglFramebuffer,Dt,xn,36064+on,3553),dt(xn,_n)&&ft(3553)}g.unbindTexture()}else{let it=3553;(Dt.isWebGL3DRenderTarget||Dt.isWebGLArrayRenderTarget)&&(se?it=Dt.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),g.bindTexture(it,Qt.__webglTexture),hn(it,xt,_n),Sn(tn.__webglFramebuffer,Dt,xt,36064,it),dt(xt,_n)&&ft(it),g.unbindTexture()}Dt.depthBuffer&&di(Dt)},this.updateRenderTargetMipmap=function(Dt){const xt=ct(Dt)||se,tn=Dt.isWebGLMultipleRenderTargets===!0?Dt.texture:[Dt.texture],Qt=Dt.isWebGLCubeRenderTarget?34067:3553;for(let It=0,Ht=tn.length;It<Ht;It++){const _n=tn[It],it=j.get(_n),on=it.__webglTexture;it.__version!==_n.version&&(g.bindTexture(Qt,on),hn(Qt,_n,xt),g.unbindTexture(),it.__version=_n.version),dt(_n,xt)&&(g.bindTexture(Qt,on),ft(Qt),g.unbindTexture())}},this.updateMultisampleRenderTarget=function(Dt){if(se&&Dt.samples>0&&Ci(Dt)===!1){const xt=Dt.isWebGLMultipleRenderTargets?Dt.texture:[Dt.texture],tn=Dt.width,Qt=Dt.height;let It=16384;const Ht=[],_n=Dt.stencilBuffer?33306:36096,it=j.get(Dt),on=Dt.isWebGLMultipleRenderTargets===!0;if(on)for(let Xt=0;Xt<xt.length;Xt++)g.bindFramebuffer(36160,it.__webglMultisampledFramebuffer),ue.framebufferRenderbuffer(36160,36064+Xt,36161,null),g.bindFramebuffer(36160,it.__webglFramebuffer),ue.framebufferTexture2D(36009,36064+Xt,3553,null,0);g.bindFramebuffer(36008,it.__webglMultisampledFramebuffer),g.bindFramebuffer(36009,it.__webglFramebuffer);for(let Xt=0;Xt<xt.length;Xt++){Ht.push(36064+Xt),Dt.depthBuffer&&Ht.push(_n);const xn=it.__ignoreDepthValues!==void 0&&it.__ignoreDepthValues;if(xn===!1&&(Dt.depthBuffer&&(It|=256),Dt.stencilBuffer&&(It|=1024)),on&&ue.framebufferRenderbuffer(36008,36064,36161,it.__webglColorRenderbuffer[Xt]),xn===!0&&(ue.invalidateFramebuffer(36008,[_n]),ue.invalidateFramebuffer(36009,[_n])),on){const Nn=j.get(xt[Xt]).__webglTexture;ue.framebufferTexture2D(36009,36064,3553,Nn,0)}ue.blitFramebuffer(0,0,tn,Qt,0,0,tn,Qt,It,9728),Ie&&ue.invalidateFramebuffer(36008,Ht)}if(g.bindFramebuffer(36008,null),g.bindFramebuffer(36009,null),on)for(let Xt=0;Xt<xt.length;Xt++){g.bindFramebuffer(36160,it.__webglMultisampledFramebuffer),ue.framebufferRenderbuffer(36160,36064+Xt,36161,it.__webglColorRenderbuffer[Xt]);const xn=j.get(xt[Xt]).__webglTexture;g.bindFramebuffer(36160,it.__webglFramebuffer),ue.framebufferTexture2D(36009,36064+Xt,3553,xn,0)}g.bindFramebuffer(36009,it.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=di,this.setupFrameBufferTexture=Sn,this.useMultisampledRTT=Ci}function Yv(ue,o,g){const j=g.isWebGL2;return{convert:function(Y,ee=null){let ie;if(Y===Bs)return 5121;if(Y===Bi)return 32819;if(Y===qn)return 32820;if(Y===as)return 5120;if(Y===po)return 5122;if(Y===io)return 5123;if(Y===ea)return 5124;if(Y===kt)return 5125;if(Y===Zr)return 5126;if(Y===To)return j?5131:(ie=o.get("OES_texture_half_float"),ie!==null?ie.HALF_FLOAT_OES:null);if(Y===Mi)return 6406;if(Y===Ii)return 6408;if(Y===Fr)return 6409;if(Y===Sr)return 6410;if(Y===_r)return 6402;if(Y===ls)return 34041;if(Y===Ss)return 6403;if(Y===ki)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(Y===oh)return ie=o.get("EXT_sRGB"),ie!==null?ie.SRGB_ALPHA_EXT:null;if(Y===Ir)return 36244;if(Y===es)return 33319;if(Y===Io)return 33320;if(Y===Cs)return 36249;if(Y===kr||Y===Hr||Y===Vi||Y===Ys)if(ee===cs){if(ie=o.get("WEBGL_compressed_texture_s3tc_srgb"),ie===null)return null;if(Y===kr)return ie.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(Y===Hr)return ie.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(Y===Vi)return ie.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(Y===Ys)return ie.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(ie=o.get("WEBGL_compressed_texture_s3tc"),ie===null)return null;if(Y===kr)return ie.COMPRESSED_RGB_S3TC_DXT1_EXT;if(Y===Hr)return ie.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(Y===Vi)return ie.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(Y===Ys)return ie.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(Y===Ms||Y===os||Y===vr||Y===Xn){if(ie=o.get("WEBGL_compressed_texture_pvrtc"),ie===null)return null;if(Y===Ms)return ie.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(Y===os)return ie.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(Y===vr)return ie.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(Y===Xn)return ie.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(Y===Ha)return ie=o.get("WEBGL_compressed_texture_etc1"),ie!==null?ie.COMPRESSED_RGB_ETC1_WEBGL:null;if(Y===ai||Y===fo){if(ie=o.get("WEBGL_compressed_texture_etc"),ie===null)return null;if(Y===ai)return ee===cs?ie.COMPRESSED_SRGB8_ETC2:ie.COMPRESSED_RGB8_ETC2;if(Y===fo)return ee===cs?ie.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:ie.COMPRESSED_RGBA8_ETC2_EAC}if(Y===Xs||Y===lr||Y===cr||Y===ml||Y===su||Y===Ec||Y===ou||Y===ur||Y===Ju||Y===$u||Y===jl||Y===Sc||Y===Zu||Y===Xr){if(ie=o.get("WEBGL_compressed_texture_astc"),ie===null)return null;if(Y===Xs)return ee===cs?ie.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:ie.COMPRESSED_RGBA_ASTC_4x4_KHR;if(Y===lr)return ee===cs?ie.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:ie.COMPRESSED_RGBA_ASTC_5x4_KHR;if(Y===cr)return ee===cs?ie.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:ie.COMPRESSED_RGBA_ASTC_5x5_KHR;if(Y===ml)return ee===cs?ie.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:ie.COMPRESSED_RGBA_ASTC_6x5_KHR;if(Y===su)return ee===cs?ie.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:ie.COMPRESSED_RGBA_ASTC_6x6_KHR;if(Y===Ec)return ee===cs?ie.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:ie.COMPRESSED_RGBA_ASTC_8x5_KHR;if(Y===ou)return ee===cs?ie.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:ie.COMPRESSED_RGBA_ASTC_8x6_KHR;if(Y===ur)return ee===cs?ie.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:ie.COMPRESSED_RGBA_ASTC_8x8_KHR;if(Y===Ju)return ee===cs?ie.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:ie.COMPRESSED_RGBA_ASTC_10x5_KHR;if(Y===$u)return ee===cs?ie.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:ie.COMPRESSED_RGBA_ASTC_10x6_KHR;if(Y===jl)return ee===cs?ie.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:ie.COMPRESSED_RGBA_ASTC_10x8_KHR;if(Y===Sc)return ee===cs?ie.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:ie.COMPRESSED_RGBA_ASTC_10x10_KHR;if(Y===Zu)return ee===cs?ie.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:ie.COMPRESSED_RGBA_ASTC_12x10_KHR;if(Y===Xr)return ee===cs?ie.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:ie.COMPRESSED_RGBA_ASTC_12x12_KHR}if(Y===jr){if(ie=o.get("EXT_texture_compression_bptc"),ie===null)return null;if(Y===jr)return ee===cs?ie.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:ie.COMPRESSED_RGBA_BPTC_UNORM_EXT}return Y===bn?j?34042:(ie=o.get("WEBGL_depth_texture"),ie!==null?ie.UNSIGNED_INT_24_8_WEBGL:null):ue[Y]!==void 0?ue[Y]:null}}}class Wg extends ko{constructor(o=[]){super(),this.isArrayCamera=!0,this.cameras=o}}class Tu extends Ar{constructor(){super(),this.isGroup=!0,this.type="Group"}}const ty={type:"move"};class $f{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Tu,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Tu,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new vt,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new vt),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Tu,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new vt,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new vt),this._grip}dispatchEvent(o){return this._targetRay!==null&&this._targetRay.dispatchEvent(o),this._grip!==null&&this._grip.dispatchEvent(o),this._hand!==null&&this._hand.dispatchEvent(o),this}disconnect(o){return this.dispatchEvent({type:"disconnected",data:o}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(o,g,j){let Y=null,ee=null,ie=null;const se=this._targetRay,de=this._grip,pe=this._hand;if(o&&g.session.visibilityState!=="visible-blurred"){if(pe&&o.hand){ie=!0;for(const De of o.hand.values()){const ze=g.getJointPose(De,j);if(pe.joints[De.jointName]===void 0){const Ve=new Tu;Ve.matrixAutoUpdate=!1,Ve.visible=!1,pe.joints[De.jointName]=Ve,pe.add(Ve)}const je=pe.joints[De.jointName];ze!==null&&(je.matrix.fromArray(ze.transform.matrix),je.matrix.decompose(je.position,je.rotation,je.scale),je.jointRadius=ze.radius),je.visible=ze!==null}const be=pe.joints["index-finger-tip"],Ce=pe.joints["thumb-tip"],xe=be.position.distanceTo(Ce.position),Ie=.02,Re=.005;pe.inputState.pinching&&xe>Ie+Re?(pe.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:o.handedness,target:this})):!pe.inputState.pinching&&xe<=Ie-Re&&(pe.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:o.handedness,target:this}))}else de!==null&&o.gripSpace&&(ee=g.getPose(o.gripSpace,j),ee!==null&&(de.matrix.fromArray(ee.transform.matrix),de.matrix.decompose(de.position,de.rotation,de.scale),ee.linearVelocity?(de.hasLinearVelocity=!0,de.linearVelocity.copy(ee.linearVelocity)):de.hasLinearVelocity=!1,ee.angularVelocity?(de.hasAngularVelocity=!0,de.angularVelocity.copy(ee.angularVelocity)):de.hasAngularVelocity=!1));se!==null&&(Y=g.getPose(o.targetRaySpace,j),Y===null&&ee!==null&&(Y=ee),Y!==null&&(se.matrix.fromArray(Y.transform.matrix),se.matrix.decompose(se.position,se.rotation,se.scale),Y.linearVelocity?(se.hasLinearVelocity=!0,se.linearVelocity.copy(Y.linearVelocity)):se.hasLinearVelocity=!1,Y.angularVelocity?(se.hasAngularVelocity=!0,se.angularVelocity.copy(Y.angularVelocity)):se.hasAngularVelocity=!1,this.dispatchEvent(ty)))}return se!==null&&(se.visible=Y!==null),de!==null&&(de.visible=ee!==null),pe!==null&&(pe.visible=ie!==null),this}}class qg extends vs{constructor(o,g,j,Y,ee,ie,se,de,pe,be){if((be=be!==void 0?be:_r)!==_r&&be!==ls)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");j===void 0&&be===_r&&(j=kt),j===void 0&&be===ls&&(j=bn),super(null,Y,ee,ie,se,de,be,j,pe),this.isDepthTexture=!0,this.image={width:o,height:g},this.magFilter=se!==void 0?se:Gr,this.minFilter=de!==void 0?de:Gr,this.flipY=!1,this.generateMipmaps=!1}}class Xv extends va{constructor(o,g){super();const j=this;let Y=null,ee=1,ie=null,se="local-floor",de=null,pe=null,be=null,Ce=null,xe=null,Ie=null;const Re=g.getContextAttributes();let De=null,ze=null;const je=[],Ve=[],$e=new ko;$e.layers.enable(1),$e.viewport=new Vr;const ct=new ko;ct.layers.enable(2),ct.viewport=new Vr;const dt=[$e,ct],ft=new Wg;ft.layers.enable(1),ft.layers.enable(2);let Bt=null,Lt=null;function Wt(hn){const fn=Ve.indexOf(hn.inputSource);if(fn===-1)return;const Gn=je[fn];Gn!==void 0&&Gn.dispatchEvent({type:hn.type,data:hn.inputSource})}function qt(){Y.removeEventListener("select",Wt),Y.removeEventListener("selectstart",Wt),Y.removeEventListener("selectend",Wt),Y.removeEventListener("squeeze",Wt),Y.removeEventListener("squeezestart",Wt),Y.removeEventListener("squeezeend",Wt),Y.removeEventListener("end",qt),Y.removeEventListener("inputsourceschange",Ot);for(let hn=0;hn<je.length;hn++){const fn=Ve[hn];fn!==null&&(Ve[hn]=null,je[hn].disconnect(fn))}Bt=null,Lt=null,o.setRenderTarget(De),xe=null,Ce=null,be=null,Y=null,ze=null,Wn.stop(),j.isPresenting=!1,j.dispatchEvent({type:"sessionend"})}function Ot(hn){for(let fn=0;fn<hn.removed.length;fn++){const Gn=hn.removed[fn],Sn=Ve.indexOf(Gn);Sn>=0&&(Ve[Sn]=null,je[Sn].dispatchEvent({type:"disconnected",data:Gn}))}for(let fn=0;fn<hn.added.length;fn++){const Gn=hn.added[fn];let Sn=Ve.indexOf(Gn);if(Sn===-1){for(let di=0;di<je.length;di++){if(di>=Ve.length){Ve.push(Gn),Sn=di;break}if(Ve[di]===null){Ve[di]=Gn,Sn=di;break}}if(Sn===-1)break}const Hn=je[Sn];Hn&&Hn.dispatchEvent({type:"connected",data:Gn})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(hn){let fn=je[hn];return fn===void 0&&(fn=new $f,je[hn]=fn),fn.getTargetRaySpace()},this.getControllerGrip=function(hn){let fn=je[hn];return fn===void 0&&(fn=new $f,je[hn]=fn),fn.getGripSpace()},this.getHand=function(hn){let fn=je[hn];return fn===void 0&&(fn=new $f,je[hn]=fn),fn.getHandSpace()},this.setFramebufferScaleFactor=function(hn){ee=hn,j.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(hn){se=hn,j.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return de||ie},this.setReferenceSpace=function(hn){de=hn},this.getBaseLayer=function(){return Ce!==null?Ce:xe},this.getBinding=function(){return be},this.getFrame=function(){return Ie},this.getSession=function(){return Y},this.setSession=async function(hn){if(Y=hn,Y!==null){if(De=o.getRenderTarget(),Y.addEventListener("select",Wt),Y.addEventListener("selectstart",Wt),Y.addEventListener("selectend",Wt),Y.addEventListener("squeeze",Wt),Y.addEventListener("squeezestart",Wt),Y.addEventListener("squeezeend",Wt),Y.addEventListener("end",qt),Y.addEventListener("inputsourceschange",Ot),Re.xrCompatible!==!0&&await g.makeXRCompatible(),Y.renderState.layers===void 0||o.capabilities.isWebGL2===!1){const fn={antialias:Y.renderState.layers!==void 0||Re.antialias,alpha:Re.alpha,depth:Re.depth,stencil:Re.stencil,framebufferScaleFactor:ee};xe=new XRWebGLLayer(Y,g,fn),Y.updateRenderState({baseLayer:xe}),ze=new Aa(xe.framebufferWidth,xe.framebufferHeight,{format:Ii,type:Bs,encoding:o.outputEncoding,stencilBuffer:Re.stencil})}else{let fn=null,Gn=null,Sn=null;Re.depth&&(Sn=Re.stencil?35056:33190,fn=Re.stencil?ls:_r,Gn=Re.stencil?bn:kt);const Hn={colorFormat:32856,depthFormat:Sn,scaleFactor:ee};be=new XRWebGLBinding(Y,g),Ce=be.createProjectionLayer(Hn),Y.updateRenderState({layers:[Ce]}),ze=new Aa(Ce.textureWidth,Ce.textureHeight,{format:Ii,type:Bs,depthTexture:new qg(Ce.textureWidth,Ce.textureHeight,Gn,void 0,void 0,void 0,void 0,void 0,void 0,fn),stencilBuffer:Re.stencil,encoding:o.outputEncoding,samples:Re.antialias?4:0}),o.properties.get(ze).__ignoreDepthValues=Ce.ignoreDepthValues}ze.isXRRenderTarget=!0,this.setFoveation(1),de=null,ie=await Y.requestReferenceSpace(se),Wn.setContext(Y),Wn.start(),j.isPresenting=!0,j.dispatchEvent({type:"sessionstart"})}};const En=new vt,Ln=new vt;function wn(hn,fn){fn===null?hn.matrixWorld.copy(hn.matrix):hn.matrixWorld.multiplyMatrices(fn.matrixWorld,hn.matrix),hn.matrixWorldInverse.copy(hn.matrixWorld).invert()}this.updateCamera=function(hn){if(Y===null)return;ft.near=ct.near=$e.near=hn.near,ft.far=ct.far=$e.far=hn.far,Bt===ft.near&&Lt===ft.far||(Y.updateRenderState({depthNear:ft.near,depthFar:ft.far}),Bt=ft.near,Lt=ft.far);const fn=hn.parent,Gn=ft.cameras;wn(ft,fn);for(let Hn=0;Hn<Gn.length;Hn++)wn(Gn[Hn],fn);ft.matrixWorld.decompose(ft.position,ft.quaternion,ft.scale),hn.matrix.copy(ft.matrix),hn.matrix.decompose(hn.position,hn.quaternion,hn.scale);const Sn=hn.children;for(let Hn=0,di=Sn.length;Hn<di;Hn++)Sn[Hn].updateMatrixWorld(!0);Gn.length===2?function(Hn,di,nr){En.setFromMatrixPosition(di.matrixWorld),Ln.setFromMatrixPosition(nr.matrixWorld);const Ci=En.distanceTo(Ln),sr=di.projectionMatrix.elements,Dt=nr.projectionMatrix.elements,xt=sr[14]/(sr[10]-1),tn=sr[14]/(sr[10]+1),Qt=(sr[9]+1)/sr[5],It=(sr[9]-1)/sr[5],Ht=(sr[8]-1)/sr[0],_n=(Dt[8]+1)/Dt[0],it=xt*Ht,on=xt*_n,Xt=Ci/(-Ht+_n),xn=Xt*-Ht;di.matrixWorld.decompose(Hn.position,Hn.quaternion,Hn.scale),Hn.translateX(xn),Hn.translateZ(Xt),Hn.matrixWorld.compose(Hn.position,Hn.quaternion,Hn.scale),Hn.matrixWorldInverse.copy(Hn.matrixWorld).invert();const Nn=xt+Xt,ti=tn+Xt,wi=it-xn,Gi=on+(Ci-xn),Ki=Qt*tn/ti*Nn,Di=It*tn/ti*Nn;Hn.projectionMatrix.makePerspective(wi,Gi,Ki,Di,Nn,ti)}(ft,$e,ct):ft.projectionMatrix.copy($e.projectionMatrix)},this.getCamera=function(){return ft},this.getFoveation=function(){return Ce!==null?Ce.fixedFoveation:xe!==null?xe.fixedFoveation:void 0},this.setFoveation=function(hn){Ce!==null&&(Ce.fixedFoveation=hn),xe!==null&&xe.fixedFoveation!==void 0&&(xe.fixedFoveation=hn)};let jn=null;this.onPreAnimationFrameCallback=null;const Wn=new Mg;Wn.setAnimationLoop(function(hn,fn){if(j.onPreAnimationFrameCallback&&j.onPreAnimationFrameCallback(hn,fn),pe=fn.getViewerPose(de||ie),Ie=fn,pe!==null){const Gn=pe.views;xe!==null&&(o.setRenderTargetFramebuffer(ze,xe.framebuffer),o.setRenderTarget(ze));let Sn=!1;Gn.length!==ft.cameras.length&&(ft.cameras.length=0,Sn=!0);for(let Hn=0;Hn<Gn.length;Hn++){const di=Gn[Hn];let nr=null;if(xe!==null)nr=xe.getViewport(di);else{const sr=be.getViewSubImage(Ce,di);nr=sr.viewport,Hn===0&&(o.setRenderTargetTextures(ze,sr.colorTexture,Ce.ignoreDepthValues?void 0:sr.depthStencilTexture),o.setRenderTarget(ze))}let Ci=dt[Hn];Ci===void 0&&(Ci=new ko,Ci.layers.enable(Hn),Ci.viewport=new Vr,dt[Hn]=Ci),Ci.matrix.fromArray(di.transform.matrix),Ci.projectionMatrix.fromArray(di.projectionMatrix),Ci.viewport.set(nr.x,nr.y,nr.width,nr.height),Hn===0&&ft.matrix.copy(Ci.matrix),Sn===!0&&ft.cameras.push(Ci)}}for(let Gn=0;Gn<je.length;Gn++){const Sn=Ve[Gn],Hn=je[Gn];Sn!==null&&Hn!==void 0&&Hn.update(Sn,fn,de||ie)}jn&&jn(hn,fn),Ie=null}),this.setAnimationLoop=function(hn){jn=hn},this.dispose=function(){}}}function ny(ue,o){function g(j,Y){j.opacity.value=Y.opacity,Y.color&&j.diffuse.value.copy(Y.color),Y.emissive&&j.emissive.value.copy(Y.emissive).multiplyScalar(Y.emissiveIntensity),Y.map&&(j.map.value=Y.map),Y.alphaMap&&(j.alphaMap.value=Y.alphaMap),Y.bumpMap&&(j.bumpMap.value=Y.bumpMap,j.bumpScale.value=Y.bumpScale,Y.side===Ue&&(j.bumpScale.value*=-1)),Y.displacementMap&&(j.displacementMap.value=Y.displacementMap,j.displacementScale.value=Y.displacementScale,j.displacementBias.value=Y.displacementBias),Y.emissiveMap&&(j.emissiveMap.value=Y.emissiveMap),Y.normalMap&&(j.normalMap.value=Y.normalMap,j.normalScale.value.copy(Y.normalScale),Y.side===Ue&&j.normalScale.value.negate()),Y.specularMap&&(j.specularMap.value=Y.specularMap),Y.alphaTest>0&&(j.alphaTest.value=Y.alphaTest);const ee=o.get(Y).envMap;if(ee){j.envMap.value=ee;const de=o.get(Y).environment||ee;j.envMapRotation.value=de?de.rotation:0,j.flipEnvMap.value=ee.isCubeTexture&&ee.isRenderTargetTexture===!1?-1:1,j.reflectivity.value=Y.reflectivity,j.ior.value=Y.ior,j.refractionRatio.value=Y.refractionRatio}if(Y.lightMap){j.lightMap.value=Y.lightMap;const de=ue.physicallyCorrectLights!==!0?Math.PI:1;j.lightMapIntensity.value=Y.lightMapIntensity*de}let ie,se;Y.aoMap&&(j.aoMap.value=Y.aoMap,j.aoMapIntensity.value=Y.aoMapIntensity),Y.map?ie=Y.map:Y.specularMap?ie=Y.specularMap:Y.displacementMap?ie=Y.displacementMap:Y.normalMap?ie=Y.normalMap:Y.bumpMap?ie=Y.bumpMap:Y.roughnessMap?ie=Y.roughnessMap:Y.metalnessMap?ie=Y.metalnessMap:Y.alphaMap?ie=Y.alphaMap:Y.emissiveMap?ie=Y.emissiveMap:Y.clearcoatMap?ie=Y.clearcoatMap:Y.clearcoatNormalMap?ie=Y.clearcoatNormalMap:Y.clearcoatRoughnessMap?ie=Y.clearcoatRoughnessMap:Y.iridescenceMap?ie=Y.iridescenceMap:Y.iridescenceThicknessMap?ie=Y.iridescenceThicknessMap:Y.specularIntensityMap?ie=Y.specularIntensityMap:Y.specularColorMap?ie=Y.specularColorMap:Y.transmissionMap?ie=Y.transmissionMap:Y.thicknessMap?ie=Y.thicknessMap:Y.sheenColorMap?ie=Y.sheenColorMap:Y.sheenRoughnessMap&&(ie=Y.sheenRoughnessMap),ie!==void 0&&(ie.isWebGLRenderTarget&&(ie=ie.texture),ie.matrixAutoUpdate===!0&&ie.updateMatrix(),j.uvTransform.value.copy(ie.matrix)),Y.aoMap?se=Y.aoMap:Y.lightMap&&(se=Y.lightMap),se!==void 0&&(se.isWebGLRenderTarget&&(se=se.texture),se.matrixAutoUpdate===!0&&se.updateMatrix(),j.uv2Transform.value.copy(se.matrix))}return{refreshFogUniforms:function(j,Y){j.fogColor.value.copy(Y.color),Y.isFog?(j.fogNear.value=Y.near,j.fogFar.value=Y.far):Y.isFogExp2&&(j.fogDensity.value=Y.density)},refreshMaterialUniforms:function(j,Y,ee,ie,se){Y.isMeshBasicMaterial||Y.isMeshLambertMaterial?g(j,Y):Y.isMeshToonMaterial?(g(j,Y),function(de,pe){pe.gradientMap&&(de.gradientMap.value=pe.gradientMap)}(j,Y)):Y.isMeshPhongMaterial?(g(j,Y),function(de,pe){de.specular.value.copy(pe.specular),de.shininess.value=Math.max(pe.shininess,1e-4)}(j,Y)):Y.isMeshStandardMaterial?(g(j,Y),function(de,pe){de.roughness.value=pe.roughness,de.metalness.value=pe.metalness,pe.roughnessMap&&(de.roughnessMap.value=pe.roughnessMap),pe.metalnessMap&&(de.metalnessMap.value=pe.metalnessMap),o.get(pe).envMap&&(de.envMapIntensity.value=pe.envMapIntensity)}(j,Y),Y.isMeshPhysicalMaterial&&function(de,pe,be){de.ior.value=pe.ior,pe.sheen>0&&(de.sheenColor.value.copy(pe.sheenColor).multiplyScalar(pe.sheen),de.sheenRoughness.value=pe.sheenRoughness,pe.sheenColorMap&&(de.sheenColorMap.value=pe.sheenColorMap),pe.sheenRoughnessMap&&(de.sheenRoughnessMap.value=pe.sheenRoughnessMap)),pe.clearcoat>0&&(de.clearcoat.value=pe.clearcoat,de.clearcoatRoughness.value=pe.clearcoatRoughness,pe.clearcoatMap&&(de.clearcoatMap.value=pe.clearcoatMap),pe.clearcoatRoughnessMap&&(de.clearcoatRoughnessMap.value=pe.clearcoatRoughnessMap),pe.clearcoatNormalMap&&(de.clearcoatNormalScale.value.copy(pe.clearcoatNormalScale),de.clearcoatNormalMap.value=pe.clearcoatNormalMap,pe.side===Ue&&de.clearcoatNormalScale.value.negate())),pe.iridescence>0&&(de.iridescence.value=pe.iridescence,de.iridescenceIOR.value=pe.iridescenceIOR,de.iridescenceThicknessMinimum.value=pe.iridescenceThicknessRange[0],de.iridescenceThicknessMaximum.value=pe.iridescenceThicknessRange[1],pe.iridescenceMap&&(de.iridescenceMap.value=pe.iridescenceMap),pe.iridescenceThicknessMap&&(de.iridescenceThicknessMap.value=pe.iridescenceThicknessMap)),pe.transmission>0&&(de.transmission.value=pe.transmission,de.transmissionSamplerMap.value=be.texture,de.transmissionSamplerSize.value.set(be.width,be.height),pe.transmissionMap&&(de.transmissionMap.value=pe.transmissionMap),de.thickness.value=pe.thickness,pe.thicknessMap&&(de.thicknessMap.value=pe.thicknessMap),de.attenuationDistance.value=pe.attenuationDistance,de.attenuationColor.value.copy(pe.attenuationColor)),de.specularIntensity.value=pe.specularIntensity,de.specularColor.value.copy(pe.specularColor),pe.specularIntensityMap&&(de.specularIntensityMap.value=pe.specularIntensityMap),pe.specularColorMap&&(de.specularColorMap.value=pe.specularColorMap)}(j,Y,se)):Y.isMeshMatcapMaterial?(g(j,Y),function(de,pe){pe.matcap&&(de.matcap.value=pe.matcap)}(j,Y)):Y.isMeshDepthMaterial?g(j,Y):Y.isMeshDistanceMaterial?(g(j,Y),function(de,pe){de.referencePosition.value.copy(pe.referencePosition),de.nearDistance.value=pe.nearDistance,de.farDistance.value=pe.farDistance}(j,Y)):Y.isMeshNormalMaterial?g(j,Y):Y.isLineBasicMaterial?(function(de,pe){de.diffuse.value.copy(pe.color),de.opacity.value=pe.opacity}(j,Y),Y.isLineDashedMaterial&&function(de,pe){de.dashSize.value=pe.dashSize,de.totalSize.value=pe.dashSize+pe.gapSize,de.scale.value=pe.scale}(j,Y)):Y.isPointsMaterial?function(de,pe,be,Ce){let xe;de.diffuse.value.copy(pe.color),de.opacity.value=pe.opacity,de.size.value=pe.size*be,de.scale.value=.5*Ce,pe.map&&(de.map.value=pe.map),pe.alphaMap&&(de.alphaMap.value=pe.alphaMap),pe.alphaTest>0&&(de.alphaTest.value=pe.alphaTest),pe.map?xe=pe.map:pe.alphaMap&&(xe=pe.alphaMap),xe!==void 0&&(xe.matrixAutoUpdate===!0&&xe.updateMatrix(),de.uvTransform.value.copy(xe.matrix))}(j,Y,ee,ie):Y.isSpriteMaterial?function(de,pe){let be;de.diffuse.value.copy(pe.color),de.opacity.value=pe.opacity,de.rotation.value=pe.rotation,pe.map&&(de.map.value=pe.map),pe.alphaMap&&(de.alphaMap.value=pe.alphaMap),pe.alphaTest>0&&(de.alphaTest.value=pe.alphaTest),pe.map?be=pe.map:pe.alphaMap&&(be=pe.alphaMap),be!==void 0&&(be.matrixAutoUpdate===!0&&be.updateMatrix(),de.uvTransform.value.copy(be.matrix))}(j,Y):Y.isShadowMaterial?(j.color.value.copy(Y.color),j.opacity.value=Y.opacity):Y.isShaderMaterial&&(Y.transmission!==void 0&&(j.transmission&&(j.transmission.value=Y.transmission),j.transmissionSamplerMap&&se&&(j.transmissionSamplerMap.value=se?se.texture:null),j.transmissionSamplerSize&&se&&j.transmissionSamplerSize.value.set(se.width,se.height)),Y.uniformsNeedUpdate=!1)}}}function Yg(ue,o,g,j){let Y={},ee={},ie=[];const se=g.isWebGL2?ue.getParameter(35375):0;function de(Ce,xe,Ie){const Re=Ce.value;if(Ie[xe]===void 0)return Ie[xe]=typeof Re=="number"?Re:Re.clone(),!0;if(typeof Re=="number"){if(Ie[xe]!==Re)return Ie[xe]=Re,!0}else{const De=Ie[xe];if(De.equals(Re)===!1)return De.copy(Re),!0}return!1}function pe(Ce){const xe=Ce.value,Ie={boundary:0,storage:0};return typeof xe=="number"?(Ie.boundary=4,Ie.storage=4):xe.isVector2?(Ie.boundary=8,Ie.storage=8):xe.isVector3||xe.isColor?(Ie.boundary=16,Ie.storage=12):xe.isVector4?(Ie.boundary=16,Ie.storage=16):xe.isMatrix3?(Ie.boundary=48,Ie.storage=48):xe.isMatrix4?(Ie.boundary=64,Ie.storage=64):xe.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",xe),Ie}function be(Ce){const xe=Ce.target;xe.removeEventListener("dispose",be);const Ie=ie.indexOf(xe.__bindingPointIndex);ie.splice(Ie,1),ue.deleteBuffer(Y[xe.id]),delete Y[xe.id],delete ee[xe.id]}return{bind:function(Ce,xe){const Ie=xe.program;j.uniformBlockBinding(Ce,Ie)},update:function(Ce,xe){let Ie=Y[Ce.id];Ie===void 0&&(function(ze){const je=ze.uniforms;let Ve=0,$e=0;for(let ct=0,dt=je.length;ct<dt;ct++){const ft=je[ct],Bt=pe(ft);if(ft.__data=new Float32Array(Bt.storage/Float32Array.BYTES_PER_ELEMENT),ft.__offset=Ve,ct>0){$e=Ve%16;const Lt=16-$e;$e!==0&&Lt-Bt.boundary<0&&(Ve+=16-$e,ft.__offset=Ve)}Ve+=Bt.storage}$e=Ve%16,$e>0&&(Ve+=16-$e),ze.__size=Ve,ze.__cache={}}(Ce),Ie=function(ze){const je=function(){for(let dt=0;dt<se;dt++)if(ie.indexOf(dt)===-1)return ie.push(dt),dt;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();ze.__bindingPointIndex=je;const Ve=ue.createBuffer(),$e=ze.__size,ct=ze.usage;return ue.bindBuffer(35345,Ve),ue.bufferData(35345,$e,ct),ue.bindBuffer(35345,null),ue.bindBufferBase(35345,je,Ve),Ve}(Ce),Y[Ce.id]=Ie,Ce.addEventListener("dispose",be));const Re=xe.program;j.updateUBOMapping(Ce,Re);const De=o.render.frame;ee[Ce.id]!==De&&(function(ze){const je=Y[ze.id],Ve=ze.uniforms,$e=ze.__cache;ue.bindBuffer(35345,je);for(let ct=0,dt=Ve.length;ct<dt;ct++){const ft=Ve[ct];if(de(ft,ct,$e)===!0){const Bt=ft.value,Lt=ft.__offset;typeof Bt=="number"?(ft.__data[0]=Bt,ue.bufferSubData(35345,Lt,ft.__data)):(ft.value.isMatrix3?(ft.__data[0]=ft.value.elements[0],ft.__data[1]=ft.value.elements[1],ft.__data[2]=ft.value.elements[2],ft.__data[3]=ft.value.elements[0],ft.__data[4]=ft.value.elements[3],ft.__data[5]=ft.value.elements[4],ft.__data[6]=ft.value.elements[5],ft.__data[7]=ft.value.elements[0],ft.__data[8]=ft.value.elements[6],ft.__data[9]=ft.value.elements[7],ft.__data[10]=ft.value.elements[8],ft.__data[11]=ft.value.elements[0]):Bt.toArray(ft.__data),ue.bufferSubData(35345,Lt,ft.__data))}}ue.bindBuffer(35345,null)}(Ce),ee[Ce.id]=De)},dispose:function(){for(const Ce in Y)ue.deleteBuffer(Y[Ce]);ie=[],Y={},ee={}}}}function Kv(ue={}){this.isWebGLRenderer=!0;const o=ue.canvas!==void 0?ue.canvas:function(){const Ct=pu("canvas");return Ct.style.display="block",Ct}(),g=ue.context!==void 0?ue.context:null,j=ue.depth===void 0||ue.depth,Y=ue.stencil===void 0||ue.stencil,ee=ue.antialias!==void 0&&ue.antialias,ie=ue.premultipliedAlpha===void 0||ue.premultipliedAlpha,se=ue.preserveDrawingBuffer!==void 0&&ue.preserveDrawingBuffer,de=ue.powerPreference!==void 0?ue.powerPreference:"default",pe=ue.failIfMajorPerformanceCaveat!==void 0&&ue.failIfMajorPerformanceCaveat;let be;be=g!==null?g.getContextAttributes().alpha:ue.alpha!==void 0&&ue.alpha;let Ce=null,xe=null;const Ie=[],Re=[];this.domElement=o,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=na,this.physicallyCorrectLights=!1,this.toneMapping=Li,this.toneMappingExposure=1,this.userData={},Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});const De=this;let ze=!1,je=0,Ve=0,$e=null,ct=-1,dt=null;const ft=new Vr,Bt=new Vr;let Lt=null,Wt=o.width,qt=o.height,Ot=1,En=null,Ln=null;const wn=new Vr(0,0,Wt,qt),jn=new Vr(0,0,Wt,qt);let Wn=!1;const hn=new $l;let fn=!1,Gn=!1,Sn=null;const Hn=new Yi,di=new Bn,nr=new vt,Ci={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function sr(){return $e===null?Ot:1}let Dt,xt,tn,Qt,It,Ht,_n,it,on,Xt,xn,Nn,ti,wi,Gi,Ki,Di,Ui,Wr,rl,zi,qr,Jr,Nm,ri=g;function L0(Ct,An){for(let Dn=0;Dn<Ct.length;Dn++){const Tn=Ct[Dn],mn=o.getContext(Tn,An);if(mn!==null)return mn}return null}try{const Ct={alpha:!0,depth:j,stencil:Y,antialias:ee,premultipliedAlpha:ie,preserveDrawingBuffer:se,powerPreference:de,failIfMajorPerformanceCaveat:pe};if("setAttribute"in o&&o.setAttribute("data-engine",`three.js r${_}`),o.addEventListener("webglcontextlost",O_,!1),o.addEventListener("webglcontextrestored",uf,!1),o.addEventListener("webglcontextcreationerror",qy,!1),ri===null){const An=["webgl2","webgl","experimental-webgl"];if(De.isWebGL1Renderer===!0&&An.shift(),ri=L0(An,Ct),ri===null)throw L0(An)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}ri.getShaderPrecisionFormat===void 0&&(ri.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Ct){throw console.error("THREE.WebGLRenderer: "+Ct.message),Ct}function Fu(){Dt=new Kw(ri),xt=new qw(ri,Dt,ue),Dt.init(xt),qr=new Yv(ri,Dt,xt),tn=new ey(ri,Dt,xt),Qt=new Lv,It=new rx,Ht=new qv(ri,Dt,tn,It,xt,qr,Qt),_n=new Xw(De),it=new IA(De),on=new MA(ri,xt),Jr=new Iv(ri,Dt,on,xt),Xt=new Jw(ri,on,Qt,Jr),xn=new Xi(ri,Xt,on,Qt),Wr=new Kn(ri,xt,Ht),Ki=new Yw(It),Nn=new Xf(De,_n,it,Dt,xt,Jr,Ki),ti=new ny(De,It),wi=new XA,Gi=new Wv(Dt,xt),Ui=new Cp(De,_n,tn,xn,be,ie),Di=new Hg(De,xn,xt),Nm=new Yg(ri,Qt,xt,tn),rl=new Ff(ri,Dt,Qt,xt),zi=new yr(ri,Dt,Qt,xt),Qt.programs=Nn.programs,De.capabilities=xt,De.extensions=Dt,De.properties=It,De.renderLists=wi,De.shadowMap=Di,De.state=tn,De.info=Qt,De.background=Ui,De.cubeuvmaps=it}Fu();const Lo=new Xv(De,ri);function O_(Ct){Ct.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),ze=!0}function uf(){console.log("THREE.WebGLRenderer: Context Restored."),ze=!1;const Ct=Qt.autoReset,An=Di.enabled,Dn=Di.autoUpdate,Tn=Di.needsUpdate,mn=Di.type;Fu(),Qt.autoReset=Ct,Di.enabled=An,Di.autoUpdate=Dn,Di.needsUpdate=Tn,Di.type=mn}function qy(Ct){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Ct.statusMessage)}function Yy(Ct){const An=Ct.target;An.removeEventListener("dispose",Yy),function(Dn){(function(Tn){const mn=It.get(Tn).programs;mn!==void 0&&(mn.forEach(function(ei){Nn.releaseProgram(ei)}),Tn.isShaderMaterial&&Nn.releaseShaderCache(Tn))})(Dn),It.remove(Dn)}(An)}this.xr=Lo,this.getContext=function(){return ri},this.getContextAttributes=function(){return ri.getContextAttributes()},this.forceContextLoss=function(){const Ct=Dt.get("WEBGL_lose_context");Ct&&Ct.loseContext()},this.forceContextRestore=function(){const Ct=Dt.get("WEBGL_lose_context");Ct&&Ct.restoreContext()},this.getPixelRatio=function(){return Ot},this.setPixelRatio=function(Ct){Ct!==void 0&&(Ot=Ct,this.setSize(Wt,qt,!1))},this.getSize=function(Ct){return Ct.set(Wt,qt)},this.setSize=function(Ct,An,Dn){Lo.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Wt=Ct,qt=An,o.width=Math.floor(Ct*Ot),o.height=Math.floor(An*Ot),Dn!==!1&&(o.style.width=Ct+"px",o.style.height=An+"px"),this.setViewport(0,0,Ct,An))},this.getDrawingBufferSize=function(Ct){return Ct.set(Wt*Ot,qt*Ot).floor()},this.setDrawingBufferSize=function(Ct,An,Dn){Wt=Ct,qt=An,Ot=Dn,o.width=Math.floor(Ct*Dn),o.height=Math.floor(An*Dn),this.setViewport(0,0,Ct,An)},this.getCurrentViewport=function(Ct){return Ct.copy(ft)},this.getViewport=function(Ct){return Ct.copy(wn)},this.setViewport=function(Ct,An,Dn,Tn){Ct.isVector4?wn.set(Ct.x,Ct.y,Ct.z,Ct.w):wn.set(Ct,An,Dn,Tn),tn.viewport(ft.copy(wn).multiplyScalar(Ot).floor())},this.getScissor=function(Ct){return Ct.copy(jn)},this.setScissor=function(Ct,An,Dn,Tn){Ct.isVector4?jn.set(Ct.x,Ct.y,Ct.z,Ct.w):jn.set(Ct,An,Dn,Tn),tn.scissor(Bt.copy(jn).multiplyScalar(Ot).floor())},this.getScissorTest=function(){return Wn},this.setScissorTest=function(Ct){tn.setScissorTest(Wn=Ct)},this.setOpaqueSort=function(Ct){En=Ct},this.setTransparentSort=function(Ct){Ln=Ct},this.getClearColor=function(Ct){return Ct.copy(Ui.getClearColor())},this.setClearColor=function(){Ui.setClearColor.apply(Ui,arguments)},this.getClearAlpha=function(){return Ui.getClearAlpha()},this.setClearAlpha=function(){Ui.setClearAlpha.apply(Ui,arguments)},this.clear=function(Ct=!0,An=!0,Dn=!0){let Tn=0;Ct&&(Tn|=16384),An&&(Tn|=256),Dn&&(Tn|=1024),ri.clear(Tn)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){o.removeEventListener("webglcontextlost",O_,!1),o.removeEventListener("webglcontextrestored",uf,!1),o.removeEventListener("webglcontextcreationerror",qy,!1),wi.dispose(),Gi.dispose(),It.dispose(),_n.dispose(),it.dispose(),xn.dispose(),Jr.dispose(),Nm.dispose(),Nn.dispose(),Lo.dispose(),Lo.removeEventListener("sessionstart",Xy),Lo.removeEventListener("sessionend",Ky),Sn&&(Sn.dispose(),Sn=null),Th.stop()},this.renderBufferDirect=function(Ct,An,Dn,Tn,mn,ei){An===null&&(An=Ci);const Qi=mn.isMesh&&mn.matrixWorld.determinant()<0,Fi=function(Uo,df,ol,Hi,wo){df.isScene!==!0&&(df=Ci),Ht.resetTextureUnits();const Um=df.fog,F0=Hi.isMeshStandardMaterial?df.environment:null,wx=$e===null?De.outputEncoding:$e.isXRRenderTarget===!0||$e.texture.encoding&&$e.texture.encoding!==cs?$e.texture.encoding:na,F_=(Hi.isMeshStandardMaterial?it:_n).get(Hi.envMap||F0),eb=Hi.vertexColors===!0&&!!ol.attributes.color&&ol.attributes.color.itemSize===4,j0=!!Hi.normalMap&&!!ol.attributes.tangent,z0=!!ol.morphAttributes.position,xx=!!ol.morphAttributes.normal,V0=!!ol.morphAttributes.color,tb=Hi.toneMapped?De.toneMapping:Li,nb=ol.morphAttributes.position||ol.morphAttributes.normal||ol.morphAttributes.color,Ex=nb!==void 0?nb.length:0,ps=It.get(Hi),Sx=xe.state.lights;if(fn===!0&&(Gn===!0||Uo!==dt)){const Xo=Uo===dt&&Hi.id===ct;Ki.setState(Hi,Uo,Xo)}let zu=!1;Hi.version===ps.__version?ps.needsLights&&ps.lightsStateVersion!==Sx.state.version||ps.outputEncoding!==wx||wo.isInstancedMesh&&ps.instancing===!1?zu=!0:wo.isInstancedMesh||ps.instancing!==!0?wo.isSkinnedMesh&&ps.skinning===!1?zu=!0:wo.isSkinnedMesh||ps.skinning!==!0?ps.envMap!==F_||Hi.fog===!0&&ps.fog!==Um?zu=!0:ps.numClippingPlanes===void 0||ps.numClippingPlanes===Ki.numPlanes&&ps.numIntersection===Ki.numIntersection?(ps.vertexAlphas!==eb||ps.vertexTangents!==j0||ps.morphTargets!==z0||ps.morphNormals!==xx||ps.morphColors!==V0||ps.toneMapping!==tb||xt.isWebGL2===!0&&ps.morphTargetsCount!==Ex)&&(zu=!0):zu=!0:zu=!0:zu=!0:(zu=!0,ps.__version=Hi.version);let Dh=ps.currentProgram;zu===!0&&(Dh=N_(Hi,df,wo));let j_=!1,pf=!1,z_=!1;const ws=Dh.getUniforms(),ep=ps.uniforms;if(tn.useProgram(Dh.program)&&(j_=!0,pf=!0,z_=!0),Hi.id!==ct&&(ct=Hi.id,pf=!0),j_||dt!==Uo){if(ws.setValue(ri,"projectionMatrix",Uo.projectionMatrix),xt.logarithmicDepthBuffer&&ws.setValue(ri,"logDepthBufFC",2/(Math.log(Uo.far+1)/Math.LN2)),dt!==Uo&&(dt=Uo,pf=!0,z_=!0),Hi.isShaderMaterial||Hi.isMeshPhongMaterial||Hi.isMeshToonMaterial||Hi.isMeshStandardMaterial||Hi.envMap){const Xo=ws.map.cameraPosition;Xo!==void 0&&Xo.setValue(ri,nr.setFromMatrixPosition(Uo.matrixWorld))}(Hi.isMeshPhongMaterial||Hi.isMeshToonMaterial||Hi.isMeshLambertMaterial||Hi.isMeshBasicMaterial||Hi.isMeshStandardMaterial||Hi.isShaderMaterial)&&ws.setValue(ri,"isOrthographic",Uo.isOrthographicCamera===!0),(Hi.isMeshPhongMaterial||Hi.isMeshToonMaterial||Hi.isMeshLambertMaterial||Hi.isMeshBasicMaterial||Hi.isMeshStandardMaterial||Hi.isShaderMaterial||Hi.isShadowMaterial||wo.isSkinnedMesh)&&ws.setValue(ri,"viewMatrix",Uo.matrixWorldInverse)}if(wo.isSkinnedMesh){ws.setOptional(ri,wo,"bindMatrix"),ws.setOptional(ri,wo,"bindMatrixInverse");const Xo=wo.skeleton;Xo&&(xt.floatVertexTextures?(Xo.boneTexture===null&&Xo.computeBoneTexture(),ws.setValue(ri,"boneTexture",Xo.boneTexture,Ht),ws.setValue(ri,"boneTextureSize",Xo.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const V_=ol.morphAttributes;var Bl,mc;(V_.position!==void 0||V_.normal!==void 0||V_.color!==void 0&&xt.isWebGL2===!0)&&Wr.update(wo,ol,Hi,Dh),(pf||ps.receiveShadow!==wo.receiveShadow)&&(ps.receiveShadow=wo.receiveShadow,ws.setValue(ri,"receiveShadow",wo.receiveShadow)),Hi.isMeshGouraudMaterial&&Hi.envMap!==null&&(ep.envMap.value=F_,ep.flipEnvMap.value=F_.isCubeTexture&&F_.isRenderTargetTexture===!1?-1:1),pf&&(ws.setValue(ri,"toneMappingExposure",De.toneMappingExposure),ps.needsLights&&(mc=z_,(Bl=ep).ambientLightColor.needsUpdate=mc,Bl.lightProbe.needsUpdate=mc,Bl.directionalLights.needsUpdate=mc,Bl.directionalLightShadows.needsUpdate=mc,Bl.pointLights.needsUpdate=mc,Bl.pointLightShadows.needsUpdate=mc,Bl.spotLights.needsUpdate=mc,Bl.spotLightShadows.needsUpdate=mc,Bl.rectAreaLights.needsUpdate=mc,Bl.hemisphereLights.needsUpdate=mc),Um&&Hi.fog===!0&&ti.refreshFogUniforms(ep,Um),ti.refreshMaterialUniforms(ep,Hi,Ot,qt,De.userData.transmissionRenderTarget||Sn),Hf.upload(ri,ps.uniformsList,ep,Ht)),Hi.isShaderMaterial&&Hi.uniformsNeedUpdate===!0&&(Hf.upload(ri,ps.uniformsList,ep,Ht),Hi.uniformsNeedUpdate=!1),Hi.isSpriteMaterial&&ws.setValue(ri,"center",wo.center),ws.setValue(ri,"modelViewMatrix",wo.modelViewMatrix),ws.setValue(ri,"normalMatrix",wo.normalMatrix),ws.setValue(ri,"modelMatrix",wo.matrixWorld);const ib=Hi.extraUniformsToUpload;if(ib&&Object.entries(ib).forEach(([Xo,Fm])=>ws.setValue(ri,Xo,Fm.value,Ht)),Hi.isShaderMaterial||Hi.isRawShaderMaterial){const Xo=Hi.uniformsGroups;for(let Fm=0,rb=Xo.length;Fm<rb;Fm++)if(xt.isWebGL2){const G0=Xo[Fm];Nm.update(G0,Dh),Nm.bind(G0,Dh)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Dh}(Ct,An,Dn,Tn,mn);tn.setMaterial(Tn,Qi);let wr=Dn.index;const Ns=Dn.attributes.position;if(wr===null){if(Ns===void 0||Ns.count===0)return}else if(wr.count===0)return;let Lr,gr=1;Tn.wireframe===!0&&(wr=Xt.getWireframeAttribute(Dn),gr=2),Jr.setup(mn,Tn,Fi,Dn,wr);let No=rl;wr!==null&&(Lr=on.get(wr),No=zi,No.setIndex(Lr));const hf=wr!==null?wr.count:Ns.count,sl=Dn.drawRange.start*gr,U_=Dn.drawRange.count*gr,Ih=ei!==null?ei.start*gr:0,bx=ei!==null?ei.count*gr:1/0,Zd=Math.max(sl,Ih),U0=Math.min(hf,sl+U_,Ih+bx)-1,ju=Math.max(0,U0-Zd+1);if(ju!==0){if(mn.isMesh)Tn.wireframe===!0?(tn.setLineWidth(Tn.wireframeLinewidth*sr()),No.setMode(1)):No.setMode(4);else if(mn.isLine){let Uo=Tn.linewidth;Uo===void 0&&(Uo=1),tn.setLineWidth(Uo*sr()),mn.isLineSegments?No.setMode(1):mn.isLineLoop?No.setMode(2):No.setMode(3)}else mn.isPoints?No.setMode(0):mn.isSprite&&No.setMode(4);if(mn.isInstancedMesh)No.renderInstances(Zd,ju,mn.count);else if(Dn.isInstancedBufferGeometry){const Uo=Math.min(Dn.instanceCount,Dn._maxInstanceCount);No.renderInstances(Zd,ju,Uo)}else No.render(Zd,ju)}},this.compile=function(Ct,An){function Dn(Tn,mn,ei){Tn.transparent===!0&&Tn.side===nt?(Tn.side=Ue,Tn.needsUpdate=!0,N_(Tn,mn,ei),Tn.side=et,Tn.needsUpdate=!0,N_(Tn,mn,ei),Tn.side=nt):N_(Tn,mn,ei)}xe=Gi.get(Ct),xe.init(),Re.push(xe),Ct.traverseVisible(function(Tn){Tn.isLight&&Tn.layers.test(An.layers)&&(xe.pushLight(Tn),Tn.castShadow&&xe.pushShadow(Tn))}),xe.setupLights(De.physicallyCorrectLights),Ct.traverse(function(Tn){const mn=Tn.material;if(mn)if(Array.isArray(mn))for(let ei=0;ei<mn.length;ei++)Dn(mn[ei],Ct,Tn);else Dn(mn,Ct,Tn)}),Re.pop(),xe=null};let N0=null;function Xy(){Th.stop()}function Ky(){Th.start()}const Th=new Mg;function Jy(Ct,An,Dn,Tn){if(Ct.visible===!1)return;if(Ct.layers.test(An.layers)){if(Ct.isGroup)Dn=Ct.renderOrder;else if(Ct.isLOD)Ct.autoUpdate===!0&&Ct.update(An);else if(Ct.isLight)xe.pushLight(Ct),Ct.castShadow&&xe.pushShadow(Ct);else if(Ct.isSprite){if(!Ct.frustumCulled||hn.intersectsSprite(Ct)){Tn&&nr.setFromMatrixPosition(Ct.matrixWorld).applyMatrix4(Hn);const ei=xn.update(Ct),Qi=Ct.material;Qi.visible&&Ce.push(Ct,ei,Qi,Dn,nr.z,null)}}else if((Ct.isMesh||Ct.isLine||Ct.isPoints)&&(Ct.isSkinnedMesh&&Ct.skeleton.frame!==Qt.render.frame&&(Ct.skeleton.update(),Ct.skeleton.frame=Qt.render.frame),!Ct.frustumCulled||hn.intersectsObject(Ct))){Tn&&nr.setFromMatrixPosition(Ct.matrixWorld).applyMatrix4(Hn);const ei=xn.update(Ct),Qi=Ct.material;if(Array.isArray(Qi)){const Fi=ei.groups;for(let wr=0,Ns=Fi.length;wr<Ns;wr++){const Lr=Fi[wr],gr=Qi[Lr.materialIndex];gr&&gr.visible&&Ce.push(Ct,ei,gr,Dn,nr.z,Lr)}}else Qi.visible&&Ce.push(Ct,ei,Qi,Dn,nr.z,null)}}const mn=Ct.children;for(let ei=0,Qi=mn.length;ei<Qi;ei++)Jy(mn[ei],An,Dn,Tn)}function $y(Ct,An,Dn,Tn){const mn=Ct.opaque,ei=Ct.transmissive,Qi=Ct.transparent;if(xe.setupLightsView(Dn),De.userData.transmissionRender===void 0&&De.userData.renderTransmissionPass!==!1&&ei.length>0&&function(Fi,wr,Ns){console.error("three.js internal render transmission pass should not be called");const Lr=xt.isWebGL2;Sn===null&&(Sn=new Aa(1,1,{generateMipmaps:!0,type:Dt.has("EXT_color_buffer_half_float")?To:Bs,minFilter:oi,samples:Lr&&ee===!0?4:0})),De.getDrawingBufferSize(di),Lr?Sn.setSize(di.x,di.y):Sn.setSize(Vo(di.x),Vo(di.y));const gr=De.getRenderTarget();De.setRenderTarget(Sn),De.clear();const No=De.toneMapping;De.toneMapping=Li,L_(Fi,wr,Ns),De.toneMapping=No,Ht.updateMultisampleRenderTarget(Sn),Ht.updateRenderTargetMipmap(Sn),De.setRenderTarget(gr)}([...mn,...Qi],An,Dn),Tn&&tn.viewport(ft.copy(Tn)),De.userData.opaqueRender!==!1&&mn.length>0&&L_(mn,An,Dn),De.userData.transparentRender!==!1&&Qi.length>0&&L_(Qi,An,Dn),De.userData.transmissionRender!==!1&&ei.length>0){Sn||(Sn=new Aa(1,1));const Fi=De.userData.transmissionRenderTarget.texture,wr=xt.isWebGL2,Ns=Fi.generateMipmaps,Lr=Fi.minFilter;wr&&De.userData.blurTransmissionTarget&&(Fi.generateMipmaps=!0,Fi.minFilter=oi,Fi.needsUpdate=!0,Ht.updateRenderTargetMipmap(De.userData.transmissionRenderTarget)),L_(ei,An,Dn),wr&&De.userData.blurTransmissionTarget&&(Fi.generateMipmaps=Ns,Fi.minFilter=Lr,Fi.needsUpdate=!0,Ht.updateRenderTargetMipmap(De.userData.transmissionRenderTarget))}tn.buffers.depth.setTest(!0),tn.buffers.depth.setMask(!0),tn.buffers.color.setMask(!0),tn.setPolygonOffset(!1)}function L_(Ct,An,Dn){const Tn={...De.userData};De.userData.opaqueRender=void 0,De.userData.transparentRender=void 0,De.userData.transmissionRender=void 0,De.userData.backgroundRender=void 0;const mn=An.isScene===!0?An.overrideMaterial:null;for(let ei=0,Qi=Ct.length;ei<Qi;ei++){const Fi=Ct[ei],wr=Fi.object,Ns=Fi.geometry,Lr=mn===null?Fi.material:mn,gr=Fi.group;wr.layers.test(Dn.layers)&&yx(wr,An,Dn,Ns,Lr,gr)}Object.assign(De.userData,Tn)}function yx(Ct,An,Dn,Tn,mn,ei){Ct.onBeforeRender(De,An,Dn,Tn,mn,ei),Ct.modelViewMatrix.multiplyMatrices(Dn.matrixWorldInverse,Ct.matrixWorld),Ct.normalMatrix.getNormalMatrix(Ct.modelViewMatrix),mn.onBeforeRender(De,An,Dn,Tn,Ct,ei),mn.transparent===!0&&mn.side===nt?(mn.side=Ue,mn.needsUpdate=!0,De.renderBufferDirect(Dn,An,Tn,mn,Ct,ei),mn.side=et,mn.needsUpdate=!0,De.renderBufferDirect(Dn,An,Tn,mn,Ct,ei),mn.side=nt):De.renderBufferDirect(Dn,An,Tn,mn,Ct,ei),Ct.onAfterRender(De,An,Dn,Tn,mn,ei),mn.onAfterRender(De,An,Dn,Tn,Ct,ei)}function N_(Ct,An,Dn){An.isScene!==!0&&(An=Ci);const Tn=It.get(Ct),mn=xe.state.lights,ei=xe.state.shadowsArray,Qi=mn.state.version,Fi=Nn.getParameters(Ct,mn.state,ei,An,Dn),wr=Nn.getProgramCacheKey(Fi);let Ns=Tn.programs;Tn.environment=Ct.isMeshStandardMaterial?An.environment:null,Tn.fog=An.fog,Tn.envMap=(Ct.isMeshStandardMaterial?it:_n).get(Ct.envMap||Tn.environment),Ns===void 0&&(Ct.addEventListener("dispose",Yy),Ns=new Map,Tn.programs=Ns);let Lr=Ns.get(wr);if(Lr!==void 0){if(Tn.currentProgram===Lr&&Tn.lightsStateVersion===Qi)return Zy(Ct,Fi),Lr}else Fi.uniforms=Nn.getUniforms(Ct),Ct.onBuild(Dn,Fi,De),Ct.onBeforeCompile(Fi,De),Lr=Nn.acquireProgram(Fi,wr),Ns.set(wr,Lr),Tn.uniforms=Fi.uniforms;const gr=Tn.uniforms;(Ct.isShaderMaterial||Ct.isRawShaderMaterial)&&Ct.clipping!==!0||(gr.clippingPlanes=Ki.uniform),Zy(Ct,Fi),Tn.needsLights=function(sl){return sl.isMeshLambertMaterial||sl.isMeshToonMaterial||sl.isMeshPhongMaterial||sl.isMeshStandardMaterial||sl.isShadowMaterial||sl.isShaderMaterial&&sl.lights===!0}(Ct),Tn.lightsStateVersion=Qi,Tn.needsLights&&(gr.ambientLightColor.value=mn.state.ambient,gr.lightProbe.value=mn.state.probe,gr.directionalLights.value=mn.state.directional,gr.directionalLightShadows.value=mn.state.directionalShadow,gr.spotLights.value=mn.state.spot,gr.spotLightShadows.value=mn.state.spotShadow,gr.rectAreaLights.value=mn.state.rectArea,gr.ltc_1.value=mn.state.rectAreaLTC1,gr.ltc_2.value=mn.state.rectAreaLTC2,gr.pointLights.value=mn.state.point,gr.pointLightShadows.value=mn.state.pointShadow,gr.hemisphereLights.value=mn.state.hemi,gr.directionalShadowMap.value=mn.state.directionalShadowMap,gr.directionalShadowMatrix.value=mn.state.directionalShadowMatrix,gr.spotShadowMap.value=mn.state.spotShadowMap,gr.spotLightMatrix.value=mn.state.spotLightMatrix,gr.spotLightMap.value=mn.state.spotLightMap,gr.pointShadowMap.value=mn.state.pointShadowMap,gr.pointShadowMatrix.value=mn.state.pointShadowMatrix);const No=Lr.getUniforms(),hf=Hf.seqWithValue(No.seq,gr);return Tn.currentProgram=Lr,Tn.uniformsList=hf,Lr}function Zy(Ct,An){const Dn=It.get(Ct);Dn.outputEncoding=An.outputEncoding,Dn.instancing=An.instancing,Dn.skinning=An.skinning,Dn.morphTargets=An.morphTargets,Dn.morphNormals=An.morphNormals,Dn.morphColors=An.morphColors,Dn.morphTargetsCount=An.morphTargetsCount,Dn.numClippingPlanes=An.numClippingPlanes,Dn.numIntersection=An.numClipIntersection,Dn.vertexAlphas=An.vertexAlphas,Dn.vertexTangents=An.vertexTangents,Dn.toneMapping=An.toneMapping}Th.setAnimationLoop(function(Ct){N0&&N0(Ct)}),typeof self<"u"&&Th.setContext(self),this.setAnimationLoop=function(Ct){N0=Ct,Lo.setAnimationLoop(Ct),Ct===null?Th.stop():Th.start()},Lo.addEventListener("sessionstart",Xy),Lo.addEventListener("sessionend",Ky),this.render=function(Ct,An){if(An===void 0||An.isCamera===!0){if(ze!==!0){if(Ct.matrixWorldAutoUpdate===!0&&Ct.updateMatrixWorld(),An.parent===null&&An.matrixWorldAutoUpdate===!0&&An.updateMatrixWorld(),Lo.enabled===!0&&Lo.isPresenting===!0&&(Lo.cameraAutoUpdate===!0&&Lo.updateCamera(An),An=Lo.getCamera()),Ct.isScene===!0&&Ct.onBeforeRender(De,Ct,An,$e),xe=Gi.get(Ct,Re.length),xe.init(),Re.push(xe),Hn.multiplyMatrices(An.projectionMatrix,An.matrixWorldInverse),hn.setFromProjectionMatrix(Hn),Gn=this.localClippingEnabled,fn=Ki.init(this.clippingPlanes,Gn,An),Ce=wi.get(Ct,Ie.length),Ce.init(),Ie.push(Ce),Jy(Ct,An,0,De.sortObjects),Ce.finish(),De.sortObjects===!0&&Ce.sort(En,Ln),De.userData.shadowMapRender){fn===!0&&Ki.beginShadows();const Dn=xe.state.shadowsArray;Dn.length>0&&Di.render(Dn,Ct,An),fn===!0&&Ki.endShadows()}if(this.info.autoReset===!0&&this.info.reset(),De.userData.backgroundRender!==!1&&Ui.render(Ce,Ct),De.userData.sceneRender!==!1)if(xe.setupLights(De.physicallyCorrectLights),An.isArrayCamera){const Dn=An.cameras;for(let Tn=0,mn=Dn.length;Tn<mn;Tn++){const ei=Dn[Tn];$y(Ce,Ct,ei,ei.viewport)}}else $y(Ce,Ct,An);$e!==null&&(Ht.updateMultisampleRenderTarget($e),Ht.updateRenderTargetMipmap($e)),Ct.isScene===!0&&Ct.onAfterRender(De,Ct,An),Jr.resetDefaultState(),ct=-1,dt=null,Re.pop(),xe=Re.length>0?Re[Re.length-1]:null,Ie.pop(),Ce=Ie.length>0?Ie[Ie.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return je},this.getActiveMipmapLevel=function(){return Ve},this.getRenderTarget=function(){return $e},this.setRenderTargetTextures=function(Ct,An,Dn){It.get(Ct.texture).__webglTexture=An,It.get(Ct.depthTexture).__webglTexture=Dn;const Tn=It.get(Ct);Tn.__hasExternalTextures=!0,Tn.__hasExternalTextures&&(Tn.__autoAllocateDepthBuffer=Dn===void 0,Tn.__autoAllocateDepthBuffer||Dt.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Tn.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(Ct,An){const Dn=It.get(Ct);Dn.__webglFramebuffer=An,Dn.__useDefaultFramebuffer=An===void 0},this.setRenderTarget=function(Ct,An=0,Dn=0){$e=Ct,je=An,Ve=Dn;let Tn=!0;if(Ct){const Fi=It.get(Ct);Fi.__useDefaultFramebuffer!==void 0?(tn.bindFramebuffer(36160,null),Tn=!1):Fi.__webglFramebuffer===void 0?Ht.setupRenderTarget(Ct):Fi.__hasExternalTextures&&Ht.rebindTextures(Ct,It.get(Ct.texture).__webglTexture,It.get(Ct.depthTexture).__webglTexture)}let mn=null,ei=!1,Qi=!1;if(Ct){const Fi=Ct.texture;(Fi.isData3DTexture||Fi.isDataArrayTexture)&&(Qi=!0);const wr=It.get(Ct).__webglFramebuffer;Ct.isWebGLCubeRenderTarget?(mn=wr[An],ei=!0):mn=xt.isWebGL2&&Ct.samples>0&&Ht.useMultisampledRTT(Ct)===!1?It.get(Ct).__webglMultisampledFramebuffer:wr,ft.copy(Ct.viewport),Bt.copy(Ct.scissor),Lt=Ct.scissorTest}else ft.copy(wn).multiplyScalar(Ot).floor(),Bt.copy(jn).multiplyScalar(Ot).floor(),Lt=Wn;if(tn.bindFramebuffer(36160,mn)&&xt.drawBuffers&&Tn&&tn.drawBuffers(Ct,mn),tn.viewport(ft),tn.scissor(Bt),tn.setScissorTest(Lt),ei){const Fi=It.get(Ct.texture);ri.framebufferTexture2D(36160,36064,34069+An,Fi.__webglTexture,Dn)}else if(Qi){const Fi=It.get(Ct.texture),wr=An||0;ri.framebufferTextureLayer(36160,36064,Fi.__webglTexture,Dn||0,wr)}ct=-1},this.readRenderTargetPixels=function(Ct,An,Dn,Tn,mn,ei,Qi){if(!Ct||!Ct.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Fi=It.get(Ct).__webglFramebuffer;if(Ct.isWebGLCubeRenderTarget&&Qi!==void 0&&(Fi=Fi[Qi]),Fi){tn.bindFramebuffer(36160,Fi);try{const wr=Ct.texture,Ns=wr.format,Lr=wr.type;if(Ns!==Ii&&qr.convert(Ns)!==ri.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const gr=Lr===To&&(Dt.has("EXT_color_buffer_half_float")||xt.isWebGL2&&Dt.has("EXT_color_buffer_float"));if(!(Lr===Bs||qr.convert(Lr)===ri.getParameter(35738)||Lr===Zr&&(xt.isWebGL2||Dt.has("OES_texture_float")||Dt.has("WEBGL_color_buffer_float"))||gr))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");An>=0&&An<=Ct.width-Tn&&Dn>=0&&Dn<=Ct.height-mn&&ri.readPixels(An,Dn,Tn,mn,qr.convert(Ns),qr.convert(Lr),ei)}finally{const wr=$e!==null?It.get($e).__webglFramebuffer:null;tn.bindFramebuffer(36160,wr)}}},this.copyFramebufferToTexture=function(Ct,An,Dn=0){const Tn=Math.pow(2,-Dn),mn=Math.floor(An.image.width*Tn),ei=Math.floor(An.image.height*Tn);Ht.setTexture2D(An,0),ri.copyTexSubImage2D(3553,Dn,0,0,Ct.x,Ct.y,mn,ei),tn.unbindTexture()},this.copyTextureToTexture=function(Ct,An,Dn,Tn=0){const mn=An.image.width,ei=An.image.height,Qi=qr.convert(Dn.format),Fi=qr.convert(Dn.type);Ht.setTexture2D(Dn,0),ri.pixelStorei(37440,Dn.flipY),ri.pixelStorei(37441,Dn.premultiplyAlpha),ri.pixelStorei(3317,Dn.unpackAlignment),An.isDataTexture?ri.texSubImage2D(3553,Tn,Ct.x,Ct.y,mn,ei,Qi,Fi,An.image.data):An.isCompressedTexture?ri.compressedTexSubImage2D(3553,Tn,Ct.x,Ct.y,An.mipmaps[0].width,An.mipmaps[0].height,Qi,An.mipmaps[0].data):ri.texSubImage2D(3553,Tn,Ct.x,Ct.y,Qi,Fi,An.image),Tn===0&&Dn.generateMipmaps&&ri.generateMipmap(3553),tn.unbindTexture()},this.copyTextureToTexture3D=function(Ct,An,Dn,Tn,mn=0){if(De.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const ei=Ct.max.x-Ct.min.x+1,Qi=Ct.max.y-Ct.min.y+1,Fi=Ct.max.z-Ct.min.z+1,wr=qr.convert(Tn.format),Ns=qr.convert(Tn.type);let Lr;if(Tn.isData3DTexture)Ht.setTexture3D(Tn,0),Lr=32879;else{if(!Tn.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Ht.setTexture2DArray(Tn,0),Lr=35866}ri.pixelStorei(37440,Tn.flipY),ri.pixelStorei(37441,Tn.premultiplyAlpha),ri.pixelStorei(3317,Tn.unpackAlignment);const gr=ri.getParameter(3314),No=ri.getParameter(32878),hf=ri.getParameter(3316),sl=ri.getParameter(3315),U_=ri.getParameter(32877),Ih=Dn.isCompressedTexture?Dn.mipmaps[0]:Dn.image;ri.pixelStorei(3314,Ih.width),ri.pixelStorei(32878,Ih.height),ri.pixelStorei(3316,Ct.min.x),ri.pixelStorei(3315,Ct.min.y),ri.pixelStorei(32877,Ct.min.z),Dn.isDataTexture||Dn.isData3DTexture?ri.texSubImage3D(Lr,mn,An.x,An.y,An.z,ei,Qi,Fi,wr,Ns,Ih.data):Dn.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ri.compressedTexSubImage3D(Lr,mn,An.x,An.y,An.z,ei,Qi,Fi,wr,Ih.data)):ri.texSubImage3D(Lr,mn,An.x,An.y,An.z,ei,Qi,Fi,wr,Ns,Ih),ri.pixelStorei(3314,gr),ri.pixelStorei(32878,No),ri.pixelStorei(3316,hf),ri.pixelStorei(3315,sl),ri.pixelStorei(32877,U_),mn===0&&Tn.generateMipmaps&&ri.generateMipmap(Lr),tn.unbindTexture()},this.initTexture=function(Ct){Ct.isCubeTexture?Ht.setTextureCube(Ct,0):Ct.isData3DTexture?Ht.setTexture3D(Ct,0):Ct.isDataArrayTexture?Ht.setTexture2DArray(Ct,0):Ht.setTexture2D(Ct,0),tn.unbindTexture()},this.resetState=function(){je=0,Ve=0,$e=null,tn.reset(),Jr.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class Jv extends Kv{}Jv.prototype.isWebGL1Renderer=!0;class Zf{constructor(o,g=25e-5){this.isFogExp2=!0,this.name="",this.color=new ci(o),this.density=g}clone(){return new Zf(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class gh{constructor(o,g=1,j=1e3){this.isFog=!0,this.name="",this.color=new ci(o),this.near=g,this.far=j}clone(){return new gh(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class $v extends Ar{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(o,g){return super.copy(o,g),o.background!==null&&(this.background=o.background.clone()),o.environment!==null&&(this.environment=o.environment.clone()),o.fog!==null&&(this.fog=o.fog.clone()),o.overrideMaterial!==null&&(this.overrideMaterial=o.overrideMaterial.clone()),this.matrixAutoUpdate=o.matrixAutoUpdate,this}toJSON(o){const g=super.toJSON(o);return this.fog!==null&&(g.object.fog=this.fog.toJSON()),g}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(o){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=o}}class em{constructor(o,g){this.isInterleavedBuffer=!0,this.array=o,this.stride=g,this.count=o!==void 0?o.length/g:0,this.usage=zo,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Oi()}onUploadCallback(){}set needsUpdate(o){o===!0&&this.version++}setUsage(o){return this.usage=o,this}copy(o){return this.array=new o.array.constructor(o.array),this.count=o.count,this.stride=o.stride,this.usage=o.usage,this}copyAt(o,g,j){o*=this.stride,j*=g.stride;for(let Y=0,ee=this.stride;Y<ee;Y++)this.array[o+Y]=g.array[j+Y];return this}set(o,g=0){return this.array.set(o,g),this}clone(o){o.arrayBuffers===void 0&&(o.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Oi()),o.arrayBuffers[this.array.buffer._uuid]===void 0&&(o.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const g=new this.array.constructor(o.arrayBuffers[this.array.buffer._uuid]),j=new this.constructor(g,this.stride);return j.setUsage(this.usage),j}onUpload(o){return this.onUploadCallback=o,this}toJSON(o){return o.arrayBuffers===void 0&&(o.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Oi()),o.arrayBuffers[this.array.buffer._uuid]===void 0&&(o.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Dr=new vt;class _h{constructor(o,g,j,Y=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=o,this.itemSize=g,this.offset=j,this.normalized=Y===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(o){this.data.needsUpdate=o}applyMatrix4(o){for(let g=0,j=this.data.count;g<j;g++)Dr.fromBufferAttribute(this,g),Dr.applyMatrix4(o),this.setXYZ(g,Dr.x,Dr.y,Dr.z);return this}applyNormalMatrix(o){for(let g=0,j=this.count;g<j;g++)Dr.fromBufferAttribute(this,g),Dr.applyNormalMatrix(o),this.setXYZ(g,Dr.x,Dr.y,Dr.z);return this}transformDirection(o){for(let g=0,j=this.count;g<j;g++)Dr.fromBufferAttribute(this,g),Dr.transformDirection(o),this.setXYZ(g,Dr.x,Dr.y,Dr.z);return this}setX(o,g){return this.normalized&&(g=ns(g,this.array)),this.data.array[o*this.data.stride+this.offset]=g,this}setY(o,g){return this.normalized&&(g=ns(g,this.array)),this.data.array[o*this.data.stride+this.offset+1]=g,this}setZ(o,g){return this.normalized&&(g=ns(g,this.array)),this.data.array[o*this.data.stride+this.offset+2]=g,this}setW(o,g){return this.normalized&&(g=ns(g,this.array)),this.data.array[o*this.data.stride+this.offset+3]=g,this}getX(o){let g=this.data.array[o*this.data.stride+this.offset];return this.normalized&&(g=Vl(g,this.array)),g}getY(o){let g=this.data.array[o*this.data.stride+this.offset+1];return this.normalized&&(g=Vl(g,this.array)),g}getZ(o){let g=this.data.array[o*this.data.stride+this.offset+2];return this.normalized&&(g=Vl(g,this.array)),g}getW(o){let g=this.data.array[o*this.data.stride+this.offset+3];return this.normalized&&(g=Vl(g,this.array)),g}setXY(o,g,j){return o=o*this.data.stride+this.offset,this.normalized&&(g=ns(g,this.array),j=ns(j,this.array)),this.data.array[o+0]=g,this.data.array[o+1]=j,this}setXYZ(o,g,j,Y){return o=o*this.data.stride+this.offset,this.normalized&&(g=ns(g,this.array),j=ns(j,this.array),Y=ns(Y,this.array)),this.data.array[o+0]=g,this.data.array[o+1]=j,this.data.array[o+2]=Y,this}setXYZW(o,g,j,Y,ee){return o=o*this.data.stride+this.offset,this.normalized&&(g=ns(g,this.array),j=ns(j,this.array),Y=ns(Y,this.array),ee=ns(ee,this.array)),this.data.array[o+0]=g,this.data.array[o+1]=j,this.data.array[o+2]=Y,this.data.array[o+3]=ee,this}clone(o){if(o===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will deinterleave buffer data.");const g=[];for(let j=0;j<this.count;j++){const Y=j*this.data.stride+this.offset;for(let ee=0;ee<this.itemSize;ee++)g.push(this.data.array[Y+ee])}return new is(new this.array.constructor(g),this.itemSize,this.normalized)}return o.interleavedBuffers===void 0&&(o.interleavedBuffers={}),o.interleavedBuffers[this.data.uuid]===void 0&&(o.interleavedBuffers[this.data.uuid]=this.data.clone(o)),new _h(o.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(o){if(o===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will deinterleave buffer data.");const g=[];for(let j=0;j<this.count;j++){const Y=j*this.data.stride+this.offset;for(let ee=0;ee<this.itemSize;ee++)g.push(this.data.array[Y+ee])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:g,normalized:this.normalized}}return o.interleavedBuffers===void 0&&(o.interleavedBuffers={}),o.interleavedBuffers[this.data.uuid]===void 0&&(o.interleavedBuffers[this.data.uuid]=this.data.toJSON(o)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Cd extends $s{constructor(o){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new ci(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.alphaMap=o.alphaMap,this.rotation=o.rotation,this.sizeAttenuation=o.sizeAttenuation,this.fog=o.fog,this}}let vh;const tm=new vt,Ip=new vt,Md=new vt,Iu=new Bn,Dp=new Bn,Xg=new Yi,Ah=new vt,Pp=new vt,yh=new vt,nm=new Bn,im=new Bn,iy=new Bn;class Rp extends Ar{constructor(o){if(super(),this.isSprite=!0,this.type="Sprite",vh===void 0){vh=new yi;const g=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),j=new em(g,5);vh.setIndex([0,1,2,0,2,3]),vh.setAttribute("position",new _h(j,3,0,!1)),vh.setAttribute("uv",new _h(j,2,3,!1))}this.geometry=vh,this.material=o!==void 0?o:new Cd,this.center=new Bn(.5,.5)}raycast(o,g){o.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ip.setFromMatrixScale(this.matrixWorld),Xg.copy(o.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(o.camera.matrixWorldInverse,this.matrixWorld),Md.setFromMatrixPosition(this.modelViewMatrix),o.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Ip.multiplyScalar(-Md.z);const j=this.material.rotation;let Y,ee;j!==0&&(ee=Math.cos(j),Y=Math.sin(j));const ie=this.center;Td(Ah.set(-.5,-.5,0),Md,ie,Ip,Y,ee),Td(Pp.set(.5,-.5,0),Md,ie,Ip,Y,ee),Td(yh.set(.5,.5,0),Md,ie,Ip,Y,ee),nm.set(0,0),im.set(1,0),iy.set(1,1);let se=o.ray.intersectTriangle(Ah,Pp,yh,!1,tm);if(se===null&&(Td(Pp.set(-.5,.5,0),Md,ie,Ip,Y,ee),im.set(0,1),se=o.ray.intersectTriangle(Ah,yh,Pp,!1,tm),se===null))return;const de=o.ray.origin.distanceTo(tm);de<o.near||de>o.far||g.push({distance:de,point:tm.clone(),uv:Bo.getUV(tm,Ah,Pp,yh,nm,im,iy,new Bn),face:null,object:this})}copy(o,g){return super.copy(o,g),o.center!==void 0&&this.center.copy(o.center),this.material=o.material,this}}function Td(ue,o,g,j,Y,ee){Iu.subVectors(ue,g).addScalar(.5).multiply(j),Y!==void 0?(Dp.x=ee*Iu.x-Y*Iu.y,Dp.y=Y*Iu.x+ee*Iu.y):Dp.copy(Iu),ue.copy(o),ue.x+=Dp.x,ue.y+=Dp.y,ue.applyMatrix4(Xg)}const rm=new vt,Kg=new vt;class Zv extends Ar{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(o){super.copy(o,!1);const g=o.levels;for(let j=0,Y=g.length;j<Y;j++){const ee=g[j];this.addLevel(ee.object.clone(),ee.distance)}return this.autoUpdate=o.autoUpdate,this}addLevel(o,g=0){g=Math.abs(g);const j=this.levels;let Y;for(Y=0;Y<j.length&&!(g<j[Y].distance);Y++);return j.splice(Y,0,{distance:g,object:o}),this.add(o),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(o){const g=this.levels;if(g.length>0){let j,Y;for(j=1,Y=g.length;j<Y&&!(o<g[j].distance);j++);return g[j-1].object}return null}raycast(o,g){if(this.levels.length>0){rm.setFromMatrixPosition(this.matrixWorld);const j=o.ray.origin.distanceTo(rm);this.getObjectForDistance(j).raycast(o,g)}}update(o){const g=this.levels;if(g.length>1){rm.setFromMatrixPosition(o.matrixWorld),Kg.setFromMatrixPosition(this.matrixWorld);const j=rm.distanceTo(Kg)/o.zoom;let Y,ee;for(g[0].object.visible=!0,Y=1,ee=g.length;Y<ee&&j>=g[Y].distance;Y++)g[Y-1].object.visible=!1,g[Y].object.visible=!0;for(this._currentLevel=Y-1;Y<ee;Y++)g[Y].object.visible=!1}}toJSON(o){const g=super.toJSON(o);this.autoUpdate===!1&&(g.object.autoUpdate=!1),g.object.levels=[];const j=this.levels;for(let Y=0,ee=j.length;Y<ee;Y++){const ie=j[Y];g.object.levels.push({object:ie.object.uuid,distance:ie.distance})}return g}}const ry=new vt,Jg=new Vr,Id=new Vr,e0=new vt,sy=new Yi;class Bp extends lo{constructor(o,g){super(o,g),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Yi,this.bindMatrixInverse=new Yi}copy(o,g){return super.copy(o,g),this.bindMode=o.bindMode,this.bindMatrix.copy(o.bindMatrix),this.bindMatrixInverse.copy(o.bindMatrixInverse),this.skeleton=o.skeleton,this}bind(o,g){this.skeleton=o,g===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),g=this.matrixWorld),this.bindMatrix.copy(g),this.bindMatrixInverse.copy(g).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const o=new Vr,g=this.geometry.attributes.skinWeight;for(let j=0,Y=g.count;j<Y;j++){o.fromBufferAttribute(g,j);const ee=1/o.manhattanLength();ee!==1/0?o.multiplyScalar(ee):o.set(1,0,0,0),g.setXYZW(j,o.x,o.y,o.z,o.w)}}updateMatrixWorld(o){super.updateMatrixWorld(o),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(o,g){const j=this.skeleton,Y=this.geometry;Jg.fromBufferAttribute(Y.attributes.skinIndex,o),Id.fromBufferAttribute(Y.attributes.skinWeight,o),ry.copy(g).applyMatrix4(this.bindMatrix),g.set(0,0,0);for(let ee=0;ee<4;ee++){const ie=Id.getComponent(ee);if(ie!==0){const se=Jg.getComponent(ee);sy.multiplyMatrices(j.bones[se].matrixWorld,j.boneInverses[se]),g.addScaledVector(e0.copy(ry).applyMatrix4(sy),ie)}}return g.applyMatrix4(this.bindMatrixInverse)}}class bh extends Ar{constructor(){super(),this.isBone=!0,this.type="Bone"}}class kp extends vs{constructor(o=null,g=1,j=1,Y,ee,ie,se,de,pe=Gr,be=Gr,Ce,xe){super(null,ie,se,de,pe,be,Y,ee,Ce,xe),this.isDataTexture=!0,this.image={data:o,width:g,height:j},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const oy=new Yi,ay=new Yi;class Op{constructor(o=[],g=[]){this.uuid=Oi(),this.bones=o.slice(0),this.boneInverses=g,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const o=this.bones,g=this.boneInverses;if(this.boneMatrices=new Float32Array(16*o.length),g.length===0)this.calculateInverses();else if(o.length!==g.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let j=0,Y=this.bones.length;j<Y;j++)this.boneInverses.push(new Yi)}}calculateInverses(){this.boneInverses.length=0;for(let o=0,g=this.bones.length;o<g;o++){const j=new Yi;this.bones[o]&&j.copy(this.bones[o].matrixWorld).invert(),this.boneInverses.push(j)}}pose(){for(let o=0,g=this.bones.length;o<g;o++){const j=this.bones[o];j&&j.matrixWorld.copy(this.boneInverses[o]).invert()}for(let o=0,g=this.bones.length;o<g;o++){const j=this.bones[o];j&&(j.parent&&j.parent.isBone?(j.matrix.copy(j.parent.matrixWorld).invert(),j.matrix.multiply(j.matrixWorld)):j.matrix.copy(j.matrixWorld),j.matrix.decompose(j.position,j.quaternion,j.scale))}}update(){const o=this.bones,g=this.boneInverses,j=this.boneMatrices,Y=this.boneTexture;for(let ee=0,ie=o.length;ee<ie;ee++){const se=o[ee]?o[ee].matrixWorld:ay;oy.multiplyMatrices(se,g[ee]),oy.toArray(j,16*ee)}Y!==null&&(Y.needsUpdate=!0)}clone(){return new Op(this.bones,this.boneInverses)}computeBoneTexture(){let o=Math.sqrt(4*this.bones.length);o=Ic(o),o=Math.max(o,4);const g=new Float32Array(o*o*4);g.set(this.boneMatrices);const j=new kp(g,o,o,Ii,Zr);return j.needsUpdate=!0,this.boneMatrices=g,this.boneTexture=j,this.boneTextureSize=o,this}getBoneByName(o){for(let g=0,j=this.bones.length;g<j;g++){const Y=this.bones[g];if(Y.name===o)return Y}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(o,g){this.uuid=o.uuid;for(let j=0,Y=o.bones.length;j<Y;j++){const ee=o.bones[j];let ie=g[ee];ie===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",ee),ie=new bh),this.bones.push(ie),this.boneInverses.push(new Yi().fromArray(o.boneInverses[j]))}return this.init(),this}toJSON(){const o={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};o.uuid=this.uuid;const g=this.bones,j=this.boneInverses;for(let Y=0,ee=g.length;Y<ee;Y++){const ie=g[Y];o.bones.push(ie.uuid);const se=j[Y];o.boneInverses.push(se.toArray())}return o}}class Dd extends is{constructor(o,g,j,Y=1){super(o,g,j),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=Y}copy(o){return super.copy(o),this.meshPerAttribute=o.meshPerAttribute,this}toJSON(){const o=super.toJSON();return o.meshPerAttribute=this.meshPerAttribute,o.isInstancedBufferAttribute=!0,o}}const ly=new Yi,cy=new Yi,sm=[],Lp=new lo;class t0 extends lo{constructor(o,g,j){super(o,g),this.isInstancedMesh=!0,this.instanceMatrix=new Dd(new Float32Array(16*j),16),this.instanceColor=null,this.count=j,this.frustumCulled=!1}copy(o,g){return super.copy(o,g),this.instanceMatrix.copy(o.instanceMatrix),o.instanceColor!==null&&(this.instanceColor=o.instanceColor.clone()),this.count=o.count,this}getColorAt(o,g){g.fromArray(this.instanceColor.array,3*o)}getMatrixAt(o,g){g.fromArray(this.instanceMatrix.array,16*o)}raycast(o,g){const j=this.matrixWorld,Y=this.count;if(Lp.geometry=this.geometry,Lp.material=this.material,Lp.material!==void 0)for(let ee=0;ee<Y;ee++){this.getMatrixAt(ee,ly),cy.multiplyMatrices(j,ly),Lp.matrixWorld=cy,Lp.raycast(o,sm);for(let ie=0,se=sm.length;ie<se;ie++){const de=sm[ie];de.instanceId=ee,de.object=this,g.push(de)}sm.length=0}}setColorAt(o,g){this.instanceColor===null&&(this.instanceColor=new Dd(new Float32Array(3*this.instanceMatrix.count),3)),g.toArray(this.instanceColor.array,3*o)}setMatrixAt(o,g){g.toArray(this.instanceMatrix.array,16*o)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class oa extends $s{constructor(o){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new ci(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.linewidth=o.linewidth,this.linecap=o.linecap,this.linejoin=o.linejoin,this.fog=o.fog,this}}const n0=new vt,uy=new vt,i0=new Yi,r0=new vu,Np=new kc;class wh extends Ar{constructor(o=new yi,g=new oa){super(),this.isLine=!0,this.type="Line",this.geometry=o,this.material=g,this.updateMorphTargets()}copy(o,g){return super.copy(o,g),this.material=o.material,this.geometry=o.geometry,this}computeLineDistances(){const o=this.geometry;if(o.index===null){const g=o.attributes.position,j=[0];for(let Y=1,ee=g.count;Y<ee;Y++)n0.fromBufferAttribute(g,Y-1),uy.fromBufferAttribute(g,Y),j[Y]=j[Y-1],j[Y]+=n0.distanceTo(uy);o.setAttribute("lineDistance",new ce(j,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(o,g){const j=this.geometry,Y=this.matrixWorld,ee=o.params.Line.threshold,ie=j.drawRange;if(j.boundingSphere===null&&j.computeBoundingSphere(),Np.copy(j.boundingSphere),Np.applyMatrix4(Y),Np.radius+=ee,o.ray.intersectsSphere(Np)===!1)return;i0.copy(Y).invert(),r0.copy(o.ray).applyMatrix4(i0);const se=ee/((this.scale.x+this.scale.y+this.scale.z)/3),de=se*se,pe=new vt,be=new vt,Ce=new vt,xe=new vt,Ie=this.isLineSegments?2:1,Re=j.index,De=j.attributes.position;if(Re!==null)for(let ze=Math.max(0,ie.start),je=Math.min(Re.count,ie.start+ie.count)-1;ze<je;ze+=Ie){const Ve=Re.getX(ze),$e=Re.getX(ze+1);if(pe.fromBufferAttribute(De,Ve),be.fromBufferAttribute(De,$e),r0.distanceSqToSegment(pe,be,xe,Ce)>de)continue;xe.applyMatrix4(this.matrixWorld);const ct=o.ray.origin.distanceTo(xe);ct<o.near||ct>o.far||g.push({distance:ct,point:Ce.clone().applyMatrix4(this.matrixWorld),index:ze,face:null,faceIndex:null,object:this})}else for(let ze=Math.max(0,ie.start),je=Math.min(De.count,ie.start+ie.count)-1;ze<je;ze+=Ie){if(pe.fromBufferAttribute(De,ze),be.fromBufferAttribute(De,ze+1),r0.distanceSqToSegment(pe,be,xe,Ce)>de)continue;xe.applyMatrix4(this.matrixWorld);const Ve=o.ray.origin.distanceTo(xe);Ve<o.near||Ve>o.far||g.push({distance:Ve,point:Ce.clone().applyMatrix4(this.matrixWorld),index:ze,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const o=this.geometry.morphAttributes,g=Object.keys(o);if(g.length>0){const j=o[g[0]];if(j!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let Y=0,ee=j.length;Y<ee;Y++){const ie=j[Y].name||String(Y);this.morphTargetInfluences.push(0),this.morphTargetDictionary[ie]=Y}}}}}const $g=new vt,s0=new vt;class rc extends wh{constructor(o,g){super(o,g),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const o=this.geometry;if(o.index===null){const g=o.attributes.position,j=[];for(let Y=0,ee=g.count;Y<ee;Y+=2)$g.fromBufferAttribute(g,Y),s0.fromBufferAttribute(g,Y+1),j[Y]=Y===0?0:j[Y-1],j[Y+1]=j[Y]+$g.distanceTo(s0);o.setAttribute("lineDistance",new ce(j,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class hy extends wh{constructor(o,g){super(o,g),this.isLineLoop=!0,this.type="LineLoop"}}class Zg extends $s{constructor(o){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new ci(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.alphaMap=o.alphaMap,this.size=o.size,this.sizeAttenuation=o.sizeAttenuation,this.fog=o.fog,this}}const e_=new Yi,o0=new vu,Up=new kc,t_=new vt;class Fp extends Ar{constructor(o=new yi,g=new Zg){super(),this.isPoints=!0,this.type="Points",this.geometry=o,this.material=g,this.updateMorphTargets()}copy(o,g){return super.copy(o,g),this.material=o.material,this.geometry=o.geometry,this}raycast(o,g){const j=this.geometry,Y=this.matrixWorld,ee=o.params.Points.threshold,ie=j.drawRange;if(j.boundingSphere===null&&j.computeBoundingSphere(),Up.copy(j.boundingSphere),Up.applyMatrix4(Y),Up.radius+=ee,o.ray.intersectsSphere(Up)===!1)return;e_.copy(Y).invert(),o0.copy(o.ray).applyMatrix4(e_);const se=ee/((this.scale.x+this.scale.y+this.scale.z)/3),de=se*se,pe=j.index,be=j.attributes.position;if(pe!==null)for(let Ce=Math.max(0,ie.start),xe=Math.min(pe.count,ie.start+ie.count);Ce<xe;Ce++){const Ie=pe.getX(Ce);t_.fromBufferAttribute(be,Ie),a0(t_,Ie,de,Y,o,g,this)}else for(let Ce=Math.max(0,ie.start),xe=Math.min(be.count,ie.start+ie.count);Ce<xe;Ce++)t_.fromBufferAttribute(be,Ce),a0(t_,Ce,de,Y,o,g,this)}updateMorphTargets(){const o=this.geometry.morphAttributes,g=Object.keys(o);if(g.length>0){const j=o[g[0]];if(j!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let Y=0,ee=j.length;Y<ee;Y++){const ie=j[Y].name||String(Y);this.morphTargetInfluences.push(0),this.morphTargetDictionary[ie]=Y}}}}}function a0(ue,o,g,j,Y,ee,ie){const se=o0.distanceSqToPoint(ue);if(se<g){const de=new vt;o0.closestPointToPoint(ue,de),de.applyMatrix4(j);const pe=Y.ray.origin.distanceTo(de);if(pe<Y.near||pe>Y.far)return;ee.push({distance:pe,distanceToRay:Math.sqrt(se),point:de,index:o,face:null,object:ie})}}class dy extends vs{constructor(o,g,j,Y,ee,ie,se,de,pe){super(o,g,j,Y,ee,ie,se,de,pe),this.isVideoTexture=!0,this.minFilter=ie!==void 0?ie:Ur,this.magFilter=ee!==void 0?ee:Ur,this.generateMipmaps=!1;const be=this;"requestVideoFrameCallback"in o&&o.requestVideoFrameCallback(function Ce(){be.needsUpdate=!0,o.requestVideoFrameCallback(Ce)})}clone(){return new this.constructor(this.image).copy(this)}update(){const o=this.image;!("requestVideoFrameCallback"in o)&&o.readyState>=o.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class py extends vs{constructor(o,g,j){super({width:o,height:g}),this.isFramebufferTexture=!0,this.format=j,this.magFilter=Gr,this.minFilter=Gr,this.generateMipmaps=!1,this.needsUpdate=!0}}class fy extends vs{constructor(o,g,j,Y,ee,ie,se,de,pe,be,Ce,xe){super(null,ie,se,de,pe,be,Y,ee,Ce,xe),this.isCompressedTexture=!0,this.image={width:g,height:j},this.mipmaps=o,this.flipY=!1,this.generateMipmaps=!1}}class my extends vs{constructor(o,g,j,Y,ee,ie,se,de,pe){super(o,g,j,Y,ee,ie,se,de,pe),this.isCanvasTexture=!0,this.needsUpdate=!0}}class $a{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(o,g){const j=this.getUtoTmapping(o);return this.getPoint(j,g)}getPoints(o=5){const g=[];for(let j=0;j<=o;j++)g.push(this.getPoint(j/o));return g}getSpacedPoints(o=5){const g=[];for(let j=0;j<=o;j++)g.push(this.getPointAt(j/o));return g}getLength(){const o=this.getLengths();return o[o.length-1]}getLengths(o=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===o+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const g=[];let j,Y=this.getPoint(0),ee=0;g.push(0);for(let ie=1;ie<=o;ie++)j=this.getPoint(ie/o),ee+=j.distanceTo(Y),g.push(ee),Y=j;return this.cacheArcLengths=g,g}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(o,g){const j=this.getLengths();let Y=0;const ee=j.length;let ie;ie=g||o*j[ee-1];let se,de=0,pe=ee-1;for(;de<=pe;)if(Y=Math.floor(de+(pe-de)/2),se=j[Y]-ie,se<0)de=Y+1;else{if(!(se>0)){pe=Y;break}pe=Y-1}if(Y=pe,j[Y]===ie)return Y/(ee-1);const be=j[Y];return(Y+(ie-be)/(j[Y+1]-be))/(ee-1)}getTangent(o,g){let Y=o-1e-4,ee=o+1e-4;Y<0&&(Y=0),ee>1&&(ee=1);const ie=this.getPoint(Y),se=this.getPoint(ee),de=g||(ie.isVector2?new Bn:new vt);return de.copy(se).sub(ie).normalize(),de}getTangentAt(o,g){const j=this.getUtoTmapping(o);return this.getTangent(j,g)}computeFrenetFrames(o,g){const j=new vt,Y=[],ee=[],ie=[],se=new vt,de=new Yi;for(let Ie=0;Ie<=o;Ie++){const Re=Ie/o;Y[Ie]=this.getTangentAt(Re,new vt)}ee[0]=new vt,ie[0]=new vt;let pe=Number.MAX_VALUE;const be=Math.abs(Y[0].x),Ce=Math.abs(Y[0].y),xe=Math.abs(Y[0].z);be<=pe&&(pe=be,j.set(1,0,0)),Ce<=pe&&(pe=Ce,j.set(0,1,0)),xe<=pe&&j.set(0,0,1),se.crossVectors(Y[0],j).normalize(),ee[0].crossVectors(Y[0],se),ie[0].crossVectors(Y[0],ee[0]);for(let Ie=1;Ie<=o;Ie++){if(ee[Ie]=ee[Ie-1].clone(),ie[Ie]=ie[Ie-1].clone(),se.crossVectors(Y[Ie-1],Y[Ie]),se.length()>Number.EPSILON){se.normalize();const Re=Math.acos(Si(Y[Ie-1].dot(Y[Ie]),-1,1));ee[Ie].applyMatrix4(de.makeRotationAxis(se,Re))}ie[Ie].crossVectors(Y[Ie],ee[Ie])}if(g===!0){let Ie=Math.acos(Si(ee[0].dot(ee[o]),-1,1));Ie/=o,Y[0].dot(se.crossVectors(ee[0],ee[o]))>0&&(Ie=-Ie);for(let Re=1;Re<=o;Re++)ee[Re].applyMatrix4(de.makeRotationAxis(Y[Re],Ie*Re)),ie[Re].crossVectors(Y[Re],ee[Re])}return{tangents:Y,normals:ee,binormals:ie}}clone(){return new this.constructor().copy(this)}copy(o){return this.arcLengthDivisions=o.arcLengthDivisions,this}toJSON(){const o={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return o.arcLengthDivisions=this.arcLengthDivisions,o.type=this.type,o}fromJSON(o){return this.arcLengthDivisions=o.arcLengthDivisions,this}}class xh extends $a{constructor(o=0,g=0,j=1,Y=1,ee=0,ie=2*Math.PI,se=!1,de=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=o,this.aY=g,this.xRadius=j,this.yRadius=Y,this.aStartAngle=ee,this.aEndAngle=ie,this.aClockwise=se,this.aRotation=de}getPoint(o,g){const j=g||new Bn,Y=2*Math.PI;let ee=this.aEndAngle-this.aStartAngle;const ie=Math.abs(ee)<Number.EPSILON;for(;ee<0;)ee+=Y;for(;ee>Y;)ee-=Y;ee<Number.EPSILON&&(ee=ie?0:Y),this.aClockwise!==!0||ie||(ee===Y?ee=-Y:ee-=Y);const se=this.aStartAngle+o*ee;let de=this.aX+this.xRadius*Math.cos(se),pe=this.aY+this.yRadius*Math.sin(se);if(this.aRotation!==0){const be=Math.cos(this.aRotation),Ce=Math.sin(this.aRotation),xe=de-this.aX,Ie=pe-this.aY;de=xe*be-Ie*Ce+this.aX,pe=xe*Ce+Ie*be+this.aY}return j.set(de,pe)}copy(o){return super.copy(o),this.aX=o.aX,this.aY=o.aY,this.xRadius=o.xRadius,this.yRadius=o.yRadius,this.aStartAngle=o.aStartAngle,this.aEndAngle=o.aEndAngle,this.aClockwise=o.aClockwise,this.aRotation=o.aRotation,this}toJSON(){const o=super.toJSON();return o.aX=this.aX,o.aY=this.aY,o.xRadius=this.xRadius,o.yRadius=this.yRadius,o.aStartAngle=this.aStartAngle,o.aEndAngle=this.aEndAngle,o.aClockwise=this.aClockwise,o.aRotation=this.aRotation,o}fromJSON(o){return super.fromJSON(o),this.aX=o.aX,this.aY=o.aY,this.xRadius=o.xRadius,this.yRadius=o.yRadius,this.aStartAngle=o.aStartAngle,this.aEndAngle=o.aEndAngle,this.aClockwise=o.aClockwise,this.aRotation=o.aRotation,this}}class n_ extends xh{constructor(o,g,j,Y,ee,ie){super(o,g,j,j,Y,ee,ie),this.isArcCurve=!0,this.type="ArcCurve"}}function Pd(){let ue=0,o=0,g=0,j=0;function Y(ee,ie,se,de){ue=ee,o=se,g=-3*ee+3*ie-2*se-de,j=2*ee-2*ie+se+de}return{initCatmullRom:function(ee,ie,se,de,pe){Y(ie,se,pe*(se-ee),pe*(de-ie))},initNonuniformCatmullRom:function(ee,ie,se,de,pe,be,Ce){let xe=(ie-ee)/pe-(se-ee)/(pe+be)+(se-ie)/be,Ie=(se-ie)/be-(de-ie)/(be+Ce)+(de-se)/Ce;xe*=be,Ie*=be,Y(ie,se,xe,Ie)},calc:function(ee){const ie=ee*ee;return ue+o*ee+g*ie+j*(ie*ee)}}}const Rd=new vt,om=new Pd,l0=new Pd,c0=new Pd;class gy extends $a{constructor(o=[],g=!1,j="centripetal",Y=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=o,this.closed=g,this.curveType=j,this.tension=Y}getPoint(o,g=new vt){const j=g,Y=this.points,ee=Y.length,ie=(ee-(this.closed?0:1))*o;let se,de,pe=Math.floor(ie),be=ie-pe;this.closed?pe+=pe>0?0:(Math.floor(Math.abs(pe)/ee)+1)*ee:be===0&&pe===ee-1&&(pe=ee-2,be=1),this.closed||pe>0?se=Y[(pe-1)%ee]:(Rd.subVectors(Y[0],Y[1]).add(Y[0]),se=Rd);const Ce=Y[pe%ee],xe=Y[(pe+1)%ee];if(this.closed||pe+2<ee?de=Y[(pe+2)%ee]:(Rd.subVectors(Y[ee-1],Y[ee-2]).add(Y[ee-1]),de=Rd),this.curveType==="centripetal"||this.curveType==="chordal"){const Ie=this.curveType==="chordal"?.5:.25;let Re=Math.pow(se.distanceToSquared(Ce),Ie),De=Math.pow(Ce.distanceToSquared(xe),Ie),ze=Math.pow(xe.distanceToSquared(de),Ie);De<1e-4&&(De=1),Re<1e-4&&(Re=De),ze<1e-4&&(ze=De),om.initNonuniformCatmullRom(se.x,Ce.x,xe.x,de.x,Re,De,ze),l0.initNonuniformCatmullRom(se.y,Ce.y,xe.y,de.y,Re,De,ze),c0.initNonuniformCatmullRom(se.z,Ce.z,xe.z,de.z,Re,De,ze)}else this.curveType==="catmullrom"&&(om.initCatmullRom(se.x,Ce.x,xe.x,de.x,this.tension),l0.initCatmullRom(se.y,Ce.y,xe.y,de.y,this.tension),c0.initCatmullRom(se.z,Ce.z,xe.z,de.z,this.tension));return j.set(om.calc(be),l0.calc(be),c0.calc(be)),j}copy(o){super.copy(o),this.points=[];for(let g=0,j=o.points.length;g<j;g++){const Y=o.points[g];this.points.push(Y.clone())}return this.closed=o.closed,this.curveType=o.curveType,this.tension=o.tension,this}toJSON(){const o=super.toJSON();o.points=[];for(let g=0,j=this.points.length;g<j;g++){const Y=this.points[g];o.points.push(Y.toArray())}return o.closed=this.closed,o.curveType=this.curveType,o.tension=this.tension,o}fromJSON(o){super.fromJSON(o),this.points=[];for(let g=0,j=o.points.length;g<j;g++){const Y=o.points[g];this.points.push(new vt().fromArray(Y))}return this.closed=o.closed,this.curveType=o.curveType,this.tension=o.tension,this}}function u0(ue,o,g,j,Y){const ee=.5*(j-o),ie=.5*(Y-g),se=ue*ue;return(2*g-2*j+ee+ie)*(ue*se)+(-3*g+3*j-2*ee-ie)*se+ee*ue+g}function am(ue,o,g,j){return function(Y,ee){const ie=1-Y;return ie*ie*ee}(ue,o)+function(Y,ee){return 2*(1-Y)*Y*ee}(ue,g)+function(Y,ee){return Y*Y*ee}(ue,j)}function jp(ue,o,g,j,Y){return function(ee,ie){const se=1-ee;return se*se*se*ie}(ue,o)+function(ee,ie){const se=1-ee;return 3*se*se*ee*ie}(ue,g)+function(ee,ie){return 3*(1-ee)*ee*ee*ie}(ue,j)+function(ee,ie){return ee*ee*ee*ie}(ue,Y)}class h0 extends $a{constructor(o=new Bn,g=new Bn,j=new Bn,Y=new Bn){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=o,this.v1=g,this.v2=j,this.v3=Y}getPoint(o,g=new Bn){const j=g,Y=this.v0,ee=this.v1,ie=this.v2,se=this.v3;return j.set(jp(o,Y.x,ee.x,ie.x,se.x),jp(o,Y.y,ee.y,ie.y,se.y)),j}copy(o){return super.copy(o),this.v0.copy(o.v0),this.v1.copy(o.v1),this.v2.copy(o.v2),this.v3.copy(o.v3),this}toJSON(){const o=super.toJSON();return o.v0=this.v0.toArray(),o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o.v3=this.v3.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v0.fromArray(o.v0),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this.v3.fromArray(o.v3),this}}class d0 extends $a{constructor(o=new vt,g=new vt,j=new vt,Y=new vt){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=o,this.v1=g,this.v2=j,this.v3=Y}getPoint(o,g=new vt){const j=g,Y=this.v0,ee=this.v1,ie=this.v2,se=this.v3;return j.set(jp(o,Y.x,ee.x,ie.x,se.x),jp(o,Y.y,ee.y,ie.y,se.y),jp(o,Y.z,ee.z,ie.z,se.z)),j}copy(o){return super.copy(o),this.v0.copy(o.v0),this.v1.copy(o.v1),this.v2.copy(o.v2),this.v3.copy(o.v3),this}toJSON(){const o=super.toJSON();return o.v0=this.v0.toArray(),o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o.v3=this.v3.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v0.fromArray(o.v0),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this.v3.fromArray(o.v3),this}}class i_ extends $a{constructor(o=new Bn,g=new Bn){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=o,this.v2=g}getPoint(o,g=new Bn){const j=g;return o===1?j.copy(this.v2):(j.copy(this.v2).sub(this.v1),j.multiplyScalar(o).add(this.v1)),j}getPointAt(o,g){return this.getPoint(o,g)}getTangent(o,g){const j=g||new Bn;return j.copy(this.v2).sub(this.v1).normalize(),j}copy(o){return super.copy(o),this.v1.copy(o.v1),this.v2.copy(o.v2),this}toJSON(){const o=super.toJSON();return o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this}}class zp extends $a{constructor(o=new vt,g=new vt){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=o,this.v2=g}getPoint(o,g=new vt){const j=g;return o===1?j.copy(this.v2):(j.copy(this.v2).sub(this.v1),j.multiplyScalar(o).add(this.v1)),j}getPointAt(o,g){return this.getPoint(o,g)}copy(o){return super.copy(o),this.v1.copy(o.v1),this.v2.copy(o.v2),this}toJSON(){const o=super.toJSON();return o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this}}class lm extends $a{constructor(o=new Bn,g=new Bn,j=new Bn){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=o,this.v1=g,this.v2=j}getPoint(o,g=new Bn){const j=g,Y=this.v0,ee=this.v1,ie=this.v2;return j.set(am(o,Y.x,ee.x,ie.x),am(o,Y.y,ee.y,ie.y)),j}copy(o){return super.copy(o),this.v0.copy(o.v0),this.v1.copy(o.v1),this.v2.copy(o.v2),this}toJSON(){const o=super.toJSON();return o.v0=this.v0.toArray(),o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v0.fromArray(o.v0),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this}}class eo extends $a{constructor(o=new vt,g=new vt,j=new vt){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=o,this.v1=g,this.v2=j}getPoint(o,g=new vt){const j=g,Y=this.v0,ee=this.v1,ie=this.v2;return j.set(am(o,Y.x,ee.x,ie.x),am(o,Y.y,ee.y,ie.y),am(o,Y.z,ee.z,ie.z)),j}copy(o){return super.copy(o),this.v0.copy(o.v0),this.v1.copy(o.v1),this.v2.copy(o.v2),this}toJSON(){const o=super.toJSON();return o.v0=this.v0.toArray(),o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v0.fromArray(o.v0),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this}}class cm extends $a{constructor(o=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=o}getPoint(o,g=new Bn){const j=g,Y=this.points,ee=(Y.length-1)*o,ie=Math.floor(ee),se=ee-ie,de=Y[ie===0?ie:ie-1],pe=Y[ie],be=Y[ie>Y.length-2?Y.length-1:ie+1],Ce=Y[ie>Y.length-3?Y.length-1:ie+2];return j.set(u0(se,de.x,pe.x,be.x,Ce.x),u0(se,de.y,pe.y,be.y,Ce.y)),j}copy(o){super.copy(o),this.points=[];for(let g=0,j=o.points.length;g<j;g++){const Y=o.points[g];this.points.push(Y.clone())}return this}toJSON(){const o=super.toJSON();o.points=[];for(let g=0,j=this.points.length;g<j;g++){const Y=this.points[g];o.points.push(Y.toArray())}return o}fromJSON(o){super.fromJSON(o),this.points=[];for(let g=0,j=o.points.length;g<j;g++){const Y=o.points[g];this.points.push(new Bn().fromArray(Y))}return this}}var r_=Object.freeze({__proto__:null,ArcCurve:n_,CatmullRomCurve3:gy,CubicBezierCurve:h0,CubicBezierCurve3:d0,EllipseCurve:xh,LineCurve:i_,LineCurve3:zp,QuadraticBezierCurve:lm,QuadraticBezierCurve3:eo,SplineCurve:cm});class s_ extends $a{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(o){this.curves.push(o)}closePath(){const o=this.curves[0].getPoint(0),g=this.curves[this.curves.length-1].getPoint(1);o.equals(g)||this.curves.push(new i_(g,o))}getPoint(o,g){const j=o*this.getLength(),Y=this.getCurveLengths();let ee=0;for(;ee<Y.length;){if(Y[ee]>=j){const ie=Y[ee]-j,se=this.curves[ee],de=se.getLength(),pe=de===0?0:1-ie/de;return se.getPointAt(pe,g)}ee++}return null}getLength(){const o=this.getCurveLengths();return o[o.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const o=[];let g=0;for(let j=0,Y=this.curves.length;j<Y;j++)g+=this.curves[j].getLength(),o.push(g);return this.cacheLengths=o,o}getSpacedPoints(o=40){const g=[];for(let j=0;j<=o;j++)g.push(this.getPoint(j/o));return this.autoClose&&g.push(g[0]),g}getPoints(o=12){const g=[];let j;for(let Y=0,ee=this.curves;Y<ee.length;Y++){const ie=ee[Y],se=ie.isEllipseCurve?2*o:ie.isLineCurve||ie.isLineCurve3?1:ie.isSplineCurve?o*ie.points.length:o,de=ie.getPoints(se);for(let pe=0;pe<de.length;pe++){const be=de[pe];j&&j.equals(be)||(g.push(be),j=be)}}return this.autoClose&&g.length>1&&!g[g.length-1].equals(g[0])&&g.push(g[0]),g}copy(o){super.copy(o),this.curves=[];for(let g=0,j=o.curves.length;g<j;g++){const Y=o.curves[g];this.curves.push(Y.clone())}return this.autoClose=o.autoClose,this}toJSON(){const o=super.toJSON();o.autoClose=this.autoClose,o.curves=[];for(let g=0,j=this.curves.length;g<j;g++){const Y=this.curves[g];o.curves.push(Y.toJSON())}return o}fromJSON(o){super.fromJSON(o),this.autoClose=o.autoClose,this.curves=[];for(let g=0,j=o.curves.length;g<j;g++){const Y=o.curves[g];this.curves.push(new r_[Y.type]().fromJSON(Y))}return this}}class Vp extends s_{constructor(o){super(),this.type="Path",this.currentPoint=new Bn,o&&this.setFromPoints(o)}setFromPoints(o){this.moveTo(o[0].x,o[0].y);for(let g=1,j=o.length;g<j;g++)this.lineTo(o[g].x,o[g].y);return this}moveTo(o,g){return this.currentPoint.set(o,g),this}lineTo(o,g){const j=new i_(this.currentPoint.clone(),new Bn(o,g));return this.curves.push(j),this.currentPoint.set(o,g),this}quadraticCurveTo(o,g,j,Y){const ee=new lm(this.currentPoint.clone(),new Bn(o,g),new Bn(j,Y));return this.curves.push(ee),this.currentPoint.set(j,Y),this}bezierCurveTo(o,g,j,Y,ee,ie){const se=new h0(this.currentPoint.clone(),new Bn(o,g),new Bn(j,Y),new Bn(ee,ie));return this.curves.push(se),this.currentPoint.set(ee,ie),this}splineThru(o){const g=[this.currentPoint.clone()].concat(o),j=new cm(g);return this.curves.push(j),this.currentPoint.copy(o[o.length-1]),this}arc(o,g,j,Y,ee,ie){const se=this.currentPoint.x,de=this.currentPoint.y;return this.absarc(o+se,g+de,j,Y,ee,ie),this}absarc(o,g,j,Y,ee,ie){return this.absellipse(o,g,j,j,Y,ee,ie),this}ellipse(o,g,j,Y,ee,ie,se,de){const pe=this.currentPoint.x,be=this.currentPoint.y;return this.absellipse(o+pe,g+be,j,Y,ee,ie,se,de),this}absellipse(o,g,j,Y,ee,ie,se,de){const pe=new xh(o,g,j,Y,ee,ie,se,de);if(this.curves.length>0){const Ce=pe.getPoint(0);Ce.equals(this.currentPoint)||this.lineTo(Ce.x,Ce.y)}this.curves.push(pe);const be=pe.getPoint(1);return this.currentPoint.copy(be),this}copy(o){return super.copy(o),this.currentPoint.copy(o.currentPoint),this}toJSON(){const o=super.toJSON();return o.currentPoint=this.currentPoint.toArray(),o}fromJSON(o){return super.fromJSON(o),this.currentPoint.fromArray(o.currentPoint),this}}class Gc extends yi{constructor(o=[new Bn(0,-.5),new Bn(.5,0),new Bn(0,.5)],g=12,j=0,Y=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:o,segments:g,phiStart:j,phiLength:Y},g=Math.floor(g),Y=Si(Y,0,2*Math.PI);const ee=[],ie=[],se=[],de=[],pe=[],be=1/g,Ce=new vt,xe=new Bn,Ie=new vt,Re=new vt,De=new vt;let ze=0,je=0;for(let Ve=0;Ve<=o.length-1;Ve++)switch(Ve){case 0:ze=o[Ve+1].x-o[Ve].x,je=o[Ve+1].y-o[Ve].y,Ie.x=1*je,Ie.y=-ze,Ie.z=0*je,De.copy(Ie),Ie.normalize(),de.push(Ie.x,Ie.y,Ie.z);break;case o.length-1:de.push(De.x,De.y,De.z);break;default:ze=o[Ve+1].x-o[Ve].x,je=o[Ve+1].y-o[Ve].y,Ie.x=1*je,Ie.y=-ze,Ie.z=0*je,Re.copy(Ie),Ie.x+=De.x,Ie.y+=De.y,Ie.z+=De.z,Ie.normalize(),de.push(Ie.x,Ie.y,Ie.z),De.copy(Re)}for(let Ve=0;Ve<=g;Ve++){const $e=j+Ve*be*Y,ct=Math.sin($e),dt=Math.cos($e);for(let ft=0;ft<=o.length-1;ft++){Ce.x=o[ft].x*ct,Ce.y=o[ft].y,Ce.z=o[ft].x*dt,ie.push(Ce.x,Ce.y,Ce.z),xe.x=Ve/g,xe.y=ft/(o.length-1),se.push(xe.x,xe.y);const Bt=de[3*ft+0]*ct,Lt=de[3*ft+1],Wt=de[3*ft+0]*dt;pe.push(Bt,Lt,Wt)}}for(let Ve=0;Ve<g;Ve++)for(let $e=0;$e<o.length-1;$e++){const ct=$e+Ve*o.length,dt=ct,ft=ct+o.length,Bt=ct+o.length+1,Lt=ct+1;ee.push(dt,ft,Lt),ee.push(Bt,Lt,ft)}this.setIndex(ee),this.setAttribute("position",new ce(ie,3)),this.setAttribute("uv",new ce(se,2)),this.setAttribute("normal",new ce(pe,3))}static fromJSON(o){return new Gc(o.points,o.segments,o.phiStart,o.phiLength)}}class sc extends Gc{constructor(o=1,g=1,j=4,Y=8){const ee=new Vp;ee.absarc(0,-g/2,o,1.5*Math.PI,0),ee.absarc(0,g/2,o,0,.5*Math.PI),super(ee.getPoints(j),Y),this.type="CapsuleGeometry",this.parameters={radius:o,height:g,capSegments:j,radialSegments:Y}}static fromJSON(o){return new sc(o.radius,o.length,o.capSegments,o.radialSegments)}}class Gp extends yi{constructor(o=1,g=8,j=0,Y=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:o,segments:g,thetaStart:j,thetaLength:Y},g=Math.max(3,g);const ee=[],ie=[],se=[],de=[],pe=new vt,be=new Bn;ie.push(0,0,0),se.push(0,0,1),de.push(.5,.5);for(let Ce=0,xe=3;Ce<=g;Ce++,xe+=3){const Ie=j+Ce/g*Y;pe.x=o*Math.cos(Ie),pe.y=o*Math.sin(Ie),ie.push(pe.x,pe.y,pe.z),se.push(0,0,1),be.x=(ie[xe]/o+1)/2,be.y=(ie[xe+1]/o+1)/2,de.push(be.x,be.y)}for(let Ce=1;Ce<=g;Ce++)ee.push(Ce,Ce+1,0);this.setIndex(ee),this.setAttribute("position",new ce(ie,3)),this.setAttribute("normal",new ce(se,3)),this.setAttribute("uv",new ce(de,2))}static fromJSON(o){return new Gp(o.radius,o.segments,o.thetaStart,o.thetaLength)}}class Bd extends yi{constructor(o=1,g=1,j=1,Y=8,ee=1,ie=!1,se=0,de=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:o,radiusBottom:g,height:j,radialSegments:Y,heightSegments:ee,openEnded:ie,thetaStart:se,thetaLength:de};const pe=this;Y=Math.floor(Y),ee=Math.floor(ee);const be=[],Ce=[],xe=[],Ie=[];let Re=0;const De=[],ze=j/2;let je=0;function Ve($e){const ct=Re,dt=new Bn,ft=new vt;let Bt=0;const Lt=$e===!0?o:g,Wt=$e===!0?1:-1;for(let Ot=1;Ot<=Y;Ot++)Ce.push(0,ze*Wt,0),xe.push(0,Wt,0),Ie.push(.5,.5),Re++;const qt=Re;for(let Ot=0;Ot<=Y;Ot++){const En=Ot/Y*de+se,Ln=Math.cos(En),wn=Math.sin(En);ft.x=Lt*wn,ft.y=ze*Wt,ft.z=Lt*Ln,Ce.push(ft.x,ft.y,ft.z),xe.push(0,Wt,0),dt.x=.5*Ln+.5,dt.y=.5*wn*Wt+.5,Ie.push(dt.x,dt.y),Re++}for(let Ot=0;Ot<Y;Ot++){const En=ct+Ot,Ln=qt+Ot;$e===!0?be.push(Ln,Ln+1,En):be.push(Ln+1,Ln,En),Bt+=3}pe.addGroup(je,Bt,$e===!0?1:2),je+=Bt}(function(){const $e=new vt,ct=new vt;let dt=0;const ft=(g-o)/j;for(let Bt=0;Bt<=ee;Bt++){const Lt=[],Wt=Bt/ee,qt=Wt*(g-o)+o;for(let Ot=0;Ot<=Y;Ot++){const En=Ot/Y,Ln=En*de+se,wn=Math.sin(Ln),jn=Math.cos(Ln);ct.x=qt*wn,ct.y=-Wt*j+ze,ct.z=qt*jn,Ce.push(ct.x,ct.y,ct.z),$e.set(wn,ft,jn).normalize(),xe.push($e.x,$e.y,$e.z),Ie.push(En,1-Wt),Lt.push(Re++)}De.push(Lt)}for(let Bt=0;Bt<Y;Bt++)for(let Lt=0;Lt<ee;Lt++){const Wt=De[Lt][Bt],qt=De[Lt+1][Bt],Ot=De[Lt+1][Bt+1],En=De[Lt][Bt+1];be.push(Wt,qt,En),be.push(qt,Ot,En),dt+=6}pe.addGroup(je,dt,0),je+=dt})(),ie===!1&&(o>0&&Ve(!0),g>0&&Ve(!1)),this.setIndex(be),this.setAttribute("position",new ce(Ce,3)),this.setAttribute("normal",new ce(xe,3)),this.setAttribute("uv",new ce(Ie,2))}static fromJSON(o){return new Bd(o.radiusTop,o.radiusBottom,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength)}}class br extends Bd{constructor(o=1,g=1,j=8,Y=1,ee=!1,ie=0,se=2*Math.PI){super(0,o,g,j,Y,ee,ie,se),this.type="ConeGeometry",this.parameters={radius:o,height:g,radialSegments:j,heightSegments:Y,openEnded:ee,thetaStart:ie,thetaLength:se}}static fromJSON(o){return new br(o.radius,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength)}}class Qc extends yi{constructor(o=[],g=[],j=1,Y=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:o,indices:g,radius:j,detail:Y};const ee=[],ie=[];function se(xe,Ie,Re,De){const ze=De+1,je=[];for(let Ve=0;Ve<=ze;Ve++){je[Ve]=[];const $e=xe.clone().lerp(Re,Ve/ze),ct=Ie.clone().lerp(Re,Ve/ze),dt=ze-Ve;for(let ft=0;ft<=dt;ft++)je[Ve][ft]=ft===0&&Ve===ze?$e:$e.clone().lerp(ct,ft/dt)}for(let Ve=0;Ve<ze;Ve++)for(let $e=0;$e<2*(ze-Ve)-1;$e++){const ct=Math.floor($e/2);$e%2==0?(de(je[Ve][ct+1]),de(je[Ve+1][ct]),de(je[Ve][ct])):(de(je[Ve][ct+1]),de(je[Ve+1][ct+1]),de(je[Ve+1][ct]))}}function de(xe){ee.push(xe.x,xe.y,xe.z)}function pe(xe,Ie){const Re=3*xe;Ie.x=o[Re+0],Ie.y=o[Re+1],Ie.z=o[Re+2]}function be(xe,Ie,Re,De){De<0&&xe.x===1&&(ie[Ie]=xe.x-1),Re.x===0&&Re.z===0&&(ie[Ie]=De/2/Math.PI+.5)}function Ce(xe){return Math.atan2(xe.z,-xe.x)}(function(xe){const Ie=new vt,Re=new vt,De=new vt;for(let ze=0;ze<g.length;ze+=3)pe(g[ze+0],Ie),pe(g[ze+1],Re),pe(g[ze+2],De),se(Ie,Re,De,xe)})(Y),function(xe){const Ie=new vt;for(let Re=0;Re<ee.length;Re+=3)Ie.x=ee[Re+0],Ie.y=ee[Re+1],Ie.z=ee[Re+2],Ie.normalize().multiplyScalar(xe),ee[Re+0]=Ie.x,ee[Re+1]=Ie.y,ee[Re+2]=Ie.z}(j),function(){const xe=new vt;for(let Re=0;Re<ee.length;Re+=3){xe.x=ee[Re+0],xe.y=ee[Re+1],xe.z=ee[Re+2];const De=Ce(xe)/2/Math.PI+.5,ze=(Ie=xe,Math.atan2(-Ie.y,Math.sqrt(Ie.x*Ie.x+Ie.z*Ie.z))/Math.PI+.5);ie.push(De,1-ze)}var Ie;(function(){const Re=new vt,De=new vt,ze=new vt,je=new vt,Ve=new Bn,$e=new Bn,ct=new Bn;for(let dt=0,ft=0;dt<ee.length;dt+=9,ft+=6){Re.set(ee[dt+0],ee[dt+1],ee[dt+2]),De.set(ee[dt+3],ee[dt+4],ee[dt+5]),ze.set(ee[dt+6],ee[dt+7],ee[dt+8]),Ve.set(ie[ft+0],ie[ft+1]),$e.set(ie[ft+2],ie[ft+3]),ct.set(ie[ft+4],ie[ft+5]),je.copy(Re).add(De).add(ze).divideScalar(3);const Bt=Ce(je);be(Ve,ft+0,Re,Bt),be($e,ft+2,De,Bt),be(ct,ft+4,ze,Bt)}})(),function(){for(let Re=0;Re<ie.length;Re+=6){const De=ie[Re+0],ze=ie[Re+2],je=ie[Re+4],Ve=Math.max(De,ze,je),$e=Math.min(De,ze,je);Ve>.9&&$e<.1&&(De<.2&&(ie[Re+0]+=1),ze<.2&&(ie[Re+2]+=1),je<.2&&(ie[Re+4]+=1))}}()}(),this.setAttribute("position",new ce(ee,3)),this.setAttribute("normal",new ce(ee.slice(),3)),this.setAttribute("uv",new ce(ie,2)),Y===0?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(o){return new Qc(o.vertices,o.indices,o.radius,o.details)}}class Qp extends Qc{constructor(o=1,g=0){const j=(1+Math.sqrt(5))/2,Y=1/j;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-Y,-j,0,-Y,j,0,Y,-j,0,Y,j,-Y,-j,0,-Y,j,0,Y,-j,0,Y,j,0,-j,0,-Y,j,0,-Y,-j,0,Y,j,0,Y],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],o,g),this.type="DodecahedronGeometry",this.parameters={radius:o,detail:g}}static fromJSON(o){return new Qp(o.radius,o.detail)}}const zs=new vt,o_=new vt,oc=new vt,aa=new Bo;class Os extends yi{constructor(o=null,g=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:o,thresholdAngle:g},o!==null){const Y=Math.pow(10,4),ee=Math.cos(du*g),ie=o.getIndex(),se=o.getAttribute("position"),de=ie?ie.count:se.count,pe=[0,0,0],be=["a","b","c"],Ce=new Array(3),xe={},Ie=[];for(let Re=0;Re<de;Re+=3){ie?(pe[0]=ie.getX(Re),pe[1]=ie.getX(Re+1),pe[2]=ie.getX(Re+2)):(pe[0]=Re,pe[1]=Re+1,pe[2]=Re+2);const{a:De,b:ze,c:je}=aa;if(De.fromBufferAttribute(se,pe[0]),ze.fromBufferAttribute(se,pe[1]),je.fromBufferAttribute(se,pe[2]),aa.getNormal(oc),Ce[0]=`${Math.round(De.x*Y)},${Math.round(De.y*Y)},${Math.round(De.z*Y)}`,Ce[1]=`${Math.round(ze.x*Y)},${Math.round(ze.y*Y)},${Math.round(ze.z*Y)}`,Ce[2]=`${Math.round(je.x*Y)},${Math.round(je.y*Y)},${Math.round(je.z*Y)}`,Ce[0]!==Ce[1]&&Ce[1]!==Ce[2]&&Ce[2]!==Ce[0])for(let Ve=0;Ve<3;Ve++){const $e=(Ve+1)%3,ct=Ce[Ve],dt=Ce[$e],ft=aa[be[Ve]],Bt=aa[be[$e]],Lt=`${ct}_${dt}`,Wt=`${dt}_${ct}`;Wt in xe&&xe[Wt]?(oc.dot(xe[Wt].normal)<=ee&&(Ie.push(ft.x,ft.y,ft.z),Ie.push(Bt.x,Bt.y,Bt.z)),xe[Wt]=null):Lt in xe||(xe[Lt]={index0:pe[Ve],index1:pe[$e],normal:oc.clone()})}}for(const Re in xe)if(xe[Re]){const{index0:De,index1:ze}=xe[Re];zs.fromBufferAttribute(se,De),o_.fromBufferAttribute(se,ze),Ie.push(zs.x,zs.y,zs.z),Ie.push(o_.x,o_.y,o_.z)}this.setAttribute("position",new ce(Ie,3))}}}class kd extends Vp{constructor(o){super(o),this.uuid=Oi(),this.type="Shape",this.holes=[]}getPointsHoles(o){const g=[];for(let j=0,Y=this.holes.length;j<Y;j++)g[j]=this.holes[j].getPoints(o);return g}extractPoints(o){return{shape:this.getPoints(o),holes:this.getPointsHoles(o)}}copy(o){super.copy(o),this.holes=[];for(let g=0,j=o.holes.length;g<j;g++){const Y=o.holes[g];this.holes.push(Y.clone())}return this}toJSON(){const o=super.toJSON();o.uuid=this.uuid,o.holes=[];for(let g=0,j=this.holes.length;g<j;g++){const Y=this.holes[g];o.holes.push(Y.toJSON())}return o}fromJSON(o){super.fromJSON(o),this.uuid=o.uuid,this.holes=[];for(let g=0,j=o.holes.length;g<j;g++){const Y=o.holes[g];this.holes.push(new Vp().fromJSON(Y))}return this}}function _y(ue,o,g,j,Y){let ee,ie;if(Y===function(se,de,pe,be){let Ce=0;for(let xe=de,Ie=pe-be;xe<pe;xe+=be)Ce+=(se[Ie]-se[xe])*(se[xe+1]+se[Ie+1]),Ie=xe;return Ce}(ue,o,g,j)>0)for(ee=o;ee<g;ee+=j)ie=dm(ee,ue[ee],ue[ee+1],ie);else for(ee=g-j;ee>=o;ee-=j)ie=dm(ee,ue[ee],ue[ee+1],ie);return ie&&Va(ie,ie.next)&&(Ta(ie),ie=ie.next),ie}function Ma(ue,o){if(!ue)return ue;o||(o=ue);let g,j=ue;do if(g=!1,j.steiner||!Va(j,j.next)&&As(j.prev,j,j.next)!==0)j=j.next;else{if(Ta(j),j=o=j.prev,j===j.next)break;g=!0}while(g||j!==o);return o}function Od(ue,o,g,j,Y,ee,ie){if(!ue)return;!ie&&ee&&function(be,Ce,xe,Ie){let Re=be;do Re.z===null&&(Re.z=a_(Re.x,Re.y,Ce,xe,Ie)),Re.prevZ=Re.prev,Re.nextZ=Re.next,Re=Re.next;while(Re!==be);Re.prevZ.nextZ=null,Re.prevZ=null,function(De){let ze,je,Ve,$e,ct,dt,ft,Bt,Lt=1;do{for(je=De,De=null,ct=null,dt=0;je;){for(dt++,Ve=je,ft=0,ze=0;ze<Lt&&(ft++,Ve=Ve.nextZ,Ve);ze++);for(Bt=Lt;ft>0||Bt>0&&Ve;)ft!==0&&(Bt===0||!Ve||je.z<=Ve.z)?($e=je,je=je.nextZ,ft--):($e=Ve,Ve=Ve.nextZ,Bt--),ct?ct.nextZ=$e:De=$e,$e.prevZ=ct,ct=$e;je=Ve}ct.nextZ=null,Lt*=2}while(dt>1)}(Re)}(ue,j,Y,ee);let se,de,pe=ue;for(;ue.prev!==ue.next;)if(se=ue.prev,de=ue.next,ee?f0(ue,j,Y,ee):p0(ue))o.push(se.i/g),o.push(ue.i/g),o.push(de.i/g),Ta(ue),ue=de.next,pe=de.next;else if((ue=de)===pe){ie?ie===1?Od(ue=m0(Ma(ue),o,g),o,g,j,Y,ee,2):ie===2&&ax(ue,o,g,j,Y,ee):Od(Ma(ue),o,g,j,Y,ee,1);break}}function p0(ue){const o=ue.prev,g=ue,j=ue.next;if(As(o,g,j)>=0)return!1;let Y=ue.next.next;for(;Y!==ue.prev;){if(Ld(o.x,o.y,g.x,g.y,j.x,j.y,Y.x,Y.y)&&As(Y.prev,Y,Y.next)>=0)return!1;Y=Y.next}return!0}function f0(ue,o,g,j){const Y=ue.prev,ee=ue,ie=ue.next;if(As(Y,ee,ie)>=0)return!1;const se=Y.x<ee.x?Y.x<ie.x?Y.x:ie.x:ee.x<ie.x?ee.x:ie.x,de=Y.y<ee.y?Y.y<ie.y?Y.y:ie.y:ee.y<ie.y?ee.y:ie.y,pe=Y.x>ee.x?Y.x>ie.x?Y.x:ie.x:ee.x>ie.x?ee.x:ie.x,be=Y.y>ee.y?Y.y>ie.y?Y.y:ie.y:ee.y>ie.y?ee.y:ie.y,Ce=a_(se,de,o,g,j),xe=a_(pe,be,o,g,j);let Ie=ue.prevZ,Re=ue.nextZ;for(;Ie&&Ie.z>=Ce&&Re&&Re.z<=xe;){if(Ie!==ue.prev&&Ie!==ue.next&&Ld(Y.x,Y.y,ee.x,ee.y,ie.x,ie.y,Ie.x,Ie.y)&&As(Ie.prev,Ie,Ie.next)>=0||(Ie=Ie.prevZ,Re!==ue.prev&&Re!==ue.next&&Ld(Y.x,Y.y,ee.x,ee.y,ie.x,ie.y,Re.x,Re.y)&&As(Re.prev,Re,Re.next)>=0))return!1;Re=Re.nextZ}for(;Ie&&Ie.z>=Ce;){if(Ie!==ue.prev&&Ie!==ue.next&&Ld(Y.x,Y.y,ee.x,ee.y,ie.x,ie.y,Ie.x,Ie.y)&&As(Ie.prev,Ie,Ie.next)>=0)return!1;Ie=Ie.prevZ}for(;Re&&Re.z<=xe;){if(Re!==ue.prev&&Re!==ue.next&&Ld(Y.x,Y.y,ee.x,ee.y,ie.x,ie.y,Re.x,Re.y)&&As(Re.prev,Re,Re.next)>=0)return!1;Re=Re.nextZ}return!0}function m0(ue,o,g){let j=ue;do{const Y=j.prev,ee=j.next.next;!Va(Y,ee)&&_0(Y,j,j.next,ee)&&ac(Y,ee)&&ac(ee,Y)&&(o.push(Y.i/g),o.push(j.i/g),o.push(ee.i/g),Ta(j),Ta(j.next),j=ue=ee),j=j.next}while(j!==ue);return Ma(j)}function ax(ue,o,g,j,Y,ee){let ie=ue;do{let se=ie.next.next;for(;se!==ie.prev;){if(ie.i!==se.i&&g0(ie,se)){let de=Wo(ie,se);return ie=Ma(ie,ie.next),de=Ma(de,de.next),Od(ie,o,g,j,Y,ee),void Od(de,o,g,j,Y,ee)}se=se.next}ie=ie.next}while(ie!==ue)}function lx(ue,o){return ue.x-o.x}function cx(ue,o){if(o=function(g,j){let Y=j;const ee=g.x,ie=g.y;let se,de=-1/0;do{if(ie<=Y.y&&ie>=Y.next.y&&Y.next.y!==Y.y){const Re=Y.x+(ie-Y.y)*(Y.next.x-Y.x)/(Y.next.y-Y.y);if(Re<=ee&&Re>de){if(de=Re,Re===ee){if(ie===Y.y)return Y;if(ie===Y.next.y)return Y.next}se=Y.x<Y.next.x?Y:Y.next}}Y=Y.next}while(Y!==j);if(!se)return null;if(ee===de)return se;const pe=se,be=se.x,Ce=se.y;let xe,Ie=1/0;Y=se;do ee>=Y.x&&Y.x>=be&&ee!==Y.x&&Ld(ie<Ce?ee:de,ie,be,Ce,ie<Ce?de:ee,ie,Y.x,Y.y)&&(xe=Math.abs(ie-Y.y)/(ee-Y.x),ac(Y,g)&&(xe<Ie||xe===Ie&&(Y.x>se.x||Y.x===se.x&&ux(se,Y)))&&(se=Y,Ie=xe)),Y=Y.next;while(Y!==pe);return se}(ue,o),o){const g=Wo(o,ue);Ma(o,o.next),Ma(g,g.next)}}function ux(ue,o){return As(ue.prev,ue,o.prev)<0&&As(o.next,ue,ue.next)<0}function a_(ue,o,g,j,Y){return(ue=1431655765&((ue=858993459&((ue=252645135&((ue=16711935&((ue=32767*(ue-g)*Y)|ue<<8))|ue<<4))|ue<<2))|ue<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-j)*Y)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function um(ue){let o=ue,g=ue;do(o.x<g.x||o.x===g.x&&o.y<g.y)&&(g=o),o=o.next;while(o!==ue);return g}function Ld(ue,o,g,j,Y,ee,ie,se){return(Y-ie)*(o-se)-(ue-ie)*(ee-se)>=0&&(ue-ie)*(j-se)-(g-ie)*(o-se)>=0&&(g-ie)*(ee-se)-(Y-ie)*(j-se)>=0}function g0(ue,o){return ue.next.i!==o.i&&ue.prev.i!==o.i&&!function(g,j){let Y=g;do{if(Y.i!==g.i&&Y.next.i!==g.i&&Y.i!==j.i&&Y.next.i!==j.i&&_0(Y,Y.next,g,j))return!0;Y=Y.next}while(Y!==g);return!1}(ue,o)&&(ac(ue,o)&&ac(o,ue)&&function(g,j){let Y=g,ee=!1;const ie=(g.x+j.x)/2,se=(g.y+j.y)/2;do Y.y>se!=Y.next.y>se&&Y.next.y!==Y.y&&ie<(Y.next.x-Y.x)*(se-Y.y)/(Y.next.y-Y.y)+Y.x&&(ee=!ee),Y=Y.next;while(Y!==g);return ee}(ue,o)&&(As(ue.prev,ue,o.prev)||As(ue,o.prev,o))||Va(ue,o)&&As(ue.prev,ue,ue.next)>0&&As(o.prev,o,o.next)>0)}function As(ue,o,g){return(o.y-ue.y)*(g.x-o.x)-(o.x-ue.x)*(g.y-o.y)}function Va(ue,o){return ue.x===o.x&&ue.y===o.y}function _0(ue,o,g,j){const Y=Hc(As(ue,o,g)),ee=Hc(As(ue,o,j)),ie=Hc(As(g,j,ue)),se=Hc(As(g,j,o));return Y!==ee&&ie!==se||!(Y!==0||!hm(ue,g,o))||!(ee!==0||!hm(ue,j,o))||!(ie!==0||!hm(g,ue,j))||!(se!==0||!hm(g,o,j))}function hm(ue,o,g){return o.x<=Math.max(ue.x,g.x)&&o.x>=Math.min(ue.x,g.x)&&o.y<=Math.max(ue.y,g.y)&&o.y>=Math.min(ue.y,g.y)}function Hc(ue){return ue>0?1:ue<0?-1:0}function ac(ue,o){return As(ue.prev,ue,ue.next)<0?As(ue,o,ue.next)>=0&&As(ue,ue.prev,o)>=0:As(ue,o,ue.prev)<0||As(ue,ue.next,o)<0}function Wo(ue,o){const g=new Du(ue.i,ue.x,ue.y),j=new Du(o.i,o.x,o.y),Y=ue.next,ee=o.prev;return ue.next=o,o.prev=ue,g.next=Y,Y.prev=g,j.next=g,g.prev=j,ee.next=j,j.prev=ee,j}function dm(ue,o,g,j){const Y=new Du(ue,o,g);return j?(Y.next=j.next,Y.prev=j,j.next.prev=Y,j.next=Y):(Y.prev=Y,Y.next=Y),Y}function Ta(ue){ue.next.prev=ue.prev,ue.prev.next=ue.next,ue.prevZ&&(ue.prevZ.nextZ=ue.nextZ),ue.nextZ&&(ue.nextZ.prevZ=ue.prevZ)}function Du(ue,o,g){this.i=ue,this.x=o,this.y=g,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Oo{static area(o){const g=o.length;let j=0;for(let Y=g-1,ee=0;ee<g;Y=ee++)j+=o[Y].x*o[ee].y-o[ee].x*o[Y].y;return .5*j}static isClockWise(o){return Oo.area(o)<0}static triangulateShape(o,g){const j=[],Y=[],ee=[];Cl(o),pm(j,o);let ie=o.length;g.forEach(Cl);for(let de=0;de<g.length;de++)Y.push(ie),ie+=g[de].length,pm(j,g[de]);const se=function(de,pe,be=2){const Ce=pe&&pe.length,xe=Ce?pe[0]*be:de.length;let Ie=_y(de,0,xe,be,!0);const Re=[];if(!Ie||Ie.next===Ie.prev)return Re;let De,ze,je,Ve,$e,ct,dt;if(Ce&&(Ie=function(ft,Bt,Lt,Wt){const qt=[];let Ot,En,Ln,wn,jn;for(Ot=0,En=Bt.length;Ot<En;Ot++)Ln=Bt[Ot]*Wt,wn=Ot<En-1?Bt[Ot+1]*Wt:ft.length,jn=_y(ft,Ln,wn,Wt,!1),jn===jn.next&&(jn.steiner=!0),qt.push(um(jn));for(qt.sort(lx),Ot=0;Ot<qt.length;Ot++)cx(qt[Ot],Lt),Lt=Ma(Lt,Lt.next);return Lt}(de,pe,Ie,be)),de.length>80*be){De=je=de[0],ze=Ve=de[1];for(let ft=be;ft<xe;ft+=be)$e=de[ft],ct=de[ft+1],$e<De&&(De=$e),ct<ze&&(ze=ct),$e>je&&(je=$e),ct>Ve&&(Ve=ct);dt=Math.max(je-De,Ve-ze),dt=dt!==0?1/dt:0}return Od(Ie,Re,be,De,ze,dt),Re}(j,Y);for(let de=0;de<se.length;de+=3)ee.push(se.slice(de,de+3));return ee}}function Cl(ue){const o=ue.length;o>2&&ue[o-1].equals(ue[0])&&ue.pop()}function pm(ue,o){for(let g=0;g<o.length;g++)ue.push(o[g].x),ue.push(o[g].y)}class Nd extends yi{constructor(o=new kd([new Bn(.5,.5),new Bn(-.5,.5),new Bn(-.5,-.5),new Bn(.5,-.5)]),g={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:o,options:g},o=Array.isArray(o)?o:[o];const j=this,Y=[],ee=[];for(let se=0,de=o.length;se<de;se++)ie(o[se]);function ie(se){const de=[],pe=g.curveSegments!==void 0?g.curveSegments:12,be=g.steps!==void 0?g.steps:1,Ce=g.depth!==void 0?g.depth:1;let xe=g.bevelEnabled===void 0||g.bevelEnabled,Ie=g.bevelThickness!==void 0?g.bevelThickness:.2,Re=g.bevelSize!==void 0?g.bevelSize:Ie-.1,De=g.bevelOffset!==void 0?g.bevelOffset:0,ze=g.bevelSegments!==void 0?g.bevelSegments:3;const je=g.extrudePath,Ve=g.UVGenerator!==void 0?g.UVGenerator:Za;let $e,ct,dt,ft,Bt,Lt=!1;je&&($e=je.getSpacedPoints(be),Lt=!0,xe=!1,ct=je.computeFrenetFrames(be,!1),dt=new vt,ft=new vt,Bt=new vt),xe||(ze=0,Ie=0,Re=0,De=0);const Wt=se.extractPoints(pe);let qt=Wt.shape;const Ot=Wt.holes;if(!Oo.isClockWise(qt)){qt=qt.reverse();for(let Qt=0,It=Ot.length;Qt<It;Qt++){const Ht=Ot[Qt];Oo.isClockWise(Ht)&&(Ot[Qt]=Ht.reverse())}}const En=Oo.triangulateShape(qt,Ot),Ln=qt;for(let Qt=0,It=Ot.length;Qt<It;Qt++){const Ht=Ot[Qt];qt=qt.concat(Ht)}function wn(Qt,It,Ht){return It||console.error("THREE.ExtrudeGeometry: vec does not exist"),It.clone().multiplyScalar(Ht).add(Qt)}const jn=qt.length,Wn=En.length;function hn(Qt,It,Ht){let _n,it,on;const Xt=Qt.x-It.x,xn=Qt.y-It.y,Nn=Ht.x-Qt.x,ti=Ht.y-Qt.y,wi=Xt*Xt+xn*xn,Gi=Xt*ti-xn*Nn;if(Math.abs(Gi)>Number.EPSILON){const Ki=Math.sqrt(wi),Di=Math.sqrt(Nn*Nn+ti*ti),Ui=It.x-xn/Ki,Wr=It.y+Xt/Ki,rl=((Ht.x-ti/Di-Ui)*ti-(Ht.y+Nn/Di-Wr)*Nn)/(Xt*ti-xn*Nn);_n=Ui+Xt*rl-Qt.x,it=Wr+xn*rl-Qt.y;const zi=_n*_n+it*it;if(zi<=2)return new Bn(_n,it);on=Math.sqrt(zi/2)}else{let Ki=!1;Xt>Number.EPSILON?Nn>Number.EPSILON&&(Ki=!0):Xt<-Number.EPSILON?Nn<-Number.EPSILON&&(Ki=!0):Math.sign(xn)===Math.sign(ti)&&(Ki=!0),Ki?(_n=-xn,it=Xt,on=Math.sqrt(wi)):(_n=Xt,it=xn,on=Math.sqrt(wi/2))}return new Bn(_n/on,it/on)}const fn=[];for(let Qt=0,It=Ln.length,Ht=It-1,_n=Qt+1;Qt<It;Qt++,Ht++,_n++)Ht===It&&(Ht=0),_n===It&&(_n=0),fn[Qt]=hn(Ln[Qt],Ln[Ht],Ln[_n]);const Gn=[];let Sn,Hn=fn.concat();for(let Qt=0,It=Ot.length;Qt<It;Qt++){const Ht=Ot[Qt];Sn=[];for(let _n=0,it=Ht.length,on=it-1,Xt=_n+1;_n<it;_n++,on++,Xt++)on===it&&(on=0),Xt===it&&(Xt=0),Sn[_n]=hn(Ht[_n],Ht[on],Ht[Xt]);Gn.push(Sn),Hn=Hn.concat(Sn)}for(let Qt=0;Qt<ze;Qt++){const It=Qt/ze,Ht=Ie*Math.cos(It*Math.PI/2),_n=Re*Math.sin(It*Math.PI/2)+De;for(let it=0,on=Ln.length;it<on;it++){const Xt=wn(Ln[it],fn[it],_n);Ci(Xt.x,Xt.y,-Ht)}for(let it=0,on=Ot.length;it<on;it++){const Xt=Ot[it];Sn=Gn[it];for(let xn=0,Nn=Xt.length;xn<Nn;xn++){const ti=wn(Xt[xn],Sn[xn],_n);Ci(ti.x,ti.y,-Ht)}}}const di=Re+De;for(let Qt=0;Qt<jn;Qt++){const It=xe?wn(qt[Qt],Hn[Qt],di):qt[Qt];Lt?(ft.copy(ct.normals[0]).multiplyScalar(It.x),dt.copy(ct.binormals[0]).multiplyScalar(It.y),Bt.copy($e[0]).add(ft).add(dt),Ci(Bt.x,Bt.y,Bt.z)):Ci(It.x,It.y,0)}for(let Qt=1;Qt<=be;Qt++)for(let It=0;It<jn;It++){const Ht=xe?wn(qt[It],Hn[It],di):qt[It];Lt?(ft.copy(ct.normals[Qt]).multiplyScalar(Ht.x),dt.copy(ct.binormals[Qt]).multiplyScalar(Ht.y),Bt.copy($e[Qt]).add(ft).add(dt),Ci(Bt.x,Bt.y,Bt.z)):Ci(Ht.x,Ht.y,Ce/be*Qt)}for(let Qt=ze-1;Qt>=0;Qt--){const It=Qt/ze,Ht=Ie*Math.cos(It*Math.PI/2),_n=Re*Math.sin(It*Math.PI/2)+De;for(let it=0,on=Ln.length;it<on;it++){const Xt=wn(Ln[it],fn[it],_n);Ci(Xt.x,Xt.y,Ce+Ht)}for(let it=0,on=Ot.length;it<on;it++){const Xt=Ot[it];Sn=Gn[it];for(let xn=0,Nn=Xt.length;xn<Nn;xn++){const ti=wn(Xt[xn],Sn[xn],_n);Lt?Ci(ti.x,ti.y+$e[be-1].y,$e[be-1].x+Ht):Ci(ti.x,ti.y,Ce+Ht)}}}function nr(Qt,It){let Ht=Qt.length;for(;--Ht>=0;){const _n=Ht;let it=Ht-1;it<0&&(it=Qt.length-1);for(let on=0,Xt=be+2*ze;on<Xt;on++){const xn=jn*on,Nn=jn*(on+1);Dt(It+_n+xn,It+it+xn,It+it+Nn,It+_n+Nn)}}}function Ci(Qt,It,Ht){de.push(Qt),de.push(It),de.push(Ht)}function sr(Qt,It,Ht){xt(Qt),xt(It),xt(Ht);const _n=Y.length/3,it=Ve.generateTopUV(j,Y,_n-3,_n-2,_n-1);tn(it[0]),tn(it[1]),tn(it[2])}function Dt(Qt,It,Ht,_n){xt(Qt),xt(It),xt(_n),xt(It),xt(Ht),xt(_n);const it=Y.length/3,on=Ve.generateSideWallUV(j,Y,it-6,it-3,it-2,it-1);tn(on[0]),tn(on[1]),tn(on[3]),tn(on[1]),tn(on[2]),tn(on[3])}function xt(Qt){Y.push(de[3*Qt+0]),Y.push(de[3*Qt+1]),Y.push(de[3*Qt+2])}function tn(Qt){ee.push(Qt.x),ee.push(Qt.y)}(function(){const Qt=Y.length/3;if(xe){let It=0,Ht=jn*It;for(let _n=0;_n<Wn;_n++){const it=En[_n];sr(it[2]+Ht,it[1]+Ht,it[0]+Ht)}It=be+2*ze,Ht=jn*It;for(let _n=0;_n<Wn;_n++){const it=En[_n];sr(it[0]+Ht,it[1]+Ht,it[2]+Ht)}}else{for(let It=0;It<Wn;It++){const Ht=En[It];sr(Ht[2],Ht[1],Ht[0])}for(let It=0;It<Wn;It++){const Ht=En[It];sr(Ht[0]+jn*be,Ht[1]+jn*be,Ht[2]+jn*be)}}j.addGroup(Qt,Y.length/3-Qt,0)})(),function(){const Qt=Y.length/3;let It=0;nr(Ln,It),It+=Ln.length;for(let Ht=0,_n=Ot.length;Ht<_n;Ht++){const it=Ot[Ht];nr(it,It),It+=it.length}j.addGroup(Qt,Y.length/3-Qt,1)}()}this.setAttribute("position",new ce(Y,3)),this.setAttribute("uv",new ce(ee,2)),this.computeVertexNormals()}toJSON(){const o=super.toJSON();return function(g,j,Y){if(Y.shapes=[],Array.isArray(g))for(let ee=0,ie=g.length;ee<ie;ee++){const se=g[ee];Y.shapes.push(se.uuid)}else Y.shapes.push(g.uuid);return Y.options=Object.assign({},j),j.extrudePath!==void 0&&(Y.options.extrudePath=j.extrudePath.toJSON()),Y}(this.parameters.shapes,this.parameters.options,o)}static fromJSON(o,g){const j=[];for(let ee=0,ie=o.shapes.length;ee<ie;ee++){const se=g[o.shapes[ee]];j.push(se)}const Y=o.options.extrudePath;return Y!==void 0&&(o.options.extrudePath=new r_[Y.type]().fromJSON(Y)),new Nd(j,o.options)}}const Za={generateTopUV:function(ue,o,g,j,Y){const ee=o[3*g],ie=o[3*g+1],se=o[3*j],de=o[3*j+1],pe=o[3*Y],be=o[3*Y+1];return[new Bn(ee,ie),new Bn(se,de),new Bn(pe,be)]},generateSideWallUV:function(ue,o,g,j,Y,ee){const ie=o[3*g],se=o[3*g+1],de=o[3*g+2],pe=o[3*j],be=o[3*j+1],Ce=o[3*j+2],xe=o[3*Y],Ie=o[3*Y+1],Re=o[3*Y+2],De=o[3*ee],ze=o[3*ee+1],je=o[3*ee+2];return Math.abs(se-be)<Math.abs(ie-pe)?[new Bn(ie,1-de),new Bn(pe,1-Ce),new Bn(xe,1-Re),new Bn(De,1-je)]:[new Bn(se,1-de),new Bn(be,1-Ce),new Bn(Ie,1-Re),new Bn(ze,1-je)]}};class fm extends Qc{constructor(o=1,g=0){const j=(1+Math.sqrt(5))/2;super([-1,j,0,1,j,0,-1,-j,0,1,-j,0,0,-1,j,0,1,j,0,-1,-j,0,1,-j,j,0,-1,j,0,1,-j,0,-1,-j,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],o,g),this.type="IcosahedronGeometry",this.parameters={radius:o,detail:g}}static fromJSON(o){return new fm(o.radius,o.detail)}}class Hp extends Qc{constructor(o=1,g=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],o,g),this.type="OctahedronGeometry",this.parameters={radius:o,detail:g}}static fromJSON(o){return new Hp(o.radius,o.detail)}}class Wp extends yi{constructor(o=.5,g=1,j=8,Y=1,ee=0,ie=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:o,outerRadius:g,thetaSegments:j,phiSegments:Y,thetaStart:ee,thetaLength:ie},j=Math.max(3,j);const se=[],de=[],pe=[],be=[];let Ce=o;const xe=(g-o)/(Y=Math.max(1,Y)),Ie=new vt,Re=new Bn;for(let De=0;De<=Y;De++){for(let ze=0;ze<=j;ze++){const je=ee+ze/j*ie;Ie.x=Ce*Math.cos(je),Ie.y=Ce*Math.sin(je),de.push(Ie.x,Ie.y,Ie.z),pe.push(0,0,1),Re.x=(Ie.x/g+1)/2,Re.y=(Ie.y/g+1)/2,be.push(Re.x,Re.y)}Ce+=xe}for(let De=0;De<Y;De++){const ze=De*(j+1);for(let je=0;je<j;je++){const Ve=je+ze,$e=Ve,ct=Ve+j+1,dt=Ve+j+2,ft=Ve+1;se.push($e,ct,ft),se.push(ct,dt,ft)}}this.setIndex(se),this.setAttribute("position",new ce(de,3)),this.setAttribute("normal",new ce(pe,3)),this.setAttribute("uv",new ce(be,2))}static fromJSON(o){return new Wp(o.innerRadius,o.outerRadius,o.thetaSegments,o.phiSegments,o.thetaStart,o.thetaLength)}}class la extends yi{constructor(o=new kd([new Bn(0,.5),new Bn(-.5,-.5),new Bn(.5,-.5)]),g=12){super(),this.type="ShapeGeometry",this.parameters={shapes:o,curveSegments:g};const j=[],Y=[],ee=[],ie=[];let se=0,de=0;if(Array.isArray(o)===!1)pe(o);else for(let be=0;be<o.length;be++)pe(o[be]),this.addGroup(se,de,be),se+=de,de=0;function pe(be){const Ce=Y.length/3,xe=be.extractPoints(g);let Ie=xe.shape;const Re=xe.holes;Oo.isClockWise(Ie)===!1&&(Ie=Ie.reverse());for(let ze=0,je=Re.length;ze<je;ze++){const Ve=Re[ze];Oo.isClockWise(Ve)===!0&&(Re[ze]=Ve.reverse())}const De=Oo.triangulateShape(Ie,Re);for(let ze=0,je=Re.length;ze<je;ze++){const Ve=Re[ze];Ie=Ie.concat(Ve)}for(let ze=0,je=Ie.length;ze<je;ze++){const Ve=Ie[ze];Y.push(Ve.x,Ve.y,0),ee.push(0,0,1),ie.push(Ve.x,Ve.y)}for(let ze=0,je=De.length;ze<je;ze++){const Ve=De[ze],$e=Ve[0]+Ce,ct=Ve[1]+Ce,dt=Ve[2]+Ce;j.push($e,ct,dt),de+=3}}this.setIndex(j),this.setAttribute("position",new ce(Y,3)),this.setAttribute("normal",new ce(ee,3)),this.setAttribute("uv",new ce(ie,2))}toJSON(){const o=super.toJSON();return function(g,j){if(j.shapes=[],Array.isArray(g))for(let Y=0,ee=g.length;Y<ee;Y++){const ie=g[Y];j.shapes.push(ie.uuid)}else j.shapes.push(g.uuid);return j}(this.parameters.shapes,o)}static fromJSON(o,g){const j=[];for(let Y=0,ee=o.shapes.length;Y<ee;Y++){const ie=g[o.shapes[Y]];j.push(ie)}return new la(j,o.curveSegments)}}class Eh extends yi{constructor(o=1,g=32,j=16,Y=0,ee=2*Math.PI,ie=0,se=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:o,widthSegments:g,heightSegments:j,phiStart:Y,phiLength:ee,thetaStart:ie,thetaLength:se},g=Math.max(3,Math.floor(g)),j=Math.max(2,Math.floor(j));const de=Math.min(ie+se,Math.PI);let pe=0;const be=[],Ce=new vt,xe=new vt,Ie=[],Re=[],De=[],ze=[];for(let je=0;je<=j;je++){const Ve=[],$e=je/j;let ct=0;je==0&&ie==0?ct=.5/g:je==j&&de==Math.PI&&(ct=-.5/g);for(let dt=0;dt<=g;dt++){const ft=dt/g;Ce.x=-o*Math.cos(Y+ft*ee)*Math.sin(ie+$e*se),Ce.y=o*Math.cos(ie+$e*se),Ce.z=o*Math.sin(Y+ft*ee)*Math.sin(ie+$e*se),Re.push(Ce.x,Ce.y,Ce.z),xe.copy(Ce).normalize(),De.push(xe.x,xe.y,xe.z),ze.push(ft+ct,1-$e),Ve.push(pe++)}be.push(Ve)}for(let je=0;je<j;je++)for(let Ve=0;Ve<g;Ve++){const $e=be[je][Ve+1],ct=be[je][Ve],dt=be[je+1][Ve],ft=be[je+1][Ve+1];(je!==0||ie>0)&&Ie.push($e,ct,ft),(je!==j-1||de<Math.PI)&&Ie.push(ct,dt,ft)}this.setIndex(Ie),this.setAttribute("position",new ce(Re,3)),this.setAttribute("normal",new ce(De,3)),this.setAttribute("uv",new ce(ze,2))}static fromJSON(o){return new Eh(o.radius,o.widthSegments,o.heightSegments,o.phiStart,o.phiLength,o.thetaStart,o.thetaLength)}}class mm extends Qc{constructor(o=1,g=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],o,g),this.type="TetrahedronGeometry",this.parameters={radius:o,detail:g}}static fromJSON(o){return new mm(o.radius,o.detail)}}class gm extends yi{constructor(o=1,g=.4,j=8,Y=6,ee=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:o,tube:g,radialSegments:j,tubularSegments:Y,arc:ee},j=Math.floor(j),Y=Math.floor(Y);const ie=[],se=[],de=[],pe=[],be=new vt,Ce=new vt,xe=new vt;for(let Ie=0;Ie<=j;Ie++)for(let Re=0;Re<=Y;Re++){const De=Re/Y*ee,ze=Ie/j*Math.PI*2;Ce.x=(o+g*Math.cos(ze))*Math.cos(De),Ce.y=(o+g*Math.cos(ze))*Math.sin(De),Ce.z=g*Math.sin(ze),se.push(Ce.x,Ce.y,Ce.z),be.x=o*Math.cos(De),be.y=o*Math.sin(De),xe.subVectors(Ce,be).normalize(),de.push(xe.x,xe.y,xe.z),pe.push(Re/Y),pe.push(Ie/j)}for(let Ie=1;Ie<=j;Ie++)for(let Re=1;Re<=Y;Re++){const De=(Y+1)*Ie+Re-1,ze=(Y+1)*(Ie-1)+Re-1,je=(Y+1)*(Ie-1)+Re,Ve=(Y+1)*Ie+Re;ie.push(De,ze,Ve),ie.push(ze,je,Ve)}this.setIndex(ie),this.setAttribute("position",new ce(se,3)),this.setAttribute("normal",new ce(de,3)),this.setAttribute("uv",new ce(pe,2))}static fromJSON(o){return new gm(o.radius,o.tube,o.radialSegments,o.tubularSegments,o.arc)}}class qp extends yi{constructor(o=1,g=.4,j=64,Y=8,ee=2,ie=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:o,tube:g,tubularSegments:j,radialSegments:Y,p:ee,q:ie},j=Math.floor(j),Y=Math.floor(Y);const se=[],de=[],pe=[],be=[],Ce=new vt,xe=new vt,Ie=new vt,Re=new vt,De=new vt,ze=new vt,je=new vt;for(let $e=0;$e<=j;++$e){const ct=$e/j*ee*Math.PI*2;Ve(ct,ee,ie,o,Ie),Ve(ct+.01,ee,ie,o,Re),ze.subVectors(Re,Ie),je.addVectors(Re,Ie),De.crossVectors(ze,je),je.crossVectors(De,ze),De.normalize(),je.normalize();for(let dt=0;dt<=Y;++dt){const ft=dt/Y*Math.PI*2,Bt=-g*Math.cos(ft),Lt=g*Math.sin(ft);Ce.x=Ie.x+(Bt*je.x+Lt*De.x),Ce.y=Ie.y+(Bt*je.y+Lt*De.y),Ce.z=Ie.z+(Bt*je.z+Lt*De.z),de.push(Ce.x,Ce.y,Ce.z),xe.subVectors(Ce,Ie).normalize(),pe.push(xe.x,xe.y,xe.z),be.push($e/j),be.push(dt/Y)}}for(let $e=1;$e<=j;$e++)for(let ct=1;ct<=Y;ct++){const dt=(Y+1)*($e-1)+(ct-1),ft=(Y+1)*$e+(ct-1),Bt=(Y+1)*$e+ct,Lt=(Y+1)*($e-1)+ct;se.push(dt,ft,Lt),se.push(ft,Bt,Lt)}function Ve($e,ct,dt,ft,Bt){const Lt=Math.cos($e),Wt=Math.sin($e),qt=dt/ct*$e,Ot=Math.cos(qt);Bt.x=ft*(2+Ot)*.5*Lt,Bt.y=ft*(2+Ot)*Wt*.5,Bt.z=ft*Math.sin(qt)*.5}this.setIndex(se),this.setAttribute("position",new ce(de,3)),this.setAttribute("normal",new ce(pe,3)),this.setAttribute("uv",new ce(be,2))}static fromJSON(o){return new qp(o.radius,o.tube,o.tubularSegments,o.radialSegments,o.p,o.q)}}class ca extends yi{constructor(o=new eo(new vt(-1,-1,0),new vt(-1,1,0),new vt(1,1,0)),g=64,j=1,Y=8,ee=!1){super(),this.type="TubeGeometry",this.parameters={path:o,tubularSegments:g,radius:j,radialSegments:Y,closed:ee};const ie=o.computeFrenetFrames(g,ee);this.tangents=ie.tangents,this.normals=ie.normals,this.binormals=ie.binormals;const se=new vt,de=new vt,pe=new Bn;let be=new vt;const Ce=[],xe=[],Ie=[],Re=[];function De(ze){be=o.getPointAt(ze/g,be);const je=ie.normals[ze],Ve=ie.binormals[ze];for(let $e=0;$e<=Y;$e++){const ct=$e/Y*Math.PI*2,dt=Math.sin(ct),ft=-Math.cos(ct);de.x=ft*je.x+dt*Ve.x,de.y=ft*je.y+dt*Ve.y,de.z=ft*je.z+dt*Ve.z,de.normalize(),xe.push(de.x,de.y,de.z),se.x=be.x+j*de.x,se.y=be.y+j*de.y,se.z=be.z+j*de.z,Ce.push(se.x,se.y,se.z)}}(function(){for(let ze=0;ze<g;ze++)De(ze);De(ee===!1?g:0),function(){for(let ze=0;ze<=g;ze++)for(let je=0;je<=Y;je++)pe.x=ze/g,pe.y=je/Y,Ie.push(pe.x,pe.y)}(),function(){for(let ze=1;ze<=g;ze++)for(let je=1;je<=Y;je++){const Ve=(Y+1)*(ze-1)+(je-1),$e=(Y+1)*ze+(je-1),ct=(Y+1)*ze+je,dt=(Y+1)*(ze-1)+je;Re.push(Ve,$e,dt),Re.push($e,ct,dt)}}()})(),this.setIndex(Re),this.setAttribute("position",new ce(Ce,3)),this.setAttribute("normal",new ce(xe,3)),this.setAttribute("uv",new ce(Ie,2))}toJSON(){const o=super.toJSON();return o.path=this.parameters.path.toJSON(),o}static fromJSON(o){return new ca(new r_[o.path.type]().fromJSON(o.path),o.tubularSegments,o.radius,o.radialSegments,o.closed)}}class l_ extends yi{constructor(o=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:o},o!==null){const g=[],j=new Set,Y=new vt,ee=new vt;if(o.index!==null){const ie=o.attributes.position,se=o.index;let de=o.groups;de.length===0&&(de=[{start:0,count:se.count,materialIndex:0}]);for(let pe=0,be=de.length;pe<be;++pe){const Ce=de[pe],xe=Ce.start;for(let Ie=xe,Re=xe+Ce.count;Ie<Re;Ie+=3)for(let De=0;De<3;De++){const ze=se.getX(Ie+De),je=se.getX(Ie+(De+1)%3);Y.fromBufferAttribute(ie,ze),ee.fromBufferAttribute(ie,je),vy(Y,ee,j)===!0&&(g.push(Y.x,Y.y,Y.z),g.push(ee.x,ee.y,ee.z))}}}else{const ie=o.attributes.position;for(let se=0,de=ie.count/3;se<de;se++)for(let pe=0;pe<3;pe++){const be=3*se+pe,Ce=3*se+(pe+1)%3;Y.fromBufferAttribute(ie,be),ee.fromBufferAttribute(ie,Ce),vy(Y,ee,j)===!0&&(g.push(Y.x,Y.y,Y.z),g.push(ee.x,ee.y,ee.z))}}this.setAttribute("position",new ce(g,3))}}}function vy(ue,o,g){const j=`${ue.x},${ue.y},${ue.z}-${o.x},${o.y},${o.z}`,Y=`${o.x},${o.y},${o.z}-${ue.x},${ue.y},${ue.z}`;return g.has(j)!==!0&&g.has(Y)!==!0&&(g.add(j),g.add(Y),!0)}var Ay=Object.freeze({__proto__:null,BoxGeometry:Eu,CapsuleGeometry:sc,CircleGeometry:Gp,ConeGeometry:br,CylinderGeometry:Bd,DodecahedronGeometry:Qp,EdgesGeometry:Os,ExtrudeGeometry:Nd,IcosahedronGeometry:fm,LatheGeometry:Gc,OctahedronGeometry:Hp,PlaneGeometry:_d,PolyhedronGeometry:Qc,RingGeometry:Wp,ShapeGeometry:la,SphereGeometry:Eh,TetrahedronGeometry:mm,TorusGeometry:gm,TorusKnotGeometry:qp,TubeGeometry:ca,WireframeGeometry:l_});class c_ extends $s{constructor(o){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new ci(0),this.transparent=!0,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.fog=o.fog,this}}class _m extends El{constructor(o){super(o),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class ua extends $s{constructor(o){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ci(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ci(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ks,this.normalScale=new Bn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.defines={STANDARD:""},this.color.copy(o.color),this.roughness=o.roughness,this.metalness=o.metalness,this.map=o.map,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.emissive.copy(o.emissive),this.emissiveMap=o.emissiveMap,this.emissiveIntensity=o.emissiveIntensity,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.roughnessMap=o.roughnessMap,this.metalnessMap=o.metalnessMap,this.alphaMap=o.alphaMap,this.envMap=o.envMap,this.envMapIntensity=o.envMapIntensity,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.flatShading=o.flatShading,this.fog=o.fog,this}}class yy extends ua{constructor(o){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Bn(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Si(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(g){this.ior=(1+.4*g)/(1-.4*g)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new ci(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new ci(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ci(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(o)}get sheen(){return this._sheen}set sheen(o){this._sheen>0!=o>0&&this.version++,this._sheen=o}get clearcoat(){return this._clearcoat}set clearcoat(o){this._clearcoat>0!=o>0&&this.version++,this._clearcoat=o}get iridescence(){return this._iridescence}set iridescence(o){this._iridescence>0!=o>0&&this.version++,this._iridescence=o}get transmission(){return this._transmission}set transmission(o){this._transmission>0!=o>0&&this.version++,this._transmission=o}copy(o){return super.copy(o),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=o.clearcoat,this.clearcoatMap=o.clearcoatMap,this.clearcoatRoughness=o.clearcoatRoughness,this.clearcoatRoughnessMap=o.clearcoatRoughnessMap,this.clearcoatNormalMap=o.clearcoatNormalMap,this.clearcoatNormalScale.copy(o.clearcoatNormalScale),this.ior=o.ior,this.iridescence=o.iridescence,this.iridescenceMap=o.iridescenceMap,this.iridescenceIOR=o.iridescenceIOR,this.iridescenceThicknessRange=[...o.iridescenceThicknessRange],this.iridescenceThicknessMap=o.iridescenceThicknessMap,this.sheen=o.sheen,this.sheenColor.copy(o.sheenColor),this.sheenColorMap=o.sheenColorMap,this.sheenRoughness=o.sheenRoughness,this.sheenRoughnessMap=o.sheenRoughnessMap,this.transmission=o.transmission,this.transmissionMap=o.transmissionMap,this.thickness=o.thickness,this.thicknessMap=o.thicknessMap,this.attenuationDistance=o.attenuationDistance,this.attenuationColor.copy(o.attenuationColor),this.specularIntensity=o.specularIntensity,this.specularIntensityMap=o.specularIntensityMap,this.specularColor.copy(o.specularColor),this.specularColorMap=o.specularColorMap,this}}class by extends $s{constructor(o){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new ci(16777215),this.specular=new ci(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ci(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ks,this.normalScale=new Bn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=hi,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.specular.copy(o.specular),this.shininess=o.shininess,this.map=o.map,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.emissive.copy(o.emissive),this.emissiveMap=o.emissiveMap,this.emissiveIntensity=o.emissiveIntensity,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.specularMap=o.specularMap,this.alphaMap=o.alphaMap,this.envMap=o.envMap,this.combine=o.combine,this.reflectivity=o.reflectivity,this.refractionRatio=o.refractionRatio,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.flatShading=o.flatShading,this.fog=o.fog,this}}class v0 extends $s{constructor(o){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ci(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ci(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ks,this.normalScale=new Bn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.gradientMap=o.gradientMap,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.emissive.copy(o.emissive),this.emissiveMap=o.emissiveMap,this.emissiveIntensity=o.emissiveIntensity,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.alphaMap=o.alphaMap,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.fog=o.fog,this}}class Ml extends $s{constructor(o){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ks,this.normalScale=new Bn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(o)}copy(o){return super.copy(o),this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.flatShading=o.flatShading,this}}class u_ extends $s{constructor(o){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new ci(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ci(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ks,this.normalScale=new Bn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=hi,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.emissive.copy(o.emissive),this.emissiveMap=o.emissiveMap,this.emissiveIntensity=o.emissiveIntensity,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.specularMap=o.specularMap,this.alphaMap=o.alphaMap,this.envMap=o.envMap,this.combine=o.combine,this.reflectivity=o.reflectivity,this.refractionRatio=o.refractionRatio,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.flatShading=o.flatShading,this.fog=o.fog,this}}class wy extends $s{constructor(o){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ci(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ks,this.normalScale=new Bn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.defines={MATCAP:""},this.color.copy(o.color),this.matcap=o.matcap,this.map=o.map,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.alphaMap=o.alphaMap,this.flatShading=o.flatShading,this.fog=o.fog,this}}class xy extends oa{constructor(o){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(o)}copy(o){return super.copy(o),this.scale=o.scale,this.dashSize=o.dashSize,this.gapSize=o.gapSize,this}}function el(ue,o,g){return A0(ue)?new ue.constructor(ue.subarray(o,g!==void 0?g:ue.length)):ue.slice(o,g)}function Wc(ue,o,g){return!ue||!g&&ue.constructor===o?ue:typeof o.BYTES_PER_ELEMENT=="number"?new o(ue):Array.prototype.slice.call(ue)}function A0(ue){return ArrayBuffer.isView(ue)&&!(ue instanceof DataView)}function vm(ue){const o=ue.length,g=new Array(o);for(let j=0;j!==o;++j)g[j]=j;return g.sort(function(j,Y){return ue[j]-ue[Y]}),g}function h_(ue,o,g){const j=ue.length,Y=new ue.constructor(j);for(let ee=0,ie=0;ie!==j;++ee){const se=g[ee]*o;for(let de=0;de!==o;++de)Y[ie++]=ue[se+de]}return Y}function Yp(ue,o,g,j){let Y=1,ee=ue[0];for(;ee!==void 0&&ee[j]===void 0;)ee=ue[Y++];if(ee===void 0)return;let ie=ee[j];if(ie!==void 0)if(Array.isArray(ie))do ie=ee[j],ie!==void 0&&(o.push(ee.time),g.push.apply(g,ie)),ee=ue[Y++];while(ee!==void 0);else if(ie.toArray!==void 0)do ie=ee[j],ie!==void 0&&(o.push(ee.time),ie.toArray(g,g.length)),ee=ue[Y++];while(ee!==void 0);else do ie=ee[j],ie!==void 0&&(o.push(ee.time),g.push(ie)),ee=ue[Y++];while(ee!==void 0)}var Ey=Object.freeze({__proto__:null,arraySlice:el,convertArray:Wc,isTypedArray:A0,getKeyframeOrder:vm,sortedArray:h_,flattenJSON:Yp,subclip:function(ue,o,g,j,Y=30){const ee=ue.clone();ee.name=o;const ie=[];for(let de=0;de<ee.tracks.length;++de){const pe=ee.tracks[de],be=pe.getValueSize(),Ce=[],xe=[];for(let Ie=0;Ie<pe.times.length;++Ie){const Re=pe.times[Ie]*Y;if(!(Re<g||Re>=j)){Ce.push(pe.times[Ie]);for(let De=0;De<be;++De)xe.push(pe.values[Ie*be+De])}}Ce.length!==0&&(pe.times=Wc(Ce,pe.times.constructor),pe.values=Wc(xe,pe.values.constructor),ie.push(pe))}ee.tracks=ie;let se=1/0;for(let de=0;de<ee.tracks.length;++de)se>ee.tracks[de].times[0]&&(se=ee.tracks[de].times[0]);for(let de=0;de<ee.tracks.length;++de)ee.tracks[de].shift(-1*se);return ee.resetDuration(),ee},makeClipAdditive:function(ue,o=0,g=ue,j=30){j<=0&&(j=30);const Y=g.tracks.length,ee=o/j;for(let ie=0;ie<Y;++ie){const se=g.tracks[ie],de=se.ValueTypeName;if(de==="bool"||de==="string")continue;const pe=ue.tracks.find(function(je){return je.name===se.name&&je.ValueTypeName===de});if(pe===void 0)continue;let be=0;const Ce=se.getValueSize();se.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(be=Ce/3);let xe=0;const Ie=pe.getValueSize();pe.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(xe=Ie/3);const Re=se.times.length-1;let De;if(ee<=se.times[0]){const je=be,Ve=Ce-be;De=el(se.values,je,Ve)}else if(ee>=se.times[Re]){const je=Re*Ce+be,Ve=je+Ce-be;De=el(se.values,je,Ve)}else{const je=se.createInterpolant(),Ve=be,$e=Ce-be;je.evaluate(ee),De=el(je.resultBuffer,Ve,$e)}de==="quaternion"&&new _o().fromArray(De).normalize().conjugate().toArray(De);const ze=pe.times.length;for(let je=0;je<ze;++je){const Ve=je*Ie+xe;if(de==="quaternion")_o.multiplyQuaternionsFlat(pe.values,Ve,De,0,pe.values,Ve);else{const $e=Ie-2*xe;for(let ct=0;ct<$e;++ct)pe.values[Ve+ct]-=De[ct]}}}return ue.blendMode=ma,ue}});class Xp{constructor(o,g,j,Y){this.parameterPositions=o,this._cachedIndex=0,this.resultBuffer=Y!==void 0?Y:new g.constructor(j),this.sampleValues=g,this.valueSize=j,this.settings=null,this.DefaultSettings_={}}evaluate(o){const g=this.parameterPositions;let j=this._cachedIndex,Y=g[j],ee=g[j-1];e:{t:{let ie;n:{i:if(!(o<Y)){for(let se=j+2;;){if(Y===void 0){if(o<ee)break i;return j=g.length,this._cachedIndex=j,this.copySampleValue_(j-1)}if(j===se)break;if(ee=Y,Y=g[++j],o<Y)break t}ie=g.length;break n}if(o>=ee)break e;{const se=g[1];o<se&&(j=2,ee=se);for(let de=j-2;;){if(ee===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(j===de)break;if(Y=ee,ee=g[--j-1],o>=ee)break t}ie=j,j=0}}for(;j<ie;){const se=j+ie>>>1;o<g[se]?ie=se:j=se+1}if(Y=g[j],ee=g[j-1],ee===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(Y===void 0)return j=g.length,this._cachedIndex=j,this.copySampleValue_(j-1)}this._cachedIndex=j,this.intervalChanged_(j,ee,Y)}return this.interpolate_(j,ee,o,Y)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(o){const g=this.resultBuffer,j=this.sampleValues,Y=this.valueSize,ee=o*Y;for(let ie=0;ie!==Y;++ie)g[ie]=j[ee+ie];return g}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Pu extends Xp{constructor(o,g,j,Y){super(o,g,j,Y),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ts,endingEnd:ts}}intervalChanged_(o,g,j){const Y=this.parameterPositions;let ee=o-2,ie=o+1,se=Y[ee],de=Y[ie];if(se===void 0)switch(this.getSettings_().endingStart){case Pa:ee=o,se=2*g-j;break;case zl:ee=Y.length-2,se=g+Y[ee]-Y[ee+1];break;default:ee=o,se=j}if(de===void 0)switch(this.getSettings_().endingEnd){case Pa:ie=o,de=2*j-g;break;case zl:ie=1,de=j+Y[1]-Y[0];break;default:ie=o-1,de=g}const pe=.5*(j-g),be=this.valueSize;this._weightPrev=pe/(g-se),this._weightNext=pe/(de-j),this._offsetPrev=ee*be,this._offsetNext=ie*be}interpolate_(o,g,j,Y){const ee=this.resultBuffer,ie=this.sampleValues,se=this.valueSize,de=o*se,pe=de-se,be=this._offsetPrev,Ce=this._offsetNext,xe=this._weightPrev,Ie=this._weightNext,Re=(j-g)/(Y-g),De=Re*Re,ze=De*Re,je=-xe*ze+2*xe*De-xe*Re,Ve=(1+xe)*ze+(-1.5-2*xe)*De+(-.5+xe)*Re+1,$e=(-1-Ie)*ze+(1.5+Ie)*De+.5*Re,ct=Ie*ze-Ie*De;for(let dt=0;dt!==se;++dt)ee[dt]=je*ie[be+dt]+Ve*ie[pe+dt]+$e*ie[de+dt]+ct*ie[Ce+dt];return ee}}class Ls extends Xp{constructor(o,g,j,Y){super(o,g,j,Y)}interpolate_(o,g,j,Y){const ee=this.resultBuffer,ie=this.sampleValues,se=this.valueSize,de=o*se,pe=de-se,be=(j-g)/(Y-g),Ce=1-be;for(let xe=0;xe!==se;++xe)ee[xe]=ie[pe+xe]*Ce+ie[de+xe]*be;return ee}}class Sy extends Xp{constructor(o,g,j,Y){super(o,g,j,Y)}interpolate_(o){return this.copySampleValue_(o-1)}}class Vs{constructor(o,g,j,Y){if(o===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(g===void 0||g.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+o);this.name=o,this.times=Wc(g,this.TimeBufferType),this.values=Wc(j,this.ValueBufferType),this.setInterpolation(Y||this.DefaultInterpolation)}static toJSON(o){const g=o.constructor;let j;if(g.toJSON!==this.toJSON)j=g.toJSON(o);else{j={name:o.name,times:Wc(o.times,Array),values:Wc(o.values,Array)};const Y=o.getInterpolation();Y!==o.DefaultInterpolation&&(j.interpolation=Y)}return j.type=o.ValueTypeName,j}InterpolantFactoryMethodDiscrete(o){return new Sy(this.times,this.values,this.getValueSize(),o)}InterpolantFactoryMethodLinear(o){return new Ls(this.times,this.values,this.getValueSize(),o)}InterpolantFactoryMethodSmooth(o){return new Pu(this.times,this.values,this.getValueSize(),o)}setInterpolation(o){let g;switch(o){case gl:g=this.InterpolantFactoryMethodDiscrete;break;case au:g=this.InterpolantFactoryMethodLinear;break;case eh:g=this.InterpolantFactoryMethodSmooth}if(g===void 0){const j="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(o===this.DefaultInterpolation)throw new Error(j);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",j),this}return this.createInterpolant=g,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return gl;case this.InterpolantFactoryMethodLinear:return au;case this.InterpolantFactoryMethodSmooth:return eh}}getValueSize(){return this.values.length/this.times.length}shift(o){if(o!==0){const g=this.times;for(let j=0,Y=g.length;j!==Y;++j)g[j]+=o}return this}scale(o){if(o!==1){const g=this.times;for(let j=0,Y=g.length;j!==Y;++j)g[j]*=o}return this}trim(o,g){const j=this.times,Y=j.length;let ee=0,ie=Y-1;for(;ee!==Y&&j[ee]<o;)++ee;for(;ie!==-1&&j[ie]>g;)--ie;if(++ie,ee!==0||ie!==Y){ee>=ie&&(ie=Math.max(ie,1),ee=ie-1);const se=this.getValueSize();this.times=el(j,ee,ie),this.values=el(this.values,ee*se,ie*se)}return this}validate(){let o=!0;const g=this.getValueSize();g-Math.floor(g)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),o=!1);const j=this.times,Y=this.values,ee=j.length;ee===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),o=!1);let ie=null;for(let se=0;se!==ee;se++){const de=j[se];if(typeof de=="number"&&isNaN(de)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,se,de),o=!1;break}if(ie!==null&&ie>de){console.error("THREE.KeyframeTrack: Out of order keys.",this,se,de,ie),o=!1;break}ie=de}if(Y!==void 0&&A0(Y))for(let se=0,de=Y.length;se!==de;++se){const pe=Y[se];if(isNaN(pe)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,se,pe),o=!1;break}}return o}optimize(){const o=el(this.times),g=el(this.values),j=this.getValueSize(),Y=this.getInterpolation()===eh,ee=o.length-1;let ie=1;for(let se=1;se<ee;++se){let de=!1;const pe=o[se];if(pe!==o[se+1]&&(se!==1||pe!==o[0]))if(Y)de=!0;else{const be=se*j,Ce=be-j,xe=be+j;for(let Ie=0;Ie!==j;++Ie){const Re=g[be+Ie];if(Re!==g[Ce+Ie]||Re!==g[xe+Ie]){de=!0;break}}}if(de){if(se!==ie){o[ie]=o[se];const be=se*j,Ce=ie*j;for(let xe=0;xe!==j;++xe)g[Ce+xe]=g[be+xe]}++ie}}if(ee>0){o[ie]=o[ee];for(let se=ee*j,de=ie*j,pe=0;pe!==j;++pe)g[de+pe]=g[se+pe];++ie}return ie!==o.length?(this.times=el(o,0,ie),this.values=el(g,0,ie*j)):(this.times=o,this.values=g),this}clone(){const o=el(this.times,0),g=el(this.values,0),j=new this.constructor(this.name,o,g);return j.createInterpolant=this.createInterpolant,j}}Vs.prototype.TimeBufferType=Float32Array,Vs.prototype.ValueBufferType=Float32Array,Vs.prototype.DefaultInterpolation=au;class ys extends Vs{}ys.prototype.ValueTypeName="bool",ys.prototype.ValueBufferType=Array,ys.prototype.DefaultInterpolation=gl,ys.prototype.InterpolantFactoryMethodLinear=void 0,ys.prototype.InterpolantFactoryMethodSmooth=void 0;class Am extends Vs{}Am.prototype.ValueTypeName="color";class Ud extends Vs{}Ud.prototype.ValueTypeName="number";class Cy extends Xp{constructor(o,g,j,Y){super(o,g,j,Y)}interpolate_(o,g,j,Y){const ee=this.resultBuffer,ie=this.sampleValues,se=this.valueSize,de=(j-g)/(Y-g);let pe=o*se;for(let be=pe+se;pe!==be;pe+=4)_o.slerpFlat(ee,0,ie,pe-se,ie,pe,de);return ee}}class Fd extends Vs{InterpolantFactoryMethodLinear(o){return new Cy(this.times,this.values,this.getValueSize(),o)}}Fd.prototype.ValueTypeName="quaternion",Fd.prototype.DefaultInterpolation=au,Fd.prototype.InterpolantFactoryMethodSmooth=void 0;class jd extends Vs{}jd.prototype.ValueTypeName="string",jd.prototype.ValueBufferType=Array,jd.prototype.DefaultInterpolation=gl,jd.prototype.InterpolantFactoryMethodLinear=void 0,jd.prototype.InterpolantFactoryMethodSmooth=void 0;class zd extends Vs{}zd.prototype.ValueTypeName="vector";class lc{constructor(o,g=-1,j,Y=ro){this.name=o,this.tracks=j,this.duration=g,this.blendMode=Y,this.uuid=Oi(),this.duration<0&&this.resetDuration()}static parse(o){const g=[],j=o.tracks,Y=1/(o.fps||1);for(let ie=0,se=j.length;ie!==se;++ie)g.push(ym(j[ie]).scale(Y));const ee=new this(o.name,o.duration,g,o.blendMode);return ee.uuid=o.uuid,ee}static toJSON(o){const g=[],j=o.tracks,Y={name:o.name,duration:o.duration,tracks:g,uuid:o.uuid,blendMode:o.blendMode};for(let ee=0,ie=j.length;ee!==ie;++ee)g.push(Vs.toJSON(j[ee]));return Y}static CreateFromMorphTargetSequence(o,g,j,Y){const ee=g.length,ie=[];for(let se=0;se<ee;se++){let de=[],pe=[];de.push((se+ee-1)%ee,se,(se+1)%ee),pe.push(0,1,0);const be=vm(de);de=h_(de,1,be),pe=h_(pe,1,be),Y||de[0]!==0||(de.push(ee),pe.push(pe[0])),ie.push(new Ud(".morphTargetInfluences["+g[se].name+"]",de,pe).scale(1/j))}return new this(o,-1,ie)}static findByName(o,g){let j=o;if(!Array.isArray(o)){const Y=o;j=Y.geometry&&Y.geometry.animations||Y.animations}for(let Y=0;Y<j.length;Y++)if(j[Y].name===g)return j[Y];return null}static CreateClipsFromMorphTargetSequences(o,g,j){const Y={},ee=/^([\w-]*?)([\d]+)$/;for(let se=0,de=o.length;se<de;se++){const pe=o[se],be=pe.name.match(ee);if(be&&be.length>1){const Ce=be[1];let xe=Y[Ce];xe||(Y[Ce]=xe=[]),xe.push(pe)}}const ie=[];for(const se in Y)ie.push(this.CreateFromMorphTargetSequence(se,Y[se],g,j));return ie}static parseAnimation(o,g){if(!o)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const j=function(be,Ce,xe,Ie,Re){if(xe.length!==0){const De=[],ze=[];Yp(xe,De,ze,Ie),De.length!==0&&Re.push(new be(Ce,De,ze))}},Y=[],ee=o.name||"default",ie=o.fps||30,se=o.blendMode;let de=o.length||-1;const pe=o.hierarchy||[];for(let be=0;be<pe.length;be++){const Ce=pe[be].keys;if(Ce&&Ce.length!==0)if(Ce[0].morphTargets){const xe={};let Ie;for(Ie=0;Ie<Ce.length;Ie++)if(Ce[Ie].morphTargets)for(let Re=0;Re<Ce[Ie].morphTargets.length;Re++)xe[Ce[Ie].morphTargets[Re]]=-1;for(const Re in xe){const De=[],ze=[];for(let je=0;je!==Ce[Ie].morphTargets.length;++je){const Ve=Ce[Ie];De.push(Ve.time),ze.push(Ve.morphTarget===Re?1:0)}Y.push(new Ud(".morphTargetInfluence["+Re+"]",De,ze))}de=xe.length*ie}else{const xe=".bones["+g[be].name+"]";j(zd,xe+".position",Ce,"pos",Y),j(Fd,xe+".quaternion",Ce,"rot",Y),j(zd,xe+".scale",Ce,"scl",Y)}}return Y.length===0?null:new this(ee,de,Y,se)}resetDuration(){let o=0;for(let g=0,j=this.tracks.length;g!==j;++g){const Y=this.tracks[g];o=Math.max(o,Y.times[Y.times.length-1])}return this.duration=o,this}trim(){for(let o=0;o<this.tracks.length;o++)this.tracks[o].trim(0,this.duration);return this}validate(){let o=!0;for(let g=0;g<this.tracks.length;g++)o=o&&this.tracks[g].validate();return o}optimize(){for(let o=0;o<this.tracks.length;o++)this.tracks[o].optimize();return this}clone(){const o=[];for(let g=0;g<this.tracks.length;g++)o.push(this.tracks[g].clone());return new this.constructor(this.name,this.duration,o,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function ym(ue){if(ue.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const o=function(g){switch(g.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ud;case"vector":case"vector2":case"vector3":case"vector4":return zd;case"color":return Am;case"quaternion":return Fd;case"bool":case"boolean":return ys;case"string":return jd}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+g)}(ue.type);if(ue.times===void 0){const g=[],j=[];Yp(ue.keys,g,j,"value"),ue.times=g,ue.values=j}return o.parse!==void 0?o.parse(ue):new o(ue.name,ue.times,ue.values,ue.interpolation)}const qc={enabled:!1,files:{},add:function(ue,o){this.enabled!==!1&&(this.files[ue]=o)},get:function(ue,o){return this.enabled===!1?o?Promise.resolve():void 0:o?Promise.resolve(this.files[ue]):this.files[ue]},remove:function(ue){delete this.files[ue]},clear:function(){this.files={}}};class cc{constructor(o,g,j){const Y=this;let ee,ie=!1,se=0,de=0;const pe=[];this.onStart=void 0,this.onLoad=o,this.onProgress=g,this.onError=j,this.itemStart=function(be){de++,ie===!1&&Y.onStart!==void 0&&Y.onStart(be,se,de),ie=!0},this.itemEnd=function(be){se++,Y.onProgress!==void 0&&Y.onProgress(be,se,de),se===de&&(ie=!1,Y.onLoad!==void 0&&Y.onLoad())},this.itemError=function(be){Y.onError!==void 0&&Y.onError(be)},this.resolveURL=function(be){return ee?ee(be):be},this.setURLModifier=function(be){return ee=be,this},this.addHandler=function(be,Ce){return pe.push(be,Ce),this},this.removeHandler=function(be){const Ce=pe.indexOf(be);return Ce!==-1&&pe.splice(Ce,2),this},this.getHandler=function(be){for(let Ce=0,xe=pe.length;Ce<xe;Ce+=2){const Ie=pe[Ce],Re=pe[Ce+1];if(Ie.global&&(Ie.lastIndex=0),Ie.test(be))return Re}return null}}}const Vd=new cc;class Ga{constructor(o){this.manager=o!==void 0?o:Vd,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(o,g){const j=this;return new Promise(function(Y,ee){j.load(o,Y,g,ee)})}parse(){}setCrossOrigin(o){return this.crossOrigin=o,this}setWithCredentials(o){return this.withCredentials=o,this}setPath(o){return this.path=o,this}setResourcePath(o){return this.resourcePath=o,this}setRequestHeader(o){return this.requestHeader=o,this}}const Ru={};class Sh extends Error{constructor(o,g){super(o),this.response=g}}class uc extends Ga{constructor(o){super(o),this.responseType="text"}load(o,g,j,Y){o===void 0&&(o=""),this.path!==void 0&&(o=this.path+o),o=this.manager.resolveURL(o),qc.get(o,this.responseType,this.mimeType).then(ee=>{if(ee!==void 0)return this.manager.itemStart(o),setTimeout(()=>{g&&g(ee),this.manager.itemEnd(o)},0),ee;if(Ru[o]!==void 0)return void Ru[o].push({onLoad:g,onProgress:j,onError:Y});Ru[o]=[],Ru[o].push({onLoad:g,onProgress:j,onError:Y});const ie=new Request(o,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),se=this.mimeType,de=this.responseType;fetch(ie).then(pe=>{if(pe.status===200||pe.status===0){if(pe.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||pe.body===void 0||pe.body.getReader===void 0)return pe;const be=Ru[o],Ce=pe.body.getReader(),xe=pe.headers.get("Content-Length"),Ie=xe?parseInt(xe):0,Re=Ie!==0;let De=0;const ze=new ReadableStream({start(je){(function Ve(){Ce.read().then(({done:$e,value:ct})=>{if($e)je.close();else{De+=ct.byteLength;const dt=new ProgressEvent("progress",{lengthComputable:Re,loaded:De,total:Ie});for(let ft=0,Bt=be.length;ft<Bt;ft++){const Lt=be[ft];Lt.onProgress&&Lt.onProgress(dt)}je.enqueue(ct),Ve()}})})()}});return new Response(ze)}throw new Sh(`fetch for "${pe.url}" responded with ${pe.status}: ${pe.statusText}`,pe)}).then(pe=>{switch(de){case"arraybuffer":return pe.arrayBuffer();case"blob":return pe.blob();case"document":return pe.text().then(be=>new DOMParser().parseFromString(be,se));case"json":return pe.json();default:if(se===void 0)return pe.text();{const be=/charset="?([^;"\s]*)"?/i.exec(se),Ce=be&&be[1]?be[1].toLowerCase():void 0,xe=new TextDecoder(Ce);return pe.arrayBuffer().then(Ie=>xe.decode(Ie))}}}).then(pe=>{qc.add(o,pe,this.responseType);const be=Ru[o];delete Ru[o];for(let Ce=0,xe=be.length;Ce<xe;Ce++){const Ie=be[Ce];Ie.onLoad&&Ie.onLoad(pe)}}).catch(pe=>{const be=Ru[o];if(be===void 0)throw this.manager.itemError(o),pe;delete Ru[o];for(let Ce=0,xe=be.length;Ce<xe;Ce++){const Ie=be[Ce];Ie.onError&&Ie.onError(pe)}this.manager.itemError(o)}).finally(()=>{this.manager.itemEnd(o)}),this.manager.itemStart(o)})}setResponseType(o){return this.responseType=o,this}setMimeType(o){return this.mimeType=o,this}}class Gd extends Ga{constructor(o){super(o)}load(o,g,j,Y){const ee=this,ie=new uc(this.manager);ie.setPath(this.path),ie.setRequestHeader(this.requestHeader),ie.setWithCredentials(this.withCredentials),ie.load(o,function(se){try{g(ee.parse(JSON.parse(se)))}catch(de){Y?Y(de):console.error(de),ee.manager.itemError(o)}},j,Y)}parse(o){const g=[];for(let j=0;j<o.length;j++){const Y=lc.parse(o[j]);g.push(Y)}return g}}class Kp extends Ga{constructor(o){super(o)}load(o,g,j,Y){const ee=this,ie=[],se=new fy,de=new uc(this.manager);de.setPath(this.path),de.setResponseType("arraybuffer"),de.setRequestHeader(this.requestHeader),de.setWithCredentials(ee.withCredentials);let pe=0;function be(Ce){de.load(o[Ce],function(xe){const Ie=ee.parse(xe,!0);ie[Ce]={width:Ie.width,height:Ie.height,format:Ie.format,mipmaps:Ie.mipmaps},pe+=1,pe===6&&(Ie.mipmapCount===1&&(se.minFilter=Ur),se.image=ie,se.format=Ie.format,se.needsUpdate=!0,g&&g(se))},j,Y)}if(Array.isArray(o))for(let Ce=0,xe=o.length;Ce<xe;++Ce)be(Ce);else de.load(o,function(Ce){const xe=ee.parse(Ce,!0);if(xe.isCubemap){const Ie=xe.mipmaps.length/xe.mipmapCount;for(let Re=0;Re<Ie;Re++){ie[Re]={mipmaps:[]};for(let De=0;De<xe.mipmapCount;De++)ie[Re].mipmaps.push(xe.mipmaps[Re*xe.mipmapCount+De]),ie[Re].format=xe.format,ie[Re].width=xe.width,ie[Re].height=xe.height}se.image=ie}else se.image.width=xe.width,se.image.height=xe.height,se.mipmaps=xe.mipmaps;xe.mipmapCount===1&&(se.minFilter=Ur),se.format=xe.format,se.needsUpdate=!0,g&&g(se)},j,Y);return se}}class hc extends Ga{constructor(o){super(o)}load(o,g,j,Y){this.path!==void 0&&(o=this.path+o),o=this.manager.resolveURL(o);const ee=this,ie=qc.get(o);if(ie!==void 0)return ee.manager.itemStart(o),setTimeout(function(){g&&g(ie),ee.manager.itemEnd(o)},0),ie;const se=pu("img");function de(){be(),qc.add(o,this),g&&g(this),ee.manager.itemEnd(o)}function pe(Ce){be(),Y&&Y(Ce),ee.manager.itemError(o),ee.manager.itemEnd(o)}function be(){se.removeEventListener("load",de,!1),se.removeEventListener("error",pe,!1)}return se.addEventListener("load",de,!1),se.addEventListener("error",pe,!1),o.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(se.crossOrigin=this.crossOrigin),ee.manager.itemStart(o),se.src=o,se}}class Tl extends Ga{constructor(o){super(o)}load(o,g,j,Y){const ee=new Uf,ie=new hc(this.manager);ie.setCrossOrigin(this.crossOrigin),ie.setPath(this.path);let se=0;function de(pe){ie.load(o[pe],function(be){ee.images[pe]=be,se++,se===6&&(ee.needsUpdate=!0,g&&g(ee))},void 0,Y)}for(let pe=0;pe<o.length;++pe)de(pe);return ee}}class hx extends Ga{constructor(o){super(o)}load(o,g,j,Y){const ee=this,ie=new kp,se=new uc(this.manager);return se.setResponseType("arraybuffer"),se.setRequestHeader(this.requestHeader),se.setPath(this.path),se.setWithCredentials(ee.withCredentials),se.load(o,function(de){const pe=ee.parse(de);pe&&(pe.image!==void 0?ie.image=pe.image:pe.data!==void 0&&(ie.image.width=pe.width,ie.image.height=pe.height,ie.image.data=pe.data,ie.image.complete=!0),ie.wrapS=pe.wrapS!==void 0?pe.wrapS:rr,ie.wrapT=pe.wrapT!==void 0?pe.wrapT:rr,ie.magFilter=pe.magFilter!==void 0?pe.magFilter:Ur,ie.minFilter=pe.minFilter!==void 0?pe.minFilter:Ur,ie.anisotropy=pe.anisotropy!==void 0?pe.anisotropy:1,pe.encoding!==void 0&&(ie.encoding=pe.encoding),pe.flipY!==void 0&&(ie.flipY=pe.flipY),pe.format!==void 0&&(ie.format=pe.format),pe.type!==void 0&&(ie.type=pe.type),pe.mipmaps!==void 0&&(ie.mipmaps=pe.mipmaps,ie.minFilter=oi),pe.mipmapCount===1&&(ie.minFilter=Ur),pe.generateMipmaps!==void 0&&(ie.generateMipmaps=pe.generateMipmaps),ie.needsUpdate=!0,g&&g(ie,pe))},j,Y),ie}}class dx extends Ga{constructor(o){super(o)}load(o,g,j,Y){const ee=new vs,ie=new hc(this.manager);return ie.setCrossOrigin(this.crossOrigin),ie.setPath(this.path),ie.load(o,function(se){ee.image=se,ee.needsUpdate=!0,g!==void 0&&g(ee)},j,Y),ee}}class Il extends Ar{constructor(o,g=1){super(),this.isLight=!0,this.type="Light",this.color=new ci(o),this.intensity=g}dispose(){}copy(o,g){return super.copy(o,g),this.color.copy(o.color),this.intensity=o.intensity,this}toJSON(o){const g=super.toJSON(o);return g.object.color=this.color.getHex(),g.object.intensity=this.intensity,this.groundColor!==void 0&&(g.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(g.object.distance=this.distance),this.angle!==void 0&&(g.object.angle=this.angle),this.decay!==void 0&&(g.object.decay=this.decay),this.penumbra!==void 0&&(g.object.penumbra=this.penumbra),this.shadow!==void 0&&(g.object.shadow=this.shadow.toJSON()),g}}class ha extends Il{constructor(o,g,j){super(o,j),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Ar.DefaultUp),this.updateMatrix(),this.groundColor=new ci(g)}copy(o,g){return super.copy(o,g),this.groundColor.copy(o.groundColor),this}}const y0=new Yi,d_=new vt,Yc=new vt;class bm{constructor(o){this.camera=o,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Bn(512,512),this.map=null,this.mapPass=null,this.matrix=new Yi,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new $l,this._frameExtents=new Bn(1,1),this._viewportCount=1,this._viewports=[new Vr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(o){const g=this.camera,j=this.matrix;d_.setFromMatrixPosition(o.matrixWorld),g.position.copy(d_),Yc.setFromMatrixPosition(o.target.matrixWorld),g.lookAt(Yc),g.updateMatrixWorld(),y0.multiplyMatrices(g.projectionMatrix,g.matrixWorldInverse),this._frustum.setFromProjectionMatrix(y0),j.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),j.multiply(g.projectionMatrix),j.multiply(g.matrixWorldInverse)}getViewport(o){return this._viewports[o]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(o){return this.camera=o.camera.clone(),this.bias=o.bias,this.normalBias=o.normalBias,this.radius=o.radius,this.mapSize.copy(o.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const o={};return this.bias!==0&&(o.bias=this.bias),this.normalBias!==0&&(o.normalBias=this.normalBias),this.radius!==1&&(o.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(o.mapSize=this.mapSize.toArray()),o.camera=this.camera.toJSON(!1).object,delete o.camera.matrix,o}}class b0 extends bm{constructor(){super(new ko(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(o){const g=this.camera,j=2*ed*o.angle*this.focus,Y=this.mapSize.width/this.mapSize.height,ee=o.distance||g.far;j===g.fov&&Y===g.aspect&&ee===g.far||(g.fov=j,g.aspect=Y,g.far=ee,g.updateProjectionMatrix()),super.updateMatrices(o)}copy(o){return super.copy(o),this.focus=o.focus,this}}class My extends Il{constructor(o,g,j=0,Y=Math.PI/3,ee=0,ie=1){super(o,g),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Ar.DefaultUp),this.updateMatrix(),this.target=new Ar,this.distance=j,this.angle=Y,this.penumbra=ee,this.decay=ie,this.map=null,this.shadow=new b0}get power(){return this.intensity*Math.PI}set power(o){this.intensity=o/Math.PI}dispose(){this.shadow.dispose()}copy(o,g){return super.copy(o,g),this.distance=o.distance,this.angle=o.angle,this.penumbra=o.penumbra,this.decay=o.decay,this.target=o.target.clone(),this.shadow=o.shadow.clone(),this}}const w0=new Yi,Qd=new vt,wm=new vt;class x0 extends bm{constructor(){super(new ko(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Bn(4,2),this._viewportCount=6,this._viewports=[new Vr(2,1,1,1),new Vr(0,1,1,1),new Vr(3,1,1,1),new Vr(1,1,1,1),new Vr(3,0,1,1),new Vr(1,0,1,1)],this._cubeDirections=[new vt(1,0,0),new vt(-1,0,0),new vt(0,0,1),new vt(0,0,-1),new vt(0,1,0),new vt(0,-1,0)],this._cubeUps=[new vt(0,1,0),new vt(0,1,0),new vt(0,1,0),new vt(0,1,0),new vt(0,0,1),new vt(0,0,-1)]}updateMatrices(o,g=0){const j=this.camera,Y=this.matrix,ee=o.distance||j.far;ee!==j.far&&(j.far=ee,j.updateProjectionMatrix()),Qd.setFromMatrixPosition(o.matrixWorld),j.position.copy(Qd),wm.copy(j.position),wm.add(this._cubeDirections[g]),j.up.copy(this._cubeUps[g]),j.lookAt(wm),j.updateMatrixWorld(),Y.makeTranslation(-Qd.x,-Qd.y,-Qd.z),w0.multiplyMatrices(j.projectionMatrix,j.matrixWorldInverse),this._frustum.setFromProjectionMatrix(w0)}}class dc extends Il{constructor(o,g,j=0,Y=1){super(o,g),this.isPointLight=!0,this.type="PointLight",this.distance=j,this.decay=Y,this.shadow=new x0}get power(){return 4*this.intensity*Math.PI}set power(o){this.intensity=o/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(o,g){return super.copy(o,g),this.distance=o.distance,this.decay=o.decay,this.shadow=o.shadow.clone(),this}}class Ty extends bm{constructor(){super(new Tg(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class p_ extends Il{constructor(o,g){super(o,g),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Ar.DefaultUp),this.updateMatrix(),this.target=new Ar,this.shadow=new Ty}dispose(){this.shadow.dispose()}copy(o){return super.copy(o),this.target=o.target.clone(),this.shadow=o.shadow.clone(),this}}class Iy extends Il{constructor(o,g){super(o,g),this.isAmbientLight=!0,this.type="AmbientLight"}}class f_ extends Il{constructor(o,g,j=10,Y=10){super(o,g),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=j,this.height=Y}get power(){return this.intensity*this.width*this.height*Math.PI}set power(o){this.intensity=o/(this.width*this.height*Math.PI)}copy(o){return super.copy(o),this.width=o.width,this.height=o.height,this}toJSON(o){const g=super.toJSON(o);return g.object.width=this.width,g.object.height=this.height,g}}class m_{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let o=0;o<9;o++)this.coefficients.push(new vt)}set(o){for(let g=0;g<9;g++)this.coefficients[g].copy(o[g]);return this}zero(){for(let o=0;o<9;o++)this.coefficients[o].set(0,0,0);return this}getAt(o,g){const j=o.x,Y=o.y,ee=o.z,ie=this.coefficients;return g.copy(ie[0]).multiplyScalar(.282095),g.addScaledVector(ie[1],.488603*Y),g.addScaledVector(ie[2],.488603*ee),g.addScaledVector(ie[3],.488603*j),g.addScaledVector(ie[4],j*Y*1.092548),g.addScaledVector(ie[5],Y*ee*1.092548),g.addScaledVector(ie[6],.315392*(3*ee*ee-1)),g.addScaledVector(ie[7],j*ee*1.092548),g.addScaledVector(ie[8],.546274*(j*j-Y*Y)),g}getIrradianceAt(o,g){const j=o.x,Y=o.y,ee=o.z,ie=this.coefficients;return g.copy(ie[0]).multiplyScalar(.886227),g.addScaledVector(ie[1],1.023328*Y),g.addScaledVector(ie[2],1.023328*ee),g.addScaledVector(ie[3],1.023328*j),g.addScaledVector(ie[4],.858086*j*Y),g.addScaledVector(ie[5],.858086*Y*ee),g.addScaledVector(ie[6],.743125*ee*ee-.247708),g.addScaledVector(ie[7],.858086*j*ee),g.addScaledVector(ie[8],.429043*(j*j-Y*Y)),g}add(o){for(let g=0;g<9;g++)this.coefficients[g].add(o.coefficients[g]);return this}addScaledSH(o,g){for(let j=0;j<9;j++)this.coefficients[j].addScaledVector(o.coefficients[j],g);return this}scale(o){for(let g=0;g<9;g++)this.coefficients[g].multiplyScalar(o);return this}lerp(o,g){for(let j=0;j<9;j++)this.coefficients[j].lerp(o.coefficients[j],g);return this}equals(o){for(let g=0;g<9;g++)if(!this.coefficients[g].equals(o.coefficients[g]))return!1;return!0}copy(o){return this.set(o.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(o,g=0){const j=this.coefficients;for(let Y=0;Y<9;Y++)j[Y].fromArray(o,g+3*Y);return this}toArray(o=[],g=0){const j=this.coefficients;for(let Y=0;Y<9;Y++)j[Y].toArray(o,g+3*Y);return o}static getBasisAt(o,g){const j=o.x,Y=o.y,ee=o.z;g[0]=.282095,g[1]=.488603*Y,g[2]=.488603*ee,g[3]=.488603*j,g[4]=1.092548*j*Y,g[5]=1.092548*Y*ee,g[6]=.315392*(3*ee*ee-1),g[7]=1.092548*j*ee,g[8]=.546274*(j*j-Y*Y)}}class g_ extends Il{constructor(o=new m_,g=1){super(void 0,g),this.isLightProbe=!0,this.sh=o}copy(o){return super.copy(o),this.sh.copy(o.sh),this}fromJSON(o){return this.intensity=o.intensity,this.sh.fromArray(o.sh),this}toJSON(o){const g=super.toJSON(o);return g.object.sh=this.sh.toArray(),g}}class Hd extends Ga{constructor(o){super(o),this.textures={}}load(o,g,j,Y){const ee=this,ie=new uc(ee.manager);ie.setPath(ee.path),ie.setRequestHeader(ee.requestHeader),ie.setWithCredentials(ee.withCredentials),ie.load(o,function(se){try{g(ee.parse(JSON.parse(se)))}catch(de){Y?Y(de):console.error(de),ee.manager.itemError(o)}},j,Y)}parse(o){const g=this.textures;function j(ee){return g[ee]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",ee),g[ee]}const Y=Hd.createMaterialFromType(o.type);if(o.uuid!==void 0&&(Y.uuid=o.uuid),o.name!==void 0&&(Y.name=o.name),o.color!==void 0&&Y.color!==void 0&&Y.color.setHex(o.color),o.roughness!==void 0&&(Y.roughness=o.roughness),o.metalness!==void 0&&(Y.metalness=o.metalness),o.sheen!==void 0&&(Y.sheen=o.sheen),o.sheenColor!==void 0&&(Y.sheenColor=new ci().setHex(o.sheenColor)),o.sheenRoughness!==void 0&&(Y.sheenRoughness=o.sheenRoughness),o.emissive!==void 0&&Y.emissive!==void 0&&Y.emissive.setHex(o.emissive),o.specular!==void 0&&Y.specular!==void 0&&Y.specular.setHex(o.specular),o.specularIntensity!==void 0&&(Y.specularIntensity=o.specularIntensity),o.specularColor!==void 0&&Y.specularColor!==void 0&&Y.specularColor.setHex(o.specularColor),o.shininess!==void 0&&(Y.shininess=o.shininess),o.clearcoat!==void 0&&(Y.clearcoat=o.clearcoat),o.clearcoatRoughness!==void 0&&(Y.clearcoatRoughness=o.clearcoatRoughness),o.iridescence!==void 0&&(Y.iridescence=o.iridescence),o.iridescenceIOR!==void 0&&(Y.iridescenceIOR=o.iridescenceIOR),o.iridescenceThicknessRange!==void 0&&(Y.iridescenceThicknessRange=o.iridescenceThicknessRange),o.transmission!==void 0&&(Y.transmission=o.transmission),o.thickness!==void 0&&(Y.thickness=o.thickness),o.attenuationDistance!==void 0&&(Y.attenuationDistance=o.attenuationDistance),o.attenuationColor!==void 0&&Y.attenuationColor!==void 0&&Y.attenuationColor.setHex(o.attenuationColor),o.fog!==void 0&&(Y.fog=o.fog),o.flatShading!==void 0&&(Y.flatShading=o.flatShading),o.blending!==void 0&&(Y.blending=o.blending),o.combine!==void 0&&(Y.combine=o.combine),o.side!==void 0&&(Y.side=o.side),o.shadowSide!==void 0&&(Y.shadowSide=o.shadowSide),o.opacity!==void 0&&(Y.opacity=o.opacity),o.transparent!==void 0&&(Y.transparent=o.transparent),o.alphaTest!==void 0&&(Y.alphaTest=o.alphaTest),o.depthTest!==void 0&&(Y.depthTest=o.depthTest),o.depthWrite!==void 0&&(Y.depthWrite=o.depthWrite),o.colorWrite!==void 0&&(Y.colorWrite=o.colorWrite),o.stencilWrite!==void 0&&(Y.stencilWrite=o.stencilWrite),o.stencilWriteMask!==void 0&&(Y.stencilWriteMask=o.stencilWriteMask),o.stencilFunc!==void 0&&(Y.stencilFunc=o.stencilFunc),o.stencilRef!==void 0&&(Y.stencilRef=o.stencilRef),o.stencilFuncMask!==void 0&&(Y.stencilFuncMask=o.stencilFuncMask),o.stencilFail!==void 0&&(Y.stencilFail=o.stencilFail),o.stencilZFail!==void 0&&(Y.stencilZFail=o.stencilZFail),o.stencilZPass!==void 0&&(Y.stencilZPass=o.stencilZPass),o.wireframe!==void 0&&(Y.wireframe=o.wireframe),o.wireframeLinewidth!==void 0&&(Y.wireframeLinewidth=o.wireframeLinewidth),o.wireframeLinecap!==void 0&&(Y.wireframeLinecap=o.wireframeLinecap),o.wireframeLinejoin!==void 0&&(Y.wireframeLinejoin=o.wireframeLinejoin),o.rotation!==void 0&&(Y.rotation=o.rotation),o.linewidth!==1&&(Y.linewidth=o.linewidth),o.dashSize!==void 0&&(Y.dashSize=o.dashSize),o.gapSize!==void 0&&(Y.gapSize=o.gapSize),o.scale!==void 0&&(Y.scale=o.scale),o.polygonOffset!==void 0&&(Y.polygonOffset=o.polygonOffset),o.polygonOffsetFactor!==void 0&&(Y.polygonOffsetFactor=o.polygonOffsetFactor),o.polygonOffsetUnits!==void 0&&(Y.polygonOffsetUnits=o.polygonOffsetUnits),o.dithering!==void 0&&(Y.dithering=o.dithering),o.alphaToCoverage!==void 0&&(Y.alphaToCoverage=o.alphaToCoverage),o.premultipliedAlpha!==void 0&&(Y.premultipliedAlpha=o.premultipliedAlpha),o.visible!==void 0&&(Y.visible=o.visible),o.toneMapped!==void 0&&(Y.toneMapped=o.toneMapped),o.userData!==void 0&&(Y.userData=o.userData),o.vertexColors!==void 0&&(typeof o.vertexColors=="number"?Y.vertexColors=o.vertexColors>0:Y.vertexColors=o.vertexColors),o.uniforms!==void 0)for(const ee in o.uniforms){const ie=o.uniforms[ee];switch(Y.uniforms[ee]={},ie.type){case"t":Y.uniforms[ee].value=j(ie.value);break;case"c":Y.uniforms[ee].value=new ci().setHex(ie.value);break;case"v2":Y.uniforms[ee].value=new Bn().fromArray(ie.value);break;case"v3":Y.uniforms[ee].value=new vt().fromArray(ie.value);break;case"v4":Y.uniforms[ee].value=new Vr().fromArray(ie.value);break;case"m3":Y.uniforms[ee].value=new go().fromArray(ie.value);break;case"m4":Y.uniforms[ee].value=new Yi().fromArray(ie.value);break;default:Y.uniforms[ee].value=ie.value}}if(o.defines!==void 0&&(Y.defines=o.defines),o.vertexShader!==void 0&&(Y.vertexShader=o.vertexShader),o.fragmentShader!==void 0&&(Y.fragmentShader=o.fragmentShader),o.glslVersion!==void 0&&(Y.glslVersion=o.glslVersion),o.extensions!==void 0)for(const ee in o.extensions)Y.extensions[ee]=o.extensions[ee];if(o.size!==void 0&&(Y.size=o.size),o.sizeAttenuation!==void 0&&(Y.sizeAttenuation=o.sizeAttenuation),o.map!==void 0&&(Y.map=j(o.map)),o.matcap!==void 0&&(Y.matcap=j(o.matcap)),o.alphaMap!==void 0&&(Y.alphaMap=j(o.alphaMap)),o.bumpMap!==void 0&&(Y.bumpMap=j(o.bumpMap)),o.bumpScale!==void 0&&(Y.bumpScale=o.bumpScale),o.normalMap!==void 0&&(Y.normalMap=j(o.normalMap)),o.normalMapType!==void 0&&(Y.normalMapType=o.normalMapType),o.normalScale!==void 0){let ee=o.normalScale;Array.isArray(ee)===!1&&(ee=[ee,ee]),Y.normalScale=new Bn().fromArray(ee)}return o.displacementMap!==void 0&&(Y.displacementMap=j(o.displacementMap)),o.displacementScale!==void 0&&(Y.displacementScale=o.displacementScale),o.displacementBias!==void 0&&(Y.displacementBias=o.displacementBias),o.roughnessMap!==void 0&&(Y.roughnessMap=j(o.roughnessMap)),o.metalnessMap!==void 0&&(Y.metalnessMap=j(o.metalnessMap)),o.emissiveMap!==void 0&&(Y.emissiveMap=j(o.emissiveMap)),o.emissiveIntensity!==void 0&&(Y.emissiveIntensity=o.emissiveIntensity),o.specularMap!==void 0&&(Y.specularMap=j(o.specularMap)),o.specularIntensityMap!==void 0&&(Y.specularIntensityMap=j(o.specularIntensityMap)),o.specularColorMap!==void 0&&(Y.specularColorMap=j(o.specularColorMap)),o.envMap!==void 0&&(Y.envMap=j(o.envMap)),o.envMapIntensity!==void 0&&(Y.envMapIntensity=o.envMapIntensity),o.reflectivity!==void 0&&(Y.reflectivity=o.reflectivity),o.refractionRatio!==void 0&&(Y.refractionRatio=o.refractionRatio),o.lightMap!==void 0&&(Y.lightMap=j(o.lightMap)),o.lightMapIntensity!==void 0&&(Y.lightMapIntensity=o.lightMapIntensity),o.aoMap!==void 0&&(Y.aoMap=j(o.aoMap)),o.aoMapIntensity!==void 0&&(Y.aoMapIntensity=o.aoMapIntensity),o.gradientMap!==void 0&&(Y.gradientMap=j(o.gradientMap)),o.clearcoatMap!==void 0&&(Y.clearcoatMap=j(o.clearcoatMap)),o.clearcoatRoughnessMap!==void 0&&(Y.clearcoatRoughnessMap=j(o.clearcoatRoughnessMap)),o.clearcoatNormalMap!==void 0&&(Y.clearcoatNormalMap=j(o.clearcoatNormalMap)),o.clearcoatNormalScale!==void 0&&(Y.clearcoatNormalScale=new Bn().fromArray(o.clearcoatNormalScale)),o.iridescenceMap!==void 0&&(Y.iridescenceMap=j(o.iridescenceMap)),o.iridescenceThicknessMap!==void 0&&(Y.iridescenceThicknessMap=j(o.iridescenceThicknessMap)),o.transmissionMap!==void 0&&(Y.transmissionMap=j(o.transmissionMap)),o.thicknessMap!==void 0&&(Y.thicknessMap=j(o.thicknessMap)),o.sheenColorMap!==void 0&&(Y.sheenColorMap=j(o.sheenColorMap)),o.sheenRoughnessMap!==void 0&&(Y.sheenRoughnessMap=j(o.sheenRoughnessMap)),Y}setTextures(o){return this.textures=o,this}static createMaterialFromType(o){return new{ShadowMaterial:c_,SpriteMaterial:Cd,RawShaderMaterial:_m,ShaderMaterial:El,PointsMaterial:Zg,MeshPhysicalMaterial:yy,MeshStandardMaterial:ua,MeshPhongMaterial:by,MeshToonMaterial:v0,MeshNormalMaterial:Ml,MeshLambertMaterial:u_,MeshDepthMaterial:Jf,MeshDistanceMaterial:Sd,MeshBasicMaterial:wl,MeshMatcapMaterial:wy,LineDashedMaterial:xy,LineBasicMaterial:oa,Material:$s}[o]}}class E0{static decodeText(o){if(typeof TextDecoder<"u")return new TextDecoder().decode(o);let g="";for(let j=0,Y=o.length;j<Y;j++)g+=String.fromCharCode(o[j]);try{return decodeURIComponent(escape(g))}catch{return g}}static extractUrlBase(o){const g=o.lastIndexOf("/");return g===-1?"./":o.slice(0,g+1)}static resolveURL(o,g){return typeof o!="string"||o===""?"":(/^https?:\/\//i.test(g)&&/^\//.test(o)&&(g=g.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(o)||/^data:.*,.*$/i.test(o)||/^blob:.*$/i.test(o)?o:g+o)}}class Dy extends yi{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(o){return super.copy(o),this.instanceCount=o.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const o=super.toJSON(this);return o.instanceCount=this.instanceCount,o.isInstancedBufferGeometry=!0,o}}class Py extends Ga{constructor(o){super(o)}load(o,g,j,Y){const ee=this,ie=new uc(ee.manager);ie.setPath(ee.path),ie.setRequestHeader(ee.requestHeader),ie.setWithCredentials(ee.withCredentials),ie.load(o,function(se){try{g(ee.parse(JSON.parse(se)))}catch(de){Y?Y(de):console.error(de),ee.manager.itemError(o)}},j,Y)}parse(o){const g={},j={};function Y(Ce,xe){if(g[xe]!==void 0)return g[xe];const Ie=Ce.interleavedBuffers[xe],Re=function(je,Ve){if(j[Ve]!==void 0)return j[Ve];const $e=je.arrayBuffers[Ve],ct=new Uint32Array($e).buffer;return j[Ve]=ct,ct}(Ce,Ie.buffer),De=Dc(Ie.type,Re),ze=new em(De,Ie.stride);return ze.uuid=Ie.uuid,g[xe]=ze,ze}const ee=o.isInstancedBufferGeometry?new Dy:new yi,ie=o.data.index;if(ie!==void 0){const Ce=Dc(ie.type,ie.array);ee.setIndex(new is(Ce,1))}const se=o.data.attributes;for(const Ce in se){const xe=se[Ce];let Ie;if(xe.isInterleavedBufferAttribute){const Re=Y(o.data,xe.data);Ie=new _h(Re,xe.itemSize,xe.offset,xe.normalized)}else{const Re=Dc(xe.type,xe.array);Ie=new(xe.isInstancedBufferAttribute?Dd:is)(Re,xe.itemSize,xe.normalized)}xe.name!==void 0&&(Ie.name=xe.name),xe.usage!==void 0&&Ie.setUsage(xe.usage),xe.updateRange!==void 0&&(Ie.updateRange.offset=xe.updateRange.offset,Ie.updateRange.count=xe.updateRange.count),ee.setAttribute(Ce,Ie)}const de=o.data.morphAttributes;if(de)for(const Ce in de){const xe=de[Ce],Ie=[];for(let Re=0,De=xe.length;Re<De;Re++){const ze=xe[Re];let je;if(ze.isInterleavedBufferAttribute){const Ve=Y(o.data,ze.data);je=new _h(Ve,ze.itemSize,ze.offset,ze.normalized)}else{const Ve=Dc(ze.type,ze.array);je=new is(Ve,ze.itemSize,ze.normalized)}ze.name!==void 0&&(je.name=ze.name),Ie.push(je)}ee.morphAttributes[Ce]=Ie}o.data.morphTargetsRelative&&(ee.morphTargetsRelative=!0);const pe=o.data.groups||o.data.drawcalls||o.data.offsets;if(pe!==void 0)for(let Ce=0,xe=pe.length;Ce!==xe;++Ce){const Ie=pe[Ce];ee.addGroup(Ie.start,Ie.count,Ie.materialIndex)}const be=o.data.boundingSphere;if(be!==void 0){const Ce=new vt;be.center!==void 0&&Ce.fromArray(be.center),ee.boundingSphere=new kc(Ce,be.radius)}return o.name&&(ee.name=o.name),o.userData&&(ee.userData=o.userData),ee}}class __ extends Ga{constructor(o){super(o)}load(o,g,j,Y){const ee=this,ie=this.path===""?E0.extractUrlBase(o):this.path;this.resourcePath=this.resourcePath||ie;const se=new uc(this.manager);se.setPath(this.path),se.setRequestHeader(this.requestHeader),se.setWithCredentials(this.withCredentials),se.load(o,function(de){let pe=null;try{pe=JSON.parse(de)}catch(Ce){return Y!==void 0&&Y(Ce),void console.error("THREE:ObjectLoader: Can't parse "+o+".",Ce.message)}const be=pe.metadata;be!==void 0&&be.type!==void 0&&be.type.toLowerCase()!=="geometry"?ee.parse(pe,g):console.error("THREE.ObjectLoader: Can't load "+o)},j,Y)}async loadAsync(o,g){const j=this.path===""?E0.extractUrlBase(o):this.path;this.resourcePath=this.resourcePath||j;const Y=new uc(this.manager);Y.setPath(this.path),Y.setRequestHeader(this.requestHeader),Y.setWithCredentials(this.withCredentials);const ee=await Y.loadAsync(o,g),ie=JSON.parse(ee),se=ie.metadata;if(se===void 0||se.type===void 0||se.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+o);return await this.parseAsync(ie)}parse(o,g){const j=this.parseAnimations(o.animations),Y=this.parseShapes(o.shapes),ee=this.parseGeometries(o.geometries,Y),ie=this.parseImages(o.images,function(){g!==void 0&&g(pe)}),se=this.parseTextures(o.textures,ie),de=this.parseMaterials(o.materials,se),pe=this.parseObject(o.object,ee,de,se,j),be=this.parseSkeletons(o.skeletons,pe);if(this.bindSkeletons(pe,be),g!==void 0){let Ce=!1;for(const xe in ie)if(ie[xe].data instanceof HTMLImageElement){Ce=!0;break}Ce===!1&&g(pe)}return pe}async parseAsync(o){const g=this.parseAnimations(o.animations),j=this.parseShapes(o.shapes),Y=this.parseGeometries(o.geometries,j),ee=await this.parseImagesAsync(o.images),ie=this.parseTextures(o.textures,ee),se=this.parseMaterials(o.materials,ie),de=this.parseObject(o.object,Y,se,ie,g),pe=this.parseSkeletons(o.skeletons,de);return this.bindSkeletons(de,pe),de}parseShapes(o){const g={};if(o!==void 0)for(let j=0,Y=o.length;j<Y;j++){const ee=new kd().fromJSON(o[j]);g[ee.uuid]=ee}return g}parseSkeletons(o,g){const j={},Y={};if(g.traverse(function(ee){ee.isBone&&(Y[ee.uuid]=ee)}),o!==void 0)for(let ee=0,ie=o.length;ee<ie;ee++){const se=new Op().fromJSON(o[ee],Y);j[se.uuid]=se}return j}parseGeometries(o,g){const j={};if(o!==void 0){const Y=new Py;for(let ee=0,ie=o.length;ee<ie;ee++){let se;const de=o[ee];switch(de.type){case"BufferGeometry":case"InstancedBufferGeometry":se=Y.parse(de);break;default:de.type in Ay?se=Ay[de.type].fromJSON(de,g):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${de.type}"`)}se.uuid=de.uuid,de.name!==void 0&&(se.name=de.name),se.isBufferGeometry===!0&&de.userData!==void 0&&(se.userData=de.userData),j[de.uuid]=se}}return j}parseMaterials(o,g){const j={},Y={};if(o!==void 0){const ee=new Hd;ee.setTextures(g);for(let ie=0,se=o.length;ie<se;ie++){const de=o[ie];j[de.uuid]===void 0&&(j[de.uuid]=ee.parse(de)),Y[de.uuid]=j[de.uuid]}}return Y}parseAnimations(o){const g={};if(o!==void 0)for(let j=0;j<o.length;j++){const Y=o[j],ee=lc.parse(Y);g[ee.uuid]=ee}return g}parseImages(o,g){const j=this,Y={};let ee;function ie(se){if(typeof se=="string"){const de=se;return function(pe){return j.manager.itemStart(pe),ee.load(pe,function(){j.manager.itemEnd(pe)},void 0,function(){j.manager.itemError(pe),j.manager.itemEnd(pe)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(de)?de:j.resourcePath+de)}return se.data?{data:Dc(se.type,se.data),width:se.width,height:se.height,complete:!0}:null}if(o!==void 0&&o.length>0){const se=new cc(g);ee=new hc(se),ee.setCrossOrigin(this.crossOrigin);for(let de=0,pe=o.length;de<pe;de++){const be=o[de],Ce=be.url;if(Array.isArray(Ce)){const xe=[];for(let Ie=0,Re=Ce.length;Ie<Re;Ie++){const De=ie(Ce[Ie]);De!==null&&(De instanceof HTMLImageElement?xe.push(De):xe.push(new kp(De.data,De.width,De.height)))}Y[be.uuid]=new ka(xe)}else{const xe=ie(be.url);Y[be.uuid]=new ka(xe)}}}return Y}async parseImagesAsync(o){const g=this,j={};let Y;async function ee(ie){if(typeof ie=="string"){const se=ie,de=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(se)?se:g.resourcePath+se;return await Y.loadAsync(de)}return ie.data?{data:Dc(ie.type,ie.data),width:ie.width,height:ie.height,complete:!0}:null}if(o!==void 0&&o.length>0){Y=new hc(this.manager),Y.setCrossOrigin(this.crossOrigin);for(let ie=0,se=o.length;ie<se;ie++){const de=o[ie],pe=de.url;if(Array.isArray(pe)){const be=[];for(let Ce=0,xe=pe.length;Ce<xe;Ce++){const Ie=pe[Ce],Re=await ee(Ie);Re!==null&&(Re instanceof HTMLImageElement?be.push(Re):be.push(new kp(Re.data,Re.width,Re.height)))}j[de.uuid]=new ka(be)}else{const be=await ee(de.url);j[de.uuid]=new ka(be)}}}return j}parseTextures(o,g){function j(ee,ie){return typeof ee=="number"?ee:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",ee),ie[ee])}const Y={};if(o!==void 0)for(let ee=0,ie=o.length;ee<ie;ee++){const se=o[ee];se.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',se.uuid),g[se.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",se.image);const de=g[se.image],pe=de?de.data:void 0;let be;Array.isArray(pe)?(be=new Uf,pe.length===6&&(be.needsUpdate=!0)):(be=pe&&pe.data?new kp:new vs,pe&&pe.complete&&(be.needsUpdate=!0)),be.source=de,be.uuid=se.uuid,se.name!==void 0&&(be.name=se.name),se.mapping!==void 0&&(be.mapping=j(se.mapping,px)),se.offset!==void 0&&be.offset.fromArray(se.offset),se.repeat!==void 0&&be.repeat.fromArray(se.repeat),se.center!==void 0&&be.center.fromArray(se.center),se.rotation!==void 0&&(be.rotation=se.rotation),se.wrap!==void 0&&(be.wrapS=j(se.wrap[0],Wd),be.wrapT=j(se.wrap[1],Wd)),se.format!==void 0&&(be.format=se.format),se.type!==void 0&&(be.type=se.type),se.encoding!==void 0&&(be.encoding=se.encoding),se.minFilter!==void 0&&(be.minFilter=j(se.minFilter,Bu)),se.magFilter!==void 0&&(be.magFilter=j(se.magFilter,Bu)),se.anisotropy!==void 0&&(be.anisotropy=se.anisotropy),se.flipY!==void 0&&(be.flipY=se.flipY),se.premultiplyAlpha!==void 0&&(be.premultiplyAlpha=se.premultiplyAlpha),se.unpackAlignment!==void 0&&(be.unpackAlignment=se.unpackAlignment),se.userData!==void 0&&(be.userData=se.userData),Y[se.uuid]=be}return Y}parseObject(o,g,j,Y,ee){let ie,se,de;function pe(xe){return g[xe]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",xe),g[xe]}function be(xe){if(xe!==void 0){if(Array.isArray(xe)){const Ie=[];for(let Re=0,De=xe.length;Re<De;Re++){const ze=xe[Re];j[ze]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",ze),Ie.push(j[ze])}return Ie}return j[xe]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",xe),j[xe]}}function Ce(xe){return Y[xe]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",xe),Y[xe]}switch(o.type){case"Scene":ie=new $v,o.background!==void 0&&(Number.isInteger(o.background)?ie.background=new ci(o.background):ie.background=Ce(o.background)),o.environment!==void 0&&(ie.environment=Ce(o.environment)),o.fog!==void 0&&(o.fog.type==="Fog"?ie.fog=new gh(o.fog.color,o.fog.near,o.fog.far):o.fog.type==="FogExp2"&&(ie.fog=new Zf(o.fog.color,o.fog.density)));break;case"PerspectiveCamera":ie=new ko(o.fov,o.aspect,o.near,o.far),o.focus!==void 0&&(ie.focus=o.focus),o.zoom!==void 0&&(ie.zoom=o.zoom),o.filmGauge!==void 0&&(ie.filmGauge=o.filmGauge),o.filmOffset!==void 0&&(ie.filmOffset=o.filmOffset),o.view!==void 0&&(ie.view=Object.assign({},o.view));break;case"OrthographicCamera":ie=new Tg(o.left,o.right,o.top,o.bottom,o.near,o.far),o.zoom!==void 0&&(ie.zoom=o.zoom),o.view!==void 0&&(ie.view=Object.assign({},o.view));break;case"AmbientLight":ie=new Iy(o.color,o.intensity);break;case"DirectionalLight":ie=new p_(o.color,o.intensity);break;case"PointLight":ie=new dc(o.color,o.intensity,o.distance,o.decay);break;case"RectAreaLight":ie=new f_(o.color,o.intensity,o.width,o.height);break;case"SpotLight":ie=new My(o.color,o.intensity,o.distance,o.angle,o.penumbra,o.decay);break;case"HemisphereLight":ie=new ha(o.color,o.groundColor,o.intensity);break;case"LightProbe":ie=new g_().fromJSON(o);break;case"SkinnedMesh":se=pe(o.geometry),de=be(o.material),ie=new Bp(se,de),o.bindMode!==void 0&&(ie.bindMode=o.bindMode),o.bindMatrix!==void 0&&ie.bindMatrix.fromArray(o.bindMatrix),o.skeleton!==void 0&&(ie.skeleton=o.skeleton);break;case"Mesh":se=pe(o.geometry),de=be(o.material),ie=new lo(se,de);break;case"InstancedMesh":se=pe(o.geometry),de=be(o.material);const xe=o.count,Ie=o.instanceMatrix,Re=o.instanceColor;ie=new t0(se,de,xe),ie.instanceMatrix=new Dd(new Float32Array(Ie.array),16),Re!==void 0&&(ie.instanceColor=new Dd(new Float32Array(Re.array),Re.itemSize));break;case"LOD":ie=new Zv;break;case"Line":ie=new wh(pe(o.geometry),be(o.material));break;case"LineLoop":ie=new hy(pe(o.geometry),be(o.material));break;case"LineSegments":ie=new rc(pe(o.geometry),be(o.material));break;case"PointCloud":case"Points":ie=new Fp(pe(o.geometry),be(o.material));break;case"Sprite":ie=new Rp(be(o.material));break;case"Group":ie=new Tu;break;case"Bone":ie=new bh;break;default:ie=new Ar}if(ie.uuid=o.uuid,o.name!==void 0&&(ie.name=o.name),o.matrix!==void 0?(ie.matrix.fromArray(o.matrix),o.matrixAutoUpdate!==void 0&&(ie.matrixAutoUpdate=o.matrixAutoUpdate),ie.matrixAutoUpdate&&ie.matrix.decompose(ie.position,ie.quaternion,ie.scale)):(o.position!==void 0&&ie.position.fromArray(o.position),o.rotation!==void 0&&ie.rotation.fromArray(o.rotation),o.quaternion!==void 0&&ie.quaternion.fromArray(o.quaternion),o.scale!==void 0&&ie.scale.fromArray(o.scale)),o.castShadow!==void 0&&(ie.castShadow=o.castShadow),o.receiveShadow!==void 0&&(ie.receiveShadow=o.receiveShadow),o.shadow&&(o.shadow.bias!==void 0&&(ie.shadow.bias=o.shadow.bias),o.shadow.normalBias!==void 0&&(ie.shadow.normalBias=o.shadow.normalBias),o.shadow.radius!==void 0&&(ie.shadow.radius=o.shadow.radius),o.shadow.mapSize!==void 0&&ie.shadow.mapSize.fromArray(o.shadow.mapSize),o.shadow.camera!==void 0&&(ie.shadow.camera=this.parseObject(o.shadow.camera))),o.visible!==void 0&&(ie.visible=o.visible),o.frustumCulled!==void 0&&(ie.frustumCulled=o.frustumCulled),o.renderOrder!==void 0&&(ie.renderOrder=o.renderOrder),o.userData!==void 0&&(ie.userData=o.userData),o.layers!==void 0&&(ie.layers.mask=o.layers),o.children!==void 0){const xe=o.children;for(let Ie=0;Ie<xe.length;Ie++)ie.add(this.parseObject(xe[Ie],g,j,Y,ee))}if(o.animations!==void 0){const xe=o.animations;for(let Ie=0;Ie<xe.length;Ie++){const Re=xe[Ie];ie.animations.push(ee[Re])}}if(o.type==="LOD"){o.autoUpdate!==void 0&&(ie.autoUpdate=o.autoUpdate);const xe=o.levels;for(let Ie=0;Ie<xe.length;Ie++){const Re=xe[Ie],De=ie.getObjectByProperty("uuid",Re.object);De!==void 0&&ie.addLevel(De,Re.distance)}}return ie}bindSkeletons(o,g){Object.keys(g).length!==0&&o.traverse(function(j){if(j.isSkinnedMesh===!0&&j.skeleton!==void 0){const Y=g[j.skeleton];Y===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",j.skeleton):j.bind(Y,j.bindMatrix)}})}}const px={UVMapping:ms,CubeReflectionMapping:Rr,CubeRefractionMapping:Cr,EquirectangularReflectionMapping:Mr,EquirectangularRefractionMapping:Tr,CubeUVReflectionMapping:Is},Wd={RepeatWrapping:pr,ClampToEdgeWrapping:rr,MirroredRepeatWrapping:ss},Bu={NearestFilter:Gr,NearestMipmapNearestFilter:Br,NearestMipmapLinearFilter:Qr,LinearFilter:Ur,LinearMipmapNearestFilter:ho,LinearMipmapLinearFilter:oi};class tl extends Ga{constructor(o){super(o),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(o){return this.options=o,this}load(o,g,j,Y){o===void 0&&(o=""),this.path!==void 0&&(o=this.path+o),o=this.manager.resolveURL(o);const ee=this,ie=qc.get(o);if(ie!==void 0)return ee.manager.itemStart(o),setTimeout(function(){g&&g(ie),ee.manager.itemEnd(o)},0),ie;const se={};se.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",se.headers=this.requestHeader,fetch(o,se).then(function(de){return de.blob()}).then(function(de){return createImageBitmap(de,Object.assign(ee.options,{colorSpaceConversion:"none"}))}).then(function(de){qc.add(o,de),g&&g(de),ee.manager.itemEnd(o)}).catch(function(de){Y&&Y(de),ee.manager.itemError(o),ee.manager.itemEnd(o)}),ee.manager.itemStart(o)}}let v_;const Jp={getContext:function(){return v_===void 0&&(v_=new(window.AudioContext||window.webkitAudioContext)),v_},setContext:function(ue){v_=ue}};class fx extends Ga{constructor(o){super(o)}load(o,g,j,Y){const ee=this,ie=new uc(this.manager);ie.setResponseType("arraybuffer"),ie.setPath(this.path),ie.setRequestHeader(this.requestHeader),ie.setWithCredentials(this.withCredentials),ie.load(o,function(se){try{const de=se.slice(0);Jp.getContext().decodeAudioData(de,function(pe){g(pe)})}catch(de){Y?Y(de):console.error(de),ee.manager.itemError(o)}},j,Y)}}class A_ extends g_{constructor(o,g,j=1){super(void 0,j),this.isHemisphereLightProbe=!0;const Y=new ci().set(o),ee=new ci().set(g),ie=new vt(Y.r,Y.g,Y.b),se=new vt(ee.r,ee.g,ee.b),de=Math.sqrt(Math.PI),pe=de*Math.sqrt(.75);this.sh.coefficients[0].copy(ie).add(se).multiplyScalar(de),this.sh.coefficients[1].copy(ie).sub(se).multiplyScalar(pe)}}class mx extends g_{constructor(o,g=1){super(void 0,g),this.isAmbientLightProbe=!0;const j=new ci().set(o);this.sh.coefficients[0].set(j.r,j.g,j.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const xm=new Yi,Ry=new Yi,Xc=new Yi;class gx{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ko,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ko,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(o){const g=this._cache;if(g.focus!==o.focus||g.fov!==o.fov||g.aspect!==o.aspect*this.aspect||g.near!==o.near||g.far!==o.far||g.zoom!==o.zoom||g.eyeSep!==this.eyeSep){g.focus=o.focus,g.fov=o.fov,g.aspect=o.aspect*this.aspect,g.near=o.near,g.far=o.far,g.zoom=o.zoom,g.eyeSep=this.eyeSep,Xc.copy(o.projectionMatrix);const j=g.eyeSep/2,Y=j*g.near/g.focus,ee=g.near*Math.tan(du*g.fov*.5)/g.zoom;let ie,se;Ry.elements[12]=-j,xm.elements[12]=j,ie=-ee*g.aspect+Y,se=ee*g.aspect+Y,Xc.elements[0]=2*g.near/(se-ie),Xc.elements[8]=(se+ie)/(se-ie),this.cameraL.projectionMatrix.copy(Xc),ie=-ee*g.aspect-Y,se=ee*g.aspect-Y,Xc.elements[0]=2*g.near/(se-ie),Xc.elements[8]=(se+ie)/(se-ie),this.cameraR.projectionMatrix.copy(Xc)}this.cameraL.matrixWorld.copy(o.matrixWorld).multiply(Ry),this.cameraR.matrixWorld.copy(o.matrixWorld).multiply(xm)}}class Em{constructor(o=!0){this.autoStart=o,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Sm(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let o=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const g=Sm();o=(g-this.oldTime)/1e3,this.oldTime=g,this.elapsedTime+=o}return o}}function Sm(){return(typeof performance>"u"?Date:performance).now()}const pc=new vt,y_=new _o,S0=new vt,nl=new vt;class _x extends Ar{constructor(){super(),this.type="AudioListener",this.context=Jp.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Em}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(o){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=o,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(o){return this.gain.gain.setTargetAtTime(o,this.context.currentTime,.01),this}updateMatrixWorld(o){super.updateMatrixWorld(o);const g=this.context.listener,j=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(pc,y_,S0),nl.set(0,0,-1).applyQuaternion(y_),g.positionX){const Y=this.context.currentTime+this.timeDelta;g.positionX.linearRampToValueAtTime(pc.x,Y),g.positionY.linearRampToValueAtTime(pc.y,Y),g.positionZ.linearRampToValueAtTime(pc.z,Y),g.forwardX.linearRampToValueAtTime(nl.x,Y),g.forwardY.linearRampToValueAtTime(nl.y,Y),g.forwardZ.linearRampToValueAtTime(nl.z,Y),g.upX.linearRampToValueAtTime(j.x,Y),g.upY.linearRampToValueAtTime(j.y,Y),g.upZ.linearRampToValueAtTime(j.z,Y)}else g.setPosition(pc.x,pc.y,pc.z),g.setOrientation(nl.x,nl.y,nl.z,j.x,j.y,j.z)}}class $p extends Ar{constructor(o){super(),this.type="Audio",this.listener=o,this.context=o.context,this.gain=this.context.createGain(),this.gain.connect(o.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(o){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=o,this.connect(),this}setMediaElementSource(o){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(o),this.connect(),this}setMediaStreamSource(o){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(o),this.connect(),this}setBuffer(o){return this.buffer=o,this.sourceType="buffer",this.autoplay&&this.play(),this}play(o=0){if(this.isPlaying===!0)return void console.warn("THREE.Audio: Audio is already playing.");if(this.hasPlaybackControl===!1)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+o;const g=this.context.createBufferSource();return g.buffer=this.buffer,g.loop=this.loop,g.loopStart=this.loopStart,g.loopEnd=this.loopEnd,g.onended=this.onEnded.bind(this),g.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=g,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(this.hasPlaybackControl!==!1)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let o=1,g=this.filters.length;o<g;o++)this.filters[o-1].connect(this.filters[o]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let o=1,g=this.filters.length;o<g;o++)this.filters[o-1].disconnect(this.filters[o]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(o){return o||(o=[]),this._connected===!0?(this.disconnect(),this.filters=o.slice(),this.connect()):this.filters=o.slice(),this}setDetune(o){if(this.detune=o,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(o){return this.setFilters(o?[o]:[])}setPlaybackRate(o){if(this.hasPlaybackControl!==!1)return this.playbackRate=o,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(o){if(this.hasPlaybackControl!==!1)return this.loop=o,this.isPlaying===!0&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(o){return this.loopStart=o,this}setLoopEnd(o){return this.loopEnd=o,this}getVolume(){return this.gain.gain.value}setVolume(o){return this.gain.gain.setTargetAtTime(o,this.context.currentTime,.01),this}}const il=new vt,By=new _o,fc=new vt,Ch=new vt;class ku extends $p{constructor(o){super(o),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(o){return this.panner.refDistance=o,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(o){return this.panner.rolloffFactor=o,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(o){return this.panner.distanceModel=o,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(o){return this.panner.maxDistance=o,this}setDirectionalCone(o,g,j){return this.panner.coneInnerAngle=o,this.panner.coneOuterAngle=g,this.panner.coneOuterGain=j,this}updateMatrixWorld(o){if(super.updateMatrixWorld(o),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(il,By,fc),Ch.set(0,0,1).applyQuaternion(By);const g=this.panner;if(g.positionX){const j=this.context.currentTime+this.listener.timeDelta;g.positionX.linearRampToValueAtTime(il.x,j),g.positionY.linearRampToValueAtTime(il.y,j),g.positionZ.linearRampToValueAtTime(il.z,j),g.orientationX.linearRampToValueAtTime(Ch.x,j),g.orientationY.linearRampToValueAtTime(Ch.y,j),g.orientationZ.linearRampToValueAtTime(Ch.z,j)}else g.setPosition(il.x,il.y,il.z),g.setOrientation(Ch.x,Ch.y,Ch.z)}}class ky{constructor(o,g=2048){this.analyser=o.context.createAnalyser(),this.analyser.fftSize=g,this.data=new Uint8Array(this.analyser.frequencyBinCount),o.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let o=0;const g=this.getFrequencyData();for(let j=0;j<g.length;j++)o+=g[j];return o/g.length}}class b_{constructor(o,g,j){let Y,ee,ie;switch(this.binding=o,this.valueSize=j,g){case"quaternion":Y=this._slerp,ee=this._slerpAdditive,ie=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*j),this._workIndex=5;break;case"string":case"bool":Y=this._select,ee=this._select,ie=this._setAdditiveIdentityOther,this.buffer=new Array(5*j);break;default:Y=this._lerp,ee=this._lerpAdditive,ie=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*j)}this._mixBufferRegion=Y,this._mixBufferRegionAdditive=ee,this._setIdentity=ie,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(o,g){const j=this.buffer,Y=this.valueSize,ee=o*Y+Y;let ie=this.cumulativeWeight;if(ie===0){for(let se=0;se!==Y;++se)j[ee+se]=j[se];ie=g}else{ie+=g;const se=g/ie;this._mixBufferRegion(j,ee,0,se,Y)}this.cumulativeWeight=ie}accumulateAdditive(o){const g=this.buffer,j=this.valueSize,Y=j*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(g,Y,0,o,j),this.cumulativeWeightAdditive+=o}apply(o){const g=this.valueSize,j=this.buffer,Y=o*g+g,ee=this.cumulativeWeight,ie=this.cumulativeWeightAdditive,se=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,ee<1){const de=g*this._origIndex;this._mixBufferRegion(j,Y,de,1-ee,g)}ie>0&&this._mixBufferRegionAdditive(j,Y,this._addIndex*g,1,g);for(let de=g,pe=g+g;de!==pe;++de)if(j[de]!==j[de+g]){se.setValue(j,Y);break}}saveOriginalState(){const o=this.binding,g=this.buffer,j=this.valueSize,Y=j*this._origIndex;o.getValue(g,Y);for(let ee=j,ie=Y;ee!==ie;++ee)g[ee]=g[Y+ee%j];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const o=3*this.valueSize;this.binding.setValue(this.buffer,o)}_setAdditiveIdentityNumeric(){const o=this._addIndex*this.valueSize,g=o+this.valueSize;for(let j=o;j<g;j++)this.buffer[j]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const o=this._origIndex*this.valueSize,g=this._addIndex*this.valueSize;for(let j=0;j<this.valueSize;j++)this.buffer[g+j]=this.buffer[o+j]}_select(o,g,j,Y,ee){if(Y>=.5)for(let ie=0;ie!==ee;++ie)o[g+ie]=o[j+ie]}_slerp(o,g,j,Y){_o.slerpFlat(o,g,o,g,o,j,Y)}_slerpAdditive(o,g,j,Y,ee){const ie=this._workIndex*ee;_o.multiplyQuaternionsFlat(o,ie,o,g,o,j),_o.slerpFlat(o,g,o,g,o,ie,Y)}_lerp(o,g,j,Y,ee){const ie=1-Y;for(let se=0;se!==ee;++se){const de=g+se;o[de]=o[de]*ie+o[j+se]*Y}}_lerpAdditive(o,g,j,Y,ee){for(let ie=0;ie!==ee;++ie){const se=g+ie;o[se]=o[se]+o[j+ie]*Y}}}const Cm=new RegExp("[\\[\\]\\.:\\/]","g"),w_="[^\\[\\]\\.:\\/]",Zp="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Mm=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",w_)+/(WCOD+)?/.source.replace("WCOD",Zp)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",w_)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",w_)+"$"),Oy=["material","materials","bones","map"];class hr{constructor(o,g,j){this.path=g,this.parsedPath=j||hr.parseTrackName(g),this.node=hr.findNode(o,this.parsedPath.nodeName)||o,this.rootNode=o,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(o,g,j){return o&&o.isAnimationObjectGroup?new hr.Composite(o,g,j):new hr(o,g,j)}static sanitizeNodeName(o){return o.replace(/\s/g,"_").replace(Cm,"")}static parseTrackName(o){const g=Mm.exec(o);if(g===null)throw new Error("PropertyBinding: Cannot parse trackName: "+o);const j={nodeName:g[2],objectName:g[3],objectIndex:g[4],propertyName:g[5],propertyIndex:g[6]},Y=j.nodeName&&j.nodeName.lastIndexOf(".");if(Y!==void 0&&Y!==-1){const ee=j.nodeName.substring(Y+1);Oy.indexOf(ee)!==-1&&(j.nodeName=j.nodeName.substring(0,Y),j.objectName=ee)}if(j.propertyName===null||j.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+o);return j}static findNode(o,g){if(g===void 0||g===""||g==="."||g===-1||g===o.name||g===o.uuid)return o;if(o.skeleton){const j=o.skeleton.getBoneByName(g);if(j!==void 0)return j}if(o.children){const j=function(ee){for(let ie=0;ie<ee.length;ie++){const se=ee[ie];if(se.name===g||se.uuid===g)return se;const de=j(se.children);if(de)return de}return null},Y=j(o.children);if(Y)return Y}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(o,g){o[g]=this.targetObject[this.propertyName]}_getValue_array(o,g){const j=this.resolvedProperty;for(let Y=0,ee=j.length;Y!==ee;++Y)o[g++]=j[Y]}_getValue_arrayElement(o,g){o[g]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(o,g){this.resolvedProperty.toArray(o,g)}_setValue_direct(o,g){this.targetObject[this.propertyName]=o[g]}_setValue_direct_setNeedsUpdate(o,g){this.targetObject[this.propertyName]=o[g],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(o,g){this.targetObject[this.propertyName]=o[g],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(o,g){const j=this.resolvedProperty;for(let Y=0,ee=j.length;Y!==ee;++Y)j[Y]=o[g++]}_setValue_array_setNeedsUpdate(o,g){const j=this.resolvedProperty;for(let Y=0,ee=j.length;Y!==ee;++Y)j[Y]=o[g++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(o,g){const j=this.resolvedProperty;for(let Y=0,ee=j.length;Y!==ee;++Y)j[Y]=o[g++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(o,g){this.resolvedProperty[this.propertyIndex]=o[g]}_setValue_arrayElement_setNeedsUpdate(o,g){this.resolvedProperty[this.propertyIndex]=o[g],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(o,g){this.resolvedProperty[this.propertyIndex]=o[g],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(o,g){this.resolvedProperty.fromArray(o,g)}_setValue_fromArray_setNeedsUpdate(o,g){this.resolvedProperty.fromArray(o,g),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(o,g){this.resolvedProperty.fromArray(o,g),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(o,g){this.bind(),this.getValue(o,g)}_setValue_unbound(o,g){this.bind(),this.setValue(o,g)}bind(){let o=this.node;const g=this.parsedPath,j=g.objectName,Y=g.propertyName;let ee=g.propertyIndex;if(o||(o=hr.findNode(this.rootNode,g.nodeName)||this.rootNode,this.node=o),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!o)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(j){let pe=g.objectIndex;switch(j){case"materials":if(!o.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!o.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);o=o.material.materials;break;case"bones":if(!o.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);o=o.skeleton.bones;for(let be=0;be<o.length;be++)if(o[be].name===pe){pe=be;break}break;case"map":if(!o.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!o.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);o=o.material.map;break;default:if(o[j]===void 0)return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);o=o[j]}if(pe!==void 0){if(o[pe]===void 0)return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,o);o=o[pe]}}const ie=o[Y];if(ie===void 0){const pe=g.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+pe+"."+Y+" but it wasn't found.",o)}let se=this.Versioning.None;this.targetObject=o,o.needsUpdate!==void 0?se=this.Versioning.NeedsUpdate:o.matrixWorldNeedsUpdate!==void 0&&(se=this.Versioning.MatrixWorldNeedsUpdate);let de=this.BindingType.Direct;if(ee!==void 0){if(Y==="morphTargetInfluences"){if(!o.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!o.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);o.morphTargetDictionary[ee]!==void 0&&(ee=o.morphTargetDictionary[ee])}de=this.BindingType.ArrayElement,this.resolvedProperty=ie,this.propertyIndex=ee}else ie.fromArray!==void 0&&ie.toArray!==void 0?(de=this.BindingType.HasFromToArray,this.resolvedProperty=ie):Array.isArray(ie)?(de=this.BindingType.EntireArray,this.resolvedProperty=ie):this.propertyName=Y;this.getValue=this.GetterByBindingType[de],this.setValue=this.SetterByBindingTypeAndVersioning[de][se]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}hr.Composite=class{constructor(ue,o,g){const j=g||hr.parseTrackName(o);this._targetGroup=ue,this._bindings=ue.subscribe_(o,j)}getValue(ue,o){this.bind();const g=this._targetGroup.nCachedObjects_,j=this._bindings[g];j!==void 0&&j.getValue(ue,o)}setValue(ue,o){const g=this._bindings;for(let j=this._targetGroup.nCachedObjects_,Y=g.length;j!==Y;++j)g[j].setValue(ue,o)}bind(){const ue=this._bindings;for(let o=this._targetGroup.nCachedObjects_,g=ue.length;o!==g;++o)ue[o].bind()}unbind(){const ue=this._bindings;for(let o=this._targetGroup.nCachedObjects_,g=ue.length;o!==g;++o)ue[o].unbind()}},hr.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},hr.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},hr.prototype.GetterByBindingType=[hr.prototype._getValue_direct,hr.prototype._getValue_array,hr.prototype._getValue_arrayElement,hr.prototype._getValue_toArray],hr.prototype.SetterByBindingTypeAndVersioning=[[hr.prototype._setValue_direct,hr.prototype._setValue_direct_setNeedsUpdate,hr.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[hr.prototype._setValue_array,hr.prototype._setValue_array_setNeedsUpdate,hr.prototype._setValue_array_setMatrixWorldNeedsUpdate],[hr.prototype._setValue_arrayElement,hr.prototype._setValue_arrayElement_setNeedsUpdate,hr.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[hr.prototype._setValue_fromArray,hr.prototype._setValue_fromArray_setNeedsUpdate,hr.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class x_{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Oi(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const o={};this._indicesByUUID=o;for(let j=0,Y=arguments.length;j!==Y;++j)o[arguments[j].uuid]=j;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const g=this;this.stats={objects:{get total(){return g._objects.length},get inUse(){return this.total-g.nCachedObjects_}},get bindingsPerObject(){return g._bindings.length}}}add(){const o=this._objects,g=this._indicesByUUID,j=this._paths,Y=this._parsedPaths,ee=this._bindings,ie=ee.length;let se,de=o.length,pe=this.nCachedObjects_;for(let be=0,Ce=arguments.length;be!==Ce;++be){const xe=arguments[be],Ie=xe.uuid;let Re=g[Ie];if(Re===void 0){Re=de++,g[Ie]=Re,o.push(xe);for(let De=0,ze=ie;De!==ze;++De)ee[De].push(new hr(xe,j[De],Y[De]))}else if(Re<pe){se=o[Re];const De=--pe,ze=o[De];g[ze.uuid]=Re,o[Re]=ze,g[Ie]=De,o[De]=xe;for(let je=0,Ve=ie;je!==Ve;++je){const $e=ee[je],ct=$e[De];let dt=$e[Re];$e[Re]=ct,dt===void 0&&(dt=new hr(xe,j[je],Y[je])),$e[De]=dt}}else o[Re]!==se&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=pe}remove(){const o=this._objects,g=this._indicesByUUID,j=this._bindings,Y=j.length;let ee=this.nCachedObjects_;for(let ie=0,se=arguments.length;ie!==se;++ie){const de=arguments[ie],pe=de.uuid,be=g[pe];if(be!==void 0&&be>=ee){const Ce=ee++,xe=o[Ce];g[xe.uuid]=be,o[be]=xe,g[pe]=Ce,o[Ce]=de;for(let Ie=0,Re=Y;Ie!==Re;++Ie){const De=j[Ie],ze=De[Ce],je=De[be];De[be]=ze,De[Ce]=je}}}this.nCachedObjects_=ee}uncache(){const o=this._objects,g=this._indicesByUUID,j=this._bindings,Y=j.length;let ee=this.nCachedObjects_,ie=o.length;for(let se=0,de=arguments.length;se!==de;++se){const pe=arguments[se].uuid,be=g[pe];if(be!==void 0)if(delete g[pe],be<ee){const Ce=--ee,xe=o[Ce],Ie=--ie,Re=o[Ie];g[xe.uuid]=be,o[be]=xe,g[Re.uuid]=Ce,o[Ce]=Re,o.pop();for(let De=0,ze=Y;De!==ze;++De){const je=j[De],Ve=je[Ce],$e=je[Ie];je[be]=Ve,je[Ce]=$e,je.pop()}}else{const Ce=--ie,xe=o[Ce];Ce>0&&(g[xe.uuid]=be),o[be]=xe,o.pop();for(let Ie=0,Re=Y;Ie!==Re;++Ie){const De=j[Ie];De[be]=De[Ce],De.pop()}}}this.nCachedObjects_=ee}subscribe_(o,g){const j=this._bindingsIndicesByPath;let Y=j[o];const ee=this._bindings;if(Y!==void 0)return ee[Y];const ie=this._paths,se=this._parsedPaths,de=this._objects,pe=de.length,be=this.nCachedObjects_,Ce=new Array(pe);Y=ee.length,j[o]=Y,ie.push(o),se.push(g),ee.push(Ce);for(let xe=be,Ie=de.length;xe!==Ie;++xe){const Re=de[xe];Ce[xe]=new hr(Re,o,g)}return Ce}unsubscribe_(o){const g=this._bindingsIndicesByPath,j=g[o];if(j!==void 0){const Y=this._paths,ee=this._parsedPaths,ie=this._bindings,se=ie.length-1,de=ie[se];g[o[se]]=j,ie[j]=de,ie.pop(),ee[j]=ee[se],ee.pop(),Y[j]=Y[se],Y.pop()}}}class Mh{constructor(o,g,j=null,Y=g.blendMode){this._mixer=o,this._clip=g,this._localRoot=j,this.blendMode=Y;const ee=g.tracks,ie=ee.length,se=new Array(ie),de={endingStart:ts,endingEnd:ts};for(let pe=0;pe!==ie;++pe){const be=ee[pe].createInterpolant(null);se[pe]=be,be.settings=de}this._interpolantSettings=de,this._interpolants=se,this._propertyBindings=new Array(ie),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=ta,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(o){return this._startTime=o,this}setLoop(o,g){return this.loop=o,this.repetitions=g,this}setEffectiveWeight(o){return this.weight=o,this._effectiveWeight=this.enabled?o:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(o){return this._scheduleFading(o,0,1)}fadeOut(o){return this._scheduleFading(o,1,0)}crossFadeFrom(o,g,j){if(o.fadeOut(g),this.fadeIn(g),j){const Y=this._clip.duration,ee=o._clip.duration,ie=ee/Y,se=Y/ee;o.warp(1,ie,g),this.warp(se,1,g)}return this}crossFadeTo(o,g,j){return o.crossFadeFrom(this,g,j)}stopFading(){const o=this._weightInterpolant;return o!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(o)),this}setEffectiveTimeScale(o){return this.timeScale=o,this._effectiveTimeScale=this.paused?0:o,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(o){return this.timeScale=this._clip.duration/o,this.stopWarping()}syncWith(o){return this.time=o.time,this.timeScale=o.timeScale,this.stopWarping()}halt(o){return this.warp(this._effectiveTimeScale,0,o)}warp(o,g,j){const Y=this._mixer,ee=Y.time,ie=this.timeScale;let se=this._timeScaleInterpolant;se===null&&(se=Y._lendControlInterpolant(),this._timeScaleInterpolant=se);const de=se.parameterPositions,pe=se.sampleValues;return de[0]=ee,de[1]=ee+j,pe[0]=o/ie,pe[1]=g/ie,this}stopWarping(){const o=this._timeScaleInterpolant;return o!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(o)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(o,g,j,Y){if(!this.enabled)return void this._updateWeight(o);const ee=this._startTime;if(ee!==null){const de=(o-ee)*j;de<0||j===0?g=0:(this._startTime=null,g=j*de)}g*=this._updateTimeScale(o);const ie=this._updateTime(g),se=this._updateWeight(o);if(se>0){const de=this._interpolants,pe=this._propertyBindings;if(this.blendMode===ma)for(let be=0,Ce=de.length;be!==Ce;++be)de[be].evaluate(ie),pe[be].accumulateAdditive(se);else for(let be=0,Ce=de.length;be!==Ce;++be)de[be].evaluate(ie),pe[be].accumulate(Y,se)}}_updateWeight(o){let g=0;if(this.enabled){g=this.weight;const j=this._weightInterpolant;if(j!==null){const Y=j.evaluate(o)[0];g*=Y,o>j.parameterPositions[1]&&(this.stopFading(),Y===0&&(this.enabled=!1))}}return this._effectiveWeight=g,g}_updateTimeScale(o){let g=0;if(!this.paused){g=this.timeScale;const j=this._timeScaleInterpolant;j!==null&&(g*=j.evaluate(o)[0],o>j.parameterPositions[1]&&(this.stopWarping(),g===0?this.paused=!0:this.timeScale=g))}return this._effectiveTimeScale=g,g}_updateTime(o){const g=this._clip.duration,j=this.loop;let Y=this.time+o,ee=this._loopCount;const ie=j===fp;if(o===0)return ee===-1?Y:ie&&(1&ee)==1?g-Y:Y;if(j===Cc){ee===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(Y>=g)Y=g;else{if(!(Y<0)){this.time=Y;break e}Y=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=Y,this._mixer.dispatchEvent({type:"finished",action:this,direction:o<0?-1:1})}}else{if(ee===-1&&(o>=0?(ee=0,this._setEndings(!0,this.repetitions===0,ie)):this._setEndings(this.repetitions===0,!0,ie)),Y>=g||Y<0){const se=Math.floor(Y/g);Y-=g*se,ee+=Math.abs(se);const de=this.repetitions-ee;if(de<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,Y=o>0?g:0,this.time=Y,this._mixer.dispatchEvent({type:"finished",action:this,direction:o>0?1:-1});else{if(de===1){const pe=o<0;this._setEndings(pe,!pe,ie)}else this._setEndings(!1,!1,ie);this._loopCount=ee,this.time=Y,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:se})}}else this.time=Y;if(ie&&(1&ee)==1)return g-Y}return Y}_setEndings(o,g,j){const Y=this._interpolantSettings;j?(Y.endingStart=Pa,Y.endingEnd=Pa):(Y.endingStart=o?this.zeroSlopeAtStart?Pa:ts:zl,Y.endingEnd=g?this.zeroSlopeAtEnd?Pa:ts:zl)}_scheduleFading(o,g,j){const Y=this._mixer,ee=Y.time;let ie=this._weightInterpolant;ie===null&&(ie=Y._lendControlInterpolant(),this._weightInterpolant=ie);const se=ie.parameterPositions,de=ie.sampleValues;return se[0]=ee,de[0]=g,se[1]=ee+o,de[1]=j,this}}const qd=new Float32Array(1);class Ou extends va{constructor(o){super(),this._root=o,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(o,g){const j=o._localRoot||this._root,Y=o._clip.tracks,ee=Y.length,ie=o._propertyBindings,se=o._interpolants,de=j.uuid,pe=this._bindingsByRootAndName;let be=pe[de];be===void 0&&(be={},pe[de]=be);for(let Ce=0;Ce!==ee;++Ce){const xe=Y[Ce],Ie=xe.name;let Re=be[Ie];if(Re!==void 0)++Re.referenceCount,ie[Ce]=Re;else{if(Re=ie[Ce],Re!==void 0){Re._cacheIndex===null&&(++Re.referenceCount,this._addInactiveBinding(Re,de,Ie));continue}const De=g&&g._propertyBindings[Ce].binding.parsedPath;Re=new b_(hr.create(j,Ie,De),xe.ValueTypeName,xe.getValueSize()),++Re.referenceCount,this._addInactiveBinding(Re,de,Ie),ie[Ce]=Re}se[Ce].resultBuffer=Re.buffer}}_activateAction(o){if(!this._isActiveAction(o)){if(o._cacheIndex===null){const j=(o._localRoot||this._root).uuid,Y=o._clip.uuid,ee=this._actionsByClip[Y];this._bindAction(o,ee&&ee.knownActions[0]),this._addInactiveAction(o,Y,j)}const g=o._propertyBindings;for(let j=0,Y=g.length;j!==Y;++j){const ee=g[j];ee.useCount++==0&&(this._lendBinding(ee),ee.saveOriginalState())}this._lendAction(o)}}_deactivateAction(o){if(this._isActiveAction(o)){const g=o._propertyBindings;for(let j=0,Y=g.length;j!==Y;++j){const ee=g[j];--ee.useCount==0&&(ee.restoreOriginalState(),this._takeBackBinding(ee))}this._takeBackAction(o)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const o=this;this.stats={actions:{get total(){return o._actions.length},get inUse(){return o._nActiveActions}},bindings:{get total(){return o._bindings.length},get inUse(){return o._nActiveBindings}},controlInterpolants:{get total(){return o._controlInterpolants.length},get inUse(){return o._nActiveControlInterpolants}}}}_isActiveAction(o){const g=o._cacheIndex;return g!==null&&g<this._nActiveActions}_addInactiveAction(o,g,j){const Y=this._actions,ee=this._actionsByClip;let ie=ee[g];if(ie===void 0)ie={knownActions:[o],actionByRoot:{}},o._byClipCacheIndex=0,ee[g]=ie;else{const se=ie.knownActions;o._byClipCacheIndex=se.length,se.push(o)}o._cacheIndex=Y.length,Y.push(o),ie.actionByRoot[j]=o}_removeInactiveAction(o){const g=this._actions,j=g[g.length-1],Y=o._cacheIndex;j._cacheIndex=Y,g[Y]=j,g.pop(),o._cacheIndex=null;const ee=o._clip.uuid,ie=this._actionsByClip,se=ie[ee],de=se.knownActions,pe=de[de.length-1],be=o._byClipCacheIndex;pe._byClipCacheIndex=be,de[be]=pe,de.pop(),o._byClipCacheIndex=null,delete se.actionByRoot[(o._localRoot||this._root).uuid],de.length===0&&delete ie[ee],this._removeInactiveBindingsForAction(o)}_removeInactiveBindingsForAction(o){const g=o._propertyBindings;for(let j=0,Y=g.length;j!==Y;++j){const ee=g[j];--ee.referenceCount==0&&this._removeInactiveBinding(ee)}}_lendAction(o){const g=this._actions,j=o._cacheIndex,Y=this._nActiveActions++,ee=g[Y];o._cacheIndex=Y,g[Y]=o,ee._cacheIndex=j,g[j]=ee}_takeBackAction(o){const g=this._actions,j=o._cacheIndex,Y=--this._nActiveActions,ee=g[Y];o._cacheIndex=Y,g[Y]=o,ee._cacheIndex=j,g[j]=ee}_addInactiveBinding(o,g,j){const Y=this._bindingsByRootAndName,ee=this._bindings;let ie=Y[g];ie===void 0&&(ie={},Y[g]=ie),ie[j]=o,o._cacheIndex=ee.length,ee.push(o)}_removeInactiveBinding(o){const g=this._bindings,j=o.binding,Y=j.rootNode.uuid,ee=j.path,ie=this._bindingsByRootAndName,se=ie[Y],de=g[g.length-1],pe=o._cacheIndex;de._cacheIndex=pe,g[pe]=de,g.pop(),delete se[ee],Object.keys(se).length===0&&delete ie[Y]}_lendBinding(o){const g=this._bindings,j=o._cacheIndex,Y=this._nActiveBindings++,ee=g[Y];o._cacheIndex=Y,g[Y]=o,ee._cacheIndex=j,g[j]=ee}_takeBackBinding(o){const g=this._bindings,j=o._cacheIndex,Y=--this._nActiveBindings,ee=g[Y];o._cacheIndex=Y,g[Y]=o,ee._cacheIndex=j,g[j]=ee}_lendControlInterpolant(){const o=this._controlInterpolants,g=this._nActiveControlInterpolants++;let j=o[g];return j===void 0&&(j=new Ls(new Float32Array(2),new Float32Array(2),1,qd),j.__cacheIndex=g,o[g]=j),j}_takeBackControlInterpolant(o){const g=this._controlInterpolants,j=o.__cacheIndex,Y=--this._nActiveControlInterpolants,ee=g[Y];o.__cacheIndex=Y,g[Y]=o,ee.__cacheIndex=j,g[j]=ee}clipAction(o,g,j){const Y=g||this._root,ee=Y.uuid;let ie=typeof o=="string"?lc.findByName(Y,o):o;const se=ie!==null?ie.uuid:o,de=this._actionsByClip[se];let pe=null;if(j===void 0&&(j=ie!==null?ie.blendMode:ro),de!==void 0){const Ce=de.actionByRoot[ee];if(Ce!==void 0&&Ce.blendMode===j)return Ce;pe=de.knownActions[0],ie===null&&(ie=pe._clip)}if(ie===null)return null;const be=new Mh(this,ie,g,j);return this._bindAction(be,pe),this._addInactiveAction(be,se,ee),be}existingAction(o,g){const j=g||this._root,Y=j.uuid,ee=typeof o=="string"?lc.findByName(j,o):o,ie=ee?ee.uuid:o,se=this._actionsByClip[ie];return se!==void 0&&se.actionByRoot[Y]||null}stopAllAction(){const o=this._actions;for(let g=this._nActiveActions-1;g>=0;--g)o[g].stop();return this}update(o){o*=this.timeScale;const g=this._actions,j=this._nActiveActions,Y=this.time+=o,ee=Math.sign(o),ie=this._accuIndex^=1;for(let pe=0;pe!==j;++pe)g[pe]._update(Y,o,ee,ie);const se=this._bindings,de=this._nActiveBindings;for(let pe=0;pe!==de;++pe)se[pe].apply(ie);return this}setTime(o){this.time=0;for(let g=0;g<this._actions.length;g++)this._actions[g].time=0;return this.update(o)}getRoot(){return this._root}uncacheClip(o){const g=this._actions,j=o.uuid,Y=this._actionsByClip,ee=Y[j];if(ee!==void 0){const ie=ee.knownActions;for(let se=0,de=ie.length;se!==de;++se){const pe=ie[se];this._deactivateAction(pe);const be=pe._cacheIndex,Ce=g[g.length-1];pe._cacheIndex=null,pe._byClipCacheIndex=null,Ce._cacheIndex=be,g[be]=Ce,g.pop(),this._removeInactiveBindingsForAction(pe)}delete Y[j]}}uncacheRoot(o){const g=o.uuid,j=this._actionsByClip;for(const ee in j){const ie=j[ee].actionByRoot[g];ie!==void 0&&(this._deactivateAction(ie),this._removeInactiveAction(ie))}const Y=this._bindingsByRootAndName[g];if(Y!==void 0)for(const ee in Y){const ie=Y[ee];ie.restoreOriginalState(),this._removeInactiveBinding(ie)}}uncacheAction(o,g){const j=this.existingAction(o,g);j!==null&&(this._deactivateAction(j),this._removeInactiveAction(j))}}class Tm{constructor(o){this.value=o}clone(){return new Tm(this.value.clone===void 0?this.value:this.value.clone())}}let qo=0;class Im extends va{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:qo++}),this.name="",this.usage=zo,this.uniforms=[]}add(o){return this.uniforms.push(o),this}remove(o){const g=this.uniforms.indexOf(o);return g!==-1&&this.uniforms.splice(g,1),this}setName(o){return this.name=o,this}setUsage(o){return this.usage=o,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(o){this.name=o.name,this.usage=o.usage;const g=o.uniforms;this.uniforms.length=0;for(let j=0,Y=g.length;j<Y;j++)this.uniforms.push(g[j].clone());return this}clone(){return new this.constructor().copy(this)}}class E_ extends em{constructor(o,g,j=1){super(o,g),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=j}copy(o){return super.copy(o),this.meshPerAttribute=o.meshPerAttribute,this}clone(o){const g=super.clone(o);return g.meshPerAttribute=this.meshPerAttribute,g}toJSON(o){const g=super.toJSON(o);return g.isInstancedInterleavedBuffer=!0,g.meshPerAttribute=this.meshPerAttribute,g}}class Yd{constructor(o,g,j,Y,ee){this.isGLBufferAttribute=!0,this.buffer=o,this.type=g,this.itemSize=j,this.elementSize=Y,this.count=ee,this.version=0}set needsUpdate(o){o===!0&&this.version++}setBuffer(o){return this.buffer=o,this}setType(o,g){return this.type=o,this.elementSize=g,this}setItemSize(o){return this.itemSize=o,this}setCount(o){return this.count=o,this}}class S_{constructor(o,g,j=0,Y=1/0){this.ray=new vu(o,g),this.near=j,this.far=Y,this.camera=null,this.layers=new ad,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(o,g){this.ray.set(o,g)}setFromCamera(o,g){g.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(g.matrixWorld),this.ray.direction.set(o.x,o.y,.5).unproject(g).sub(this.ray.origin).normalize(),this.camera=g):g.isOrthographicCamera?(this.ray.origin.set(o.x,o.y,(g.near+g.far)/(g.near-g.far)).unproject(g),this.ray.direction.set(0,0,-1).transformDirection(g.matrixWorld),this.camera=g):console.error("THREE.Raycaster: Unsupported camera type: "+g.type)}intersectObject(o,g=!0,j=[]){return Pm(o,this,j,g),j.sort(Dm),j}intersectObjects(o,g=!0,j=[]){for(let Y=0,ee=o.length;Y<ee;Y++)Pm(o[Y],this,j,g);return j.sort(Dm),j}}function Dm(ue,o){return ue.distance-o.distance}function Pm(ue,o,g,j){if(ue.layers.test(o.layers)&&ue.raycast(o,g),j===!0){const Y=ue.children;for(let ee=0,ie=Y.length;ee<ie;ee++)Pm(Y[ee],o,g,!0)}}class ef{constructor(o=1,g=0,j=0){return this.radius=o,this.phi=g,this.theta=j,this}set(o,g,j){return this.radius=o,this.phi=g,this.theta=j,this}copy(o){return this.radius=o.radius,this.phi=o.phi,this.theta=o.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(o){return this.setFromCartesianCoords(o.x,o.y,o.z)}setFromCartesianCoords(o,g,j){return this.radius=Math.sqrt(o*o+g*g+j*j),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(o,j),this.phi=Math.acos(Si(g/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class C_{constructor(o=1,g=0,j=0){return this.radius=o,this.theta=g,this.y=j,this}set(o,g,j){return this.radius=o,this.theta=g,this.y=j,this}copy(o){return this.radius=o.radius,this.theta=o.theta,this.y=o.y,this}setFromVector3(o){return this.setFromCartesianCoords(o.x,o.y,o.z)}setFromCartesianCoords(o,g,j){return this.radius=Math.sqrt(o*o+j*j),this.theta=Math.atan2(o,j),this.y=g,this}clone(){return new this.constructor().copy(this)}}const tf=new Bn;class M_{constructor(o=new Bn(1/0,1/0),g=new Bn(-1/0,-1/0)){this.isBox2=!0,this.min=o,this.max=g}set(o,g){return this.min.copy(o),this.max.copy(g),this}setFromPoints(o){this.makeEmpty();for(let g=0,j=o.length;g<j;g++)this.expandByPoint(o[g]);return this}setFromCenterAndSize(o,g){const j=tf.copy(g).multiplyScalar(.5);return this.min.copy(o).sub(j),this.max.copy(o).add(j),this}clone(){return new this.constructor().copy(this)}copy(o){return this.min.copy(o.min),this.max.copy(o.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(o){return this.isEmpty()?o.set(0,0):o.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(o){return this.isEmpty()?o.set(0,0):o.subVectors(this.max,this.min)}expandByPoint(o){return this.min.min(o),this.max.max(o),this}expandByVector(o){return this.min.sub(o),this.max.add(o),this}expandByScalar(o){return this.min.addScalar(-o),this.max.addScalar(o),this}containsPoint(o){return!(o.x<this.min.x||o.x>this.max.x||o.y<this.min.y||o.y>this.max.y)}containsBox(o){return this.min.x<=o.min.x&&o.max.x<=this.max.x&&this.min.y<=o.min.y&&o.max.y<=this.max.y}getParameter(o,g){return g.set((o.x-this.min.x)/(this.max.x-this.min.x),(o.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(o){return!(o.max.x<this.min.x||o.min.x>this.max.x||o.max.y<this.min.y||o.min.y>this.max.y)}clampPoint(o,g){return g.copy(o).clamp(this.min,this.max)}distanceToPoint(o){return tf.copy(o).clamp(this.min,this.max).sub(o).length()}intersect(o){return this.min.max(o.min),this.max.min(o.max),this}union(o){return this.min.min(o.min),this.max.max(o.max),this}translate(o){return this.min.add(o),this.max.add(o),this}equals(o){return o.min.equals(this.min)&&o.max.equals(this.max)}}const Xd=new vt,Kd=new vt;class T_{constructor(o=new vt,g=new vt){this.start=o,this.end=g}set(o,g){return this.start.copy(o),this.end.copy(g),this}copy(o){return this.start.copy(o.start),this.end.copy(o.end),this}getCenter(o){return o.addVectors(this.start,this.end).multiplyScalar(.5)}delta(o){return o.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(o,g){return this.delta(g).multiplyScalar(o).add(this.start)}closestPointToPointParameter(o,g){Xd.subVectors(o,this.start),Kd.subVectors(this.end,this.start);const j=Kd.dot(Kd);let Y=Kd.dot(Xd)/j;return g&&(Y=Si(Y,0,1)),Y}closestPointToPoint(o,g,j){const Y=this.closestPointToPointParameter(o,g);return this.delta(j).multiplyScalar(Y).add(this.start)}applyMatrix4(o){return this.start.applyMatrix4(o),this.end.applyMatrix4(o),this}equals(o){return o.start.equals(this.start)&&o.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const nf=new vt;class C0 extends Ar{constructor(o,g){super(),this.light=o,this.light.updateMatrixWorld(),this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1,this.color=g;const j=new yi,Y=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let ie=0,se=1,de=32;ie<de;ie++,se++){const pe=ie/de*Math.PI*2,be=se/de*Math.PI*2;Y.push(Math.cos(pe),Math.sin(pe),1,Math.cos(be),Math.sin(be),1)}j.setAttribute("position",new ce(Y,3));const ee=new oa({fog:!1,toneMapped:!1});this.cone=new rc(j,ee),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const o=this.light.distance?this.light.distance:1e3,g=o*Math.tan(this.light.angle);this.cone.scale.set(g,g,o),nf.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(nf),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Kc=new vt,Jc=new Yi,M0=new Yi;class rf extends rc{constructor(o){const g=I_(o),j=new yi,Y=[],ee=[],ie=new ci(0,0,1),se=new ci(0,1,0);for(let de=0;de<g.length;de++){const pe=g[de];pe.parent&&pe.parent.isBone&&(Y.push(0,0,0),Y.push(0,0,0),ee.push(ie.r,ie.g,ie.b),ee.push(se.r,se.g,se.b))}j.setAttribute("position",new ce(Y,3)),j.setAttribute("color",new ce(ee,3)),super(j,new oa({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=o,this.bones=g,this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(o){const g=this.bones,j=this.geometry,Y=j.getAttribute("position");M0.copy(this.root.matrixWorld).invert();for(let ee=0,ie=0;ee<g.length;ee++){const se=g[ee];se.parent&&se.parent.isBone&&(Jc.multiplyMatrices(M0,se.matrixWorld),Kc.setFromMatrixPosition(Jc),Y.setXYZ(ie,Kc.x,Kc.y,Kc.z),Jc.multiplyMatrices(M0,se.parent.matrixWorld),Kc.setFromMatrixPosition(Jc),Y.setXYZ(ie+1,Kc.x,Kc.y,Kc.z),ie+=2)}j.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(o)}}function I_(ue){const o=[];ue.isBone===!0&&o.push(ue);for(let g=0;g<ue.children.length;g++)o.push.apply(o,I_(ue.children[g]));return o}class Ly extends lo{constructor(o,g,j){super(new Eh(g,4,2),new wl({wireframe:!0,fog:!1,toneMapped:!1})),this.light=o,this.light.updateMatrixWorld(),this.color=j,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const vx=new vt,T0=new ci,Ny=new ci;class Ax extends Ar{constructor(o,g,j){super(),this.light=o,this.light.updateMatrixWorld(),this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1,this.color=j;const Y=new Hp(g);Y.rotateY(.5*Math.PI),this.material=new wl({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const ee=Y.getAttribute("position"),ie=new Float32Array(3*ee.count);Y.setAttribute("color",new is(ie,3)),this.add(new lo(Y,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const o=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const g=o.geometry.getAttribute("color");T0.copy(this.light.color),Ny.copy(this.light.groundColor);for(let j=0,Y=g.count;j<Y;j++){const ee=j<Y/2?T0:Ny;g.setXYZ(j,ee.r,ee.g,ee.b)}g.needsUpdate=!0}o.lookAt(vx.setFromMatrixPosition(this.light.matrixWorld).negate())}}class Uy extends rc{constructor(o=10,g=10,j=4473924,Y=8947848){j=new ci(j),Y=new ci(Y);const ee=g/2,ie=o/g,se=o/2,de=[],pe=[];for(let Ce=0,xe=0,Ie=-se;Ce<=g;Ce++,Ie+=ie){de.push(-se,0,Ie,se,0,Ie),de.push(Ie,0,-se,Ie,0,se);const Re=Ce===ee?j:Y;Re.toArray(pe,xe),xe+=3,Re.toArray(pe,xe),xe+=3,Re.toArray(pe,xe),xe+=3,Re.toArray(pe,xe),xe+=3}const be=new yi;be.setAttribute("position",new ce(de,3)),be.setAttribute("color",new ce(pe,3)),super(be,new oa({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}class I0 extends rc{constructor(o=10,g=16,j=8,Y=64,ee=4473924,ie=8947848){ee=new ci(ee),ie=new ci(ie);const se=[],de=[];if(g>1)for(let be=0;be<g;be++){const Ce=be/g*(2*Math.PI),xe=Math.sin(Ce)*o,Ie=Math.cos(Ce)*o;se.push(0,0,0),se.push(xe,0,Ie);const Re=1&be?ee:ie;de.push(Re.r,Re.g,Re.b),de.push(Re.r,Re.g,Re.b)}for(let be=0;be<j;be++){const Ce=1&be?ee:ie,xe=o-o/j*be;for(let Ie=0;Ie<Y;Ie++){let Re=Ie/Y*(2*Math.PI),De=Math.sin(Re)*xe,ze=Math.cos(Re)*xe;se.push(De,0,ze),de.push(Ce.r,Ce.g,Ce.b),Re=(Ie+1)/Y*(2*Math.PI),De=Math.sin(Re)*xe,ze=Math.cos(Re)*xe,se.push(De,0,ze),de.push(Ce.r,Ce.g,Ce.b)}}const pe=new yi;pe.setAttribute("position",new ce(se,3)),pe.setAttribute("color",new ce(de,3)),super(pe,new oa({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}}const D0=new vt,mr=new vt,bo=new vt;class Lu extends Ar{constructor(o,g,j){super(),this.light=o,this.light.updateMatrixWorld(),this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1,this.color=j,g===void 0&&(g=1);let Y=new yi;Y.setAttribute("position",new ce([-g,g,0,g,g,0,g,-g,0,-g,-g,0,-g,g,0],3));const ee=new oa({fog:!1,toneMapped:!1});this.lightPlane=new wh(Y,ee),this.add(this.lightPlane),Y=new yi,Y.setAttribute("position",new ce([0,0,0,0,0,1],3)),this.targetLine=new wh(Y,ee),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){D0.setFromMatrixPosition(this.light.matrixWorld),mr.setFromMatrixPosition(this.light.target.matrixWorld),bo.subVectors(mr,D0),this.lightPlane.lookAt(mr),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(mr),this.targetLine.scale.z=bo.length()}}const Nu=new vt,bs=new gd;class Rm extends rc{constructor(o){const g=new yi,j=new oa({color:16777215,vertexColors:!0,toneMapped:!1}),Y=[],ee=[],ie={};function se(Re,De){de(Re),de(De)}function de(Re){Y.push(0,0,0),ee.push(0,0,0),ie[Re]===void 0&&(ie[Re]=[]),ie[Re].push(Y.length/3-1)}se("n1","n2"),se("n2","n4"),se("n4","n3"),se("n3","n1"),se("f1","f2"),se("f2","f4"),se("f4","f3"),se("f3","f1"),se("n1","f1"),se("n2","f2"),se("n3","f3"),se("n4","f4"),se("p","n1"),se("p","n2"),se("p","n3"),se("p","n4"),se("u1","u2"),se("u2","u3"),se("u3","u1"),se("c","t"),se("p","c"),se("cn1","cn2"),se("cn3","cn4"),se("cf1","cf2"),se("cf3","cf4"),g.setAttribute("position",new ce(Y,3)),g.setAttribute("color",new ce(ee,3)),super(g,j),this.type="CameraHelper",this.camera=o,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=ie,this.update();const pe=new ci(16755200),be=new ci(16711680),Ce=new ci(43775),xe=new ci(16777215),Ie=new ci(3355443);this.setColors(pe,be,Ce,xe,Ie)}setColors(o,g,j,Y,ee){const ie=this.geometry.getAttribute("color");ie.setXYZ(0,o.r,o.g,o.b),ie.setXYZ(1,o.r,o.g,o.b),ie.setXYZ(2,o.r,o.g,o.b),ie.setXYZ(3,o.r,o.g,o.b),ie.setXYZ(4,o.r,o.g,o.b),ie.setXYZ(5,o.r,o.g,o.b),ie.setXYZ(6,o.r,o.g,o.b),ie.setXYZ(7,o.r,o.g,o.b),ie.setXYZ(8,o.r,o.g,o.b),ie.setXYZ(9,o.r,o.g,o.b),ie.setXYZ(10,o.r,o.g,o.b),ie.setXYZ(11,o.r,o.g,o.b),ie.setXYZ(12,o.r,o.g,o.b),ie.setXYZ(13,o.r,o.g,o.b),ie.setXYZ(14,o.r,o.g,o.b),ie.setXYZ(15,o.r,o.g,o.b),ie.setXYZ(16,o.r,o.g,o.b),ie.setXYZ(17,o.r,o.g,o.b),ie.setXYZ(18,o.r,o.g,o.b),ie.setXYZ(19,o.r,o.g,o.b),ie.setXYZ(20,o.r,o.g,o.b),ie.setXYZ(21,o.r,o.g,o.b),ie.setXYZ(22,o.r,o.g,o.b),ie.setXYZ(23,o.r,o.g,o.b),ie.setXYZ(24,g.r,g.g,g.b),ie.setXYZ(25,g.r,g.g,g.b),ie.setXYZ(26,g.r,g.g,g.b),ie.setXYZ(27,g.r,g.g,g.b),ie.setXYZ(28,g.r,g.g,g.b),ie.setXYZ(29,g.r,g.g,g.b),ie.setXYZ(30,g.r,g.g,g.b),ie.setXYZ(31,g.r,g.g,g.b),ie.setXYZ(32,j.r,j.g,j.b),ie.setXYZ(33,j.r,j.g,j.b),ie.setXYZ(34,j.r,j.g,j.b),ie.setXYZ(35,j.r,j.g,j.b),ie.setXYZ(36,j.r,j.g,j.b),ie.setXYZ(37,j.r,j.g,j.b),ie.setXYZ(38,Y.r,Y.g,Y.b),ie.setXYZ(39,Y.r,Y.g,Y.b),ie.setXYZ(40,ee.r,ee.g,ee.b),ie.setXYZ(41,ee.r,ee.g,ee.b),ie.setXYZ(42,ee.r,ee.g,ee.b),ie.setXYZ(43,ee.r,ee.g,ee.b),ie.setXYZ(44,ee.r,ee.g,ee.b),ie.setXYZ(45,ee.r,ee.g,ee.b),ie.setXYZ(46,ee.r,ee.g,ee.b),ie.setXYZ(47,ee.r,ee.g,ee.b),ie.setXYZ(48,ee.r,ee.g,ee.b),ie.setXYZ(49,ee.r,ee.g,ee.b),ie.needsUpdate=!0}update(){const o=this.geometry,g=this.pointMap;bs.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),qs("c",g,o,bs,0,0,-1),qs("t",g,o,bs,0,0,1),qs("n1",g,o,bs,-1,-1,-1),qs("n2",g,o,bs,1,-1,-1),qs("n3",g,o,bs,-1,1,-1),qs("n4",g,o,bs,1,1,-1),qs("f1",g,o,bs,-1,-1,1),qs("f2",g,o,bs,1,-1,1),qs("f3",g,o,bs,-1,1,1),qs("f4",g,o,bs,1,1,1),qs("u1",g,o,bs,.7,1.1,-1),qs("u2",g,o,bs,-.7,1.1,-1),qs("u3",g,o,bs,0,2,-1),qs("cf1",g,o,bs,-1,0,1),qs("cf2",g,o,bs,1,0,1),qs("cf3",g,o,bs,0,-1,1),qs("cf4",g,o,bs,0,1,1),qs("cn1",g,o,bs,-1,0,-1),qs("cn2",g,o,bs,1,0,-1),qs("cn3",g,o,bs,0,-1,-1),qs("cn4",g,o,bs,0,1,-1),o.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function qs(ue,o,g,j,Y,ee,ie){Nu.set(Y,ee,ie).unproject(j);const se=o[ue];if(se!==void 0){const de=g.getAttribute("position");for(let pe=0,be=se.length;pe<be;pe++)de.setXYZ(se[pe],Nu.x,Nu.y,Nu.z)}}const Bm=new so;class P0 extends rc{constructor(o,g=16776960){const j=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),Y=new Float32Array(24),ee=new yi;ee.setIndex(new is(j,1)),ee.setAttribute("position",new is(Y,3)),super(ee,new oa({color:g,toneMapped:!1})),this.object=o,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(o){if(o!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Bm.setFromObject(this.object),Bm.isEmpty())return;const g=Bm.min,j=Bm.max,Y=this.geometry.attributes.position,ee=Y.array;ee[0]=j.x,ee[1]=j.y,ee[2]=j.z,ee[3]=g.x,ee[4]=j.y,ee[5]=j.z,ee[6]=g.x,ee[7]=g.y,ee[8]=j.z,ee[9]=j.x,ee[10]=g.y,ee[11]=j.z,ee[12]=j.x,ee[13]=j.y,ee[14]=g.z,ee[15]=g.x,ee[16]=j.y,ee[17]=g.z,ee[18]=g.x,ee[19]=g.y,ee[20]=g.z,ee[21]=j.x,ee[22]=g.y,ee[23]=g.z,Y.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(o){return this.object=o,this.update(),this}copy(o,g){return super.copy(o,g),this.object=o.object,this}}class D_ extends rc{constructor(o,g=16776960){const j=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),Y=new yi;Y.setIndex(new is(j,1)),Y.setAttribute("position",new ce([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(Y,new oa({color:g,toneMapped:!1})),this.box=o,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(o){const g=this.box;g.isEmpty()||(g.getCenter(this.position),g.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(o))}}class Fy extends wh{constructor(o,g=1,j=16776960){const Y=j,ee=new yi;ee.setAttribute("position",new ce([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),ee.computeBoundingSphere(),super(ee,new oa({color:Y,toneMapped:!1})),this.type="PlaneHelper",this.plane=o,this.size=g;const ie=new yi;ie.setAttribute("position",new ce([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),ie.computeBoundingSphere(),this.add(new lo(ie,new wl({color:Y,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(o){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(o)}}const R0=new vt;let sf,Jd;class Ps extends Ar{constructor(o=new vt(0,0,1),g=new vt(0,0,0),j=1,Y=16776960,ee=.2*j,ie=.2*ee){super(),this.type="ArrowHelper",sf===void 0&&(sf=new yi,sf.setAttribute("position",new ce([0,0,0,0,1,0],3)),Jd=new Bd(0,.5,1,5,1),Jd.translate(0,-.5,0)),this.position.copy(g),this.line=new wh(sf,new oa({color:Y,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new lo(Jd,new wl({color:Y,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(o),this.setLength(j,ee,ie)}setDirection(o){if(o.y>.99999)this.quaternion.set(0,0,0,1);else if(o.y<-.99999)this.quaternion.set(1,0,0,0);else{R0.set(o.z,0,-o.x).normalize();const g=Math.acos(o.y);this.quaternion.setFromAxisAngle(R0,g)}}setLength(o,g=.2*o,j=.2*g){this.line.scale.set(1,Math.max(1e-4,o-g),1),this.line.updateMatrix(),this.cone.scale.set(j,g,j),this.cone.position.y=o,this.cone.updateMatrix()}setColor(o){this.line.material.color.set(o),this.cone.material.color.set(o)}copy(o){return super.copy(o,!1),this.line.copy(o.line),this.cone.copy(o.cone),this}}class $d extends rc{constructor(o=1){const g=[0,0,0,o,0,0,0,0,0,0,o,0,0,0,0,0,0,o],j=new yi;j.setAttribute("position",new ce(g,3)),j.setAttribute("color",new ce([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(j,new oa({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(o,g,j){const Y=new ci,ee=this.geometry.attributes.color.array;return Y.set(o),Y.toArray(ee,0),Y.toArray(ee,3),Y.set(g),Y.toArray(ee,6),Y.toArray(ee,9),Y.set(j),Y.toArray(ee,12),Y.toArray(ee,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Dl{constructor(){this.type="ShapePath",this.color=new ci,this.subPaths=[],this.currentPath=null}moveTo(o,g){return this.currentPath=new Vp,this.subPaths.push(this.currentPath),this.currentPath.moveTo(o,g),this}lineTo(o,g){return this.currentPath.lineTo(o,g),this}quadraticCurveTo(o,g,j,Y){return this.currentPath.quadraticCurveTo(o,g,j,Y),this}bezierCurveTo(o,g,j,Y,ee,ie){return this.currentPath.bezierCurveTo(o,g,j,Y,ee,ie),this}splineThru(o){return this.currentPath.splineThru(o),this}toShapes(o,g){function j(Ve){const $e=[];for(let ct=0,dt=Ve.length;ct<dt;ct++){const ft=Ve[ct],Bt=new kd;Bt.curves=ft.curves,$e.push(Bt)}return $e}function Y(Ve,$e){const ct=$e.length;let dt=!1;for(let ft=ct-1,Bt=0;Bt<ct;ft=Bt++){let Lt=$e[ft],Wt=$e[Bt],qt=Wt.x-Lt.x,Ot=Wt.y-Lt.y;if(Math.abs(Ot)>Number.EPSILON){if(Ot<0&&(Lt=$e[Bt],qt=-qt,Wt=$e[ft],Ot=-Ot),Ve.y<Lt.y||Ve.y>Wt.y)continue;if(Ve.y===Lt.y){if(Ve.x===Lt.x)return!0}else{const En=Ot*(Ve.x-Lt.x)-qt*(Ve.y-Lt.y);if(En===0)return!0;if(En<0)continue;dt=!dt}}else{if(Ve.y!==Lt.y)continue;if(Wt.x<=Ve.x&&Ve.x<=Lt.x||Lt.x<=Ve.x&&Ve.x<=Wt.x)return!0}}return dt}const ee=Oo.isClockWise,ie=this.subPaths;if(ie.length===0)return[];if(g===!0)return j(ie);let se,de,pe;const be=[];if(ie.length===1)return de=ie[0],pe=new kd,pe.curves=de.curves,be.push(pe),be;let Ce=!ee(ie[0].getPoints());Ce=o?!Ce:Ce;const xe=[],Ie=[];let Re,De,ze=[],je=0;Ie[je]=void 0,ze[je]=[];for(let Ve=0,$e=ie.length;Ve<$e;Ve++)de=ie[Ve],Re=de.getPoints(),se=ee(Re),se=o?!se:se,se?(!Ce&&Ie[je]&&je++,Ie[je]={s:new kd,p:Re},Ie[je].s.curves=de.curves,Ce&&je++,ze[je]=[]):ze[je].push({h:de,p:Re[0]});if(!Ie[0])return j(ie);if(Ie.length>1){let Ve=!1,$e=0;for(let ct=0,dt=Ie.length;ct<dt;ct++)xe[ct]=[];for(let ct=0,dt=Ie.length;ct<dt;ct++){const ft=ze[ct];for(let Bt=0;Bt<ft.length;Bt++){const Lt=ft[Bt];let Wt=!0;for(let qt=0;qt<Ie.length;qt++)Y(Lt.p,Ie[qt].p)&&(ct!==qt&&$e++,Wt?(Wt=!1,xe[qt].push(Lt)):Ve=!0);Wt&&xe[ct].push(Lt)}}$e>0&&Ve===!1&&(ze=xe)}for(let Ve=0,$e=Ie.length;Ve<$e;Ve++){pe=Ie[Ve].s,be.push(pe),De=ze[Ve];for(let ct=0,dt=De.length;ct<dt;ct++)pe.holes.push(De[ct].h)}return be}}const Yo=of();function of(){const ue=new ArrayBuffer(4),o=new Float32Array(ue),g=new Uint32Array(ue),j=new Uint32Array(512),Y=new Uint32Array(512);for(let de=0;de<256;++de){const pe=de-127;pe<-27?(j[de]=0,j[256|de]=32768,Y[de]=24,Y[256|de]=24):pe<-14?(j[de]=1024>>-pe-14,j[256|de]=1024>>-pe-14|32768,Y[de]=-pe-1,Y[256|de]=-pe-1):pe<=15?(j[de]=pe+15<<10,j[256|de]=pe+15<<10|32768,Y[de]=13,Y[256|de]=13):pe<128?(j[de]=31744,j[256|de]=64512,Y[de]=24,Y[256|de]=24):(j[de]=31744,j[256|de]=64512,Y[de]=13,Y[256|de]=13)}const ee=new Uint32Array(2048),ie=new Uint32Array(64),se=new Uint32Array(64);for(let de=1;de<1024;++de){let pe=de<<13,be=0;for(;!(8388608&pe);)pe<<=1,be-=8388608;pe&=-8388609,be+=947912704,ee[de]=pe|be}for(let de=1024;de<2048;++de)ee[de]=939524096+(de-1024<<13);for(let de=1;de<31;++de)ie[de]=de<<23;ie[31]=1199570944,ie[32]=2147483648;for(let de=33;de<63;++de)ie[de]=2147483648+(de-32<<23);ie[63]=3347054592;for(let de=1;de<64;++de)de!==32&&(se[de]=1024);return{floatView:o,uint32View:g,baseTable:j,shiftTable:Y,mantissaTable:ee,exponentTable:ie,offsetTable:se}}var jy=Object.freeze({__proto__:null,toHalfFloat:function(ue){Math.abs(ue)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),ue=Si(ue,-65504,65504),Yo.floatView[0]=ue;const o=Yo.uint32View[0],g=o>>23&511;return Yo.baseTable[g]+((8388607&o)>>Yo.shiftTable[g])},fromHalfFloat:function(ue){const o=ue>>10;return Yo.uint32View[0]=Yo.mantissaTable[Yo.offsetTable[o]+(1023&ue)]+Yo.exponentTable[o],Yo.floatView[0]}});function zy(){console.error("THREE.ImmediateRenderObject has been removed.")}class Vy extends Aa{constructor(o,g,j){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.'),super(o,g,j),this.samples=4}}class Gy extends lh{constructor(o,g,j,Y){console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),super(o,g,j,Y)}}class P_ extends ch{constructor(o,g,j,Y){console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),super(o,g,j,Y)}}class Pl extends Eu{constructor(o,g,j,Y,ee,ie){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(o,g,j,Y,ee,ie)}}class R_ extends sc{constructor(o,g,j,Y){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(o,g,j,Y)}}class km extends Gp{constructor(o,g,j,Y){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(o,g,j,Y)}}class Rl extends br{constructor(o,g,j,Y,ee,ie,se){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(o,g,j,Y,ee,ie,se)}}class Om extends Bd{constructor(o,g,j,Y,ee,ie,se,de){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(o,g,j,Y,ee,ie,se,de)}}class $c extends Qp{constructor(o,g){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(o,g)}}class af extends Nd{constructor(o,g){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(o,g)}}class B_ extends fm{constructor(o,g){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(o,g)}}class k_ extends Gc{constructor(o,g,j,Y){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(o,g,j,Y)}}class B0 extends Hp{constructor(o,g){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(o,g)}}class lf extends _d{constructor(o,g,j,Y){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(o,g,j,Y)}}class Lm extends Qc{constructor(o,g,j,Y){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(o,g,j,Y)}}class k0 extends Wp{constructor(o,g,j,Y,ee,ie){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(o,g,j,Y,ee,ie)}}class Qy extends la{constructor(o,g){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(o,g)}}class Uu extends Eh{constructor(o,g,j,Y,ee,ie,se){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(o,g,j,Y,ee,ie,se)}}class Hy extends mm{constructor(o,g){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(o,g)}}class Wy extends gm{constructor(o,g,j,Y,ee){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(o,g,j,Y,ee)}}class cf extends qp{constructor(o,g,j,Y,ee,ie){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(o,g,j,Y,ee,ie)}}class O0 extends ca{constructor(o,g,j,Y,ee){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(o,g,j,Y,ee)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:_}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=_)},553:function(Te,te,oe){oe.d(te,{_:function(){return ve}});var _=oe(988);const ae=new WeakMap;class ve extends _.aNw{constructor(ke){super(ke),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(ke){return this.decoderPath=ke,this}setDecoderConfig(ke){return this.decoderConfig=ke,this}setWorkerLimit(ke){return this.workerLimit=ke,this}load(ke,Le,Ye,tt){const Ke=new _.hH6(this.manager);Ke.setPath(this.path),Ke.setResponseType("arraybuffer"),Ke.setRequestHeader(this.requestHeader),Ke.setWithCredentials(this.withCredentials),Ke.load(ke,Ge=>{this.decodeDracoFile(Ge,Le).catch(tt)},Ye,tt)}decodeDracoFile(ke,Le,Ye,tt){const Ke={attributeIDs:Ye||this.defaultAttributeIDs,attributeTypes:tt||this.defaultAttributeTypes,useUniqueIDs:!!Ye};return this.decodeGeometry(ke,Ke).then(Le)}decodeGeometry(ke,Le){const Ye=JSON.stringify(Le);if(ae.has(ke)){const Ue=ae.get(ke);if(Ue.key===Ye)return Ue.promise;if(ke.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let tt;const Ke=this.workerNextTaskID++,Ge=ke.byteLength,et=this._getWorker(Ke,Ge).then(Ue=>(tt=Ue,new Promise((nt,He)=>{tt._callbacks[Ke]={resolve:nt,reject:He},tt.postMessage({type:"decode",id:Ke,taskConfig:Le,buffer:ke},[ke])}))).then(Ue=>this._createGeometry(Ue.geometry));return et.catch(()=>!0).then(()=>{tt&&Ke&&this._releaseTask(tt,Ke)}),ae.set(ke,{key:Ye,promise:et}),et}_createGeometry(ke){const Le=new _.u9r;ke.index&&Le.setIndex(new _.TlE(ke.index.array,1));for(let Ye=0;Ye<ke.attributes.length;Ye++){const tt=ke.attributes[Ye],Ke=tt.name,Ge=tt.array,et=tt.itemSize;Le.setAttribute(Ke,new _.TlE(Ge,et))}return Le}_loadLibrary(ke,Le){const Ye=new _.hH6(this.manager);return Ye.setPath(this.decoderPath),Ye.setResponseType(Le),Ye.setWithCredentials(this.withCredentials),new Promise((tt,Ke)=>{Ye.load(ke,tt,void 0,Ke)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const ke=typeof WebAssembly!="object"||this.decoderConfig.type==="js",Le=[];return ke?Le.push(this._loadLibrary("draco_decoder.js","text")):(Le.push(this._loadLibrary("draco_wasm_wrapper.js","text")),Le.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(Le).then(Ye=>{const tt=Ye[0];ke||(this.decoderConfig.wasmBinary=Ye[1]);const Ke=we.toString(),Ge=["/* draco decoder */",tt,"","/* worker */",Ke.substring(Ke.indexOf("{")+1,Ke.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([Ge]))}),this.decoderPending}_getWorker(ke,Le){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const tt=new Worker(this.workerSourceURL);tt._callbacks={},tt._taskCosts={},tt._taskLoad=0,tt.postMessage({type:"init",decoderConfig:this.decoderConfig}),tt.onmessage=function(Ke){const Ge=Ke.data;switch(Ge.type){case"decode":tt._callbacks[Ge.id].resolve(Ge);break;case"error":tt._callbacks[Ge.id].reject(Ge);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+Ge.type+'"')}},this.workerPool.push(tt)}else this.workerPool.sort(function(tt,Ke){return tt._taskLoad>Ke._taskLoad?-1:1});const Ye=this.workerPool[this.workerPool.length-1];return Ye._taskCosts[ke]=Le,Ye._taskLoad+=Le,Ye})}_releaseTask(ke,Le){ke._taskLoad-=ke._taskCosts[Le],delete ke._callbacks[Le],delete ke._taskCosts[Le]}debug(){console.log("Task load: ",this.workerPool.map(ke=>ke._taskLoad))}dispose(){for(let ke=0;ke<this.workerPool.length;++ke)this.workerPool[ke].terminate();return this.workerPool.length=0,this}}function we(){let Me,ke;function Le(Ye,tt,Ke,Ge,et,Ue){const nt=Ue.num_components(),He=Ke.num_points()*nt,Ze=He*et.BYTES_PER_ELEMENT,st=function(bt,Ne){switch(Ne){case Float32Array:return bt.DT_FLOAT32;case Int8Array:return bt.DT_INT8;case Int16Array:return bt.DT_INT16;case Int32Array:return bt.DT_INT32;case Uint8Array:return bt.DT_UINT8;case Uint16Array:return bt.DT_UINT16;case Uint32Array:return bt.DT_UINT32}}(Ye,et),Et=Ye._malloc(Ze);tt.GetAttributeDataArrayForAllPoints(Ke,Ue,st,Ze,Et);const rt=new et(Ye.HEAPF32.buffer,Et,He).slice();return Ye._free(Et),{name:Ge,array:rt,itemSize:nt}}onmessage=function(Ye){const tt=Ye.data;switch(tt.type){case"init":Me=tt.decoderConfig,ke=new Promise(function(et){Me.onModuleLoaded=function(Ue){et({draco:Ue})},DracoDecoderModule(Me)});break;case"decode":const Ke=tt.buffer,Ge=tt.taskConfig;ke.then(et=>{const Ue=et.draco,nt=new Ue.Decoder,He=new Ue.DecoderBuffer;He.Init(new Int8Array(Ke),Ke.byteLength);try{const Ze=function(Et,rt,bt,Ne){const Qe=Ne.attributeIDs,We=Ne.attributeTypes;let _t,lt;const Ut=rt.GetEncodedGeometryType(bt);if(Ut===Et.TRIANGULAR_MESH)_t=new Et.Mesh,lt=rt.DecodeBufferToMesh(bt,_t);else{if(Ut!==Et.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");_t=new Et.PointCloud,lt=rt.DecodeBufferToPointCloud(bt,_t)}if(!lt.ok()||_t.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+lt.error_msg());const dn={index:null,attributes:[]};for(const nn in Qe){const un=self[We[nn]];let Zt,pn;if(Ne.useUniqueIDs)pn=Qe[nn],Zt=rt.GetAttributeByUniqueId(_t,pn);else{if(pn=rt.GetAttributeId(_t,Et[Qe[nn]]),pn===-1)continue;Zt=rt.GetAttribute(_t,pn)}dn.attributes.push(Le(Et,rt,_t,nn,un,Zt))}return Ut===Et.TRIANGULAR_MESH&&(dn.index=function(nn,un,Zt){const pn=3*Zt.num_faces(),ln=4*pn,vn=nn._malloc(ln);un.GetTrianglesUInt32Array(Zt,ln,vn);const ht=new Uint32Array(nn.HEAPF32.buffer,vn,pn).slice();return nn._free(vn),{array:ht,itemSize:1}}(Et,rt,_t)),Et.destroy(_t),dn}(Ue,nt,He,Ge),st=Ze.attributes.map(Et=>Et.array.buffer);Ze.index&&st.push(Ze.index.array.buffer),self.postMessage({type:"decode",id:tt.id,geometry:Ze},st)}catch(Ze){console.error(Ze),self.postMessage({type:"error",id:tt.id,error:Ze.message})}finally{Ue.destroy(He),Ue.destroy(nt)}})}}}}},__webpackgi_module_cache__={};function __webpackgi_require__(Te){var te=__webpackgi_module_cache__[Te];if(te!==void 0)return te.exports;var oe=__webpackgi_module_cache__[Te]={id:Te,exports:{}};return __webpackgi_modules__[Te].call(oe.exports,oe,oe.exports,__webpackgi_require__),oe.exports}__webpackgi_require__.n=function(Te){var te=Te&&Te.__esModule?function(){return Te.default}:function(){return Te};return __webpackgi_require__.d(te,{a:te}),te},__webpackgi_require__.d=function(Te,te){for(var oe in te)__webpackgi_require__.o(te,oe)&&!__webpackgi_require__.o(Te,oe)&&Object.defineProperty(Te,oe,{enumerable:!0,get:te[oe]})},__webpackgi_require__.o=function(Te,te){return Object.prototype.hasOwnProperty.call(Te,te)},__webpackgi_require__.r=function(Te){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(Te,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(Te,"__esModule",{value:!0})},__webpackgi_require__.nc=void 0;var __webpackgi_exports__={};(function(){__webpackgi_require__.d(__webpackgi_exports__,{MWW:function(){return $p},LY2:function(){return _.LY2},GYo:function(){return Cw},HRj:function(){return uu},li4:function(){return XS},FO5:function(){return KS},Nlh:function(){return qS},QvI:function(){return Xi},JHp:function(){return jv},bGH:function(){return _.bGH},NDo:function(){return _.NDo},gSk:function(){return _.gSk},WMw:function(){return _.WMw},OTo:function(){return _.OTo},Se2:function(){return _.Se2},cum:function(){return _.cum},Mig:function(){return _.Mig},B$7:function(){return IA},i_9:function(){return _.i_9},m7l:function(){return _.m7l},sYA:function(){return _.sYA},Xcj:function(){return _.Xcj},mzJ:function(){return _.mzJ},ZZA:function(){return _.ZZA},$Ph:function(){return Za},T__:function(){return _.T__},HkE:function(){return _.HkE},tGC:function(){return _.tGC},g1S:function(){return Ph},I$C:function(){return H0},QIH:function(){return yr},_JE:function(){return il},SwW:function(){return rf},ksm:function(){return Kn},jl_:function(){return dd},b7R:function(){return Ep},BDV:function(){return Ka},Ea_:function(){return Nf},qff:function(){return dd},tmC:function(){return jc},BON:function(){return Pv},P40:function(){return Mv},wLL:function(){return Yw},iHO:function(){return xg},BbS:function(){return _.BbS},kqm:function(){return _.kqm},Hmr:function(){return _.Hmr},SJI:function(){return _.SJI},mTL:function(){return _.mTL},y8_:function(){return _.y8_},_Li:function(){return _._Li},g56:function(){return Wo},bj3:function(){return Li},z81:function(){return _.z81},_MY:function(){return _._MY},yEv:function(){return Fm},dFZ:function(){return pm},N$j:function(){return _.N$j},_YM:function(){return _._YM},TUj:function(){return _.TUj},ZzF:function(){return _.ZzF},qzb:function(){return nn},GQ:function(){return _.GQ},nvb:function(){return _.nvb},DvJ:function(){return _.DvJ},fQA:function(){return _.fQA},cPz:function(){return Jf},TlE:function(){return _.TlE},u9r:function(){return _.u9r},s4_:function(){return _.s4_},T95:function(){return _.T95},F5w:function(){return ow},NlP:function(){return Sw},$8Z:function(){return op},YYN:function(){return rp},CtF:function(){return _.CtF},V1s:function(){return _.V1s},jOv:function(){return ta},Rki:function(){return _.Rki},pzV:function(){return Ow},itZ:function(){return Vs},qKx:function(){return ys},vlJ:function(){return $0},nPO:function(){return Nh},zcQ:function(){return Ey},GH1:function(){return Pu},ROQ:function(){return _.ROQ},YN5:function(){return _.YN5},BVQ:function(){return _.BVQ},YT8:function(){return _.YT8},_DE:function(){return C_},YGz:function(){return _.YGz},trn:function(){return _.trn},zf8:function(){return _.zf8},uWy:function(){return _.uWy},wYQ:function(){return Ml},SUY:function(){return _.SUY},Ilk:function(){return _.Ilk},R2R:function(){return _.R2R},epp:function(){return _.epp},xmJ:function(){return fc},GD$:function(){return xu},EB7:function(){return _.EB7},DqL:function(){return _.DqL},_3:function(){return _._3},b_z:function(){return _.b_z},OCn:function(){return Uh},_am:function(){return _._am},kB7:function(){return UA},fY$:function(){return _.fY$},vxC:function(){return _.vxC},BtG:function(){return _.BtG},cBK:function(){return _.cBK},g8_:function(){return _.g8_},AXT:function(){return _.AXT},yj7:function(){return _.yj7},dYG:function(){return _.dYG},tm_:function(){return _.tm_},S2y:function(){return _.S2y},B02:function(){return _.B02},PeU:function(){return _.PeU},Hyl:function(){return _.Hyl},Wqd:function(){return _.Wqd},Xaj:function(){return _.Xaj},DUb:function(){return ua},dZ3:function(){return _.dZ3},m_w:function(){return _.m_w},fHI:function(){return _.fHI},LBq:function(){return _.LBq},dHf:function(){return WS},Qww:function(){return dh.Q},CGV:function(){return q_},JUT:function(){return _.JUT},p3g:function(){return _.p3g},IEO:function(){return _.IEO},CN8:function(){return _.CN8},zob:function(){return _.zob},yxD:function(){return _.yxD},CUS:function(){return rb},A5E:function(){return _.A5E},zqG:function(){return Ma},PfX:function(){return Sp},Q1o:function(){return ko},jfJ:function(){return _.jfJ},T_J:function(){return _.T_J},tEQ:function(){return _.tEQ},gb4:function(){return rs},qkB:function(){return _.qkB},cvk:function(){return Sh},HWo:function(){return Gd},brP:function(){return _.brP},$YQ:function(){return _.$YQ},X8d:function(){return vA},Zdt:function(){return J1},yNB:function(){return hs},h7x:function(){return zs},Ox3:function(){return _.Ox3},qtn:function(){return Ad},cBI:function(){return _.cBI},cU9:function(){return _.cU9},DT1:function(){return _.DT1},Kgo:function(){return _.Kgo},ehD:function(){return _.ehD},fhJ:function(){return BA},y1s:function(){return Vf},fSK:function(){return _.fSK},Vdb:function(){return _.Vdb},l8J:function(){return _.l8J},dj0:function(){return _.dj0},QM0:function(){return _.QM0},OIS:function(){return Ct},q8b:function(){return lm},TOt:function(){return _.TOt},xaN:function(){return Ge},Ny0:function(){return _.Ny0},NeD:function(){return I1},Zof:function(){return Cg},eD:function(){return _.eD},jwo:function(){return _.jwo},dSO:function(){return _.dSO},Bf4:function(){return _.Bf4},USm:function(){return _.USm},pBf:function(){return _.pBf},eBg:function(){return HM},$Vf:function(){return _.$Vf},O7d:function(){return _.O7d},ksq:function(){return Um},gXf:function(){return g0},hH6:function(){return _.hH6},kpi:function(){return Kd},DwZ:function(){return $o},kN3:function(){return eE},e62:function(){return _.e62},a$l:function(){return _.a$l},OM3:function(){return _.OM3},VzW:function(){return _.VzW},ybr:function(){return _.ybr},yo9:function(){return _.yo9},$Bt:function(){return sc},Wzm:function(){return _.Wzm},Wl3:function(){return _.Wl3},iWj:function(){return _.iWj},DNz:function(){return Mu},m1M:function(){return Or},ylh:function(){return _.ylh},v9Y:function(){return _.v9Y},LSk:function(){return _.LSk},LHE:function(){return Os},KE0:function(){return Jx},KCF:function(){return jS},a4n:function(){return Ix},zIH:function(){return vt},Hfk:function(){return gu},png:function(){return vo},tAj:function(){return Bc},Eb_:function(){return Hl},BT2:function(){return z0},_8p:function(){return SE},V5Z:function(){return ky},s5b:function(){return b_},hkn:function(){return dg},GFY:function(){return Sl},w$m:function(){return _.w$m},ksN:function(){return _.ksN},j4z:function(){return _.j4z},OAl:function(){return _.OAl},VLJ:function(){return _.VLJ},C73:function(){return Ta},ZAu:function(){return _.ZAu},ibP:function(){return fd},_fI:function(){return xu},hUN:function(){return cc},cLu:function(){return _.cLu},vmT:function(){return _.vmT},Qpg:function(){return _.Qpg},So8:function(){return _.So8},eOv:function(){return Pw},Wjw:function(){return _.Wjw},cJO:function(){return _.cJO},QRU:function(){return _.QRU},S3k:function(){return _.S3k},PpQ:function(){return _.PpQ},AHu:function(){return _.AHu},q_9:function(){return _s},ZRs:function(){return _.ZRs},oqc:function(){return _.oqc},T_x:function(){return Ds},lb7:function(){return _.lb7},L5s:function(){return _.L5s},$TI:function(){return _.$TI},SPe:function(){return _.SPe},aVm:function(){return _.aVm},j87:function(){return _.j87},RNb:function(){return _.RNb},Kz5:function(){return _.Kz5},vpT:function(){return _.vpT},kB5:function(){return _.kB5},_C8:function(){return _._C8},Syv:function(){return _.Syv},NMF:function(){return _.NMF},pIN:function(){return _.pIN},eMJ:function(){return _.eMJ},rN7:function(){return f_},iUp:function(){return m_},GFd:function(){return Xo},x5V:function(){return _.x5V},tUh:function(){return _.tUh},z8B:function(){return _.z8B},vcl:function(){return qo},GZb:function(){return _.GZb},p7y:function(){return _.p7y},S9g:function(){return _.S9g},Zr5:function(){return _.Zr5},vCF:function(){return _.vCF},yt0:function(){return _.yt0},uXU:function(){return _.uXU},_kC:function(){return _._kC},lk7:function(){return _.lk7},USc:function(){return Rw},x12:function(){return _.x12},Zzh:function(){return _.Zzh},nls:function(){return _.nls},g_z:function(){return _.g_z},U7:function(){return _.U7},FT0:function(){return _.FT0},blk:function(){return _.blk},ejS:function(){return _.ejS},rnI:function(){return _.rnI},wem:function(){return _.wem},lfu:function(){return _.lfu},FDw:function(){return _.FDw},lRj:function(){return _.lRj},D1R:function(){return _.D1R},qyh:function(){return _.qyh},GUF:function(){return _.GUF},EoG:function(){return _.EoG},aNw:function(){return _.aNw},Zp0:function(){return _.Zp0},lLk:function(){return _.lLk},jAl:function(){return _.jAl},uEv:function(){return _.uEv},YKA:function(){return _.YKA},cRx:function(){return _.cRx},Y8D:function(){return _.Y8D},RsA:function(){return _.RsA},Y0m:function(){return tb},F5T:function(){return _.F5T},EDU:function(){return Wb},z$Q:function(){return ng},KA8:function(){return tr},XUj:function(){return iw},Me$:function(){return vf},u7G:function(){return _.u7G},PEk:function(){return hu},BG4:function(){return r1},M8C:function(){return _.M8C},Vkp:function(){return _.Vkp},yGw:function(){return _.yGw},Sm8:function(){return _.Sm8},Kj0:function(){return _.Kj0},vBJ:function(){return _.vBJ},QfV:function(){return zo},lRF:function(){return _.lRF},Lun:function(){return _.Lun},YBo:function(){return _.YBo},kaV:function(){return _.kaV},RSm:function(){return _.RSm},xoR:function(){return _.xoR},EJi:function(){return _.EJi},Wid:function(){return _.Wid},iuj:function(){return jo},IKL:function(){return _.IKL},r_:function(){return _.r_},OoA:function(){return _.OoA},qhX:function(){return _.qhX},qPT:function(){return Gf},M5h:function(){return _.M5h},Ns1:function(){return _.Ns1},TyD:function(){return _.TyD},vZf:function(){return _.vZf},HTd:function(){return _.HTd},aH4:function(){return _.aH4},YLQ:function(){return _.YLQ},BVF:function(){return _.BVF},MyG:function(){return _.MyG},jFi:function(){return _.jFi},aCh:function(){return _.aCh},uL9:function(){return _.uL9},TNj:function(){return ca},IFH:function(){return _.IFH},bdR:function(){return _.bdR},RPs:function(){return Jm},kM_:function(){return FA},M6v:function(){return _.M6v},RvT:function(){return _.RvT},dUE:function(){return _.dUE},oe_:function(){return V_},BuN:function(){return Bl},Tme:function(){return _.Tme},N9P:function(){return _p},Gql:function(){return _.Gql},$XY:function(){return od},O9d:function(){return GA},zEO:function(){return oh},qfx:function(){return Vh},PA7:function(){return _.PA7},REq:function(){return _.REq},pQR:function(){return _.pQR},ghN:function(){return _.ghN},Hy8:function(){return _.Hy8},Wpd:function(){return _.Wpd},LgZ:function(){return _.LgZ},iWC:function(){return _.iWC},mqn:function(){return L2},SKe:function(){return jr},iKG:function(){return _.iKG},rCq:function(){return zb},_iA:function(){return _._iA},ntZ:function(){return _.ntZ},anP:function(){return _.anP},X2e:function(){return VS},FCo:function(){return Wu},y$t:function(){return _.y$t},cPb:function(){return _.cPb},lmx:function(){return br},JOQ:function(){return _.JOQ},BKK:function(){return _.BKK},_12:function(){return _._12},tJx:function(){return _.tJx},cek:function(){return _.cek},qD0:function(){return Ov},xG9:function(){return _.xG9},wI8:function(){return cp},Sgv:function(){return tE},woe:function(){return _.woe},UY4:function(){return _.UY4},aq0:function(){return _.aq0},ujx:function(){return _.ujx},Uol:function(){return _.Uol},JiH:function(){return oA},VYz:function(){return _.VYz},_Pm:function(){return Wd},EsW:function(){return Ho},iUV:function(){return _.iUV},tf:function(){return _.tf},ZQ6:function(){return _.ZQ6},mXe:function(){return _.mXe},_fP:function(){return _._fP},iLg:function(){return _.iLg},zbs:function(){return _.zbs},UZH:function(){return _.UZH},mSO:function(){return _.mSO},wk1:function(){return _.wk1},E2K:function(){return _.E2K},FUD:function(){return _.FUD},pKu:function(){return _.pKu},GG6:function(){return _.GG6},Gih:function(){return _.Gih},iiP:function(){return _.iiP},SvJ:function(){return _.SvJ},ptH:function(){return _.ptH},jZA:function(){return _.jZA},y2t:function(){return _.y2t},gi4:function(){return _.gi4},Djp:function(){return _.Djp},BG$:function(){return _.BG$},NYV:function(){return _.NYV},xJs:function(){return _.xJs},bsb:function(){return _.bsb},ekQ:function(){return _.ekQ},CaW:function(){return _.CaW},eaV:function(){return _.eaV},BFQ:function(){return _.BFQ},v3W:function(){return _.v3W},ILR:function(){return _.ILR},UCm:function(){return _.UCm},Inb:function(){return _.Inb},U1$:function(){return ln},LgE:function(){return _.LgE},fto:function(){return _.fto},l0P:function(){return _.l0P},vCx:function(){return _.vCx},_AM:function(){return _._AM},wuA:function(){return _.wuA},av9:function(){return _.av9},CtA:function(){return _.CtA},BvQ:function(){return um},FZJ:function(){return lc},FIo:function(){return _.FIo},zHn:function(){return _.zHn},iMs:function(){return _.iMs},T_f:function(){return _.T_f},hEm:function(){return _.hEm},D9w:function(){return _.D9w},sHH:function(){return Hc},CdI:function(){return _.CdI},rkc:function(){return up},rpg:function(){return _.rpg},ce8:function(){return _.ce8},rOj:function(){return _.rOj},P6m:function(){return j0},JA6:function(){return eb},V4E:function(){return _.V4E},o8S:function(){return _.o8S},flB:function(){return gl},DUH:function(){return vI},KI_:function(){return _.KI_},iLN:function(){return Ug},rz_:function(){return ip},jsw:function(){return Tl},srG:function(){return rw},i6Z:function(){return Lg},vfv:function(){return V0},xsS:function(){return _.xsS},or:function(){return Bw},EQj:function(){return tl},ov0:function(){return Wv},WdD:function(){return _.WdD},Vj0:function(){return _.Vj0},jyz:function(){return _.jyz},mTM:function(){return lu},Mn1:function(){return ga},Hlq:function(){return Fs},Fi7:function(){return Va},Tn7:function(){return _.Tn7},bnF:function(){return _.bnF},HW6:function(){return _.HW6},oa8:function(){return _.oa8},T_1:function(){return _.T_1},zHJ:function(){return bc},iDF:function(){return _.iDF},iAb:function(){return _.iAb},d4E:function(){return Ny},lBg:function(){return Iw},JeJ:function(){return Ax},FKY:function(){return oe},zlZ:function(){return G0},vkg:function(){return va},brh:function(){return yE},kZK:function(){return wc},puG:function(){return Dw},OdW:function(){return _.OdW},_YX:function(){return _._YX},TUv:function(){return _.TUv},Hw6:function(){return _.Hw6},aLr:function(){return _.aLr},Aip:function(){return _.Aip},xo$:function(){return _.xo$},bIn:function(){return N2},$V:function(){return _.$V},lDi:function(){return _.lDi},gti:function(){return _.gti},PMe:function(){return _.PMe},iwP:function(){return kv},FvO:function(){return _.FvO},jyi:function(){return _.jyi},xeV:function(){return _.xeV},k74:function(){return _.k74},RlZ:function(){return _.RlZ},KhW:function(){return _.KhW},HgB:function(){return _.HgB},W2J:function(){return _.W2J},JWc:function(){return _.JWc},u37:function(){return _.u37},Z6B:function(){return _.Z6B},QZ1:function(){return _.QZ1},Ir4:function(){return _.Ir4},NwF:function(){return _.NwF},Wbm:function(){return _.Wbm},N4l:function(){return _.N4l},ej9:function(){return Af},QmN:function(){return _.QmN},IOt:function(){return _.IOt},NOD:function(){return Yp},L5g:function(){return _.L5g},H$k:function(){return _.H$k},cuP:function(){return Jo},xEZ:function(){return _.xEZ},dpR:function(){return _.dpR},wOD:function(){return la},KNb:function(){return PA},IiN:function(){return x_},Cne:function(){return _.Cne},XvJ:function(){return _.XvJ},XZw:function(){return _.XZw},FE5:function(){return _.FE5},lVp:function(){return Qc},CJI:function(){return _.CJI},z$h:function(){return _.z$h},UlW:function(){return _.UlW},WwZ:function(){return _.WwZ},Lcc:function(){return _.Lcc},WXh:function(){return _.WXh},Vjr:function(){return M1},LuM:function(){return aE},LP5:function(){return VM},xfE:function(){return _.xfE},qlB:function(){return _.qlB},lCJ:function(){return _.lCJ},WTc:function(){return _.WTc},rAo:function(){return _.rAo},LZj:function(){return Oy},xWb:function(){return _.xWb},gH0:function(){return _.gH0},rBU:function(){return _.rBU},rDY:function(){return _.rDY},ywz:function(){return _.ywz},wJv:function(){return _.wJv},JQ4:function(){return _.JQ4},k0A:function(){return _.k0A},irR:function(){return _.irR},LsT:function(){return _.LsT},q5h:function(){return vd},TKh:function(){return TA},tyg:function(){return Ig},Ro5:function(){return yo},dwk:function(){return _.dwk},FM8:function(){return _.FM8},Pa4:function(){return _.Pa4},Ltg:function(){return _.Ltg},yC1:function(){return _.yC1},lHq:function(){return vm},fO1:function(){return _.fO1},oMA:function(){return Zl},JzW:function(){return Te},QEt:function(){return S_},b5g:function(){return _.b5g},Ywn:function(){return _.Ywn},GVz:function(){return _.GVz},oAp:function(){return _.oAp},kFz:function(){return _.kFz},p7A:function(){return _.p7A},dd2:function(){return _.dd2},CP7:function(){return _.CP7},fQK:function(){return _.fQK},Wd$:function(){return T0},t1_:function(){return dE},Uk6:function(){return _.Uk6},_sL:function(){return _._sL},Pnf:function(){return _.Pnf},c8b:function(){return _.c8b},_lf:function(){return _._lf},ad5:function(){return _.ad5},sZV:function(){return Xw},TfA:function(){return qw},sKX:function(){return jf},UdM:function(){return Ff},P0y:function(){return lo},L_r:function(){return _.L_r},Bve:function(){return I_},UeO:function(){return ql},$nx:function(){return Dx},Bk6:function(){return yl},EER:function(){return Tm},y4l:function(){return vp},pQ0:function(){return Bv},wXW:function(){return uC},r5x:function(){return aC},MSI:function(){return pC},EUu:function(){return F2},jtH:function(){return zp},T0T:function(){return Vp},gAb:function(){return jw},iwT:function(){return Gc},je_:function(){return WM},wBP:function(){return s_},LU2:function(){return Zf},wQL:function(){return j2},Zs7:function(){return $b},sMc:function(){return Ks},x7s:function(){return MC},Mnd:function(){return V2},A0_:function(){return G2},d73:function(){return Xb},HCD:function(){return hi},RG9:function(){return $n},G2P:function(){return Yg},XLf:function(){return Jv},CGN:function(){return Kv},RGi:function(){return mp},mvg:function(){return $_},Hiy:function(){return qa},XMc:function(){return lC},N7M:function(){return sC},iv:function(){return hC},n55:function(){return Pa},IaC:function(){return vc},h9t:function(){return $v},yDW:function(){return em},gJv:function(){return gh},l$g:function(){return ZC},vQi:function(){return LM},$MY:function(){return Ca},wJl:function(){return Fv},Z7Y:function(){return qg},X7D:function(){return ny},BnX:function(){return Xv},uZ5:function(){return Cd},zVI:function(){return iC},DpF:function(){return Ga},nNb:function(){return Lf},cqZ:function(){return pd},pKN:function(){return Fb},d_$:function(){return zA},DdI:function(){return $x},rrX:function(){return jb},KlC:function(){return jA},KVn:function(){return pn},oau:function(){return _1},aw9:function(){return as},Aap:function(){return Ir},Dxg:function(){return Et},MjT:function(){return io},F7Q:function(){return Yv},IFq:function(){return _E},IJl:function(){return qv},O5A:function(){return au},wCn:function(){return ma},gGT:function(){return ey},pEc:function(){return HS},Bi6:function(){return $h},fi_:function(){return PC},TT:function(){return EI},q2Z:function(){return P2},NyK:function(){return dr},bgu:function(){return Mf},kcS:function(){return th},rRN:function(){return B1},ivY:function(){return Qe},_s1:function(){return K2},_HO:function(){return Mn},tpL:function(){return Pn},DMK:function(){return a0},LjN:function(){return SA},iFs:function(){return Uf},qTg:function(){return He},Wtl:function(){return Fa},DmK:function(){return sa},Htt:function(){return KM},Hx7:function(){return bn},imt:function(){return Bi},US6:function(){return nv},vZs:function(){return VA},TE$:function(){return Q2},lmu:function(){return ts},SvO:function(){return zl},YQY:function(){return Tu},mZN:function(){return $f},VvG:function(){return ty},omp:function(){return JC},utz:function(){return Z_},TFV:function(){return Vc},hrz:function(){return rt},JKM:function(){return f1},jZf:function(){return mE},RjL:function(){return nE},RRI:function(){return SC},RUq:function(){return $C},_t4:function(){return Ec},YHh:function(){return ou},R8g:function(){return vn},Bbl:function(){return Ev},V9r:function(){return Ze},PZ2:function(){return st},w7A:function(){return et},N6S:function(){return en},Uxp:function(){return Cn},tAz:function(){return Jt},R$F:function(){return Je},N33:function(){return Vt},gw2:function(){return Lv},KlU:function(){return ht},rfc:function(){return If},wo6:function(){return Do},H4P:function(){return Ne},swA:function(){return wg},_Z3:function(){return md},ivc:function(){return Lf},rZ1:function(){return pd},CpZ:function(){return DC},dyc:function(){return We},MxZ:function(){return OI},btp:function(){return LI},mXy:function(){return D1},Ej0:function(){return ls},ep4:function(){return Bs},DQP:function(){return Ss},VNr:function(){return po},V7q:function(){return na},zEk:function(){return mo},qfq:function(){return cs},piB:function(){return Ut},IIc:function(){return U2},rrF:function(){return wu},naq:function(){return zc},sXR:function(){return Up},p5I:function(){return r_},wps:function(){return zw},wuo:function(){return vE},GpE:function(){return Ue},F4b:function(){return Fp},t$v:function(){return hl},tdn:function(){return Ud},Y9t:function(){return Cy},GEo:function(){return Wg},DH3:function(){return cC},uxM:function(){return $S},zH3:function(){return ZS},MLs:function(){return yd},xXG:function(){return Er},YM4:function(){return cm},B3r:function(){return gE},iAx:function(){return Z0},lDn:function(){return Rt},oaQ:function(){return Hg},CD7:function(){return Ah},Rc0:function(){return Op},iPG:function(){return e_},TIc:function(){return Mc},xsC:function(){return fC},zOc:function(){return ia},r46:function(){return AC},z2C:function(){return lt},_X$:function(){return pg},_yn:function(){return nh},Dyg:function(){return eh},cUc:function(){return rh},zGw:function(){return $g},Ctq:function(){return p1},$ch:function(){return H2},k5b:function(){return ev},kZl:function(){return Kb},OCg:function(){return g1},YjH:function(){return CC},Ui8:function(){return CE},YD2:function(){return Xg},vi9:function(){return XM},ij3:function(){return oC},YPW:function(){return rC},Bg1:function(){return k2},kon:function(){return bt},M3g:function(){return Sd},F2z:function(){return Ac},pJF:function(){return KC},knz:function(){return _.knz},Ejo:function(){return nt},BgY:function(){return ki},qCG:function(){return kt},HD9:function(){return qn},fEB:function(){return Zr},Udc:function(){return _r},ZQg:function(){return Sr},ofC:function(){return Rn},yRy:function(){return Tc},_NL:function(){return Ly},LCA:function(){return Fr},j1w:function(){return _l},i8J:function(){return $2},p7C:function(){return gs},ZAS:function(){return jd},ipH:function(){return W2},$TF:function(){return $M},uZI:function(){return q2},VWG:function(){return i1},pQ7:function(){return Am},STw:function(){return Iu},jc8:function(){return cu},BL_:function(){return eg},S6:function(){return J2},T8U:function(){return Mg},TD6:function(){return $l},akS:function(){return s1},QKE:function(){return eC},dKx:function(){return _t},OvX:function(){return qM},VsW:function(){return eo},YMc:function(){return JM},aPg:function(){return ji},LFn:function(){return Tf},wey:function(){return ul},MaE:function(){return lr},s4x:function(){return ml},FJA:function(){return vr},vIA:function(){return Xs},Spv:function(){return ur},w8l:function(){return su},riG:function(){return cr},Kbh:function(){return Ha},BFq:function(){return Ju},t8K:function(){return ai},Q7n:function(){return Xn},KGF:function(){return fo},e5:function(){return ot},Rik:function(){return Mp},GZo:function(){return Rv},Bds:function(){return El},HTu:function(){return gd},cTq:function(){return ro},X_Y:function(){return bd},dA8:function(){return Uv},bwS:function(){return d1},Lks:function(){return Y2},Rvq:function(){return YM},P4F:function(){return yI},Pd0:function(){return so},Pjo:function(){return h1},Tum:function(){return ya},dRH:function(){return oo},RX0:function(){return Gl},reQ:function(){return X2},cWm:function(){return dC},NC9:function(){return JS},$Re:function(){return Tg},Xo9:function(){return Dv},LNO:function(){return Eu},iZP:function(){return Su}});var Te,te={};__webpackgi_require__.r(te),__webpackgi_require__.d(te,{AsyncCompress:function(){return Sn},AsyncDecompress:function(){return xn},AsyncDeflate:function(){return En},AsyncGunzip:function(){return Ci},AsyncGzip:function(){return Sn},AsyncInflate:function(){return Wn},AsyncUnzipInflate:function(){return $y},AsyncUnzlib:function(){return _n},AsyncZipDeflate:function(){return Yy},AsyncZlib:function(){return tn},Compress:function(){return Gn},DecodeUTF8:function(){return Wr},Decompress:function(){return Xt},Deflate:function(){return Ot},EncodeUTF8:function(){return rl},Gunzip:function(){return nr},Gzip:function(){return Gn},Inflate:function(){return jn},Unzip:function(){return L_},UnzipInflate:function(){return Jy},UnzipPassThrough:function(){return Th},Unzlib:function(){return Ht},Zip:function(){return N0},ZipDeflate:function(){return qy},ZipPassThrough:function(){return uf},Zlib:function(){return xt},compress:function(){return Hn},compressSync:function(){return di},decompress:function(){return Nn},decompressSync:function(){return ti},deflate:function(){return Ln},deflateSync:function(){return wn},gunzip:function(){return sr},gunzipSync:function(){return Dt},gzip:function(){return Hn},gzipSync:function(){return di},inflate:function(){return hn},inflateSync:function(){return fn},strFromU8:function(){return qr},strToU8:function(){return zi},unzip:function(){return yx},unzipSync:function(){return N_},unzlib:function(){return it},unzlibSync:function(){return on},zip:function(){return Xy},zipSync:function(){return Ky},zlib:function(){return Qt},zlibSync:function(){return It}}),function(c){c[c.Error=-2]="Error",c[c.Destroyed=-1]="Destroyed",c[c.None=0]="None",c[c.Running=1]="Running",c[c.Paused=2]="Paused"}(Te||(Te={}));class oe{constructor(){this._eventListeners={},this.dispatchEvent=this.dispatchEvent.bind(this),this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.hasEventListener=this.hasEventListener.bind(this)}addEventListener(e,i){const s=this._eventListeners;s[e]===void 0&&(s[e]=[]),s[e].includes(i)||s[e].push(i)}hasEventListener(e,i){const s=this._eventListeners;return s[e]!==void 0&&s[e].includes(i)}removeEventListener(e,i){const s=this._eventListeners[e];if(s!==void 0){const a=s.indexOf(i);a!==-1&&s.splice(a,1)}}dispatchEvent(e){const i=this._eventListeners[e.type];if(i!==void 0){e.target=this;const s=i.slice(0);for(let a=0,h=s.length;a<h;a++)s[a].call(this,e)}}}var _=__webpackgi_require__(988);const ae={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.a *= opacity;


		}`};class ve{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const we=new _.iKG(-1,1,1,-1,0,1),Me=new _.u9r;Me.setAttribute("position",new _.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),Me.setAttribute("uv",new _.a$l([0,2,0,0,2,0],2));class ke{constructor(e){this._mesh=new _.Kj0(Me,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,we)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class Le extends ve{constructor(e,i){super(),this.textureID=i!==void 0?i:"tDiffuse",e instanceof _.jyz?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=_.rDY.clone(e.uniforms),this.material=new _.jyz({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new ke(this.material),this.useExistingRenderTarget=!1}render(e,i,s){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=s.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(this.useExistingRenderTarget||e.setRenderTarget(i),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}}class Ye extends ve{constructor(e,i){super(),this.scene=e,this.camera=i,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,i,s){const a=e.getContext(),h=e.state;let d,b;h.buffers.color.setMask(!1),h.buffers.depth.setMask(!1),h.buffers.color.setLocked(!0),h.buffers.depth.setLocked(!0),this.inverse?(d=0,b=1):(d=1,b=0),h.buffers.stencil.setTest(!0),h.buffers.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),h.buffers.stencil.setFunc(a.ALWAYS,d,4294967295),h.buffers.stencil.setClear(b),h.buffers.stencil.setLocked(!0),e.setRenderTarget(s),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),h.buffers.color.setLocked(!1),h.buffers.depth.setLocked(!1),h.buffers.stencil.setLocked(!1),h.buffers.stencil.setFunc(a.EQUAL,1,4294967295),h.buffers.stencil.setOp(a.KEEP,a.KEEP,a.KEEP),h.buffers.stencil.setLocked(!0)}}class tt extends ve{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}new _.iKG(-1,1,1,-1,0,1);const Ke=new _.u9r;Ke.setAttribute("position",new _.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),Ke.setAttribute("uv",new _.a$l([0,2,0,0,2,0],2));class Ge extends class{constructor(e,i){if(this.renderer=e,i===void 0){const s=e.getSize(new _.FM8);this._pixelRatio=e.getPixelRatio(),this._width=s.width,this._height=s.height,(i=new _.dd2(this._width*this._pixelRatio,this._height*this._pixelRatio)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=i.width,this._height=i.height;this.renderTarget1=i,this.renderTarget2=i.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],ae===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),Le===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new Le(ae),this.clock=new _.SUY}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,i){this.passes.splice(i,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const i=this.passes.indexOf(e);i!==-1&&this.passes.splice(i,1)}isLastEnabledPass(e){for(let i=e+1;i<this.passes.length;i++)if(this.passes[i].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const i=this.renderer.getRenderTarget();let s=!1;for(let a=0,h=this.passes.length;a<h;a++){const d=this.passes[a];if(d.enabled!==!1){if(d.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(a),d.render(this.renderer,this.writeBuffer,this.readBuffer,e,s),d.needsSwap){if(s){const b=this.renderer.getContext(),X=this.renderer.state.buffers.stencil;X.setFunc(b.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),X.setFunc(b.EQUAL,1,4294967295)}this.swapBuffers()}Ye!==void 0&&(d instanceof Ye?s=!0:d instanceof tt&&(s=!1))}}this.renderer.setRenderTarget(i)}reset(e){if(e===void 0){const i=this.renderer.getSize(new _.FM8);this._pixelRatio=this.renderer.getPixelRatio(),this._width=i.width,this._height=i.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,i){this._width=e,this._height=i;const s=this._width*this._pixelRatio,a=this._height*this._pixelRatio;this.renderTarget1.setSize(s,a),this.renderTarget2.setSize(s,a);for(let h=0;h<this.passes.length;h++)this.passes[h].setSize(s,a)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}{constructor(e,i){super(e,i)}setPixelRatio(e,i=!0){const s=this.setSize;i||(this.setSize=()=>{}),super.setPixelRatio(e),i||(this.setSize=s)}}function et(c,e){let i;do i=Object.getOwnPropertyDescriptor(c,e);while(!i&&(c=Object.getPrototypeOf(c)));return i}function Ue(c,e,i=!1,s=!1){const a=et(c,e);return!!(a!=null&&a.set)||i&&(a==null?void 0:a.writable)!==!1&&(a==null?void 0:a.get)===void 0||s&&!a}function nt(c,e,i,s=!1,a=!1){return!(!c||!Ue(c,e,s,a)||(c[e]=i,0))}function He(c,e){for(;c.length>0;){if(!e)return;const i=c.splice(0,1)[0];if(!(i.length<1)){if(!(i in e))return console.error("invalid access, check",i,e),e;e=e[i]}}return e}function Ze(c,e){return Object.keys(c).find(i=>c[i]===e)}function st(c,...e){return typeof c=="function"&&(c=c(...e)),c}function Et(c,e,i){for(const s of i){const a=c[s];a!==void 0&&nt(e,s,a,!0)}}function rt(c){return c.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}function bt(c,e,i){return c.replace(new RegExp(rt(e),"g"),i)}const Ne=(c,...e)=>String.raw({raw:c},...e),Qe=(c,...e)=>String.raw({raw:c},...e),We=(c,...e)=>String.raw({raw:c},...e),_t=(c,...e)=>{let i=String.raw({raw:c},...e);return i=bt(i,"%","%25"),i=bt(i,"> <","><"),i=bt(i,"; }",";}"),i=bt(i,"<","%3c"),i=bt(i,">","%3e"),i=bt(i,'"',"'"),i=bt(i,"#","%23"),i=bt(i,"{","%7b"),i=bt(i,"}","%7d"),i=bt(i,"|","%7c"),i=bt(i,"^","%5e"),i=bt(i,"`","%60"),i=bt(i,"@","%40"),i=bt(i,"&","&amp;"),i=bt(i,`
`,"%0A"),"data:image/svg+xml;charset=UTF-8,"+i};function lt(c){if(!c)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return(e,i)=>{let s=e[i];Object.defineProperty(e,i,{get:()=>s,set(a){var h;if(s===a)return;s=a;const d=[i,a];if(typeof c=="string")(h=this[c])===null||h===void 0||h.call(this,...d);else if(typeof c=="function"){let b=!1;if(c.name){let X=this;for(;X;){if(X[c.name]===c){c.call(this,...d),b=!0;break}X=Object.getPrototypeOf(X)}}b||(c.name&&this[c.name].name===`bound ${c.name}`?this[c.name](...d):c(...d))}}})}}function Ut(c,e){for(const i of e)if(!c.includes(i))return!1;return!0}String.prototype.replaceAll||(String.prototype.replaceAll=function(c,e){return Object.prototype.toString.call(c).toLowerCase()==="[object regexp]"?this.replace(c,e):this.replace(new RegExp(c,"g"),e)});class dn{constructor(e=0,i=0){dn.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,s=this.y,a=e.elements;return this.x=a[0]*i+a[3]*s+a[6],this.y=a[1]*i+a[4]*s+a[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampLength(e,i){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(i,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,s=this.y-e.y;return i*i+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,s){return this.x=e.x+(i.x-e.x)*s,this.y=e.y+(i.y-e.y)*s,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){const s=Math.cos(i),a=Math.sin(i),h=this.x-e.x,d=this.y-e.y;return this.x=h*s-d*a+e.x,this.y=h*a+d*s+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class nn extends _.ZzF{expandByObject(e,i=!1,s=!1){var a;if(((a=e.userData)===null||a===void 0?void 0:a.bboxVisible)===!1)return this;if(!e.visible&&s)return this;e.updateWorldMatrix(!1,!1);const h=e.geometry;if(h!==void 0)if(i&&h.attributes!=null&&h.attributes.position!==void 0){const b=h.attributes.position;for(let X=0,$=b.count;X<$;X++)Zt.fromBufferAttribute(b,X).applyMatrix4(e.matrixWorld),this.expandByPoint(Zt)}else h.boundingBox===null&&h.computeBoundingBox(),un.copy(h.boundingBox),un.applyMatrix4(e.matrixWorld),this.union(un);const d=e.children;for(let b=0,X=d.length;b<X;b++)this.expandByObject(d[b],i,s);return this}expandByObjects(e,i=!1,s=!1){for(let a=0,h=e.length;a<h;a++)this.expandByObject(e[a],i,s);return this}getPoints(){return[new _.Pa4(this.min.x,this.min.y,this.min.z),new _.Pa4(this.min.x,this.min.y,this.max.z),new _.Pa4(this.min.x,this.max.y,this.min.z),new _.Pa4(this.min.x,this.max.y,this.max.z),new _.Pa4(this.max.x,this.min.y,this.min.z),new _.Pa4(this.max.x,this.min.y,this.max.z),new _.Pa4(this.max.x,this.max.y,this.min.z),new _.Pa4(this.max.x,this.max.y,this.max.z)]}getScreenSpaceBounds(e){const i=this.getPoints(),s=new _.TUj;for(const a of i){const h=a.project(e);s.min.min(h),s.max.max(h)}return s}}const un=new nn,Zt=new _.Pa4;function pn(c,e){let i,s;if(Array.isArray(c))for(const h of c){const d=pn(h,e);i===void 0||s===void 0?(i=d.min.clone(),s=d.max.clone()):(i.min(d.min),s.max(d.max))}const a=c;if(a.geometry!==void 0){const h=a.geometry.vertices;if(h===void 0&&a.geometry.attributes!==void 0&&"position"in a.geometry.attributes){const d=new _.Pa4,b=a.geometry.attributes.position;for(let X=0;X<b.count*b.itemSize;X+=b.itemSize){d.set(b.array[X],b.array[X+1],b.array[3]);const $=d.applyMatrix4(c.matrixWorld).project(e),Z=new dn($.x,$.y);i===void 0||s===void 0?(i=Z.clone(),s=Z.clone()):(i.min(Z),s.max(Z))}}else for(const d of h){const b=d.clone().applyMatrix4(c.matrixWorld).project(e),X=new dn(b.x,b.y);i===void 0||s===void 0?(i=X.clone(),s=X.clone()):(i.min(X),s.max(X))}}if(c.children!==void 0)for(const h of c.children){const d=pn(h,e);i===void 0||s===void 0?(i=d.min.clone(),s=d.max.clone()):(i.min(d.min),s.max(d.max))}return new _.TUj(i,s)}const ln=3005;function vn(c){switch(c){case _.rnI:return["Linear","( value )"];case _.knz:return["sRGB","( value )"];case ln:return["RGBM","( value, 16.0 )"];default:return console.warn("utils: Unsupported encoding:",c),["Linear","( value )"]}}function ht(c,e){let i;return c&&c.isTexture?i=c.encoding:c&&c.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),i=c.texture.encoding):i=_.rnI,e&&c&&c.isTexture&&c.format===_.wk1&&c.type===_.ywz&&c.encoding===_.knz&&(i=_.rnI),i}function Jt(c,e){const i=vn(e);return"vec4 "+c+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function en(c,e,i){return Jt(c+"TexelToLinear",ht(e,i))+`
`}function Cn(c,e){return Jt(c+"TexelToLinear",e)+`
`}function Vt(c,e){const i=vn(e);return"vec4 "+c+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function Je(c,e,i){return Vt(c,ht(e,i))}function ot({uniforms:c,propKey:e,thisTarget:i=!1}={}){const s=!!c,a=!!e,h=i;return(d,b)=>{const X=$=>{const Z=h?$:s?c:$.uniforms||$._uniforms;let re=a?e:b;h&&(re="_"+re);let le=Z[re];return le||(le={value:null},Z[re]=le),le};Object.defineProperty(d,b,{get(){return X(this).value},set($){X(this).value=$,nt(this,"uniformsNeedUpdate",!0,!0)}})}}function Rt(c,e,i=!1,s){const a=!!e,h=!!c;return(d,b)=>{const X=$=>({t:a?e:$.defines||$._defines,p:h?c:b});Object.defineProperty(d,b,{get(){const{t:$,p:Z}=X(i?this:this.material);return $[Z]},set($){const{t:Z,p:re}=X(i?this:this.material);if(nt(Z,re,$,!0),typeof s=="function"){const le=[re,$];if(s.name){const he=this[s.name];he===s?s.call(this,...le):he.name===`bound ${s.name}`?he(...le):s(...le)}else s(...le)}else nt(i?this:this.material,"needsUpdate",!0,!0)}})}}function Mn(c){const e=new _.IEO(new Uint8Array([Math.floor(255*c.r),Math.floor(255*c.g),Math.floor(255*c.b),255]),1,1,_.wk1,_.ywz);return e.needsUpdate=!0,e.encoding=_.rnI,e}function Pn(c){const e=new _.IEO(new Uint8Array([Math.floor(255*c.x),Math.floor(255*c.y),Math.floor(255*c.z),Math.floor(255*c.w)]),1,1,_.wk1,_.ywz);return e.needsUpdate=!0,e}function Rn(c,e,i){const s=c.userData,{backgroundRender:a,transparentRender:h,shadowMapRender:d,mainRenderPass:b,opaqueRender:X,transmissionRender:$,sceneRender:Z,screenSpaceRendering:re}=s;e.backgroundRender!==void 0&&(s.backgroundRender=e.backgroundRender),e.transparentRender!==void 0&&(s.transparentRender=e.transparentRender),e.shadowMapRender!==void 0&&(s.shadowMapRender=e.shadowMapRender),e.mainRenderPass!==void 0&&(s.mainRenderPass=e.mainRenderPass),e.opaqueRender!==void 0&&(s.opaqueRender=e.opaqueRender),e.sceneRender!==void 0&&(s.sceneRender=e.sceneRender),e.transmissionRender!==void 0&&(s.transmissionRender=e.transmissionRender),e.screenSpaceRendering!==void 0&&(s.screenSpaceRendering=e.screenSpaceRendering),i(),s.backgroundRender=a,s.transparentRender=h,s.shadowMapRender=d,s.mainRenderPass=b,s.opaqueRender=X,s.sceneRender=Z,s.transmissionRender=$,s.screenSpaceRendering=re}function hi(c){const e=new nn().expandByObject(c,!0,!0).getCenter(new _.Pa4);c.position.sub(e),c.updateMatrix(),c.userData.autoCentered=!0,c.userData.isCentered=!0}function $n(c,e){const i=.5*new nn().expandByObject(c,!0,!0).getSize(new _.Pa4).length();e===void 0&&(e=c.userData.autoScaleRadius||1);const s=e/i;return isFinite(s)&&(c.userData.pseudoCentered?c.children.forEach(a=>{a.scale.multiplyScalar(s)}):c.scale.multiplyScalar(s),c.userData.isCentered&&c.position.multiplyScalar(s),c.traverse(a=>{var h,d;a.isLight&&(!((d=(h=a.shadow)===null||h===void 0?void 0:h.camera)===null||d===void 0)&&d.right)&&(a.shadow.camera.right*=s,a.shadow.camera.left*=s,a.shadow.camera.top*=s,a.shadow.camera.bottom*=s),a.isCamera&&a.right&&(a.right*=s,a.left*=s,a.top*=s,a.bottom*=s)}),c.userData.autoScaled=!0,c.userData.autoScaleRadius=e,c.dispatchEvent({type:"objectUpdate"})),c}function ji(c,e=-1){return function(i,s=1e-4){const a=s>0;s=Math.max(s,Number.EPSILON);const h={},d=i.getIndex(),b=i.getAttribute("position"),X=d?d.count:b.count;let $=0;const Z=Object.keys(i.attributes),re={},le={},he=[],fe=["getX","getY","getZ","getW"];for(let ye=0,ge=Z.length;ye<ge;ye++){const Pe=Z[ye];re[Pe]=[];const Be=i.morphAttributes[Pe];Be&&(le[Pe]=new Array(Be.length).fill().map(()=>[]))}const me=Math.log10(1/s),Ee=Math.pow(10,me);for(let ye=0;ye<X;ye++){const ge=d?d.getX(ye):ye;let Pe="";for(let Be=0,Oe=Z.length;Be<Oe&&a;Be++){const Fe=Z[Be],Xe=i.getAttribute(Fe),at=Xe.itemSize;for(let mt=0;mt<at;mt++)Pe+=~~(Xe[fe[mt]](ge)*Ee)+","}if(a&&Pe in h)he.push(h[Pe]);else{for(let Be=0,Oe=Z.length;Be<Oe;Be++){const Fe=Z[Be],Xe=i.getAttribute(Fe),at=i.morphAttributes[Fe],mt=Xe.itemSize,wt=re[Fe],At=le[Fe];for(let Tt=0;Tt<mt;Tt++){const yt=fe[Tt];if(wt.push(Xe[yt](ge)),at)for(let St=0,Ft=at.length;St<Ft;St++)At[St].push(at[St][yt](ge))}}a&&(h[Pe]=$),he.push($),$++}}const Ae=i.clone();for(let ye=0,ge=Z.length;ye<ge;ye++){const Pe=Z[ye],Be=i.getAttribute(Pe),Oe=new Be.array.constructor(re[Pe]),Fe=new _.TlE(Oe,Be.itemSize,Be.normalized);if(Ae.setAttribute(Pe,Fe),Pe in le)for(let Xe=0;Xe<le[Pe].length;Xe++){const at=i.morphAttributes[Pe][Xe],mt=new at.array.constructor(le[Pe][Xe]),wt=new _.TlE(mt,at.itemSize,at.normalized);Ae.morphAttributes[Pe][Xe]=wt}}return Ae.setIndex(he),Ae}(c,e)}class Li extends oe{constructor({animationLoop:e,canvas:i,alpha:s=!0,targetOptions:a}){super(),this._isWebGL2=!1,this._trackedTargets=[],this.dirty=!0,this._lastTime=0,this.frameWaitTime=0,this._passes=[],this._pipeline=[],this._passesNeedsUpdate=!0,this._displayCanvasScaling=1,this._renderSize=new _.FM8(512,512),this._frameCount=0,this._tempTargets={},this.maxTempPerKey=5,this._animationLoop=this._animationLoop.bind(this),this._processNewTarget=this._processNewTarget.bind(this),this._processNewTempTarget=this._processNewTempTarget.bind(this),this.trackTarget=this.trackTarget.bind(this),this.disposeTarget=this.disposeTarget.bind(this),this.createTarget=this.createTarget.bind(this),this.createTargetCustom=this.createTargetCustom.bind(this),this._renderer=new _.CP7({canvas:i,antialias:!0,alpha:s,premultipliedAlpha:!1,preserveDrawingBuffer:!0}),this._renderer.baseRenderer=this,this._renderer.setAnimationLoop(this._animationLoop),this._context=this._renderer.getContext(),this._isWebGL2=this._renderer.capabilities.isWebGL2,this._renderSize=new _.FM8(i.clientWidth,i.clientHeight),this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling),this._renderer.toneMapping=_.uL9,this._renderer.toneMappingExposure=1,this._renderer.outputEncoding=_.rnI,this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=_._iA,this._renderer.shadowMap.autoUpdate=!1,this.resetShadows(),this._composerTarget=this.createTarget(a,!1),this._composerTarget.texture.name="EffectComposer.rt1",this._composer=new Ge(this._renderer,this._composerTarget),e&&this.addEventListener("animationLoop",e)}get composer(){return this._composer}get passes(){return this._passes}get isWebGL2(){return this._isWebGL2}get composerTarget(){return this._composerTarget}get renderSize(){return this._renderSize}get displayCanvasScaling(){return this._displayCanvasScaling}set displayCanvasScaling(e){e!==this._displayCanvasScaling&&(this._displayCanvasScaling=e,this.setSize(void 0,void 0,!0))}get frameCount(){return this._frameCount}set pipeline(e){this._pipeline=e,this._passesNeedsUpdate=!0}get pipeline(){return this._pipeline}refreshPipeline(){var e,i,s;const a=this._passes,h=[],d={};for(const b of a){if(b.enabled===!1)continue;const X={after:(e=b.after)!==null&&e!==void 0?e:[],before:(i=b.before)!==null&&i!==void 0?i:[],dependencies:new Set((s=b.required)!==null&&s!==void 0?s:[])};d[b.passId]=X}for(const[b,X]of Object.entries(d)){const $=new Set([...X.after,...X.before]);X.dependencies.forEach(Z=>$.has(Z)&&$.delete(Z)),$.forEach(Z=>{const re=d[Z];if(re){if(re.dependencies.has(b))throw console.error("cyclic",b,Z),"Cyclic dependency";X.dependencies.add(Z)}})}for(;;){let b=!1;const X=[...Object.entries(d)];for(const[$,Z]of X)if(!h.includes($)&&Ut(h,Z.dependencies.values())){const re=Math.max(-1,...Z.after.map(he=>h.indexOf(he))),le=Math.min(h.length,...Z.before.map(he=>{const fe=h.indexOf(he);return fe<0?h.length:fe}));if(re>=le)throw console.error(Z,a,h,re,le),"Not possible";h.splice(Z.after.length>0?re+1:le,0,$),b=!0,delete d[$]}if(Object.keys(d).length<1)break;if(!b)throw console.error(X,d,h),"Not possible 2"}return this.pipeline=h,this.pipeline}get context(){return this._context}get rendererObject(){return this._renderer}_animationLoop(e,i){const s=e-this._lastTime;this._lastTime=e,this.frameWaitTime-=s,this.frameWaitTime>0||(this.frameWaitTime=0,this.dispatchEvent({type:"animationLoop",deltaTime:s,time:e,renderer:this,xrFrame:i}))}get clock(){return this._composer.clock}registerPass(e,i=!0){var s;if(i)for(const a of[...this._passes])e.passId===a.passId&&this.unregisterPass(a);this._passes.push(e),(s=e.onRegister)===null||s===void 0||s.call(e,this),this._passesNeedsUpdate=!0,this._updated()}unregisterPass(e){var i;const s=this._passes.indexOf(e);s>=0&&((i=e.onUnregister)===null||i===void 0||i.call(e,this),this._passes.splice(s,1),this._passesNeedsUpdate=!0,this._updated())}setSize(e,i,s=!1){!s&&(e?Math.abs(e-this._renderSize.width):0)+(i?Math.abs(i-this._renderSize.height):0)<.1||(e&&(this._renderSize.width=e),i&&(this._renderSize.height=i),this.rendererObject.xr.enabled||(this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling)),this._composer.setPixelRatio(this._displayCanvasScaling,!1),this._composer.setSize(this._renderSize.width,this._renderSize.height),this._trackedTargets.forEach(a=>{const h=a,d=h.sizeMultiplier;if(d){const b=this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*d);h.setSize(b.width,b.height)}}),this.dispatchEvent({type:"resize"}),this._updated(),this.reset())}blit(e,i,{viewport:s,material:a,shader:h,pass:d,clear:b=!0}={}){const X=this._composer.copyPass,{renderToScreen:$,material:Z,uniforms:re,clear:le}=X;a&&(X.material=a);const he=this._renderer.getViewport(new _.Ltg),fe=this._renderer.autoClear,me=this._renderer.getRenderTarget();s&&this._renderer.setViewport(new _.Ltg().fromArray(s)),this._renderer.autoClear=!1,X.uniforms=X.material.uniforms,X.renderToScreen=!1,X.clear=b,Rn(this._renderer,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!0,transmissionRender:!1},()=>{X.render(this._renderer,i??null,{texture:e},0,!1)}),X.renderToScreen=$,X.clear=le,X.material=Z,X.uniforms=re,this._renderer.autoClear=fe,s&&this._renderer.setViewport(he),this._renderer.setRenderTarget(me)}clearColor({r:e,g:i,b:s,a,target:h,depth:d=!0,stencil:b=!0}){var X;const $=this._renderer.getClearColor(new _.Ilk),Z=this._renderer.getClearAlpha();this._renderer.setClearAlpha(a??Z),this._renderer.setClearColor(new _.Ilk(e??$.r,i??$.g,s??$.b));const re=this._renderer.getRenderTarget(),le=this._renderer.getActiveCubeFace(),he=this._renderer.getActiveMipmapLevel();this._renderer.setRenderTarget((X=h)!==null&&X!==void 0?X:null),this._renderer.clear(!0,d,b),this._renderer.setRenderTarget(re,le,he),this._renderer.setClearColor($),this._renderer.setClearAlpha(Z)}renderModel(e,i){this._renderer.render(e.modelObject,i.cameraObject)}renderScene(e){const i=e.activeCamera;i&&this.renderModel(e,i)}_updated(){this.dispatchEvent({type:"update"})}render(){var e;this._passesNeedsUpdate&&this.refreshPasses();for(const i of this._passes)i.passObject.enabled&&((e=i.update)===null||e===void 0||e.call(i));this._composer.render(),this._frameCount+=1,this.dirty=!1}updateDirty(){this.dirty=this.dirty||this._passes.findIndex(e=>e.dirty)>=0}reset(){this._frameCount=0,this.dirty=!0}resetShadows(){this._renderer.shadowMap.needsUpdate=!0}refreshPasses(){if(!this._passesNeedsUpdate)return;this._passesNeedsUpdate=!1;const e=[];for(const i of this._pipeline){const s=this._passes.find(a=>a.passId===i);s?e.push(s.passObject):console.warn("Unable to find pass: ",i)}[...this._composer.passes].forEach(i=>this._composer.removePass(i)),e.forEach(i=>this._composer.addPass(i)),this._updated()}dispose(){this._renderer.dispose()}trackTarget(e){this._trackedTargets.push(e)}removeTrackedTarget(e){const i=this._trackedTargets.indexOf(e);i>=0&&this._trackedTargets.splice(i,1)}createTarget({sizeMultiplier:e,samples:i=0,encoding:s=_.rnI,type:a=_.ywz,format:h=_.wk1,depthBuffer:d=!0,depthTexture:b=!1,size:X,textureCount:$=1,...Z}={},re=!0){this.isWebGL2||(i=0),e!==void 0&&X!==void 0&&console.error("Both sizeMultiplier and size are defined. sizeMultiplier will be ignored."),X=X||this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*(e=e||1));const le=b?new _.$YQ(X.width,X.height,_.ywz):void 0,he=this.createTargetCustom($>1?{width:X.width,height:X.height,count:$}:X,{samples:i,encoding:s,type:a,format:h,depthBuffer:d,depthTexture:le},$>1?_.kFz:_.dd2);return this._processNewTarget(he,e,re),this._setTargetOptions(he,Z),he}_processNewTarget(e,i,s){return i!==void 0&&(e.sizeMultiplier=i),s&&this.trackTarget(e),e}disposeTarget(e){if(e){if(e.isTemporary)return this.releaseTempTarget(e);this.removeTrackedTarget(e),e.dispose()}}createTargetCustom({width:e,height:i,count:s},a={},h){var d;const b=this._processNewTarget;let X=[e,i];if(s&&s>1&&X.push(s),(h==null?void 0:h.prototype)===_.oAp.prototype){if(e!==i)throw"Width and height of cube render target must be equal";X=[e]}a={format:_.wk1,minFilter:_.wem,magFilter:_.wem,generateMipmaps:!1,type:_.ywz,encoding:_.rnI,...a};const $=[...X,a];return new class extends((d=h)!==null&&d!==void 0?d:_.dd2){constructor(...Z){super(...Z),Array.isArray(this.texture)?this.texture.forEach(re=>{re.encoding=a.encoding,re.toJSON=()=>({})}):this.texture.toJSON=()=>({})}clone(Z=!0){if(this.isTemporary)throw"Cloning temporary render targets not supported";if(Array.isArray(this.texture))throw"Cloning multiple render targets not supported";const re=super.clone();return re.texture.isRenderTargetTexture=!0,b(re,this.sizeMultiplier||1,Z)}}(...$)}getTempTarget(e={}){var i;const s=dr(e);let a;return!((i=this._tempTargets[s])===null||i===void 0)&&i.length&&(a=this._tempTargets[s].pop()),a?this._setTargetOptions(a,e):(a=this.createTarget(e),this._processNewTempTarget(a,s)),a}_processNewTempTarget(e,i){return e.isTemporary=!0,e.targetKey=i,this._tempTargets[i]===void 0&&(this._tempTargets[i]=[]),e}releaseTempTarget(e){const i=e.targetKey;if(!i||!e.isTemporary)throw"Not a temp target";this._tempTargets[i].length>this.maxTempPerKey?e.dispose():this._tempTargets[i].push(e)}updateShaderProperties(e){return e.uniforms.frameCount?e.uniforms.frameCount.value=this.frameCount:console.warn("BaseRenderer: no uniform: frameCount"),this}_setTargetOptions(e,i){var s,a,h;e.texture.minFilter=(s=i.minFilter)!==null&&s!==void 0?s:_.wem,e.texture.magFilter=(a=i.magFilter)!==null&&a!==void 0?a:_.wem,e.texture.generateMipmaps=(h=i.generateMipmaps)!==null&&h!==void 0&&h,e.texture.generateMipmaps&&e.texture.minFilter===_.wem&&(e.texture.minFilter=_.FDw),e.texture.generateMipmaps||e.texture.minFilter!==_.FDw||(e.texture.minFilter=_.wem)}}function dr(c={}){var e,i;return[c.sizeMultiplier,c.samples,c.encoding,c.type,c.format,c.depthBuffer,c.depthTexture,(e=c.size)===null||e===void 0?void 0:e.width,(i=c.size)===null||i===void 0?void 0:i.height].join(";")}const Ri=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function $t(){const c=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,s=4294967295*Math.random()|0;return(Ri[255&c]+Ri[c>>8&255]+Ri[c>>16&255]+Ri[c>>24&255]+"-"+Ri[255&e]+Ri[e>>8&255]+"-"+Ri[e>>16&15|64]+Ri[e>>24&255]+"-"+Ri[63&i|128]+Ri[i>>8&255]+"-"+Ri[i>>16&255]+Ri[i>>24&255]+Ri[255&s]+Ri[s>>8&255]+Ri[s>>16&255]+Ri[s>>24&255]).toLowerCase()}function ir(c,e,i){return Math.max(e,Math.min(i,c))}function or(c,e,i){return(1-i)*c+i*e}const ms=0,Rr=1,Cr=3,Mr=4,Tr=1006,Is="srgb",pr="srgb-linear";function rr(c){return c<.04045?.0773993808*c:Math.pow(.9478672986*c+.0521327014,2.4)}function ss(c){return c<.0031308?12.92*c:1.055*Math.pow(c,.41666)-.055}const Gr={[Is]:{[pr]:rr},[pr]:{[Is]:ss}},Br={legacyMode:!0,get workingColorSpace(){return pr},set workingColorSpace(c){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(c,e,i){if(this.legacyMode||e===i||!e||!i)return c;if(Gr[e]&&Gr[e][i]!==void 0){const s=Gr[e][i];return c.r=s(c.r),c.g=s(c.g),c.b=s(c.b),c}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(c,e){return this.convert(c,this.workingColorSpace,e)},toWorkingColorSpace:function(c,e){return this.convert(c,e,this.workingColorSpace)}},pa={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Qr={r:0,g:0,b:0},Hs={h:0,s:0,l:0},Ur={h:0,s:0,l:0};function ho(c,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?c+6*(e-c)*i:i<.5?e:i<2/3?c+6*(e-c)*(2/3-i):c}function fa(c,e){return e.r=c.r,e.g=c.g,e.b=c.b,e}class oi{constructor(e,i,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,i===void 0&&s===void 0?this.set(e):this.setRGB(e,i,s)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,i="srgb"){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Br.toWorkingColorSpace(this,i),this}setRGB(e,i,s,a="srgb-linear"){return this.r=e,this.g=i,this.b=s,Br.toWorkingColorSpace(this,a),this}setHSL(e,i,s,a="srgb-linear"){if(e=function(h,d){return(h%d+d)%d}(e,1),i=ir(i,0,1),s=ir(s,0,1),i===0)this.r=this.g=this.b=s;else{const h=s<=.5?s*(1+i):s+i-s*i,d=2*s-h;this.r=ho(d,h,e+1/3),this.g=ho(d,h,e),this.b=ho(d,h,e-1/3)}return Br.toWorkingColorSpace(this,a),this}setStyle(e,i="srgb"){function s(h){h!==void 0&&parseFloat(h)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let a;if(a=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let h;const d=a[1],b=a[2];switch(d){case"rgb":case"rgba":if(h=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(b))return this.r=Math.min(255,parseInt(h[1],10))/255,this.g=Math.min(255,parseInt(h[2],10))/255,this.b=Math.min(255,parseInt(h[3],10))/255,Br.toWorkingColorSpace(this,i),s(h[4]),this;if(h=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(b))return this.r=Math.min(100,parseInt(h[1],10))/100,this.g=Math.min(100,parseInt(h[2],10))/100,this.b=Math.min(100,parseInt(h[3],10))/100,Br.toWorkingColorSpace(this,i),s(h[4]),this;break;case"hsl":case"hsla":if(h=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(b)){const X=parseFloat(h[1])/360,$=parseFloat(h[2])/100,Z=parseFloat(h[3])/100;return s(h[4]),this.setHSL(X,$,Z,i)}}}else if(a=/^\#([A-Fa-f\d]+)$/.exec(e)){const h=a[1],d=h.length;if(d===3)return this.r=parseInt(h.charAt(0)+h.charAt(0),16)/255,this.g=parseInt(h.charAt(1)+h.charAt(1),16)/255,this.b=parseInt(h.charAt(2)+h.charAt(2),16)/255,Br.toWorkingColorSpace(this,i),this;if(d===6)return this.r=parseInt(h.charAt(0)+h.charAt(1),16)/255,this.g=parseInt(h.charAt(2)+h.charAt(3),16)/255,this.b=parseInt(h.charAt(4)+h.charAt(5),16)/255,Br.toWorkingColorSpace(this,i),this}return e&&e.length>0?this.setColorName(e,i):this}setColorName(e,i="srgb"){const s=pa[e.toLowerCase()];return s!==void 0?this.setHex(s,i):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=rr(e.r),this.g=rr(e.g),this.b=rr(e.b),this}copyLinearToSRGB(e){return this.r=ss(e.r),this.g=ss(e.g),this.b=ss(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e="srgb"){return Br.fromWorkingColorSpace(fa(this,Qr),e),ir(255*Qr.r,0,255)<<16^ir(255*Qr.g,0,255)<<8^ir(255*Qr.b,0,255)<<0}getHexString(e="srgb"){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,i="srgb-linear"){Br.fromWorkingColorSpace(fa(this,Qr),i);const s=Qr.r,a=Qr.g,h=Qr.b,d=Math.max(s,a,h),b=Math.min(s,a,h);let X,$;const Z=(b+d)/2;if(b===d)X=0,$=0;else{const re=d-b;switch($=Z<=.5?re/(d+b):re/(2-d-b),d){case s:X=(a-h)/re+(a<h?6:0);break;case a:X=(h-s)/re+2;break;case h:X=(s-a)/re+4}X/=6}return e.h=X,e.s=$,e.l=Z,e}getRGB(e,i="srgb-linear"){return Br.fromWorkingColorSpace(fa(this,Qr),i),e.r=Qr.r,e.g=Qr.g,e.b=Qr.b,e}getStyle(e="srgb"){return Br.fromWorkingColorSpace(fa(this,Qr),e),e!==Is?`color(${e} ${Qr.r} ${Qr.g} ${Qr.b})`:`rgb(${255*Qr.r|0},${255*Qr.g|0},${255*Qr.b|0})`}offsetHSL(e,i,s){return this.getHSL(Hs),Hs.h+=e,Hs.s+=i,Hs.l+=s,this.setHSL(Hs.h,Hs.s,Hs.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,i){return this.r=e.r+i.r,this.g=e.g+i.g,this.b=e.b+i.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,i){return this.r+=(e.r-this.r)*i,this.g+=(e.g-this.g)*i,this.b+=(e.b-this.b)*i,this}lerpColors(e,i,s){return this.r=e.r+(i.r-e.r)*s,this.g=e.g+(i.g-e.g)*s,this.b=e.b+(i.b-e.b)*s,this}lerpHSL(e,i){this.getHSL(Hs),e.getHSL(Ur);const s=or(Hs.h,Ur.h,i),a=or(Hs.s,Ur.s,i),h=or(Hs.l,Ur.l,i);return this.setHSL(s,a,h),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,i=0){return this.r=e[i],this.g=e[i+1],this.b=e[i+2],this}toArray(e=[],i=0){return e[i]=this.r,e[i+1]=this.g,e[i+2]=this.b,e}fromBufferAttribute(e,i){return this.r=e.getX(i),this.g=e.getY(i),this.b=e.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}function Er(c,e){const i=e==="map";return{type:"folder",label:e+" Sampler",hidden:()=>!c[e],children:[()=>({type:"vec2",label:"Repeat",hidden:()=>!i&&c.map,bounds:[-100,100],stepSize:.001,property:[c[e],"repeat"],onChange:c==null?void 0:c.setDirty}),()=>({type:"vec2",label:"Offset",hidden:()=>!i&&c.map,bounds:[-2,2],property:[c[e],"offset"],onChange:c==null?void 0:c.setDirty}),()=>({type:"vec2",label:"Center",hidden:()=>!i&&c.map,bounds:[-2,2],property:[c[e],"center"],onChange:c==null?void 0:c.setDirty}),()=>({type:"input",label:"Rotation",hidden:()=>!i&&c.map,bounds:[-Math.PI,Math.PI],property:[c[e],"rotation"],onChange:c==null?void 0:c.setDirty}),()=>({type:"dropdown",label:"Encoding",property:[c[e],"encoding"],children:[["Linear",_.rnI],["sRGB",_.knz]].map(s=>({label:s[0],value:s[1]})),onChange:[()=>{const s=c[e];s&&(s.needsUpdate=!0)},c==null?void 0:c.setDirty]}),()=>({type:"checkbox",label:"Flip Y",getValue:()=>{var s,a;return(a=(s=c[e])===null||s===void 0?void 0:s.flipY)!==null&&a!==void 0&&a},setValue:s=>{var a;const h=c[e];if(h&&h.flipY!==s)if(h.image&&ImageBitmap&&h.image instanceof ImageBitmap){const d=h,b=h.source.data;createImageBitmap(b,{imageOrientation:"flipY"}).then(X=>{var $;b.close&&b.close(),d.flipY=s,d.source.data=X,d.source.needsUpdate=!0,d.needsUpdate=!0,($=c==null?void 0:c.setDirty)===null||$===void 0||$.call(c)})}else h.flipY=s,h.needsUpdate=!0,(a=c==null?void 0:c.setDirty)===null||a===void 0||a.call(c)}}),()=>({type:"dropdown",label:"Wrap S",property:[c[e],"wrapS"],children:[["ClampToEdge",_.uWy],["MirroredRepeat",_.OoA],["Repeat",_.rpg]].map(s=>({label:s[0],value:s[1]})),onChange:[()=>{c[e]&&(c[e].needsUpdate=!0)},c==null?void 0:c.setDirty]}),()=>({type:"dropdown",label:"Wrap T",property:[c[e],"wrapT"],children:[["ClampToEdge",_.uWy],["MirroredRepeat",_.OoA],["Repeat",_.rpg]].map(s=>({label:s[0],value:s[1]})),onChange:[()=>{c[e]&&(c[e].needsUpdate=!0)},c==null?void 0:c.setDirty]}),()=>({type:"input",label:"Anisotropy",bounds:[1,6],stepSize:1,property:[c[e],"anisotropy"],onChange:[()=>{c[e]&&(c[e].needsUpdate=!0),c.needsUpdate=!0},c==null?void 0:c.setDirty]}),()=>({type:"dropdown",label:"Min Filter",property:[c[e],"minFilter"],children:[["Linear",Tr],["Nearest",_.TyD],["NearestMipmapNearest",_.YLQ],["NearestMipmapLinear",_.vZf],["LinearMipmapNearest",_.qyh],["LinearMipmapLinear",_.D1R]].map(s=>({label:s[0],value:s[1]})),onChange:[()=>{c[e]&&(c[e].needsUpdate=!0)},c==null?void 0:c.setDirty]}),()=>({type:"dropdown",label:"Mag Filter",property:[c[e],"magFilter"],children:[["Linear",Tr],["Nearest",_.TyD]].map(s=>({label:s[0],value:s[1]})),onChange:[()=>{c[e]&&(c[e].needsUpdate=!0)},c==null?void 0:c.setDirty]})]}}oi.NAMES=pa;const Bs=["appliedMeshes","imageLoadAwaiter","inverseModelMatrix","uvTransform","uuid","iMaterial"];function as(c,e){if(e)for(const i of Object.keys(e))Bs.includes(i)||i.startsWith("__")||typeof c[i]!="function"&&typeof e[i]!="function"&&(c[i]=e[i]);return c}const po=["appliedMaterials","uuid"];function io(c,e){if(e)for(const i of Object.keys(e))po.includes(i)||i.startsWith("__")||typeof c[i]!="function"&&typeof e[i]!="function"&&(c[i]=e[i]);return c}const ea=new Map;function kt(c){return(e,i)=>{const s=e.constructor;if(s===Object)throw new Error("All properties in an object are serialized by default");ea.has(s)||ea.set(s,[]),ea.get(s).push([c||i,i])}}const Zr={obj:(c,e)=>Object.fromEntries(Object.entries(c).map(([i,s])=>[i,qn(s,!1,e)])),vec4:c=>({x:c.x,y:c.y,z:c.z,w:c.w,isVector4:!0}),vec3:c=>({x:c.x,y:c.y,z:c.z,isVector3:!0}),vec2:c=>({x:c.x,y:c.y,isVector2:!0}),color:c=>({r:c.r,g:c.g,b:c.b,isColor:!0}),quat:c=>({x:c.x,y:c.y,z:c.z,w:c.w,isQuaternion:!0}),texture:(c,e)=>{if(!(c!=null&&c.isTexture))throw new Error("Expected a texture");if(c.isRenderTargetTexture)return;if(e!=null&&e.textures[c.uuid])return{uuid:c.uuid,resource:"textures"};const i=c.source.data;c.userData.rootPath&&(c.source.data=null);const s=c.userData;c.userData={};let a=c.toJSON(e);return c.userData=s,a.userData=qn(io({},s),!1,e),c.userData.rootPath&&(delete e.images[c.source.uuid],c.source.data=i),e!=null&&e.textures&&(e.textures[a.uuid]||(e.textures[a.uuid]=a),a={uuid:a.uuid,resource:"textures"}),a},material:(c,e)=>{var i;if(!(c!=null&&c.isMaterial))throw new Error("Expected a material");if(e!=null&&e.materials[c.uuid])return{uuid:c.uuid,resource:"materials"};c.userData.rootPath&&console.error("TODO: handle material with root path with material inheritance/hierarchy");const s=e??{textures:{},images:{}},a={},h={};for(const[b,X]of Object.entries(c))if(!((i=X)===null||i===void 0)&&i.isTexture&&!b.startsWith("__")){const $=Zr.texture(X,s);a[b]=$,h[b]=X,c[b]=$?{isTexture:!0,toJSON:()=>$}:null}let d=c.toJSON(e);for(const[b,X]of Object.entries(h))c[b]=X,delete h[b];if(e){for(const[b,X]of Object.entries(a))X&&(d[b]=X);e!=null&&e.materials&&(e.materials[d.uuid]||(e.materials[d.uuid]=d),d={uuid:d.uuid,resource:"materials"})}else{for(const[b,X]of Object.entries(a))d[b]=X.uuid;d.textures=Object.values(s.textures),d.images=Object.values(s.images)}return d}},To=c=>(e,i)=>{var s,a;return(a=(s=i==null?void 0:i.copy)===null||s===void 0?void 0:s.call(i,e))!==null&&a!==void 0?a:new c().copy(e)},Bi={obj:(c,e,i)=>Object.assign(e,Object.fromEntries(Object.entries(c).map(([s,a])=>[s,bn(a,e==null?void 0:e[s],!1,i)]))),vec4:To(_.Ltg),vec3:To(_.Pa4),vec2:To(dn),color:To(oi),quat:To(_._fP)};function qn(c,e,i){var s,a;if(typeof c=="function")return;if(Array.isArray(c))return c.map(b=>qn(b,!1,i));if(typeof c!="object"){if(typeof c=="number"){if(c===1/0)return"Infinity";if(c===-1/0)return"-Infinity";if(isNaN(c))return"NaN"}return c}if(!c)return c;let h=(s=c.constructor)!==null&&s!==void 0?s:Object;if(h===Object)return Zr.obj(c,i);if(c.isVector2)return Zr.vec2(c);if(c.isVector3)return Zr.vec3(c);if(c.isVector4)return Zr.vec4(c);if(c.isColor)return Zr.color(c);if(c.isQuaternion)return Zr.quat(c);if(c.isTexture)return Zr.texture(c,i);if(c.isMaterial)return Zr.material(c,i);if(!e&&typeof c.toJSON=="function")return c.toJSON(i);const d={};for(;h&&h!==Object;)(a=ea.get(h))===null||a===void 0||a.forEach(([b,X])=>{const $=c[X];d[b]=qn($,!1,i)}),h=Object.getPrototypeOf(h);return c.serializableClassId&&(d.serializableClassId=c.serializableClassId),d}function bn(c,e,i,s){var a,h,d;let b=e;if(c===void 0)return b;if(typeof e=="number"){if(c==="Infinity")return 1/0;if(c==="-Infinity")return-1/0;if(c==="NaN")return NaN;if(typeof c=="number"||!c)return c}if(Array.isArray(c)){const Z=c.length;Array.isArray(b)||(b=[]);for(let re=0;re<Z;re++){const le=c[re],he=b.length>re?bn(le,b[re],!1,s):bn(le,void 0,!1,s);b.length<=re?b.push(he):b[re]=he}return b}let X=!1;if(c&&c.resource&&typeof c.resource=="string"&&(c=(a=s[c.resource])===null||a===void 0?void 0:a[c.uuid],X=!0),!b&&c&&!X)if(c.serializableClassId){const Z=Mi.get(c.serializableClassId);Z&&(b=new Z)}else typeof c!="object"||c.constructor&&c.constructor!==Object||(b={});if(typeof b=="function")return console.error("cannot deserialize over function",b,c),b;if(c&&typeof c=="object"&&!X){if(c.isVector2)return Bi.vec2(c,b);if(c.isVector3)return Bi.vec3(c,b);if(c.isVector4)return Bi.vec4(c,b);if(c.isColor)return Bi.color(c,b);if(c.isQuaternion)return Bi.quat(c,b)}if(c==null||b==null||typeof b!="object"||b.isTexture)return X&&(c?c.__useCount=c.__useCount?c.__useCount+1:1:console.warn("probable error deserialize: resource not found.")),c;let $=(h=b.constructor)!==null&&h!==void 0?h:Object;if($===Object)return Bi.obj(c,b,s);if(!i&&typeof b.fromJSON=="function")return b.isMaterial&&(Object.entries(c).forEach(([Z,re])=>{var le;if(!re||!re.resource||typeof re.resource!="string")return;const he=(le=s[re.resource])===null||le===void 0?void 0:le[re.uuid];c[Z]=he||null}),c.userData&&(c.userData=bn(c.userData,void 0,!1,s))),b.fromJSON(c,s),b;for(;$&&$!==Object;)(d=ea.get($))===null||d===void 0||d.forEach(([Z,re])=>{const le=b[re],he=bn(c[Z],le,!1,s);he!==le&&nt(b,re,he,!0)}),$=Object.getPrototypeOf($);return b}const Mi=new Map;function ki(c){return e=>(e=class extends e{constructor(){super(...arguments),this.serializableClassId=c}},Mi.set(c,e),e)}function Ii(c,e){if(c.uiConfig)return c.uiConfig;const i={type:"folder",label:c.name||"unnamed",expanded:!0,limitedUi:!0,children:[{type:"checkbox",label:"Visible",property:[c,"visible"],limitedUi:!0},{type:"button",label:"Pick/Focus",value:()=>{c.dispatchEvent({type:"select",ui:!0,value:c,focusCamera:!0})}},{type:"button",label:"Pick Parent",hidden:()=>!c.parent,value:()=>{const a=c.parent;a&&a.dispatchEvent({type:"select",ui:!0,value:a})}},{type:"input",label:"Name",property:[c,"name"]},{type:"checkbox",label:"Casts Shadow",hidden:()=>!c.isMesh,property:[c,"castShadow"]},{type:"checkbox",label:"Receive Shadow",hidden:()=>!c.isMesh,property:[c,"receiveShadow"]},{type:"vec3",label:"Position",property:[c,"position"],limitedUi:!0},{type:"vec3",label:"Rotation",property:[c,"rotation"],limitedUi:!0},{type:"vec3",label:"Scale",property:[c,"scale"]},{type:"input",label:"Render Order",property:[c,"renderOrder"]},{type:"button",label:"Auto Scale",prompt:["Auto Scale Radius: Object will be scaled to the given radius",c.userData.autoScaleRadius||"2",!0],value:a=>{if(!a)return;const h=parseFloat(a);Math.abs(h)>0&&$n(c,h)}},c.userData.license!==void 0?{type:"input",label:"License/Credits",property:[c.userData,"license"],limitedUi:!0}:{}]},s=c;if(s!=null&&s.isMesh&&e!==!1){const a=[()=>{var h;return(h=s.geometry)===null||h===void 0?void 0:h.uiConfig},()=>{var h;return Array.isArray(s.material)?s.material.length<1?void 0:{label:"Materials",type:"folder",children:s.material.map(d=>d==null?void 0:d.uiConfig).filter(d=>d)}:(h=s.material)===null||h===void 0?void 0:h.uiConfig}];i.children.push(...a)}if(c!=null&&c.isCamera){const a=[{type:"button",label:"Set View",value:()=>{c.dispatchEvent({type:"setView",ui:!0,camera:c})}},{type:"button",label:"Activate main",hidden:()=>{var h;return(h=c.userData.iCamera)===null||h===void 0?void 0:h.isActiveCamera},value:()=>{c.dispatchEvent({type:"activateMain",ui:!0,camera:c})}},{type:"button",label:"Deactivate main",hidden:()=>{var h;return!(!((h=c.userData.iCamera)===null||h===void 0)&&h.isActiveCamera)},value:()=>{c.dispatchEvent({type:"activateMain",ui:!0,camera:void 0})}}];i.children.push(...a)}return c.uiConfig=i,i}function Fr(c,e,i){var s;if(!c)return void console.warn("setupIModel: object is undefined");if(c.__disposed&&(console.warn("re-init/re-add disposed object, things might not work as intended",c),delete c.__disposed),c.userData||(c.userData={}),c.userData.__iModelSetup&&c.modelObject)return c;c.userData.__iModelSetup=!0;let a=[];a.push(()=>{[...c.children].forEach(fe=>{var me;(me=fe==null?void 0:fe.dispose)===null||me===void 0||me.call(fe)}),c.children=[],c.parent&&c.removeFromParent()}),c.isLight&&!c.assetType?(c.assetType="light",c.lightObject=c):c.isCamera?(c.assetType="camera",c.cameraObject=c):c.assetType||(c.assetType="model"),c.modelObject||(c.modelObject=c),c.setDirty||(c.setDirty=(fe={})=>{c.dispatchEvent({...fe,type:"objectUpdate",object:c})},c.userData.setDirty&&console.warn("userData.setDirty already defined",c.userData.setDirty,c),c.userData.setDirty=fe=>{var me;console.warn("userData.setDirty is deprecated, use setDirty directly"),(me=c.setDirty)===null||me===void 0||me.call(c,fe)});const h=fe=>{var me,Ee,Ae;const ye=(Ee=(me=c.parent)===null||me===void 0?void 0:me.userData.parentRoot)!==null&&Ee!==void 0?Ee:c.parent;ye!==c.userData.parentRoot&&c.traverse(ge=>{ge.userData.parentRoot=ye}),(Ae=c.setDirty)===null||Ae===void 0||Ae.call(c,{change:"addedToParent"})},d=()=>{var fe;(fe=c.setDirty)===null||fe===void 0||fe.call(c,{change:"removedFromParent"}),c.userData.parentRoot!==void 0&&c.traverse(me=>{me.userData.parentRoot=void 0})};c.addEventListener("added",h),c.addEventListener("removed",d),a.push(()=>{c.removeEventListener("added",h),c.removeEventListener("removed",d)});const b=c.dispose;c.dispose=()=>{c.dispatchEvent({type:"dispose"}),b==null||b.call(c)},c.userData.dispose&&console.warn("userData.dispose already defined"),c.userData.dispose=()=>{var fe;console.warn("userData.dispose is deprecated, use dispose directly"),(fe=c.dispose)===null||fe===void 0||fe.call(c)};const X=c;!X.isMesh&&!X.isLine||X.userData.__meshSetup||(X.userData.__meshSetup=!0,X.setMaterial||(X.setMaterial=fe=>Sr(X,fe)),X.setGeometry||(X.setGeometry=(fe,me=!1)=>_r(X,fe,me),X.setGeometry(X.geometry,!0)),c.userData.setMaterial&&console.warn("userData.setMaterial already defined"),c.userData.setMaterial=fe=>{var me;console.warn("userData.setMaterial is deprecated, use setMaterial directly"),(me=c.setMaterial)===null||me===void 0||me.call(c,fe)},c.userData.setGeometry&&console.warn("userData.setGeometry already defined"),c.userData.setGeometry=(fe,...me)=>{var Ee;console.warn("userData.setGeometry is deprecated, use setGeometry directly"),(Ee=c.setGeometry)===null||Ee===void 0||Ee.call(c,fe,...me)},c.userData.__keepShadowDef||(c.castShadow=!0,c.receiveShadow=!0,c.userData.__keepShadowDef=!0),a.push(()=>{var fe,me;const Ee=((fe=X.setMaterial)===null||fe===void 0?void 0:fe.call(X,void 0))||[],Ae=(me=X.setGeometry)===null||me===void 0?void 0:me.call(X,void 0);for(const ye of Ee)ye&&ye.userData.__appliedMeshes.size===0&&ye.userData.disposeOnIdle!==!1&&ye.dispose();Ae&&Ae.userData.__appliedMeshes.size===0&&Ae.userData.disposeOnIdle!==!1&&Ae.dispose()})),c.uiConfig||c.assetType!=="model"&&c.assetType!=="camera"||(Ii(c),a.push(()=>{c.uiConfig=void 0}));const $=()=>{var fe,me;return(me=(fe=c.uiConfig)===null||fe===void 0?void 0:fe.uiRefresh)===null||me===void 0?void 0:me.call(fe,"postFrame",!0,1)};c.addEventListener("objectUpdate",$),a.push(()=>c.removeEventListener("objectUpdate",$)),c.userData.__autoParentDispatchEvents?console.warn("object.userData.__autoParentDispatchEvents already set"):(c.userData.__autoParentDispatchEvents=c.userData.__autoParentDispatchEvents||["objectUpdate","materialUpdate","select"],c.isCamera&&c.userData.__autoParentDispatchEvents.push("activateMain","setView")),e&&(c.userData.parentRoot=e),a.push(()=>{delete c.userData.parentRoot});const Z=c.dispatchEvent;c.dispatchEvent=fe=>{var me;!((me=c.userData.__autoParentDispatchEvents)===null||me===void 0)&&me.includes(fe.type)&&(fe.parentDispatch=!0),fe.parentDispatch&&(Ee=>{var Ae;const ye=(Ae=c.userData.parentRoot)!==null&&Ae!==void 0?Ae:c.parent;ye!=null&&ye.modelObject&&ye.dispatchEvent(Ee)})(fe),Z.call(c,fe)},a.push(()=>{c.dispatchEvent=Z});const re=c.clone;c.clone=(...fe)=>{const me=c.userData;c.userData={};let Ee=re.call(c,...fe);c.userData=me,Ir(Ee.userData,me);const Ae=c.userData.parentRoot;return Ae&&Ae.assetType!=="model"&&console.warn("Cloning an object with a parent that is not an IModel is not supported"),Ee=Fr(Ee,Ae,i),Ee.userData.cloneParent=c.uuid,Ee},a.push(()=>{c.clone=re});const le=c.copy;c.copy=(fe,...me)=>{const Ee=fe.userData;fe.userData={};const Ae=le.call(c,fe,...me);return fe.userData=Ee,Ir(c.userData,fe),Ae},a.push(()=>{c.copy=le});const he=c.add;return c.add=(...fe)=>(fe.forEach(me=>Fr(me,c.userData.parentRoot||c,i)),he.call(c,...fe)),a.push(()=>{c.add=he}),c=(s=i==null?void 0:i(c))!==null&&s!==void 0?s:c,a.push(()=>{nt(c,"modelObject",void 0,!0),c.userData={}}),c.addEventListener("dispose",()=>{c.__disposed?console.warn("Object already disposed",c):(c.__disposed=!0,a.forEach(fe=>fe()),a=[])}),[...c.children].forEach(fe=>Fr(fe,c,i)),c}function Sr(c,e){var i,s,a,h,d;const b=(Array.isArray(e)?e:[e]).map(Z=>Z==null?void 0:Z.materialObject).filter(Z=>Z);if(c.material==b||b.length===1&&c.material===b[0])return[];c.userData.__materialUpdater||(c.userData.__materialUpdater=()=>{c.dispatchEvent({type:"materialUpdate"})});const X=Array.isArray(c.material)?[...c.material]:[c.material];for(const Z of X)Z&&(Z.removeEventListener("materialUpdate",c.userData.__materialUpdater),(s=(i=Z.userData)===null||i===void 0?void 0:i.__appliedMeshes)===null||s===void 0||s.delete(c));const $=[];for(const Z of b)Z.userData.__appliedMeshes||(Z.userData.__appliedMeshes=new Set),$.push(Z),Z&&(Z.addEventListener("materialUpdate",c.userData.__materialUpdater),Z.userData.__appliedMeshes.add(c));return c.material=$.length!==1?$:(a=$[0])!==null&&a!==void 0?a:void 0,c.traverseAncestors(Z=>{Z.isRootScene&&Z.refreshEnvMapIntensity(c)}),c.dispatchEvent({type:"materialChanged",material:e}),(d=(h=c.uiConfig)===null||h===void 0?void 0:h.uiRefresh)===null||d===void 0||d.call(h,"postFrame",!0),X}function _r(c,e,i=!1){var s,a,h,d,b,X,$;c.userData.__objectUpdater||(c.userData.__objectUpdater=le=>{c.dispatchEvent({...le,type:"objectUpdate"})});let Z=c.geometry;const re=Z;return(Z!==e||i)&&(Z&&(Z.removeEventListener("geometryUpdate",c.userData.__objectUpdater),(a=(s=Z.userData)===null||s===void 0?void 0:s.__appliedMeshes)===null||a===void 0||a.delete(c)),Z=e,Z&&!Z.userData.__appliedMeshes&&(Z.userData.__appliedMeshes=new Set),c.geometry=(h=Z)!==null&&h!==void 0?h:void 0,Z&&(Z.addEventListener("geometryUpdate",c.userData.__objectUpdater),(b=(d=Z.userData)===null||d===void 0?void 0:d.__appliedMeshes)===null||b===void 0||b.add(c))),e&&!e.uiConfig&&(e.uiConfig=function(le){return{label:"Geometry",type:"folder",children:[{type:"input",property:[le,"uuid"],disabled:!0},{type:"button",label:"Create uv2 from uv",value:()=>{le.hasAttribute("uv2")&&!confirm("uv2 already exists, replace with uv data?")||le.setAttribute("uv2",le.getAttribute("uv"))}},{type:"input",label:"Mesh count",get value(){var he,fe,me;return(me=(fe=(he=le.userData)===null||he===void 0?void 0:he.__appliedMeshes)===null||fe===void 0?void 0:fe.size)!==null&&me!==void 0?me:0},set value(he){},disabled:!0}]}}(c.geometry)),c.dispatchEvent({type:"geometryChanged",geometry:e}),($=(X=c.uiConfig)===null||X===void 0?void 0:X.uiRefresh)===null||$===void 0||$.call(X,"postFrame",!0),re===Z?void 0:re||void 0}const ls=["appliedMeshes"],Ss=["parentRoot","iCamera","iModel"];function Ir(c,e){if(e)for(const i of Object.keys(e))Ss.includes(i)||i.startsWith("__")||typeof c[i]!="function"&&typeof e[i]!="function"&&(c[i]=e[i]);return c}var es,Io=new Uint8Array(16);function Cs(){if(!es&&!(es=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return es(Io)}for(var kr=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,Hr=function(c){return typeof c=="string"&&kr.test(c)},Vi=[],Ys=0;Ys<256;++Ys)Vi.push((Ys+256).toString(16).substr(1));var Ms=function(c,e,i){var s=(c=c||{}).random||(c.rng||Cs)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e){i=i||0;for(var a=0;a<16;++a)e[i+a]=s[a];return e}return function(h){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,b=(Vi[h[d+0]]+Vi[h[d+1]]+Vi[h[d+2]]+Vi[h[d+3]]+"-"+Vi[h[d+4]]+Vi[h[d+5]]+"-"+Vi[h[d+6]]+Vi[h[d+7]]+"-"+Vi[h[d+8]]+Vi[h[d+9]]+"-"+Vi[h[d+10]]+Vi[h[d+11]]+Vi[h[d+12]]+Vi[h[d+13]]+Vi[h[d+14]]+Vi[h[d+15]]).toLowerCase();if(!Hr(b))throw TypeError("Stringified UUID is invalid");return b}(s)};const os=new Map;function vr(c,e){return(i,s)=>{const a=i.constructor;if(a===Object)throw new Error("All properties in an object are serialized by default");os.has(a)||os.set(a,[]);const h=os.get(a);if(!(h.findIndex(d=>d.propKey===s)<0))throw new Error(`Property ${s} already has a uiConfig decorator`);h.push({params:e||{},propKey:s,uiType:c})}}function Xn(c,e){return vr("checkbox",{label:c,params:e})}function Ha(c,e){return vr("monitor",{label:c,params:e})}function ai(c,e,i,s){return vr("slider",{label:c,bounds:e,stepSize:i,params:s})}function fo(c,e,i,s){return vr("vec",{label:c,bounds:e,stepSize:i,params:s})}function Xs(c,e,i){return vr("dropdown",{label:c,children:e,params:i})}function lr(c,e){return vr("button",{label:c,params:e})}function cr(c,e){return vr("input",{label:c,params:e})}function ml(c,e){return vr("color",{label:c,params:e})}function su(c,e){return vr("image",{label:c,params:e})}function Ec(c){let e=c==null?void 0:c.constructor;if(!c||!e)return[];const i=[],s=[];for(;e&&e!==Object;)s.push(e),e=Object.getPrototypeOf(e);return s.reverse().forEach(a=>{var h;(h=os.get(a))===null||h===void 0||h.forEach(({params:d,propKey:b,uiType:X})=>{var $;let Z;if(X||(Z=($=c[b])===null||$===void 0?void 0:$.uiConfig),Z||(Z={property:[c,b],type:X||"input"}),d){const re=typeof d.params=="function"?d.params(c):d.params||{};delete d.params,Object.assign(Z,{...d,...re})}i.push(Z)})}),i}function ou(c,e,i={},s="folder"){return{type:s,label:c,children:Ec(e),uuid:Ms(),...i}}function ur(c,e,i="folder"){return s=>class extends s{constructor(){super(...arguments),this.uiConfig=ou(c,this,e||{},i)}}}function Ju(c,e){return ur(c,e,"panel")}const $u={type:"change"},jl={type:"start"},Sc={type:"end"};class Zu extends _.pBf{constructor(e,i){super(),this.object=e,this.domElement=i,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new _.Pa4,this.minDistance=.01,this.maxDistance=1/0,this.autoPushTarget=!0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.maxZoomSpeed=1,this.dollyZoom=!1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:_.RsA.ROTATE,MIDDLE:_.RsA.DOLLY,RIGHT:_.RsA.PAN},this.touches={ONE:_.QmN.ROTATE,TWO:_.QmN.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return b.phi},this.getAzimuthalAngle=function(){return b.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(an){an.addEventListener("keydown",Ji),this._domElementKeyEvents=an},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent($u),s.update(),h=a.NONE},this.update=function(){const an=new _.Pa4,Un=new _._fP().setFromUnitVectors(e.up,new _.Pa4(0,1,0)),Fn=Un.clone().invert(),Zi=new _.Pa4,Yr=new _._fP,ut=2*Math.PI;return function(){const Nt=s.object.position;an.copy(Nt).sub(s.target),an.applyQuaternion(Un),b.setFromVector3(an),s.autoRotate&&h===a.NONE&&Xe(2*Math.PI/60/60*s.autoRotateSpeed),s.enableDamping?(b.theta+=X.theta*s.dampingFactor,b.phi+=X.phi*s.dampingFactor):(b.theta+=X.theta,b.phi+=X.phi);let pt=s.minAzimuthAngle,zt=s.maxAzimuthAngle;isFinite(pt)&&isFinite(zt)&&(pt<-Math.PI?pt+=ut:pt>Math.PI&&(pt-=ut),zt<-Math.PI?zt+=ut:zt>Math.PI&&(zt-=ut),b.theta=pt<=zt?Math.max(pt,Math.min(zt,b.theta)):b.theta>(pt+zt)/2?Math.max(pt,b.theta):Math.min(zt,b.theta)),b.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,b.phi)),b.makeSafe(),Math.abs(X.radius)>0&&(s.dollyZoom&&(s.object.zoom=Math.max(Math.max(s.minZoom,.1),Math.min(Math.min(s.maxZoom,20),s.object.zoom*(1+X.radius*(s.enableDamping?s.dampingFactor:1)))),s.object.updateProjectionMatrix(),(s.object.zoom>=Math.min(s.maxZoom,20)||s.object.zoom<=Math.max(s.minZoom,.1))&&(X.radius=0)),b.radius*=1+X.radius*(s.enableDamping?s.dampingFactor:1)),Math.abs($-1)>1e-5&&(s.dollyZoom&&(s.object.zoom=Math.max(Math.max(s.minZoom,.1),Math.min(Math.min(s.maxZoom,20),s.object.zoom*$)),s.object.updateProjectionMatrix(),(s.object.zoom>=Math.min(s.maxZoom,20)||s.object.zoom<=Math.max(s.minZoom,.1))&&($=1)),b.radius*=$);let Yt=0;s.autoPushTarget&&b.radius<s.minDistance&&(Yt=s.minDistance-b.radius),b.radius=Math.max(s.minDistance,Math.min(s.maxDistance,b.radius)),s.enableDamping===!0?s.target.addScaledVector(Z,s.dampingFactor):s.target.add(Z),an.setFromSpherical(b),an.applyQuaternion(Fn),Nt.copy(s.target).add(an),s.target.add(an.normalize().multiplyScalar(-Yt)),s.object.lookAt(s.target);let jt=!1;return s.enableDamping===!0&&Math.abs(X.theta)+Math.abs(X.phi)+Math.abs(X.radius)+Z.length()>.001?(X.theta*=1-s.dampingFactor,X.phi*=1-s.dampingFactor,X.radius*=1-s.dampingFactor,Z.multiplyScalar(1-s.dampingFactor),jt=!0):(X.set(0,0,0),Z.set(0,0,0)),$=1,!!(re||jt||Zi.distanceToSquared(s.object.position)>d||8*(1-Yr.dot(s.object.quaternion))>d)&&(s.dispatchEvent($u),Zi.copy(s.object.position),Yr.copy(s.object.quaternion),re=!1,!0)}}(),this.stopDamping=function(){X.set(0,0,0),Z.set(0,0,0)},this.dispose=function(){s.domElement.removeEventListener("contextmenu",ar),s.domElement.removeEventListener("pointerdown",kn),s.domElement.removeEventListener("pointercancel",pi),s.domElement.removeEventListener("wheel",yn),s.domElement.removeEventListener("pointermove",On),s.domElement.removeEventListener("pointerup",zn),s._domElementKeyEvents!==null&&s._domElementKeyEvents.removeEventListener("keydown",Ji)};const s=this,a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let h=a.NONE;const d=1e-6,b=new _.$V,X=new _.$V(0,0,0);let $=1;const Z=new _.Pa4;let re=!1;const le=new _.FM8,he=new _.FM8,fe=new _.FM8,me=new _.FM8,Ee=new _.FM8,Ae=new _.FM8,ye=new _.FM8,ge=new _.FM8,Pe=new _.FM8,Be=[],Oe={};function Fe(){return s.enableDamping?1:Math.pow(.95,s.zoomSpeed)}function Xe(an){X.theta-=an}function at(an){X.phi-=an}this.rotateUp=at,this.rotateLeft=Xe;const mt=function(){const an=new _.Pa4;return function(Un,Fn){an.setFromMatrixColumn(Fn,0),an.multiplyScalar(-Un),Z.add(an)}}(),wt=function(){const an=new _.Pa4;return function(Un,Fn){s.screenSpacePanning===!0?an.setFromMatrixColumn(Fn,1):(an.setFromMatrixColumn(Fn,0),an.crossVectors(s.object.up,an)),an.multiplyScalar(Un),Z.add(an)}}(),At=function(){const an=new _.Pa4;return function(Un,Fn){const Zi=s.domElement;if(s.object.isPerspectiveCamera){const Yr=s.object.position;an.copy(Yr).sub(s.target);let ut=an.length();ut*=Math.tan(s.object.fov/2*Math.PI/180),mt(2*Un*ut/Zi.clientHeight,s.object.matrix),wt(2*Fn*ut/Zi.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(mt(Un*(s.object.right-s.object.left)/s.object.zoom/Zi.clientWidth,s.object.matrix),wt(Fn*(s.object.top-s.object.bottom)/s.object.zoom/Zi.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function Tt(an,Un=0){s.object.isPerspectiveCamera?($/=an,X.radius=Math.max(-s.maxZoomSpeed,Math.min(s.maxZoomSpeed,X.radius-Un))):s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*an)),s.object.updateProjectionMatrix(),re=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function yt(an,Un=0){s.object.isPerspectiveCamera?($*=an,X.radius=Math.max(-s.maxZoomSpeed,Math.min(s.maxZoomSpeed,X.radius+Un))):s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/an)),s.object.updateProjectionMatrix(),re=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function St(an){le.set(an.clientX,an.clientY)}function Ft(an){me.set(an.clientX,an.clientY)}function Mt(){if(Be.length===1)le.set(Be[0].pageX,Be[0].pageY);else{const an=.5*(Be[0].pageX+Be[1].pageX),Un=.5*(Be[0].pageY+Be[1].pageY);le.set(an,Un)}}function Gt(){if(Be.length===1)me.set(Be[0].pageX,Be[0].pageY);else{const an=.5*(Be[0].pageX+Be[1].pageX),Un=.5*(Be[0].pageY+Be[1].pageY);me.set(an,Un)}}function rn(){const an=Be[0].pageX-Be[1].pageX,Un=Be[0].pageY-Be[1].pageY,Fn=Math.sqrt(an*an+Un*Un);ye.set(0,Fn)}function gn(an){if(Be.length==1)he.set(an.pageX,an.pageY);else{const Fn=$r(an),Zi=.5*(an.pageX+Fn.x),Yr=.5*(an.pageY+Fn.y);he.set(Zi,Yr)}fe.subVectors(he,le).multiplyScalar(s.rotateSpeed);const Un=s.domElement;Xe(2*Math.PI*fe.x/Un.clientHeight),at(2*Math.PI*fe.y/Un.clientHeight),le.copy(he)}function Kt(an){if(Be.length===1)Ee.set(an.pageX,an.pageY);else{const Un=$r(an),Fn=.5*(an.pageX+Un.x),Zi=.5*(an.pageY+Un.y);Ee.set(Fn,Zi)}Ae.subVectors(Ee,me).multiplyScalar(s.panSpeed),At(Ae.x,Ae.y),me.copy(Ee)}function In(an){const Un=$r(an),Fn=an.pageX-Un.x,Zi=an.pageY-Un.y,Yr=Math.sqrt(Fn*Fn+Zi*Zi);ge.set(0,Yr),Pe.set(0,Math.pow(ge.y/ye.y,6*s.zoomSpeed)),Tt(Pe.y),ye.copy(ge)}function kn(an){s.enabled!==!1&&(Be.length===0&&(s.domElement.setPointerCapture(an.pointerId),s.domElement.addEventListener("pointermove",On),s.domElement.addEventListener("pointerup",zn)),function(Un){Be.push(Un)}(an),an.pointerType==="touch"?function(Un){switch(Pr(Un),Be.length){case 1:switch(s.touches.ONE){case _.QmN.ROTATE:if(s.enableRotate===!1)return;Mt(),h=a.TOUCH_ROTATE;break;case _.QmN.PAN:if(s.enablePan===!1)return;Gt(),h=a.TOUCH_PAN;break;default:h=a.NONE}break;case 2:switch(s.touches.TWO){case _.QmN.DOLLY_PAN:if(s.enableZoom===!1&&s.enablePan===!1)return;s.enableZoom&&rn(),s.enablePan&&Gt(),h=a.TOUCH_DOLLY_PAN;break;case _.QmN.DOLLY_ROTATE:if(s.enableZoom===!1&&s.enableRotate===!1)return;s.enableZoom&&rn(),s.enableRotate&&Mt(),h=a.TOUCH_DOLLY_ROTATE;break;default:h=a.NONE}break;default:h=a.NONE}h!==a.NONE&&s.dispatchEvent(jl)}(an):function(Un){let Fn;switch(Un.button){case 0:Fn=s.mouseButtons.LEFT;break;case 1:Fn=s.mouseButtons.MIDDLE;break;case 2:Fn=s.mouseButtons.RIGHT;break;default:Fn=-1}switch(Fn){case _.RsA.DOLLY:if(s.enableZoom===!1)return;(function(Zi){ye.set(Zi.clientX,Zi.clientY)})(Un),h=a.DOLLY;break;case _.RsA.ROTATE:if(Un.ctrlKey||Un.metaKey||Un.shiftKey){if(s.enablePan===!1)return;Ft(Un),h=a.PAN}else{if(s.enableRotate===!1)return;St(Un),h=a.ROTATE}break;case _.RsA.PAN:if(Un.ctrlKey||Un.metaKey||Un.shiftKey){if(s.enableRotate===!1)return;St(Un),h=a.ROTATE}else{if(s.enablePan===!1)return;Ft(Un),h=a.PAN}break;default:h=a.NONE}h!==a.NONE&&s.dispatchEvent(jl)}(an))}function On(an){s.enabled!==!1&&(an.pointerType==="touch"?function(Un){switch(Pr(Un),h){case a.TOUCH_ROTATE:if(s.enableRotate===!1)return;gn(Un),s.update();break;case a.TOUCH_PAN:if(s.enablePan===!1)return;Kt(Un),s.update();break;case a.TOUCH_DOLLY_PAN:if(s.enableZoom===!1&&s.enablePan===!1)return;(function(Fn){s.enableZoom&&In(Fn),s.enablePan&&Kt(Fn)})(Un),s.update();break;case a.TOUCH_DOLLY_ROTATE:if(s.enableZoom===!1&&s.enableRotate===!1)return;(function(Fn){s.enableZoom&&In(Fn),s.enableRotate&&gn(Fn)})(Un),s.update();break;default:h=a.NONE}}(an):function(Un){switch(h){case a.ROTATE:if(s.enableRotate===!1)return;(function(Fn){he.set(Fn.clientX,Fn.clientY),fe.subVectors(he,le).multiplyScalar(s.rotateSpeed);const Zi=s.domElement;Xe(2*Math.PI*fe.x/Zi.clientHeight),at(2*Math.PI*fe.y/Zi.clientHeight),le.copy(he),s.update()})(Un);break;case a.DOLLY:if(s.enableZoom===!1)return;(function(Fn){ge.set(Fn.clientX,Fn.clientY),Pe.subVectors(ge,ye),Pe.y>0?Tt(Fe()):Pe.y<0&&yt(Fe()),ye.copy(ge),s.update()})(Un);break;case a.PAN:if(s.enablePan===!1)return;(function(Fn){Ee.set(Fn.clientX,Fn.clientY),Ae.subVectors(Ee,me).multiplyScalar(s.panSpeed),At(Ae.x,Ae.y),me.copy(Ee),s.update()})(Un)}}(an))}function zn(an){$i(an),Be.length===0&&(s.domElement.releasePointerCapture(an.pointerId),s.domElement.removeEventListener("pointermove",On),s.domElement.removeEventListener("pointerup",zn)),s.dispatchEvent(Sc),h=a.NONE}function pi(an){$i(an)}function yn(an){s.enabled!==!1&&s.enableZoom!==!1&&h===a.NONE&&(an.preventDefault(),s.dispatchEvent(jl),function(Un){let Fn=0;switch(Un.deltaMode){case 2:Fn+=1*Un.deltaY;break;case 1:Fn+=.4*Un.deltaY;break;default:Fn+=.01*Un.deltaY}Un.deltaY<0?yt(1,Fn*s.zoomSpeed):Un.deltaY>0&&Tt(1,-Fn*s.zoomSpeed),s.update()}(an),s.dispatchEvent(Sc))}function Ji(an){s.enabled!==!1&&s.enablePan!==!1&&function(Un){let Fn=!1;switch(Un.code){case s.keys.UP:At(0,s.keyPanSpeed),Fn=!0;break;case s.keys.BOTTOM:At(0,-s.keyPanSpeed),Fn=!0;break;case s.keys.LEFT:At(s.keyPanSpeed,0),Fn=!0;break;case s.keys.RIGHT:At(-s.keyPanSpeed,0),Fn=!0}Fn&&(Un.preventDefault(),s.update())}(an)}function ar(an){s.enabled!==!1&&an.preventDefault()}function $i(an){delete Oe[an.pointerId];for(let Un=0;Un<Be.length;Un++)if(Be[Un].pointerId==an.pointerId)return void Be.splice(Un,1)}function Pr(an){let Un=Oe[an.pointerId];Un===void 0&&(Un=new _.FM8,Oe[an.pointerId]=Un),Un.set(an.pageX,an.pageY)}function $r(an){const Un=an.pointerId===Be[0].pointerId?Be[1]:Be[0];return Oe[Un.pointerId]}this.zoomIn=function(an){Tt(1,an*s.zoomSpeed)},this.zoomOut=function(an){yt(1,an*s.zoomSpeed)},s.domElement.addEventListener("contextmenu",ar),s.domElement.addEventListener("pointerdown",kn),s.domElement.addEventListener("pointercancel",pi),s.domElement.addEventListener("wheel",yn,{passive:!1}),this.update()}}var Xr=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let jr=class extends Zu{constructor(){super(...arguments),this.type="OrbitControls",this.enabled=!0,this.dollyZoom=!1,this.enableDamping=!0,this.dampingFactor=.08,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableZoom=!0,this.zoomSpeed=.15,this.maxZoomSpeed=.2,this.enableRotate=!0,this.rotateSpeed=2,this.enablePan=!0,this.panSpeed=1,this.autoPushTarget=!1,this.minDistance=.35,this.maxDistance=1e3,this.minZoom=.01,this.maxZoom=1e3,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1e4,this.maxAzimuthAngle=1e4,this.screenSpacePanning=!0,this.keyPanSpeed=7}zoomIn(c){super.zoomIn(c)}zoomOut(c){super.zoomOut(c)}dispatchEvent(c){super.dispatchEvent(c)}};Xr([kt()],jr.prototype,"type",void 0),Xr([Xn()],jr.prototype,"enabled",void 0),Xr([Xn(),kt()],jr.prototype,"dollyZoom",void 0),Xr([Xn(),kt()],jr.prototype,"enableDamping",void 0),Xr([cr(),kt()],jr.prototype,"dampingFactor",void 0),Xr([Xn(),kt()],jr.prototype,"autoRotate",void 0),Xr([cr(),kt()],jr.prototype,"autoRotateSpeed",void 0),Xr([Xn(),kt()],jr.prototype,"enableZoom",void 0),Xr([cr(),kt()],jr.prototype,"zoomSpeed",void 0),Xr([cr(),kt()],jr.prototype,"maxZoomSpeed",void 0),Xr([Xn(),kt()],jr.prototype,"enableRotate",void 0),Xr([cr(),kt()],jr.prototype,"rotateSpeed",void 0),Xr([Xn(),kt()],jr.prototype,"enablePan",void 0),Xr([cr(),kt()],jr.prototype,"panSpeed",void 0),Xr([cr(),kt()],jr.prototype,"autoPushTarget",void 0),Xr([cr(),kt()],jr.prototype,"minDistance",void 0),Xr([cr(),kt()],jr.prototype,"maxDistance",void 0),Xr([cr(),kt()],jr.prototype,"minZoom",void 0),Xr([cr(),kt()],jr.prototype,"maxZoom",void 0),Xr([cr(),kt()],jr.prototype,"minPolarAngle",void 0),Xr([cr(),kt()],jr.prototype,"maxPolarAngle",void 0),Xr([cr(),kt()],jr.prototype,"minAzimuthAngle",void 0),Xr([cr(),kt()],jr.prototype,"maxAzimuthAngle",void 0),Xr([kt()],jr.prototype,"screenSpacePanning",void 0),Xr([kt()],jr.prototype,"keyPanSpeed",void 0),jr=Xr([Ju("Orbit Controls")],jr);var Cc=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class ta extends oe{constructor(e,i,s){super(),this._controlsMode="",this._isActiveCamera=!1,this.userData={},this._cameraObjectUpdate=d=>{this.setDirty(d)},this._interactionsEnabled=!0,this.autoLookAtTarget=!0,this.near=.01,this.far=50,this._options={type:"PerspectiveCamera",aspect:"auto",focus:10,fov:25,zoom:1,frustumSize:1,top:1,bottom:-1,left:-1,right:1,controlsMode:"orbit",controlsEnabled:!0},this._position=new _.Pa4(0,0,10),this._target=new _.Pa4(0,0,0),this._controlsCtors=new Map([["orbit",(d,b)=>{const X=new jr(d,b.ownerDocument?b:b.documentElement);return X.screenSpacePanning=!0,X}]]),this._camUi=[{type:"vec3",label:"Position",property:[this,"position"],onChange:()=>this.positionUpdated(!0)},{type:"vec3",label:"Target",property:[this,"target"],onChange:()=>this.targetUpdated(!0)},{type:"slider",bounds:[1,180],label:"Field Of View",hidden:()=>!this._camera.modelObject.isPerspectiveCamera,property:[this._options,"fov"],onChange:()=>{this.refreshCameraOptions()},limitedUi:!0},{type:"slider",bounds:[.001,20],label:"Zoom",property:[this._options,"zoom"],onChange:()=>{this.refreshCameraOptions()}},()=>({type:"dropdown",label:"Controls Mode",property:[this._options,"controlsMode"],children:["","orbit",...this._controlsCtors.keys()].map(d=>({label:d===""?"none":d,value:d})),onChange:()=>{this.refreshCameraOptions()}})],this.uiConfig={type:"folder",label:"Camera",limitedUi:!0,children:[...this._camUi,()=>{var d;return!((d=this._controls)===null||d===void 0)&&d.zoomIn?{type:"button",label:"Zoom in",value:()=>{var b;(b=this._controls)===null||b===void 0||b.zoomIn(1)}}:{}},()=>{var d;return!((d=this._controls)===null||d===void 0)&&d.zoomOut?{type:"button",label:"Zoom out",value:()=>{var b;(b=this._controls)===null||b===void 0||b.zoomOut(1)}}:{}},()=>{var d;return(d=this._controls)===null||d===void 0?void 0:d.uiConfig}]},this.assetType="model",this.uuid=$t(),this.setDirty=this.setDirty.bind(this),this.targetUpdated=this.targetUpdated.bind(this),this._refreshCameraOptions=this._refreshCameraOptions.bind(this),this._container=s??document.body;const a=i??this._options;this._camera=this._setCameraObject(e??(a.type==="OrthographicCamera"?new _.iKG(-1,1,1,-1):new _.cPb)),this._camera.modelObject.userData.iCamera=this;const h=e;e&&(h.isPerspectiveCamera?(a.fov=h.fov,a.focus=h.focus,a.aspect=h.aspect<=0||h.userData.autoAspect?"auto":h.aspect,a.zoom=h.zoom):h.isOrthographicCamera&&(a.left=h.left,a.right=h.right,a.top=h.top,a.bottom=h.bottom,a.zoom=h.zoom),a.near=h.near,a.far=h.far,this._position.copy(e.position),this.refreshTarget()),this.positionUpdated(!1),e||this.targetUpdated(!1),this.setCameraOptions(a)}get controls(){return this._controls}getControls(){return this._controls}get isActiveCamera(){return this._isActiveCamera}get target(){return this._target}set target(e){const i=this._target.sub(e).length()>1e-5;this._target.copy(e),i&&this.targetUpdated()}get position(){return this._position}set position(e){const i=this._position.sub(e).length()>1e-5;this._position.copy(e),i&&this.positionUpdated()}get name(){return this._camera.name}set name(e){this._camera.name=e}getCameraOptions(){return{...this._options,position:this._position.toArray(),target:this._target.toArray()}}setCameraOptions(e,i=!0){var s,a;const h={...e};!((s=h.position)===null||s===void 0)&&s.isVector3&&(h.position=[h.position.x,h.position.y,h.position.z]),!((a=h.target)===null||a===void 0)&&a.isVector3&&(h.target=[h.target.x,h.target.y,h.target.z]),Object.keys(h).forEach(d=>d!=="frustumSize"&&h[d]===void 0&&delete h[d]),Object.assign(this._options,h),this._refreshCameraOptions(!1),this.refreshCameraControls(!1),i&&this.setDirty()}_refreshCameraOptions(e=!0){let i=this._camera.modelObject;if(this._options.type!==i.type){const a=this._options.type==="PerspectiveCamera"?new _.cPb:new _.iKG;a.name=this._camera.name,a.near=this._camera.modelObject.near,a.far=this._camera.modelObject.far,a.zoom=this._camera.modelObject.zoom,a.scale.copy(this._camera.modelObject.scale);const h=this._isActiveCamera;h&&this.deactivateMain(),this._camera=this._setCameraObject(a),i=this._camera.modelObject,h&&this.activateMain(),this._camera.modelObject.updateProjectionMatrix()}let s=this._options.aspect;if(s==="auto"&&(s=this._container.clientWidth/this._container.clientHeight),this._options.position&&(this.position.set(...this._options.position),delete this._options.position),this._options.target&&(this.target.set(...this._options.target),delete this._options.target),this.positionTargetUpdated(!1),this._options.type==="PerspectiveCamera"&&(i.fov=this._options.fov,i.focus=this._options.focus,i.aspect=s),this._options.type==="OrthographicCamera"){const a=this._options.frustumSize;a!==void 0?(i.top=a/2,i.bottom=-a/2,i.left=s*a/2,i.right=-s*a/2):(i.top=this._options.top,i.bottom=this._options.bottom,i.left=this._options.left,i.right=this._options.right)}i.zoom=this._options.zoom,this._nearFarChanged(),e&&this.setDirty()}_setCameraObject(e){return this._camera&&this._camera.removeEventListener("objectUpdate",this._cameraObjectUpdate),this._camera=Fr(e),this._camera.addEventListener("objectUpdate",this._cameraObjectUpdate),this._camera}get interactionsEnabled(){return this._interactionsEnabled&&this._isActiveCamera&&this._options.controlsEnabled}set interactionsEnabled(e){this._interactionsEnabled!==e&&(this._interactionsEnabled=e,this.refreshCameraControls(!0))}_nearFarChanged(){this._camera&&(this._camera.modelObject.near=this.near,this._camera.modelObject.far=this.far,this._camera.modelObject.updateProjectionMatrix())}refreshAspect(e=!0){this._options.aspect==="auto"&&this._refreshCameraOptions(e)}refreshTarget(){var e;!((e=this._controls)===null||e===void 0)&&e.enabled&&this._controls.target?this._target.copy(this._controls.target):this._target.set(0,0,-1).applyQuaternion(this._camera.modelObject.getWorldQuaternion(new _._fP))}setControlsCtor(e,i,s=!1){s||!this._controlsCtors.has(e)?this._controlsCtors.set(e,i):console.error(e+" already exists.")}removeControlsCtor(e){this._controlsCtors.delete(e)}_initCameraControls(){var e,i,s;const a=this._options.controlsMode;this._controls=(i=(e=this._controlsCtors.get(a))===null||e===void 0?void 0:e(this._camera.modelObject,this._container))!==null&&i!==void 0?i:void 0,this._controls||console.error("Unable to create controls with mode "+a+". Are you missing a plugin?"),(s=this._controls)===null||s===void 0||s.addEventListener("change",this.setDirty),this._controlsMode=this._controls?a:""}_disposeCameraControls(){var e,i;this._controlsMode,(e=this._controls)===null||e===void 0||e.removeEventListener("change",this.setDirty),(i=this._controls)===null||i===void 0||i.dispose(),this._controlsMode="",this._controls=void 0}refreshCameraControls(e=!0){var i,s;if(this._options.controlsEnabled){const a=this._options.controlsMode;this._controls?this._controlsMode===a&&this._camera.modelObject===this._controls.object||(this._disposeCameraControls(),this._initCameraControls()):this._initCameraControls(),this._controlsMode=a}if(this._controls){const a=this.interactionsEnabled;this._controls.enabled=a,a&&this._camera.modelObject.up.copy(_.Tme.DefaultUp)}e&&this.setDirty(),(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)}setDirty(e){this._position.copy(this._camera.modelObject.position),this._controls&&this._controls.enabled&&this._controls.target&&this._target.copy(this._controls.target),this._camera.modelObject.fov!==void 0&&(this._options.fov=this._camera.modelObject.fov),this._camera.modelObject.focus!==void 0&&(this._options.focus=this._camera.modelObject.focus),this._camera.modelObject.zoom!==void 0&&(this._options.zoom=this._camera.modelObject.zoom),this.dispatchEvent({...e,type:"update"}),this._camUi.forEach(i=>{var s;return(s=i==null?void 0:i.uiRefresh)===null||s===void 0?void 0:s.call(i,"postFrame",!1,1)})}activateMain(e=!0){var i,s;this._isActiveCamera||(this._isActiveCamera=!0,this._camera.modelObject.userData.__lastScale=this._camera.modelObject.scale.clone(),this._camera.modelObject.scale.divide(this._camera.modelObject.getWorldScale(new _.Pa4)),e&&(this.refreshCameraControls(!0),this.refreshAspect()),(s=(i=this._camera).setDirty)===null||s===void 0||s.call(i,{change:"activateMain"}))}deactivateMain(e=!0){this._isActiveCamera&&(this._isActiveCamera=!1,this._camera.modelObject.userData.__lastScale&&(this._camera.modelObject.scale.copy(this._camera.modelObject.userData.__lastScale),delete this._camera.modelObject.userData.__lastScale),e&&this.refreshCameraControls(!0))}get cameraObject(){return this._camera.modelObject}get modelObject(){return this._camera.modelObject}dispose(){this._disposeCameraControls()}targetUpdated(e=!0){var i,s;const a=this.target;(s=(i=this._controls)===null||i===void 0?void 0:i.target)===null||s===void 0||s.set(a.x,a.y,a.z),this._controls&&this._controls.enabled&&this._controls.target?e&&this.setDirty():this._camera&&(this.autoLookAtTarget&&this._camera.modelObject.lookAt(a),e&&this.setDirty())}positionUpdated(e=!0){const i=this.position;this._camera.modelObject.position.set(i.x,i.y,i.z),e&&this.setDirty()}positionTargetUpdated(e=!0){this.positionUpdated(!1),this.targetUpdated(e)}copyFromCamera(e,i=4){e.getWorldPosition(this._position),e.getWorldDirection(this._target).multiplyScalar(i).add(this._position),this.positionTargetUpdated(!1),this.setCameraOptions({fov:e.fov,focus:e.focus,zoom:e.zoom,type:e.type},!0)}updateShaderProperties(e){var i;return!((i=e.uniforms.cameraPositionWorld)===null||i===void 0)&&i.value&&this._camera.modelObject.getWorldPosition(e.uniforms.cameraPositionWorld.value),e.uniforms.cameraNearFar?e.uniforms.cameraNearFar.value.set(this._camera.modelObject.near,this._camera.modelObject.far):console.warn("BaseRenderer: no uniform: cameraNearFar"),e.uniforms.projection&&(e.uniforms.projection.value=this._camera.modelObject.projectionMatrix),e.defines.PERSPECTIVE_CAMERA=this._camera.modelObject.type==="PerspectiveCamera"?"1":"0",e.defines.ORTHOGRAPHIC_CAMERA=this._camera.modelObject.type==="OrthographicCamera"?"1":"0",this}toJSON(e){return Object.assign({},qn(this,!0,e))}fromJSON(e,i){return bn(e,this,!0,i),this.positionTargetUpdated(!1),this.refreshCameraOptions(),this.setDirty(),this}refreshCameraOptions(e=!0){this.setCameraOptions(this._options,e)}get visible(){return!0}set visible(e){console.error("Cannot set visible on camera",e)}}Cc([kt("camControls")],ta.prototype,"_controls",void 0),Cc([kt()],ta.prototype,"userData",void 0),Cc([lt(ta.prototype._nearFarChanged)],ta.prototype,"near",void 0),Cc([lt(ta.prototype._nearFarChanged)],ta.prototype,"far",void 0),Cc([kt("camOptions")],ta.prototype,"_options",void 0),Cc([kt("position")],ta.prototype,"_position",void 0),Cc([kt("target")],ta.prototype,"_target",void 0);var fp=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class gl extends _.xsS{constructor(e){super(),this.isRootScene=!0,this.assetType="model",this._sceneBounds=new nn,this._sceneBoundingRadius=0,this._cameras=[],this._activeCamera=-1,this.envMapIntensity=1,this._dummyCam=new ta(new _.cPb,{controlsMode:"",controlsEnabled:!1}),this.environment=null,this.background=null,this.minNearDistance=.2,this.setDirty=this.setDirty.bind(this),this.updateScene=this.updateScene.bind(this),this.refreshActiveCameraNearFar=this.refreshActiveCameraNearFar.bind(this),this._activeCameraUpdate=this._activeCameraUpdate.bind(this),this._onSceneMaterialUpdate=this._onSceneMaterialUpdate.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this.addEventListener("materialUpdate",this._onSceneMaterialUpdate),this.addEventListener("objectUpdate",this._onSceneUpdate),this.defaultCamera=e,this.modelRoot=Fr(new _.ZAu,void 0),this.modelRoot.userData.rootSceneModelRoot=!0,this.modelRoot.name="Scene",this.modelRoot.addEventListener("update",this.setDirty),this.addSceneObject(this.modelRoot,{addToRoot:!0,autoScale:!1}),this.addSceneObject(this.defaultCamera,{addToRoot:!0}),this.activeCamera=this.defaultCamera,this.boxHelper=new _.GQ(this.getBounds())}refreshEnvMapIntensity(e){return e!=null&&e.isObject3D||(e=this),(e??this).traverse(i=>{(Array.isArray(i.material)?i.material:[i.material]).forEach(s=>{s&&s.envMapIntensity!==void 0&&!s.userData.separateEnvMapIntensity&&(s.envMapIntensity=this.envMapIntensity,s.needsUpdate=!0)})}),this.setDirty(),this}get activeCamera(){return this._activeCamera>=0?this._cameras[this._activeCamera]:this._dummyCam}set activeCamera(e){const i=this.activeCamera;if(e||(e=this.defaultCamera),i!==e){if(i&&(i.deactivateMain(),i.removeEventListener("update",this._activeCameraUpdate)),e){e.activateMain(),e.addEventListener("update",this._activeCameraUpdate);let s=this._cameras.indexOf(e);s<0&&(this._cameras.push(e),s=this._cameras.length-1),this._activeCamera=s}else this._activeCamera=-1;this.dispatchEvent({type:"activeCameraChange",lastCamera:i,camera:e}),this.setDirty()}}get modelObject(){return this}addModel(e,i={}){return e.assetType!=="model"&&console.error("Invalid asset type for ",e,", adding anyway"),this.addSceneObject(e,i)}addWidget(e,i={}){e.assetType!=="widget"&&console.warn("Invalid asset type for ",e,", adding anyway"),this.add(e.modelObject)}_addModel(e,i={}){return this._addObject3D(e==null?void 0:e.modelObject,i)}addSceneObject(e,i){if(!e)return e;const s=e.assetType;let a=!1;switch(s){case"model":a=e.modelObject.isCamera,a&&(i={...i,autoScale:!1}),this._addModel(e,i);break;case"material":break;case"texture":this.dispatchEvent({type:"textureAdded",texture:e});break;case"light":this._addLight(e,i);break;default:console.warn("Unknown asset imported",e,s)}return this.dispatchEvent({type:"addSceneObject",object:e}),e}_addObject3D(e,{autoScale:i=!0,autoScaleRadius:s=2,addToRoot:a=!1}={}){const h=e;h?(i&&!h.userData.autoScaled&&$n(h,h.userData.autoScaleRadius||s),h.traverse(d=>{d.isMesh&&!d.userData.__keepShadowDef&&(d.castShadow=!0,d.receiveShadow=!0,d.userData.__keepShadowDef=!0)}),this.refreshEnvMapIntensity(h),a?this.modelObject.add(h):this.modelRoot.add(h),this.setDirty()):console.error("Invalid Model, cannot add.")}removeSceneModels(){this.modelRoot.clear(),this.modelRoot.children=[],this.setDirty({sceneUpdate:!0})}disposeSceneModels(){this.modelRoot.children.forEach(e=>{var i,s;((i=e.dispose)!==null&&i!==void 0?i:(s=e.modelObject)===null||s===void 0?void 0:s.removeFromParent)()}),this.setDirty({sceneUpdate:!0})}_onEnvironmentChange(){this.dispatchEvent({type:"environmentChanged",environment:this.getEnvironment()}),this._onSceneUpdate()}add(...e){return super.add(...e.map(i=>Fr(i))),this._onSceneUpdate(),this}setEnvironment(e){if(!e)return this.environment=null,this.dispatchEvent({type:"environmentChanged"}),void this._onSceneUpdate();if((e==null?void 0:e.assetType)!=="texture")return void console.error("Unknown Environment type",e);e.mapping===_.xfE&&(e.mapping=_.dSO,e.needsUpdate=!0);const i=e.textureObject||e;this.environment=i,this._onEnvironmentChange()}getEnvironment(){return this.environment}setBackground(e){var i;let s;if(!e||e.assetType==="texture"||e.isColor||e.isVector4)s=((i=e)===null||i===void 0?void 0:i.assetType)==="texture"&&e.textureObject||e;else{if(typeof e!="string"&&typeof e!="number")return void console.error("Unknown Background type",e);s=new _.Ilk(e)}this.background=s,this._onSceneUpdate({geometryChanged:!1})}getBackground(){return this.background}setDirty(e){return e!=null&&e.sceneUpdate?this._onSceneUpdate(e):this.dispatchEvent({type:"update"}),this}updateScene(e){return this._onSceneUpdate(e)}_activeCameraUpdate(){this.setDirty(),this.refreshActiveCameraNearFar(),this.dispatchEvent({type:"activeCameraUpdate"})}_onSceneUpdate(e={}){var i,s,a;return e.sceneUpdate===!1?this.setDirty(e):(this.refreshActiveCameraNearFar(),this._sceneBounds=this.getBounds(!1,!0),(a=(s=(i=this.boxHelper)===null||i===void 0?void 0:i.box)===null||s===void 0?void 0:s.copy)===null||a===void 0||a.call(s,this._sceneBounds),this._sceneBoundingRadius=this._sceneBounds.getSize(new _.Pa4).length()/2,this.dispatchEvent({...e,type:"sceneUpdate",hierarchyChanged:["addedToParent","removedFromParent"].includes(e.change||"")}),this)}_onSceneMaterialUpdate(){this.dispatchEvent({type:"sceneMaterialUpdate"})}dispose(){this.clear()}findObjectsByName(e,i){const s=[];return(i??this.modelObject).traverse(a=>{a.name===e&&s.push(a)}),s}addLight(e,i={}){this.addSceneObject(e,i)}_addLight(e,{addToRoot:i=!1}={}){var s;const a=e.lightObject;a&&((s=a.children)===null||s===void 0||s.length,i?this.add(a):this.modelRoot.add(a))}getBounds(e=!1,i=!0){return new nn().expandByObject(this.modelObject,e,i)}refreshActiveCameraNearFar(){const e=this.activeCamera;if(!e)return;const i=this.getBounds(!1),s=e.cameraObject.getWorldPosition(new _.Pa4).sub(i.getCenter(new _.Pa4)),a=1.5*i.getSize(new _.Pa4).length()/2,h=s.length(),d=Math.max(this.minNearDistance,h-a),b=Math.max(d+1,h+a);e.near=d,e.far=b}updateShaderProperties(e){return e.uniforms.sceneBoundingRadius?e.uniforms.sceneBoundingRadius.value=this._sceneBoundingRadius:console.warn("BaseRenderer: no uniform: frameCount"),this}toJSON(e){return qn(this,!0,e)}fromJSON(e,i){const s=e.environment;return s!==void 0&&(this.setEnvironment(bn(s,this.getEnvironment(),!1,i)),delete e.environment),bn(e,this,!0,i),e.environment=s,this}addEventListener(e,i){super.addEventListener(e,i)}removeEventListener(e,i){super.removeEventListener(e,i)}}function au(){const c=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return c.style.display="block",c}function eh(c,e){const i=e||"/";return c.join(i)}function ts(c,e){const i=window.URL.createObjectURL(c),s=document.createElement("a");s.style.display="none",s.href=i,s.download=e,document.body.appendChild(s),s.click(),setTimeout(()=>{document.body.removeChild(s),window.URL.revokeObjectURL(i)},1e3)}async function Pa(c){return new Promise((e,i)=>{const s=new FileReader;s.onload=a=>e(s.result),s.onerror=a=>i(s.error),s.onabort=a=>i(new Error("Read aborted")),s.readAsDataURL(c)})}function zl(c,e){return ts(c,e??c.name)}async function ro(c=!1,e=!1,i){const s=document.createElement("input");s.type="file",s.multiple=c,s.accept=i||"*",s.webkitdirectory=e,s.style.display="none",document.body.appendChild(s),s.click();const a=await new Promise(h=>{s.onchange=d=>{h(Array.from(s.files||[]))}});return document.body.removeChild(s),a}function ma({innerHTML:c="",id:e,classList:i,addToBody:s=!0,elementTag:a="div"}){const h=document.createElement(a);return e&&(h.id=e),h.innerHTML=c,i&&h.classList.add(...i),s&&document.body.appendChild(h),h}async function $h(c){return new Promise((e,i)=>{const s=new Image;s.onload=()=>e(s),s.onerror=i,s.crossOrigin="anonymous",s.decoding="sync",s.src=c})}function th(c){const e=document.createElement("style");return e.type="text/css",e.innerText=c,document.head.appendChild(e),e}async function Mf(c){return new Promise((e,i)=>{const s=document.createElement("script");s.setAttribute("src",c),s.addEventListener("load",e),s.addEventListener("error",i),document.body.appendChild(s)})}function na(c,e=8192,i=!1){var s;if(!c.width||!c.height)return"";const a=document.createElement("canvas");a.width=Math.min(e,c.width),a.height=Math.floor(1+a.width*c.height/c.width);const h=c instanceof ImageBitmap,d=h&&i&&Math.abs(a.width-c.width)<.5?a.getContext("bitmaprenderer"):void 0;d?d.transferFromImageBitmap(c):(s=a.getContext("2d"))===null||s===void 0||s.drawImage(c,0,0,a.width,a.height);const b=a.toDataURL("image/png");return a.remove(),h&&i&&c.close(),b}async function cs(c){return new Promise((e,i)=>{const s=new Image;s.addEventListener("load",()=>{const a=document.createElement("canvas");a.width=s.width,a.height=s.height;const h=a.getContext("2d");if(!h)return void i(new Error("Could not get 2d context"));h.drawImage(s,0,0,a.width,a.height);const d=h.getImageData(0,0,a.width,a.height);e(d),a.remove(),s.remove()},!1),s.addEventListener("error",a=>{s.remove(),i(a)},!1),s.src=c})}function ia(){return(typeof performance>"u"?Date:performance).now()}function Mc(){let c=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(c=!0),c;var e}function Do(c,e=null){var i;return(i=new URL(window.location.href).searchParams.get(c))!==null&&i!==void 0?i:e}function Tc(c,e,i=!1){const s=new URLSearchParams(location.search);e==null?s.has(c)&&s.delete(c):s.set(c,e),i?window.location.search=s.toString():window.history.replaceState({},"","?"+s.toString())}function Ks(c){if(!window)return console.warn("window is required"),"";let e="";const i=new Uint8Array(c),s=i.byteLength;for(let a=0;a<s;a++)e+=String.fromCharCode(i[a]);return window.btoa(e)}function mp(c){if(!window)return console.warn("window is required"),new Uint8Array(0);const e=window.atob(c),i=e.length,s=new Uint8Array(i);for(let a=0;a<i;a++)s[a]=e.charCodeAt(a);return s.buffer}function Tf(c){return c.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}function mo(c,{backgroundColor:e="",displayPixelRatio:i=1,width:s=512,height:a=512}){const h=document.createElement("canvas"),d=h.getContext("2d"),b=i,X=s,$=a;return h.width=X*b,h.height=$*b,h.style.width=`${X}`,h.style.height=`${$}`,(e==null?void 0:e.length)>0&&(d.fillStyle=e,d.fillRect(0,0,h.width,h.height)),d.drawImage(c,0,0,h.width,h.height),h}fp([kt()],gl.prototype,"defaultCamera",void 0),fp([lt(gl.prototype.refreshEnvMapIntensity),kt()],gl.prototype,"envMapIntensity",void 0),fp([kt()],gl.prototype,"environment",void 0),ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(c,e){const i=new Uint8Array(this);e==null&&(e=i.length);const s=new ArrayBuffer(e-c),a=new Uint8Array(s);for(let h=0;h<a.length;h++)a[h]=i[h+c];return s});const zr={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function If(c,e){return new zr[c](e)}class tr{static ApplyMaterialExtensions(e,i,s,a){for(const h of s)this.ApplyMaterialExtension(e,i,h,a)}static ApplyMaterialExtension(e,i,s,a){var h,d;let b=(h=st(s.parsFragmentSnippet,a,e))!==null&&h!==void 0?h:"";b.length&&(i.fragmentShader=i.fragmentShader.replace(this.FragVoidMain,`
${b}
${this.FragVoidMain}`)),b=(d=st(s.parsVertexSnippet,a,e))!==null&&d!==void 0?d:"",b.length&&(i.vertexShader=i.vertexShader.replace(this.VertVoidMain,`
${b}
${this.VertVoidMain}`)),s.extraUniforms&&(i.uniforms=Object.assign(i.uniforms,s.extraUniforms)),s.shaderExtender&&s.shaderExtender(i,e,a),e.lastShader=i}static CacheKeyForExtensions(e,i){let s="";for(const a of i)s+=this.CacheKeyForExtension(e,a);return s}static CacheKeyForExtension(e,i){let s="";return i.customCacheKey&&(s+=i.customCacheKey),i.computeCacheKey&&(s+=i.computeCacheKey(e)),s}static RegisterExtensions(e,i){const s=[];if(i)for(const a of i)a.isCompatible&&a.isCompatible(e)&&(s.push(a),a.uuid||(a.uuid=Ms()),a.__setDirty||(a.__setDirty=()=>{a.updateVersion||(a.updateVersion=0),a.updateVersion++}),a.setDirty||(a.setDirty=a.__setDirty));return e.materialExtensions=s,e.__ext_beforeRenderListen||(e.__ext_beforeRenderListen=!0,e.addEventListener("beforeRender",a=>function(h,{object:d,renderer:b}){var X;(X=h.materialExtensions)===null||X===void 0||X.forEach($=>{var Z,re;(Z=$.onObjectRender)===null||Z===void 0||Z.call($,d,h,b),h.lastShader&&((re=st($.updaters))===null||re===void 0||re.forEach(le=>le==null?void 0:le.updateShaderProperties(h.lastShader))),$.updateVersion!==h.materialObject.userData["_"+$.uuid+"_version"]&&(h.materialObject.userData["_"+$.uuid+"_version"]=$.updateVersion,h.materialObject.needsUpdate=!0)})}(e,a))),e.__ext_afterRenderListen||(e.__ext_afterRenderListen=!0,e.addEventListener("afterRender",a=>function(h,{object:d,renderer:b}){var X;(X=h.materialExtensions)===null||X===void 0||X.forEach($=>{var Z;(Z=$.onAfterRender)===null||Z===void 0||Z.call($,d,h,b)})}(e,a))),s}}tr.FragVoidMain="void main() {",tr.VertVoidMain="void main() {";class lu extends _.jyz{constructor(e){var i;super(e),this.typeSlug="shaderMat",this.assetType="material",this.materialObject=this,this.materialExtensions=[],this.extraUniformsToUpload={},this.materialExtensions=tr.RegisterExtensions(this,(i=e==null?void 0:e.customMaterialExtensions)!==null&&i!==void 0?i:[])}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...tr.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}onBeforeCompile(e,i){tr.ApplyMaterialExtensions(this,e,this.materialExtensions,i),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:i}),super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()+tr.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,i,s,a,h){super.onBeforeRender(e,i,s,a,h),this.dispatchEvent({type:"beforeRender",renderer:e,scene:i,camera:s,geometry:a,object:h})}onAfterRender(e,i,s,a,h){super.onAfterRender(e,i,s,a,h),this.dispatchEvent({type:"afterRender",renderer:e,scene:i,camera:s,geometry:a,object:h})}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,i){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){}}class ga extends lu{constructor(e,i){super(e),this.typeSlug="shaderMat",this.textures=[],this.setTextureIds(i)}setTextureIds(e){this.textures.map(i=>i.id).join(";")!==e.join(";")&&(this.textures=e.map(i=>({id:i,encoding:_.rnI})),this.setDirty())}_setUniformTexSize(e,i){var s,a,h,d;if(!i||!e)return;const b=(a=(s=i.image)===null||s===void 0?void 0:s.width)!==null&&a!==void 0?a:512,X=(d=(h=i.image)===null||h===void 0?void 0:h.height)!==null&&d!==void 0?d:512,$=e.value;$.isVector2||console.warn("uniform is not a Vector2"),$&&Math.abs($.x-b)+Math.abs($.y-X)>.1&&($.x=b,$.y=X,this.uniformsNeedUpdate=!0)}onBeforeRender(e,i,s,a,h){var d,b;this._setUniformTexSize(this.uniforms.screenSize,(d=e.getRenderTarget())===null||d===void 0?void 0:d.texture);for(const X of this.textures){const $=X.id,Z=(b=this.uniforms[$])===null||b===void 0?void 0:b.value;Z&&(this._setUniformTexSize(this.uniforms[$+"Size"],Z),Z.encoding!==X.encoding&&(X.encoding=Z.encoding,this.needsUpdate=!0))}super.onBeforeRender(e,i,s,a,h)}onBeforeCompile(e,i){e.fragmentShader=this.textures.map(s=>{var a,h;return`uniform sampler2D ${s.id}; 
`+Cn((a=s.id)!==null&&a!==void 0?a:"input",(h=s.encoding)!==null&&h!==void 0?h:_.rnI)}).join(`
`)+e.fragmentShader,super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()+this.textures.map(e=>e.id+e.encoding).join(";")}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,i){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}function nh(c,...e){const i=c.fragmentShader;return new ga({defines:Object.assign({},c.defines),uniforms:c.uniforms,vertexShader:c.vertexShader,fragmentShader:i},e)}class Fs extends Le{constructor(e,...i){super(e.isMaterial?e:nh(e,...i),i.length<1?Fs.DEFAULT_TEX_ID:i[0]),this.onDirty=[],this.isShaderPass2=!0,this.enabled=!0,this.setDirty=this.setDirty.bind(this)}dispose(){var e,i,s,a;(i=(e=this.material)===null||e===void 0?void 0:e.dispose)===null||i===void 0||i.call(e),(a=(s=this.fsQuad)===null||s===void 0?void 0:s.dispose)===null||a===void 0||a.call(s),this.onDirty=[]}setDirty(){this.onDirty.forEach(e=>e())}updateShaderProperties(e){e&&(Array.isArray(e)||(e=[e]),e.forEach(i=>i==null?void 0:i.updateShaderProperties(this.material)))}render(e,i,s,a,h){this.enabled&&super.render(e,i,s,a,h)}}Fs.DEFAULT_TEX_ID="tDiffuse",function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);h>3&&d&&Object.defineProperty(e,i,d)}([Xn("Enabled"),kt()],Fs.prototype,"enabled",void 0);class ih extends ve{constructor(e,i,s,a,h){super(),this.scene=e,this.camera=i,this.overrideMaterial=s,this.clearColor=a,this.clearAlpha=h!==void 0?h:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new _.Ilk}render(e,i,s,a,h,d){const b=e.autoClear;let X,$;if(e.autoClear=!1,this.overrideMaterial!==void 0&&($=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),X=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:s),d){const Z=e.getContext();Z.framebufferRenderbuffer(Z.FRAMEBUFFER,Z.DEPTH_ATTACHMENT,Z.RENDERBUFFER,d)}if(this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),d){const Z=e.getContext();Z.framebufferRenderbuffer(Z.FRAMEBUFFER,Z.DEPTH_ATTACHMENT,Z.RENDERBUFFER,null)}this.clearColor&&e.setClearColor(this._oldClearColor,X),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=$),e.autoClear=b}}class dg extends Fs{constructor(e,i="c = a + b;",s="",a){super({vertexShader:ae.vertexShader,fragmentShader:Ne`
                varying vec2 vUv;
                
                ${s}
                
                void blend(in vec4 a, in vec4 b, inout vec4 c){
                
                ${i}
                
                }
                void main() {
                    vec4 texel = vec4(0);
                    blend(tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ), tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), texel);
                    texel = clamp(texel, vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:a},...e}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}}class xv extends _.jyz{constructor(e=!0){super({vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
out vec3 vViewPosition;void main(){
#include <uv_vertex>
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition=-mvPosition.xyz;}`,fragmentShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#include <packing>
uniform float alphaTest;
#endif
#ifndef gl_FragColor 
layout(location=0)out vec4 A;layout(location=1)out vec4 B;
#endif
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <alphamap_pars_fragment>
uniform vec2 cameraNearFar;uniform vec4 flags;in vec3 vViewPosition;vec2 pack16(float value){float sMax=65535.;int v=int(clamp(value,0.,1.)*sMax+0.5);int digit0=v/256;int digit1=v-digit0*256;return vec2(float(digit0)/255.,float(digit1)/255.);}vec2 packNormal(vec3 n){float p=sqrt(n.z*8.+8.);return vec2(n.xy/p+0.5);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}void main(){
#ifdef USE_ALPHAMAP
#ifdef ALPHA_I_RGBA_PACKING
if(1.-unpackRGBAToDepth(texture2D(alphaMap,vUv))<alphaTest)
#else
if(texture2D(alphaMap,vUv).g<alphaTest)
#endif
discard;
#endif
#include <normal_fragment_begin>
#ifdef FORCED_LINEAR_DEPTH
float linearZ=float(FORCED_LINEAR_DEPTH);
#else
float linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);
#endif
vec2 packedZ=pack16(pow(linearZ,0.5));vec2 packedNormal=packNormal(normal);
#ifndef gl_FragColor 
A=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);B=flags;
#else
gl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);
#endif
}`,uniforms:{cameraNearFar:{value:new _.FM8(.1,1e3)},alphaMap:{value:null},alphaTest:{value:null},flags:{value:new _.Ltg(1,1,1,1)}},glslVersion:e?_.LSk:_.v9Y}),this._updaters=[]}onBeforeRender(e,i,s,a,h){var d,b,X;let $=h.material;Array.isArray($)&&($=$[0]),this.uniforms.alphaMap.value=(d=$==null?void 0:$.alphaMap)!==null&&d!==void 0?d:null,this.uniforms.alphaTest.value=!$||!$.alphaTest||$.alphaTest<1e-7?.001:$.alphaTest,this.uniforms.flags.value.z=($!=null&&$.userData.matId?$==null?void 0:$.userData.matId:0)/255,this._updaters.forEach(re=>{re(h,this.uniforms.flags.value)}),this.uniforms.flags.value.y/=255,this.uniforms.flags.value.w/=255,this.uniformsNeedUpdate=!0;let Z=this.uniforms.alphaMap.value?1:void 0;Z!==this.defines.USE_ALPHAMAP&&(Z===void 0?delete this.defines.USE_ALPHAMAP:this.defines.USE_ALPHAMAP=Z,this.needsUpdate=!0),Z=$.userData.ALPHA_I_RGBA_PACKING?1:void 0,Z!==this.defines.ALPHA_I_RGBA_PACKING&&(Z===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=Z,this.needsUpdate=!0),Z=(b=$.userData.forcedLinearDepth)!==null&&b!==void 0?b:void 0,Z!==this.defines.FORCED_LINEAR_DEPTH&&(Z===void 0?delete this.defines.FORCED_LINEAR_DEPTH:this.defines.FORCED_LINEAR_DEPTH=Z,this.needsUpdate=!0),this.side=(X=$.side)!==null&&X!==void 0?X:_.ehD}addGBufferUpdater(e){this._updaters.push(e)}removeGBufferUpdater(e){}}var Wa=`#ifndef UNPACK_GBUFFER_SNIPPET
#define UNPACK_GBUFFER_SNIPPET 
uniform sampler2D tNormalDepth;float unpack16(vec2 value){return(value.x*0.996108949416342426275150501169264316558837890625+value.y*0.00389105058365758760263730664519243873655796051025390625);}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}float unpackDepth(vec2 uncodedDepth){float x=unpack16(uncodedDepth.xy);return x*x;}float getDepth(vec2 uv){vec4 uncodedDepth=texture2D(tNormalDepth,uv);return unpackDepth(uncodedDepth.xy);}void getDepthNormal(const in vec2 uv,out float depth,out vec3 normal){vec4 uncodedDepth=texture2D(tNormalDepth,uv);depth=unpackDepth(uncodedDepth.xy);normal=unpackNormal(uncodedDepth.zw);}vec3 getViewNormal(const in vec2 uv){return unpackNormal(texture2D(tNormalDepth,uv).zw);}
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
uniform sampler2D tGBufferFlags;
#endif
vec4 getGBufferFlags(const in vec2 uv){
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
return texture2D(tGBufferFlags,uv);
#else
return vec4(1.);
#endif
}
#endif
`;const Df={name:"",fog:!0,blending:_.bdR,side:_.Wl3,vertexColors:!1,opacity:1,transparent:!1,blendSrc:_.k74,blendDst:_.LgZ,blendEquation:_.bGH,blendSrcAlpha:null,blendDstAlpha:null,blendEquationAlpha:null,depthFunc:_.vCF,depthTest:!0,depthWrite:!0,stencilWriteMask:255,stencilFunc:_.cum,stencilRef:0,stencilFuncMask:255,stencilFail:_.x5V,stencilZFail:_.x5V,stencilZPass:_.x5V,stencilWrite:!1,clippingPlanes:null,clipIntersection:!1,clipShadows:!1,shadowSide:null,colorWrite:!0,precision:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0,dithering:!1,alphaTest:0,alphaToCoverage:!1,premultipliedAlpha:!1,visible:!0,toneMapped:!0,userData:{},wireframeLinecap:"round",wireframeLinejoin:"round"};function gs(c,e,i,{replaceAll:s=!1,prepend:a=!1,append:h=!1}={}){if(!c.includes(e))return console.error(`${e} not found in shader`),c;let d=i;return a?d=i+e:h&&(d=e+i),s?c.replaceAll(e,d):c.replace(e,d)}const cu={...Df,color:"#000000",roughness:0,metalness:0,map:null,lightMap:null,lightMapIntensity:0,aoMap:null,aoMapIntensity:0,emissive:"#000000",emissiveIntensity:0,emissiveMap:null,bumpMap:null,bumpScale:0,normalMap:null,normalMapType:_.IOt,normalScale:new _.FM8(1,1),displacementMap:null,displacementScale:0,displacementBias:0,roughnessMap:null,metalnessMap:null,alphaMap:null,envMap:null,envMapIntensity:0,refractionRatio:0,wireframe:!1,wireframeLinewidth:0,skinning:!1,morphTargets:!1,morphNormals:!1,flatShading:!1,glossiness:0,glossinessMap:null,specularColor:new oi(0),specularColorMap:null},rh={...cu,clearcoat:0,clearcoatMap:null,clearcoatRoughness:0,clearcoatRoughnessMap:null,clearcoatNormalScale:new _.FM8(1,1),clearcoatNormalMap:null,reflectivity:.5,sheen:0,sheenColor:new oi(0),sheenColorMap:null,sheenRoughness:1,sheenRoughnessMap:null,specularIntensity:1,specularIntensityMap:null,specularColor:new oi(1,1,1),specularColorMap:null,transmission:0,transmissionMap:null,thickness:0,thicknessMap:null,attenuationDistance:0,attenuationColor:new oi(1,1,1),iridescenceMap:null,iridescenceIOR:1.3,iridescenceThicknessRange:[100,400],iridescenceThicknessMap:null};class jo extends _.EJi{constructor(e){var i;super(e),this.typeSlug=jo.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshStandardMaterial2=!0,this.extraUniformsToUpload={},this.setDirty=this.setDirty.bind(this),this.userData.setDirty=s=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(s)},this.fog=!1,this.materialExtensions=tr.RegisterExtensions(this,(i=e==null?void 0:e.customMaterialExtensions)!==null&&i!==void 0?i:[])}setDirty(e){var i,s;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(s=(i=this._uiConfig)===null||i===void 0?void 0:i.uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...tr.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},Er(this,"map"),{type:"folder",label:"Rough/Metal",limitedUi:!0,children:[{type:"slider",bounds:[0,1],property:[this,"roughness"],limitedUi:!0},{type:"slider",bounds:[0,1],property:[this,"metalness"],limitedUi:!0},{type:"image",property:[this,"roughnessMap"]},Er(this,"roughnessMap"),{type:"image",property:[this,"metalnessMap"]},Er(this,"metalnessMap")]},{type:"folder",label:"Bump/Normal",limitedUi:!0,children:[{type:"slider",bounds:[0,.2],stepSize:.001,property:[this,"bumpScale"],hidden:()=>!this.bumpMap},{type:"image",property:[this,"bumpMap"]},Er(this,"bumpMap"),{type:"image",property:[this,"normalMap"]},{type:"vec2",property:[this,"normalScale"],hidden:()=>!this.normalMap},{type:"dropdown",hidden:()=>!this.normalMap,property:[this,"normalMapType"],children:[["TangentSpace",_.IOt],["ObjectSpace",_.PA7]].map(e=>({label:e[0],value:e[1]}))},Er(this,"normalMap"),{type:"input",property:[this,"displacementScale"],hidden:()=>!this.displacementMap},{type:"image",property:[this,"displacementMap"]},Er(this,"displacementMap")]},{type:"folder",label:"Sheen",children:[{type:"slider",bounds:[0,1],property:[this,"sheen"]},{type:"color",hidden:()=>this.sheen<.001,property:[this,"sheenColor"]},{type:"image",property:[this,"sheenColorMap"]},Er(this,"sheenColorMap"),{type:"slider",bounds:[0,1],property:[this,"sheenRoughness"]},{type:"image",property:[this,"sheenRoughnessMap"]},Er(this,"sheenRoughnessMap")]},{type:"folder",label:"Clearcoat",children:[{type:"slider",bounds:[0,1],property:[this,"clearcoat"]},{type:"slider",bounds:[0,1],hidden:()=>this.clearcoat<.001,property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatMap"]},Er(this,"clearcoatMap"),{type:"slider",bounds:[0,1],property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatRoughnessMap"]},Er(this,"clearcoatRoughnessMap"),{type:"image",property:[this,"clearcoatNormalMap"]},{type:"vec2",property:[this,"clearcoatNormalScale"],hidden:()=>!this.clearcoatNormalMap},Er(this,"clearcoatNormalMap")]},{type:"folder",label:"Emission",children:[{type:"color",property:[this,"emissive"]},{type:"slider",bounds:[0,10],property:[this,"emissiveIntensity"]},{type:"image",property:[this,"emissiveMap"]},Er(this,"emissiveMap")]},{type:"folder",label:"Refraction",children:[{type:"slider",bounds:[0,1],property:[this,"reflectivity"]},{type:"slider",bounds:[0,1],property:[this,"transmission"],limitedUi:!0},{type:"slider",bounds:[0,1],stepSize:.001,property:[this,"thickness"]},{type:"image",property:[this,"transmissionMap"]},Er(this,"transmissionMap"),{type:"image",property:[this,"thicknessMap"]},Er(this,"thicknessMap")]},{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"dropdown",property:[this,"depthFunc"],children:[["Never",_.BVF],["Always",_.Se2],["Less",_.Zr5],["LessEqual",_.vCF],["Equal",_.eD],["GreaterEqual",_.ksN],["Greater",_.w$m],["NotEqual",_.M6v]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[this,"depthTest"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",ms],["Normal",Rr],["Additive",_.WMw],["Subtractive",Cr],["Multiply",Mr]].map(e=>({label:e[0],value:e[1]}))},{type:"image",property:[this,"alphaMap"]},Er(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}},{type:"checkbox",label:"Inverse AlphaMap",hidden:()=>!this.transparent,getValue:()=>this.userData.inverseAlphaMap===!0,setValue:e=>{this.userData.inverseAlphaMap=e||void 0,this.setDirty()}},{type:"checkbox",label:"Polygon Offset",property:[this,"polygonOffset"]},{type:"slider",label:"Polygon Offset Factor",bounds:[-10,10],property:[this,"polygonOffsetFactor"]},{type:"slider",label:"Polygon Offset Units",bounds:[-10,10],property:[this,"polygonOffsetUnits"]}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},Er(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},Er(this,"lightMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",_.Wl3],["Back",_._Li],["Double",_.ehD]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[this,"flatShading"]},{type:"input",label:"Mesh count",getValue:()=>{var e,i,s;return(s=(i=(e=this.userData)===null||e===void 0?void 0:e.__appliedMeshes)===null||i===void 0?void 0:i.size)!==null&&s!==void 0?s:0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{ts(new Blob([JSON.stringify(this.toJSON(),null,2)],{type:"application/json"}),`physical-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Physical Material",expanded:!0,children:this._uiConfigChildren,uuid:"MSM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var i;return(i=e.getUiConfig)===null||i===void 0?void 0:i.call(e,this)})].filter(e=>e),this._uiConfig}onBeforeCompile(e,i){const s=[["vec3 totalDiffuse = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["#include <lights_physical_fragment>","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],a=[["#include <uv_vertex>","mainStart"]];for(const h of a)e.vertexShader=gs(e.vertexShader,h[0],"#glMarker "+h[1]+`
`+h[0]);for(const h of s)e.fragmentShader=gs(e.fragmentShader,h[0],"#glMarker "+h[1]+`
`+h[0]);tr.ApplyMaterialExtensions(this,e,this.materialExtensions,i),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),e.defines.INVERSE_ALPHAMAP=this.userData.inverseAlphaMap?1:0,super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()+tr.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,i,s,a,h){super.onBeforeRender(e,i,s,a,h),this.dispatchEvent({type:"beforeRender",renderer:e,scene:i,camera:s,geometry:a,object:h});const d=this.userData.inverseAlphaMap?1:0;d!==this.defines.INVERSE_ALPHAMAP&&(this.defines.INVERSE_ALPHAMAP=d,this.needsUpdate=!0)}copyProps(e,i=!1){if(!i&&!["MeshStandardMaterial",jo.TYPE,"MeshPhysicalMaterial"].includes(e.type))return console.error("Material type is not supported:",e.type),this;const s={};Et(e,s,Array.from(Object.keys(rh)));const a=s.userData;delete s.userData;for(const h of Object.keys(s))s[h]===void 0&&delete s[h];return this.setValues(s),a&&as(this.userData,a),this.setDirty(),this}toJSON(e){var i,s;const a=this.userData;this.userData={};const h=super.toJSON(e);this.userData=a,h.userData={},as(h.userData,a),h.userData.uuid=this.userData.uuid;const d=e||{textures:Object.fromEntries(((i=h.textures)===null||i===void 0?void 0:i.map(b=>[b.uuid,b]))||[]),images:Object.fromEntries(((s=h.images)===null||s===void 0?void 0:s.map(b=>[b.uuid,b]))||[])};h.userData=qn(h.userData,!1,d),e||(Object.keys(d.textures).length>0&&(h.textures=Object.values(d.textures)),Object.keys(d.images).length>0&&(h.images=Object.values(d.images))),h.type=jo.TYPE;for(const b of Object.keys(h))h[b]===void 0&&delete h[b];return h}fromJSON(e,i,s=!1){return Array.isArray(e.normalScale)&&(e.normalScale=new _.FM8().fromArray(e.normalScale)),Array.isArray(e.clearcoatNormalScale)&&(e.clearcoatNormalScale=new _.FM8().fromArray(e.clearcoatNormalScale)),this.copyProps(e,s)}clone(){return super.clone()}}jo.TypeSlug="pmat",jo.TYPE="MeshStandardMaterial2";const qa={...Df,color:"#000000",map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,alphaMap:null,envMap:null,combine:_.Ns1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinewidth:0,skinning:!1};class zo extends _.vBJ{constructor(e){var i;super(e),this.typeSlug=zo.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshBasicMaterial2=!0,this.extraUniformsToUpload={},this.fog=!1,this.setDirty=this.setDirty.bind(this),this.userData.setDirty=s=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(s)},this.materialExtensions=tr.RegisterExtensions(this,(i=e==null?void 0:e.customMaterialExtensions)!==null&&i!==void 0?i:[])}setDirty(e){var i,s;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(s=(i=this._uiConfig)===null||i===void 0?void 0:i.uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...tr.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},Er(this,"map"),{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",ms],["Normal",Rr],["Additive",_.WMw],["Subtractive",Cr],["Multiply",Mr]].map(e=>({label:e[0],value:e[1]}))},{type:"image",property:[this,"alphaMap"]},Er(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},Er(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},Er(this,"lightMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",_.Wl3],["Back",_._Li],["Double",_.ehD]].map(e=>({label:e[0],value:e[1]}))},{type:"input",label:"Mesh count",getValue:()=>{var e,i,s;return(s=(i=(e=this.userData)===null||e===void 0?void 0:e.__appliedMeshes)===null||i===void 0?void 0:i.size)!==null&&s!==void 0?s:0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{ts(new Blob([JSON.stringify(this.toJSON(),null,2)],{type:"application/json"}),`unlit-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Unlit Material",expanded:!0,children:this._uiConfigChildren,uuid:"MBM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var i;return(i=e.getUiConfig)===null||i===void 0?void 0:i.call(e,this)})].filter(e=>e),this._uiConfig}onBeforeCompile(e,i){const s=[["vec3 outgoingLight = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["ReflectedLight reflectedLight = ","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],a=[["#include <uv_vertex>","mainStart"]];for(const h of a)e.vertexShader=gs(e.vertexShader,h[0],"#glMarker "+h[1]+`
`+h[0]);for(const h of s)e.fragmentShader=gs(e.fragmentShader,h[0],"#glMarker "+h[1]+`
`+h[0]);tr.ApplyMaterialExtensions(this,e,this.materialExtensions,i),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()+tr.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,i,s,a,h){super.onBeforeRender(e,i,s,a,h),this.dispatchEvent({type:"beforeRender",renderer:e,scene:i,camera:s,geometry:a,object:h})}copyProps(e,i=!1){if(!i&&!["MeshBasicMaterial",zo.TYPE].includes(e.type))return console.error("Material type is not supported:",e.type),this;const s={};Et(e,s,Array.from(Object.keys(qa)));const a=s.userData;delete s.userData;for(const h of Object.keys(s))s[h]===void 0&&delete s[h];return this.setValues(s),a&&as(this.userData,a),this.setDirty(),this}toJSON(e){var i,s;const a=this.userData;this.userData={};const h=super.toJSON(e);this.userData=a,h.userData={},as(h.userData,a),h.userData.uuid=this.userData.uuid;const d=e||{textures:Object.fromEntries(((i=h.textures)===null||i===void 0?void 0:i.map(b=>[b.uuid,b]))||[]),images:Object.fromEntries(((s=h.images)===null||s===void 0?void 0:s.map(b=>[b.uuid,b]))||[])};h.userData=qn(h.userData,!1,d),e||(Object.keys(d.textures).length>0&&(h.textures=Object.values(d.textures)),Object.keys(d.images).length>0&&(h.images=Object.values(d.images))),h.type=zo.TYPE;for(const b of Object.keys(h))h[b]===void 0&&delete h[b];return h}fromJSON(e,i,s=!1){return this.copyProps(e,s)}clone(){return super.clone()}}zo.TypeSlug="bmat",zo.TYPE="MeshBasicMaterial2";const sh={materialType:jo.TYPE,name:"standard",color:"#ffffff"},Zh={materialType:zo.TYPE,name:"basic",color:"#ffffff"},gp={[jo.TYPE]:sh.name,MeshStandardMaterial:sh.name,MeshPhysicalMaterial:sh.name,[zo.TYPE]:Zh.name,MeshBasicMaterial:Zh.name};class uu extends oe{constructor(){super(),this._templates=[sh,Zh],this._materials=[],this._disposeMaterial=e=>{const i=e.target;if(!i||i.assetType!=="material")return;this._refreshTextureRefs();const s=this._getMapsForMaterial(i),a=[];s.forEach(h=>{const d=h.userData.__appliedMaterials;d==null||d.delete(i),d&&h.userData.disposeOnIdle!==!1&&d.size===0&&a.push(h)}),a.forEach(h=>{h.dispose()}),this.unregisterMaterial(i)},this._materialExtensions=[],this.processModel=this.processModel.bind(this),this.processMaterial=this.processMaterial.bind(this)}findOrCreate(e,i){let s=this.findMaterial(e);return s||(s=this.generateFromTemplate(e,i)),s}generateFromTemplate(e,i){const s=this.findTemplate(e);if(s)return this._generateFromTemplate(s,i??{})}generateFromTemplateType(e,i){const s=this._templates.find(a=>a.materialType===e);if(s)return this._generateFromTemplate(s,i??{})}findTemplate(e){return this._templates.find(i=>i.name===e)}_refreshTextureRefs(){this.getAllMaterials().forEach(e=>{this._getMapsForMaterial(e).forEach(i=>{let s=i.userData.__appliedMaterials;s||(i.userData.__appliedMaterials=s=new Set),s.add(e)})})}_getMapsForMaterial(e){var i;const s=new Set;for(const a of Object.values(e))a&&a.isTexture&&s.add(a);for(const a of Object.values((i=e.userData)!==null&&i!==void 0?i:{}))a&&a.isTexture&&s.add(a);return s}registerMaterial(e){if(this._materials.includes(e))return;const i=this.findMaterial(e.uuid);i?console.warn("Material UUID already exists",e,i):(e.addEventListener("dispose",this._disposeMaterial),this._materials.push(e))}registerMaterialObject(e){const i=e.materialObject?e:Object.assign(e,{assetType:"material",materialObject:e});return this.registerMaterial(i),i}unregisterMaterial(e){this._materials=this._materials.filter(i=>i.uuid!==e.uuid),e.removeEventListener("dispose",this._disposeMaterial)}registerMaterialTemplate(e){e.templateUUID||(e.templateUUID=Ms());const i=this._templates.find(s=>s.templateUUID===e.templateUUID);i?console.warn("MaterialTemplate already exists",e,i):this._templates.push(e)}unregisterMaterialTemplate(e){this._templates=this._templates.filter(i=>i.templateUUID!==e.templateUUID)}dispose(){}findMaterial(e){return e?this._materials.find(i=>i.uuid===e):void 0}findMaterialsByName(e){return this._materials.filter(i=>i.name===e)}getMaterialsOfType(e){return e?this._materials.filter(i=>i.typeSlug===e):[]}getAllMaterials(){return[...this._materials]}processModel(e,i){return nt(e,"modelObject",this._processModel(e,i)),e}_processMaterial(e,i){var s,a,h;if(!e)return;if(!((s=e.materialObject)===null||s===void 0)&&s.isMaterial)return e;let d=e.mmMaterial;if(!d){const b=((a=e.userData)===null||a===void 0?void 0:a.uuid)||e.uuid;if(d=this.findMaterial(b),d)d.copyProps(e);else{const X=i.useSourceMaterial===!1||!e.isMaterial,$=(h=i.materialTemplate)!==null&&h!==void 0?h:X?"standard":gp[e.type]||"standard";d=this.generateFromTemplate($,X?{}:e)}e.mmMaterial=d}return d}processMaterial(e,i){return i.register!==!1&&this.registerMaterial(e),e.materialObject||(e=this._processMaterial(e,{...i,register:!1})),e}registerMaterialExtension(e){this._materialExtensions.includes(e)||this._materialExtensions.push(e)}unregisterMaterialExtension(e){const i=this._materialExtensions.indexOf(e);i>=0&&this._materialExtensions.splice(i,1)}exportMaterial(e,i,s=!0,a=!1){const h=qn(e,!1),d=JSON.stringify(h,null,s?0:2),b=(i||e.name||"physical_material")+"."+e.typeSlug,X=new File([d],b,{type:"application/json"});return a&&zl(X),X}}class hu extends uu{_generateFromTemplate(e,i){var s,a,h,d,b,X;let $;const Z={...e};Z.customMaterialExtensions=[...(s=Z.customMaterialExtensions)!==null&&s!==void 0?s:[],...this._materialExtensions];let re={};switch(e.materialType){case"MeshStandardMaterial2":case"standard":i&&Et(i,Z,Array.from(Object.keys(rh))),(i==null?void 0:i.type)==="MeshBasicMaterial"&&(Z.roughness=.9,Z.metalness=0,!((a=Z.userData)===null||a===void 0)&&a.uuid&&delete Z.userData.uuid),re=(h=Z.userData)===null||h===void 0?void 0:h.uuid,re&&delete Z.userData.uuid,$=new jo({customMaterialExtensions:Z.customMaterialExtensions}).fromJSON(Z,void 0,!0),re&&($.uuid=re),$.userData.uuid=$.uuid,$.setDirty(),i!=null&&i.isMaterial&&i.userData!==void 0&&(i.userData.iMaterial=$);break;case"MeshBasicMaterial2":case"basic":case"unlit":i&&Et(i,Z,Array.from(Object.keys(qa))),re=(d=Z.userData)===null||d===void 0?void 0:d.uuid,re&&delete Z.userData.uuid,$=new zo({customMaterialExtensions:Z.customMaterialExtensions}).fromJSON(Z,void 0,!0),re&&($.uuid=re),$.userData.uuid=$.uuid,$.setDirty();break;case"shadow":throw"TODO: Not implemented shadow material";default:re=null,i&&i.userData&&(re=i.userData,delete i.userData),$=((b=e.generator)===null||b===void 0?void 0:b.call(e,Z,i))||void 0,i&&re&&(i.userData=re),re&&$&&(as($.userData,re),re!=null&&re.uuid&&($.uuid=re.uuid),re=null),$&&($.userData.uuid=$.uuid)}if($){i.runtimeMaterial&&($.userData.__runtimeMaterial=!0);const le=$;if($.clone=()=>{le.userData.cloneId||(le.userData.cloneId="0",le.userData.cloneCount=0),le.userData.cloneCount+=1;const he=this.generateFromTemplate(e.name);return he&&(he.copyProps(le),he.userData.cloneId=he.userData.cloneId+"_"+le.userData.cloneCount,he.userData.cloneCount=0,he.name=he.name+"_"+he.userData.cloneId),he==null?void 0:he.materialObject},i){let he=this.findMaterial(i==null?void 0:i.uuid);he&&this.unregisterMaterial(he),he=this.findMaterial((X=i==null?void 0:i.materialObject)===null||X===void 0?void 0:X.uuid),he&&this.unregisterMaterial(he)}return this.registerMaterialObject(le)}}_processModel(e,i){if(!e.modelObject)return console.error("MaterialManager: No modelObject found for ",e),e;let s=e.material;if(!s&&e.geometry&&(this._defaultMaterial||(this._defaultMaterial=this.generateFromTemplate("standard")),s=this._defaultMaterial,e.material=s),s){let a=!0;Array.isArray(s)||(s=[s],a=!1);const h=[];for(const d of s){const b=this._processMaterial(d,i);h.push(b==null?void 0:b.materialObject)}e.setMaterial&&(e.modelObject.material=null,e.setMaterial(a?h:h[0]))}if(i.recursive!==!1)for(let a=0;a<e.modelObject.children.length;a++)e.modelObject.children[a]=this._processModel(e.modelObject.children[a],i);return e}}class _s{constructor(e,i,s,a){this.cls=e,this.ext=i,this.root=s,this.onCtor=a}ctor(e){const i=this.cls&&new this.cls(e.loadingManager);return typeof this.onCtor=="function"?this.onCtor(i,e):i}}function pg(c){var e;if(!c||c===""||c.match(/__MACOSX\/.*\._/))return"";const i=(e=(c=c.replace(/\?.*$/,"")).split(/[\\/]/).pop())!==null&&e!==void 0?e:"",s=i.lastIndexOf(".");return i===""||s<1?"":i.slice(s+1)}function Ev(c){return c.substring(c.lastIndexOf("/")+1)}class _p{constructor(e,{pseudoCenter:i=!1,autoCenter:s=!1,autoScale:a=!1,autoScaleRadius:h=2,license:d=""}={}){if(this.assetType="model",this._modelObject=Fr(new _.Tme),this.setDirty=this.setDirty.bind(this),this.updateBounds=this.updateBounds.bind(this),e||(e=this._modelObject),!i||e.userData.pseudoCentered||e.userData.isCentered)!s||e.userData.autoCentered||e.userData.isCentered||e.userData.pseudoCentered?i||s||(e.userData.isCentered=!0):hi(e),this._modelObject=e;else{s&&console.error("cannot use pseudoCenter and autoCenter at the same time");const b=new nn().expandByObject(e,!0,!0).getCenter(new _.Pa4);this._modelObject.position.copy(b).negate(),this._modelObject.updateMatrix(),this._modelObject.add(e),this._modelObject.name=e.name+"-centered",this._modelObject.userData.pseudoCentered=!0,this._modelObject.userData.isCentered=!0,e.userData.iModel=this}a&&!this._modelObject.userData.autoScaled?$n(this._modelObject,e.userData.autoScaleRadius||h):this._modelObject.userData.autoScaled=!0,this._modelObject.addEventListener("dispose",()=>{this.__disposed=!0}),this._modelObject.userData.iModel=this,this.license=d}get visible(){return this._modelObject.visible}set visible(e){this._modelObject.visible=e}get uuid(){return this._modelObject.uuid}get modelObject(){return this._modelObject}get name(){return this._modelObject.name}set name(e){this._modelObject.name=e}get license(){return this._modelObject.userData.license}set license(e){this._modelObject.userData.license=e}addEventListener(e,i){this._modelObject.addEventListener(e,i)}dispatchEvent(e){this._modelObject.dispatchEvent(e)}hasEventListener(e,i){return this._modelObject.hasEventListener(e,i)}removeEventListener(e,i){this._modelObject.removeEventListener(e,i)}traverse(e){this._modelObject.traverse(e)}dispose(){const e=this._modelObject.dispose;e&&typeof e=="function"?e():(console.warn("no dispose in modelObject"),this._modelObject.removeFromParent())}setDirty(e){var i,s,a,h;(s=(i=this._modelObject)===null||i===void 0?void 0:i.setDirty)===null||s===void 0||s.call(i,e),(h=(a=this._uiConfig)===null||a===void 0?void 0:a.uiRefresh)===null||h===void 0||h.call(a,"postFrame",!0)}setMaterial(e){var i,s;return this._modelObject.isMesh?((s=(i=this._modelObject).setMaterial)===null||s===void 0?void 0:s.call(i,e))||[]:(console.error("setMaterial only works on meshes"),[])}get material(){return this._modelObject.material}get geometry(){return this._modelObject.geometry}setGeometry(e,i=!1){var s,a;if(this._modelObject.isMesh)return(a=(s=this._modelObject).setGeometry)===null||a===void 0?void 0:a.call(s,e,i);console.error("setGeometry only works on meshes")}get userData(){return this._modelObject.userData}set userData(e){this._modelObject.userData=e}updateBounds(){console.warn("updateBounds: NOT IMPLEMENTED"),this.setDirty()}get uiConfig(){return this._uiConfig||(this._uiConfig=Ii(this._modelObject,!1)),this._uiConfig}clone(){return new _p(this._modelObject.clone(),{pseudoCenter:!1,autoScale:!1,autoCenter:!1,license:this.license})}}function _l(c,e){return[c.modelObject,...c.modelObject.children].forEach(i=>{Fr(i,i!==c.modelObject?c:void 0,e)}),c}class oh{constructor(){this._processors=new Map}add(e,i){var s;this._processors.has(e)||this._processors.set(e,[]),(s=this._processors.get(e))===null||s===void 0||s.push(i)}remove(e,i){const s=this._processors.get(e),a=(s==null?void 0:s.indexOf(i))||(s==null?void 0:s.findIndex(h=>h.process&&h.process===i.process||h.processAsync&&h.processAsync===i.processAsync));!s||!a||a<0||s.splice(a,1)}get(e){var i;return(i=this._processors.get(e))!==null&&i!==void 0?i:[]}async process(e,i,s){var a,h,d,b;const X=this.get(e),$=i.assetType;for(const Z of X)Z.forAssetType===$&&(i=(h=(a=Z.process)===null||a===void 0?void 0:a.call(Z,i,s))!==null&&h!==void 0?h:i,i=(b=await((d=Z.processAsync)===null||d===void 0?void 0:d.call(Z,i,s)))!==null&&b!==void 0?b:i);return i}dispose(){this._processors.clear()}}class va extends _.hH6{load(e,i,s,a){return super.load(e,h=>{try{if(typeof h!="string")throw new Error("Invalid JSON");i==null||i(JSON.parse(h))}catch(d){a==null||a(d)}},s,a)}}class js extends _.yxD{constructor(e){super(e),this.type=_.cLu}parse(e){const i=function(X,$){switch(X){case 1:console.error("THREE.RGBELoader Read Error: "+($||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+($||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+($||""));break;default:console.error("THREE.RGBELoader: Error: "+($||""))}return-1},s=function(X,$,Z){$=$||1024;let re=X.pos,le=-1,he=0,fe="",me=String.fromCharCode.apply(null,new Uint16Array(X.subarray(re,re+128)));for(;0>(le=me.indexOf(`
`))&&he<$&&re<X.byteLength;)fe+=me,he+=me.length,re+=128,me+=String.fromCharCode.apply(null,new Uint16Array(X.subarray(re,re+128)));return-1<le&&(Z!==!1&&(X.pos+=he+le+1),fe+me.slice(0,le))},a=function(X,$,Z,re){const le=X[$+3],he=Math.pow(2,le-128)/255;Z[re+0]=X[$+0]*he,Z[re+1]=X[$+1]*he,Z[re+2]=X[$+2]*he,Z[re+3]=1},h=function(X,$,Z,re){const le=X[$+3],he=Math.pow(2,le-128)/255;Z[re+0]=_.A5E.toHalfFloat(Math.min(X[$+0]*he,65504)),Z[re+1]=_.A5E.toHalfFloat(Math.min(X[$+1]*he,65504)),Z[re+2]=_.A5E.toHalfFloat(Math.min(X[$+2]*he,65504)),Z[re+3]=_.A5E.toHalfFloat(1)},d=new Uint8Array(e);d.pos=0;const b=function(X){const $=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,Z=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,re=/^\s*FORMAT=(\S+)\s*$/,le=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,he={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let fe,me;if(X.pos>=X.byteLength||!(fe=s(X)))return i(1,"no header found");if(!(me=fe.match(/^#\?(\S+)/)))return i(3,"bad initial token");for(he.valid|=1,he.programtype=me[1],he.string+=fe+`
`;fe=s(X),fe!==!1;)if(he.string+=fe+`
`,fe.charAt(0)!=="#"){if((me=fe.match($))&&(he.gamma=parseFloat(me[1])),(me=fe.match(Z))&&(he.exposure=parseFloat(me[1])),(me=fe.match(re))&&(he.valid|=2,he.format=me[1]),(me=fe.match(le))&&(he.valid|=4,he.height=parseInt(me[1],10),he.width=parseInt(me[2],10)),2&he.valid&&4&he.valid)break}else he.comments+=fe+`
`;return 2&he.valid?4&he.valid?he:i(3,"missing image size specifier"):i(3,"missing format specifier")}(d);if(b!==-1){const X=b.width,$=b.height,Z=function(re,le,he){const fe=le;if(fe<8||fe>32767||re[0]!==2||re[1]!==2||128&re[2])return new Uint8Array(re);if(fe!==(re[2]<<8|re[3]))return i(3,"wrong scanline width");const me=new Uint8Array(4*le*he);if(!me.length)return i(4,"unable to allocate buffer space");let Ee=0,Ae=0;const ye=4*fe,ge=new Uint8Array(4),Pe=new Uint8Array(ye);let Be=he;for(;Be>0&&Ae<re.byteLength;){if(Ae+4>re.byteLength)return i(1);if(ge[0]=re[Ae++],ge[1]=re[Ae++],ge[2]=re[Ae++],ge[3]=re[Ae++],ge[0]!=2||ge[1]!=2||(ge[2]<<8|ge[3])!=fe)return i(3,"bad rgbe scanline format");let Oe,Fe=0;for(;Fe<ye&&Ae<re.byteLength;){Oe=re[Ae++];const at=Oe>128;if(at&&(Oe-=128),Oe===0||Fe+Oe>ye)return i(3,"bad scanline data");if(at){const mt=re[Ae++];for(let wt=0;wt<Oe;wt++)Pe[Fe++]=mt}else Pe.set(re.subarray(Ae,Ae+Oe),Fe),Fe+=Oe,Ae+=Oe}const Xe=fe;for(let at=0;at<Xe;at++){let mt=0;me[Ee]=Pe[at+mt],mt+=fe,me[Ee+1]=Pe[at+mt],mt+=fe,me[Ee+2]=Pe[at+mt],mt+=fe,me[Ee+3]=Pe[at+mt],Ee+=4}Be--}return me}(d.subarray(d.pos),X,$);if(Z!==-1){let re,le,he;switch(this.type){case _.VzW:he=Z.length/4;const fe=new Float32Array(4*he);for(let Ee=0;Ee<he;Ee++)a(Z,4*Ee,fe,4*Ee);re=fe,le=_.VzW;break;case _.cLu:he=Z.length/4;const me=new Uint16Array(4*he);for(let Ee=0;Ee<he;Ee++)h(Z,4*Ee,me,4*Ee);re=me,le=_.cLu;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:X,height:$,data:re,header:b.string,gamma:b.gamma,exposure:b.exposure,type:le}}}return null}setDataType(e){return this.type=e,this}load(e,i,s,a){return super.load(e,function(h,d){switch(h.type){case _.VzW:case _.cLu:h.encoding=_.rnI,h.minFilter=_.wem,h.magFilter=_.wem,h.generateMipmaps=!1,h.flipY=!0}i&&i(h,d)},s,a)}}function vp(c){yr.Importers.push(new _s(class extends js{constructor(e){super(e),this.setDataType(Lv(c))}},["hdr"],!1))}class du extends _.aNw{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(i){return new nd(i)}),this.register(function(i){return new go(i)}),this.register(function(i){return new fg(i)}),this.register(function(i){return new Vo(i)}),this.register(function(i){return new Vl(i)}),this.register(function(i){return new ns(i)}),this.register(function(i){return new Pf(i)}),this.register(function(i){return new td(i)}),this.register(function(i){return new Bn(i)}),this.register(function(i){return new Ic(i)}),this.register(function(i){return new Si(i)}),this.register(function(i){return new Sv(i)})}load(e,i,s,a){const h=this;let d;d=this.resourcePath!==""?this.resourcePath:this.path!==""?this.path:_.Zp0.extractUrlBase(e),this.manager.itemStart(e);const b=function($){a?a($):console.error($),h.manager.itemError(e),h.manager.itemEnd(e)},X=new _.hH6(this.manager);X.setPath(this.path),X.setResponseType("arraybuffer"),X.setRequestHeader(this.requestHeader),X.setWithCredentials(this.withCredentials),X.load(e,function($){try{h.parse($,d,function(Z){i(Z),h.manager.itemEnd(e)},b)}catch(Z){b(Z)}},s,b)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,i,s,a){let h;const d={},b={};if(typeof e=="string")h=e;else if(_.Zp0.decodeText(new Uint8Array(e,0,4))===Dc){try{d[Oi.KHR_BINARY_GLTF]=new pu(e)}catch(Z){return void(a&&a(Z))}h=d[Oi.KHR_BINARY_GLTF].content}else h=_.Zp0.decodeText(new Uint8Array(e));const X=JSON.parse(h);if(X.asset===void 0||X.asset.version[0]<2)return void(a&&a(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const $=new ch(X,{path:i||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});$.fileLoader.setRequestHeader(this.requestHeader);for(let Z=0;Z<this.pluginCallbacks.length;Z++){const re=this.pluginCallbacks[Z]($);b[re.name]=re,d[re.name]=!0}if(X.extensionsUsed)for(let Z=0;Z<X.extensionsUsed.length;++Z){const re=X.extensionsUsed[Z],le=X.extensionsRequired||[];switch(re){case Oi.KHR_MATERIALS_UNLIT:d[re]=new vl;break;case Oi.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:d[re]=new Ra;break;case Oi.KHR_DRACO_MESH_COMPRESSION:d[re]=new Al(X,this.dracoLoader);break;case Oi.KHR_TEXTURE_TRANSFORM:d[re]=new id;break;case Oi.KHR_MESH_QUANTIZATION:d[re]=new Rf;break;default:le.indexOf(re)>=0&&b[re]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+re+'".')}}$.setExtensions(d),$.setPlugins(b),$.parse(s,a)}parseAsync(e,i){const s=this;return new Promise(function(a,h){s.parse(e,i,a,h)})}}function ed(){let c={};return{get:function(e){return c[e]},add:function(e,i){c[e]=i},remove:function(e){delete c[e]},removeAll:function(){c={}}}}const Oi={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class Si{constructor(e){this.parser=e,this.name=Oi.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,i=this.parser.json.nodes||[];for(let s=0,a=i.length;s<a;s++){const h=i[s];h.extensions&&h.extensions[this.name]&&h.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,h.extensions[this.name].light)}}_loadLight(e){const i=this.parser,s="light:"+e;let a=i.cache.get(s);if(a)return a;const h=i.json,d=((h.extensions&&h.extensions[this.name]||{}).lights||[])[e];let b;const X=new _.Ilk(16777215);d.color!==void 0&&X.fromArray(d.color);const $=d.range!==void 0?d.range:0;switch(d.type){case"directional":b=new _.Ox3(X),b.target.position.set(0,0,-1),b.add(b.target);break;case"point":b=new _.cek(X),b.distance=$;break;case"spot":b=new _.PMe(X),b.distance=$,d.spot=d.spot||{},d.spot.innerConeAngle=d.spot.innerConeAngle!==void 0?d.spot.innerConeAngle:0,d.spot.outerConeAngle=d.spot.outerConeAngle!==void 0?d.spot.outerConeAngle:Math.PI/4,b.angle=d.spot.outerConeAngle,b.penumbra=1-d.spot.innerConeAngle/d.spot.outerConeAngle,b.target.position.set(0,0,-1),b.add(b.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+d.type)}return b.position.set(0,0,0),b.decay=2,d.intensity!==void 0&&(b.intensity=d.intensity),b.name=i.createUniqueName(d.name||"light_"+e),a=Promise.resolve(b),i.cache.add(s,a),a}createNodeAttachment(e){const i=this,s=this.parser,a=s.json.nodes[e],h=(a.extensions&&a.extensions[this.name]||{}).light;return h===void 0?null:this._loadLight(h).then(function(d){return s._getNodeRef(i.cache,h,d)})}}class vl{constructor(){this.name=Oi.KHR_MATERIALS_UNLIT}getMaterialType(){return _.vBJ}extendParams(e,i,s){const a=[];e.color=new _.Ilk(1,1,1),e.opacity=1;const h=i.pbrMetallicRoughness;if(h){if(Array.isArray(h.baseColorFactor)){const d=h.baseColorFactor;e.color.fromArray(d),e.opacity=d[3]}h.baseColorTexture!==void 0&&a.push(s.assignTexture(e,"map",h.baseColorTexture,_.knz))}return Promise.all(a)}}class td{constructor(e){this.parser=e,this.name=Oi.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name].emissiveStrength;return a!==void 0&&(i.emissiveIntensity=a),Promise.resolve()}}class nd{constructor(e){this.parser=e,this.name=Oi.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?_.EJi:null}extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],d=a.extensions[this.name];if(d.clearcoatFactor!==void 0&&(i.clearcoat=d.clearcoatFactor),d.clearcoatTexture!==void 0&&h.push(s.assignTexture(i,"clearcoatMap",d.clearcoatTexture)),d.clearcoatRoughnessFactor!==void 0&&(i.clearcoatRoughness=d.clearcoatRoughnessFactor),d.clearcoatRoughnessTexture!==void 0&&h.push(s.assignTexture(i,"clearcoatRoughnessMap",d.clearcoatRoughnessTexture)),d.clearcoatNormalTexture!==void 0&&(h.push(s.assignTexture(i,"clearcoatNormalMap",d.clearcoatNormalTexture)),d.clearcoatNormalTexture.scale!==void 0)){const b=d.clearcoatNormalTexture.scale;i.clearcoatNormalScale=new _.FM8(b,b)}return Promise.all(h)}}class Ic{constructor(e){this.parser=e,this.name=Oi.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?_.EJi:null}extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],d=a.extensions[this.name];return d.iridescenceFactor!==void 0&&(i.iridescence=d.iridescenceFactor),d.iridescenceTexture!==void 0&&h.push(s.assignTexture(i,"iridescenceMap",d.iridescenceTexture)),d.iridescenceIor!==void 0&&(i.iridescenceIOR=d.iridescenceIor),i.iridescenceThicknessRange===void 0&&(i.iridescenceThicknessRange=[100,400]),d.iridescenceThicknessMinimum!==void 0&&(i.iridescenceThicknessRange[0]=d.iridescenceThicknessMinimum),d.iridescenceThicknessMaximum!==void 0&&(i.iridescenceThicknessRange[1]=d.iridescenceThicknessMaximum),d.iridescenceThicknessTexture!==void 0&&h.push(s.assignTexture(i,"iridescenceThicknessMap",d.iridescenceThicknessTexture)),Promise.all(h)}}class Vo{constructor(e){this.parser=e,this.name=Oi.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?_.EJi:null}extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[];i.sheenColor=new _.Ilk(0,0,0),i.sheenRoughness=0,i.sheen=1;const d=a.extensions[this.name];return d.sheenColorFactor!==void 0&&i.sheenColor.fromArray(d.sheenColorFactor),d.sheenRoughnessFactor!==void 0&&(i.sheenRoughness=d.sheenRoughnessFactor),d.sheenColorTexture!==void 0&&h.push(s.assignTexture(i,"sheenColorMap",d.sheenColorTexture,_.knz)),d.sheenRoughnessTexture!==void 0&&h.push(s.assignTexture(i,"sheenRoughnessMap",d.sheenRoughnessTexture)),a.extras&&a.extras.sheenFactor!==void 0&&(i.sheen=a.extras.sheenFactor,delete a.extras.sheenFactor),Promise.all(h)}}class Vl{constructor(e){this.parser=e,this.name=Oi.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?_.EJi:null}extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],d=a.extensions[this.name];return d.transmissionFactor!==void 0&&(i.transmission=d.transmissionFactor),d.transmissionTexture!==void 0&&h.push(s.assignTexture(i,"transmissionMap",d.transmissionTexture)),Promise.all(h)}}class ns{constructor(e){this.parser=e,this.name=Oi.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?_.EJi:null}extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],d=a.extensions[this.name];i.thickness=d.thicknessFactor!==void 0?d.thicknessFactor:0,d.thicknessTexture!==void 0&&h.push(s.assignTexture(i,"thicknessMap",d.thicknessTexture)),i.attenuationDistance=d.attenuationDistance||0;const b=d.attenuationColor||[1,1,1];return i.attenuationColor=new _.Ilk(b[0],b[1],b[2]),Promise.all(h)}}class Pf{constructor(e){this.parser=e,this.name=Oi.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?_.EJi:null}extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name];return i.ior=a.ior!==void 0?a.ior:1.5,Promise.resolve()}}class Bn{constructor(e){this.parser=e,this.name=Oi.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?_.EJi:null}extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],d=a.extensions[this.name];i.specularIntensity=d.specularFactor!==void 0?d.specularFactor:1,d.specularTexture!==void 0&&h.push(s.assignTexture(i,"specularIntensityMap",d.specularTexture));const b=d.specularColorFactor||[1,1,1];return i.specularColor=new _.Ilk(b[0],b[1],b[2]),d.specularColorTexture!==void 0&&h.push(s.assignTexture(i,"specularColorMap",d.specularColorTexture,_.knz)),Promise.all(h)}}class go{constructor(e){this.parser=e,this.name=Oi.KHR_TEXTURE_BASISU}loadTexture(e){const i=this.parser,s=i.json,a=s.textures[e];if(!a.extensions||!a.extensions[this.name])return null;const h=a.extensions[this.name],d=i.options.ktx2Loader;if(!d){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return i.loadTextureImage(e,h.source,d)}}class fg{constructor(e){this.parser=e,this.name=Oi.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const i=this.name,s=this.parser,a=s.json,h=a.textures[e];if(!h.extensions||!h.extensions[i])return null;const d=h.extensions[i],b=a.images[d.source];let X=s.textureLoader;if(b.uri){const $=s.options.manager.getHandler(b.uri);$!==null&&(X=$)}return this.detectSupport().then(function($){if($)return s.loadTextureImage(e,d.source,X);if(a.extensionsRequired&&a.extensionsRequired.indexOf(i)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const i=new Image;i.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",i.onload=i.onerror=function(){e(i.height===1)}})),this.isSupported}}class Sv{constructor(e){this.name=Oi.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const i=this.parser.json,s=i.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const a=s.extensions[this.name],h=this.parser.getDependency("buffer",a.buffer),d=this.parser.options.meshoptDecoder;if(!d||!d.supported){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return h.then(function(b){const X=a.byteOffset||0,$=a.byteLength||0,Z=a.count,re=a.byteStride,le=new Uint8Array(b,X,$);return d.decodeGltfBufferAsync?d.decodeGltfBufferAsync(Z,re,le,a.mode,a.filter).then(function(he){return he.buffer}):d.ready.then(function(){const he=new ArrayBuffer(Z*re);return d.decodeGltfBuffer(new Uint8Array(he),Z,re,le,a.mode,a.filter),he})})}return null}}const Dc="glTF";class pu{constructor(e){this.name=Oi.KHR_BINARY_GLTF,this.content=null,this.body=null;const i=new DataView(e,0,12);if(this.header={magic:_.Zp0.decodeText(new Uint8Array(e.slice(0,4))),version:i.getUint32(4,!0),length:i.getUint32(8,!0)},this.header.magic!==Dc)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-12,a=new DataView(e,12);let h=0;for(;h<s;){const d=a.getUint32(h,!0);h+=4;const b=a.getUint32(h,!0);if(h+=4,b===1313821514){const X=new Uint8Array(e,12+h,d);this.content=_.Zp0.decodeText(X)}else if(b===5130562){const X=12+h;this.body=e.slice(X,X+d)}h+=d}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Al{constructor(e,i){if(!i)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Oi.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=i,this.dracoLoader.preload()}decodePrimitive(e,i){const s=this.json,a=this.dracoLoader,h=e.extensions[this.name].bufferView,d=e.extensions[this.name].attributes,b={},X={},$={};for(const Z in d){const re=mu[Z]||Z.toLowerCase();b[re]=d[Z]}for(const Z in e.attributes){const re=mu[Z]||Z.toLowerCase();if(d[Z]!==void 0){const le=s.accessors[e.attributes[Z]],he=Ba[le.componentType];$[re]=he.name,X[re]=le.normalized===!0}}return i.getDependency("bufferView",h).then(function(Z){return new Promise(function(re){a.decodeDracoFile(Z,function(le){for(const he in le.attributes){const fe=le.attributes[he],me=X[he];me!==void 0&&(fe.normalized=me)}re(le)},b,$)})})}}class id{constructor(){this.name=Oi.KHR_TEXTURE_TRANSFORM}extendTexture(e,i){return i.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),i.offset===void 0&&i.rotation===void 0&&i.scale===void 0||(e=e.clone(),i.offset!==void 0&&e.offset.fromArray(i.offset),i.rotation!==void 0&&(e.rotation=i.rotation),i.scale!==void 0&&e.repeat.fromArray(i.scale),e.needsUpdate=!0),e}}class Pc extends _.Wid{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const i=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),s=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),a=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),h=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),d=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),b={specular:{value:new _.Ilk().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=b,this.onBeforeCompile=function(X){for(const $ in b)X.uniforms[$]=b[$];X.fragmentShader=X.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",i).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",a).replace("#include <metalnessmap_fragment>",h).replace("#include <lights_physical_fragment>",d)},Object.defineProperties(this,{specular:{get:function(){return b.specular.value},set:function(X){b.specular.value=X}},specularMap:{get:function(){return b.specularMap.value},set:function(X){b.specularMap.value=X,X?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return b.glossiness.value},set:function(X){b.glossiness.value=X}},glossinessMap:{get:function(){return b.glossinessMap.value},set:function(X){b.glossinessMap.value=X,X?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class Ra{constructor(){this.name=Oi.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return Pc}extendParams(e,i,s){const a=i.extensions[this.name];e.color=new _.Ilk(1,1,1),e.opacity=1;const h=[];if(Array.isArray(a.diffuseFactor)){const d=a.diffuseFactor;e.color.fromArray(d),e.opacity=d[3]}if(a.diffuseTexture!==void 0&&h.push(s.assignTexture(e,"map",a.diffuseTexture,_.knz)),e.emissive=new _.Ilk(0,0,0),e.glossiness=a.glossinessFactor!==void 0?a.glossinessFactor:1,e.specular=new _.Ilk(1,1,1),Array.isArray(a.specularFactor)&&e.specular.fromArray(a.specularFactor),a.specularGlossinessTexture!==void 0){const d=a.specularGlossinessTexture;h.push(s.assignTexture(e,"glossinessMap",d)),h.push(s.assignTexture(e,"specularMap",d,_.knz))}return Promise.all(h)}createMaterial(e){const i=new Pc(e);return i.fog=!0,i.color=e.color,i.map=e.map===void 0?null:e.map,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=e.aoMap===void 0?null:e.aoMap,i.aoMapIntensity=1,i.emissive=e.emissive,i.emissiveIntensity=e.emissiveIntensity===void 0?1:e.emissiveIntensity,i.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,i.bumpMap=e.bumpMap===void 0?null:e.bumpMap,i.bumpScale=1,i.normalMap=e.normalMap===void 0?null:e.normalMap,i.normalMapType=_.IOt,e.normalScale&&(i.normalScale=e.normalScale),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.specularMap=e.specularMap===void 0?null:e.specularMap,i.specular=e.specular,i.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,i.glossiness=e.glossiness,i.alphaMap=null,i.envMap=e.envMap===void 0?null:e.envMap,i.envMapIntensity=1,i}}class Rf{constructor(){this.name=Oi.KHR_MESH_QUANTIZATION}}class Ts extends _._C8{constructor(e,i,s,a){super(e,i,s,a)}copySampleValue_(e){const i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,h=e*a*3+a;for(let d=0;d!==a;d++)i[d]=s[h+d];return i}interpolate_(e,i,s,a){const h=this.resultBuffer,d=this.sampleValues,b=this.valueSize,X=2*b,$=3*b,Z=a-i,re=(s-i)/Z,le=re*re,he=le*re,fe=e*$,me=fe-$,Ee=-2*he+3*le,Ae=he-le,ye=1-Ee,ge=Ae-le+re;for(let Pe=0;Pe!==b;Pe++){const Be=d[me+Pe+b],Oe=d[me+Pe+X]*Z,Fe=d[fe+Pe+b],Xe=d[fe+Pe]*Z;h[Pe]=ye*Be+ge*Oe+Ee*Fe+Ae*Xe}return h}}const Ya=new _._fP;class Ap extends Ts{interpolate_(e,i,s,a){const h=super.interpolate_(e,i,s,a);return Ya.fromArray(h).normalize().toArray(h),h}}const Ba={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},rd={9728:_.TyD,9729:_.wem,9984:_.YLQ,9985:_.qyh,9986:_.aH4,9987:_.D1R},ci={33071:_.uWy,33648:_.OoA,10497:_.rpg},fu={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},mu={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ka={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},sd={CUBICSPLINE:void 0,LINEAR:_.NMF,STEP:_.Syv};function ah(c,e,i){for(const s in i.extensions)c[s]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=i.extensions[s])}function vs(c,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(c.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Vr(c,e){if(c.updateMorphTargets(),e.weights!==void 0)for(let i=0,s=e.weights.length;i<s;i++)c.morphTargetInfluences[i]=e.weights[i];if(e.extras&&Array.isArray(e.extras.targetNames)){const i=e.extras.targetNames;if(c.morphTargetInfluences.length===i.length){c.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++)c.morphTargetDictionary[i[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Aa(c){const e=c.extensions&&c.extensions[Oi.KHR_DRACO_MESH_COMPRESSION];let i;return i=e?"draco:"+e.bufferView+":"+e.indices+":"+lh(e.attributes):c.indices+":"+lh(c.attributes)+":"+c.mode,i}function lh(c){let e="";const i=Object.keys(c).sort();for(let s=0,a=i.length;s<a;s++)e+=i[s]+":"+c[i[s]]+";";return e}function Bf(c){switch(c){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class ch{constructor(e={},i={}){this.json=e,this.extensions={},this.plugins={},this.options=i,this.cache=new ed,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const s=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,a=navigator.userAgent.indexOf("Firefox")>-1,h=a?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;typeof createImageBitmap>"u"||s||a&&h<98?this.textureLoader=new _.dpR(this.options.manager):this.textureLoader=new _.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new _.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,i){const s=this,a=this.json,h=this.extensions;this.cache.removeAll(),this._invokeAll(function(d){return d._markDefs&&d._markDefs()}),Promise.all(this._invokeAll(function(d){return d.beforeRoot&&d.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(d){const b={scene:d[0][a.scene||0],scenes:d[0],animations:d[1],cameras:d[2],asset:a.asset,parser:s,userData:{}};ah(h,b,a),vs(b,a),Promise.all(s._invokeAll(function(X){return X.afterRoot&&X.afterRoot(b)})).then(function(){e(b)})}).catch(i)}_markDefs(){const e=this.json.nodes||[],i=this.json.skins||[],s=this.json.meshes||[];for(let a=0,h=i.length;a<h;a++){const d=i[a].joints;for(let b=0,X=d.length;b<X;b++)e[d[b]].isBone=!0}for(let a=0,h=e.length;a<h;a++){const d=e[a];d.mesh!==void 0&&(this._addNodeRef(this.meshCache,d.mesh),d.skin!==void 0&&(s[d.mesh].isSkinnedMesh=!0)),d.camera!==void 0&&this._addNodeRef(this.cameraCache,d.camera)}}_addNodeRef(e,i){i!==void 0&&(e.refs[i]===void 0&&(e.refs[i]=e.uses[i]=0),e.refs[i]++)}_getNodeRef(e,i,s){if(e.refs[i]<=1)return s;const a=s.clone(),h=(d,b)=>{const X=this.associations.get(d);X!=null&&this.associations.set(b,X);for(const[$,Z]of d.children.entries())h(Z,b.children[$])};return h(s,a),a.name+="_instance_"+e.uses[i]++,a}_invokeOne(e){const i=Object.values(this.plugins);i.push(this);for(let s=0;s<i.length;s++){const a=e(i[s]);if(a)return a}return null}_invokeAll(e){const i=Object.values(this.plugins);i.unshift(this);const s=[];for(let a=0;a<i.length;a++){const h=e(i[a]);h&&s.push(h)}return s}getDependency(e,i){const s=e+":"+i;let a=this.cache.get(s);if(!a){switch(e){case"scene":a=this.loadScene(i);break;case"node":a=this.loadNode(i);break;case"mesh":a=this._invokeOne(function(h){return h.loadMesh&&h.loadMesh(i)});break;case"accessor":a=this.loadAccessor(i);break;case"bufferView":a=this._invokeOne(function(h){return h.loadBufferView&&h.loadBufferView(i)});break;case"buffer":a=this.loadBuffer(i);break;case"material":a=this._invokeOne(function(h){return h.loadMaterial&&h.loadMaterial(i)});break;case"texture":a=this._invokeOne(function(h){return h.loadTexture&&h.loadTexture(i)});break;case"skin":a=this.loadSkin(i);break;case"animation":a=this._invokeOne(function(h){return h.loadAnimation&&h.loadAnimation(i)});break;case"camera":a=this.loadCamera(i);break;default:throw new Error("Unknown type: "+e)}this.cache.add(s,a)}return a}getDependencies(e){let i=this.cache.get(e);if(!i){const s=this,a=this.json[e+(e==="mesh"?"es":"s")]||[];i=Promise.all(a.map(function(h,d){return s.getDependency(e,d)})),this.cache.add(e,i)}return i}loadBuffer(e){const i=this.json.buffers[e],s=this.fileLoader;if(i.type&&i.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+i.type+" buffer type is not supported.");if(i.uri===void 0&&e===0)return Promise.resolve(this.extensions[Oi.KHR_BINARY_GLTF].body);const a=this.options;return new Promise(function(h,d){s.load(_.Zp0.resolveURL(i.uri,a.path),h,void 0,function(){d(new Error('THREE.GLTFLoader: Failed to load buffer "'+i.uri+'".'))})})}loadBufferView(e){const i=this.json.bufferViews[e];return this.getDependency("buffer",i.buffer).then(function(s){const a=i.byteLength||0,h=i.byteOffset||0;return s.slice(h,h+a)})}loadAccessor(e){const i=this,s=this.json,a=this.json.accessors[e];if(a.bufferView===void 0&&a.sparse===void 0)return Promise.resolve(null);const h=[];return a.bufferView!==void 0?h.push(this.getDependency("bufferView",a.bufferView)):h.push(null),a.sparse!==void 0&&(h.push(this.getDependency("bufferView",a.sparse.indices.bufferView)),h.push(this.getDependency("bufferView",a.sparse.values.bufferView))),Promise.all(h).then(function(d){const b=d[0],X=fu[a.type],$=Ba[a.componentType],Z=$.BYTES_PER_ELEMENT,re=Z*X,le=a.byteOffset||0,he=a.bufferView!==void 0?s.bufferViews[a.bufferView].byteStride:void 0,fe=a.normalized===!0;let me,Ee;if(he&&he!==re){const Ae=Math.floor(le/he),ye="InterleavedBuffer:"+a.bufferView+":"+a.componentType+":"+Ae+":"+a.count;let ge=i.cache.get(ye);ge||(me=new $(b,Ae*he,a.count*he/Z),ge=new _.vpT(me,he/Z),i.cache.add(ye,ge)),Ee=new _.kB5(ge,X,le%he/Z,fe)}else me=b===null?new $(a.count*X):new $(b,le,a.count*X),Ee=new _.TlE(me,X,fe);if(a.sparse!==void 0){const Ae=fu.SCALAR,ye=Ba[a.sparse.indices.componentType],ge=a.sparse.indices.byteOffset||0,Pe=a.sparse.values.byteOffset||0,Be=new ye(d[1],ge,a.sparse.count*Ae),Oe=new $(d[2],Pe,a.sparse.count*X);b!==null&&(Ee=new _.TlE(Ee.array.slice(),Ee.itemSize,Ee.normalized));for(let Fe=0,Xe=Be.length;Fe<Xe;Fe++){const at=Be[Fe];if(Ee.setX(at,Oe[Fe*X]),X>=2&&Ee.setY(at,Oe[Fe*X+1]),X>=3&&Ee.setZ(at,Oe[Fe*X+2]),X>=4&&Ee.setW(at,Oe[Fe*X+3]),X>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return Ee})}loadTexture(e){const i=this.json,s=this.options,a=i.textures[e].source,h=i.images[a];let d=this.textureLoader;if(h.uri){const b=s.manager.getHandler(h.uri);b!==null&&(d=b)}return this.loadTextureImage(e,a,d)}loadTextureImage(e,i,s){const a=this,h=this.json,d=h.textures[e],b=h.images[i],X=(b.uri||b.bufferView)+":"+d.sampler;if(this.textureCache[X])return this.textureCache[X];const $=this.loadImageSource(i,s).then(function(Z){d.name&&(Z.name=d.name);const re=(h.samplers||{})[d.sampler]||{};return Z.magFilter=rd[re.magFilter]||_.wem,Z.minFilter=rd[re.minFilter]||_.D1R,Z.wrapS=ci[re.wrapS]||_.rpg,Z.wrapT=ci[re.wrapT]||_.rpg,re.extras&&re.extras.uuid!==void 0&&(Z.uuid=re.extras.uuid),a.associations.set(Z,{textures:e}),Z}).catch(function(){return null});return this.textureCache[X]=$,$}loadImageSource(e,i){const s=this,a=this.json,h=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(le=>le.clone());const d=a.images[e],b=self.URL||self.webkitURL;let X=d.uri||"",$=!1,Z=null;if(d.bufferView!==void 0)X=s.getDependency("bufferView",d.bufferView).then(function(le){$=!0;const he=new Blob([le],{type:d.mimeType});return X=b.createObjectURL(he),Z=he,X});else if(d.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const re=Promise.resolve(X).then(function(le){return new Promise(function(he,fe){let me=he;i.isImageBitmapLoader===!0&&(me=function(Ee){const Ae=new _.xEZ(Ee);Ae.needsUpdate=!0,he(Ae)}),i.load(_.Zp0.resolveURL(le,h.path),me,void 0,function(Ee){i.isImageBitmapLoader===!0?(i=new _.dpR(s.options.manager),me=he,i.setCrossOrigin(s.options.crossOrigin),i.setRequestHeader(s.options.requestHeader),i.load(_.Zp0.resolveURL(le,h.path),me,void 0,fe)):fe(Ee)})})}).then(function(le){var he;if($===!0&&b.revokeObjectURL(X),le.userData.mimeType=d.mimeType||((he=d.uri).search(/\.jpe?g($|\?)/i)>0||he.search(/^data\:image\/jpeg/)===0?"image/jpeg":he.search(/\.webp($|\?)/i)>0||he.search(/^data\:image\/webp/)===0?"image/webp":"image/png"),le.flipY=!1,d.extras){if(d.extras.flipY!==void 0){if(i.isImageBitmapLoader===!0&&typeof createImageBitmap!==void 0){const fe=le,me=d.extras.flipY&&!fe.flipY;createImageBitmap(fe.source.data,{imageOrientation:me?"flipY":"none"}).then(function(Ee){fe.source.data.close&&fe.source.data.close(),fe.source.data=Ee,fe.source.needsUpdate=!0,fe.needsUpdate=!0})}le.flipY=d.extras.flipY,le.needsUpdate=!0,delete d.extras.flipY}d.extras.uuid!==void 0&&(le.source.uuid=d.extras.uuid),d.extras.t_uuid!==void 0&&(le.uuid=d.extras.t_uuid)}return d.uri&&typeof d.uri=="string"&&(le.userData.rootPath=d.uri),Z&&(le.userData.__sourceBlob=Z),le}).catch(function(le){throw console.error("THREE.GLTFLoader: Couldn't load texture",X),le});return this.sourceCache[e]=re,re}assignTexture(e,i,s,a){const h=this;return this.getDependency("texture",s.index).then(function(d){if(s.texCoord===void 0||s.texCoord==0||i==="aoMap"&&s.texCoord==1||console.warn("THREE.GLTFLoader: Custom UV set "+s.texCoord+" for texture "+i+" not yet supported."),h.extensions[Oi.KHR_TEXTURE_TRANSFORM]){const b=s.extensions!==void 0?s.extensions[Oi.KHR_TEXTURE_TRANSFORM]:void 0;if(b){const X=h.associations.get(d);d=h.extensions[Oi.KHR_TEXTURE_TRANSFORM].extendTexture(d,b),h.associations.set(d,X)}}return a!==void 0&&(d.encoding=a),e[i]=d,d})}assignFinalMaterial(e){const i=e.geometry;let s=e.material;const a=i.attributes.tangent===void 0,h=i.attributes.color!==void 0,d=i.attributes.normal===void 0;if(e.isPoints){const b="PointsMaterial:"+s.uuid;let X=this.cache.get(b);X||(X=new _.UY4,_.F5T.prototype.copy.call(X,s),X.color.copy(s.color),X.map=s.map,X.sizeAttenuation=!1,this.cache.add(b,X)),s=X}else if(e.isLine){const b="LineBasicMaterial:"+s.uuid;let X=this.cache.get(b);X||(X=new _.nls,_.F5T.prototype.copy.call(X,s),X.color.copy(s.color),this.cache.add(b,X)),s=X}if(a||h||d){let b="ClonedMaterial:"+s.uuid+":";s.isGLTFSpecularGlossinessMaterial&&(b+="specular-glossiness:"),a&&(b+="derivative-tangents:"),h&&(b+="vertex-colors:"),d&&(b+="flat-shading:");let X=this.cache.get(b);X||(X=s.clone(),h&&(X.vertexColors=!0),d&&(X.flatShading=!0),a&&(X.normalScale&&(X.normalScale.y*=-1),X.clearcoatNormalScale&&(X.clearcoatNormalScale.y*=-1)),this.cache.add(b,X),this.associations.set(X,this.associations.get(s))),s=X}s.aoMap&&i.attributes.uv2===void 0&&i.attributes.uv!==void 0&&i.setAttribute("uv2",i.attributes.uv),e.material=s}getMaterialType(){return _.Wid}loadMaterial(e){const i=this,s=this.json,a=this.extensions,h=s.materials[e];let d;const b={},X=h.extensions||{},$=[];if(X[Oi.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const re=a[Oi.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];d=re.getMaterialType(),$.push(re.extendParams(b,h,i))}else if(X[Oi.KHR_MATERIALS_UNLIT]){const re=a[Oi.KHR_MATERIALS_UNLIT];d=re.getMaterialType(),$.push(re.extendParams(b,h,i))}else{const re=h.pbrMetallicRoughness||{};if(b.color=new _.Ilk(1,1,1),b.opacity=1,Array.isArray(re.baseColorFactor)){const le=re.baseColorFactor;b.color.fromArray(le),b.opacity=le[3]}re.baseColorTexture!==void 0&&$.push(i.assignTexture(b,"map",re.baseColorTexture,_.knz)),b.metalness=re.metallicFactor!==void 0?re.metallicFactor:1,b.roughness=re.roughnessFactor!==void 0?re.roughnessFactor:1,re.metallicRoughnessTexture!==void 0&&($.push(i.assignTexture(b,"metalnessMap",re.metallicRoughnessTexture)),$.push(i.assignTexture(b,"roughnessMap",re.metallicRoughnessTexture))),d=this._invokeOne(function(le){return le.getMaterialType&&le.getMaterialType(e)}),$.push(Promise.all(this._invokeAll(function(le){return le.extendMaterialParams&&le.extendMaterialParams(e,b)})))}h.doubleSided===!0&&(b.side=_.ehD);const Z=h.alphaMode||"OPAQUE";if(Z==="BLEND"?(b.transparent=!0,b.depthWrite=!1):(b.transparent=!1,Z==="MASK"&&(b.alphaTest=h.alphaCutoff!==void 0?h.alphaCutoff:.5)),h.normalTexture!==void 0&&d!==_.vBJ&&($.push(i.assignTexture(b,"normalMap",h.normalTexture)),b.normalScale=new _.FM8(1,1),h.normalTexture.scale!==void 0)){const re=h.normalTexture.scale;b.normalScale.set(re,re)}return h.occlusionTexture!==void 0&&d!==_.vBJ&&($.push(i.assignTexture(b,"aoMap",h.occlusionTexture)),h.occlusionTexture.strength!==void 0&&(b.aoMapIntensity=h.occlusionTexture.strength)),h.emissiveFactor!==void 0&&d!==_.vBJ&&(b.emissive=new _.Ilk().fromArray(h.emissiveFactor)),h.emissiveTexture!==void 0&&d!==_.vBJ&&$.push(i.assignTexture(b,"emissiveMap",h.emissiveTexture,_.knz)),Promise.all($).then(function(){let re;return re=d===Pc?a[Oi.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(b):new d(b),h.name&&(re.name=h.name),vs(re,h),i.associations.set(re,{materials:e}),h.extensions&&ah(a,re,h),re})}createUniqueName(e){const i=_.iUV.sanitizeNodeName(e||"");let s=i;for(let a=1;this.nodeNamesUsed[s];++a)s=i+"_"+a;return this.nodeNamesUsed[s]=!0,s}loadGeometries(e){const i=this,s=this.extensions,a=this.primitiveCache;function h(b){return s[Oi.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(b,i).then(function(X){return gg(X,b,i)})}const d=[];for(let b=0,X=e.length;b<X;b++){const $=e[b],Z=Aa($),re=a[Z];if(re)d.push(re.promise);else{let le;le=$.extensions&&$.extensions[Oi.KHR_DRACO_MESH_COMPRESSION]?h($):gg(new _.u9r,$,i),a[Z]={primitive:$,promise:le},d.push(le)}}return Promise.all(d)}loadMesh(e){const i=this,s=this.json,a=this.extensions,h=s.meshes[e],d=h.primitives,b=[];for(let $=0,Z=d.length;$<Z;$++){const re=d[$].material===void 0?((X=this.cache).DefaultMaterial===void 0&&(X.DefaultMaterial=new _.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:_.Wl3})),X.DefaultMaterial):this.getDependency("material",d[$].material);b.push(re)}var X;return b.push(i.loadGeometries(d)),Promise.all(b).then(function($){const Z=$.slice(0,$.length-1),re=$[$.length-1],le=[];for(let fe=0,me=re.length;fe<me;fe++){const Ee=re[fe],Ae=d[fe];let ye;const ge=Z[fe];if(Ae.mode===4||Ae.mode===5||Ae.mode===6||Ae.mode===void 0)ye=h.isSkinnedMesh===!0?new _.TUv(Ee,ge):new _.Kj0(Ee,ge),ye.isSkinnedMesh!==!0||ye.geometry.attributes.skinWeight.normalized||ye.normalizeSkinWeights(),Ae.mode===5?ye.geometry=_o(ye.geometry,_.UlW):Ae.mode===6&&(ye.geometry=_o(ye.geometry,_.z$h));else if(Ae.mode===1)ye=new _.ejS(Ee,ge);else if(Ae.mode===3)ye=new _.x12(Ee,ge);else if(Ae.mode===2)ye=new _.blk(Ee,ge);else{if(Ae.mode!==0)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+Ae.mode);ye=new _.woe(Ee,ge)}Object.keys(ye.geometry.morphAttributes).length>0&&Vr(ye,h),ye.name=i.createUniqueName(h.name||"mesh_"+e),vs(ye,h),Ae.extensions&&ah(a,ye,Ae),i.assignFinalMaterial(ye),le.push(ye)}h.extensions&&le.forEach(fe=>ah(a,fe,h));for(let fe=0,me=le.length;fe<me;fe++)i.associations.set(le[fe],{meshes:e,primitives:fe});if(le.length===1)return le[0];const he=new _.ZAu;i.associations.set(he,{meshes:e});for(let fe=0,me=le.length;fe<me;fe++)he.add(le[fe]);return he})}loadCamera(e){let i;const s=this.json.cameras[e],a=s[s.type];if(a)return s.type==="perspective"?i=new _.cPb(_.M8C.radToDeg(a.yfov),a.aspectRatio||1,a.znear||1,a.zfar||2e6):s.type==="orthographic"&&(i=new _.iKG(-a.xmag,a.xmag,a.ymag,-a.ymag,a.znear,a.zfar)),s.name&&(i.name=this.createUniqueName(s.name)),vs(i,s),Promise.resolve(i);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const i=this.json.skins[e],s={joints:i.joints};return i.inverseBindMatrices===void 0?Promise.resolve(s):this.getDependency("accessor",i.inverseBindMatrices).then(function(a){return s.inverseBindMatrices=a,s})}loadAnimation(e){const i=this.json.animations[e],s=[],a=[],h=[],d=[],b=[];for(let X=0,$=i.channels.length;X<$;X++){const Z=i.channels[X],re=i.samplers[Z.sampler],le=Z.target,he=le.node,fe=i.parameters!==void 0?i.parameters[re.input]:re.input,me=i.parameters!==void 0?i.parameters[re.output]:re.output;s.push(this.getDependency("node",he)),a.push(this.getDependency("accessor",fe)),h.push(this.getDependency("accessor",me)),d.push(re),b.push(le)}return Promise.all([Promise.all(s),Promise.all(a),Promise.all(h),Promise.all(d),Promise.all(b)]).then(function(X){const $=X[0],Z=X[1],re=X[2],le=X[3],he=X[4],fe=[];for(let Ee=0,Ae=$.length;Ee<Ae;Ee++){const ye=$[Ee],ge=Z[Ee],Pe=re[Ee],Be=le[Ee],Oe=he[Ee];if(ye===void 0)continue;let Fe;switch(ye.updateMatrix(),ka[Oe.path]){case ka.weights:Fe=_.dUE;break;case ka.rotation:Fe=_.iLg;break;default:Fe=_.yC1}const Xe=ye.name?ye.name:ye.uuid,at=Be.interpolation!==void 0?sd[Be.interpolation]:_.NMF,mt=[];ka[Oe.path]===ka.weights?ye.traverse(function(At){At.morphTargetInfluences&&mt.push(At.name?At.name:At.uuid)}):mt.push(Xe);let wt=Pe.array;if(Pe.normalized){const At=Bf(wt.constructor),Tt=new Float32Array(wt.length);for(let yt=0,St=wt.length;yt<St;yt++)Tt[yt]=wt[yt]*At;wt=Tt}for(let At=0,Tt=mt.length;At<Tt;At++){const yt=new Fe(mt[At]+"."+ka[Oe.path],ge.array,wt,at);Be.interpolation==="CUBICSPLINE"&&(yt.createInterpolant=function(St){return new(this instanceof _.iLg?Ap:Ts)(this.times,this.values,this.getValueSize()/3,St)},yt.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),fe.push(yt)}}const me=i.name?i.name:"animation_"+e;return new _.m7l(me,void 0,fe)})}createNodeMesh(e){const i=this.json,s=this,a=i.nodes[e];return a.mesh===void 0?null:s.getDependency("mesh",a.mesh).then(function(h){const d=s._getNodeRef(s.meshCache,a.mesh,h);return a.weights!==void 0&&d.traverse(function(b){if(b.isMesh)for(let X=0,$=a.weights.length;X<$;X++)b.morphTargetInfluences[X]=a.weights[X]}),d})}loadNode(e){const i=this.json,s=this.extensions,a=this,h=i.nodes[e],d=h.name?a.createUniqueName(h.name):"";return function(){const b=[],X=a._invokeOne(function($){return $.createNodeMesh&&$.createNodeMesh(e)});return X&&b.push(X),h.camera!==void 0&&b.push(a.getDependency("camera",h.camera).then(function($){return a._getNodeRef(a.cameraCache,h.camera,$)})),a._invokeAll(function($){return $.createNodeAttachment&&$.createNodeAttachment(e)}).forEach(function($){b.push($)}),Promise.all(b)}().then(function(b){let X;if(X=h.isBone===!0?new _.N$j:b.length>1?new _.ZAu:b.length===1?b[0]:new _.Tme,X!==b[0])for(let $=0,Z=b.length;$<Z;$++)X.add(b[$]);if(h.name&&(X.userData.name=h.name,X.name=d),vs(X,h),h.extensions&&ah(s,X,h),h.matrix!==void 0){const $=new _.yGw;$.fromArray(h.matrix),X.applyMatrix4($)}else h.translation!==void 0&&X.position.fromArray(h.translation),h.rotation!==void 0&&X.quaternion.fromArray(h.rotation),h.scale!==void 0&&X.scale.fromArray(h.scale);return a.associations.has(X)||a.associations.set(X,{}),a.associations.get(X).nodes=e,X})}loadScene(e){const i=this.json,s=this.extensions,a=this.json.scenes[e],h=this,d=new _.ZAu;a.name&&(d.name=h.createUniqueName(a.name)),vs(d,a),a.extensions&&ah(s,d,a);const b=a.nodes||[],X=[];for(let $=0,Z=b.length;$<Z;$++)X.push(mg(b[$],d,i,h));return Promise.all(X).then(function(){return h.associations=($=>{const Z=new Map;for(const[re,le]of h.associations)(re instanceof _.F5T||re instanceof _.xEZ)&&Z.set(re,le);return $.traverse(re=>{const le=h.associations.get(re);le!=null&&Z.set(re,le)}),Z})(d),d})}}function mg(c,e,i,s){const a=i.nodes[c];return s.getDependency("node",c).then(function(h){if(a.skin===void 0)return h;let d;return s.getDependency("skin",a.skin).then(function(b){d=b;const X=[];for(let $=0,Z=d.joints.length;$<Z;$++)X.push(s.getDependency("node",d.joints[$]));return Promise.all(X)}).then(function(b){return h.traverse(function(X){if(!X.isMesh)return;const $=[],Z=[];for(let re=0,le=b.length;re<le;re++){const he=b[re];if(he){$.push(he);const fe=new _.yGw;d.inverseBindMatrices!==void 0&&fe.fromArray(d.inverseBindMatrices.array,16*re),Z.push(fe)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',d.joints[re])}X.bind(new _.OdW($,Z),X.matrixWorld)}),h})}).then(function(h){e.add(h);const d=[];if(a.children){const b=a.children;for(let X=0,$=b.length;X<$;X++){const Z=b[X];d.push(mg(Z,h,i,s))}}return Promise.all(d)})}function gg(c,e,i){const s=e.attributes,a=[];function h(d,b){return i.getDependency("accessor",d).then(function(X){c.setAttribute(b,X)})}for(const d in s){const b=mu[d]||d.toLowerCase();b in c.attributes||a.push(h(s[d],b))}if(e.indices!==void 0&&!c.index){const d=i.getDependency("accessor",e.indices).then(function(b){c.setIndex(b)});a.push(d)}return vs(c,e),function(d,b,X){const $=b.attributes,Z=new _.ZzF;if($.POSITION===void 0)return;{const he=X.json.accessors[$.POSITION],fe=he.min,me=he.max;if(fe===void 0||me===void 0)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(Z.set(new _.Pa4(fe[0],fe[1],fe[2]),new _.Pa4(me[0],me[1],me[2])),he.normalized){const Ee=Bf(Ba[he.componentType]);Z.min.multiplyScalar(Ee),Z.max.multiplyScalar(Ee)}}const re=b.targets;if(re!==void 0){const he=new _.Pa4,fe=new _.Pa4;for(let me=0,Ee=re.length;me<Ee;me++){const Ae=re[me];if(Ae.POSITION!==void 0){const ye=X.json.accessors[Ae.POSITION],ge=ye.min,Pe=ye.max;if(ge!==void 0&&Pe!==void 0){if(fe.setX(Math.max(Math.abs(ge[0]),Math.abs(Pe[0]))),fe.setY(Math.max(Math.abs(ge[1]),Math.abs(Pe[1]))),fe.setZ(Math.max(Math.abs(ge[2]),Math.abs(Pe[2]))),ye.normalized){const Be=Bf(Ba[ye.componentType]);fe.multiplyScalar(Be)}he.max(fe)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}Z.expandByVector(he)}d.boundingBox=Z;const le=new _.aLr;Z.getCenter(le.center),le.radius=Z.min.distanceTo(Z.max)/2,d.boundingSphere=le}(c,e,i),Promise.all(a).then(function(){return e.targets!==void 0?function(d,b,X){let $=!1,Z=!1,re=!1;for(let me=0,Ee=b.length;me<Ee;me++){const Ae=b[me];if(Ae.POSITION!==void 0&&($=!0),Ae.NORMAL!==void 0&&(Z=!0),Ae.COLOR_0!==void 0&&(re=!0),$&&Z&&re)break}if(!$&&!Z&&!re)return Promise.resolve(d);const le=[],he=[],fe=[];for(let me=0,Ee=b.length;me<Ee;me++){const Ae=b[me];if($){const ye=Ae.POSITION!==void 0?X.getDependency("accessor",Ae.POSITION):d.attributes.position;le.push(ye)}if(Z){const ye=Ae.NORMAL!==void 0?X.getDependency("accessor",Ae.NORMAL):d.attributes.normal;he.push(ye)}if(re){const ye=Ae.COLOR_0!==void 0?X.getDependency("accessor",Ae.COLOR_0):d.attributes.color;fe.push(ye)}}return Promise.all([Promise.all(le),Promise.all(he),Promise.all(fe)]).then(function(me){const Ee=me[0],Ae=me[1],ye=me[2];return $&&(d.morphAttributes.position=Ee),Z&&(d.morphAttributes.normal=Ae),re&&(d.morphAttributes.color=ye),d.morphTargetsRelative=!0,d})}(c,e.targets,i):c})}function _o(c,e){let i=c.getIndex();if(i===null){const d=[],b=c.getAttribute("position");if(b===void 0)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),c;for(let X=0;X<b.count;X++)d.push(X);c.setIndex(d),i=c.getIndex()}const s=i.count-2,a=[];if(e===_.z$h)for(let d=1;d<=s;d++)a.push(i.getX(0)),a.push(i.getX(d)),a.push(i.getX(d+1));else for(let d=0;d<s;d++)d%2==0?(a.push(i.getX(d)),a.push(i.getX(d+1)),a.push(i.getX(d+2))):(a.push(i.getX(d+2)),a.push(i.getX(d+1)),a.push(i.getX(d)));a.length/3!==s&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const h=c.clone();return h.setIndex(a),h}class vt extends du{constructor(e){super(e),this.isGLTFLoader2=!0}async loadAsync(e,i){const s=await super.loadAsync(e,i),a=s?s.scene||s.scenes&&s.scenes.length>0&&s.scenes[0]:void 0;return a&&s.animations.length>0&&(a.animations=s.animations),a.traverse(h=>{h.userData.gltfUUID&&(h.uuid=h.userData.gltfUUID,delete h.userData.gltfUUID)}),a}register(e){return super.register(e)}}class yp extends _.hH6{constructor(e){super(e),this.type=_.cLu}async loadAsync(e,i){const s=await this.parseAsync(e,i,!1),a=new _.IEO(s.data,s.width,s.height,_.wk1,this.type);return a.needsUpdate=!0,a.flipY=!0,a.encoding=_.rnI,a.minFilter=_.wem,a.magFilter=_.wem,a.source.data.complete=!0,a}async parseAsync(e,i,s=!1){if(!e.startsWith("data:")){this.responseType="blob";const b=await super.loadAsync(e,i);e=(e=await Pa(b)).replace("application/octet-stream","image/png")}const a=await cs(e);let h=Uint8Array;return this.type===_.cLu?h=Uint16Array:this.type===_.VzW&&(h=Uint32Array),{data:function(b,X=3,$=Uint16Array,Z=!1){let re;const le=b.byteLength>>2,he=new $(le*X);for(let fe=0;fe<le;fe++)re=Math.pow(2,b[4*fe+3]-136),Z?(he[fe*X]=Math.min(b[4*fe]*re,65504),he[fe*X+1]=Math.min(b[4*fe+1]*re,65504),he[fe*X+2]=Math.min(b[4*fe+2]*re,65504)):(he[fe*X]=_.A5E.toHalfFloat(Math.min(b[4*fe]*re,65504)),he[fe*X+1]=_.A5E.toHalfFloat(Math.min(b[4*fe+1]*re,65504)),he[fe*X+2]=_.A5E.toHalfFloat(Math.min(b[4*fe+2]*re,65504))),X===4&&(he[fe*X+3]=_.A5E.toHalfFloat(1));return he}(a.data,4,h,s),width:a.width,height:a.height}}setDataType(e){return this.type=e,this}}class od extends _.Gql{constructor(e){super(e),this._imageLoader=new _.S3k(e)}parseTextures2(e,i,s){var a;for(const h of e){const d=(a=h==null?void 0:h.userData)===null||a===void 0?void 0:a.rootPath;if(d&&(!h.image||!i[h.image])){const b=new _.Hw6(this._imageLoader.load(d,s));if(!b)continue;h.image&&(b.uuid=h.image),i[b.uuid]=b,h.image=b.uuid}h.userData=bn(h.userData,void 0,!1,{images:i})}return super.parseTextures(e,i)}parseMaterials2(e,i,s){const a={};return e.forEach(h=>{if(!h)return;const d={...h},b=Object.keys(d);for(const $ of b)if($==="map"||$.endsWith("Map")){const Z=d[$];typeof Z=="string"&&(i[Z]?d[$]=i[Z]:(console.warn(`Texture ${Z} not found`),delete d[$]))}d.userData&&(d.userData=bn(d.userData,void 0,!1,{textures:i}));const X=s.generateFromTemplateType(d.type,d);X&&(a[h.uuid]=X)}),a}}const so="WEBGI_viewer";function yl(c){yr.Importers.push(new _s(vt,["gltf","glb","data:model/gltf"],!0,(e,i)=>{if(!e)return e;const s=e,a=new od(i.loadingManager);return s.register(hh(a,c)),s.register(uh()),s.register(Rc(a)),s.register(h=>new _u(h)),s.register(h=>new kf(h)),s.register(h=>new Cv(h)),s.register(h=>new Wl(h)),s.register(h=>{var d,b,X,$,Z,re,le,he,fe;const me=Ms()+".drc",Ee=Ms()+".ktx2",Ae=(X=(b=(d=h.json)===null||d===void 0?void 0:d.extensionsRequired)===null||b===void 0?void 0:b.includes)===null||X===void 0?void 0:X.call(b,"KHR_draco_mesh_compression");if(Ae){const ge=i.registerFile(me);ge&&s.setDRACOLoader(ge)}!((re=(Z=($=h.json)===null||$===void 0?void 0:$.extensionsUsed)===null||Z===void 0?void 0:Z.includes)===null||re===void 0)&&re.call(Z,"EXT_meshopt_compression")&&(window.MeshoptDecoder?(s.setMeshoptDecoder(window.MeshoptDecoder),h.options.meshoptDecoder=window.MeshoptDecoder):console.error("Add GLTFMeshOptPlugin to viewer to enable EXT_meshopt_compression decode"));const ye=(fe=(he=(le=h.json)===null||le===void 0?void 0:le.extensionsUsed)===null||he===void 0?void 0:he.includes)===null||fe===void 0?void 0:fe.call(he,"KHR_texture_basisu");if(ye){const ge=i.registerFile(Ee);ge&&(s.setKTX2Loader(ge),h.options.ktx2Loader=ge)}return{name:"GLTF2_HELPER_PLUGIN",afterRoot:async ge=>{Ae&&i.unregisterFile(me),ye&&i.unregisterFile(Ee);const Pe=await Ql(h,c,a);ge.scene.__importedViewerConfig=Pe}}}),s}))}const ya="WEBGI_light_extras",Gl="WEBGI_object3d_extras",oo="WEBGI_material_extras",uh=c=>e=>({name:"__"+Gl,afterRoot:async i=>{(i.scenes||(i.scene?[i.scene]:[])).forEach(s=>{s.traverse(a=>{var h,d;if(!a.isObject3D)return;const b=(d=(h=a.userData)===null||h===void 0?void 0:h.gltfExtensions)===null||d===void 0?void 0:d[Gl];if(!b)return void(a.isLight&&!a.isAmbientLight&&(a.castShadow=!0));const X=b.castShadow!==void 0||b.receiveShadow!==void 0;b.castShadow!==void 0&&(a.castShadow=b.castShadow),b.receiveShadow!==void 0&&(a.receiveShadow=b.receiveShadow),b.visible!==void 0&&(a.visible=b.visible),b.frustumCulled!==void 0&&(a.frustumCulled=b.frustumCulled),b.renderOrder!==void 0&&(a.renderOrder=b.renderOrder),b.layers!==void 0&&(a.layers.mask=b.layers),X&&(a.userData.__keepShadowDef=!0),delete a.userData.gltfExtensions[Gl]})})}}),hh=(c,e)=>i=>({name:"__"+oo,afterRoot:async s=>{var a,h,d;const b=s.scenes||(s.scene?[s.scene]:[]);for(const X of b){const $=(h=(a=X.userData)===null||a===void 0?void 0:a.gltfExtensions)===null||h===void 0?void 0:h[oo],Z=$&&await((d=e.getPlugin(Kn))===null||d===void 0?void 0:d.importConfigResources($.resources||{}))||{};X.traverse(re=>{var le,he;const fe=re==null?void 0:re.material;if(!(fe!=null&&fe.isMaterial))return;const me=(he=(le=fe.userData)===null||le===void 0?void 0:le.gltfExtensions)===null||he===void 0?void 0:he[oo];me&&(me.emissiveIntensity!==void 0&&(fe.emissiveIntensity=me.emissiveIntensity),me.fog!==void 0&&(fe.fog=me.fog),me.flatShading!==void 0&&(fe.flatShading=me.flatShading),me.blending!==void 0&&(fe.blending=me.blending),me.side!==void 0&&(fe.side=me.side),me.shadowSide!==void 0&&(fe.shadowSide=me.shadowSide),me.depthFunc!==void 0&&(fe.depthFunc=me.depthFunc),me.depthTest!==void 0&&(fe.depthTest=me.depthTest),me.depthWrite!==void 0&&(fe.depthWrite=me.depthWrite),me.colorWrite!==void 0&&(fe.colorWrite=me.colorWrite),me.wireframe!==void 0&&(fe.wireframe=me.wireframe),me.wireframeLinewidth!==void 0&&(fe.wireframeLinewidth=me.wireframeLinewidth),me.wireframeLinecap!==void 0&&(fe.wireframeLinecap=me.wireframeLinecap),me.wireframeLinejoin!==void 0&&(fe.wireframeLinejoin=me.wireframeLinejoin),me.rotation!==void 0&&(fe.rotation=me.rotation),me.polygonOffset!==void 0&&(fe.polygonOffset=me.polygonOffset),me.polygonOffsetFactor!==void 0&&(fe.polygonOffsetFactor=me.polygonOffsetFactor),me.polygonOffsetUnits!==void 0&&(fe.polygonOffsetUnits=me.polygonOffsetUnits),me.dithering!==void 0&&(fe.dithering=me.dithering),me.alphaToCoverage!==void 0&&(fe.alphaToCoverage=me.alphaToCoverage),me.premultipliedAlpha!==void 0&&(fe.premultipliedAlpha=me.premultipliedAlpha),me.toneMapped!==void 0&&(fe.toneMapped=me.toneMapped),me.reflectivity!==void 0&&(fe.reflectivity=me.reflectivity),Object.entries(me).forEach(([Ee,Ae])=>{Ee.startsWith("_")||Ae&&Ae.resource&&typeof Ae.resource=="string"&&(fe[Ee]=bn(Ae,fe[Ee],!1,Z))}),delete fe.userData.gltfExtensions[oo])}),$&&delete X.userData.gltfExtensions[oo]}}}),Rc=c=>e=>({name:"__"+ya,afterRoot:async i=>{(i.scenes||(i.scene?[i.scene]:[])).forEach(s=>{s.traverse(a=>{var h,d;if(!a.isLight)return;const b=(d=(h=a.userData)===null||h===void 0?void 0:h.gltfExtensions)===null||d===void 0?void 0:d[ya];b&&(!a.shadow&&b.shadow&&console.error("Light has no shadow, cannot import",a,b),b.shadow&&a.shadow&&(b.shadow.bias!==void 0&&(a.shadow.bias=b.shadow.bias),b.shadow.normalBias!==void 0&&(a.shadow.normalBias=b.shadow.normalBias),b.shadow.radius!==void 0&&(a.shadow.radius=b.shadow.radius),b.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(b.shadow.mapSize),b.shadow.camera!==void 0&&(a.shadow.camera=c.parseObject(b.shadow.camera))),delete a.userData.gltfExtensions[ya])})})}});async function Ql(c,e,i,s){var a;if(!s){const X=c.json.scenes||[];if(X.length!==1){for(const $ of X)await Ql(c,e,$);return}s=X[0]}const h=(a=s.extensions)===null||a===void 0?void 0:a[so];if(!h)return;const d=[];Object.values(h.resources).forEach(X=>{Object.values(X).forEach($=>{$.url&&($.url.type==="Uint16Array"&&$.url.data&&d.push($.url),$.url.type==="Uint8Array"&&$.url.data&&d.push($.url))})});for(const X of d){const $=X.data.image,Z=c.json.images[$],re=await c.getDependency("bufferView",Z.bufferView);if(Z.mimeType.startsWith("image/")&&X.type==="Uint16Array"&&X.encoding==="rgbe"){const le=new Blob([re],{type:Z.mimeType}),he="data:image/png;base64,"+btoa(await le.text());X.data=(await new yp().parseAsync(he,void 0,!0)).data,delete X.encoding}else X.data=re}const b={textures:{}};if(h.resources.textures&&c.json.textures)for(const[X,$]of Object.entries(h.resources.textures)){if($.uuid||!X)continue;delete h.resources.textures[X];const Z=c.json.textures.findIndex(re=>{var le,he,fe,me,Ee,Ae,ye;return((le=re.extras)===null||le===void 0?void 0:le.uuid)===X||((me=(fe=(he=c.json.samplers)===null||he===void 0?void 0:he[re.sampler])===null||fe===void 0?void 0:fe.extras)===null||me===void 0?void 0:me.uuid)===X||((ye=(Ae=(Ee=c.json.images)===null||Ee===void 0?void 0:Ee[re.source])===null||Ae===void 0?void 0:Ae.extras)===null||ye===void 0?void 0:ye.t_uuid)===X});Z>=0&&(b.textures[X]=await c.getDependency("texture",Z))}if(h.resources.materials&&c.json.materials)for(const[X,$]of Object.entries(h.resources.materials)){if($.uuid||!X)continue;delete h.resources.materials[X];const Z=c.json.materials.findIndex(re=>{var le;return((le=re.extras)===null||le===void 0?void 0:le.uuid)===X});Z>=0&&(b.materials[X]=await c.getDependency("material",Z))}return h.resources=await e.getPlugin(Kn).importConfigResources(h.resources||{},i,b),h}const vo="WEBGI_materials_bumpmap",Bc="WEBGI_materials_displacementmap",gu="WEBGI_materials_alphamap",Hl="WEBGI_materials_lightmap";class _u{constructor(e){this.parser=e,this.name=vo}async extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],d=a.extensions[this.name];return d.bumpScale!==void 0&&(i.bumpScale=d.bumpScale),d.bumpTexture!==void 0&&h.push(s.assignTexture(i,"bumpMap",d.bumpTexture)),Promise.all(h)}}class kf{constructor(e){this.parser=e,this.name=Bc}async extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],d=a.extensions[this.name];return d.displacementScale!==void 0&&(i.displacementScale=d.displacementScale),d.displacementBias!==void 0&&(i.displacementBias=d.displacementBias),d.displacementTexture!==void 0&&h.push(s.assignTexture(i,"displacementMap",d.displacementTexture)),Promise.all(h)}}class Cv{constructor(e){this.parser=e,this.name=Hl}async extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],d=a.extensions[this.name];return d.lightMapIntensity!==void 0&&(i.lightMapIntensity=d.lightMapIntensity),d.lightMapTexture!==void 0&&h.push(s.assignTexture(i,"lightMap",d.lightMapTexture)),Promise.all(h)}}class Wl{constructor(e){this.parser=e,this.name=gu}async extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],d=a.extensions[this.name];return d.alphaTexture!==void 0&&h.push(s.assignTexture(i,"alphaMap",d.alphaTexture)),Promise.all(h)}}var dh=__webpackgi_require__(23);function ql(){yr.Importers.push(new _s(dh.Q,["drc"],!0))}var kc={},Ni=Uint8Array,Ws=Uint16Array,Oa=Uint32Array,ba=new Ni([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Oc=new Ni([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Lc=new Ni([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),bp=function(c,e){for(var i=new Ws(31),s=0;s<31;++s)i[s]=e+=1<<c[s-1];var a=new Oa(i[30]);for(s=1;s<30;++s)for(var h=i[s];h<i[s+1];++h)a[h]=h-i[s]<<5|s;return[i,a]},vu=bp(ba,2),Yi=vu[0],Yl=vu[1];Yi[28]=258,Yl[258]=28;for(var wa=bp(Oc,0),_g=wa[0],Of=wa[1],Ao=new Ws(32768),Kr=0;Kr<32768;++Kr){var Js=(43690&Kr)>>>1|(21845&Kr)<<1;Js=(61680&(Js=(52428&Js)>>>2|(13107&Js)<<2))>>>4|(3855&Js)<<4,Ao[Kr]=((65280&Js)>>>8|(255&Js)<<8)>>>1}var xa=function(c,e,i){for(var s=c.length,a=0,h=new Ws(e);a<s;++a)++h[c[a]-1];var d,b=new Ws(e);for(a=0;a<e;++a)b[a]=b[a-1]+h[a-1]<<1;if(i){d=new Ws(1<<e);var X=15-e;for(a=0;a<s;++a)if(c[a])for(var $=a<<4|c[a],Z=e-c[a],re=b[c[a]-1]++<<Z,le=re|(1<<Z)-1;re<=le;++re)d[Ao[re]>>>X]=$}else for(d=new Ws(s),a=0;a<s;++a)c[a]&&(d[a]=Ao[b[c[a]-1]++]>>>15-c[a]);return d},La=new Ni(288);for(Kr=0;Kr<144;++Kr)La[Kr]=8;for(Kr=144;Kr<256;++Kr)La[Kr]=9;for(Kr=256;Kr<280;++Kr)La[Kr]=7;for(Kr=280;Kr<288;++Kr)La[Kr]=8;var Ea=new Ni(32);for(Kr=0;Kr<32;++Kr)Ea[Kr]=5;var ad=xa(La,9,0),Au=xa(La,9,1),wp=xa(Ea,5,0),yu=xa(Ea,5,1),Na=function(c){for(var e=c[0],i=1;i<c.length;++i)c[i]>e&&(e=c[i]);return e},ao=function(c,e,i){var s=e/8|0;return(c[s]|c[s+1]<<8)>>(7&e)&i},Nc=function(c,e){var i=e/8|0;return(c[i]|c[i+1]<<8|c[i+2]<<16)>>(7&e)},ld=function(c){return(c/8|0)+(7&c&&1)},Po=function(c,e,i){(e==null||e<0)&&(e=0),(i==null||i>c.length)&&(i=c.length);var s=new(c instanceof Ws?Ws:c instanceof Oa?Oa:Ni)(i-e);return s.set(c.subarray(e,i)),s},bu=function(c,e,i){var s=c.length;if(!s||i&&!i.l&&s<5)return e||new Ni(0);var a=!e||i,h=!i||i.i;i||(i={}),e||(e=new Ni(3*s));var d=function(pi){var yn=e.length;if(pi>yn){var Ji=new Ni(Math.max(2*yn,pi));Ji.set(e),e=Ji}},b=i.f||0,X=i.p||0,$=i.b||0,Z=i.l,re=i.d,le=i.m,he=i.n,fe=8*s;do{if(!Z){i.f=b=ao(c,X,1);var me=ao(c,X+1,3);if(X+=3,!me){var Ee=c[(wt=ld(X)+4)-4]|c[wt-3]<<8,Ae=wt+Ee;if(Ae>s){if(h)throw"unexpected EOF";break}a&&d($+Ee),e.set(c.subarray(wt,Ae),$),i.b=$+=Ee,i.p=X=8*Ae;continue}if(me==1)Z=Au,re=yu,le=9,he=5;else{if(me!=2)throw"invalid block type";var ye=ao(c,X,31)+257,ge=ao(c,X+10,15)+4,Pe=ye+ao(c,X+5,31)+1;X+=14;for(var Be=new Ni(Pe),Oe=new Ni(19),Fe=0;Fe<ge;++Fe)Oe[Lc[Fe]]=ao(c,X+3*Fe,7);X+=3*ge;var Xe=Na(Oe),at=(1<<Xe)-1,mt=xa(Oe,Xe,1);for(Fe=0;Fe<Pe;){var wt,At=mt[ao(c,X,at)];if(X+=15&At,(wt=At>>>4)<16)Be[Fe++]=wt;else{var Tt=0,yt=0;for(wt==16?(yt=3+ao(c,X,3),X+=2,Tt=Be[Fe-1]):wt==17?(yt=3+ao(c,X,7),X+=3):wt==18&&(yt=11+ao(c,X,127),X+=7);yt--;)Be[Fe++]=Tt}}var St=Be.subarray(0,ye),Ft=Be.subarray(ye);le=Na(St),he=Na(Ft),Z=xa(St,le,1),re=xa(Ft,he,1)}if(X>fe){if(h)throw"unexpected EOF";break}}a&&d($+131072);for(var Mt=(1<<le)-1,Gt=(1<<he)-1,rn=X;;rn=X){var gn=(Tt=Z[Nc(c,X)&Mt])>>>4;if((X+=15&Tt)>fe){if(h)throw"unexpected EOF";break}if(!Tt)throw"invalid length/literal";if(gn<256)e[$++]=gn;else{if(gn==256){rn=X,Z=null;break}var Kt=gn-254;if(gn>264){var In=ba[Fe=gn-257];Kt=ao(c,X,(1<<In)-1)+Yi[Fe],X+=In}var kn=re[Nc(c,X)&Gt],On=kn>>>4;if(!kn)throw"invalid distance";if(X+=15&kn,Ft=_g[On],On>3&&(In=Oc[On],Ft+=Nc(c,X)&(1<<In)-1,X+=In),X>fe){if(h)throw"unexpected EOF";break}a&&d($+131072);for(var zn=$+Kt;$<zn;$+=4)e[$]=e[$-Ft],e[$+1]=e[$+1-Ft],e[$+2]=e[$+2-Ft],e[$+3]=e[$+3-Ft];$=zn}}i.l=Z,i.p=rn,i.b=$,Z&&(b=1,i.m=le,i.d=re,i.n=he)}while(!b);return $==e.length?e:Po(e,0,$)},Xa=function(c,e,i){i<<=7&e;var s=e/8|0;c[s]|=i,c[s+1]|=i>>>8},Xl=function(c,e,i){i<<=7&e;var s=e/8|0;c[s]|=i,c[s+1]|=i>>>8,c[s+2]|=i>>>16},cd=function(c,e){for(var i=[],s=0;s<c.length;++s)c[s]&&i.push({s,f:c[s]});var a=i.length,h=i.slice();if(!a)return[ra,0];if(a==1){var d=new Ni(i[0].s+1);return d[i[0].s]=1,[d,1]}i.sort(function(Be,Oe){return Be.f-Oe.f}),i.push({s:-1,f:25001});var b=i[0],X=i[1],$=0,Z=1,re=2;for(i[0]={s:-1,f:b.f+X.f,l:b,r:X};Z!=a-1;)b=i[i[$].f<i[re].f?$++:re++],X=i[$!=Z&&i[$].f<i[re].f?$++:re++],i[Z++]={s:-1,f:b.f+X.f,l:b,r:X};var le=h[0].s;for(s=1;s<a;++s)h[s].s>le&&(le=h[s].s);var he=new Ws(le+1),fe=ud(i[Z-1],he,0);if(fe>e){s=0;var me=0,Ee=fe-e,Ae=1<<Ee;for(h.sort(function(Be,Oe){return he[Oe.s]-he[Be.s]||Be.f-Oe.f});s<a;++s){var ye=h[s].s;if(!(he[ye]>e))break;me+=Ae-(1<<fe-he[ye]),he[ye]=e}for(me>>>=Ee;me>0;){var ge=h[s].s;he[ge]<e?me-=1<<e-he[ge]++-1:++s}for(;s>=0&&me;--s){var Pe=h[s].s;he[Pe]==e&&(--he[Pe],++me)}fe=e}return[new Ni(he),fe]},ud=function(c,e,i){return c.s==-1?Math.max(ud(c.l,e,i+1),ud(c.r,e,i+1)):e[c.s]=i},Ar=function(c){for(var e=c.length;e&&!c[--e];);for(var i=new Ws(++e),s=0,a=c[0],h=1,d=function(X){i[s++]=X},b=1;b<=e;++b)if(c[b]==a&&b!=e)++h;else{if(!a&&h>2){for(;h>138;h-=138)d(32754);h>2&&(d(h>10?h-11<<5|28690:h-3<<5|12305),h=0)}else if(h>3){for(d(a),--h;h>6;h-=6)d(8304);h>2&&(d(h-3<<5|8208),h=0)}for(;h--;)d(a);h=1,a=c[b]}return[i.subarray(0,s),e]},Ro=function(c,e){for(var i=0,s=0;s<e.length;++s)i+=c[s]*e[s];return i},Sa=function(c,e,i){var s=i.length,a=ld(e+2);c[a]=255&s,c[a+1]=s>>>8,c[a+2]=255^c[a],c[a+3]=255^c[a+1];for(var h=0;h<s;++h)c[a+h+4]=i[h];return 8*(a+4+s)},Ua=function(c,e,i,s,a,h,d,b,X,$,Z){Xa(e,Z++,i),++a[256];for(var re=cd(a,15),le=re[0],he=re[1],fe=cd(h,15),me=fe[0],Ee=fe[1],Ae=Ar(le),ye=Ae[0],ge=Ae[1],Pe=Ar(me),Be=Pe[0],Oe=Pe[1],Fe=new Ws(19),Xe=0;Xe<ye.length;++Xe)Fe[31&ye[Xe]]++;for(Xe=0;Xe<Be.length;++Xe)Fe[31&Be[Xe]]++;for(var at=cd(Fe,7),mt=at[0],wt=at[1],At=19;At>4&&!mt[Lc[At-1]];--At);var Tt,yt,St,Ft,Mt=$+5<<3,Gt=Ro(a,La)+Ro(h,Ea)+d,rn=Ro(a,le)+Ro(h,me)+d+14+3*At+Ro(Fe,mt)+(2*Fe[16]+3*Fe[17]+7*Fe[18]);if(Mt<=Gt&&Mt<=rn)return Sa(e,Z,c.subarray(X,X+$));if(Xa(e,Z,1+(rn<Gt)),Z+=2,rn<Gt){Tt=xa(le,he,0),yt=le,St=xa(me,Ee,0),Ft=me;var gn=xa(mt,wt,0);for(Xa(e,Z,ge-257),Xa(e,Z+5,Oe-1),Xa(e,Z+10,At-4),Z+=14,Xe=0;Xe<At;++Xe)Xa(e,Z+3*Xe,mt[Lc[Xe]]);Z+=3*At;for(var Kt=[ye,Be],In=0;In<2;++In){var kn=Kt[In];for(Xe=0;Xe<kn.length;++Xe){var On=31&kn[Xe];Xa(e,Z,gn[On]),Z+=mt[On],On>15&&(Xa(e,Z,kn[Xe]>>>5&127),Z+=kn[Xe]>>>12)}}}else Tt=ad,yt=La,St=wp,Ft=Ea;for(Xe=0;Xe<b;++Xe)if(s[Xe]>255){On=s[Xe]>>>18&31,Xl(e,Z,Tt[On+257]),Z+=yt[On+257],On>7&&(Xa(e,Z,s[Xe]>>>23&31),Z+=ba[On]);var zn=31&s[Xe];Xl(e,Z,St[zn]),Z+=Ft[zn],zn>3&&(Xl(e,Z,s[Xe]>>>5&8191),Z+=Oc[zn])}else Xl(e,Z,Tt[s[Xe]]),Z+=yt[s[Xe]];return Xl(e,Z,Tt[256]),Z+yt[256]},bl=new Oa([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),ra=new Ni(0),Kl=function(c,e,i,s,a,h){var d=c.length,b=new Ni(s+d+5*(1+Math.ceil(d/7e3))+a),X=b.subarray(s,b.length-a),$=0;if(!e||d<8)for(var Z=0;Z<=d;Z+=65535){var re=Z+65535;re<d?$=Sa(X,$,c.subarray(Z,re)):(X[Z]=h,$=Sa(X,$,c.subarray(Z,d)))}else{for(var le=bl[e-1],he=le>>>13,fe=8191&le,me=(1<<i)-1,Ee=new Ws(32768),Ae=new Ws(me+1),ye=Math.ceil(i/3),ge=2*ye,Pe=function($r){return(c[$r]^c[$r+1]<<ye^c[$r+2]<<ge)&me},Be=new Oa(25e3),Oe=new Ws(288),Fe=new Ws(32),Xe=0,at=0,mt=(Z=0,0),wt=0,At=0;Z<d;++Z){var Tt=Pe(Z),yt=32767&Z,St=Ae[Tt];if(Ee[yt]=St,Ae[Tt]=yt,wt<=Z){var Ft=d-Z;if((Xe>7e3||mt>24576)&&Ft>423){$=Ua(c,X,0,Be,Oe,Fe,at,mt,At,Z-At,$),mt=Xe=at=0,At=Z;for(var Mt=0;Mt<286;++Mt)Oe[Mt]=0;for(Mt=0;Mt<30;++Mt)Fe[Mt]=0}var Gt=2,rn=0,gn=fe,Kt=yt-St&32767;if(Ft>2&&Tt==Pe(Z-Kt))for(var In=Math.min(he,Ft)-1,kn=Math.min(32767,Z),On=Math.min(258,Ft);Kt<=kn&&--gn&&yt!=St;){if(c[Z+Gt]==c[Z+Gt-Kt]){for(var zn=0;zn<On&&c[Z+zn]==c[Z+zn-Kt];++zn);if(zn>Gt){if(Gt=zn,rn=Kt,zn>In)break;var pi=Math.min(Kt,zn-2),yn=0;for(Mt=0;Mt<pi;++Mt){var Ji=Z-Kt+Mt+32768&32767,ar=Ji-Ee[Ji]+32768&32767;ar>yn&&(yn=ar,St=Ji)}}}Kt+=(yt=St)-(St=Ee[yt])+32768&32767}if(rn){Be[mt++]=268435456|Yl[Gt]<<18|Of[rn];var $i=31&Yl[Gt],Pr=31&Of[rn];at+=ba[$i]+Oc[Pr],++Oe[257+$i],++Fe[Pr],wt=Z+Gt,++Xe}else Be[mt++]=c[Z],++Oe[c[Z]]}}$=Ua(c,X,h,Be,Oe,Fe,at,mt,At,Z-At,$),!h&&7&$&&($=Sa(X,$+1,ra))}return Po(b,0,s+ld($)+a)},xp=function(){for(var c=new Int32Array(256),e=0;e<256;++e){for(var i=e,s=9;--s;)i=(1&i&&-306674912)^i>>>1;c[e]=i}return c}(),Uc=function(){var c=-1;return{p:function(e){for(var i=c,s=0;s<e.length;++s)i=xp[255&i^e[s]]^i>>>8;c=i},d:function(){return~c}}},hd=function(){var c=1,e=0;return{p:function(i){for(var s=c,a=e,h=i.length,d=0;d!=h;){for(var b=Math.min(d+2655,h);d<b;++d)a+=s+=i[d];s=(65535&s)+15*(s>>16),a=(65535&a)+15*(a>>16)}c=s,e=a},d:function(){return(255&(c%=65521))<<24|c>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},Jl=function(c,e,i,s,a){return Kl(c,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(c.length)))):12+e.mem,i,s,!a)},Bo=function(c,e){var i={};for(var s in c)i[s]=c[s];for(var s in e)i[s]=e[s];return i},vg=function(c,e,i){for(var s=c(),a=c.toString(),h=a.slice(a.indexOf("[")+1,a.lastIndexOf("]")).replace(/ /g,"").split(","),d=0;d<s.length;++d){var b=s[d],X=h[d];if(typeof b=="function"){e+=";"+X+"=";var $=b.toString();if(b.prototype)if($.indexOf("[native code]")!=-1){var Z=$.indexOf(" ",8)+1;e+=$.slice(Z,$.indexOf("(",Z))}else for(var re in e+=$,b.prototype)e+=";"+X+".prototype."+re+"="+b.prototype[re].toString();else e+=$}else i[X]=b}return[e,i]},$s=[],wl=function(c,e,i,s){var a;if(!$s[i]){for(var h="",d={},b=c.length-1,X=0;X<b;++X)h=(a=vg(c[X],h,d))[0],d=a[1];$s[i]=vg(c[b],h,d)}var $=Bo({},$s[i][1]);return function(Z,re,le,he,fe){var me=new Worker(kc[re]||(kc[re]=URL.createObjectURL(new Blob([Z],{type:"text/javascript"}))));return me.onerror=function(Ee){return fe(Ee.error,null)},me.onmessage=function(Ee){return fe(null,Ee.data)},me.postMessage(le,he),me}($s[i][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",i,$,function(Z){var re=[];for(var le in Z)(Z[le]instanceof Ni||Z[le]instanceof Ws||Z[le]instanceof Oa)&&re.push((Z[le]=new Z[le].constructor(Z[le])).buffer);return re}($),s)},us=function(){return[Ni,Ws,Oa,ba,Oc,Lc,Yi,_g,Au,yu,Ao,xa,Na,ao,Nc,ld,Po,bu,zc,Fc,ph]},xl=function(){return[Ni,Ws,Oa,ba,Oc,Lc,Yl,Of,ad,La,wp,Ea,Ao,bl,ra,xa,Xa,Xl,cd,ud,Ar,Ro,Sa,Ua,ld,Po,Kl,Jl,sa,Fc]},is=function(){return[Pt,vi,gt,Uc,xp]},Ag=function(){return[cn,Vn]},yg=function(){return[Ti,gt,hd]},bg=function(){return[yi]},Fc=function(c){return postMessage(c,[c.buffer])},ph=function(c){return c&&c.size&&new Ni(c.size)},fh=function(c,e,i,s,a,h){var d=wl(i,s,a,function(b,X){d.terminate(),h(b,X)});return d.postMessage([c,e],e.consume?[c.buffer]:[]),function(){d.terminate()}},_e=function(c){return c.ondata=function(e,i){return postMessage([e,i],[e.buffer])},function(e){return c.push(e.data[0],e.data[1])}},ne=function(c,e,i,s,a){var h,d=wl(c,s,a,function(b,X){b?(d.terminate(),e.ondata.call(e,b)):(X[1]&&d.terminate(),e.ondata.call(e,b,X[0],X[1]))});d.postMessage(i),e.push=function(b,X){if(h)throw"stream finished";if(!e.ondata)throw"no stream handler";d.postMessage([b,h=X],[b.buffer])},e.terminate=function(){d.terminate()}},ce=function(c,e){return c[e]|c[e+1]<<8},Se=function(c,e){return(c[e]|c[e+1]<<8|c[e+2]<<16|c[e+3]<<24)>>>0},qe=function(c,e){return Se(c,e)+4294967296*Se(c,e+4)},gt=function(c,e,i){for(;i;++e)c[e]=i,i>>>=8},Pt=function(c,e){var i=e.filename;if(c[0]=31,c[1]=139,c[2]=8,c[8]=e.level<2?4:e.level==9?2:0,c[9]=3,e.mtime!=0&&gt(c,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),i){c[3]=8;for(var s=0;s<=i.length;++s)c[s+10]=i.charCodeAt(s)}},cn=function(c){if(c[0]!=31||c[1]!=139||c[2]!=8)throw"invalid gzip data";var e=c[3],i=10;4&e&&(i+=c[10]|2+(c[11]<<8));for(var s=(e>>3&1)+(e>>4&1);s>0;s-=!c[i++]);return i+(2&e)},Vn=function(c){var e=c.length;return(c[e-4]|c[e-3]<<8|c[e-2]<<16|c[e-1]<<24)>>>0},vi=function(c){return 10+(c.filename&&c.filename.length+1||0)},Ti=function(c,e){var i=e.level,s=i==0?0:i<6?1:i==9?3:2;c[0]=120,c[1]=s<<6|(s?32-2*s:1)},yi=function(c){if((15&c[0])!=8||c[0]>>>4>7||(c[0]<<8|c[1])%31)throw"invalid zlib data";if(32&c[1])throw"invalid zlib data: preset dictionaries not supported"};function Go(c,e){return e||typeof c!="function"||(e=c,c={}),this.ondata=e,c}var rs=function(){function c(e,i){i||typeof e!="function"||(i=e,e={}),this.ondata=i,this.o=e||{}}return c.prototype.p=function(e,i){this.ondata(Jl(e,this.o,0,0,!i),i)},c.prototype.push=function(e,i){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=i,this.p(e,i||!1)},c}(),Ka=function(){return function(c,e){ne([xl,function(){return[_e,rs]}],this,Go.call(this,c,e),function(i){var s=new rs(i.data);onmessage=_e(s)},6)}}();function Fa(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return fh(c,e,[xl],function(s){return Fc(sa(s.data[0],s.data[1]))},0,i)}function sa(c,e){return Jl(c,e||{},0,0)}var Ds=function(){function c(e){this.s={},this.p=new Ni(0),this.ondata=e}return c.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var i=this.p.length,s=new Ni(i+e.length);s.set(this.p),s.set(e,i),this.p=s},c.prototype.c=function(e){this.d=this.s.i=e||!1;var i=this.s.b,s=bu(this.p,this.o,this.s);this.ondata(Po(s,i,this.s.b),this.d),this.o=Po(s,this.s.b-32768),this.s.b=this.o.length,this.p=Po(this.p,this.s.p/8|0),this.s.p&=7},c.prototype.push=function(e,i){this.e(e),this.c(i)},c}(),jc=function(){return function(c){this.ondata=c,ne([us,function(){return[_e,Ds]}],this,0,function(){var e=new Ds;onmessage=_e(e)},7)}}();function wu(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return fh(c,e,[us],function(s){return Fc(zc(s.data[0],ph(s.data[1])))},1,i)}function zc(c,e){return bu(c,e)}var xu=function(){function c(e,i){this.c=Uc(),this.l=0,this.v=1,rs.call(this,e,i)}return c.prototype.push=function(e,i){rs.prototype.push.call(this,e,i)},c.prototype.p=function(e,i){this.c.p(e),this.l+=e.length;var s=Jl(e,this.o,this.v&&vi(this.o),i&&8,!i);this.v&&(Pt(s,this.o),this.v=0),i&&(gt(s,s.length-8,this.c.d()),gt(s,s.length-4,this.l)),this.ondata(s,i)},c}(),dd=function(){return function(c,e){ne([xl,is,function(){return[_e,rs,xu]}],this,Go.call(this,c,e),function(i){var s=new xu(i.data);onmessage=_e(s)},8)}}();function Lf(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return fh(c,e,[xl,is,function(){return[pd]}],function(s){return Fc(pd(s.data[0],s.data[1]))},2,i)}function pd(c,e){e||(e={});var i=Uc(),s=c.length;i.p(c);var a=Jl(c,e,vi(e),8),h=a.length;return Pt(a,e),gt(a,h-8,i.d()),gt(a,h-4,s),a}var fd=function(){function c(e){this.v=1,Ds.call(this,e)}return c.prototype.push=function(e,i){if(Ds.prototype.e.call(this,e),this.v){var s=this.p.length>3?cn(this.p):4;if(s>=this.p.length&&!i)return;this.p=this.p.subarray(s),this.v=0}if(i){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Ds.prototype.c.call(this,i)},c}(),Nf=function(){return function(c){this.ondata=c,ne([us,Ag,function(){return[_e,Ds,fd]}],this,0,function(){var e=new fd;onmessage=_e(e)},9)}}();function wg(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return fh(c,e,[us,Ag,function(){return[md]}],function(s){return Fc(md(s.data[0]))},3,i)}function md(c,e){return bu(c.subarray(cn(c),-8),e||new Ni(Vn(c)))}var lo=function(){function c(e,i){this.c=hd(),this.v=1,rs.call(this,e,i)}return c.prototype.push=function(e,i){rs.prototype.push.call(this,e,i)},c.prototype.p=function(e,i){this.c.p(e);var s=Jl(e,this.o,this.v&&2,i&&4,!i);this.v&&(Ti(s,this.o),this.v=0),i&&gt(s,s.length-4,this.c.d()),this.ondata(s,i)},c}(),xg=function(){return function(c,e){ne([xl,yg,function(){return[_e,rs,lo]}],this,Go.call(this,c,e),function(i){var s=new lo(i.data);onmessage=_e(s)},10)}}();function Eu(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return fh(c,e,[xl,yg,function(){return[Su]}],function(s){return Fc(Su(s.data[0],s.data[1]))},4,i)}function Su(c,e){e||(e={});var i=hd();i.p(c);var s=Jl(c,e,2,4);return Ti(s,e),gt(s,s.length-4,i.d()),s}var yo=function(){function c(e){this.v=1,Ds.call(this,e)}return c.prototype.push=function(e,i){if(Ds.prototype.e.call(this,e),this.v){if(this.p.length<2&&!i)return;this.p=this.p.subarray(2),this.v=0}if(i){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Ds.prototype.c.call(this,i)},c}(),Mv=function(){return function(c){this.ondata=c,ne([us,bg,function(){return[_e,Ds,yo]}],this,0,function(){var e=new yo;onmessage=_e(e)},11)}}();function El(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return fh(c,e,[us,bg,function(){return[gd]}],function(s){return Fc(gd(s.data[0],ph(s.data[1])))},5,i)}function gd(c,e){return bu((yi(c),c.subarray(2,-4)),e)}var ko=function(){function c(e){this.G=fd,this.I=Ds,this.Z=yo,this.ondata=e}return c.prototype.push=function(e,i){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,i);else{if(this.p&&this.p.length){var s=new Ni(this.p.length+e.length);s.set(this.p),s.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var a=this,h=function(){a.ondata.apply(a,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(h):(15&this.p[0])!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(h):new this.Z(h),this.s.push(this.p,i),this.p=null}}},c}(),Ep=function(){function c(e){this.G=Nf,this.I=jc,this.Z=Mv,this.ondata=e}return c.prototype.push=function(e,i){ko.prototype.push.call(this,e,i)},c}();function SA(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return c[0]==31&&c[1]==139&&c[2]==8?wg(c,e,i):(15&c[0])!=8||c[0]>>4>7||(c[0]<<8|c[1])%31?wu(c,e,i):El(c,e,i)}function Uf(c,e){return c[0]==31&&c[1]==139&&c[2]==8?md(c,e):(15&c[0])!=8||c[0]>>4>7||(c[0]<<8|c[1])%31?zc(c,e):gd(c,e)}var Eg=function(c,e,i,s){for(var a in c){var h=c[a],d=e+a;h instanceof Ni?i[d]=[h,s]:Array.isArray(h)?i[d]=[h[0],Bo(s,h[1])]:Eg(h,d+"/",i,s)}},Sg=typeof TextEncoder<"u"&&new TextEncoder,Tv=typeof TextDecoder<"u"&&new TextDecoder,CA=0;try{Tv.decode(ra,{stream:!0}),CA=1}catch{}var Cu=function(c){for(var e="",i=0;;){var s=c[i++],a=(s>127)+(s>223)+(s>239);if(i+a>c.length)return[e,Po(c,i-1)];a?a==3?(s=((15&s)<<18|(63&c[i++])<<12|(63&c[i++])<<6|63&c[i++])-65536,e+=String.fromCharCode(55296|s>>10,56320|1023&s)):e+=1&a?String.fromCharCode((31&s)<<6|63&c[i++]):String.fromCharCode((15&s)<<12|(63&c[i++])<<6|63&c[i++]):e+=String.fromCharCode(s)}},Sp=function(){function c(e){this.ondata=e,CA?this.t=new TextDecoder:this.p=ra}return c.prototype.push=function(e,i){if(!this.ondata)throw"no callback";if(i=!!i,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),i),i){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var s=new Ni(this.p.length+e.length);s.set(this.p),s.set(e,this.p.length);var a=Cu(s),h=a[0],d=a[1];if(i){if(d.length)throw"invalid utf-8 data";this.p=null}else this.p=d;this.ondata(h,i)}},c}(),Cg=function(){function c(e){this.ondata=e}return c.prototype.push=function(e,i){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata($l(e),this.d=i||!1)},c}();function $l(c,e){if(e){for(var i=new Ni(c.length),s=0;s<c.length;++s)i[s]=c.charCodeAt(s);return i}if(Sg)return Sg.encode(c);var a=c.length,h=new Ni(c.length+(c.length>>1)),d=0,b=function(Z){h[d++]=Z};for(s=0;s<a;++s){if(d+5>h.length){var X=new Ni(d+8+(a-s<<1));X.set(h),h=X}var $=c.charCodeAt(s);$<128||e?b($):$<2048?(b(192|$>>6),b(128|63&$)):$>55295&&$<57344?(b(240|($=65536+(1047552&$)|1023&c.charCodeAt(++s))>>18),b(128|$>>12&63),b(128|$>>6&63),b(128|63&$)):(b(224|$>>12),b(128|$>>6&63),b(128|63&$))}return Po(h,0,d)}function Mg(c,e){if(e){for(var i="",s=0;s<c.length;s+=16384)i+=String.fromCharCode.apply(null,c.subarray(s,s+16384));return i}if(Tv)return Tv.decode(c);var a=Cu(c),h=a[0];if(a[1].length)throw"invalid utf-8 data";return h}var MA=function(c){return c==1?3:c<6?2:c==9?1:0},_d=function(c,e){return e+30+ce(c,e+26)+ce(c,e+28)},fr=function(c,e,i){var s=ce(c,e+28),a=Mg(c.subarray(e+46,e+46+s),!(2048&ce(c,e+8))),h=e+46+s,d=Se(c,e+20),b=i&&d==4294967295?Zn(c,h):[d,Se(c,e+24),Se(c,e+42)],X=b[0],$=b[1],Z=b[2];return[ce(c,e+10),X,$,a,h+ce(c,e+30)+ce(c,e+32),Z]},Zn=function(c,e){for(;ce(c,e)!=1;e+=4+ce(c,e+2));return[qe(c,e+12),qe(c,e+4),qe(c,e+20)]},Zs=function(c){var e=0;if(c)for(var i in c){var s=c[i].length;if(s>65535)throw"extra field too long";e+=s+4}return e},Cp=function(c,e,i,s,a,h,d,b){var X=s.length,$=i.extra,Z=b&&b.length,re=Zs($);gt(c,e,d!=null?33639248:67324752),e+=4,d!=null&&(c[e++]=20,c[e++]=i.os),c[e]=20,e+=2,c[e++]=i.flag<<1|(h==null&&8),c[e++]=a&&8,c[e++]=255&i.compression,c[e++]=i.compression>>8;var le=new Date(i.mtime==null?Date.now():i.mtime),he=le.getFullYear()-1980;if(he<0||he>119)throw"date not in range 1980-2099";if(gt(c,e,he<<25|le.getMonth()+1<<21|le.getDate()<<16|le.getHours()<<11|le.getMinutes()<<5|le.getSeconds()>>>1),e+=4,h!=null&&(gt(c,e,i.crc),gt(c,e+4,h),gt(c,e+8,i.size)),gt(c,e+12,X),gt(c,e+14,re),e+=16,d!=null&&(gt(c,e,Z),gt(c,e+6,i.attrs),gt(c,e+10,d),e+=14),c.set(s,e),e+=X,re)for(var fe in $){var me=$[fe],Ee=me.length;gt(c,e,+fe),gt(c,e+2,Ee),c.set(me,e+4),e+=4+Ee}return Z&&(c.set(b,e),e+=Z),e},Iv=function(c,e,i,s,a){gt(c,e,101010256),gt(c,e+8,i),gt(c,e+10,i),gt(c,e+12,s),gt(c,e+16,a)},Ff=function(){function c(e){this.filename=e,this.c=Uc(),this.size=0,this.compression=0}return c.prototype.process=function(e,i){this.ondata(null,e,i)},c.prototype.push=function(e,i){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,i&&(this.crc=this.c.d()),this.process(e,i||!1)},c}(),qw=function(){function c(e,i){var s=this;i||(i={}),Ff.call(this,e),this.d=new rs(i,function(a,h){s.ondata(null,a,h)}),this.compression=8,this.flag=MA(i.level)}return c.prototype.process=function(e,i){try{this.d.push(e,i)}catch(s){this.ondata(s,null,i)}},c.prototype.push=function(e,i){Ff.prototype.push.call(this,e,i)},c}(),Yw=function(){function c(e,i){var s=this;i||(i={}),Ff.call(this,e),this.d=new Ka(i,function(a,h,d){s.ondata(a,h,d)}),this.compression=8,this.flag=MA(i.level),this.terminate=this.d.terminate}return c.prototype.process=function(e,i){this.d.push(e,i)},c.prototype.push=function(e,i){Ff.prototype.push.call(this,e,i)},c}(),Xw=function(){function c(e){this.ondata=e,this.u=[],this.d=1}return c.prototype.add=function(e){var i=this;if(2&this.d)throw"stream finished";var s=$l(e.filename),a=s.length,h=e.comment,d=h&&$l(h),b=a!=e.filename.length||d&&h.length!=d.length,X=a+Zs(e.extra)+30;if(a>65535)throw"filename too long";var $=new Ni(X);Cp($,0,e,s,b);var Z=[$],re=function(){for(var Ee=0,Ae=Z;Ee<Ae.length;Ee++){var ye=Ae[Ee];i.ondata(null,ye,!1)}Z=[]},le=this.d;this.d=0;var he=this.u.length,fe=Bo(e,{f:s,u:b,o:d,t:function(){e.terminate&&e.terminate()},r:function(){if(re(),le){var Ee=i.u[he+1];Ee?Ee.r():i.d=1}le=1}}),me=0;e.ondata=function(Ee,Ae,ye){if(Ee)i.ondata(Ee,Ae,ye),i.terminate();else if(me+=Ae.length,Z.push(Ae),ye){var ge=new Ni(16);gt(ge,0,134695760),gt(ge,4,e.crc),gt(ge,8,me),gt(ge,12,e.size),Z.push(ge),fe.c=me,fe.b=X+me+16,fe.crc=e.crc,fe.size=e.size,le&&fe.r(),le=1}else le&&re()},this.u.push(fe)},c.prototype.end=function(){var e=this;if(2&this.d)throw 1&this.d?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},c.prototype.e=function(){for(var e=0,i=0,s=0,a=0,h=this.u;a<h.length;a++)s+=46+($=h[a]).f.length+Zs($.extra)+($.o?$.o.length:0);for(var d=new Ni(s+22),b=0,X=this.u;b<X.length;b++){var $=X[b];Cp(d,e,$,$.f,$.u,$.c,i,$.o),e+=46+$.f.length+Zs($.extra)+($.o?$.o.length:0),i+=$.b}Iv(d,e,this.u.length,s,i),this.ondata(null,d,!0),this.d=2},c.prototype.terminate=function(){for(var e=0,i=this.u;e<i.length;e++)i[e].t();this.d=2},c}();function Tg(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";var s={};Eg(c,"",s,e);var a=Object.keys(s),h=a.length,d=0,b=0,X=h,$=new Array(h),Z=[],re=function(){for(var me=0;me<Z.length;++me)Z[me]()},le=function(){var me=new Ni(b+22),Ee=d,Ae=b-d;b=0;for(var ye=0;ye<X;++ye){var ge=$[ye];try{var Pe=ge.c.length;Cp(me,b,ge,ge.f,ge.u,Pe);var Be=30+ge.f.length+Zs(ge.extra),Oe=b+Be;me.set(ge.c,Oe),Cp(me,d,ge,ge.f,ge.u,Pe,b,ge.m),d+=16+Be+(ge.m?ge.m.length:0),b=Oe+Pe}catch(Fe){return i(Fe,null)}}Iv(me,d,$.length,Ae,Ee),i(null,me)};h||le();for(var he=function(me){var Ee=a[me],Ae=s[Ee],ye=Ae[0],ge=Ae[1],Pe=Uc(),Be=ye.length;Pe.p(ye);var Oe=$l(Ee),Fe=Oe.length,Xe=ge.comment,at=Xe&&$l(Xe),mt=at&&at.length,wt=Zs(ge.extra),At=ge.level==0?0:8,Tt=function(yt,St){if(yt)re(),i(yt,null);else{var Ft=St.length;$[me]=Bo(ge,{size:Be,crc:Pe.d(),c:St,f:Oe,m:at,u:Fe!=Ee.length||at&&Xe.length!=mt,compression:At}),d+=30+Fe+wt+Ft,b+=76+2*(Fe+wt)+(mt||0)+Ft,--h||le()}};if(Fe>65535&&Tt("filename too long",null),At)if(Be<16e4)try{Tt(null,sa(ye,ge))}catch(yt){Tt(yt,null)}else Z.push(Fa(ye,ge,Tt));else Tt(null,ye)},fe=0;fe<X;++fe)he(fe);return re}function Dv(c,e){e||(e={});var i={},s=[];Eg(c,"",i,e);var a=0,h=0;for(var d in i){var b=i[d],X=b[0],$=b[1],Z=$.level==0?0:8,re=(Fe=$l(d)).length,le=$.comment,he=le&&$l(le),fe=he&&he.length,me=Zs($.extra);if(re>65535)throw"filename too long";var Ee=Z?sa(X,$):X,Ae=Ee.length,ye=Uc();ye.p(X),s.push(Bo($,{size:X.length,crc:ye.d(),c:Ee,f:Fe,m:he,u:re!=d.length||he&&le.length!=fe,o:a,compression:Z})),a+=30+re+me+Ae,h+=76+2*(re+me)+(fe||0)+Ae}for(var ge=new Ni(h+22),Pe=a,Be=h-a,Oe=0;Oe<s.length;++Oe){var Fe=s[Oe];Cp(ge,Fe.o,Fe,Fe.f,Fe.u,Fe.c.length);var Xe=30+Fe.f.length+Zs(Fe.extra);ge.set(Fe.c,Fe.o+Xe),Cp(ge,a,Fe,Fe.f,Fe.u,Fe.c.length,Fe.o,Fe.m),a+=16+Xe+(Fe.m?Fe.m.length:0)}return Iv(ge,a,s.length,Be,Pe),ge}var Ig=function(){function c(){}return c.prototype.push=function(e,i){this.ondata(null,e,i)},c.compression=0,c}(),TA=function(){function c(){var e=this;this.i=new Ds(function(i,s){e.ondata(null,i,s)})}return c.prototype.push=function(e,i){try{this.i.push(e,i)}catch(s){this.ondata(s,e,i)}},c.compression=8,c}(),Pv=function(){function c(e,i){var s=this;i<32e4?this.i=new Ds(function(a,h){s.ondata(null,a,h)}):(this.i=new jc(function(a,h,d){s.ondata(a,h,d)}),this.terminate=this.i.terminate)}return c.prototype.push=function(e,i){this.i.terminate&&(e=Po(e,0)),this.i.push(e,i)},c.compression=8,c}(),vd=function(){function c(e){this.onfile=e,this.k=[],this.o={0:Ig},this.p=ra}return c.prototype.push=function(e,i){var s=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var a=Math.min(this.c,e.length),h=e.subarray(0,a);if(this.c-=a,this.d?this.d.push(h,!this.c):this.k[0].push(h),(e=e.subarray(a)).length)return this.push(e,i)}else{var d=0,b=0,X=void 0,$=void 0;this.p.length?e.length?(($=new Ni(this.p.length+e.length)).set(this.p),$.set(e,this.p.length)):$=this.p:$=e;for(var Z=$.length,re=this.c,le=re&&this.d,he=function(){var Ee,Ae=Se($,b);if(Ae==67324752){d=1,X=b,fe.d=null,fe.c=0;var ye=ce($,b+6),ge=ce($,b+8),Pe=2048&ye,Be=8&ye,Oe=ce($,b+26),Fe=ce($,b+28);if(Z>b+30+Oe+Fe){var Xe=[];fe.k.unshift(Xe),d=2;var at,mt=Se($,b+18),wt=Se($,b+22),At=Mg($.subarray(b+30,b+=30+Oe),!Pe);mt==4294967295?(Ee=Be?[-2]:Zn($,b),mt=Ee[0],wt=Ee[1]):Be&&(mt=-1),b+=Fe,fe.c=mt;var Tt={name:At,compression:ge,start:function(){if(!Tt.ondata)throw"no callback";if(mt){var yt=s.o[ge];if(!yt)throw"unknown compression type "+ge;(at=mt<0?new yt(At):new yt(At,mt,wt)).ondata=function(Gt,rn,gn){Tt.ondata(Gt,rn,gn)};for(var St=0,Ft=Xe;St<Ft.length;St++){var Mt=Ft[St];at.push(Mt,!1)}s.k[0]==Xe&&s.c?s.d=at:at.push(ra,!0)}else Tt.ondata(null,ra,!0)},terminate:function(){at&&at.terminate&&at.terminate()}};mt>=0&&(Tt.size=mt,Tt.originalSize=wt),fe.onfile(Tt)}return"break"}if(re){if(Ae==134695760)return X=b+=12+(re==-2&&8),d=3,fe.c=0,"break";if(Ae==33639248)return X=b-=4,d=3,fe.c=0,"break"}},fe=this;b<Z-4&&he()!=="break";++b);if(this.p=ra,re<0){var me=d?$.subarray(0,X-12-(re==-2&&8)-(Se($,X-16)==134695760&&4)):$.subarray(0,b);le?le.push(me,!!d):this.k[+(d==2)].push(me)}if(2&d)return this.push($.subarray(b),i);this.p=$.subarray(b)}if(i){if(this.c)throw"invalid zip file";this.p=null}},c.prototype.register=function(e){this.o[e.compression]=e},c}();function Mp(c,e){if(typeof e!="function")throw"no callback";for(var i=[],s=function(){for(var le=0;le<i.length;++le)i[le]()},a={},h=c.length-22;Se(c,h)!=101010256;--h)if(!h||c.length-h>65558)return void e("invalid zip file",null);var d=ce(c,h+8);d||e(null,{});var b=d,X=Se(c,h+16),$=X==4294967295;if($){if(h=Se(c,h-12),Se(c,h)!=101075792)return void e("invalid zip file",null);b=d=Se(c,h+32),X=Se(c,h+48)}for(var Z=function(le){var he=fr(c,X,$),fe=he[0],me=he[1],Ee=he[2],Ae=he[3],ye=he[4],ge=he[5],Pe=_d(c,ge);X=ye;var Be=function(Fe,Xe){Fe?(s(),e(Fe,null)):(a[Ae]=Xe,--d||e(null,a))};if(fe)if(fe==8){var Oe=c.subarray(Pe,Pe+me);if(me<32e4)try{Be(null,zc(Oe,new Ni(Ee)))}catch(Fe){Be(Fe,null)}else i.push(wu(Oe,{size:Ee},Be))}else Be("unknown compression type "+fe,null);else Be(null,Po(c,Pe,Pe+me))},re=0;re<b;++re)Z();return s}function Rv(c){for(var e={},i=c.length-22;Se(c,i)!=101010256;--i)if(!i||c.length-i>65558)throw"invalid zip file";var s=ce(c,i+8);if(!s)return{};var a=Se(c,i+16),h=a==4294967295;if(h){if(i=Se(c,i-12),Se(c,i)!=101075792)throw"invalid zip file";s=Se(c,i+32),a=Se(c,i+48)}for(var d=0;d<s;++d){var b=fr(c,a,h),X=b[0],$=b[1],Z=b[2],re=b[3],le=b[4],he=b[5],fe=_d(c,he);if(a=le,X){if(X!=8)throw"unknown compression type "+X;e[re]=zc(c.subarray(fe,fe+$),new Ni(Z))}else e[re]=Po(c,fe,fe+$)}return e}class jf extends _.hH6{load(e,i,s,a){return this.setResponseType("arraybuffer"),super.load(e,h=>{const d=Rv(new Uint8Array(h)),b=new Map(Object.entries(d).map(([X,$])=>[X,new File([$],X)]));i==null||i(b)},s,a)}}function Bv(){yr.Importers.push(new _s(jf,["zip"],!0))}class Ad extends _.Ox3{constructor(e,i){super(),this.assetType="light",this.isDirectionalLight2=!0,this.color=new _.Ilk(e),this.intensity=i||1,this.target.position.set(0,0,-1),this.add(this.target)}get lightObject(){return this}get modelObject(){return this}copy(e,i){const s=this.target,a=e.userData;return e.userData={},super.copy(e,i),Ir(this.userData,a),s.position.copy(this.target.position),s.updateMatrixWorld(),this.target=s,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,i;(e=this.shadow.map)===null||e===void 0||e.dispose(),(i=this.shadow.mapPass)===null||i===void 0||i.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[-.1,.1],stepSize:.005,label:"Shadow Normal Bias",property:[this==null?void 0:this.shadow,"normalBias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty},{type:"slider",bounds:[.1,50],label:"Shadow frustum",getValue:()=>2*this.shadow.camera.right,setValue:e=>{this.shadow.camera.left=-e/2,this.shadow.camera.right=e/2,this.shadow.camera.top=e/2,this.shadow.camera.bottom=-e/2},onChange:this.setDirty}]}}toJSON(e){const{userData:i,children:s}=this;this.userData={},this.children=[];const a=super.toJSON(e);return a.userData=qn(Ir({},i),!1),this.userData={},this.children=s,a.type="DirectionalLight2",a.target=this.target.position.toArray(),Object.assign(a,qn(this,!0,e))}fromJSON(e,i){if(e.type!=="DirectionalLight2")return null;const s=e.target,a=e.object;return e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld(),delete e.target),e.object&&delete e.object,bn(e,this,!0,i),s&&(e.target=s),a&&(a.color!==void 0&&this.color.set(a.color),a.intensity!==void 0&&(this.intensity=a.intensity),e.object=a),this}}class kv extends _.PMe{constructor(e,i,s,a,h,d){super(e,i,s,a,h,d),this.assetType="light",this.target.position.set(0,0,-1),this.add(this.target)}get lightObject(){return this}get modelObject(){return this}copy(e,i){const s=this.target,a=e.userData;return e.userData={},super.copy(e,i),Ir(this.userData,a),s.position.copy(this.target.position),s.updateMatrixWorld(),this.target=s,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Spot Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,30],property:[this,"intensity"]},{type:"slider",bounds:[0,2],property:[this,"angle"]},{type:"slider",bounds:[0,.9999],property:[this,"penumbra"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,i;(e=this.shadow.map)===null||e===void 0||e.dispose(),(i=this.shadow.mapPass)===null||i===void 0||i.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:i,children:s}=this;this.userData={},this.children=[];const a=super.toJSON(e);return a.userData=qn(Ir({},i),!1),this.userData={},this.children=s,a.type="SpotLight2",a.target=this.target.position.toArray(),Object.assign(a,qn(this,!0,e))}fromJSON(e,i){return e.type!=="SpotLight2"?null:(e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld()),e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),e.object.distance!==void 0&&(this.distance=e.object.distance),e.object.angle!==void 0&&(this.angle=e.object.angle),e.object.decay!==void 0&&(this.decay=e.object.decay),e.object.penumbra!==void 0&&(this.penumbra=e.object.penumbra),bn(e,this,!0,i),this):this)}}class Ov extends _.cek{constructor(e,i,s,a){super(e,i,s,a),this.assetType="light"}get lightObject(){return this}get modelObject(){return this}copy(e,i){const s=e.userData;return e.userData={},super.copy(e,i),Ir(this.userData,s),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Point Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",property:[this,"intensity"]},{type:"input",label:"Distance",property:[this,"distance"]},{type:"input",property:[this,"decay"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,i;(e=this.shadow.map)===null||e===void 0||e.dispose(),(i=this.shadow.mapPass)===null||i===void 0||i.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:i}=this;this.userData={};const s=super.toJSON(e);return s.userData=qn(Ir({},i),!1),this.userData={},s.type="PointLight2",Object.assign(s,qn(this,!0,e))}fromJSON(e,i){return e.type!=="PointLight2"?null:e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),e.object.distance!==void 0&&(this.distance=e.object.distance),e.object.decay!==void 0&&(this.decay=e.object.decay),bn(e,this,!0,i),this):this}}class IA extends _.Mig{constructor(e,i){super(e,i),this.assetType="light"}get lightObject(){return this}get modelObject(){return this}copy(e,i){const s=e.userData;return e.userData={},super.copy(e,i),Ir(this.userData,s),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ambient Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]}]}}toJSON(e){const{userData:i}=this;this.userData={};const s=super.toJSON(e);return s.userData=qn(Ir({},i),!1),this.userData={},s.type="AmbientLight2",Object.assign(s,qn(this,!0,e))}fromJSON(e,i){return e.type!=="AmbientLight2"?null:e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),bn(e,this,!0,i),this):this}}class Kw extends _.aNw{load(e,i,s,a){const h=new _.hH6(this.manager);h.setPath(this.path),h.setResponseType("text"),h.load(e,d=>{try{i(this.parse(d))}catch(b){a?a(b):console.error(b),this.manager.itemError(e)}},s,a)}parse(e){e=e.replace(/^#.*?(\n|\r)/gm,"").replace(/^\s*?(\n|\r)/gm,"").trim();let i=null,s=null;const a=new _.Pa4(0,0,0),h=new _.Pa4(1,1,1),d=e.split(/[\n\r]+/g);let b=null,X=0;for(let re=0,le=d.length;re<le;re++){const he=d[re].trim(),fe=he.split(/\s/g);switch(fe[0]){case"TITLE":i=he.substring(7,he.length-1);break;case"LUT_3D_SIZE":const me=fe[1];s=parseFloat(me),b=new Uint8Array(s*s*s*4);break;case"DOMAIN_MIN":a.x=parseFloat(fe[1]),a.y=parseFloat(fe[2]),a.z=parseFloat(fe[3]);break;case"DOMAIN_MAX":h.x=parseFloat(fe[1]),h.y=parseFloat(fe[2]),h.z=parseFloat(fe[3]);break;default:const Ee=parseFloat(fe[0]),Ae=parseFloat(fe[1]),ye=parseFloat(fe[2]);if(Ee>1||Ee<0||Ae>1||Ae<0||ye>1||ye<0)throw new Error("LUTCubeLoader : Non normalized values not supported.");b[X+0]=255*Ee,b[X+1]=255*Ae,b[X+2]=255*ye,b[X+3]=255,X+=4}}const $=new _.IEO;$.image.data=b,$.image.width=s,$.image.height=s*s,$.type=_.ywz,$.magFilter=_.wem,$.minFilter=_.wem,$.wrapS=_.uWy,$.wrapT=_.uWy,$.generateMipmaps=!1,$.needsUpdate=!0;const Z=new _.JUT;return Z.image.data=b,Z.image.width=s,Z.image.height=s,Z.image.depth=s,Z.type=_.ywz,Z.magFilter=_.wem,Z.minFilter=_.wem,Z.wrapS=_.uWy,Z.wrapT=_.uWy,Z.wrapR=_.uWy,Z.generateMipmaps=!1,Z.needsUpdate=!0,{title:i,size:s,domainMin:a,domainMax:h,texture:$,texture3D:Z}}}class Jw{constructor({domainMax:e,domainMin:i,size:s,texture:a,texture3D:h,title:d}){this.userData={},this.type="LUTCubeTextureWrapper",this.assetType="lutTexture",this.domainMax=e,this.domainMin=i,this.size=s,this.texture=a,this.texture3D=h,this.title=d,this.uuid=$t(),this.userData.__needsSourceBuffer=!0}fromJSON(e,i){return e.type!==this.type&&console.warn("type mismatch while import",e,this),console.error("not supported"),this}toJSON(e){var i;if(e!=null&&e.textures[this.uuid])return{uuid:this.uuid,resource:"extras"};let s="";if(this.userData.__sourceBuffer){const h=new Uint8Array(this.userData.__sourceBuffer);s={data:Array.from(h),type:h.constructor.name,path:((i=this.userData.__sourceBlob)===null||i===void 0?void 0:i.name)||this.userData.rootPath}}else this.userData.rootPath?s=this.userData.rootPath:console.error("Unable to serialize LUT texture, not loaded through asset manager.");const a={uuid:this.uuid,url:s,userData:io({},this.userData),type:this.type,name:this.texture.name};return e!=null&&e.extras?(e.extras[this.uuid]=a,{uuid:this.uuid,resource:"extras"}):a}}class yr extends oe{constructor(e,i=!1){super(),this._processors=new oh,this._logger=console.log,this._loaderCache=[],this._fileDatabase=new Map,this._cachedAssets=[],i||(this._logger=()=>{}),this._viewer=e,this._onLoad=this._onLoad.bind(this),this._onProgress=this._onProgress.bind(this),this._onError=this._onError.bind(this),this._onStart=this._onStart.bind(this),this._urlModifier=this._urlModifier.bind(this),this._loadingManager=new _.lLk(this._onLoad,this._onProgress,this._onError),this._loadingManager.onStart=this._onStart,this._loadingManager.setURLModifier(this._urlModifier),Bv(),vp(e.renderer.rendererObject),yl(e),ql()}get processors(){return this._processors}get loadingManager(){return this._loadingManager}_onLoad(){this.dispatchEvent({type:"onLoad"})}_onProgress(e,i,s){this.dispatchEvent({type:"onProgress",url:e,loaded:i,total:s})}_onError(e){this.dispatchEvent({type:"onError",url:e})}_onStart(e,i,s){this.dispatchEvent({type:"onStart",url:e,loaded:i,total:s})}_urlModifier(e){var i;let s=decodeURI(e);const a=(i=this._rootContext)===null||i===void 0?void 0:i.rootUrl;s.includes("://")||!a||s.startsWith(a)||(s=a+s),s=s.replace("./",""),s=s.replace(/^(\/\/)/,"/"),s=s.replace(/\?.*$/,"");const h=this._fileDatabase.get(s);return h?h.ext?(h.objectUrl||(h.objectUrl=URL.createObjectURL(h)+"#"+s),h.objectUrl):(console.error("Unable to determine file extension",h),e):e}_createLoader(e){const i=this._getImporter(e),s=i==null?void 0:i.ctor(this);return s&&(i==null||i.ext.forEach(a=>{const h=new RegExp(a.startsWith("data:")?"^"+a+"\\/":"\\."+a+"$","i");this._loadingManager.addHandler(h,s)})),s&&(this._loaderCache.push({loader:s,files:[]}),this.dispatchEvent({type:"loaderCreate",loader:s})),s}async importFiles(e,i={}){const s=new Map;let{allowedExtensions:a}=i;if(a&&a.length<1&&(a=void 0),e.size===0)return s;this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"start"});const h=[],d=[];if(e.forEach((b,X)=>{var $;this.registerFile(X,b);const Z=b.ext;Z&&(($=a==null?void 0:a.includes(Z.toLowerCase()))===null||$===void 0||$)&&(this._isRootFileExtension(Z)?h.push(X):d.push(X))}),h.length>0)for(const b of h){let X=await this._importFile(b,void 0,i);X&&(X=await this.processImported(X,i)),s.set(b,X)}else for(const b of d){let X=await this._importFile(b,void 0,i);X&&(X=await this.processImported(X,i)),s.set(b,X)}return this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"end"}),e.forEach((b,X)=>{this.unregisterFile(X)}),s}registerFile(e,i){var s,a,h;e=e.replace(/\?.*$/,"");const d=(s=i==null?void 0:i.ext)!==null&&s!==void 0?s:(h=pg((a=i==null?void 0:i.name)!==null&&a!==void 0?a:e))===null||h===void 0?void 0:h.toLowerCase();i&&(i.ext||(i.ext=d),this._fileDatabase.set(e,i));let b=this._getLoader(e);if(b||(b=this._createLoader(i??{name:e,ext:d})),b){for(const X of this._loaderCache)if(X.loader===b){X.files.push(e);break}}return b}unregisterFile(e){e=e.replace(/\?.*$/,"");const i=this._fileDatabase.get(e);i!=null&&i.objectUrl&&(URL.revokeObjectURL(i.objectUrl),i.objectUrl=void 0),i&&this._fileDatabase.delete(e)}_isRootFileExtension(e){return yr.Importers.find(i=>i.root&&i.ext.includes(e.toLowerCase()))!=null}resolveURL(e){return this._loadingManager.resolveURL(e)}async _importFile(e,i,s={},a){var h,d;if(!((h=i)===null||h===void 0)&&h.__imported)return i.__imported;let b;this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:0});try{this.registerFile(e,i);const X=this.resolveURL(e),$=e.replace(/\?.*$/,""),Z=(d=s.fileHandler)!==null&&d!==void 0?d:await this._loadingManager.getHandler($)||(i?await this._loadingManager.getHandler(i.name||i.ext||""):void 0);if(!Z)throw new Error("AssetImporter: Unable to find loader for "+e);this._rootContext={path:e,url:X,rootUrl:_.Zp0.extractUrlBase(e),baseUrl:_.Zp0.extractUrlBase(X)},b=await Z.loadAsync(e+(s.queryString?(e.includes("?")?"&":"?")+s.queryString:""),re=>{a&&a(re),this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:re.loaded/re.total})}),this._rootContext=void 0,this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:1}),this.dispatchEvent({type:"importFile",path:e,state:"adding"}),i?this._logger("AssetImporter: loaded",e):this._logger("AssetImporter: downloaded",e),i&&this.unregisterFile(e)}catch(X){return console.error("AssetImporter: Unable to import file",e,i),console.error(X),console.error(X==null?void 0:X.stack),this.dispatchEvent({type:"importFile",path:e,state:"error",error:X}),i&&this.unregisterFile(e),[]}return this.dispatchEvent({type:"importFile",path:e,state:"done"}),i&&(i.__imported=b),b&&typeof b=="object"&&(b.__rootPath=e,i&&(b.__rootBlob=i)),b}_getImporter(e,i=!1){return yr.Importers.find(s=>{if(i&&!s.root)return!1;const a=s.ext.find(h=>{var d,b,X;return e.ext&&h===e.ext.toLowerCase()||((b=(d=e.name)===null||d===void 0?void 0:d.toLowerCase())===null||b===void 0?void 0:b.endsWith("."+h.toLowerCase()))||(h==null?void 0:h.startsWith("data:"))&&((X=e.name)===null||X===void 0?void 0:X.startsWith(h))});return!!a&&(e.ext=a,!0)})}_getLoader(e){var i;return(i=this._loadingManager.getHandler(e))!==null&&i!==void 0?i:void 0}async importAsset(e,i={},s){var a;if(!e)return[];if(!this._cachedAssets.includes(e)){if(Object.entries(e).length===1&&e.path){const b=this._cachedAssets.find(X=>X.path===e.path);b&&Object.assign(e,b)}const d=this._cachedAssets.findIndex(b=>b.path===e.path);d>=0&&this._cachedAssets.splice(d,1),this._cachedAssets.push(e)}let h;if(e!=null&&e.preImported&&(h=await e.preImported),!i.forceImport&&h){const d=await this.processImported(h,i);let b=!1;for(const X of d)if(X.__disposed){b=!0;break}if(!b||i.reimportDisposed===!1)return d}return e.preImported=this._importFile(i.pathOverride||e.path,typeof((a=e.file)===null||a===void 0?void 0:a.arrayBuffer)=="function"?e.file:void 0,i,s),h=await e.preImported,h&&(h=await this.processImported(h,i)),h}async importSingle(e,i={}){var s;return(s=await this.importAsset(e,i))===null||s===void 0?void 0:s[0]}async importSinglePath(e,i){var s;return(s=await this.importPath(e,i))===null||s===void 0?void 0:s[0]}async importPath(e,i={}){const s={...i};delete s.pathOverride,delete s.forceImport,delete s.reimportDisposed;const a=JSON.stringify(s);let h;return h=this._cachedAssets.find(d=>d.path===e&&d._options===a)||{path:e},h._options=a,await this.importAsset(h,i)}async processImportedSingle(e,i={}){return(await this.processImported(e,i))[0]}async processImported(e,i={}){var s,a,h,d,b,X,$,Z;let re=e;if(!re)return[];if(i.processImported===!1)return[re];if(Array.isArray(re)){const fe=[];for(const me of re)fe.push(...await this.processImported(me,i));return fe}if(!((s=re.userData)===null||s===void 0)&&s.rootSceneModelRoot){if(i._rootSceneImported=!0,re.__processedChildren&&!i.forceImporterReprocess)return re.__processedChildren;if(!(re.children.length<1))return re.animations&&(re.children[0].animations||(re.children[0].animations=[]),re.children[0].animations.push(...re.animations)),re.__importedViewerConfig&&(re.children[0].__importedViewerConfig=re.__importedViewerConfig),re.__processedChildren=await this.processImported([...re.children],i),re.__processedChildren;if(((a=re.animations)===null||a===void 0?void 0:a.length)>0&&console.error("AssetImporter: animations in empty scene not supported yet. animations will be ignored",re.animations),!re.__importedViewerConfig)return[];re=re.__importedViewerConfig}if(!((h=re.userData)===null||h===void 0)&&h.iModel&&(re=re.userData.iModel),!((d=re.userData)===null||d===void 0)&&d.iMaterial&&(re=re.userData.iMaterial),re.assetImporterProcessed&&!i.forceImporterReprocess)return[re];const le=re.__rootPath,he=re.__rootBlob;if(!re.assetType){if(re.isBufferGeometry&&(re=new _.Kj0(re,new _.Wid)),re.isObject3D)if(re.isLight)re=DA(re);else{const fe=[];re.traverse(me=>{me!==re&&me.isLight&&fe.push(me)});for(const me of fe)DA(me);re=new _p(re,i)}re.isTexture&&(re.assetType="texture",i._testDataTextureComplete&&(re.isDataTexture&&(!((b=re.image)===null||b===void 0)&&b.data)&&(re.image.complete=!0),!((X=re.image)===null||X===void 0)&&X.complete&&(re.needsUpdate=!0)),i.generateMipmaps!==void 0&&(re.generateMipmaps=i.generateMipmaps),re.generateMipmaps||re.isRenderTargetTexture||(re.minFilter=re.minFilter===_.D1R?_.wem:re.minFilter,re.magFilter=re.magFilter===_.D1R?_.wem:re.magFilter)),re.isMaterial&&(re.assetType="material")}if(re.assetType!=null)return re.userData&&(re.userData.rootPath||!le||le.startsWith("blob:")||le.startsWith("/")||(re.userData.rootPath=le),he&&(re.userData.__sourceBlob=he,re.userData.__needsSourceBuffer&&(re.userData.__sourceBuffer=await he.arrayBuffer(),delete re.userData.__needsSourceBuffer))),re=await this._processors.process(re.assetType,re,{}),re.assetImporterProcessed=!0,[re];if(re instanceof Map)return[...(await this.importFiles(re,i)).values()].flat();if(re.type){const fe=this._viewer.getPluginByType(re.type);if(fe){let me=re._importedResources||{};return re.resources&&(me=await(($=this._viewer.getManager())===null||$===void 0?void 0:$.importConfigResources(re.resources)),delete re.resources,re._importedResources=me),typeof fe.fromJSON=="function"&&(await Promise.resolve(fe.fromJSON(re,me)),re.assetImporterProcessed=!1),[]}}else if(re.plugins)return re.resources=await((Z=this._viewer.getManager())===null||Z===void 0?void 0:Z.importConfigResources(re.resources)),await this._viewer.getManager().importViewerConfig(re),re.assetImporterProcessed=!1,[];return console.warn("unknown/null asset type: ",re),[re]}dispose(){var e;(e=this._processors)===null||e===void 0||e.dispose()}}function Lv(c){if(!c)return _.ywz;const e=c.extensions.has("EXT_color_buffer_half_float")||c.capabilities.isWebGL2&&c.extensions.has("EXT_color_buffer_float"),i=c.capabilities.isWebGL2||c.extensions.has("OES_texture_float")||c.extensions.has("WEBGL_color_buffer_float");return e?_.cLu:i?_.VzW:_.ywz}function DA(c){var e,i,s;if(!c.isLight||c.assetType==="light")return c;if(c.uiConfig)return console.warn("ui config already exists, not supported",c),c;let a;if(c.children.length,c.isDirectionalLight&&(a=new Ad),c.isAmbientLight&&(a=new IA),c.isSpotLight&&(a=new kv),c.isPointLight&&(a=new Ov),a){(i=(e=a.lightObject).copy)===null||i===void 0||i.call(e,c);const h=c.parent;!((s=h)===null||s===void 0)&&s.isObject3D&&(h.remove(c),c.dispose(),c.userData.iModel=a,h.add(a.lightObject),a.uuid=c.uuid),Fr(a.lightObject,h)}else console.warn("unknown light type: ",c);return a}yr.Importers=[new _s(va,["json"],!1),new _s(_.hH6,["txt"],!1),new _s(yp,["rgbe.png","hdr.png","hdrpng"],!1),new _s(_.dpR,["webp","png","jpeg","jpg","svg","data:image"],!1),new _s(class extends Kw{parse(c){const e=super.parse(c);return new Jw(e)}},["cube"],!1)];class PA extends _.u7G{constructor(e){super(e)}async loadAsync(e,i){var s;const a=new _.hH6(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials);const h=await a.loadAsync(e,i);try{const d=JSON.parse(h);if(d.images&&this.importer){const b={};let X=d.images;Array.isArray(X)||(X=Object.values(X));for(const $ of d.images){if(!$.url||!$.uuid)continue;const Z=(s=await this.importer.importPath($.url,{processImported:!1}))===null||s===void 0?void 0:s[0],re=Z==null?void 0:Z.source;if(!Z||!re)continue;const le=new _.Hw6(re.data);le.uuid=$.uuid,b[le.uuid]=le,Z.dispose()}return this.parse(d,b)}return this.parse(d)}catch(d){throw console.error(d),this.manager.itemError(e),d}}parse(e,i){var s,a;let h;const d={p:new Promise(Z=>{h=Z})};if(e.images||e.textures){const Z=new od(this.manager);let re={};const le=Ee=>{h(),d.p=void 0,Object.values(re).forEach(Ae=>{var ye;Ae.isTexture&&(!((ye=Ae.image)===null||ye===void 0)&&ye.complete)&&(Ae.needsUpdate=!0)})};let he=e.images||[];Array.isArray(he)||(he=Object.values(he));const fe=i||Z.parseImages(he,le);let me=e.textures;Array.isArray(me)||(me=Object.values(me)),re=Z.parseTextures2(me,fe,le),this.setTextures(re)}this.materials||console.warn("A Material Manager is not set to import three materials, trying standard materials");const b={...e};if(Object.entries(b).forEach(([Z,re])=>{re&&typeof re=="string"&&this.textures[re]&&(b[Z]=this.textures[re])}),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?b.vertexColors=e.vertexColors>0:b.vertexColors=e.vertexColors),e.normalScale!==void 0){let Z=e.normalScale;Array.isArray(Z)===!1&&(Z=[Z,Z]),b.normalScale=new _.FM8().fromArray(Z)}let X=e.type;X!=="MeshPhysicalMaterial"&&X!=="MeshStandardMaterial"||(X=jo.TYPE),b.userData=bn(b.userData,void 0,!1,this);const $=(a=(s=this.materials)===null||s===void 0?void 0:s.generateFromTemplateType(X,b))!==null&&a!==void 0?a:super.parse(e);return this.setTextures({}),$.userData.imageLoadAwaiter=d,$}}class Kn extends oe{constructor(e,i,{simpleCache:s=!1,storage:a}={}){if(super(),this._sceneUpdated=this._sceneUpdated.bind(this),this.addAsset=this.addAsset.bind(this),this.addProcessedAssets=this.addProcessedAssets.bind(this),this.addImported=this.addImported.bind(this),(s||a)&&(s&&(_.CtF.enabled=!0),a&&window.Cache&&typeof window.Cache=="function"&&a instanceof window.Cache)){const h={..._.CtF};_.CtF.get=(d,b,X)=>b?d.startsWith("data:")||d.startsWith("blob")||d.startsWith("chrome-extension")?Promise.resolve(void 0):a.match(d).then($=>{if($)switch(b){case"arraybuffer":return $.arrayBuffer();case"blob":return $.blob();case"document":return $.text().then(Z=>new DOMParser().parseFromString(Z,X??"text/html"));case"json":return $.json();default:if(X===void 0)return $.text();{const Z=/charset="?([^;"\s]*)"?/i.exec(X),re=Z&&Z[1]?Z[1].toLowerCase():void 0,le=new TextDecoder(re);return $.arrayBuffer().then(he=>le.decode(he))}}}):h.get(d),_.CtF.add=(d,b,X)=>{X||h.add(d,b),d.startsWith("data:")||d.startsWith("blob")||d.startsWith("chrome-extension")||a.put(d,new Response(b,{status:200}))},_.CtF.remove=(d,b)=>{b||h.remove(d),a.delete(d)}}this._importer=e,this._materials=i}async addAsset(e,i={}){if(!this._importer||!this._viewer)return[];const s=await this._importer.importAsset(e,i);return s?(this.addProcessedAssets(s,i),s):(console.warn("Unable to import",e,s),[])}async addFromPath(e,i={}){if(!this._importer||!this._viewer)return[];const s=await this._importer.importPath(e,i);return s?(this.addProcessedAssets(s,i),s):(console.warn("Unable to import",e,s),[])}addProcessedAssets(e,i){return e.map(s=>{var a;return(a=this._viewer)===null||a===void 0?void 0:a.scene.addSceneObject(s,i)})}async addAssetSingle(e,i={}){var s;return e?(s=await(typeof e=="string"?this.addFromPath:this.addAsset)(e,i))===null||s===void 0?void 0:s[0]:void 0}async addImported(e,i={}){var s;return(s=this._importer)===null||s===void 0?void 0:s.processImported(e,i).then(a=>(this.addProcessedAssets(a,i),a))}async addImportedSingle(e,i={}){return this.addImported(e,i).then(s=>s==null?void 0:s[0])}_sceneUpdated(e){var i;if(e.type==="addSceneObject"){const s=e.object;s.assetType==="material"&&((i=this._materials)===null||i===void 0||i.processMaterial(s,{}))}else console.error("Unexpected")}async onAdded(e){this._viewer=e,this._materials||(this._materials=new hu,this._viewer.scene.addEventListener("addSceneObject",this._sceneUpdated)),this._importer||(this._importer=new yr(e,!!e.getPluginByType("debug")),this._importer.processors.add("model",{forAssetType:"model",process:(s,a)=>(_l(s,h=>{var d;return(d=this._materials)===null||d===void 0?void 0:d.processModel(h,{recursive:!1})}),s)}),this._importer.processors.add("model",{forAssetType:"model",process:this._materials.processModel}),this._importer.processors.add("material",{forAssetType:"material",process:(s,a)=>{var h;return!((h=this.materials)===null||h===void 0)&&h.findMaterial(s.uuid)&&(console.warn("imported material uuid already exists, creating new uuid"),s.uuid=$t(),s.userData.uuid&&(s.userData.uuid=s.uuid)),this._materials.processMaterial(s,a)}})),yr.Importers.push(new _s(PA,[jo.TypeSlug],!1,s=>(s&&(s.materials=this._materials),s&&(s.importer=this._importer),s)));const i=this.importViewerConfig.bind(this);yr.Importers.push(new _s(class extends va{async loadAsync(s,a){return i(await super.loadAsync(s,a))}},[Kn.ViewerTypeSlug],!0))}async onDispose(e){}async onRemove(e){var i,s;e===this._viewer&&((i=this._importer)===null||i===void 0||i.dispose(),this._importer=void 0,this._viewer.scene.removeEventListener("addSceneObject",this._sceneUpdated),(s=this._materials)===null||s===void 0||s.dispose(),this._materials=void 0)}get importer(){return this._importer}get exporter(){var e,i;return(i=(e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("AssetExporterPlugin"))===null||i===void 0?void 0:i.exporter}get materials(){return this._materials}exportViewerConfig(e=!0,i){if(!this._viewer)return{};const s={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{},...i},a=this._viewer.toJSON(s);return e||Object.values(s).forEach(h=>{h&&Object.values(h).forEach(d=>{d.url&&(console.log(d.url),(d.url.data instanceof ArrayBuffer||Array.isArray(d.url.data))&&(d.url.type==="Uint16Array"?(d.url.data instanceof Uint16Array||(d.url.data=new Uint16Array(d.url.data)),d.url.data="data:application/octet-stream;base64,"+Ks(d.url.data.buffer)):d.url.type==="Uint8Array"?(d.url.data instanceof Uint8Array||(d.url.data=new Uint8Array(d.url.data)),d.url.data="data:application/octet-stream;base64,"+Ks(d.url.data.buffer)):d.url.data instanceof ArrayBuffer?d.url.data="data:application/octet-stream;base64,"+Ks(d.url.data.buffer):console.warn("Unsupported buffer type",d.url.type)))})}),a.resources=s,a}exportPluginPresets(e){var i;const s={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{}};return{plugins:(i=this._viewer)===null||i===void 0?void 0:i.serializePlugins(s,e),resources:s}}exportPluginPreset(e){if(!e.toJSON)return;const i={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},s=e.toJSON(i);return s.resources=i,s}async importPluginPreset(e,i){var s;const a=e.type;if(!(i=i||((s=this._viewer)===null||s===void 0?void 0:s.getPluginByType(a))))return void console.warn(`No plugin found for type ${a} to import preset`);if(!i.fromJSON)return void console.warn(`Plugin ${a} does not support importing presets`);const h=e.resources||{};return e.resources&&delete e.resources,await i.fromJSON(e,h),h&&(e.resources=h),i}async importViewerConfig(e,i){if(!this._viewer||!this._importer)return void console.warn("No viewer or importer");const s=await this.importConfigResources(e.resources||{},i);this.applyViewerConfig(e,s)}applyViewerConfig(e,i){var s;if(this._viewer&&this._importer)if((i=i||e.resources).__isLoadedResources){this._viewer.fromJSON(e,i);for(const a of Object.values(i.materials))a.__useCount?delete a.__useCount:(s=this._materials)===null||s===void 0||s.unregisterMaterial(a);for(const a of Object.values(i.textures))a.__useCount&&delete a.__useCount}else console.error("Cannot load viewer config: resources not loaded",e);else console.warn("No viewer or importer")}async importConfigResources(e,i,s){var a,h,d,b,X;if(!this._importer)throw"Importer not initialized yet.";if(e.__isLoadedResources)return e;const $={};Object.values(e).forEach(re=>{re&&Object.values(re).forEach(le=>{if(!le||!le.url||typeof le.url.data!="string")return;const he=le.url.data.match(/^data:.*;base64,(.*)$/);he!=null&&he[1]?le.url.data=mp(he==null?void 0:he[1]):(le.url.type!=="Uint8Array"&&console.error("Unsupported buffer type string for ",le.url.type,"use base64"),le.url.data=new TextEncoder().encode(le.url.data).buffer)})}),i=i??new od(this._importer.loadingManager),$.animations=e.animations?i.parseAnimations(e.animations):{},s&&s.animations&&($.animations={...$.animations,...s.animations}),$.shapes=e.shapes?i.parseShapes(e.shapes):{},s&&s.shapes&&($.shapes={...$.shapes,...s.shapes}),$.geometries=e.geometries?i.parseGeometries(e.geometries,$.shapes):{},s&&s.geometries&&($.geometries={...$.geometries,...s.geometries}),$.images=e.images?await i.parseImagesAsync(Object.values(e.images)):{},s&&s.images&&($.images={...$.images,...s.images});for(const re of Object.values(e.textures)){const le=(a=re==null?void 0:re.userData)===null||a===void 0?void 0:a.rootPath;if(le&&(!re.image||!$.images[re.image])){const he=(h=await this._importer.importPath(le,{processImported:!1}))===null||h===void 0?void 0:h[0],fe=he==null?void 0:he.source;if(!he||!fe)continue;const me=new _.Hw6(fe.data);re.image&&(me.uuid=re.image),$.images[me.uuid]=me,re.image=me.uuid,he.dispose()}}$.textures=e.textures?i.parseTextures2(Object.values(e.textures),$.images,()=>{Object.values($.textures).forEach(re=>{var le;re.isTexture&&(!((le=re.image)===null||le===void 0)&&le.complete)&&(re.needsUpdate=!0)})}):{};for(const re of Object.entries($.textures))re[1]=(d=await this._importer.processImported(re[1],{}))===null||d===void 0?void 0:d[0],re[1]?$.textures[re[0]]=re[1]:delete $.textures[re[0]];s&&s.textures&&($.textures={...$.textures,...s.textures});const Z=e.materials?Object.values(e.materials):[];for(const re of Z)Object.entries(re).forEach(([le,he])=>{he&&he.resource&&he.uuid&&he.resource==="textures"&&(re[le]=he.uuid)});if($.materials=i.parseMaterials2(Z,$.textures,this._materials),s&&s.materials&&($.materials={...$.materials,...s.materials}),e.object&&($.object=i.parseObject(e.object,$.geometries,$.materials,$.textures,$.animations),e.skeletons&&($.skeletons=i.parseSkeletons(e.skeletons,$.object),i.bindSkeletons($.object,$.skeletons))),e.extras){$.extras=e.extras;for(const re of Object.values(e.extras))if(re.uuid&&re.url)if(typeof re.url=="string"){const le=await((b=this._importer)===null||b===void 0?void 0:b.importPath(re.url));(le==null?void 0:le.length)>0&&($.extras[re.uuid]=le[0])}else if(re.url.data){const le=new File([If(re.url.type,re.url.data)],re.url.path),he=await((X=this._importer)===null||X===void 0?void 0:X.importAsset({path:le.name,file:le}));(he==null?void 0:he.length)>0&&($.extras[re.uuid]=he[0])}else console.warn("invalid URL type while loading extra resource")}return s&&s.extras&&($.extras={...$.extras,...s.extras}),$.__isLoadedResources=!0,$}}Kn.PluginType="AssetManager",Kn.ViewerTypeSlug="vjson";class Xi extends oe{constructor(){super(...arguments),this._dirty=!1}get dirty(){return this._dirty}set dirty(e){this._dirty=e}async onAdded(e){this._viewer=e}async onDispose(e){}async onRemove(e){this._viewer!==e&&console.error("Wrong viewer"),this._viewer=void 0}toJSON(e){const i=qn(this,!0,e);return i.type=this.constructor.PluginType,this.dispatchEvent({type:"serialize",data:i}),i}fromJSON(e,i){return e.type!==this.constructor.PluginType?null:(bn(e,this,!0,i),this.dispatchEvent({type:"deserialize",data:e}),this)}}function yd(c,e,i){return{...e,get dirty(){return e.dirty||!1},set dirty(s){nt(e,"dirty",s,!0)},update(){var s,a,h;this.passObject.enabled&&((a=(s=this.passObject).updateShaderProperties)===null||a===void 0||a.call(s,st(i)),(h=e.update)===null||h===void 0||h.call(this))},onRegister(s){var a,h,d;this.passObject.materialExtension&&((h=(a=c.getPlugin(Kn))===null||a===void 0?void 0:a.materials)===null||h===void 0||h.registerMaterialExtension(this.passObject.materialExtension)),(d=e.onRegister)===null||d===void 0||d.call(this,s)},onUnregister(s){var a,h,d;this.passObject.materialExtension&&((h=(a=c.getPlugin(Kn))===null||a===void 0?void 0:a.materials)===null||h===void 0||h.unregisterMaterialExtension(this.passObject.materialExtension)),(d=e.onUnregister)===null||d===void 0||d.call(this,s)},dispose(){var s,a,h;(a=(s=this.passObject).dispose)===null||a===void 0||a.call(s),(h=e.dispose)===null||h===void 0||h.call(this)}}}class Sl extends Xi{constructor(){super(),this._enabledTemp=!0}_update(e){var i;return((i=this._pass)===null||i===void 0?void 0:i.enabled)&&this.enabled||!1}get enabled(){var e,i;return((i=(e=this._pass)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.enabled)||this._enabledTemp}set enabled(e){var i;!((i=this._pass)===null||i===void 0)&&i.passObject&&(this._pass.passObject.enabled=e),this._enabledTemp=e}async onAdded(e){await super.onAdded(e);const i={enabled:!0,passId:this.passId,passObject:this.passCtor(e),after:this._afterFilters,before:this._beforeFilters,required:this._requiredFilters,set dirty(s){s&&e.setDirty()},get dirty(){return!1},update:()=>this._update(e)};this._pass=yd(e,i),i.passObject.onDirty!==void 0&&i.passObject.onDirty.push(()=>i.dirty=!0),e.renderer.registerPass(this._pass),this.enabled=this._enabledTemp}async onRemove(e){var i,s;this._pass&&e.renderer.unregisterPass(this._pass),(s=(i=this._pass)===null||i===void 0?void 0:i.dispose)===null||s===void 0||s.call(i),this._pass=void 0,await super.onRemove(e)}get pass(){return this._pass}toJSON(e){var i,s;const a=super.toJSON(e);if(!a.type)return a;const h=this.pass;return h&&(a.pass=qn((s=(i=h)===null||i===void 0?void 0:i.passObject)!==null&&s!==void 0?s:h,!1,e)),a}fromJSON(e,i){var s,a;if(!super.fromJSON(e,i))return null;if(e.pass){const h=this.pass;h&&bn(e.pass,(a=(s=h)===null||s===void 0?void 0:s.passObject)!==null&&a!==void 0?a:h,!1,i)}return this}}(function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);h>3&&d&&Object.defineProperty(e,i,d)})([kt()],Sl.prototype,"enabled",null);const Dg=new Set,Pg=new Set;class Nv extends ih{constructor(e,i,s=new oi(1,1,1),a=1){super(void 0,void 0,i,s,a),this.target=e}render(e,i,s,a,h){const d=e.getRenderTarget(),b=e.getActiveCubeFace(),X=e.getActiveMipmapLevel();this.scene.traverse(({material:$})=>{$&&(($.transparent&&$.userData.renderToDepth||!$.transparent&&$.transmission===0&&$.userData.renderToDepth===!1)&&(Dg.add($),$.transparent=!$.transparent),Math.abs($.transmission||0)>0&&$.userData.renderToDepth&&(Pg.add([$,$.transmission]),$.transmission=0))}),Rn(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(e,i,this.target,a,h)),Dg.forEach($=>$.transparent=!$.transparent),Dg.clear(),Pg.forEach(([$,Z])=>$.transmission=Z),Pg.clear(),e.setRenderTarget(d,b,X)}}class Or extends Sl{constructor(e=!0){super(),this.renderFlagsBuffer=e,this.passId="gbuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._gbufferTextures=[]}passCtor(e){var i,s;const a=((i=this._viewer)===null||i===void 0?void 0:i.renderer.isWebGL2)&&this.renderFlagsBuffer,h=e.renderer.createTarget({depthBuffer:!0,type:_.ywz,textureCount:a?2:1});Array.isArray(h.texture)?(h.texture[0].name="gbufferDepthNormal",h.texture[1].name="gbufferFlags",this._gbufferTextures=h.texture):(h.texture.name="gbufferDepthNormal",this._gbufferTextures.push(h.texture)),this._gbufferTarget=h;const d=(s=this._viewer)===null||s===void 0?void 0:s.getPluginByType("debug");return d&&(d.addTexture("gbuffer depth normal",()=>this.getDepthNormal(),[40,110,300,200]),this._gbufferTextures.length>1&&d.addTexture("gbuffer flags",()=>this.getFlagsTexture(),[40,310,200,100])),this._material=new xv(a),new Nv(h,this._material)}_update(e){if(!super._update(e))return!1;const i=this.pass.passObject;return i.scene=e.scene.modelObject,e.scene.activeCamera.updateShaderProperties(i.overrideMaterial),i.camera=e.scene.activeCamera.cameraObject,!0}getDepthNormal(){return this._gbufferTextures.length>0?this._gbufferTextures[0]:void 0}getFlagsTexture(){return this._gbufferTextures.length>1?this._gbufferTextures[1]:void 0}async onDispose(e){}async onRemove(e){return this._gbufferTarget&&(e.renderer.disposeTarget(this._gbufferTarget),this._gbufferTarget=void 0),super.onRemove(e)}getTarget(){return this._gbufferTarget}getUnpackSnippet(){return Wa}updateShaderProperties(e){var i,s;if(e.uniforms.tNormalDepth?e.uniforms.tNormalDepth.value=(i=this.getDepthNormal())!==null&&i!==void 0?i:void 0:console.warn("BaseRenderer: no uniform: tNormalDepth"),e.uniforms.tGBufferFlags){e.uniforms.tGBufferFlags.value=(s=this.getFlagsTexture())!==null&&s!==void 0?s:void 0;const a=e.uniforms.tGBufferFlags.value?1:0;a!==e.defines.GBUFFER_HAS_FLAGS&&(e.defines.GBUFFER_HAS_FLAGS=a,e.needsUpdate=!0)}return this}registerGBufferUpdater(e){this._material&&this._material.addGBufferUpdater(e)}}Or.PluginType="GBuffer";class RA extends ih{constructor(e,i=!0){super(),this.blurTransmissionTarget=!1,this._viewer=e,this._doTransmissionFix=i,this.clear=!0,this.clearColor=new oi(0,0,0),this.clearAlpha=0,this.clearDepth=!1,this._blendPass=new dg({},"c = vec4(a.rgb * (1. - b.a) + b.rgb * b.a, 1.);")}get transparentTarget(){return this._transparentTarget||(this._transparentTarget=this._viewer.renderer.getTempTarget({sizeMultiplier:1,samples:this._viewer.renderer.composerTarget.samples||0,encoding:_.rnI,type:_.cLu,format:_.wk1,minFilter:_.wem,magFilter:_.wem,depthBuffer:!1})),this._transparentTarget}_releaseTransparentTarget(){this._transparentTarget&&this._viewer.renderer.releaseTempTarget(this._transparentTarget),this._transparentTarget=void 0}render(e,i,s,a,h){var d;let b=!1;if(e.userData.mainRenderPass=!0,!this._doTransmissionFix)return super.render(e,i,s,a,h),this.needsSwap=b,void(e.userData.mainRenderPass=void 0);const X=e.userData;X||console.error("threejs is not patched?");const $=this._viewer.useGBufferDepth;let Z;if($){const le=(d=this._viewer.getPlugin(Or))===null||d===void 0?void 0:d.getTarget();if(le){const he=e.properties.get(le);Z=he.__webglDepthRenderbuffer||he.__webglDepthbuffer}else console.warn("No Gbuffer present for depth prepass.")}let re=()=>{super.render(e,void 0,s,a,h,Z)};if(this._viewer.useRgbm){if(this._viewer.useRgbm){if(b=!1,!e.info.autoReset)throw"renderer.info.autoReset must be true";{const le=e.autoClearDepth;e.autoClearDepth=!$,Rn(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},re),e.autoClearDepth=le}if(!$){const le=e.properties.get(s);Z=le.__webglDepthRenderbuffer||le.__webglDepthbuffer}re=()=>{super.render(e,void 0,this.transparentTarget,a,h,Z)};{const le=this.clear,he=e.autoClearDepth;e.autoClearDepth=!1,this.clear=!0,Rn(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!0,transmissionRender:!1},re),this.clear=le,e.autoClearDepth=he}e.info.render.calls>0&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,i,s,a,h),b=!0);{const le=this.clear;this.clear=!1,X.transmissionRenderTarget=b?i:s,X.blurTransmissionTarget=this.blurTransmissionTarget,Rn(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},re),X.blurTransmissionTarget=void 0,X.transmissionRenderTarget=void 0,this.clear=le}e.info.render.calls>0&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,i,s,a,h),b=!0)}}else{{const le=this.clear,he=e.autoClearDepth;e.autoClearDepth=!$,this.clear=!0,Rn(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!0,transmissionRender:!1},re),this.clear=le,e.autoClearDepth=he}{this._viewer.renderer.blit(s.texture,i,{clear:!0});const le=this.clear;this.clear=!1,X.transmissionRenderTarget=i,X.blurTransmissionTarget=this.blurTransmissionTarget,Rn(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},re),X.blurTransmissionTarget=void 0,X.transmissionRenderTarget=void 0,this.clear=le}b=!1}this._releaseTransparentTarget(),this.needsSwap=b,e.userData.mainRenderPass=void 0}}function Uv(c,e){return c.multiplyScalar(c.w*e),c.w=1,c}function Fv(c,e){return Uv(c,e),new oi(c.x,c.y,c.z)}function bd(c,e){const i=Math.max(c.x,Math.max(c.y,c.z));let s=Math.max(Math.min(i/e,1),0);return s=Math.ceil(255*s)/255,c.divideScalar(s*e),c.w=s,c}function Ca(c,e){return bd(new _.Ltg(c.r,c.g,c.b,1),e)}var Qo=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};function zf(c){return Object.getPrototypeOf(c).constructor.PluginType}_.Vj0.background.fragmentShader=_.Vj0.background.fragmentShader.replace("uniform sampler2D t2D;",`uniform sampler2D t2D;
uniform float intensity;`),_.Vj0.background.fragmentShader=_.Vj0.background.fragmentShader.replace("texture2D( t2D, vUv )","texture2D( t2D, vUv )*intensity");class Zl extends oe{constructor({isAntialiased:e=!1,useRgbm:i=!0,useGBufferDepth:s=!1,screenShader:a="",...h}){var d;super(),this.console=console,this._state=Te.None,this.plugins={},this._needsResize=!1,this.resizeObserver=window.ResizeObserver?new window.ResizeObserver(le=>this.resize()):void 0,this._lastSize=new _.FM8,this._onContextRestore=le=>{this.enabled=!0,this._canvas.width=this._lastSize.width,this._canvas.height=this._lastSize.height,this.resize(),this.scene.setDirty({sceneUpdate:!0,frameFade:!1})},this._onContextLost=le=>{this._lastSize.set(this._canvas.width,this._canvas.height),this._canvas.width=2,this._canvas.height=2,this.resize(),this.enabled=!1},this.resize=()=>{this._needsResize=!0,this.setDirty()},this._needsReset=!0,this.enabled=!0,this.renderEnabled=!0,this._isRenderingFrame=!1,this.maxFramePerLoop=1,this._rawBackground=null,this.backgroundIntensity=1,this._sceneEnvironmentChanged=()=>{this._rawBackground===Vc&&this.scene.setBackground(this.scene.getEnvironment())},this._addSceneObject=le=>{var he;if(!le||!le.object)return;const fe=le.object.__importedViewerConfig||((he=le.object.modelObject)===null||he===void 0?void 0:he.__importedViewerConfig);if(!fe)return;const me=this.getManager();me?me.applyViewerConfig(fe,fe.resources):this.fromJSON(fe,fe.resources)},this.alert=async le=>alert(le),this.confirm=async le=>confirm(le),this.prompt=async(le,he,fe=!0)=>prompt(le,he),this._useRgbm=i,this._useGBufferDepth=s,this._screenShader=a,this._canvas=h.canvas||au();let b=h.container;if(b&&!h.canvas&&b.appendChild(this._canvas),b||(b=(d=this._canvas.parentElement)!==null&&d!==void 0?d:void 0),!b)throw new Error("No container.");this._container=b,this._animationLoop=this._animationLoop.bind(this),this.setDirty=this.setDirty.bind(this),this._setActiveCameraView=this._setActiveCameraView.bind(this),window.webGiViewers||(window.webGiViewers=[]),window.webGiViewers.push(this),async function(){var le;const he=window.location.href,fe="https://dev-sandbox.pixotronics.com/webgi/";if(!he.startsWith(fe)||Do("noUpdate")!==null)return!0;const me=(le=he.match(/\/webgi\/([0-9.a-zA-Z]+)/))===null||le===void 0?void 0:le[1],Ee=(await(await fetch(fe+"version.txt")).text()).split(`
`)[0];if(me&&me!==Ee){if(confirm(`New version ${Ee} is available, do you want to open?`)){const Ae=window.location.href.replace(me,Ee);return window.location.href=Ae,!1}window.location.href.includes("noUpdate")||(window.location.href+=(window.location.href.includes("?")?"&":"?")+"noUpdate")}}();const X=new ta(void 0,void 0,this._canvas);this.addEventListener("postFrame",()=>{var le,he;const fe=Z.scene.activeCamera;if(fe&&fe.interactionsEnabled){if(((le=this.getPluginByType("Progressive"))===null||le===void 0?void 0:le.postFrameConvergedRecordingDelta())===0)return;(he=fe.controls)===null||he===void 0||he.update()}}),this.scene=new gl(X),this.scene.addEventListener("environmentChanged",this._sceneEnvironmentChanged),this.scene.addEventListener("addSceneObject",this._addSceneObject),this.scene.addEventListener("setView",this._setActiveCameraView),this.scene.addEventListener("activateMain",this._setActiveCameraView),this._renderer=new Li({canvas:this._canvas,animationLoop:this._animationLoop,targetOptions:{samples:e?4:0,encoding:i?ln:_.rnI,type:i?_.ywz:_.cLu,depthBuffer:!s}}),this._isAntialiased=e&&this._renderer.isWebGL2;let $=!0;this._renderer.rendererObject.userData||($=!1,this._renderer.rendererObject.userData={}),this._renderer.rendererObject.userData.renderTransmissionPass=!$;const Z=this;this.renderFilter={passId:"render",passObject:new RA(this,$),update(){const le=this.passObject;le.scene=Z.scene.modelObject,le.camera=Z.scene.activeCamera.cameraObject}};const re={passId:"screen",after:["render"],required:["render"],passObject:$w(a)};[this.renderFilter,re].forEach(le=>this._renderer.registerPass(le)),this._renderer.pipeline=["render","screen"],this.scene.addEventListener("sceneMaterialUpdate",le=>this.setDirty(this.scene,le)),this.scene.addEventListener("sceneUpdate",le=>{this.setDirty(this.scene,le),le.geometryChanged!==!1&&this.renderer.resetShadows()}),this.scene.addEventListener("update",le=>this.setDirty(this.scene,le)),this._renderer.addEventListener("update",le=>this.setDirty(this._renderer,le)),this.resizeObserver&&this.resizeObserver.observe(this._canvas),window&&window.addEventListener("resize",this.resize),this._canvas.addEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.addEventListener("webglcontextlost",this._onContextLost,!1),this.renderer.addEventListener("resize",()=>{this.scene.activeCamera.refreshAspect()}),this.setBackground("#ffffff"),this.console.log("WebGi Viewer instance initialized, version: ",Zl.VERSION)}get useRgbm(){return this._useRgbm}get screenShader(){return this._screenShader}get useGBufferDepth(){return this._useGBufferDepth}get isAntialiased(){return this._isAntialiased}setDirty(e,i){this._needsReset=!0,e=e??this,this.dispatchEvent({...i??{},type:"update",source:e})}get renderer(){return this._renderer}dispose(){var e;this._canvas.removeEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.removeEventListener("webglcontextlost",this._onContextLost,!1),(e=window.webGiViewers)===null||e===void 0||e.splice(window.webGiViewers.indexOf(this),1),this.resizeObserver?this.resizeObserver.unobserve(this._canvas):window.removeEventListener("resize",this.resize),this.dispatchEvent({type:"dispose"})}_animationLoop({time:e,deltaTime:i,xrFrame:s}){var a,h;if(this.enabled&&this.renderEnabled)if(this._isRenderingFrame)this.console.warn("animation loop: frame skip");else{this._isRenderingFrame=!0;for(let d=0;d<this.maxFramePerLoop;d++){if(this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._needsResize){const $=[this._canvas.clientWidth,this._canvas.clientHeight];if(s){const Z=(h=(a=this._renderer.rendererObject.xr.getCamera())===null||a===void 0?void 0:a.cameras[0])===null||h===void 0?void 0:h.viewport;Z?(Z.x===0&&Z.y===0||this.console.warn("x and y must be 0?"),$[0]=Z.width,$[1]=Z.height,this.console.log("resize for xr",$)):this._needsResize=!1}this._needsResize&&(this._renderer.setSize(...$),this._needsResize=!1)}this.dispatchEvent({type:"preFrame",target:this,time:e,deltaTime:i,xrFrame:s});const b=Object.values(this.plugins).filter($=>$.dirty);b.length>0&&this.setDirty(b),this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._renderer.updateDirty();const X=this._renderer.dirty;if(X){this.dispatchEvent({type:"preRender",target:this});try{this._renderer.render()}catch($){this.console.error($),this.enabled=!1}this.dispatchEvent({type:"postRender",target:this})}if(this.dispatchEvent({type:"postFrame",target:this}),!X)break}this._isRenderingFrame=!1}}get state(){return this._state}get container(){return this._container}get canvas(){return this._canvas}getPlugin(e){return this.plugins[e.PluginType]}getPluginByType(e){return this.plugins[e]}async addPlugin(e,...i){var s;let a;a=e.prototype?new e(...i):e;const h=zf(a);return h?((s=a.dependencies)===null||s===void 0||s.forEach(d=>{this.getPlugin(d)||this.addPlugin(d)}),this.plugins[h]&&this.console.error(`Plugin of type ${h} already exists`,this.plugins[h],a),this.plugins[h]=a,await a.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:a}),this.setDirty(a),a):(this.console.error("PluginType is not defined for",a),a)}async removePlugin(e,i=!0){const s=zf(e);this.plugins[s]&&(await e.onRemove(this),delete this.plugins[s],i&&await e.onDispose(this),this.setDirty(e))}createCamera(e){var i;const s=(i=e.userData.iCamera)!==null&&i!==void 0?i:new ta(e,{controlsMode:"",controlsEnabled:!1},this._canvas);return s.autoLookAtTarget=!1,s}setSize(e){this._canvas.style.width=e!=null&&e.width?e.width+"px":"100%",this._canvas.style.height=e!=null&&e.height?e.height+"px":"100%",this.resize()}_backgroundIntensityChanged(){var e,i,s,a;const h=(a=(s=(i=(e=this._renderer)===null||e===void 0?void 0:e.rendererObject)===null||i===void 0?void 0:i.background.getPlaneMesh())===null||s===void 0?void 0:s.material.uniforms)!==null&&a!==void 0?a:_.Vj0.background.uniforms;h.intensity||(h.intensity={value:1}),h.intensity.value=this.backgroundIntensity,this.setDirty()}setBackgroundColor(e){const i=new oi().set(e).convertSRGBToLinear();return this.setBackground(i)}setBackground(e){if(this._rawBackground=e,e!=null&&(typeof e=="string"||typeof e=="number"||e.isVector4||e.isColor)){if(e===Vc)return this._sceneEnvironmentChanged();const i=e.isVector4?Pn(e):Mn(e.isColor?e:new oi(e));return i.assetType="texture",this.scene.setBackground(i)}return!e&&this.useRgbm&&this.console.error("Transparent background not supported with HDR RGBM rendering mode"),this.scene.setBackground(e)}getBackground(e=!1){var i,s,a;if(e)return this._rawBackground;let h=(i=this._rawBackground)!==null&&i!==void 0?i:this.scene.getBackground();return h?(!((s=h)===null||s===void 0)&&s.isVector4&&(h=Fv(h,7).getHexString()),!((a=h)===null||a===void 0)&&a.isColor?h.getHexString():this._rawBackground===Vc?this.scene.getEnvironment():h):null}getManager(){return this.getPluginByType("AssetManager")}resetCamera({rootObject:e,centerOffset:i=new _.Pa4(1,1,1),targetOffset:s=new _.Pa4(0,0,0),...a}={}){if(this.scene.activeCamera){this.scene.matrixWorldNeedsUpdate=!0,this.scene.updateMatrixWorld(!0);const h=e?new nn().expandByObject(e,!0,!0):this.scene.getBounds(!0),d=h.getCenter(new _.Pa4),b=.5*h.getSize(new _.Pa4).length();d.add(s.clone().multiplyScalar(b)),this.scene.activeCamera.position=new _.Pa4(d.x+i.x*b,d.y+i.y*b,d.z+i.z*b),this.scene.activeCamera.target=d,this.setDirty()}}async createObject3D(e){var i;return(i=this.getManager())===null||i===void 0?void 0:i.addImportedSingle(e||new _.Tme,{autoScale:!1,pseudoCenter:!1})}createPhysicalMaterial(e){return this.createMaterial("standard",e)}createMaterial(e,i){var s,a,h,d,b;if(!((s=i)===null||s===void 0)&&s.isMaterial){const X=(h=(a=this.getManager())===null||a===void 0?void 0:a.materials)===null||h===void 0?void 0:h.findMaterial(i.uuid);if(X)return X}return(b=(d=this.getManager())===null||d===void 0?void 0:d.materials)===null||b===void 0?void 0:b.generateFromTemplate(e,i)}serializePlugins(e,i){return Object.entries(this.plugins).map(s=>{var a,h;if(!i||i.includes(s[1].constructor.PluginType))return s[1].serializeWithViewer!==!1?(h=(a=s[1]).toJSON)===null||h===void 0?void 0:h.call(a,e):void 0}).filter(s=>!!s)}deserializePlugins(e,i){return e.forEach(s=>{var a;if(!s.type)return void this.console.warn("Invalid plugin to import ",s);const h=this.getPluginByType(s.type);h&&((a=h.fromJSON)===null||a===void 0||a.call(h,s,i))}),this}traverseSceneObjects(e){this.scene.modelRoot.modelObject.traverse(e)}toJSON(e,i){return Object.assign({version:Zl.VERSION,plugins:this.serializePlugins(e,i)},qn(this,!0,e))}fromJSON(e,i){return bn(e,this,!0,i),Array.isArray(e.plugins)&&this.deserializePlugins(e.plugins,i),this.setBackground(this._rawBackground),this}_setActiveCameraView(e={}){if(e.type==="setView"){if(!e.camera)return void console.warn("Cannot find camera",e);this.scene.activeCamera.copyFromCamera(e.camera)}else e.type==="activateMain"&&(this.scene.activeCamera=e.camera?this.createCamera(e.camera):void 0)}}Zl.VERSION="0.5.8",Qo([kt()],Zl.prototype,"scene",void 0),Qo([kt("background")],Zl.prototype,"_rawBackground",void 0),Qo([kt(),lt(Zl.prototype._backgroundIntensityChanged)],Zl.prototype,"backgroundIntensity",void 0);const Vc="envMapBackground";function $w(c){var e,i,s;return!((e=c)===null||e===void 0)&&e.isShaderPass2?c:new Fs({...ae,fragmentShader:`
                       varying vec2 vUv;
                       
                       ${Array.isArray(c)?c[0]:((i=c)===null||i===void 0?void 0:i.pars)||""}
                       
                       void main() {

                            gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                            
                            ${Array.isArray(c)?c[1]:typeof c=="string"?c:((s=c)===null||s===void 0?void 0:s.main)||""}
                            
                        }`,uniforms:{tDiffuse:{value:null}}},"tDiffuse")}var Rg=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Mu=class extends Xi{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this._lastSize=["100%","100%"],this._lastFsElement=null,this._fsChangeHandler=c=>{var e;if(this.isFullScreen())this.dispatchEvent({type:"enter"});else{const i=this._lastFsElement||((e=this._viewer)===null||e===void 0?void 0:e.canvas);i&&(i.style.width=this._lastSize[0],i.style.height=this._lastSize[1]),document.removeEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("fullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("MSFullscreenChange",this._fsChangeHandler,!1),this.dispatchEvent({type:"exit"})}},this.enter=this.enter.bind(this),this.exit=this.exit.bind(this)}async enter(c){var e;if(this.isFullScreen())return;const i=c||((e=this._viewer)===null||e===void 0?void 0:e.canvas);return i?(this._lastFsElement=i,document.addEventListener&&(document.addEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("fullscreenchange",this._fsChangeHandler,!1),document.addEventListener("MSFullscreenChange",this._fsChangeHandler,!1)),this._lastSize=[i.style.width,i.style.height],i.style.width="100%",i.style.height="100%",i.requestFullscreen?i.requestFullscreen():i.mozRequestFullScreen?i.mozRequestFullScreen():i.webkitRequestFullscreen?i.webkitRequestFullscreen():i.msRequestFullscreen?i.msRequestFullscreen():void 0):void 0}async exit(){return document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():void 0}async toggle(c){return this.isFullScreen()?this.exit():this.enter(c)}isFullScreen(){return document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement!==void 0}};Mu.PluginType="FullScreenPlugin",Rg([lr("Enter FullScreen")],Mu.prototype,"enter",null),Rg([lr("Exit FullScreen")],Mu.prototype,"exit",null),Rg([lr("Toggle FullScreen")],Mu.prototype,"toggle",null),Mu=Rg([ur("Full Screen")],Mu);class BA{constructor(e,i,s){this._el=e,this._inputEl=i,this._listeners={drop:[],dropstart:[],droperror:[]},this._onDragover=this._onDragover.bind(this),this._onDrop=this._onDrop.bind(this),this._onSelect=this._onSelect.bind(this),e==null||e.addEventListener("dragover",this._onDragover,!1),e==null||e.addEventListener("drop",this._onDrop,!1),i==null||i.addEventListener("change",this._onSelect),s&&Object.entries(s).forEach(([a,h])=>h&&this.on(a,h))}get inputEl(){return this._inputEl}get el(){return this._el}on(e,i){return this._listeners[e].push(i),this}_emit(e,i){return this._listeners[e].forEach(s=>s(i)),this}destroy(){const e=this._el,i=this._inputEl;e==null||e.removeEventListener("dragover",this._onDragover),e==null||e.removeEventListener("drop",this._onDrop),i==null||i.removeEventListener("change",this._onSelect)}_onDrop(e){var i,s;e.stopPropagation(),e.preventDefault(),this._emit("dropstart");const a=Array.from(((i=e.dataTransfer)===null||i===void 0?void 0:i.files)||[]),h=Array.from(((s=e.dataTransfer)===null||s===void 0?void 0:s.items)||[]);if(a.length!==0||h.length!==0)if(h.length>0){const d=h.map(b=>b.webkitGetAsEntry());this._loadNextEntry(new Map,d)}else this._emit("drop",{files:new Map(a.map(d=>(d.filePath=d.name,[d.filePath,d])))});else this._fail("Required drag-and-drop APIs are not supported in this browser.")}_onDragover(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")}_onSelect(e){var i;if(!this._inputEl)return void console.warn("Invalid Dropzone event ",e);this._emit("dropstart");const s=[].slice.call((i=this._inputEl.files)!==null&&i!==void 0?i:new FileList),a=new Map;s.forEach(h=>{h.filePath=h.webkitRelativePath||h.name,a.set(h.filePath,h)}),this._emit("drop",{files:a})}_loadNextEntry(e,i){const s=i.pop();if(s)if(s.isFile)s.file(a=>{a.filePath=s.fullPath,e.set(s.fullPath,a),this._loadNextEntry(e,i)},()=>console.error("Could not load file: %s",s.fullPath));else if(s.isDirectory){const a=s.createReader(),h=d=>{d.length?(i=i.concat(d),a.readEntries(h)):this._loadNextEntry(e,i)};a.readEntries(h)}else console.warn("Unknown asset type: "+s.fullPath),this._loadNextEntry(e,i);else this._emit("drop",{files:e})}_fail(e){this._emit("droperror",{message:e})}}class Vf extends oe{constructor(e){super(),this._domElement=e,this._allowedExtensions=void 0,this.importerParams={autoScale:!0,autoScaleRadius:2,pseudoCenter:!1,autoCenter:!0,autoImport:!0,autoAdd:!0,centerOffset:new _.Pa4(.5,.5,3)},this.dependencies=[Kn],this.uiConfig={type:"folder",label:"Drop Options",children:[{label:"Auto Center",type:"checkbox",property:[this.importerParams,"autoCenter"],limitedUi:!0},{label:"Auto Scale",type:"checkbox",property:[this.importerParams,"autoScale"],limitedUi:!0},{label:"Auto scale radius",type:"slider",bounds:[.5,100],property:[this.importerParams,"autoScaleRadius"]}]}}async onAdded(e){this._inputEl=document.createElement("input"),this._viewer=e,this._inputEl.type="file",this._dropzone=new BA(this._domElement||e.canvas,this._inputEl,{drop:this._onFileDrop.bind(this)})}async _onFileDrop({files:e}){var i,s,a,h,d,b;if(!e)return;const X=this._viewer;if(!X)return;if(this._allowedExtensions!==void 0)for(const re of e.keys())this._allowedExtensions.includes((s=(i=re.split(".").pop())===null||i===void 0?void 0:i.toLowerCase())!==null&&s!==void 0?s:"")||e.delete(re);if(e.size<1)return;const $=X.getPlugin(Kn),Z={type:"drop",files:e};if(this.importerParams.autoImport){const re={allowedExtensions:this.allowedExtensions,...this.importerParams};if(Z.imported=await((a=$.importer)===null||a===void 0?void 0:a.importFiles(e,re)),this.importerParams.autoAdd){const le=(b=[...(d=(h=Z.imported)===null||h===void 0?void 0:h.values())!==null&&d!==void 0?d:[]].flat(2).filter(he=>!!he))!==null&&b!==void 0?b:[];if(Z.assets=$.addProcessedAssets(le,{...this.importerParams}),!re._rootSceneImported)for(const he of Z.assets)he.modelObject&&he.modelObject.dispatchEvent({type:"select",value:he.modelObject})}}this.dispatchEvent(Z)}promptForFile(){var e;(e=this._inputEl)===null||e===void 0||e.click()}async onDispose(e){}async onRemove(e){var i;(i=this._dropzone)===null||i===void 0||i.destroy(),this._dropzone=void 0,this._viewer=void 0}get allowedExtensions(){return this._allowedExtensions}set allowedExtensions(e){this._allowedExtensions=e,this._inputEl&&(this._inputEl.accept=e?e.map(i=>"."+i).join(", "):"")}}Vf.PluginType="Dropzone";class jv extends Fs{constructor(e){super({vertexShader:ae.vertexShader,fragmentShader:Ne`
                uniform vec4 weight;
                uniform vec4 weight2;
                varying vec2 vUv;
                void main() {
                    vec4 texel = clamp(weight * tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ) + weight2 * tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:e},weight:{value:new _.Ltg(1,1,1,1)},weight2:{value:new _.Ltg(1,1,1,1)}}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}set weights2(e){this.uniforms.weight2.value.copy(e)}get weights2(){return this.uniforms.weight2.value}set weights1(e){this.uniforms.weight.value.copy(e)}get weights1(){return this.uniforms.weight.value}set blendTexture(e){this.uniforms.tDiffuse2.value=e}}class Gf extends Xi{constructor(){super(),this._pipeline=[]}get passes(){if(!this._passes)throw"Plugin not yet added to the viewer";return this._passes}get pipeline(){return this._pipeline}set pipeline(e){this._pipeline=e}async onAdded(e){await super.onAdded(e);const i=this.createPasses(e);this._passes=Object.fromEntries(i.map(s=>(s.passId||(console.warn("no id found for pass",s),s.passId=Ms()),e.renderer.registerPass(s,!0),[s.passId,s])))}async onRemove(e){var i;if(this._passes){for(const s of[...Object.values(this._passes)]){const a=s;e.renderer.unregisterPass(a),(i=a==null?void 0:a.dispose)===null||i===void 0||i.call(a)}this._passes=void 0}await super.onRemove(e)}toJSON(e){var i,s;const a=super.toJSON(e);if(!a.type)return a;const h=Object.entries(this.passes);a.passes={};for(const[d,b]of h)a.passes[d]=qn((s=(i=b)===null||i===void 0?void 0:i.passObject)!==null&&s!==void 0?s:b,!1,e);return a}fromJSON(e,i){var s,a;if(!super.fromJSON(e,i))return null;if(e.passes){const h=Object.entries(this.passes);for(const[d,b]of h)bn(e.passes[d],(a=(s=b)===null||s===void 0?void 0:s.passObject)!==null&&a!==void 0?a:b,!1,i)}return this}}var kA=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};const zv=[{x:0,y:0},{x:-.5,y:0},{x:-.375,y:-.25},{x:-.1875,y:-.125},{x:-.125,y:-.375},{x:.0625,y:-.0625},{x:.125,y:-.3125},{x:.375,y:-.4375},{x:.3125,y:-.1875},{x:.25,y:.0625},{x:.4375,y:.25},{x:.1875,y:.3125},{x:0,y:.4375},{x:-.0625,y:.1875},{x:-.25,y:.375},{x:-.4375,y:.5},{x:-.3125,y:.125}];class Ho extends Gf{constructor(e=2*zv.length){super(),this.enabled=!0,this.jitter=!0,this._hasSetOffset=!1,this.trackedJitterCameras=new Set,this._addSceneObject=i=>{const s=i.object;(s.modelObject||s.lightObject)&&(s.modelObject||s.lightObject).traverse(a=>{var h;!((h=a==null?void 0:a.shadow)===null||h===void 0)&&h.camera&&a.shadow.mapSize&&this.trackedJitterCameras.add([a.shadow.camera,a.shadow.mapSize])})},this._jitterCamera=i=>{var s;const a=i.target;if(this.jitter&&a.renderer.frameCount>2){const h=(b,X)=>{const $={...zv[a.renderer.frameCount%zv.length]};b.setViewOffset(X.width,X.height,$.x,$.y,X.width,X.height)},d=a.scene.activeCamera.cameraObject;h(d,{width:a.canvas.clientWidth*a.renderer.displayCanvasScaling,height:a.canvas.clientHeight*a.renderer.displayCanvasScaling}),this.trackedJitterCameras.forEach(b=>h(...b)),this._hasSetOffset=!0,(s=this._viewer)===null||s===void 0||s.renderer.resetShadows()}},this._resetCameraJitter=i=>{const s=i.target;this._hasSetOffset&&(s.scene.activeCamera.cameraObject.clearViewOffset(),this._hasSetOffset=!1)},this.uiConfig=ou("Progressive",this),this.maxFrameCount=e}async onAdded(e){return this._lastFrame=e.renderer.composerTarget.clone(!0),await super.onAdded(e)}async onRemove(e){e.removeEventListener("preRender",this._jitterCamera),e.removeEventListener("postRender",this._resetCameraJitter),e.scene.removeEventListener("addSceneObject",this._addSceneObject),this._lastFrame&&e.renderer.disposeTarget(this._lastFrame),this._lastFrame=void 0,await super.onRemove(e)}get lastFrame(){return this._lastFrame}createPasses(e){e.addEventListener("preRender",this._jitterCamera),e.addEventListener("postRender",this._resetCameraJitter),e.scene.addEventListener("addSceneObject",this._addSceneObject);const i=this;return[yd(e,{passId:"progressive",get dirty(){var a;return i.jitter&&(((a=i._viewer)===null||a===void 0?void 0:a.renderer.frameCount)||0)<i.maxFrameCount},after:["render"],before:["combinedPost","screen"],required:["render"],passObject:new class extends jv{render(a,h,d,b,X){if(e.renderer.frameCount<1)return this.needsSwap=!1,void((d==null?void 0:d.texture)&&e.renderer.blit(d.texture,i.lastFrame,{}));this.needsSwap=!0,super.render(a,h,d,b,X),e.renderer.blit(h.texture,i.lastFrame,{})}},update(){if(!i.lastFrame)return void console.error("lastFrame render target undefined");let a=1/(Math.max(e.renderer.frameCount,0)+1);this.passObject.weights1.set(a,a,a,a),a=1-a,this.passObject.weights2.set(a,a,a,a),this.passObject.blendTexture=i.lastFrame.texture,this.passObject.material.uniformsNeedUpdate=!0}})]}isConverged(e=!1){var i;return(((i=this._viewer)===null||i===void 0?void 0:i.renderer.frameCount)||0)>=this.maxFrameCount-1+(e?1:0)}updateShaderProperties(e){var i,s;return e.uniforms.tLastFrame&&(e.uniforms.tLastFrame.value=(s=(i=this.lastFrame)===null||i===void 0?void 0:i.texture)!==null&&s!==void 0?s:void 0),this}postFrameConvergedRecordingDelta(e="CanvasRecorder"){const i=this._viewer.getPluginByType(e);return i&&i.isRecording()&&i.convergeMode?this.isConverged(!0)?1/i.videoFrameRate:0:-1}}Ho.PluginType="Progressive",kA([kt(),cr("Frame count")],Ho.prototype,"maxFrameCount",void 0),kA([kt(),Xn("Jitter")],Ho.prototype,"jitter",void 0);var ec="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}",Qf=`#ifndef BASIC_CAMERA_HELPERS
#define BASIC_CAMERA_HELPERS 
uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;uniform mat4 projection;
#ifndef THREE_PACKING_INCLUDED
#define THREE_PACKING_INCLUDED 
#include <packing>
#endif
float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}float depthToViewZ(const in float depth){return(depth>0.999)?-cameraNearFar.y*1000.:-mix(cameraNearFar.x,cameraNearFar.y,depth);}float viewZToDepth(const in float viewZ){return linstep(-cameraNearFar.x,-cameraNearFar.y,viewZ);}vec4 viewToScreen3(const in vec3 pos){vec4 projected=projection*vec4(pos,1.);projected.z=pos.z;projected.w=1./projected.w;projected.xyz*=projected.w;projected.xy=0.5+0.5*projected.xy;return projected;}vec3 screenToView(const in vec2 uv,const in float viewZ){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewZ/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewZ/projection[1][1];return vec3(xe,ye,viewZ);}
#endif
`,Bg=`#ifndef BASIC_HELPERS
#define BASIC_HELPERS 
float saturate2(float v,float mx){return max(0.,min(mx,v));}vec3 saturate2(vec3 v){return max(vec3(0.),min(vec3(1.),v));}
#endif
`,tc=`#ifndef BASIC_RANDOM_HELPERS
#define BASIC_RANDOM_HELPERS 
uniform float frameCount;float random(float n){return fract(sin(n)*43758.5453123);}float random2(vec2 n,float x){n+=x;return fract(sin(dot(n.xy,vec2(12.9898,78.233)))*43758.5453);}float random3(vec3 v){v=fract(v*443.8975);v+=dot(v,v.yzx+19.19);return fract((v.x+v.y)*v.z);}float interleavedGradientNoise(const in vec2 fragCoord,const in float seed){vec3 magic=vec3(0.06711056,0.00583715,52.9829189);return fract(magic.z*fract(dot(fragCoord.xy+seed*vec2(2.083,4.867),magic.xy)));}vec3 hash3(vec2 p){vec3 q=vec3(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3)),dot(p,vec2(419.2,371.9)));return fract(sin(q)*43758.5453);}
#endif
`,Vv=`#define PI  3.141592653589793
mat3 GetTangentBasis(vec3 TangentZ){vec3 up=vec3(0.,0.,1.);vec3 TangentX=normalize(cross(dot(TangentZ,up)<0.8?up:vec3(1.,0.,0.),TangentZ));vec3 TangentY=cross(TangentZ,TangentX);return mat3(TangentX,TangentY,TangentZ);}vec4 CosineSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=sqrt(E.y);float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=CosTheta*(1./PI);return vec4(H,PDF);}vec4 UniformSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=E.y;float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=1./(2.*PI);return vec4(H,PDF);}vec2 UniformSampleDiskConcentric(vec2 E){vec2 p=2.*E-1.;float Radius;float Phi;if(abs(p.x)>abs(p.y)){Radius=p.x;Phi=(PI/4.)*(p.y/p.x);}else{Radius=p.y;Phi=(PI/2.)-(PI/4.)*(p.x/p.y);}return vec2(Radius*cos(Phi),Radius*sin(Phi));}vec2 UniformSampleDiskConcentricApprox(vec2 E){vec2 sf=E*sqrt(2.)-sqrt(0.5);vec2 sq=sf*sf;float root=sqrt(2.*max(sq.x,sq.y)-min(sq.x,sq.y));if(sq.x>sq.y){sf.x=sf.x>0.?root:-root;}else{sf.y=sf.y>0.?root:-root;}return sf;}`,kg=`#ifndef SSRT_PARS_SNIP
#define SSRT_PARS_SNIP 
#define pow2(a)a*a
float getDepth2(const in vec2 uv,const in float lod){float viewDepth=getDepth(uv);return depthToViewZ(viewDepth);}
#define LOD_DEPTH  1.0
#define LOD_COLOR  5.0
void _traceRay(in vec4 ray_origin,in vec4 ray_dir,in float tolerance,inout vec3 state,in int loopMax,in float iStepCount){vec4 sample_uv;float d,hit;float dLod=0.;
#pragma unroll_loop_start
for(int i=0;i<8;i++){if(UNROLLED_LOOP_INDEX<loopMax){sample_uv=ray_origin+ray_dir*state.y;d=getDepth2(sample_uv.xy,dLod);d=sample_uv.z/sample_uv.w-d;if(abs(d+tolerance)<tolerance){hit=clamp(state.x/(state.x-d),0.,1.)-1.;hit=(state.y+hit*iStepCount);state.z=min(state.z,hit);}state.x=d;state.y+=1.*iStepCount;}}
#pragma unroll_loop_end
}vec3 traceRay(in vec3 ray_origin_view,in vec3 ray_dir_view,in float tolerance,inout vec3 state,in int _STEP_COUNT){vec4 sample_uv;vec4 ray_origin=viewToScreen3(ray_origin_view);vec3 ray_end_view=ray_origin_view+ray_dir_view;vec4 ray_dir=viewToScreen3(ray_end_view);vec2 clamp_end=clamp(ray_dir.xy,vec2(0.),vec2(1.));vec2 correction=abs(ray_dir.xy-clamp_end);correction=(step(0.01,correction)*correction/(abs(clamp_end-ray_origin.xy)+0.01))+1.;correction.x=1./min(max(correction.y,correction.x),10.);ray_dir=ray_dir-ray_origin;ray_dir.xyw*=correction.x;float iStepCount=1./float(_STEP_COUNT);tolerance*=0.125;_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT,iStepCount);if(_STEP_COUNT>8&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-8,iStepCount);if(_STEP_COUNT>15&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);if(_STEP_COUNT>23&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);sample_uv=ray_origin+ray_dir*state.z;sample_uv.z/=sample_uv.w;state.z=state.z<0.999?state.z:9999999.;return sample_uv.xyz;}
#endif
`,OA=`uniform float objectRadius;uniform float radius;uniform float tolerance;uniform bool autoRadius;
#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
vec3 ComputeReflectionL(vec3 N,vec2 E,vec3 V,float rough){float rough4=rough*rough*rough*rough;float phi=2.*PI*E.x;float cos_theta=pow(max(E.y,0.000001),rough4/(2.-rough4));float sin_theta=sqrt(max(0.,1.-cos_theta*cos_theta));vec3 half_vec=vec3(sin_theta*cos(phi),sin_theta*sin(phi),cos_theta);vec3 tangentX=normalize(cross(abs(N.z)<0.999?vec3(0.,0.,1.):vec3(1.,0.,0.),N));vec3 tangentY=cross(N,tangentX);half_vec=half_vec.x*tangentX+half_vec.y*tangentY+half_vec.z*N;vec3 ray_dir=(2.*dot(V,half_vec))*half_vec-V;return ray_dir;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=interleavedGradientNoise(gl_FragCoord.xy,frameCount*117.);rand_e.y=fract(rand_e.x*38.65435);rand_e.y=mix(rand_e.y,1.,0.7);return rand_e;}vec4 calculateSSR(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor,in float roughness){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeReflectionL(normal,E,-normalize(viewPos),roughness);L=normalize(L);float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?mix((cameraDist+objectRadius*sceneBoundingRadius)+viewPos.z,-viewPos.z-max(0.,cameraDist-objectRadius*sceneBoundingRadius),L.z*0.5+0.5):objectRadius*sceneBoundingRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount+seed);rayLen=max(rayLen,0.001);int steps=SSR_STEP_COUNT/(frameCount<float(SSR_LOW_QUALITY_FRAMES)?2:1);vec3 state=vec3(0.,(r+0.5)/float(steps),2.);viewPos+=normal*max(-0.0001*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,steps);if(state.z<0.99){vec3 hitColor=(tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy))).rgb;float ssrWeight=1.;return vec4(hitColor*ssrWeight,1.);}return vec4(0.);}`,Og=`#ifndef SIMPLE_CAMERA_HELPERS
#define SIMPLE_CAMERA_HELPERS 
#ifndef USE_TRANSMISSION
uniform mat4 projectionMatrix;
#endif
vec3 viewToScreen(const in vec3 pos){vec4 projected=projectionMatrix*vec4(pos,1.);return vec3(0.5+0.5*projected.xy/projected.w,projected.w);}
#endif
`,nc=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Ja=class extends Fs{constructor(c,e,i,s=!0){super({vertexShader:ec,fragmentShader:`

varying vec2 vUv;

${Bg}
${Qf}
${tc}
${Vv}
${i}

${kg}

${OA}

uniform sampler2D tLastThis;void main(){vec4 texel=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 lastAO=tLastThisTexelToLinear(texture2D(tLastThis,vUv));float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>=0.999){discard;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec3 viewPos=screenToView(screenPos.xy,screenPos.z);viewPos.z=viewZ/viewPos.z;vec4 ao=vec4(0.);ao+=calculateSSR(8.,screenPos,normal,1.,0.1);ao.rgb=min(vec3(3.),ao.rgb);ao.rgb=max(vec3(0.),ao.rgb);if(frameCount<1.){gl_FragColor=ao;return;}if(ao.a<0.01){gl_FragColor.rgb=lastAO.rgb;gl_FragColor.a=(((lastAO.a)*frameCount)/(frameCount+1.));}else{gl_FragColor=((ao+(lastAO)*frameCount)/(frameCount+1.));}
#include <encodings_fragment>
}


            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:0},boost:{value:new _.Pa4(0,0,0)},objectRadius:{value:0},autoRadius:{value:!1},power:{value:0},maskFrontFactor:{value:-.1},tolerance:{value:0},frameCount:{value:0},projection:{value:new _.yGw},cameraPositionWorld:{value:new _.Pa4},cameraNearFar:{value:new _.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},defines:{PERSPECTIVE_CAMERA:1,SSR_STEP_COUNT:16,SSR_LOW_QUALITY_FRAMES:2,SSR_MASK_FRONT_RAYS:!0,SSR_INLINE:s?"1":"0",SSR_NON_PHYSICAL:"0"}},"tDiffuse","tLastThis","tLastFrame"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(a,h,d)=>{if(!a.defines.SSR_ENABLED)return;const b="#glMarker beforeModulation";a.fragmentShader=a.fragmentShader.replace(b,`

            
            #if defined(SSR_ENABLED) && SSR_ENABLED > 0
vec3 screenPos=viewToScreen(geometry.position);vec4 ssrColor=vec4(0,0,0,0);float alphaModifier=1.-clamp(material.roughness*.3,0.,1.);alphaModifier*=ssrIntensity;
#if defined(SSR_MASK_FRONT_RAYS) && SSR_MASK_FRONT_RAYS > 0
alphaModifier*=clamp(-4.*dot(geometry.viewDir,normal)+(4.+ssrMaskFrontFactor),0.,1.);
#endif
#ifdef USE_TRANSMISSION
alphaModifier*=1.-transmission;
#endif
float vignette=1.;if(true){float fadeStrength=0.1;float dist=min(min(1.-screenPos.x,1.-screenPos.y),min(screenPos.x,screenPos.y));float fade=dist*dist/(fadeStrength+0.001);fade=clamp(fade,0.,1.);fade=pow(fade,0.3);vignette=fade;}alphaModifier*=vignette;vec3 specularColor=EnvironmentBRDF(geometry.normal,geometry.viewDir,material.specularColor.rgb,material.specularF90,material.roughness);if(length(specularColor.rgb)*alphaModifier>0.01&&roughnessFactor<0.9){
#if defined(SSR_INLINE) && SSR_INLINE > 0
ssrColor=calculateSSR(8.,vec3(screenPos.xy,geometry.position.z),geometry.normal,1.,material.roughness);
#else
ssrColor=tSSRMapTexelToLinear(texture2D(tSSRMap,screenPos.xy));
#endif 
}ssrColor.rgb*=ssrBoost;ssrColor.a*=alphaModifier;ssrColor.a=min(ssrColor.a,1.);
#if defined(SSR_NON_PHYSICAL) && SSR_NON_PHYSICAL > 0
diffuseColor.a=max(ssrColor.a,diffuseColor.a*diffuseColor.a);reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(diffuseColor.rgb*ssrColor.rgb),1.);reflectedLight.indirectDiffuse=diffuseColor.rgb*(1.-ssrColor.a);reflectedLight.directDiffuse=vec3(0.);reflectedLight.directSpecular=vec3(0.);
#else
reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(specularColor.rgb*ssrColor.rgb),ssrColor.a);
#endif
#endif

            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            
${b}`)},onObjectRender:(a,h,d)=>{var b,X,$,Z;let re=this.enabled&&d.userData.screenSpaceRendering!==!1&&!(!((b=h.materialObject.userData)===null||b===void 0)&&b.ssreflDisabled)?1:0;h.materialObject.defines.SSR_ENABLED!==re&&(h.materialObject.defines.SSR_ENABLED=re,h.materialObject.needsUpdate=!0),re=this.material.defines.SSR_STEP_COUNT,h.materialObject.defines.SSR_STEP_COUNT!==re&&(h.materialObject.defines.SSR_STEP_COUNT=re,h.materialObject.needsUpdate=!0),re=this.material.defines.SSR_LOW_QUALITY_FRAMES,h.materialObject.defines.SSR_LOW_QUALITY_FRAMES!==re&&(h.materialObject.defines.SSR_LOW_QUALITY_FRAMES=re,h.materialObject.needsUpdate=!0),re=this.material.defines.PERSPECTIVE_CAMERA,h.materialObject.defines.PERSPECTIVE_CAMERA!==re&&(h.materialObject.defines.PERSPECTIVE_CAMERA=re,h.materialObject.needsUpdate=!0),re=this.material.defines.SSR_INLINE,h.materialObject.defines.SSR_INLINE!==re&&(h.materialObject.defines.SSR_INLINE=re,h.materialObject.needsUpdate=!0),re=this.material.defines.SSR_MASK_FRONT_RAYS?1:0,h.materialObject.defines.SSR_MASK_FRONT_RAYS!==re&&(h.materialObject.defines.SSR_MASK_FRONT_RAYS=re,h.materialObject.needsUpdate=!0),re=!((X=h.materialObject.userData)===null||X===void 0)&&X.ssreflNonPhysical?"1":"0",h.materialObject.defines.SSR_NON_PHYSICAL!==re&&(h.materialObject.defines.SSR_NON_PHYSICAL=re,h.materialObject.needsUpdate=!0),re=(Z=($=this._target)===null||$===void 0?void 0:$.texture)!==null&&Z!==void 0?Z:null,this.materialExtension.extraUniforms.tSSRMap.value!==re&&(this.materialExtension.extraUniforms.tSSRMap.value=re,h.materialObject.needsUpdate=!0)},parsFragmentSnippet:a=>{var h;return`
uniform float ssrPower;
uniform float ssrIntensity;
uniform float ssrMaskFrontFactor;
uniform vec3 ssrBoost;
uniform sampler2D tSSRMap;
uniform sampler2D tLastFrame;
`+en("tSSRMap",(h=this._target)===null||h===void 0?void 0:h.texture,a.capabilities.isWebGL2)+en("tLastFrame",this.materialExtension.extraUniforms.tLastFrame.value,a.capabilities.isWebGL2)+(this._inline?`
#if 1
// #if SSR_INLINE
    ${Bg}
    
    #define THREE_PACKING_INCLUDED
    ${Qf}
    
    ${tc}
    ${Vv}
    ${Wa}
    
    ${kg}
    
    ${OA}
// #endif // SSR_INLINE
#endif
`:"")+`

${Og}

        `},extraUniforms:{tSSRMap:{value:null},ssrPower:this.material.uniforms.power,ssrIntensity:this.material.uniforms.intensity,ssrMaskFrontFactor:this.material.uniforms.maskFrontFactor,ssrBoost:this.material.uniforms.boost,tNormalDepth:this.material.uniforms.tNormalDepth,tLastFrame:this.material.uniforms.tLastFrame,objectRadius:this.material.uniforms.objectRadius,autoRadius:this.material.uniforms.autoRadius,tolerance:this.material.uniforms.tolerance,frameCount:this.material.uniforms.frameCount,projection:this.material.uniforms.projection,cameraPositionWorld:this.material.uniforms.cameraPositionWorld,cameraNearFar:this.material.uniforms.cameraNearFar,sceneBoundingRadius:this.material.uniforms.sceneBoundingRadius},computeCacheKey:a=>{var h,d;return this.enabled?"1":"0"+((d=(h=this._target)===null||h===void 0?void 0:h.texture)===null||d===void 0?void 0:d.encoding)},isCompatible:a=>{var h;return!(!((h=a.materialObject.userData)===null||h===void 0)&&h.ssreflDisabled)&&a.isMeshStandardMaterial2}},this.intensity=1,this.boost=new _.Pa4(1,1,1),this.objectRadius=1,this.autoRadius=!0,this.power=1.1,this.tolerance=.5,this.stepCount=16,this.lowQualityFrames=0,this.maskFrontRays=!0,this.maskFrontFactor=-.2,this._renderer=c,this._target=e,this.needsSwap=!1,this._inline=s}render(c,e,i,s,a){if(this._inline)this.needsSwap=!1;else{if(!this._target)throw"Target must be set when inline = false";this._renderer.blit(this._target.texture,e,{}),this.uniforms.tLastThis.value=e.texture,super.render(c,this._target,i,s,a),this.needsSwap=!1}}};nc([ai("Intensity",[0,4]),kt(),ot()],Ja.prototype,"intensity",void 0),nc([fo("Boost"),kt(),ot()],Ja.prototype,"boost",void 0),nc([ai("Object Radius",[.01,2]),kt(),ot()],Ja.prototype,"objectRadius",void 0),nc([Xn("Auto radius"),kt(),ot()],Ja.prototype,"autoRadius",void 0),nc([ai("Power",[0,3]),kt(),ot()],Ja.prototype,"power",void 0),nc([ai("Tolerance",[.1,5]),kt(),ot()],Ja.prototype,"tolerance",void 0),nc([ai("Step count",[1,32],1),kt(),Rt("SSR_STEP_COUNT")],Ja.prototype,"stepCount",void 0),nc([ai("Low Quality Frames",[0,4],1),kt(),Rt("SSR_LOW_QUALITY_FRAMES")],Ja.prototype,"lowQualityFrames",void 0),nc([Xn("Ignore front rays"),kt(),Rt("SSR_MASK_FRONT_RAYS")],Ja.prototype,"maskFrontRays",void 0),nc([ai("Mask front rays factor",[-1,1],.01,c=>({hidden:()=>!c.maskFrontRays})),kt(),ot()],Ja.prototype,"maskFrontFactor",void 0),Ja=nc([ur("Screen Space Reflections")],Ja);class Lg extends Gf{constructor(){super(),this.dependencies=[Kn,Or,Ho],this.inlineSSR=!0,this.setDirty=this.setDirty.bind(this)}get ssrTarget(){return this._ssrTarget}get enabled(){var e,i;return((i=(e=this.passes.ssr)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.enabled)||!1}set enabled(e){var i;!((i=this.passes.ssr)===null||i===void 0)&&i.passObject&&(this.passes.ssr.passObject.enabled=e)}async onAdded(e){var i,s;e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSRPlugin"),await super.onAdded(e),(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)}createPasses(e){var i,s;return this._ssrTarget=this.inlineSSR?void 0:e.renderer.createTarget({sizeMultiplier:1}),[yd(e,{passId:"ssr",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new Ja(e.renderer,this._ssrTarget,(s=(i=e.getPlugin(Or))===null||i===void 0?void 0:i.getUnpackSnippet())!==null&&s!==void 0?s:"",this.inlineSSR)},()=>[e.getPlugin(Or),e.getPlugin(Ho),e.scene.activeCamera,e.renderer,e.scene])]}async onRemove(e){return this._ssrTarget&&e.renderer.disposeTarget(this._ssrTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get uiConfig(){var e,i,s,a,h;const d=(s=(i=(e=this.passes.ssr)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.uiConfig)!==null&&s!==void 0?s:{};return(h=(a=d.children)===null||a===void 0?void 0:a.map(b=>st(b)))===null||h===void 0||h.flat(2).forEach(b=>b&&(b.onChange=this.setDirty)),d}}Lg.PluginType="SSReflection";var LA=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class Ng extends Fs{constructor(e,i,s="rgba"){super({vertexShader:ae.vertexShader,fragmentShader:i+`uniform vec2 tDiffuseSize;uniform vec2 bilDirection;varying vec2 vUv;uniform bool smoothEnabled;uniform float edgeSharpness;vec4 bilaterialAO(){vec4 color=clamp((texture2D(tDiffuse,vUv.xy)).B_SRC_ACCESSOR,0.,5.);if(!smoothEnabled)return color;float depth;vec3 normal;getDepthNormal(vUv.xy,depth,normal);float gaussianWeights[4];gaussianWeights[0]=0.153170;gaussianWeights[1]=0.144893;gaussianWeights[2]=0.122649;gaussianWeights[3]=0.092902;float Z=gaussianWeights[0]+0.03;vec4 final_colour=Z*color;vec2 nuv;vec4 cc;float dp;vec3 nor;vec2 direction=bilDirection/tDiffuseSize.xy;
#pragma unroll_loop_start
for(int i=0;i<6;i++){direction*=-1.;nuv=vUv+2.*direction*float(UNROLLED_LOOP_INDEX/2+1);getDepthNormal(nuv,dp,nor);if(dp<0.999){float normalCloseness=dot(normal,nor);normalCloseness*=normalCloseness;float normalError=(1.-normalCloseness)*8.;float normalWeight=max((1.-normalError*edgeSharpness),0.00);float depthWeight=max(0.,1.-edgeSharpness*4000.*abs(depth-dp));float kernelWeight=gaussianWeights[UNROLLED_LOOP_INDEX/2]+0.03;float bilateralWeight=kernelWeight*depthWeight*normalWeight;Z+=bilateralWeight;cc=clamp((texture2D(tDiffuse,nuv)).B_SRC_ACCESSOR,0.,5.);final_colour+=bilateralWeight*cc;}}
#pragma unroll_loop_end
final_colour/=Z;return final_colour;}void main(){vec4 ao=clamp(bilaterialAO(),vec4(0.),vec4(1.));gl_FragColor=ao;}`,uniforms:{bilDirection:{value:new _.FM8(1,0)},tNormalDepth:{value:null},tDiffuse:{value:e.texture},tDiffuseSize:{value:new _.FM8}},defines:{B_SRC_ACCESSOR:s}},"tDiffuse"),this.smoothEnabled=!0,this.edgeSharpness=.1,this._target=e,this.clear=!1,this.needsSwap=!1}render(e,i,s,a,h){var d,b,X,$;this.enabled&&(this.uniforms.bilDirection.value.set(1,0),this.uniforms.tDiffuse.value=this._target.texture,this.uniforms.tDiffuseSize.value.set(((d=this.uniforms.tDiffuse.value)===null||d===void 0?void 0:d.image.width)||0,((b=this.uniforms.tDiffuse.value)===null||b===void 0?void 0:b.image.height)||0),super.render(e,i,this._target,a,h),this.uniforms.bilDirection.value.set(0,1),this.uniforms.tDiffuse.value=i.texture,this.uniforms.tDiffuseSize.value.set(((X=this.uniforms.tDiffuse.value)===null||X===void 0?void 0:X.image.width)||0,(($=this.uniforms.tDiffuse.value)===null||$===void 0?void 0:$.image.height)||0),super.render(e,this._target,i,a,h))}}LA([kt(),ot()],Ng.prototype,"smoothEnabled",void 0),LA([kt(),ot()],Ng.prototype,"edgeSharpness",void 0);var NA=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class Gv extends Fs{constructor(e,i,s){super({defines:{LINEAR_DEPTH:1,NUM_SAMPLES:11,NUM_SPIRAL_TURNS:3,DEPTH_NORMAL_TEXTURE:1,DEPTH_PACKING_MODE:2,PERSPECTIVE_CAMERA:1},uniforms:{tLastThis:{value:null},tNormalDepth:{value:null},screenSize:{value:new _.FM8(512,512)},saoData:{value:new _.Ltg},frameCount:{value:0},cameraNearFar:{value:new _.FM8(.1,1e3)},projection:{value:new _.yGw},saoBiasEpsilon:{value:new _.Pa4(1,1,1)}},vertexShader:ec,fragmentShader:`

${tc}

${s}

#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cameraNearFar;uniform mat4 projection;uniform sampler2D tLastThis;uniform vec4 saoData;uniform vec3 saoBiasEpsilon;uniform vec2 screenSize;const float INV_NUM_SAMPLES=1./float(NUM_SAMPLES);float getViewZFromNDCZ(const in float depth){
#if PERSPECTIVE_CAMERA == 1
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}vec3 packFloatToRGB(const in float x){const vec3 code=vec3(1.,255.,65025.);vec3 pack=vec3(code*x);pack.gb=fract(pack.gb);pack.rg-=pack.gb*(1./256.);return pack;}vec3 getViewPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return vec3(xe,ye,viewDepth);}float decodeDepth(const in vec2 uv){vec4 uncodedDepth;
#if DEPTH_PACKING_MODE == 2
uncodedDepth=texture2D(tNormalDepth,uv);
#else
uncodedDepth=texture2D(tDepth,uv);
#endif
#if DEPTH_PACKING_MODE == 0
return uncodedDepth.x;
#elif DEPTH_PACKING_MODE == 1
#if LINEAR_DEPTH == 1
return pow2(unpackRGBAToDepth(uncodedDepth));
#else
return unpackRGBAToDepth(uncodedDepth);
#endif
#else
return pow2(unpack16(uncodedDepth.xy));
#endif
}vec3 getPositionFromOffset(const in vec2 uv,const in vec2 offset,const in float screenSpaceRadius){vec2 uvOffset=uv+floor(screenSpaceRadius*offset)/screenSize;float d=decodeDepth(uvOffset);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(d);return getViewPositionFromViewZ(uvOffset,centerViewZ);
#else
d=mix(-cameraNearFar.x,-cameraNearFar.y,d);return getViewPositionFromViewZ(uvOffset,d);
#endif
}float getOcclusion(const in vec2 uv,const in int id,const in float randomAngle,const in float occlusionSphereRadius,const in vec3 centerPosition,const in vec3 centerNormal){float screenSpaceRadius=(float(id)+mod(randomAngle,1.)+0.5)*INV_NUM_SAMPLES;float angle=screenSpaceRadius*(float(NUM_SPIRAL_TURNS)*6.28)+randomAngle;screenSpaceRadius=(screenSpaceRadius*occlusionSphereRadius);vec2 offset=vec2(cos(angle),sin(angle));vec3 samplePosition=getPositionFromOffset(uv,offset,screenSpaceRadius);vec3 direction=samplePosition-centerPosition;float d2=dot(direction,direction);float ao=max((dot(centerNormal,direction)+centerPosition.z*saoBiasEpsilon.x)/(saoBiasEpsilon.z*d2+saoBiasEpsilon.y),0.);return ao;}void main(){float centerDepth;vec3 centerNormal;getDepthNormal(vUv,centerDepth,centerNormal);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(centerDepth);
#else
float centerViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,centerDepth);
#endif
vec3 centerPosition=getViewPositionFromViewZ(vUv,centerViewZ);float occlusionSphereScreenRadius=200.*saoData.z/(-centerPosition.z);float randomAngle=6.2*random3(vec3(vUv,frameCount*0.1));float sum=0.;sum+=getOcclusion(vUv,0,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#if NUM_SAMPLES > 1
sum+=getOcclusion(vUv,1,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 2
sum+=getOcclusion(vUv,2,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 3
sum+=getOcclusion(vUv,3,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 4
sum+=getOcclusion(vUv,4,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 5
sum+=getOcclusion(vUv,5,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 6
sum+=getOcclusion(vUv,6,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 7
sum+=getOcclusion(vUv,7,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 8
sum+=getOcclusion(vUv,8,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 9
sum+=getOcclusion(vUv,9,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 10
sum+=getOcclusion(vUv,10,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
float aoValue=sum*saoData.y*INV_NUM_SAMPLES;aoValue=clamp(1.-max(aoValue,0.),0.,1.);gl_FragColor.gba=packFloatToRGB(centerDepth);gl_FragColor.r=(vec4(aoValue)).r;}

            `},"tDiffuse"),this.parameters={intensity:.25,occlusionWorldRadius:1,bias:.001,falloff:1,edgeSharpness:.3,blurEnabled:!0},this._smoothEnabled=!0,this.materialExtension={shaderExtender:(a,h,d)=>{a.defines.SSAO_ENABLED&&(a.fragmentShader=a.fragmentShader.replace("#include <aomap_fragment>",`#ifndef USE_TRANSMISSION
#if defined(SSAO_ENABLED) && SSAO_ENABLED > 0
float ambientOcclusion=tSSAOMapTexelToLinear(texture2D(tSSAOMap,viewToScreen(vViewPosition.xyz).xy)).r;reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));reflectedLight.indirectSpecular*=computeSpecularOcclusion(dotNV,ambientOcclusion,material.roughness);
#endif
#endif
#endif
`))},onObjectRender:(a,h,d)=>{var b,X;this.materialExtension.extraUniforms.tSSAOMap.value=(b=this._target)===null||b===void 0?void 0:b.texture;const $=h.materialObject,Z=!$.transparent&&$.transmission<.001;let re=this.enabled&&Z&&d.userData.screenSpaceRendering!==!1&&!(!((X=h.materialObject.userData)===null||X===void 0)&&X.ssaoDisabled)?1:0;$.defines.SSAO_ENABLED!==re&&($.defines.SSAO_ENABLED=re,$.needsUpdate=!0),re=this._target.texture,this.materialExtension.extraUniforms.tSSAOMap.value!==re&&(this.materialExtension.extraUniforms.tSSAOMap.value=re,$.needsUpdate=!0)},parsFragmentSnippet:a=>{var h;return Ne`
             uniform sampler2D tSSAOMap;
             ${en("tSSAOMap",(h=this._target)===null||h===void 0?void 0:h.texture,a.capabilities.isWebGL2)}
            ${Og}
        `},extraUniforms:{tSSAOMap:{value:null}},computeCacheKey:a=>{var h,d;return this.enabled?"1":"0"+((d=(h=this._target)===null||h===void 0?void 0:h.texture)===null||d===void 0?void 0:d.encoding)},isCompatible:a=>{var h;return!(!((h=a.materialObject.userData)===null||h===void 0)&&h.ssaoDisabled)&&a.isMeshStandardMaterial2}},this._renderer=e,this._target=i,this.needsSwap=!1,this.clear=!0,this.bilateralPass=new Ng(this._target,s,"rrrr")}get smoothEnabled(){return this._smoothEnabled}set smoothEnabled(e){this._smoothEnabled=e,this.bilateralPass.enabled=e,this.bilateralPass.uniforms.smoothEnabled.value=e}render(e,i,s,a,h){this.enabled&&(this._updateParameters(),this._renderer.blit(this._target.texture,i,{}),this.uniforms.tLastThis.value=i.texture,super.render(e,this._target,s,a,h),this._smoothEnabled&&this.bilateralPass.render(e,i,s,a,h))}_updateParameters(){const e=this.material.uniforms.saoData.value;e.y=this.parameters.intensity,e.z=this.parameters.occlusionWorldRadius;const i=this.material.uniforms.saoBiasEpsilon.value;i.x=this.parameters.bias,i.y=.001,i.z=this.parameters.falloff}}NA([kt()],Gv.prototype,"bilateralPass",void 0),NA([kt()],Gv.prototype,"parameters",void 0);class Ug extends Gf{constructor(){super(),this.dependencies=[Kn,Or],this.setDirty=this.setDirty.bind(this)}get aoTarget(){return this._aoTarget}async onAdded(e){return e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSAOPlugin"),super.onAdded(e)}createPasses(e){var i,s;return this._aoTarget=e.renderer.createTarget({sizeMultiplier:1}),[yd(e,{passId:"ssao",after:["gbuffer"],before:["render"],required:["render","gbuffer"],passObject:new Gv(e.renderer,this._aoTarget,(s=(i=e.getPlugin(Or))===null||i===void 0?void 0:i.getUnpackSnippet())!==null&&s!==void 0?s:""),update(){this.passObject.bilateralPass.updateShaderProperties([e.getPlugin(Or)])}},()=>[e.getPlugin(Or),e.scene.activeCamera,e.renderer])]}async onRemove(e){return e.renderer.disposeTarget(this._aoTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get enabled(){var e,i;return((i=(e=this.passes.ssao)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.enabled)||!1}set enabled(e){var i;!((i=this.passes.ssao)===null||i===void 0)&&i.passObject&&(this.passes.ssao.passObject.enabled=e)}get uiConfig(){var e;if(this._uiConfig)return this._uiConfig;const i=this,s=i.passes.ssao.passObject;return this._uiConfig={type:"folder",label:"SS Ambient Occlusion",children:[{type:"checkbox",label:"Enabled",property:[s,"enabled"],onChange:i.setDirty},{type:"slider",label:"Intensity",bounds:[0,4],property:[s.parameters,"intensity"],onChange:i.setDirty},{type:"slider",label:"Radius",bounds:[.1,8],property:[s.parameters,"occlusionWorldRadius"],onChange:i.setDirty},{type:"slider",label:"Bias",bounds:[1e-5,.01],property:[s.parameters,"bias"],onChange:i.setDirty},{type:"slider",label:"Falloff",bounds:[.01,3],property:[s.parameters,"falloff"],onChange:i.setDirty},{type:"slider",label:"Num samples",stepSize:1,bounds:[1,11],property:[(e=s.material)===null||e===void 0?void 0:e.defines,"NUM_SAMPLES"],onChange:[()=>s.material.needsUpdate=!0,i.setDirty]},{type:"checkbox",property:[s.bilateralPass,"smoothEnabled"],onChange:i.setDirty},{type:"vec4",property:[s.bilateralPass,"edgeSharpness"],onChange:i.setDirty}]}}}Ug.PluginType="SSAO";class UA{constructor(e){this._normalsCache={},this._renderer=e,this._scene=new _.xsS,this._mesh=new _.Kj0,this._mesh.frustumCulled=!1,this._scene.add(this._mesh),this._mesh.position.set(0,0,0),this._mesh.material=new FA}dispose(){this._mesh.material.dispose()}captureNormalMap(e,i,s=512){if(!e)throw"No geometry";if(e.userData._normalsCaptureMap)return!1;const a=i==null?void 0:i.split(";").find(X=>this._normalsCache[X]);if(a){const X=this._normalsCache[a];return i==null||i.split(";").forEach($=>$!==a&&(this._normalsCache[$]=X)),X.width!==s&&console.warn("last cacheKey normalMapRes mismatch, check model",s),e.userData._normalsCaptureMap=X,!1}const h=this._renderer.createTargetCustom({width:s,height:s},{minFilter:_.TyD,magFilter:_.TyD,generateMipmaps:!1,type:_.cLu},_.oAp);if(!h)throw"Unable to create render target";i==null||i.split(";").forEach(X=>this._normalsCache[X]=h),h.addEventListener("dispose",()=>delete this._normalsCache[i]);const d=new _._am(1e-4,100,h);this._scene.add(d);const b=e.userData._normalsCaptureOffsets;return b.center!==void 0&&this._mesh.material.uniforms.offsetCenter.value.copy(b.center),b.offsetMatrixInv!==void 0&&this._mesh.material.uniforms.offsetMatrixInv.value.copy(b.offsetMatrixInv),b.radius!==void 0&&(this._mesh.material.uniforms.radius.value=b.radius),this._mesh.geometry=e,d.update(this._renderer.rendererObject,this._scene),this._scene.remove(d),this._mesh.geometry=void 0,e.userData._normalsCaptureMap=h,!0}}class FA extends _.jyz{constructor(){super({vertexShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform mat4 offsetMatrixInv;uniform vec3 offsetCenter;void main(){vNormal=normalize((offsetMatrixInv*vec4(normal,0.)).xyz);vecPosition=(modelMatrix*offsetMatrixInv*vec4(position-offsetCenter,1.)).xyz;gl_Position=projectionMatrix*modelViewMatrix*offsetMatrixInv*vec4(position-offsetCenter,1.);}",fragmentShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform float radius;void main(){vec3 color=normalize(vNormal);color=color*0.5+0.5;gl_FragColor=vec4(color.x,color.y,color.z,length(vecPosition)/radius);}",side:_.ehD,clipping:!1,uniforms:{radius:{value:1},offsetMatrixInv:{value:new _.yGw().identity()},offsetCenter:{value:new _.Pa4}}})}}var Zw=__webpackgi_require__(654);function jA(c){const e=new _.Pa4(0,0,0),i=new _.Pa4(0,0,0),s=new _.Pa4(0,0,0),a=new _.Pa4(0,0,0),h=c.getAttribute("position"),d=c.index;if(d)for(let le=Math.max(0,c.drawRange.start),he=Math.min(d.count,c.drawRange.start+c.drawRange.count)-1;le<he/3;le+=3){const fe=d.getX(le),me=d.getX(le+1),Ee=d.getX(le+2);i.set(h.getX(fe),h.getY(fe),h.getZ(fe)),s.set(h.getX(me),h.getY(me),h.getZ(me)),a.set(h.getX(Ee),h.getY(Ee),h.getZ(Ee)),s.sub(i),a.sub(i),a.cross(s),a.normalize(),e.add(a)}else for(let le=0;le<h.count;le+=3)i.set(h.getX(le),h.getY(le),h.getZ(le)),s.set(h.getX(le+1),h.getY(le+1),h.getZ(le+1)),a.set(h.getX(le+2),h.getY(le+2),h.getZ(le+2)),s.sub(i),a.sub(i),a.cross(s),a.normalize(),e.add(a);e.normalize();let b=!1,X=0;for(;!b;){const le=X/3,he=d?d.getX(le):le,fe=d?d.getX(le+1):le+1;i.set(h.getX(he),h.getY(he),h.getZ(he)),s.set(h.getX(fe),h.getY(fe),h.getZ(fe)),i.sub(s),i.normalize();const me=e.dot(i);Math.abs(me-1)>.001&&i.length()>.5&&(b=!0),X+=3}s.crossVectors(i,e),s.normalize(),i.crossVectors(e,s),i.normalize();const $=new _.yGw;$.elements[0]=i.x,$.elements[1]=i.y,$.elements[2]=i.z,$.elements[3]=0,$.elements[4]=e.x,$.elements[5]=e.y,$.elements[6]=e.z,$.elements[7]=0,$.elements[8]=s.x,$.elements[9]=s.y,$.elements[10]=s.z,$.elements[11]=0,$.elements[12]=0,$.elements[13]=0,$.elements[14]=0,$.elements[15]=1,c.computeBoundingSphere();const Z=c.boundingSphere.radius,re=new _.yGw().makeScale(Z,Z,Z);return $.multiply(re),$}function zA(c){const e=c.getAttribute("position");if(e.count>0)return jA(c);const i=new _.Pa4(0,0,0),s=new _.Pa4(0,0,0),a=new _.Pa4(0,0,0),h=c.index,d=[];if(h)for(let re=Math.max(0,c.drawRange.start),le=Math.min(h.count,c.drawRange.start+c.drawRange.count)-1;re<le/3;re+=3){const he=h.getX(re),fe=h.getX(re+1),me=h.getX(re+2);i.set(e.getX(he),e.getY(he),e.getZ(he)),s.set(e.getX(fe),e.getY(fe),e.getZ(fe)),a.set(e.getX(me),e.getY(me),e.getZ(me)),d.push(i.toArray(),s.toArray(),a.toArray())}else for(let re=0;re<e.count;re++)i.set(e.getX(re),e.getY(re),e.getZ(re)),d.push(i.toArray());const b=(0,Zw.getEigenVectors)(d),X=new _.yGw;X.elements[0]=b[0].vector[0],X.elements[1]=b[0].vector[1],X.elements[2]=b[0].vector[2],X.elements[3]=0,X.elements[4]=b[1].vector[0],X.elements[5]=b[1].vector[1],X.elements[6]=b[1].vector[2],X.elements[7]=0,X.elements[8]=b[2].vector[0],X.elements[9]=b[2].vector[1],X.elements[10]=b[2].vector[2],X.elements[11]=0,X.elements[12]=0,X.elements[13]=0,X.elements[14]=0,X.elements[15]=1,console.log(X.determinant()),c.computeBoundingSphere();const $=c.boundingSphere.radius,Z=new _.yGw().makeScale($,$,$);return X.multiply(Z),X}const VA={...Df,color:new oi(1,1,1),envMapIntensity:1,envMapRotation:0,dispersion:.012,squashFactor:.98,geometryFactor:.5,gammaFactor:1,absorptionFactor:1,reflectivity:.5,refractiveIndex:2.4,boostFactors:new _.Pa4(.892,.892,.98595025),envMap:null,wireframe:!1,wireframeLinewidth:0,skinning:!1,transmission:0,morphTargets:!1,morphNormals:!1,rayBounces:1,diamondOrientedEnvMap:0};var ja=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class hs extends _.jyz{constructor(e){super({side:_.ehD,defines:{DIA_ORIENT_ENVMAP:0,RAY_BOUNCES:5,ENV_MAP_TYPE:0,PI:3.1428},vertexShader:`#ifndef USE_ENVMAP
#define USE_ENVMAP  
#endif
varying vec3 vWorldPosition;varying vec3 vWorldNormal;void main(){vWorldNormal=(modelMatrix*vec4(normal,0.)).xyz;
#include <begin_vertex>
#include <project_vertex>
#include <worldpos_vertex>
vWorldPosition=worldPosition.xyz;}`,fragmentShader:`varying vec3 vWorldNormal;varying vec3 vWorldPosition;uniform samplerCube tCubeMapNormals;
#if ENV_MAP_TYPE == 0
uniform samplerCube envMap;
#elif ENV_MAP_TYPE == 1
uniform sampler2D envMap;
#endif
uniform float envMapIntensity;uniform mat4 modelMatrix;uniform mat4 inverseModelMatrix;uniform mat4 offsetMatrixInv;uniform mat4 offsetMatrix;uniform float transmission;uniform vec2 transmissionSamplerSize;uniform sampler2D transmissionSamplerMap;uniform float refractiveIndex;uniform float radius;uniform float rIndexDelta;uniform float squashFactor;uniform float geometryFactor;uniform vec3 color;uniform vec3 colorCorrection;uniform vec3 boostFactors;uniform vec3 centerOffset;uniform float gammaFactor;uniform float absorptionFactor;uniform float envMapRotation;uniform float reflectivity;vec3 BRDF_Specular_GGX_Environment(const in vec3 viewDir,const in vec3 normal,const in vec3 specularColor,const in float roughness){float dotNV=abs(dot(normal,viewDir));const vec4 c0=vec4(-1,-0.0275,-0.572,0.022);const vec4 c1=vec4(1,0.0425,1.04,-0.04);vec4 r=roughness*c0+c1;float a004=min(r.x*r.x,exp2(-9.28*dotNV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec2 cartesianToPolar(vec3 n){vec2 uv;uv.x=atan(n.z,n.x)/(PI*2.)+0.5;uv.y=asin(n.y)/PI+0.5;return uv;}vec4 sampleEnvMap(vec3 direction){
#if !defined(USE_ENVMAP)
return vec4(direction,1);
#else
float cs=cos(envMapRotation);float sn=sin(envMapRotation);float temp=cs*direction.x+sn*direction.z;direction.z=-sn*direction.x+cs*direction.z;direction.x=temp;direction.x*=-1.;direction.z*=-1.;
#if ENV_MAP_TYPE == 0
return(textureCube(envMap,direction));
#elif ENV_MAP_TYPE == 1
return(texture2D(envMap,cartesianToPolar(direction)));
#endif
return vec4(1,0,1,1);
#endif
}vec4 SampleSpecularReflection(vec3 direction){return envMapIntensity*(sampleEnvMap(direction));}uniform mat4 projectionMatrix;vec4 SampleSpecularContribution(vec3 direction){direction=normalize(direction);direction.x*=-1.;direction.z*=-1.;return envMapIntensity*(sampleEnvMap(direction));}vec4 SampleSpecularContributionRef(vec3 origin,int i){vec4 ndcPos=projectionMatrix*viewMatrix*vec4(origin,1.);vec2 refractionCoords=ndcPos.xy/ndcPos.w;refractionCoords+=1.;refractionCoords/=2.;return transmissionSamplerMapTexelToLinear(texture2D(transmissionSamplerMap,refractionCoords));}vec3 intersectSphere(vec3 origin,vec3 direction){origin-=centerOffset;direction.y/=squashFactor;float A=dot(direction,direction);float B=2.*dot(origin,direction);float C=dot(origin,origin)-radius*radius;float disc=B*B-4.*A*C;if(disc>0.){disc=sqrt(disc);float t1=(-B+disc)*geometryFactor/A;float t2=(-B-disc)*geometryFactor/A;float t=(t1>t2)?t1:t2;direction.y*=squashFactor;return vec3(origin+centerOffset+direction*t);}return vec3(0.);}vec3 linePlaneIntersect(in vec3 pointOnLine,in vec3 lineDirection,in vec3 pointOnPlane,in vec3 planeNormal){return lineDirection*(dot(planeNormal,pointOnPlane-pointOnLine)/dot(planeNormal,lineDirection))+pointOnLine;}vec4 getNormalDistance(vec3 d){return textureCube(tCubeMapNormals,d);}vec3 getSurfaceNormal(vec4 surfaceInfos){vec3 surfaceNormal=surfaceInfos.rgb;surfaceNormal=surfaceNormal*2.-1.;return-normalize(surfaceNormal);}vec3 intersect(vec3 rayOrigin,vec3 rayDirection){vec3 sphereHitPoint=intersectSphere(rayOrigin,rayDirection);vec3 direction1=normalize(sphereHitPoint-centerOffset);vec4 normalDistanceData1=getNormalDistance(direction1);float distance1=normalDistanceData1.a*radius;vec3 pointOnPlane1=centerOffset+direction1*distance1;vec3 planeNormal1=getSurfaceNormal(normalDistanceData1);vec3 hitPoint1=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane1,planeNormal1);vec3 direction2=normalize(hitPoint1-centerOffset);vec4 normalDistanceData2=getNormalDistance(direction2);float distance2=normalDistanceData2.a*radius;vec3 pointOnPlane2=centerOffset+direction2*distance2;vec3 hitPoint=hitPoint1;vec3 planeNormal2=getSurfaceNormal(normalDistanceData2);hitPoint=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane2,planeNormal2);return hitPoint;}vec3 debugBounces(int count){vec3 color=vec3(1.,1.,1.);if(count==1)color=vec3(0.,1.,0.);else if(count==2)color=vec3(0.,0.,1.);else if(count==3)color=vec3(1.,1.,0.);else if(count==4)color=vec3(0.,1.,1.);else color=vec3(0.,1.,0.);if(count==0)color=vec3(1.,0.,0.);return color;}vec3 traceRay(vec3 origin,vec3 direction,vec3 normal){vec3 outColor=vec3(0.);const float n1=1.;const float epsilon=1e-4;float f0=(2.4-n1)/(2.4+n1);f0*=f0;vec3 attenuationFactor=vec3(1.);vec3 newDirection=refract(direction,normal,n1/refractiveIndex);vec3 reflectedDirection=reflect(direction,normal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(reflectedDirection,normal,vec3(f0),0.);vec3 brdfRefracted=BRDF_Specular_GGX_Environment(newDirection,-normal,vec3(f0),0.);attenuationFactor*=(vec3(1.)-brdfRefracted);outColor+=SampleSpecularReflection(reflectedDirection).rgb*brdfReflected*reflectivity*2.;int count=0;newDirection=(offsetMatrixInv*inverseModelMatrix*vec4(newDirection,0.)).xyz;newDirection=normalize(newDirection);origin=(offsetMatrixInv*inverseModelMatrix*vec4(origin,1.)).xyz;vec3 origin2=origin;origin2=(modelMatrix*offsetMatrix*vec4(origin2,1.)).xyz;for(int i=0;i<RAY_BOUNCES;i++){vec3 intersectedPos=intersect(origin,newDirection);vec3 dist=intersectedPos-origin;vec3 d=normalize(intersectedPos-centerOffset);vec3 mappedNormal=getNormalDistance(d).rgb;mappedNormal=2.*mappedNormal-1.;mappedNormal=-normalize(mappedNormal);float r=length(dist)/radius*absorptionFactor;attenuationFactor*=exp(-r*(1.-color));origin=intersectedPos;origin2=(modelMatrix*offsetMatrix*vec4(intersectedPos,1.)).xyz;vec3 oldDir=newDirection;newDirection=refract(newDirection,mappedNormal,refractiveIndex/n1);if(dot(newDirection,newDirection)<epsilon){newDirection=reflect(oldDir,mappedNormal);if(i==RAY_BOUNCES-1){vec3 brdfReflected=BRDF_Specular_GGX_Environment(-oldDir,mappedNormal,vec3(f0),0.);vec3 d1=(modelMatrix*offsetMatrix*vec4(oldDir,0.)).xyz;d1=normalize(d1);float cosT=1.-dot(direction,d1);outColor+=((transmission>0.&&cosT<transmission)?SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb:SampleSpecularContribution(DIA_ORIENT_ENVMAP<1?d1:newDirection).rgb)*attenuationFactor*colorCorrection*boostFactors*(vec3(1.)-brdfReflected);}}else{vec3 brdfRefracted=vec3(1.)-BRDF_Specular_GGX_Environment(newDirection,-mappedNormal,vec3(f0),0.);vec3 d1=(modelMatrix*offsetMatrix*vec4(newDirection,0.)).xyz;d1=normalize(d1);float cosT=1.-dot(direction,d1);if(transmission>0.&&cosT<transmission){outColor+=SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}else{vec3 dir0=newDirection;vec3 dir1=refract(oldDir,mappedNormal,(refractiveIndex+rIndexDelta)/n1);vec3 dir2=refract(oldDir,mappedNormal,(refractiveIndex-rIndexDelta)/n1);
#if DIA_ORIENT_ENVMAP < 1
dir0=d1;dir1=(modelMatrix*offsetMatrix*vec4(dir1,0.)).xyz;dir2=(modelMatrix*offsetMatrix*vec4(dir2,0.)).xyz;
#endif
outColor+=vec3(SampleSpecularContribution(dir1).r,SampleSpecularContribution(dir0).g,SampleSpecularContribution(dir2).b)*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}newDirection=reflect(oldDir,mappedNormal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(newDirection,mappedNormal,vec3(f0),0.);attenuationFactor*=brdfReflected*boostFactors;count++;}}return outColor;}void main(){vec3 normalizedNormal=normalize(vWorldNormal);vec3 viewVector=normalize(vWorldPosition-cameraPosition);vec3 color=traceRay(vWorldPosition,viewVector,normalizedNormal);gl_FragColor=vec4(color.rgb,1.);
#include <encodings_fragment>
}`,uniforms:{envMap:{value:e.envMap||null},envMapRotation:{value:0},transmission:{value:0},transmissionSamplerMap:{value:null},transmissionSamplerSize:{value:new _.FM8},normalOffset:{value:0},distanceOffset:{value:0},colorCorrection:{value:new _.Pa4(1,1,1)}}}),this.typeSlug=hs.TypeSlug,this.assetType="material",this.__envMap=null,this.isDiamondMaterial=!0,this.color=new oi(1,1,1),this.envMapIntensity=1,this.dispersion=.012,this.absorptionFactor=1,this.refractiveIndex=2.4,this.squashFactor=.98,this.geometryFactor=.5,this.gammaFactor=1,this.boostFactors=new _.Pa4(.892,.892,.98595025),this.transmission=0,this.reflectivity=.5,this.rayBounces=5,this.diamondOrientedEnvMap=0,this.normalsCaptureMap=null,this.extraUniformsToUpload={inverseModelMatrix:{value:new _.yGw().identity()},radius:{value:1},centerOffset:{value:new _.Pa4(0,0,0)},offsetMatrix:{value:new _.yGw().identity()},offsetMatrixInv:{value:new _.yGw().identity()}},this.setDirty=this.setDirty.bind(this),this.userData.setDirty=i=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(i)},this.userData.separateEnvMapIntensity=!0,this.setValues(e)}get mmMaterial(){return this}get materialObject(){return this}onBeforeRender(e,i,s,a,h){var d,b;super.onBeforeRender(e,i,s,a,h),this.uniforms.envMapRotation.value=((d=this.envMap)===null||d===void 0?void 0:d.rotation)||0,this.extraUniformsToUpload.inverseModelMatrix.value.copy(h.matrixWorld).invert();const X=a.userData._normalsCaptureOffsets;X&&(this.extraUniformsToUpload.centerOffset.value.copy(X.centerOffset),this.extraUniformsToUpload.offsetMatrix.value.copy(X.offsetMatrix),this.extraUniformsToUpload.offsetMatrixInv.value.copy(X.offsetMatrixInv),this.extraUniformsToUpload.radius.value=X.radius);const $=(b=a.userData._normalsCaptureMap)===null||b===void 0?void 0:b.texture;this.normalsCaptureMap!==$&&(this.normalsCaptureMap=$)}setDirty(e){var i,s;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(s=(i=this._uiConfig)===null||i===void 0?void 0:i.uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0,1)}set envMap(e){var i;this.__envMap=e,this.uniforms.envMap.value=this.__envMap,!((i=this.__envMap)===null||i===void 0)&&i.isCubeTexture?(this.defines.ENV_MAP_TYPE=0,this.needsUpdate=!0):(this.defines.ENV_MAP_TYPE=1,this.needsUpdate=!0)}get envMap(){return this.__envMap}clone(){return super.clone()}toJSON(e){const i={};return i.name=this.name,i.uuid=this.uuid,i.color=this.color.getHex(),i.envMapIntensity=this.envMapIntensity,i.dispersion=this.dispersion,i.squashFactor=this.squashFactor,i.geometryFactor=this.geometryFactor,i.gammaFactor=this.gammaFactor,i.absorptionFactor=this.absorptionFactor,i.reflectivity=this.reflectivity,i.refractiveIndex=this.refractiveIndex,i.rayBounces=this.rayBounces,i.diamondOrientedEnvMap=this.diamondOrientedEnvMap,i.boostFactors={x:this.boostFactors.x,y:this.boostFactors.y,z:this.boostFactors.z,isVector3:!0},i.transmission=this.transmission,i.isDiamondMaterialParameters=!0,i.type=hs.TYPE,i.userData={},as(i.userData,this.userData),i.userData.uuid=this.userData.uuid,i}get uiConfig(){const e=this;return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},...Ec(this),{type:"input",label:"Mesh count",get value(){var i,s,a;return(a=(s=(i=e.userData)===null||i===void 0?void 0:i.__appliedMeshes)===null||s===void 0?void 0:s.size)!==null&&a!==void 0?a:0},set value(i){},disabled:!0},{type:"input",label:"uuid",get value(){return e.uuid},set value(i){},disabled:!0},{type:"checkbox",label:"Render to Depth",hidden:()=>this.transmission===0,get value(){return e.userData.renderToDepth===!0},set value(i){e.userData.renderToDepth=i||void 0}},{type:"button",label:"Download .dmat",value:()=>{ts(new Blob([JSON.stringify(e.toJSON(),null,2)],{type:"application/json"}),"diamond-material.dmat")}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Diamond Material",expanded:!0,children:this._uiConfigChildren,limitedUi:!0}),this._uiConfig}copyProps(e){if(!e.isDiamondMaterialParameters&&!e.isDiamondMaterial&&!e.isDiamond&&e.type!==hs.TYPE)return console.warn("Material type is not supported",e),this;const i={};Et(e,i,Array.from(Object.keys(VA)));const s=i.userData;return delete i.userData,this.setValues(i),as(this.userData,s),this.setDirty(),this}fromJSON(e,i){return this.copyProps(e)}}hs.TypeSlug="dmat",hs.TYPE="DiamondMaterial",ja([ml("Color",{limitedUi:!0}),ot()],hs.prototype,"color",void 0),ja([ai("Env Intensity",[0,5],.01,{limitedUi:!0}),ot()],hs.prototype,"envMapIntensity",void 0),ja([ai("Dispersion",[0,.1],1e-4,{limitedUi:!0}),ot({propKey:"rIndexDelta"})],hs.prototype,"dispersion",void 0),ja([ai("Absorption",[0,15],.01,{limitedUi:!0}),ot()],hs.prototype,"absorptionFactor",void 0),ja([ai("Refractive Index",[0,4],.01,{limitedUi:!0}),ot()],hs.prototype,"refractiveIndex",void 0),ja([ot()],hs.prototype,"squashFactor",void 0),ja([ot()],hs.prototype,"geometryFactor",void 0),ja([ot()],hs.prototype,"gammaFactor",void 0),ja([fo("RGB Boost",void 0,void 0,{limitedUi:!0}),ot()],hs.prototype,"boostFactors",void 0),ja([ai("Transmission",[0,1],.01,{limitedUi:!0}),ot()],hs.prototype,"transmission",void 0),ja([ai("Reflectivity",[0,2],.01,{limitedUi:!0}),ot()],hs.prototype,"reflectivity",void 0),ja([Rt("RAY_BOUNCES",void 0,!0),ai("Ray Bounces",[1,16],1)],hs.prototype,"rayBounces",void 0),ja([Rt("DIA_ORIENT_ENVMAP",void 0,!0),ai("Diamond Oriented Lighting",[0,1],1)],hs.prototype,"diamondOrientedEnvMap",void 0),ja([ot({propKey:"tCubeMapNormals"})],hs.prototype,"normalsCaptureMap",void 0);class GA extends oe{constructor(e,i,s,a){super(),this._scene=e,this._camera=s??this._scene.activeCamera,this.domElement=i,this._time=this.time,this._mouseDownTime=0,this._mouseUpTime=1,this.selectionCondition=a??(h=>h.userData.userSelectable!==!1&&h.userData.bboxVisible!==!1&&h.material!=null&&h.material.type!=="ShadowMaterial"),this.raycaster=new _.iMs,this.mouse=new _.FM8,this._selected=[],this._hovering=[],this.cursorStyles={default:"grab",down:"grabbing"},this._activeCameraChange=this._activeCameraChange.bind(this),this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.domElement.style.touchAction="none",this.domElement.style.cursor=this.cursorStyles.default,this.domElement.addEventListener("pointermove",h=>this.onPointerMove(h)),this.domElement.addEventListener("pointerleave",h=>this.onPointerLeave(h)),this.domElement.addEventListener("pointerout",h=>this.onPointerLeave(h)),this.domElement.addEventListener("pointercancel",h=>this.onPointerCancel(h)),this.domElement.addEventListener("pointerenter",h=>this.onPointerEnter(h)),this.domElement.addEventListener("pointerdown",h=>this.onPointerDown(h)),this.domElement.addEventListener("pointerup",h=>this.onPointerUp(h))}get scene(){return this._scene}set scene(e){var i;(i=this._scene)===null||i===void 0||i.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene=e,this._scene.addEventListener("activeCameraChange",this._activeCameraChange)}_activeCameraChange(){this.camera=this._scene.activeCamera}get camera(){return this._camera}set camera(e){this._camera=e}get selectedObject(){return this._selected.length>0?this._selected[0]:null}set selectedObject(e){this._selected.length===1&&this._selected[0]===e||(this._selected=e?Array.isArray(e)?[...e]:[e]:[],this.refreshOutlinePass(),this.dispatchEvent({type:"selectedObjectChanged",object:this.selectedObject}))}get hoverObject(){return this._hovering.length>0?this._hovering[0]:null}set hoverObject(e){this._hovering=e?Array.isArray(e)?[...e]:[e]:[],this.refreshOutlinePass(),this.dispatchEvent({type:"hoverObjectChanged",object:this.hoverObject})}get time(){return this._time=ia(),this._time}get isMouseDown(){return this.mouseDownDeltaTime<0}get mouseDownDeltaTime(){return this._mouseUpTime-this._mouseDownTime}onPointerMove(e){e.isPrimary!==!1&&this.updateMouseFromEvent(e)}onPointerLeave(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.default,this.hoverObject=null)}onPointerEnter(e){}onPointerCancel(e){}updateMouseFromEvent(e){const i=this.domElement.getBoundingClientRect();this.mouse.x=(e.clientX-i.x)/i.width*2-1,this.mouse.y=-(e.clientY-i.y)/i.height*2+1}onPointerDown(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.down,this._mouseDownTime=this.time)}onPointerUp(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.default,this._mouseUpTime=this.time,this.mouseDownDeltaTime<200&&this.onPointerClick(e))}onPointerClick(e){if(e.isPrimary===!1)return;this.updateMouseFromEvent(e);const i=this.checkIntersection();i&&this.dispatchEvent({type:"hitObject",time:this._mouseUpTime,intersects:i}),this.selectedObject=(i==null?void 0:i.selectedObject)||null}addPasses(){}checkIntersection(){var e;const i=(e=this._camera)===null||e===void 0?void 0:e.cameraObject;if(!i)return null;this.raycaster.setFromCamera(this.mouse,i);const s=this.raycaster.intersectObject(this._scene.modelRoot.modelObject,!0);let a,h=null;if(s.length>0){if(h=s[0].object,a=s[0],this._firstHit&&h.id!==this._firstHit.id)h=a.object;else for(let d=0;d<s.length;d++)if(this.selectedObject&&this.selectedObject.id===s[d].object.id){const b=d+1;if(!(b<s.length))return null;a=s[b],h=a.object}this._firstHit=s[0].object}if(h&&a){for(;!(h==null||h.visible&&this.selectionCondition(h));)h=h.parent;return h?{selectedObject:h,intersect:a,intersects:s,mouse:this.mouse.toArray()}:null}return null}refreshOutlinePass(){var e;(e=this.hoverObject)!==null&&e!==void 0||this.selectedObject}isHovering(){return this.hoverObject!=null}isSelected(){return this.selectedObject!=null}}const wd=new _.iMs,za=new _.Pa4,mh=new _.Pa4,ks=new _._fP,Fg={X:new _.Pa4(1,0,0),Y:new _.Pa4(0,1,0),Z:new _.Pa4(0,0,1)},jg={type:"change"},QA={type:"mouseDown"},Hf={type:"mouseUp",mode:null},Qv={type:"objectChange"};class ex extends _.Tme{constructor(e,i){super(),i===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),i=document),this.isTransformControls=!0,this.visible=!1,this.domElement=i,this.domElement.style.touchAction="none";const s=new rx;this._gizmo=s,this.add(s);const a=new sx;this._plane=a,this.add(a);const h=this;function d(Ae,ye){let ge=ye;Object.defineProperty(h,Ae,{get:function(){return ge!==void 0?ge:ye},set:function(Pe){ge!==Pe&&(ge=Pe,a[Ae]=Pe,s[Ae]=Pe,h.dispatchEvent({type:Ae+"-changed",value:Pe}),h.dispatchEvent(jg))}}),h[Ae]=ye,a[Ae]=ye,s[Ae]=ye}d("camera",e),d("object",void 0),d("enabled",!0),d("axis",null),d("mode","translate"),d("translationSnap",null),d("rotationSnap",null),d("scaleSnap",null),d("space","world"),d("size",1),d("dragging",!1),d("showX",!0),d("showY",!0),d("showZ",!0);const b=new _.Pa4,X=new _.Pa4,$=new _._fP,Z=new _._fP,re=new _.Pa4,le=new _._fP,he=new _.Pa4,fe=new _.Pa4,me=new _.Pa4,Ee=new _.Pa4;d("worldPosition",b),d("worldPositionStart",X),d("worldQuaternion",$),d("worldQuaternionStart",Z),d("cameraPosition",re),d("cameraQuaternion",le),d("pointStart",he),d("pointEnd",fe),d("rotationAxis",me),d("rotationAngle",0),d("eye",Ee),this._offset=new _.Pa4,this._startNorm=new _.Pa4,this._endNorm=new _.Pa4,this._cameraScale=new _.Pa4,this._parentPosition=new _.Pa4,this._parentQuaternion=new _._fP,this._parentQuaternionInv=new _._fP,this._parentScale=new _.Pa4,this._worldScaleStart=new _.Pa4,this._worldQuaternionInv=new _._fP,this._worldScale=new _.Pa4,this._positionStart=new _.Pa4,this._quaternionStart=new _._fP,this._scaleStart=new _.Pa4,this._getPointer=HA.bind(this),this._onPointerDown=tx.bind(this),this._onPointerHover=WA.bind(this),this._onPointerMove=nx.bind(this),this._onPointerUp=ix.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye):this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;wd.setFromCamera(e,this.camera);const i=xd(this._gizmo.picker[this.mode],wd);this.axis=i?i.object.name:null}pointerDown(e){if(this.object!==void 0&&this.dragging!==!0&&e.button===0&&this.axis!==null){wd.setFromCamera(e,this.camera);const i=xd(this._plane,wd,!0);i&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(i.point).sub(this.worldPositionStart)),this.dragging=!0,QA.mode=this.mode,this.dispatchEvent(QA)}}pointerMove(e){const i=this.axis,s=this.mode,a=this.object;let h=this.space;if(s==="scale"?h="local":i!=="E"&&i!=="XYZE"&&i!=="XYZ"||(h="world"),a===void 0||i===null||this.dragging===!1||e.button!==-1)return;wd.setFromCamera(e,this.camera);const d=xd(this._plane,wd,!0);if(d){if(this.pointEnd.copy(d.point).sub(this.worldPositionStart),s==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),h==="local"&&i!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),i.indexOf("X")===-1&&(this._offset.x=0),i.indexOf("Y")===-1&&(this._offset.y=0),i.indexOf("Z")===-1&&(this._offset.z=0),h==="local"&&i!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),a.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(h==="local"&&(a.position.applyQuaternion(ks.copy(this._quaternionStart).invert()),i.search("X")!==-1&&(a.position.x=Math.round(a.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(a.position.y=Math.round(a.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(a.position.z=Math.round(a.position.z/this.translationSnap)*this.translationSnap),a.position.applyQuaternion(this._quaternionStart)),h==="world"&&(a.parent&&a.position.add(za.setFromMatrixPosition(a.parent.matrixWorld)),i.search("X")!==-1&&(a.position.x=Math.round(a.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(a.position.y=Math.round(a.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(a.position.z=Math.round(a.position.z/this.translationSnap)*this.translationSnap),a.parent&&a.position.sub(za.setFromMatrixPosition(a.parent.matrixWorld))));else if(s==="scale"){if(i.search("XYZ")!==-1){let b=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(b*=-1),mh.set(b,b,b)}else za.copy(this.pointStart),mh.copy(this.pointEnd),za.applyQuaternion(this._worldQuaternionInv),mh.applyQuaternion(this._worldQuaternionInv),mh.divide(za),i.search("X")===-1&&(mh.x=1),i.search("Y")===-1&&(mh.y=1),i.search("Z")===-1&&(mh.z=1);a.scale.copy(this._scaleStart).multiply(mh),this.scaleSnap&&(i.search("X")!==-1&&(a.scale.x=Math.round(a.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Y")!==-1&&(a.scale.y=Math.round(a.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Z")!==-1&&(a.scale.z=Math.round(a.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(s==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const b=20/this.worldPosition.distanceTo(za.setFromMatrixPosition(this.camera.matrixWorld));i==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):i==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(za.copy(this.rotationAxis).cross(this.eye))*b):i!=="X"&&i!=="Y"&&i!=="Z"||(this.rotationAxis.copy(Fg[i]),za.copy(Fg[i]),h==="local"&&za.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(za.cross(this.eye).normalize())*b),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),h==="local"&&i!=="E"&&i!=="XYZE"?(a.quaternion.copy(this._quaternionStart),a.quaternion.multiply(ks.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),a.quaternion.copy(ks.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),a.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(jg),this.dispatchEvent(Qv)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(Hf.mode=this.mode,this.dispatchEvent(Hf)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(jg),this.dispatchEvent(Qv),this.pointStart.copy(this.pointEnd))}getRaycaster(){return wd}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function HA(c){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:c.button};{const e=this.domElement.getBoundingClientRect();return{x:(c.clientX-e.left)/e.width*2-1,y:-(c.clientY-e.top)/e.height*2+1,button:c.button}}}function WA(c){if(this.enabled)switch(c.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(c))}}function tx(c){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(c.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(c)),this.pointerDown(this._getPointer(c)))}function nx(c){this.enabled&&this.pointerMove(this._getPointer(c))}function ix(c){this.enabled&&(this.domElement.releasePointerCapture(c.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(c)))}function xd(c,e,i){const s=e.intersectObject(c,!0);for(let a=0;a<s.length;a++)if(s[a].object.visible||i)return s[a];return!1}const Wf=new _.USm,ds=new _.Pa4(0,1,0),qA=new _.Pa4(0,0,0),zg=new _.yGw,Vg=new _._fP,Gg=new _._fP,ic=new _.Pa4,YA=new _.yGw,Tp=new _.Pa4(1,0,0),Ed=new _.Pa4(0,1,0),qf=new _.Pa4(0,0,1),Qg=new _.Pa4,Yf=new _.Pa4,Xf=new _.Pa4;class rx extends _.Tme{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new _.vBJ({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=new _.nls({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=e.clone();s.opacity=.15;const a=i.clone();a.opacity=.5;const h=e.clone();h.color.setHex(16711680);const d=e.clone();d.color.setHex(65280);const b=e.clone();b.color.setHex(255);const X=e.clone();X.color.setHex(16711680),X.opacity=.5;const $=e.clone();$.color.setHex(65280),$.opacity=.5;const Z=e.clone();Z.color.setHex(255),Z.opacity=.5;const re=e.clone();re.opacity=.25;const le=e.clone();le.color.setHex(16776960),le.opacity=.25,e.clone().color.setHex(16776960);const he=e.clone();he.color.setHex(7895160);const fe=new _.fHI(0,.04,.1,12);fe.translate(0,.05,0);const me=new _.DvJ(.08,.08,.08);me.translate(0,.04,0);const Ee=new _.u9r;Ee.setAttribute("position",new _.a$l([0,0,0,1,0,0],3));const Ae=new _.fHI(.0075,.0075,.5,3);function ye(Tt,yt){const St=new _.XvJ(Tt,.0075,3,64,yt*Math.PI*2);return St.rotateY(Math.PI/2),St.rotateX(Math.PI/2),St}Ae.translate(0,.25,0);const ge={X:[[new _.Kj0(fe,h),[.5,0,0],[0,0,-Math.PI/2]],[new _.Kj0(fe,h),[-.5,0,0],[0,0,Math.PI/2]],[new _.Kj0(Ae,h),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new _.Kj0(fe,d),[0,.5,0]],[new _.Kj0(fe,d),[0,-.5,0],[Math.PI,0,0]],[new _.Kj0(Ae,d)]],Z:[[new _.Kj0(fe,b),[0,0,.5],[Math.PI/2,0,0]],[new _.Kj0(fe,b),[0,0,-.5],[-Math.PI/2,0,0]],[new _.Kj0(Ae,b),null,[Math.PI/2,0,0]]],XYZ:[[new _.Kj0(new _.pQR(.1,0),re.clone()),[0,0,0]]],XY:[[new _.Kj0(new _.DvJ(.15,.15,.01),Z.clone()),[.15,.15,0]]],YZ:[[new _.Kj0(new _.DvJ(.15,.15,.01),X.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new _.Kj0(new _.DvJ(.15,.15,.01),$.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},Pe={X:[[new _.Kj0(new _.fHI(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new _.Kj0(new _.fHI(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new _.Kj0(new _.fHI(.2,0,.6,4),s),[0,.3,0]],[new _.Kj0(new _.fHI(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new _.Kj0(new _.fHI(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new _.Kj0(new _.fHI(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new _.Kj0(new _.pQR(.2,0),s)]],XY:[[new _.Kj0(new _.DvJ(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new _.Kj0(new _.DvJ(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new _.Kj0(new _.DvJ(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]]},Be={START:[[new _.Kj0(new _.pQR(.01,2),a),null,null,null,"helper"]],END:[[new _.Kj0(new _.pQR(.01,2),a),null,null,null,"helper"]],DELTA:[[new _.x12(function(){const Tt=new _.u9r;return Tt.setAttribute("position",new _.a$l([0,0,0,1,1,1],3)),Tt}(),a),null,null,null,"helper"]],X:[[new _.x12(Ee,a.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new _.x12(Ee,a.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new _.x12(Ee,a.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},Oe={XYZE:[[new _.Kj0(ye(.5,1),he),null,[0,Math.PI/2,0]]],X:[[new _.Kj0(ye(.5,.5),h)]],Y:[[new _.Kj0(ye(.5,.5),d),null,[0,0,-Math.PI/2]]],Z:[[new _.Kj0(ye(.5,.5),b),null,[0,Math.PI/2,0]]],E:[[new _.Kj0(ye(.75,1),le),null,[0,Math.PI/2,0]]]},Fe={AXIS:[[new _.x12(Ee,a.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},Xe={XYZE:[[new _.Kj0(new _.xo$(.25,10,8),s)]],X:[[new _.Kj0(new _.XvJ(.5,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new _.Kj0(new _.XvJ(.5,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new _.Kj0(new _.XvJ(.5,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new _.Kj0(new _.XvJ(.75,.1,2,24),s)]]},at={X:[[new _.Kj0(me,h),[.5,0,0],[0,0,-Math.PI/2]],[new _.Kj0(Ae,h),[0,0,0],[0,0,-Math.PI/2]],[new _.Kj0(me,h),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new _.Kj0(me,d),[0,.5,0]],[new _.Kj0(Ae,d)],[new _.Kj0(me,d),[0,-.5,0],[0,0,Math.PI]]],Z:[[new _.Kj0(me,b),[0,0,.5],[Math.PI/2,0,0]],[new _.Kj0(Ae,b),[0,0,0],[Math.PI/2,0,0]],[new _.Kj0(me,b),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new _.Kj0(new _.DvJ(.15,.15,.01),Z),[.15,.15,0]]],YZ:[[new _.Kj0(new _.DvJ(.15,.15,.01),X),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new _.Kj0(new _.DvJ(.15,.15,.01),$),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new _.Kj0(new _.DvJ(.1,.1,.1),re.clone())]]},mt={X:[[new _.Kj0(new _.fHI(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new _.Kj0(new _.fHI(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new _.Kj0(new _.fHI(.2,0,.6,4),s),[0,.3,0]],[new _.Kj0(new _.fHI(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new _.Kj0(new _.fHI(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new _.Kj0(new _.fHI(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new _.Kj0(new _.DvJ(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new _.Kj0(new _.DvJ(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new _.Kj0(new _.DvJ(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new _.Kj0(new _.DvJ(.2,.2,.2),s),[0,0,0]]]},wt={X:[[new _.x12(Ee,a.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new _.x12(Ee,a.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new _.x12(Ee,a.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function At(Tt){const yt=new _.Tme;for(const St in Tt)for(let Ft=Tt[St].length;Ft--;){const Mt=Tt[St][Ft][0].clone(),Gt=Tt[St][Ft][1],rn=Tt[St][Ft][2],gn=Tt[St][Ft][3],Kt=Tt[St][Ft][4];Mt.name=St,Mt.tag=Kt,Gt&&Mt.position.set(Gt[0],Gt[1],Gt[2]),rn&&Mt.rotation.set(rn[0],rn[1],rn[2]),gn&&Mt.scale.set(gn[0],gn[1],gn[2]),Mt.updateMatrix();const In=Mt.geometry.clone();In.applyMatrix4(Mt.matrix),Mt.geometry=In,Mt.renderOrder=1/0,Mt.position.set(0,0,0),Mt.rotation.set(0,0,0),Mt.scale.set(1,1,1),yt.add(Mt)}return yt}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=At(ge)),this.add(this.gizmo.rotate=At(Oe)),this.add(this.gizmo.scale=At(at)),this.add(this.picker.translate=At(Pe)),this.add(this.picker.rotate=At(Xe)),this.add(this.picker.scale=At(mt)),this.add(this.helper.translate=At(Be)),this.add(this.helper.rotate=At(Fe)),this.add(this.helper.scale=At(wt)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const i=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:Gg;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let a=0;a<s.length;a++){const h=s[a];let d;h.visible=!0,h.rotation.set(0,0,0),h.position.copy(this.worldPosition),d=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),h.scale.set(1,1,1).multiplyScalar(d*this.size/4),h.tag!=="helper"?(h.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"?(h.name==="X"&&Math.abs(ds.copy(Tp).applyQuaternion(i).dot(this.eye))>.99&&(h.scale.set(1e-10,1e-10,1e-10),h.visible=!1),h.name==="Y"&&Math.abs(ds.copy(Ed).applyQuaternion(i).dot(this.eye))>.99&&(h.scale.set(1e-10,1e-10,1e-10),h.visible=!1),h.name==="Z"&&Math.abs(ds.copy(qf).applyQuaternion(i).dot(this.eye))>.99&&(h.scale.set(1e-10,1e-10,1e-10),h.visible=!1),h.name==="XY"&&Math.abs(ds.copy(qf).applyQuaternion(i).dot(this.eye))<.2&&(h.scale.set(1e-10,1e-10,1e-10),h.visible=!1),h.name==="YZ"&&Math.abs(ds.copy(Tp).applyQuaternion(i).dot(this.eye))<.2&&(h.scale.set(1e-10,1e-10,1e-10),h.visible=!1),h.name==="XZ"&&Math.abs(ds.copy(Ed).applyQuaternion(i).dot(this.eye))<.2&&(h.scale.set(1e-10,1e-10,1e-10),h.visible=!1)):this.mode==="rotate"&&(Vg.copy(i),ds.copy(this.eye).applyQuaternion(ks.copy(i).invert()),h.name.search("E")!==-1&&h.quaternion.setFromRotationMatrix(zg.lookAt(this.eye,qA,Ed)),h.name==="X"&&(ks.setFromAxisAngle(Tp,Math.atan2(-ds.y,ds.z)),ks.multiplyQuaternions(Vg,ks),h.quaternion.copy(ks)),h.name==="Y"&&(ks.setFromAxisAngle(Ed,Math.atan2(ds.x,ds.z)),ks.multiplyQuaternions(Vg,ks),h.quaternion.copy(ks)),h.name==="Z"&&(ks.setFromAxisAngle(qf,Math.atan2(ds.y,ds.x)),ks.multiplyQuaternions(Vg,ks),h.quaternion.copy(ks))),h.visible=h.visible&&(h.name.indexOf("X")===-1||this.showX),h.visible=h.visible&&(h.name.indexOf("Y")===-1||this.showY),h.visible=h.visible&&(h.name.indexOf("Z")===-1||this.showZ),h.visible=h.visible&&(h.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),h.material._color=h.material._color||h.material.color.clone(),h.material._opacity=h.material._opacity||h.material.opacity,h.material.color.copy(h.material._color),h.material.opacity=h.material._opacity,this.enabled&&this.axis&&(h.name===this.axis||this.axis.split("").some(function(b){return h.name===b}))&&(h.material.color.setHex(16776960),h.material.opacity=1)):(h.visible=!1,h.name==="AXIS"?(h.position.copy(this.worldPositionStart),h.visible=!!this.axis,this.axis==="X"&&(ks.setFromEuler(Wf.set(0,0,0)),h.quaternion.copy(i).multiply(ks),Math.abs(ds.copy(Tp).applyQuaternion(i).dot(this.eye))>.9&&(h.visible=!1)),this.axis==="Y"&&(ks.setFromEuler(Wf.set(0,0,Math.PI/2)),h.quaternion.copy(i).multiply(ks),Math.abs(ds.copy(Ed).applyQuaternion(i).dot(this.eye))>.9&&(h.visible=!1)),this.axis==="Z"&&(ks.setFromEuler(Wf.set(0,Math.PI/2,0)),h.quaternion.copy(i).multiply(ks),Math.abs(ds.copy(qf).applyQuaternion(i).dot(this.eye))>.9&&(h.visible=!1)),this.axis==="XYZE"&&(ks.setFromEuler(Wf.set(0,Math.PI/2,0)),ds.copy(this.rotationAxis),h.quaternion.setFromRotationMatrix(zg.lookAt(qA,ds,Ed)),h.quaternion.multiply(ks),h.visible=this.dragging),this.axis==="E"&&(h.visible=!1)):h.name==="START"?(h.position.copy(this.worldPositionStart),h.visible=this.dragging):h.name==="END"?(h.position.copy(this.worldPosition),h.visible=this.dragging):h.name==="DELTA"?(h.position.copy(this.worldPositionStart),h.quaternion.copy(this.worldQuaternionStart),za.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),za.applyQuaternion(this.worldQuaternionStart.clone().invert()),h.scale.copy(za),h.visible=this.dragging):(h.quaternion.copy(i),this.dragging?h.position.copy(this.worldPositionStart):h.position.copy(this.worldPosition),this.axis&&(h.visible=this.axis.search(h.name)!==-1)))}super.updateMatrixWorld(e)}}class sx extends _.Kj0{constructor(){super(new _._12(1e5,1e5,2,2),new _.vBJ({visible:!1,wireframe:!0,side:_.ehD,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let i=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(i="local"),Qg.copy(Tp).applyQuaternion(i==="local"?this.worldQuaternion:Gg),Yf.copy(Ed).applyQuaternion(i==="local"?this.worldQuaternion:Gg),Xf.copy(qf).applyQuaternion(i==="local"?this.worldQuaternion:Gg),ds.copy(Yf),this.mode){case"translate":case"scale":switch(this.axis){case"X":ds.copy(this.eye).cross(Qg),ic.copy(Qg).cross(ds);break;case"Y":ds.copy(this.eye).cross(Yf),ic.copy(Yf).cross(ds);break;case"Z":ds.copy(this.eye).cross(Xf),ic.copy(Xf).cross(ds);break;case"XY":ic.copy(Xf);break;case"YZ":ic.copy(Qg);break;case"XZ":ds.copy(Xf),ic.copy(Yf);break;case"XYZ":case"E":ic.set(0,0,0)}break;default:ic.set(0,0,0)}ic.length()===0?this.quaternion.copy(this.cameraQuaternion):(YA.lookAt(za.set(0,0,0),ic,ds),this.quaternion.setFromRotationMatrix(YA)),super.updateMatrixWorld(e)}}const Hv=new _.ZzF,Kf=new _.Pa4;class XA extends _.L5s{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new _.a$l([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new _.a$l([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const i=this.attributes.instanceStart,s=this.attributes.instanceEnd;return i!==void 0&&(i.applyMatrix4(e),s.applyMatrix4(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let i;e instanceof Float32Array?i=e:Array.isArray(e)&&(i=new Float32Array(e));const s=new _.$TI(i,6,1);return this.setAttribute("instanceStart",new _.kB5(s,3,0)),this.setAttribute("instanceEnd",new _.kB5(s,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let i;e instanceof Float32Array?i=e:Array.isArray(e)&&(i=new Float32Array(e));const s=new _.$TI(i,6,1);return this.setAttribute("instanceColorStart",new _.kB5(s,3,0)),this.setAttribute("instanceColorEnd",new _.kB5(s,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new _.Uk6(e.geometry)),this}fromLineSegments(e){const i=e.geometry;return this.setPositions(i.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new _.ZzF);const e=this.attributes.instanceStart,i=this.attributes.instanceEnd;e!==void 0&&i!==void 0&&(this.boundingBox.setFromBufferAttribute(e),Hv.setFromBufferAttribute(i),this.boundingBox.union(Hv))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new _.aLr),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,i=this.attributes.instanceEnd;if(e!==void 0&&i!==void 0){const s=this.boundingSphere.center;this.boundingBox.getCenter(s);let a=0;for(let h=0,d=e.count;h<d;h++)Kf.fromBufferAttribute(e,h),a=Math.max(a,s.distanceToSquared(Kf)),Kf.fromBufferAttribute(i,h),a=Math.max(a,s.distanceToSquared(Kf));this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}class ox extends XA{constructor(e){super(),this.isWireframeGeometry2=!0,this.type="WireframeGeometry2",this.fromWireframeGeometry(new _.Uk6(e))}}_.rBU.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new _.FM8(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},_.Vj0.line={uniforms:_.rDY.merge([_.rBU.common,_.rBU.fog,_.rBU.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class KA extends _.jyz{constructor(e){super({type:"LineMaterial",uniforms:_.rDY.clone(_.Vj0.line.uniforms),vertexShader:_.Vj0.line.vertexShader,fragmentShader:_.Vj0.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(i){this.uniforms.diffuse.value=i}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(i){i===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(i){this.uniforms.linewidth.value=i}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(i){!!i!="USE_DASH"in this.defines&&(this.needsUpdate=!0),i===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(i){this.uniforms.dashScale.value=i}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(i){this.uniforms.dashSize.value=i}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(i){this.uniforms.dashOffset.value=i}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(i){this.uniforms.gapSize.value=i}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(i){this.uniforms.opacity.value=i}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(i){this.uniforms.resolution.value.copy(i)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(i){!!i!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),i===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}const JA=new _.Pa4,$A=new _.Pa4;class ZA extends _.Kj0{constructor(e=new XA,i=new KA({color:16777215*Math.random()})){super(e,i),this.isWireframe=!0,this.type="Wireframe"}computeLineDistances(){const e=this.geometry,i=e.attributes.instanceStart,s=e.attributes.instanceEnd,a=new Float32Array(2*i.count);for(let d=0,b=0,X=i.count;d<X;d++,b+=2)JA.fromBufferAttribute(i,d),$A.fromBufferAttribute(s,d),a[b]=b===0?0:a[b-1],a[b+1]=a[b]+JA.distanceTo($A);const h=new _.$TI(a,2,1);return e.setAttribute("instanceDistanceStart",new _.kB5(h,1,0)),e.setAttribute("instanceDistanceEnd",new _.kB5(h,1,1)),this}}class Wv extends _.ZAu{constructor(){super(),this.assetType="widget",this.modelObject=this,this._object=null,this.boundingScaleMultiplier=1,this.position.set(0,0,0),this.visible=!1,this.renderOrder=1,this.userData.bboxVisible=!1,this._updater=this._updater.bind(this)}_updater(){const e=this._object;if(e){const i=new nn().expandByObject(e,!1);i.getCenter(this.position);const s=i.getBoundingSphere(new _.aLr).radius;this.scale.setScalar(s*this.boundingScaleMultiplier),this.setVisible(!0)}else this.setVisible(!1)}_initGeometry(e){if(this._geometry)return;const i=new ox(e);this._geometry=i;const s=new KA({color:"#ff2222",transparent:!0,opacity:.9,linewidth:5,resolution:new _.FM8(1024,1024),dashed:!1,toneMapped:!1}),a=new ZA(i,s);a.computeLineDistances(),a.scale.set(1,1,1),a.visible=!0,this.add(a)}setVisible(e){var i;e!==this.visible&&(this.visible=e,(i=this.setDirty)===null||i===void 0||i.call(this,{sceneUpdate:!1}))}attach(e){return this.detach(),e?(this._object=e,this._object.addEventListener("objectUpdate",this._updater),this._updater(),this):this}detach(){var e;return this._object?((e=this._object)===null||e===void 0||e.removeEventListener("objectUpdate",this._updater),this._object=null,this._updater(),this):this}get object(){return this._object}}class Jf extends Wv{constructor(){super(),this.boundingScaleMultiplier=1/1.7,this._initGeometry(new _.DvJ(2,2,2,1,1,1))}_updater(){super._updater();const e=this.object;e&&(new nn().expandByObject(e,!1).getSize(this.scale).multiplyScalar(this.boundingScaleMultiplier).clampScalar(.1,100),this.setVisible(!0))}}var Sd=function(c){return function(e){return 1-c(1-e)}},Hg=function(c){return function(e){return e<=.5?c(2*e)/2:(2-c(2*(1-e)))/2}},ey=function(c){return function(e){return Math.pow(e,c)}},qv=function(c){return function(e){return e*e*((c+1)*e-c)}},Yv=function(c){var e=qv(c);return function(i){return(i*=2)<1?.5*e(i):.5*(2-Math.pow(2,-10*(i-1)))}},Wg=function(c){return c},Tu=ey(2),ty=Sd(Tu),$f=Hg(Tu),qg=function(c){return 1-Math.sin(Math.acos(c))},Xv=Sd(qg),ny=Hg(Xv),Yg=qv(1.525),Kv=Sd(Yg),Jv=Hg(Yg),Zf=Yv(1.525),gh=function(c){if(c===1||c===0)return c;var e=c*c;return c<.36363636363636365?7.5625*e:c<.7272727272727273?9.075*e-9.9*c+3.4:c<.9?12.066481994459833*e-19.63545706371191*c+8.898060941828255:10.8*c*c-20.52*c+10.72},$v=Sd(gh),em=function(c){return c<.5?.5*(1-gh(1-2*c)):.5*gh(2*c-1)+.5},Dr=function(){return Dr=Object.assign||function(c){for(var e,i=1,s=arguments.length;i<s;i++)for(var a in e=arguments[i])Object.prototype.hasOwnProperty.call(e,a)&&(c[a]=e[a]);return c},Dr.apply(this,arguments)};function _h(c,e){var i={};for(var s in c)Object.prototype.hasOwnProperty.call(c,s)&&e.indexOf(s)<0&&(i[s]=c[s]);if(c!=null&&typeof Object.getOwnPropertySymbols=="function"){var a=0;for(s=Object.getOwnPropertySymbols(c);a<s.length;a++)e.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(c,s[a])&&(i[s[a]]=c[s[a]])}return i}var Cd=function(c,e,i){return Math.min(Math.max(i,c),e)};function vh(c,e){return c*Math.sqrt(1-e*e)}var tm=["duration","bounce"],Ip=["stiffness","damping","mass"];function Md(c,e){return e.some(function(i){return c[i]!==void 0})}function Iu(c){var e=c.from,i=e===void 0?0:e,s=c.to,a=s===void 0?1:s,h=c.restSpeed,d=h===void 0?2:h,b=c.restDelta,X=_h(c,["from","to","restSpeed","restDelta"]),$={done:!1,value:i},Z=function(Pe){var Be=Dr({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},Pe);if(!Md(Pe,Ip)&&Md(Pe,tm)){var Oe=function(Fe){var Xe,at,mt=Fe.duration,wt=mt===void 0?800:mt,At=Fe.bounce,Tt=At===void 0?.25:At,yt=Fe.velocity,St=yt===void 0?0:yt,Ft=Fe.mass,Mt=Ft===void 0?1:Ft,Gt=1-Tt;Gt=Cd(.05,1,Gt),wt=Cd(.01,10,wt/1e3),Gt<1?(Xe=function(Kt){var In=Kt*Gt,kn=In*wt;return .001-(In-St)/vh(Kt,Gt)*Math.exp(-kn)},at=function(Kt){var In=Kt*Gt*wt,kn=In*St+St,On=Math.pow(Gt,2)*Math.pow(Kt,2)*wt,zn=Math.exp(-In),pi=vh(Math.pow(Kt,2),Gt);return(.001-Xe(Kt)>0?-1:1)*((kn-On)*zn)/pi}):(Xe=function(Kt){return Math.exp(-Kt*wt)*((Kt-St)*wt+1)-.001},at=function(Kt){return Math.exp(-Kt*wt)*(wt*wt*(St-Kt))});var rn=function(Kt,In,kn){for(var On=kn,zn=1;zn<12;zn++)On-=Kt(On)/In(On);return On}(Xe,at,5/wt);if(wt*=1e3,isNaN(rn))return{stiffness:100,damping:10,duration:wt};var gn=Math.pow(rn,2)*Mt;return{stiffness:gn,damping:2*Gt*Math.sqrt(Mt*gn),duration:wt}}(Pe);(Be=Dr(Dr(Dr({},Be),Oe),{velocity:0,mass:1})).isResolvedFromDuration=!0}return Be}(X),re=Z.stiffness,le=Z.damping,he=Z.mass,fe=Z.velocity,me=Z.duration,Ee=Z.isResolvedFromDuration,Ae=Dp,ye=Dp;function ge(){var Pe=fe?-fe/1e3:0,Be=a-i,Oe=le/(2*Math.sqrt(re*he)),Fe=Math.sqrt(re/he)/1e3;if(b!=null||(b=Math.abs(a-i)<=1?.01:.4),Oe<1){var Xe=vh(Fe,Oe);Ae=function(mt){var wt=Math.exp(-Oe*Fe*mt);return a-wt*((Pe+Oe*Fe*Be)/Xe*Math.sin(Xe*mt)+Be*Math.cos(Xe*mt))},ye=function(mt){var wt=Math.exp(-Oe*Fe*mt);return Oe*Fe*wt*(Math.sin(Xe*mt)*(Pe+Oe*Fe*Be)/Xe+Be*Math.cos(Xe*mt))-wt*(Math.cos(Xe*mt)*(Pe+Oe*Fe*Be)-Xe*Be*Math.sin(Xe*mt))}}else if(Oe===1)Ae=function(mt){return a-Math.exp(-Fe*mt)*(Be+(Pe+Fe*Be)*mt)};else{var at=Fe*Math.sqrt(Oe*Oe-1);Ae=function(mt){var wt=Math.exp(-Oe*Fe*mt),At=Math.min(at*mt,300);return a-wt*((Pe+Oe*Fe*Be)*Math.sinh(At)+at*Be*Math.cosh(At))/at}}}return ge(),{next:function(Pe){var Be=Ae(Pe);if(Ee)$.done=Pe>=me;else{var Oe=1e3*ye(Pe),Fe=Math.abs(Oe)<=d,Xe=Math.abs(a-Be)<=b;$.done=Fe&&Xe}return $.value=$.done?a:Be,$},flipTarget:function(){var Pe;fe=-fe,i=(Pe=[a,i])[0],a=Pe[1],ge()}}}Iu.needsInterpolation=function(c,e){return typeof c=="string"||typeof e=="string"};var Dp=function(c){return 0},Xg=function(c,e,i){var s=e-c;return s===0?1:(i-c)/s},Ah=function(c,e,i){return-i*c+i*e+c},Pp=function(c,e){return function(i){return Math.max(Math.min(i,e),c)}},yh=function(c){return c%1?Number(c.toFixed(5)):c},nm=/(-)?([\d]*\.?[\d])+/g,im=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))/gi,iy=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i;function Rp(c){return typeof c=="string"}var Td={test:function(c){return typeof c=="number"},parse:parseFloat,transform:function(c){return c}},rm=Dr(Dr({},Td),{transform:Pp(0,1)}),Kg=(Dr(Dr({},Td),{default:1}),function(c,e){return function(i){return!!(Rp(i)&&iy.test(i)&&i.startsWith(c)||e&&Object.prototype.hasOwnProperty.call(i,e))}}),Zv=function(c,e,i){return function(s){var a;if(!Rp(s))return s;var h=s.match(nm),d=h[0],b=h[1],X=h[2],$=h[3];return(a={})[c]=parseFloat(d),a[e]=parseFloat(b),a[i]=parseFloat(X),a.alpha=$!==void 0?parseFloat($):1,a}},ry=Pp(0,255),Jg=Dr(Dr({},Td),{transform:function(c){return Math.round(ry(c))}}),Id={test:Kg("rgb","red"),parse:Zv("red","green","blue"),transform:function(c){var e=c.red,i=c.green,s=c.blue,a=c.alpha,h=a===void 0?1:a;return"rgba("+Jg.transform(e)+", "+Jg.transform(i)+", "+Jg.transform(s)+", "+yh(rm.transform(h))+")"}},e0={test:Kg("#"),parse:function(c){var e="",i="",s="",a="";return c.length>5?(e=c.substr(1,2),i=c.substr(3,2),s=c.substr(5,2),a=c.substr(7,2)):(e=c.substr(1,1),i=c.substr(2,1),s=c.substr(3,1),a=c.substr(4,1),e+=e,i+=i,s+=s,a+=a),{red:parseInt(e,16),green:parseInt(i,16),blue:parseInt(s,16),alpha:a?parseInt(a,16)/255:1}},transform:Id.transform},sy=function(c){return{test:function(e){return Rp(e)&&e.endsWith(c)&&e.split(" ").length===1},parse:parseFloat,transform:function(e){return""+e+c}}},Bp=sy("%"),bh=(Dr(Dr({},Bp),{parse:function(c){return Bp.parse(c)/100},transform:function(c){return Bp.transform(100*c)}}),{test:Kg("hsl","hue"),parse:Zv("hue","saturation","lightness"),transform:function(c){var e=c.hue,i=c.saturation,s=c.lightness,a=c.alpha,h=a===void 0?1:a;return"hsla("+Math.round(e)+", "+Bp.transform(yh(i))+", "+Bp.transform(yh(s))+", "+yh(rm.transform(h))+")"}}),kp=function(c,e,i){var s=c*c,a=e*e;return Math.sqrt(Math.max(0,i*(a-s)+s))},oy=[e0,Id,bh],ay=function(c){return oy.find(function(e){return e.test(c)})},Op=function(c,e){var i=ay(c),s=ay(e);i.transform,s.transform;var a=i.parse(c),h=s.parse(e),d=Dr({},a),b=i===bh?Ah:kp;return function(X){for(var $ in d)$!=="alpha"&&(d[$]=b(a[$],h[$],X));return d.alpha=Ah(a.alpha,h.alpha,X),i.transform(d)}},Dd=function(c){return Id.test(c)||e0.test(c)||bh.test(c)},ly=function(c){return Id.test(c)?Id.parse(c):bh.test(c)?bh.parse(c):e0.parse(c)},cy=function(c){return Rp(c)?c:c.hasOwnProperty("red")?Id.transform(c):bh.transform(c)},sm="${c}",Lp="${n}";function t0(c){var e=[],i=0,s=c.match(im);s&&(i=s.length,c=c.replace(im,sm),e.push.apply(e,s.map(ly)));var a=c.match(nm);return a&&(c=c.replace(nm,Lp),e.push.apply(e,a.map(Td.parse))),{values:e,numColors:i,tokenised:c}}function oa(c){return t0(c).values}function n0(c){var e=t0(c),i=e.values,s=e.numColors,a=e.tokenised,h=i.length;return function(d){for(var b=a,X=0;X<h;X++)b=b.replace(X<s?sm:Lp,X<s?cy(d[X]):yh(d[X]));return b}}var uy=function(c){return typeof c=="number"?0:c},i0={test:function(c){var e,i,s,a;return isNaN(c)&&Rp(c)&&((i=(e=c.match(nm))===null||e===void 0?void 0:e.length)!==null&&i!==void 0?i:0)+((a=(s=c.match(im))===null||s===void 0?void 0:s.length)!==null&&a!==void 0?a:0)>0},parse:oa,createTransformer:n0,getAnimatableNone:function(c){var e=oa(c);return n0(c)(e.map(uy))}},r0={x:0,y:0,z:0},Np=function(c){return typeof c=="number"},wh=function(c,e){return function(i){return e(c(i))}},$g=function(){for(var c=[],e=0;e<arguments.length;e++)c[e]=arguments[e];return c.reduce(wh)};function s0(c,e){return Np(c)?function(i){return Ah(c,e,i)}:Dd(c)?Op(c,e):e_(c,e)}var rc=function(c,e){var i=function(h,d){for(var b=0,X=d.length,$=h.length;b<X;b++,$++)h[$]=d[b];return h}([],c),s=i.length,a=c.map(function(h,d){return s0(h,e[d])});return function(h){for(var d=0;d<s;d++)i[d]=a[d](h);return i}},hy=function(c,e){var i=Dr(Dr({},c),e),s={};for(var a in i)c[a]!==void 0&&e[a]!==void 0&&(s[a]=s0(c[a],e[a]));return function(h){for(var d in s)i[d]=s[d](h);return i}};function Zg(c){for(var e=i0.parse(c),i=e.length,s=0,a=0,h=0,d=0;d<i;d++)s||typeof e[d]=="number"?s++:e[d].hue!==void 0?h++:a++;return{parsed:e,numNumbers:s,numRGB:a,numHSL:h}}var e_=function(c,e){var i=i0.createTransformer(e),s=Zg(c),a=Zg(e);return $g(rc(s.parsed,a.parsed),i)},o0=function(c,e){return function(i){return Ah(c,e,i)}};function Up(c,e,i){var s=i===void 0?{}:i,a=s.clamp,h=a===void 0||a,d=s.ease,b=s.mixer,X=c.length;e.length,!d||!Array.isArray(d)||d.length,c[0]>c[X-1]&&(c=[].concat(c),e=[].concat(e),c.reverse(),e.reverse());var $=function(re,le,he){for(var fe=[],me=he||(typeof(Pe=re[0])=="number"?o0:typeof Pe=="string"?Dd(Pe)?Op:e_:Array.isArray(Pe)?rc:typeof Pe=="object"?hy:void 0),Ee=re.length-1,Ae=0;Ae<Ee;Ae++){var ye=me(re[Ae],re[Ae+1]);if(le){var ge=Array.isArray(le)?le[Ae]:le;ye=$g(ge,ye)}fe.push(ye)}var Pe;return fe}(e,d,b),Z=X===2?function(re,le){var he=re[0],fe=re[1],me=le[0];return function(Ee){return me(Xg(he,fe,Ee))}}(c,$):function(re,le){var he=re.length,fe=he-1;return function(me){var Ee=0,Ae=!1;if(me<=re[0]?Ae=!0:me>=re[fe]&&(Ee=fe-1,Ae=!0),!Ae){for(var ye=1;ye<he&&!(re[ye]>me||ye===fe);ye++);Ee=ye-1}var ge=Xg(re[Ee],re[Ee+1],me);return le[Ee](ge)}}(c,$);return h?function(re){return Z(Cd(c[0],c[X-1],re))}:Z}function t_(c,e){return c.map(function(){return e||$f}).splice(0,c.length-1)}function Fp(c){var e=c.from,i=e===void 0?0:e,s=c.to,a=s===void 0?1:s,h=c.ease,d=c.offset,b=c.duration,X=b===void 0?300:b,$={done:!1,value:i},Z=Array.isArray(a)?a:[i,a],re=function(fe,me){return fe.map(function(Ee){return Ee*me})}(d&&d.length===Z.length?d:function(fe){var me=fe.length;return fe.map(function(Ee,Ae){return Ae!==0?Ae/(me-1):0})}(Z),X);function le(){return Up(re,Z,{ease:Array.isArray(h)?h:t_(Z,h)})}var he=le();return{next:function(fe){return $.value=he(fe),$.done=fe>=X,$},flipTarget:function(){Z.reverse(),he=le()}}}function a0(c){var e=c.velocity,i=e===void 0?0:e,s=c.from,a=s===void 0?0:s,h=c.power,d=h===void 0?.8:h,b=c.timeConstant,X=b===void 0?350:b,$=c.restDelta,Z=$===void 0?.5:$,re=c.modifyTarget,le={done:!1,value:a},he=d*i,fe=a+he,me=re===void 0?fe:re(fe);return me!==fe&&(he=me-a),{next:function(Ee){var Ae=-he*Math.exp(-Ee/X);return le.done=!(Ae>Z||Ae<-Z),le.value=le.done?me:me+Ae,le},flipTarget:function(){}}}var dy={keyframes:Fp,spring:Iu,decay:a0},py=1/60*1e3,fy=typeof performance<"u"?function(){return performance.now()}:function(){return Date.now()},my=typeof window<"u"?function(c){return window.requestAnimationFrame(c)}:function(c){return setTimeout(function(){return c(fy())},py)},$a=!0,xh=!1,n_=!1,Pd={delta:0,timestamp:0},Rd=["read","update","preRender","render","postRender"],om=Rd.reduce(function(c,e){return c[e]=function(i){var s=[],a=[],h=0,d=!1,b=new WeakSet,X={schedule:function($,Z,re){Z===void 0&&(Z=!1),re===void 0&&(re=!1);var le=re&&d,he=le?s:a;return Z&&b.add($),he.indexOf($)===-1&&(he.push($),le&&d&&(h=s.length)),$},cancel:function($){var Z=a.indexOf($);Z!==-1&&a.splice(Z,1),b.delete($)},process:function($){var Z;if(d=!0,s=(Z=[a,s])[0],(a=Z[1]).length=0,h=s.length)for(var re=0;re<h;re++){var le=s[re];le($),b.has(le)&&(X.schedule(le),i())}d=!1}};return X}(function(){return xh=!0}),c},{}),l0=Rd.reduce(function(c,e){var i=om[e];return c[e]=function(s,a,h){return a===void 0&&(a=!1),h===void 0&&(h=!1),xh||am(),i.schedule(s,a,h)},c},{}),c0=Rd.reduce(function(c,e){return c[e]=om[e].cancel,c},{}),gy=function(c){return om[c].process(Pd)},u0=function(c){xh=!1,Pd.delta=$a?py:Math.max(Math.min(c-Pd.timestamp,40),1),Pd.timestamp=c,n_=!0,Rd.forEach(gy),n_=!1,xh&&($a=!1,my(u0))},am=function(){xh=!0,$a=!0,n_||my(u0)},jp=function(){return Pd},h0=l0;function d0(c,e,i){return i===void 0&&(i=0),c-e-i}var i_=function(c){var e=function(i){var s=i.delta;return c(s)};return{start:function(){return h0.update(e,!0)},stop:function(){return c0.update(e)}}};function zp(c){var e,i,s,a,h,d=c.from,b=c.autoplay,X=b===void 0||b,$=c.driver,Z=$===void 0?i_:$,re=c.elapsed,le=re===void 0?0:re,he=c.repeat,fe=he===void 0?0:he,me=c.repeatType,Ee=me===void 0?"loop":me,Ae=c.repeatDelay,ye=Ae===void 0?0:Ae,ge=c.onPlay,Pe=c.onStop,Be=c.onComplete,Oe=c.onRepeat,Fe=c.onUpdate,Xe=_h(c,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]),at=Xe.to,mt=0,wt=Xe.duration,At=!1,Tt=!0,yt=function(Ft){if(Array.isArray(Ft.to))return Fp;if(dy[Ft.type])return dy[Ft.type];var Mt=new Set(Object.keys(Ft));return Mt.has("ease")||Mt.has("duration")&&!Mt.has("dampingRatio")?Fp:Mt.has("dampingRatio")||Mt.has("stiffness")||Mt.has("mass")||Mt.has("damping")||Mt.has("restSpeed")||Mt.has("restDelta")?Iu:Fp}(Xe);!((i=(e=yt).needsInterpolation)===null||i===void 0)&&i.call(e,d,at)&&(h=Up([0,100],[d,at],{clamp:!1}),d=0,at=100);var St=yt(Dr(Dr({},Xe),{from:d,to:at}));return X&&(ge==null||ge(),(s=Z(function(Ft){if(Tt||(Ft=-Ft),le+=Ft,!At){var Mt=St.next(Math.max(0,le));a=Mt.value,h&&(a=h(a)),At=Tt?Mt.done:le<=0}Fe==null||Fe(a),At&&(mt===0&&(wt!=null||(wt=le)),mt<fe?function(Gt,rn,gn,Kt){return Kt?Gt>=rn+gn:Gt<=-gn}(le,wt,ye,Tt)&&(mt++,Ee==="reverse"?le=function(Gt,rn,gn,Kt){return gn===void 0&&(gn=0),Kt===void 0&&(Kt=!0),Kt?d0(rn+-Gt,rn,gn):rn-(Gt-rn)+gn}(le,wt,ye,Tt=mt%2==0):(le=d0(le,wt,ye),Ee==="mirror"&&St.flipTarget()),At=!1,Oe&&Oe()):(s.stop(),Be&&Be()))})).start()),{stop:function(){Pe==null||Pe(),s.stop()}}}const lm={linear:Wg,easeIn:Tu,easeOut:ty,easeInOut:$f,circIn:qg,circOut:Xv,circInOut:ny,backIn:Yg,backOut:Kv,backInOut:Jv,anticipate:Zf,bounceOut:gh,bounceIn:$v,bounceInOut:em,easeInOutSine:function(c){return-(Math.cos(Math.PI*c)-1)/2}};async function eo(c){return new Promise(e=>setTimeout(e,Math.max(0,c)))}function cm(c,e,i){const s=c[e],a=()=>{typeof(c==null?void 0:c.setDirty)=="function"&&c.setDirty(),i==null||i()};return s.isVector3||s.isVector2||s.isVector4?h=>{s.copy(h),a()}:h=>{c[e]=h,a()}}function r_(c){return typeof c!="boolean"}async function s_(c,e,i){e in c||console.error("invalid key",e,c);const s=cm(c,e),a=c[e],h=d=>{var b;s(d),(b=i.onUpdate)===null||b===void 0||b.call(i,d)};if(r_(a))return typeof i.to=="function"&&(i={...i,to:i.to(a,c)}),Vp({...i,from:a,onUpdate:h});{const{duration:d}=i;return eo(d??0).then(()=>h(i.to))}}async function Vp(c){return new Promise((e,i)=>{zp({onComplete:()=>{var s;(s=c.onComplete)===null||s===void 0||s.call(c),e()},onStop:()=>{var s;(s=c.onStop)===null||s===void 0||s.call(c),e()},...c})})}async function Gc(c,e){const i=c.onComplete,s=c.onStop;return c={...c},new Promise((a,h)=>{c.onComplete=()=>{i==null||i(),a()},c.onStop=()=>{s==null||s(),a()};const d=zp(c);e.push(d)})}class sc extends Sl{constructor(){super(),this.passId="frameFade",this._fadeTime=0,this._fadeTimeState=0,this._toSaveFrame=!1,this._beforeFilters=["progressive","taa"],this._afterFilters=["render"],this._requiredFilters=["render","progressive"],this.dependencies=[Ho],this.fadeOnActiveCameraChange=!0,this.fadeOnMaterialUpdate=!0,this.fadeOnSceneUpdate=!0,this.pointerEnabled=!0,this._fadeCam=e=>e.frameFade!==!1&&this.fadeOnActiveCameraChange&&this.startTransition(1e3),this._fadeMat=e=>{e.frameFade!==!1&&this.fadeOnMaterialUpdate&&this.startTransition(200)},this._fadeScene=e=>{e.frameFade!==!1&&this.fadeOnSceneUpdate&&this.startTransition(500)},this._onPointerMove=e=>{var i;const s=(i=this._viewer)===null||i===void 0?void 0:i.canvas;if(!s)return void(this.pointerEnabled=!1);if(!e.buttons||e.target!==s)return void(this.pointerEnabled=!0);const a=s.getBoundingClientRect(),h=(e.clientX-a.left)/a.width,d=(e.clientY-a.top)/a.height;this.pointerEnabled=h<0||h>1||d<0||d>1},this._disabledBy=[],this.startTransition=this.startTransition.bind(this),this.stopTransition=this.stopTransition.bind(this),this._fadeCam=this._fadeCam.bind(this),this._fadeMat=this._fadeMat.bind(this)}async startTransition(e){this._viewer&&this._pass&&!this.isDisabled()&&(this._target||(this._target=this._viewer.renderer.getTempTarget({sizeMultiplier:1,minFilter:_.wem,magFilter:_.wem,encoding:this._viewer.renderer.composerTarget.texture.encoding})),this._fadeTimeState=Math.max(e,this._fadeTimeState),this._fadeTime=this._fadeTimeState,this._toSaveFrame=!0,this.setDirty(),await eo(e))}stopTransition(){this._fadeTimeState=0}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._fadeCam),e.scene.addEventListener("activeCameraUpdate",this.stopTransition),e.scene.addEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.addEventListener("sceneUpdate",this._fadeScene),window.addEventListener("pointermove",this._onPointerMove)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._fadeCam),e.scene.removeEventListener("activeCameraUpdate",this.stopTransition),e.scene.removeEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.removeEventListener("sceneUpdate",this._fadeScene),window.removeEventListener("pointermove",this._onPointerMove),super.onRemove(e)}passCtor(e){const i=this,s=e.getPlugin(Ho),a=new class extends jv{constructor(){super(...arguments),this._lastTime=0,this.uiConfig=ou("Frame Fade",this)}render(h,d,b,X,$){this.needsSwap=!1;const Z=i._target;if(!Z||!i.pointerEnabled||!this.enabled||!i.dirty||i._fadeTimeState<.001)return;i._toSaveFrame&&s.lastFrame&&(e.renderer.blit(s.lastFrame.texture,Z),this._lastTime=0,i._toSaveFrame=!1),this.blendTexture=Z==null?void 0:Z.texture;const re=i._fadeTimeState/i._fadeTime;this.weights2.setScalar(re),this.weights2.w=1,this.weights1.setScalar(1-re),this.weights1.w=1,super.render(h,d,b,X,$),this.needsSwap=!0;const le=ia();this._lastTime<10&&(this._lastTime=le-10);const he=le-this._lastTime;this._lastTime=le,i._fadeTimeState-=he}};return a.enabled=!0,a}setDirty(){var e;this.enabled&&((e=this._viewer)===null||e===void 0||e.setDirty())}get dirty(){return this.enabled&&this._fadeTimeState>0}set dirty(e){console.warn("FrameFadePlugin.dirty is readonly")}_update(e){return!!super._update(e)&&(this.isDisabled()&&this.stopTransition(),this._fadeTimeState<.001&&(this._toSaveFrame=!1,this._target&&this._viewer&&(this._viewer.renderer.releaseTempTarget(this._target),this._target=void 0)),!0)}get uiConfig(){var e,i;return(i=(e=this.pass)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.uiConfig}disable(e){this._disabledBy.includes(e)||this._disabledBy.push(e)}enable(e){const i=this._disabledBy.indexOf(e);i>=0&&this._disabledBy.splice(i,1)}isDisabled(){return!this.pointerEnabled||this._disabledBy.length>0||!this.enabled}}sc.PluginType="FrameFade";var Gp=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d},Bd=_.M8C.degToRad;class br extends Xi{constructor(e=Jf,i=!1,s=!0,a=!1){super(),this.enabled=!0,this._enableWidget=!1,this.autoFocus=!1,this._onObjectHit=h=>{this._viewer&&(this.enabled?this.dispatchEvent(h):h.intersects.selectedObject=null)},this._uiConfigChildren=[{label:"Enabled",type:"checkbox",property:[this,"enabled"]},{label:"AutoFocus",type:"checkbox",property:[this,"autoFocus"],onChange:()=>{const h=this.getSelectedObject();this.autoFocus&&h&&this.setSelectedObject(h,!0)}}],e&&(this._widget=new e),this._controls=i,this._pickUi=s,this.autoFocus=a}get picker(){return this._picker}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}getSelectedObject(){var e;if(this.enabled)return((e=this._picker)===null||e===void 0?void 0:e.selectedObject)||void 0}setSelectedObject(e,i=!1){if(!this.enabled||!this._picker)return;const s=this.autoFocus;this.autoFocus=!1,this._picker.selectedObject=e||null,this.autoFocus=s,(s||i)&&this.focusObject(e)}async onAdded(e){await super.onAdded(e),this._picker=new GA(e.scene,e.canvas,void 0,i=>{var s,a;if(!i.material)return!1;let h=i,d=!1;for(;h;){if(!h.visible||(((s=h.userData.iModel)!==null&&s!==void 0?s:h).assetType==="model"&&(d=!0),((a=h.userData.iModel)!==null&&a!==void 0?a:h).assetType==="widget")||h.userData.userSelectable===!1||h.userData.bboxVisible===!1)return!1;h=h.parent}return d}),this._widget&&e.scene.addWidget(this._widget),this._transformControls=new Qc(e),this._transformControls.enabled=this._controls,this._picker.addEventListener("selectedObjectChanged",i=>{var s,a,h,d;this.dispatchEvent(i);const b=((s=this._picker)===null||s===void 0?void 0:s.selectedObject)||void 0;if(this._pickUi){const Z=(a=b)===null||a===void 0?void 0:a.uiConfig,re=this.uiConfig;re.children=[...this._uiConfigChildren],Z&&re.children.push(Z),(h=re.uiRefresh)===null||h===void 0||h.call(re)}const X=this._widget;X&&this._enableWidget&&(b?X.attach(b):X.detach());const $=this._transformControls;$&&(!((d=this._viewer)===null||d===void 0)&&d.scene.activeCamera.controls)&&(b&&$.enabled?$.attach(b):$.detach()),e.setDirty(),this.autoFocus&&this.focusObject(b)}),this._picker.addEventListener("hoverObjectChanged",this.dispatchEvent),this._picker.addEventListener("hitObject",this._onObjectHit),e.scene.addEventListener("select",i=>{i.value===void 0?console.warn("e.value must be set for picking, can be null to unselect"):this.setSelectedObject(i.value,this.autoFocus||i.focusCamera)}),e.scene.addEventListener("addSceneObject",async i=>{var s,a,h;const d=i.object,b=this.getSelectedObject();if(b&&(d==null?void 0:d.assetType)==="material"&&typeof(b==null?void 0:b.setMaterial)=="function"&&(!((s=b==null?void 0:b.modelObject)===null||s===void 0)&&s.isMesh)&&await e.confirm("Applying material: Apply material to the selected object?")){const X=b.material;if(Array.isArray(X))console.warn("Dropping on material array not yet fully supported."),b.setMaterial(d);else{let $=Array.from((a=X==null?void 0:X.userData.__appliedMeshes)!==null&&a!==void 0?a:[]);($.length>1?!await e.confirm("Applying material: Apply to all objects using this material?"):$.length<1)&&($=[b]);for(const Z of $)Z&&((h=Z.setMaterial)===null||h===void 0||h.call(Z,d))}}}),e.scene.addEventListener("sceneUpdate",i=>{if(!i.hierarchyChanged)return;const s=this.getSelectedObject();let a=!1;s==null||s.traverseAncestors(h=>{h===e.scene.modelObject&&(a=!0)}),a||this.setSelectedObject(void 0)})}async focusObject(e){var i,s,a,h;const d=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("CameraViews");await(d==null?void 0:d.animateToObject(e,4,1e3,"easeOut",{min:((h=(a=(s=this._viewer)===null||s===void 0?void 0:s.scene.activeCamera.getControls())===null||a===void 0?void 0:a.minDistance)!==null&&h!==void 0?h:.5)+.5,max:5}))}enableWidget(e){var i,s,a;if(this._enableWidget=e,e){const h=((i=this._picker)===null||i===void 0?void 0:i.selectedObject)||void 0;h&&((s=this._widget)===null||s===void 0||s.attach(h))}else(a=this._widget)===null||a===void 0||a.detach()}get uiConfig(){return this._pickUi?this._uiConfig?this._uiConfig:this._uiConfig={type:"panel",label:"Picker",expanded:!0,children:[...this._uiConfigChildren]}:{}}get transformControls(){return this._transformControls}get widget(){return this._widget}}br.PluginType="Picking",Gp([kt()],br.prototype,"enabled",void 0),Gp([kt()],br.prototype,"autoFocus",void 0);class Qc extends ex{constructor(e){super(e.scene.activeCamera.cameraObject,e.canvas),this.modelObject=this,this.assetType="widget",this._activeCameraChange=this._activeCameraChange.bind(this),this._scene=e.scene,this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.visible=!1,this.userData.bboxVisible=!1,this.addEventListener("objectChange",()=>{var i;(i=this==null?void 0:this.object)===null||i===void 0||i.dispatchEvent({type:"objectUpdate",fadeFrame:!1})}),this.addEventListener("dragging-changed",i=>{const s=e==null?void 0:e.getPlugin(sc);s&&(s.enabled=!i.value),this._scene.activeCamera.interactionsEnabled=!i.value}),this._keyDownListener=this._keyDownListener.bind(this),window.addEventListener("keydown",this._keyDownListener),window.addEventListener("keyup",this._keyUpListener),this._scene.addWidget(this)}_keyDownListener(e){if(this.enabled&&this.object){switch(e.keyCode){case 81:this.setSpace(this.space==="local"?"world":"local");break;case 16:this.setTranslationSnap(100),this.setRotationSnap(Bd(15)),this.setScaleSnap(.25);break;case 87:this.setMode("translate");break;case 69:this.setMode("rotate");break;case 82:this.setMode("scale");break;case 187:case 107:this.setSize(this.size+.1);break;case 189:case 109:this.setSize(Math.max(this.size-.1,.1));break;case 88:this.showX=!this.showX;break;case 89:this.showY=!this.showY;break;case 90:this.showZ=!this.showZ;break;case 32:this.enabled=!this.enabled;break;default:return}this._scene.setDirty({sceneUpdate:!0,frameFade:!0})}}_keyUpListener(e){this.enabled&&(e.keyCode===16&&(this.setTranslationSnap(null),this.setRotationSnap(null),this.setScaleSnap(null)),this.object&&e.keyCode)}_activeCameraChange(){this.camera=this._scene.activeCamera.cameraObject}dispose(){window.removeEventListener("keydown",this._keyDownListener),window.removeEventListener("keyup",this._keyUpListener),this._scene.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene.modelObject.remove(this),super.dispose()}}var Qp=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class zs extends Xi{constructor(){super(),this.offsetCache={},this.enabled=!0,this.envMap=null,this.forceSceneEnvMap=!1,this.getEnvMap=()=>{var e;return!this.forceSceneEnvMap&&this.envMap?this.envMap:((e=this._viewer)===null||e===void 0?void 0:e.scene.getEnvironment())||null},this._modelProcessor={forAssetType:"model",processAsync:async(e,i)=>{const s=[];return e.modelObject.traverse(a=>{var h,d,b,X;const $=(d=(h=a.userData)===null||h===void 0?void 0:h.gltfExtensions)===null||d===void 0?void 0:d[zs.DIAMOND_GLTF_EXTENSION];$&&a.geometry&&(this.prepareDiamondMesh(a,$),delete a.userData.gltfExtensions[zs.DIAMOND_GLTF_EXTENSION]),a.material&&!s.includes(a.material)&&(!((X=(b=a.material.userData)===null||b===void 0?void 0:b.gltfExtensions)===null||X===void 0)&&X[zs.DIAMOND_GLTF_EXTENSION])&&(a.material.materialObject||console.warn("material not processed",a.material),s.push(a.material))}),s.forEach(a=>{const h=a.userData.gltfExtensions[zs.DIAMOND_GLTF_EXTENSION];h&&this._convertToDiamondMaterial(a,h)}),e}},this.uiConfig={type:"folder",label:"Diamonds",children:[{type:"toggle",label:"Use Scene Environment",property:[this,"forceSceneEnvironment"],limitedUi:!0},{type:"image",label:"Environment",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap"],limitedUi:!0},{type:"slider",bounds:[0,2*Math.PI],hidden:()=>this.forceSceneEnvMap,label:"Env Rotation",property:[this,"envMapRotation"],limitedUi:!0},{type:"button",label:"Make Diamond",hidden:()=>{var e,i,s;const a=(s=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(br))===null||i===void 0?void 0:i.getSelectedObject())===null||s===void 0?void 0:s.material;return!!Array.isArray(a)||(a==null?void 0:a.typeSlug)!==jo.TypeSlug},value:async()=>{var e,i,s,a,h,d;const b=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(br))===null||i===void 0?void 0:i.getSelectedObject();if(!(b!=null&&b.material))return;const X=await((s=this._viewer)===null||s===void 0?void 0:s.prompt("Cache key: Enter optional cache key unique to the diamond shape.","",!1));let $=parseInt(await((a=this._viewer)===null||a===void 0?void 0:a.prompt("Cache size: Enter size of the cache [64-1024]","512",!1))||"512");isFinite($)||($=512),$<64&&($=64),((h=b.material.userData)===null||h===void 0?void 0:h.__appliedMeshes.size)>1&&await((d=this._viewer)===null||d===void 0?void 0:d.confirm("Convert all: Apply diamond material to all the meshes with the same material?"))?this.makeDiamond(b.material,{cacheKey:X||void 0,normalMapRes:$},{}):this.makeDiamondMesh(b,{cacheKey:X||void 0,normalMapRes:$},{}),this.refreshUi()},limitedUi:!0},{type:"button",label:"Make Standard",hidden:()=>{var e,i,s;const a=(s=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(br))===null||i===void 0?void 0:i.getSelectedObject())===null||s===void 0?void 0:s.material;return!!Array.isArray(a)||(a==null?void 0:a.typeSlug)!==hs.TypeSlug},value:async()=>{var e,i,s,a,h,d,b,X;const $=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(br))===null||i===void 0?void 0:i.getSelectedObject(),Z=$==null?void 0:$.material;if(!Z)return;const re=Z.userData._baseMaterial;let le=(h=(a=(s=this._viewer)===null||s===void 0?void 0:s.getManager())===null||a===void 0?void 0:a.materials)===null||h===void 0?void 0:h.findMaterial(re);if(le&&!le.isDiamondMaterial||(le=(d=this._viewer)===null||d===void 0?void 0:d.createPhysicalMaterial({color:Z.color})),le){const he=Z.userData.__appliedMeshes.size>1&&await((b=this._viewer)===null||b===void 0?void 0:b.confirm("Convert all with this material?"))?Array.from(Z.userData.__appliedMeshes):[$];for(const fe of he)(X=fe==null?void 0:fe.setMaterial)===null||X===void 0||X.call(fe,le)}this.refreshUi()},limitedUi:!0}]},this.refreshEnvMaps=this.refreshEnvMaps.bind(this),this.refreshUi=this.refreshUi.bind(this)}get envMapRotation(){var e,i;return(i=(e=this.envMap)===null||e===void 0?void 0:e.rotation)!==null&&i!==void 0?i:0}set envMapRotation(e){var i;const s=this.envMap;s&&(s.rotation=e,(i=this._viewer)===null||i===void 0||i.scene.setDirty())}refreshEnvMaps(){var e,i,s;if(!this._viewer)return;const a=this.getEnvMap(),h=((i=(e=this._viewer.getPlugin(Kn))===null||e===void 0?void 0:e.materials)===null||i===void 0?void 0:i.getMaterialsOfType(hs.TypeSlug))||[];for(const d of h)d&&d.envMap!==a&&(d.envMap=a,d.needsUpdate=!0);(s=this._viewer)===null||s===void 0||s.scene.setDirty()}refreshUi(){var e,i,s;(e=this._viewer)===null||e===void 0||e.setDirty(),(s=(i=this.uiConfig)===null||i===void 0?void 0:i.uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)}async onAdded(e){var i,s,a,h,d,b;this._normalCapture=new UA(e.renderer),this.offsetCache={},e.scene.addEventListener("environmentChanged",this.refreshEnvMaps);const X=e.getPlugin(Kn);(i=X==null?void 0:X.importer)===null||i===void 0||i.processors.add("model",this._modelProcessor),(s=e.getPlugin(br))===null||s===void 0||s.addEventListener("selectedObjectChanged",this.refreshUi);const $=this.getEnvMap,Z=new _s(class extends va{async loadAsync(re,le){var he;const fe=await super.loadAsync(re,le);return fe.type===hs.TYPE||fe.isDiamondMaterialParameters?(fe.envMap=$(),(he=X==null?void 0:X.materials)===null||he===void 0?void 0:he.generateFromTemplate("diamond",fe)):(console.error("Invalid material type for Diamond Material.",fe),null)}},[hs.TypeSlug],!1);return yr.Importers.push(Z),(d=(h=(a=X==null?void 0:X.exporter)===null||a===void 0?void 0:a.getExporter("gltf","glb"))===null||h===void 0?void 0:h.extensions)===null||d===void 0||d.push(o_),(b=X==null?void 0:X.materials)===null||b===void 0||b.registerMaterialTemplate({name:"diamond",materialType:hs.TYPE,isDiamondMaterialParameters:!0,generator:(re,le)=>{const he=new hs(re);return he.envMap=$(),le&&le!=={}&&he.copyProps(le),he}}),super.onAdded(e)}async onRemove(e){var i,s,a,h;return(i=this._normalCapture)===null||i===void 0||i.dispose(),this._normalCapture=void 0,this.offsetCache={},(a=(s=e.getPlugin(Kn))===null||s===void 0?void 0:s.importer)===null||a===void 0||a.processors.remove("model",this._modelProcessor),(h=e.getPlugin(br))===null||h===void 0||h.removeEventListener("selectedObjectChanged",this.refreshUi),super.onRemove(e)}prepareDiamondMesh(e,{cacheKey:i,normalMapRes:s}){var a,h,d;e.userData._diamondCacheKey=i??e.userData._diamondCacheKey,e.userData._diamondNormalMapRes=s??e.userData._diamondNormalMapRes,i=i&&i.length>0?i.includes(";"+e.geometry.uuid)?i:i+";"+e.geometry.uuid:e.geometry.uuid,this._computeOffsets(e.geometry,e.geometry.uuid);const b=(h=(a=this._normalCapture)===null||a===void 0?void 0:a.captureNormalMap(e.geometry,i,s))!==null&&h!==void 0?h:[void 0,!1],X=(d=this._viewer)===null||d===void 0?void 0:d.getPluginByType("debug");X&&b&&(X.counters.normalsCapture||(X.counters.normalsCapture=0),X.counters.normalsCapture++,console.log("DEBUG: new normal map captured",X.counters.normalsCapture,i),X.addTexture("normal"+X.counters.normalsCapture,()=>{var $;return($=e.geometry.userData._normalsCaptureMap)===null||$===void 0?void 0:$.texture},[40,110*X.counters.normalsCapture-100,200,100],void 0,void 0,"postRender",!0))}makeDiamond(e,i,s){var a,h;Array.from((a=e==null?void 0:e.userData.__appliedMeshes)!==null&&a!==void 0?a:[]).forEach(d=>{d!=null&&d.isMesh&&d.geometry&&this.prepareDiamondMesh(d,i)}),this._convertToDiamondMaterial(e,s),(h=this._viewer)===null||h===void 0||h.setDirty()}makeDiamondMesh(e,i,s){if(!e.modelObject.isMesh||!e.geometry||!e.setMaterial)return;this.prepareDiamondMesh(e.modelObject,i);const a=Array.isArray(e.material)?e.material[0]:e.material,h=this._convertToDiamondMaterial(a,s,!1);e.setMaterial(h)}_convertToDiamondMaterial(e,i={isDiamond:!0},s=!0){var a,h,d,b,X,$,Z;let re={...i??{}};re.isDiamond||re.isDiamondMaterialParameters?Array.isArray(re.boostFactors)&&(re.boostFactors=new _.Pa4().fromArray(re.boostFactors)):re={isDiamondMaterialParameters:!0},re.color=(d=(a=re.color)!==null&&a!==void 0?a:(h=e==null?void 0:e.materialObject)===null||h===void 0?void 0:h.color)!==null&&d!==void 0?d:new oi(1,1,1);const le=($=(X=(b=this._viewer)===null||b===void 0?void 0:b.getManager())===null||X===void 0?void 0:X.materials)===null||$===void 0?void 0:$.generateFromTemplate("diamond",re);if(le&&e&&!e.isDiamondMaterial&&(le.userData._baseMaterial=e.uuid),s){const he=fe=>{var me;return(me=fe.setMaterial)!==null&&me!==void 0?me:Ee=>{fe.material=Ee.materialObject}};Array.from((Z=e==null?void 0:e.userData.__appliedMeshes)!==null&&Z!==void 0?Z:[]).forEach(fe=>{he(fe)(le),this.prepareDiamondMesh(fe,i)})}return le}_computeOffsets(e,i,s=!1){const a=i.split(";").find($=>this.offsetCache[$]);if(a&&!s){const $=this.offsetCache[a];return i.split(";").forEach(Z=>Z!==a&&(this.offsetCache[Z]=$)),e.userData._normalsCaptureOffsets=$,$}e.computeBoundingBox();const h=e.boundingBox.getCenter(new _.Pa4),d=zA(e),b=d.clone().invert(),X={center:h,offsetMatrix:d,offsetMatrixInv:b,radius:1,centerOffset:new _.Pa4().copy(h).applyMatrix4(b)};return i.split(";").forEach($=>this.offsetCache[$]=X),e.userData._normalsCaptureOffsets=X,X}}zs.PluginType="Diamond",zs.DIAMOND_GLTF_EXTENSION="WEBGI_materials_diamond",Qp([lt(zs.prototype.refreshEnvMaps),kt()],zs.prototype,"envMap",void 0),Qp([lt(zs.prototype.refreshEnvMaps),kt()],zs.prototype,"forceSceneEnvMap",void 0);const o_=c=>({writeMaterial:(e,i)=>{e.isDiamondMaterial&&(i.extensions=i.extensions||{},i.extensions[zs.DIAMOND_GLTF_EXTENSION]=e.toJSON(),c.extensionsUsed[zs.DIAMOND_GLTF_EXTENSION]=!0)},writeMesh:(e,i)=>{var s,a;if(!(e!=null&&e.material.isDiamondMaterial))return;i.extensions=i.extensions||{};const h={};(a=(s=e.userData)===null||s===void 0?void 0:s.gltfExtensions)===null||a===void 0||delete a[zs.DIAMOND_GLTF_EXTENSION],e.userData._diamondNormalMapRes&&(h.normalMapRes=e.userData._diamondNormalMapRes),e.userData._diamondCacheKey&&(h.cacheKey=e.userData._diamondCacheKey),i.extensions[zs.DIAMOND_GLTF_EXTENSION]=h,c.extensionsUsed[zs.DIAMOND_GLTF_EXTENSION]=!0}});var oc,aa=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Os=oc=class extends Xi{constructor(){super(),this.enabled=!0,this.animations=[],this.loopAnimations=!0,this.loopRepetitions=1/0,this.timeScale=0,this.animateOnScroll=!1,this.animationSpeed=1,this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this.dependencies=[Kn],this._lastFrameTime=0,this._fadeDisabled=!1,this._objectAdded=c=>{const e=c.object;e.assetType==="model"&&e.modelObject&&this._viewer&&e.modelObject.traverse(i=>{const s=i.animations;if(s.length<1)return;const a=Math.max(...s.map(b=>b.duration));s.forEach(b=>b.duration=a);const h=new _.Xcj(this._viewer.scene.modelRoot.modelObject),d=s.map(b=>h.clipAction(b).setLoop(this.loopAnimations?_.YKA:_.jAl,this.loopRepetitions));this.animations.push({mixer:h,clips:s,actions:d,duration:a}),this.onPropertyChange()})},this._animationTime=0,this._animationDuration=0,this._animationState="none",this.uiConfig=void 0,this._lastAnimId="",this.timelineMarkers=[],this._postFrame=this._postFrame.bind(this),this._wheel=this._wheel.bind(this),this.playClips=this.playClips.bind(this),this.playClip=this.playClip.bind(this),this.playAnimation=this.playAnimation.bind(this),this.playPauseAnimation=this.playPauseAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.stopAnimation=this.stopAnimation.bind(this),this.resetAnimation=this.resetAnimation.bind(this),this.onPropertyChange=this.onPropertyChange.bind(this),this._loaderCreate=this._loaderCreate.bind(this)}get animationState(){return this._animationState}get animationTime(){return this._animationTime}get animationDuration(){return this._animationDuration}_wheel({deltaY:c}){this.enabled&&Math.abs(c)>.001&&(this._scrollAnimationState=-1*Math.sign(c))}_postFrame(){var c,e;if(!this._viewer)return;const i=this._viewer,s=this.animateOnScroll;if(!this.enabled||this.animations.length<1||this._animationState!=="playing"&&!s)return this._lastFrameTime=0,void(this._fadeDisabled&&((c=this._viewer.getPluginByType("FrameFade"))===null||c===void 0||c.enable(oc.PluginType),this._fadeDisabled=!1));this._animationTime<1e-4&&this.dispatchEvent({type:"checkpointBegin"});const a=ia()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=a-1/30);let h=a-this._lastFrameTime;if(h*=this.animationSpeed,this._lastFrameTime=a,s&&(h*=this._scrollAnimationState),Math.abs(h)<1e-4)return;const d=(e=this._viewer.getPluginByType("Progressive"))===null||e===void 0?void 0:e.postFrameConvergedRecordingDelta();if(d&&d>0&&(h=d),d!==0){if(this.animations.map(b=>b.mixer.update(h)),this._animationTime+=h,this._scrollAnimationState<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,i.scene.activeCamera.cameraObject.userData.__animatingCamera&&i.scene.activeCamera.setDirty(),i.renderer.resetShadows(),i.setDirty(),!this._fadeDisabled){const b=this._viewer.getPluginByType("FrameFade");b&&(b.disable(oc.PluginType),this._fadeDisabled=!0)}this._animationTime>=this._animationDuration&&this.dispatchEvent({type:"checkpointEnd"})}}_loaderCreate({loader:c}){c.isGLTFLoader2&&c.register(e=>new kd(e,this))}async onAdded(c){var e,i,s,a,h,d;(i=(e=c.getPlugin(Kn))===null||e===void 0?void 0:e.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),c.scene.addEventListener("addSceneObject",this._objectAdded),(d=(h=(a=(s=c.getPlugin(Kn))===null||s===void 0?void 0:s.exporter)===null||a===void 0?void 0:a.getExporter("gltf","glb"))===null||h===void 0?void 0:h.extensions)===null||d===void 0||d.push(_y),c.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel);let b=-1;return Object.defineProperty(c.scene.modelRoot,"currentTimelineMarker",{get:()=>b,set:X=>c.scene.modelRoot.dispatchEvent({type:"animationTimelineMarker",marker:this.timelineMarkers[b=X]})}),c.scene.modelRoot.addEventListener("animationTimelineMarker",({marker:X})=>{var $;if(!this._viewer)return;if(!X)return this._viewer.scene.activeCamera=($=this._viewer)===null||$===void 0?void 0:$.scene.defaultCamera,void this._viewer.setDirty();const Z=X.camera;Z&&(Z.userData.__animatingCamera=!0,this._viewer.scene.activeCamera=this._viewer.createCamera(Z))}),super.onAdded(c)}async onRemove(c){for(var e,i;this.animations.length;)this.animations.pop();return c.scene.removeEventListener("addSceneObject",this._objectAdded),(i=(e=c.getPlugin(Kn))===null||e===void 0?void 0:e.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),c.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),super.onRemove(c)}onPropertyChange(){this._animationState==="playing"&&this.playAnimation(),this._animationDuration=Math.max(...this.animations.map(({duration:c})=>c))*(this.loopAnimations?this.loopRepetitions:1)}onStateChange(){var c,e;(e=(c=this.uiConfig)===null||c===void 0?void 0:c.children)===null||e===void 0||e.map(i=>i&&st(i)).flat(2).forEach(i=>{var s;return(s=i==null?void 0:i.uiRefresh)===null||s===void 0?void 0:s.call(i)})}playPauseAnimation(){this._animationState==="playing"?this.pauseAnimation():this.playAnimation()}async playClip(c,e=!1){return this.playClips([c],e)}async playClips(c,e=!1){const i=[];return this.animations.forEach(({actions:s})=>{s.forEach(a=>{c.includes(a.getClip().name)&&i.push(a)})}),this.playAnimation(e,i)}async playAnimation(c=!1,e){var i;if(!this.enabled)return;this._animationState==="playing"&&this.stopAnimation(!1);let s=0;const a=!e;e||(e=[],this.animations.forEach(({mixer:d,actions:b,clips:X})=>{e.push(...b)})),this._animationState!=="paused"&&this.resetAnimation();const h=Ms();this._lastAnimId=h;for(const d of e)this.timeScale>0&&(d.timeScale=this.timeScale),d.setLoop(this.loopAnimations?_.YKA:_.jAl,this.loopRepetitions),d.play(),s=Math.max(s,d.getClip().duration/d.timeScale);if(this._animationState="playing",(i=this._viewer)===null||i===void 0||i.setDirty(),a){if(!isFinite(this._animationDuration))return;await new Promise((d,b)=>{const X=()=>{this.removeEventListener("checkpointEnd",X),d()};this.addEventListener("checkpointEnd",X)})}else{if(s*=this.loopAnimations?this.loopRepetitions:1,s/=this.animationSpeed,!isFinite(s))return;const d=1e3*s-this._animationTime/this.animationSpeed+.01;d>0&&await eo(d)}h===this._lastAnimId&&this.stopAnimation(c)}pauseAnimation(){var c;this._animationState="paused",(c=this._viewer)===null||c===void 0||c.setDirty()}stopAnimation(c=!1){var e,i;this._animationState="stopped",c?this.resetAnimation():(e=this._viewer)===null||e===void 0||e.setDirty(),this._lastAnimId="",this._viewer&&this._fadeDisabled&&((i=this._viewer.getPluginByType("FrameFade"))===null||i===void 0||i.enable(oc.PluginType),this._fadeDisabled=!1)}resetAnimation(){var c;this._animationState==="stopped"||this._animationState==="none"?(this.animations.forEach(({mixer:e,actions:i,clips:s})=>{e.stopAllAction(),e.setTime(0)}),this._animationTime=0,(c=this._viewer)===null||c===void 0||c.setDirty()):this.stopAnimation(!0)}};Os.PluginType="GLTFAnimation",Os.AnimationMarkersExtension="WEBGI_animation_markers",aa([Ha()],Os.prototype,"animationState",null),aa([Ha()],Os.prototype,"animationTime",null),aa([Ha()],Os.prototype,"animationDuration",null),aa([lt(oc.prototype.onPropertyChange),Xn("Loop",{limitedUi:!0})],Os.prototype,"loopAnimations",void 0),aa([lt(oc.prototype.onPropertyChange)],Os.prototype,"loopRepetitions",void 0),aa([lt(oc.prototype.onPropertyChange)],Os.prototype,"timeScale",void 0),aa([Xn(),kt()],Os.prototype,"animateOnScroll",void 0),aa([ai("Speed",[.1,4],.1,{limitedUi:!0}),kt()],Os.prototype,"animationSpeed",void 0),aa([lt(oc.prototype.onStateChange)],Os.prototype,"_animationState",void 0),aa([lr("Play/Pause",c=>({label:()=>c.animationState==="playing"?"Pause":"Play",limitedUi:!0}))],Os.prototype,"playPauseAnimation",null),aa([lr("Stop",{limitedUi:!0})],Os.prototype,"stopAnimation",null),aa([lr("Reset",{limitedUi:!0})],Os.prototype,"resetAnimation",null),Os=oc=aa([ur("GLTF Animations")],Os);class kd{constructor(e,i){this.parser=e,this.name=Os.AnimationMarkersExtension,this.plugin=i}async afterRoot(e){var i;let s=[];for(const le of this.parser.json.scenes){if(!le.extensions)continue;const he=le.extensions[this.name];for(const fe of(he==null?void 0:he.markers)||[]){const me=fe.camera!==void 0?await this.parser.getDependency("camera",fe.camera):void 0;fe.time===void 0&&(fe.time=fe.frame/30,console.error("Update timeline markers plugin for correct times.")),s.push({name:fe.name,frame:fe.frame,time:fe.time,camera:me})}}if(s.length<1)return;s=s.sort((le,he)=>le.frame-he.frame);const a=(i=e.scene)!==null&&i!==void 0?i:e.scenes[0];if(!a)return;a.userData.__markers=s;const h=this.plugin.timelineMarkers,d=s.map(le=>le.time);let b=h.length;const X=s.map(le=>b++),$=Math.max(...d)+.01;h.push(...s);const Z=new _.dUE(".currentTimelineMarker",d,X,2300),re=new _.m7l("animationTimelineMarker",$,[Z]);re.__gltfExport=!1,e.animations.push(re)}}const _y=c=>({afterParse(e){const i=c.json.scenes[c.json.scene||0];i.extensions=i.extensions||{};const s={markers:[]},a=[];if((Array.isArray(e)?e:[e]).forEach(h=>h.traverse(d=>{d.userData.__markers&&a.push(...d.userData.__markers)})),a.sort((h,d)=>h.frame-d.frame),!(a.length<1)){for(const h of a){const d=h.camera;if(d){const b=c.nodeMap.get(d);if(b===void 0){console.warn("Camera not found in gltf export",d,c.nodeMap);continue}const X=c.json.nodes[b].camera;h.camera=X,s.markers.push(h)}}i.extensions[Os.AnimationMarkersExtension]=s,c.extensionsUsed[Os.AnimationMarkersExtension]=!0}}});class Ma extends oe{constructor(){super(...arguments),this.dirty=!1,this.counters={},this._generators=new Map,this._preRender=()=>this._showDebug("preRender"),this._postRender=()=>this._showDebug("postRender")}async onAdded(e){this._viewer=e,e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender)}addTexture(e,i,s,a,h,d="postRender",b=!1){var X;this._generators.has(d)||this._generators.set(d,[]),(X=this._generators.get(d))===null||X===void 0||X.push({key:e,fn:i,rect:s?[...s]:void 0,frag:h||a||b?new _.jyz({vertexShader:ae.vertexShader,uniforms:{tDiffuse:{value:null},opacity:{value:1}},fragmentShader:h??`
        #include <common>
        #include <packing>
        uniform float opacity;
		uniform ${b?"samplerCube":"sampler2D"} tDiffuse;
		varying vec2 vUv;
		void main() {
			vec4 texel = ${b?"textureCube( tDiffuse, vec3(cos(vUv.y * PI2) * cos(vUv.x * PI2), sin(vUv.y * PI2), cos(vUv.y * PI2) * sin(vUv.x * PI2)) )":"texture2D( tDiffuse, vUv )"};
			${a??""}
			gl_FragColor = opacity * texel;
		}
            `}):void 0})}removeTexture(e,i="postRender"){var s,a;this._generators.set(i,(a=(s=this._generators.get(i))===null||s===void 0?void 0:s.filter(h=>h.key!==e))!==null&&a!==void 0?a:[])}async onDispose(e){return Promise.resolve(void 0)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),this._viewer=void 0,Promise.resolve(void 0)}_showDebug(e){var i;const s=this._viewer,a=s==null?void 0:s.renderer;a&&s&&((i=this._generators.get(e))===null||i===void 0||i.forEach(({key:h,fn:d,rect:b,frag:X})=>{const $=d(s);if($){if($.image&&b){const Z=$.image.width/$.image.height;b[2]<1&&b[3]<1&&(b[2]=200),b[2]<1&&(b[2]=b[3]*Z),b[3]<1&&(b[3]=b[2]/Z)}a.blit($,void 0,{viewport:b,clear:!1,material:X})}}))}}Ma.PluginType="debug";var Od=function(c,e){return Od=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(i[a]=s[a])},Od(c,e)};function p0(c,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=c}Od(c,e),c.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var f0,m0=function(){function c(){}return c._xfnv1a=function(e){for(var i=2166136261,s=0;s<e.length;s++)i=Math.imul(i^e.charCodeAt(s),16777619);return function(){return i+=i<<13,i^=i>>>7,i+=i<<3,i^=i>>>17,(i+=i<<5)>>>0}},c}(),ax=function(c){function e(i){var s=c.call(this)||this;return s.a=e._xfnv1a(i)(),s}return p0(e,c),e.prototype.next=function(){var i=this.a+=1831565813;return i=Math.imul(i^i>>>15,1|i),(((i^=i+Math.imul(i^i>>>7,61|i))^i>>>14)>>>0)/4294967296},e}(m0),lx=function(c){function e(i){var s=c.call(this)||this,a=e._xfnv1a(i);return s.a=a(),s.b=a(),s.c=a(),s.d=a(),s}return p0(e,c),e.prototype.next=function(){this.a>>>=0,this.b>>>=0,this.c>>>=0,this.d>>>=0;var i=this.a+this.b|0;return this.a=this.b^this.b>>>9,this.b=this.c+(this.c<<3)|0,this.c=this.c<<21|this.c>>>11,this.d=this.d+1|0,i=i+this.d|0,this.c=this.c+i|0,(i>>>0)/4294967296},e}(m0),cx=function(c){function e(i){var s=c.call(this)||this,a=e._xfnv1a(i);return s.a=a(),s.b=a(),s.c=a(),s.d=a(),s}return p0(e,c),e.prototype.next=function(){var i=this.b<<9,s=5*this.a;return s=s<<7|9*(s>>>25),this.c^=this.a,this.d^=this.b,this.b^=this.c,this.a^=this.d,this.c^=i,this.d=this.d<<11|this.d>>>21,(s>>>0)/4294967296},e}(m0);(function(c){c.sfc32="sfc32",c.mulberry32="mulberry32",c.xoshiro128ss="xoshiro128ss"})(f0||(f0={}));var ux=function(){function c(e,i){i===void 0&&(i=f0.sfc32),this.str=e,this.prng=i,this.generator=this._initializeGenerator()}return c.prototype.next=function(){return this.generator.next()},c.prototype._initializeGenerator=function(){if(function(i){return i===null}(e=this.str)||function(i){return i===void 0}(e))return this.wrap();var e;switch(this.prng){case"sfc32":return new lx(this.str);case"mulberry32":return new ax(this.str);case"xoshiro128ss":return new cx(this.str);default:return this.wrap()}},c.prototype.wrap=function(){return{next:function(){return Math.random()}}},c}(),a_=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class um extends Ad{constructor(e,i,s,a){super(e,i),this._shadowParams={enabled:!0,radius:2,width:1024,height:1024,bias:-.001,normalBias:0,near:1.5,far:4,frustumSize:4},this._randomParams={focus:1,spread:.01,distanceScale:50,minDistanceScale:new _.Pa4(10,10,10),normalDirection:new _.Pa4(.01,.98,.01).normalize(),direction:new _.Pa4(-.9,.5,-1)},this.isRandomizedDirectionalLight=!0,this.shadowParams=s??{},this.randomParams=a??{},this.updateShadowParams=this.updateShadowParams.bind(this)}get shadowParams(){return this._shadowParams}set shadowParams(e){Object.keys(e).forEach(i=>e[i]===void 0&&delete e[i]),this._shadowParams={...this._shadowParams,...e},this.updateShadowParams()}get randomParams(){return this._randomParams}set randomParams(e){Object.keys(e).forEach(i=>e[i]===void 0&&delete e[i]),Object.assign(this._randomParams,e)}updateShadowParams(){this.castShadow=this._shadowParams.enabled,this.shadow.mapSize.x=this._shadowParams.width,this.shadow.mapSize.y=this._shadowParams.height,this.shadow.bias=this._shadowParams.bias,this.shadow.normalBias=this._shadowParams.normalBias,this.refreshShadowCamNearFar(),this.shadow.radius=this._shadowParams.radius,this.shadow.camera.right=this._shadowParams.frustumSize/2,this.shadow.camera.left=-this._shadowParams.frustumSize/2,this.shadow.camera.top=this._shadowParams.frustumSize/2,this.shadow.camera.bottom=-this._shadowParams.frustumSize/2,this.shadow.camera.updateProjectionMatrix(),this.matrixWorldNeedsUpdate=!0}randomizePosition(e,i=null,s=null){const a=new ux(e.toString()),h=new _.FM8(a.next()*Math.PI*2,Math.asin(2*a.next()-1));let d=new _.Pa4(Math.cos(h.x)*Math.cos(h.y),Math.sin(h.y),Math.sin(h.x)*Math.cos(h.y));const b=new _.FM8;for(let X=0;X<5;X++){b.set(a.next(),a.next()),d=Ld(b,this._randomParams.normalDirection,.4),a.next()<Math.sqrt(i??this._randomParams.focus)&&(b.set(a.next(),a.next()),d=Ld(b,this._randomParams.direction,Math.pow((s??this._randomParams.spread)/2,2)));const $=d.dot(this._randomParams.normalDirection);if($>0&&$<.4)break}d.normalize(),d.multiplyScalar(this._randomParams.distanceScale),this.position.set(0,0,0),this.target.position.copy(d.normalize().negate()),this.target.updateMatrixWorld(),this.refreshShadowCamNearFar(),this.updateMatrixWorld()}refreshShadowCamNearFar(){const e=new _.Pa4().subVectors(this.target.position,this.shadow.camera.position).length();this.shadow.camera.near=e-this._shadowParams.near*this._shadowParams.frustumSize/2,this.shadow.camera.far=e+this._shadowParams.far*this._shadowParams.frustumSize/2}dispose(){}get uiConfig(){if(this._uiConfig)return this._uiConfig}fromJSON(e,i){return super.fromJSON(e,i)?(this.updateShadowParams(),this):null}}function Ld(c,e,i){e=e.clone().normalize();const s=new _.Pa4(0,-e.z,e.y).normalize(),a=new _.Pa4().crossVectors(e,s).normalize(),h=c;h.x=2*h.x*Math.PI,h.y=1-h.y*i;const d=Math.sqrt(1-h.y*h.y);return s.multiplyScalar(Math.cos(h.x)*d).add(a.multiplyScalar(Math.sin(h.x)*d)).add(e.multiplyScalar(h.y))}a_([kt("shadowParams")],um.prototype,"_shadowParams",void 0),a_([kt("randomParams")],um.prototype,"_randomParams",void 0);class g0 extends _.Tn7{constructor(){super(...arguments),this.typeSlug="fsShadow",this.assetType="material",this._uniforms={},this.lastFrameTexture=null}get materialObject(){return this}onBeforeCompile(e,i){e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`
#include <project_vertex>
gl_Position = vec4(uv*2.-1., 0, 1.); 
        `),e.vertexShader=e.vertexShader.replace("void main() {",`
varying vec2 vUv;
void main() {
    vUv = uv;
        `),e.fragmentShader=e.fragmentShader.replace("void main() {",`
varying vec2 vUv;
uniform sampler2D tLastThis;
void main() {
        `),e.fragmentShader=e.fragmentShader.replace("gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );",Ne`
float shadow = getShadowMask();

//shift the color by dither_shift
shadow = clamp(shadow + mix(-1./512., 1./512., rand( gl_FragCoord.xy )), 0., 1.);

float last = unpackRGBAToDepth(texture2D(tLastThis, vUv));
gl_FragColor = packDepthToRGBA(mix(last, shadow, opacity));
//if not useMovingAverage:
//gl_FragColor = packDepthToRGBA(shadow * opacity + last);
        `),Object.assign(e.uniforms,this._uniforms),super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,i){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}(function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);h>3&&d&&Object.defineProperty(e,i,d)})([ot({propKey:"tLastThis"})],g0.prototype,"lastFrameTexture",void 0);var As=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class Va{constructor(e){this.enabled=!0,this._lightLayer=5,this._frameNumber=0,this.maxFrameNumber=400,this.groundMapMode="aoMap",this.alphaVignette=!0,this.alphaVignetteAxis="xy",this.shadowAutoUpdate=!0,this.materialExtension={shaderExtender:(s,a,h)=>{this.groundMapMode==="aoMap"?s.fragmentShader=gs(s.fragmentShader,"#include <aomap_fragment>",gs(_.WdD.aomap_fragment,"float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;","float ambientOcclusion = ( unpackRGBAToDepth(texture2D( aoMap, vUv2 ) ) - 1.0) * aoMapIntensity + 1.0;")):this.groundMapMode==="map"?s.fragmentShader=gs(s.fragmentShader,"#include <map_fragment>",gs(_.WdD.map_fragment,"diffuseColor *= sampledDiffuseColor;","float groundShadow = unpackRGBAToDepth(sampledDiffuseColor); diffuseColor.rgb *= groundShadow; diffuseColor.a *= max(0., 1.-groundShadow);")):this.groundMapMode==="alphaMap"&&(s.fragmentShader=gs(s.fragmentShader,"#include <alphamap_fragment>",gs(_.WdD.alphamap_fragment,"texture2D( alphaMap, vUv ).g","1. - unpackRGBAToDepth( texture2D( alphaMap, vUv ) )",{replaceAll:!0}))),this.alphaVignette&&h.capabilities.isWebGL2&&(s.fragmentShader=gs(s.fragmentShader,"#include <output_fragment>",Ne`#include <output_fragment>
                    #ifndef OPAQUE
                    float weight = 0.;
                    #ifdef USE_UV
                    weight = 2.*abs(length(0.5 - vUv.${this.alphaVignetteAxis}));
                    #endif
                    #if defined(USE_LIGHTMAP) || defined(USE_AOMAP)
                    weight = 2.*abs(length(0.5 - vUv2.${this.alphaVignetteAxis}));
                    #endif
                    weight = min(1., max(0., weight))-0.5;
                    weight = min(1., max(0., 1.0-2.*weight));
                    weight = pow(weight, 1.5);
                    gl_FragColor.a *= weight;
                    //gl_FragColor.rgb /= max(0.01, weight);
                    gl_FragColor = saturate(gl_FragColor);
                    //gl_FragColor.a = 0.5;
                    #endif
                    `))},computeCacheKey:()=>this.groundMapMode+"."+this.alphaVignette+"."+this.alphaVignetteAxis,onObjectRender:(s,a)=>{a.materialObject.userData.gMapMode!==this.groundMapMode&&(a.materialObject.userData.gMapMode=this.groundMapMode,a.materialObject.needsUpdate=!0)},isCompatible:s=>s.isMeshStandardMaterial2},this._viewer=e;const i=new um(16777215,10,{near:1.5,far:20,bias:0,frustumSize:4,width:1024,height:1024,enabled:!0,radius:10,normalBias:0},{direction:new _.Pa4(.2,1,.2).normalize(),spread:.9,focus:1,distanceScale:20,minDistanceScale:new _.Pa4(10,10,10),normalDirection:new _.Pa4(0,1,0)});i.shadow.camera.updateProjectionMatrix(),i.layers.disableAll(),i.layers.set(this._lightLayer),this._light=i,e.scene.addLight(this._light,{addToRoot:!0}),this._shadowMat=new g0({color:"#ffffff",toneMapped:!1,depthWrite:!1,depthTest:!1,premultipliedAlpha:!1,opacity:1,transparent:!1,blending:_.jFi})}get attachedMesh(){return this._attachedMesh}set attachedMesh(e){this._attachedMesh!==e&&(this._attachedMesh&&this.cleanupMaterial(),this._attachedMesh=e,this._attachedMesh&&this._updateMaterial())}get target(){return this._target}get light(){return this._light}dispose(){this._shadowMat.dispose(),this._target=void 0,this.reset()}cleanupMaterial(){this._updateMaterial(!0)}_groundMapModeChanged(){this._attachedMesh&&(this.cleanupMaterial(),this._updateMaterial(),this.groundMapMode==="alphaMap"?this._attachedMesh.material.transparent=!0:this._attachedMesh.material.transparent=!1),this.reset()}_alphaVignetteChanged(){var e,i,s;(i=(e=this.materialExtension)===null||e===void 0?void 0:e.setDirty)===null||i===void 0||i.call(e),(s=this._viewer)===null||s===void 0||s.setDirty()}fromJSON(e,i){return bn(e,this,!0,i),this.reset(),this}reset(){this._frameNumber=0}autoUpdateShadow(){this.shadowAutoUpdate&&this.updateShadow()}updateShadow(){if(!this.enabled)return!1;const e=this._attachedMesh;if(++this._frameNumber>this.maxFrameNumber||!e)return!1;const i=1024;this._target||(this._target=this._viewer.renderer.createTarget({type:_.ywz,depthBuffer:!1,size:new _.FM8(i,i),sizeMultiplier:void 0,encoding:_.rnI,format:_.wk1})),this._frameNumber<3?this._light.randomizePosition(0,1,0):this._light.randomizePosition(this._frameNumber),e.castShadow=!1;const s=this._viewer.renderer.rendererObject,a=s.shadowMap,h=a.type,d=a.needsUpdate,b=a.autoUpdate;a.type=_._MY,a.needsUpdate=!0,a.autoUpdate=!1;const X=this._viewer.scene,$=new _.S9g;$.disableAll(),X.modelObject.traverse(fe=>{fe.isLight&&fe!==this._light.lightObject&&(fe.userData.__gp_layers=fe.layers,fe.layers=$)});const Z=X.activeCamera.cameraObject;if(Z.layers.mask&1<<this._lightLayer)throw"Camera can render pseudo directional light, check layers";Z.layers.enable(this._lightLayer),e.layers.disable(this._lightLayer),Rn(s,{shadowMapRender:!0,backgroundRender:!1,sceneRender:!1},()=>this._viewer.renderer.renderScene(X)),Z.layers.disable(this._lightLayer);const re=Z.layers.mask;Z.layers.set(this._lightLayer),e.layers.enable(this._lightLayer);const le=this._viewer.renderer.getTempTarget({type:_.ywz,depthBuffer:!1,size:new _.FM8(i,i),encoding:_.rnI,format:_.wk1}),he=le.texture.encoding;le.texture.encoding=_.rnI,this._viewer.renderer.blit(this._target.texture,le,{clear:!0});{const fe=X.modelObject.environment,me=X.modelObject.background,Ee=e.material,Ae=e.frustumCulled,ye=s.getRenderTarget(),ge=s.getActiveCubeFace(),Pe=s.getActiveMipmapLevel();X.modelObject.background=null,X.modelObject.environment=null,e.material=this._shadowMat,e.frustumCulled=!1,s.setRenderTarget(this._target),this._shadowMat.opacity=Math.max(1/this.maxFrameNumber,1/this._frameNumber),this._shadowMat.lastFrameTexture=le.texture,this._shadowMat.needsUpdate=!0,Rn(s,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},()=>this._viewer.renderer.renderScene(X)),s.setRenderTarget(ye,ge,Pe),e.frustumCulled=Ae,e.material=Ee,X.modelObject.environment=fe,X.modelObject.background=me}return le.texture.encoding=he,this._viewer.renderer.releaseTempTarget(le),e.layers.disable(this._lightLayer),Z.layers.mask=re,X.modelObject.traverse(fe=>{fe.isLight&&fe!==this._light.lightObject&&(fe.layers=fe.userData.__gp_layers,delete fe.userData.__gp_layers)}),a.type=h,a.needsUpdate=d,a.autoUpdate=b,e.castShadow=!0,(this._frameNumber<2||this._frameNumber>Math.min(30,this.maxFrameNumber)&&this._frameNumber%150==0)&&(this._updateMaterial(),this._viewer.setDirty(),e.dispatchEvent({type:"materialUpdate"})),!0}_updateMaterial(e=!1){var i,s,a;this._attachedMesh&&(e?(this._attachedMesh.material.alphaMap===((i=this._target)===null||i===void 0?void 0:i.texture)&&(this._attachedMesh.material.alphaMap=null),this._attachedMesh.material.aoMap===((s=this._target)===null||s===void 0?void 0:s.texture)&&(this._attachedMesh.material.aoMap=null),this._attachedMesh.material.map===((a=this._target)===null||a===void 0?void 0:a.texture)&&(this._attachedMesh.material.map=null)):this._target&&(this.groundMapMode==="alphaMap"&&(this._attachedMesh.material.alphaMap=this._target.texture),this.groundMapMode==="aoMap"&&(this._attachedMesh.material.aoMap=this._target.texture),this.groundMapMode==="map"&&(this._attachedMesh.material.map=this._target.texture)),this._attachedMesh.material&&(this._attachedMesh.material.userData.ALPHA_I_RGBA_PACKING=!e&&this.groundMapMode==="alphaMap",this._attachedMesh.material.alphaTest=e||this.groundMapMode!=="alphaMap"?0:.001,this._attachedMesh.material.needsUpdate=!0))}}As([kt("randomizedLight")],Va.prototype,"_light",void 0),As([lt(Va.prototype.reset),kt()],Va.prototype,"maxFrameNumber",void 0),As([lt(Va.prototype._groundMapModeChanged),kt()],Va.prototype,"groundMapMode",void 0),As([kt(),lt(Va.prototype._alphaVignetteChanged)],Va.prototype,"alphaVignette",void 0),As([kt(),lt(Va.prototype._alphaVignetteChanged)],Va.prototype,"alphaVignetteAxis",void 0);var _0="vec2 poisson_disk_samples[16];void setPds(){poisson_disk_samples[0]=vec2(-0.399691779231,0.728591545584);poisson_disk_samples[1]=vec2(-0.48622557676,-0.84016533712);poisson_disk_samples[2]=vec2(0.770309468987,-0.24906070432);poisson_disk_samples[3]=vec2(0.556596796154,0.820359876432);poisson_disk_samples[4]=vec2(-0.933902004071,0.0600539051593);poisson_disk_samples[5]=vec2(0.330144964342,0.207477293384);poisson_disk_samples[6]=vec2(0.289013230975,-0.686749271417);poisson_disk_samples[7]=vec2(-0.0832470893559,-0.187351643125);poisson_disk_samples[8]=vec2(-0.296314525615,0.254474834305);poisson_disk_samples[9]=vec2(-0.850977666059,0.484642744689);poisson_disk_samples[10]=vec2(0.829287915319,0.2345063545);poisson_disk_samples[11]=vec2(-0.773042143899,-0.543741521254);poisson_disk_samples[12]=vec2(0.0561133030864,0.928419742597);poisson_disk_samples[13]=vec2(-0.205799249508,-0.562072714492);poisson_disk_samples[14]=vec2(-0.526991665882,-0.193690188118);poisson_disk_samples[15]=vec2(-0.051789270667,-0.935374050821);}",hm=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class Hc extends _.Kj0{constructor(e,i,s=0){super(e),this.type="Reflector",this.isReflector2=!0,this.enabled=!0,this.reflectorModePhysical=!0,this.reflectionTargetNeedsUpdate=!0,this.transparentReflectionBackground=!0,this.materialExtension={extraUniforms:{tRefDiffuse:{value:null},tRefDiffuseSize:{value:new _.FM8},refTextureMatrix:{value:null},frameCount:{value:0},sceneBoundingRadius:{value:0}},updaters:[],shaderExtender:(Ee,Ae,ye)=>{if(this.enabled){Ee.vertexShader=Ee.vertexShader.replace("void main() {",`void main() {
vRefUv = refTextureMatrix * vec4( position, 1.0 );`);const ge="#glMarker beforeModulation";Ee.fragmentShader=Ee.fragmentShader.replace(ge,`
                    if(roughnessFactor < 0.95) {
                        float d = 0.;//textureProj(tRefDepth, vRefUv).r;
                        // d = min(2., max(0., (d-0.06) * ((7./3.-ior)) * sceneBoundingRadius));
                        vec4 refBaseColor = getReflectionColor(material.roughness, material.roughness * d);
                        // refBaseColor.rgb = vec3(refBaseColor.a);
                        // refBaseColor.a *= 1.0 - clamp(material.roughness * .3, 0., 1.);
                        `+(this.reflectorModePhysical?`
                        #if !defined(SSR_ENABLED) || SSR_ENABLED < 1 
                        vec3 specularColor = EnvironmentBRDF(geometry.normal, geometry.viewDir, material.specularColor.rgb, material.specularF90, material.roughness);
                        #endif
                        reflectedLight.indirectSpecular = mix(vec3(reflectedLight.indirectSpecular), saturate(specularColor.rgb * refBaseColor.rgb), refBaseColor.a);
                        `:`
                        reflectedLight.indirectSpecular = saturate(diffuseColor.rgb * refBaseColor.rgb);
                        diffuseColor.a *= refBaseColor.a;
                        `)+`}
`+ge),Ee.vertexUvs=!0}},parsVertexSnippet:()=>this.enabled?`
		uniform mat4 refTextureMatrix;
		varying vec4 vRefUv;
`:"",parsFragmentSnippet:()=>this.enabled?_0+`
`+tc+`
#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
varying vec4 vRefUv;uniform sampler2D tRefDiffuse;uniform vec2 tRefDiffuseSize;float getSpecularMIPLevel(const in float roughness,const in float maxMIPLevel){float sigma=PI*roughness*roughness/(1.+roughness);float desiredMIPLevel=maxMIPLevel+log2(sigma);return clamp(desiredMIPLevel,0.,maxMIPLevel);}vec4 getReflectionColor(const in float roughness,const in float depthModifier){float mip=getSpecularMIPLevel(roughness+depthModifier,5.);vec4 color=texture2D(tRefDiffuse,vRefUv.xy/vRefUv.w,mip);float blurDist=saturate(2./(1.+pow(abs(vViewPosition.z),0.25)))*mip*32.*color.a;float rnd=PI2*interleavedGradientNoise(vUv.xy,frameCount);vec4 rotationMatrix=vec4(cos(rnd),-sin(rnd),0.,0.);rotationMatrix.z=-rotationMatrix.y;rotationMatrix.w=rotationMatrix.x;vec3 colorSum=color.rgb*color.a;float weightSum=0.001+color.a;vec2 ofs;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));ofs=vRefUv.xy+vRefUv.w*blurDist*ofs/tRefDiffuseSize.xy;color=texture2D(tRefDiffuse,ofs/vRefUv.w,mip);colorSum+=color.rgb*color.a;weightSum+=color.a;}
#pragma unroll_loop_end
return vec4(colorSum/weightSum,1.);}`:"",computeCacheKey:Ee=>this.enabled+" "+Ee.materialObject.transparent+" "+this.reflectorModePhysical+" ",onObjectRender:(Ee,{materialObject:Ae})=>{Ae.userData.__lastTransparent!==Ae.transparent&&(Ae.needsUpdate=!0,Ae.userData.__lastTransparent=Ae.transparent)},isCompatible:Ee=>Ee.isMeshStandardMaterial2},this.material=void 0,this._renderTarget=i;const a=new _.JOQ,h=new _.Pa4,d=new _.Pa4,b=new _.Pa4,X=new _.yGw,$=new _.Pa4(0,0,-1),Z=new _.Ltg,re=new _.Pa4,le=new _.Pa4,he=new _.Ltg,fe=new _.yGw,me=new _.cPb;_.M8C.isPowerOfTwo(i.texture.image.width)&&_.M8C.isPowerOfTwo(i.texture.image.height)||(this._renderTarget.texture.generateMipmaps=!1),this.onBeforeRender=(Ee,Ae,ye)=>{if(!this.enabled||!Ee.userData.mainRenderPass||!this.reflectionTargetNeedsUpdate)return;const ge=ye.view?Object.assign({},ye.view):null;if(ge&&ye.clearViewOffset&&ye.clearViewOffset(),d.setFromMatrixPosition(this.matrixWorld),b.setFromMatrixPosition(ye.matrixWorld),X.extractRotation(this.matrixWorld),h.set(0,0,1),h.applyMatrix4(X),re.subVectors(d,b),re.dot(h)>0)return;re.reflect(h).negate(),re.add(d),X.extractRotation(ye.matrixWorld),$.set(0,0,-1),$.applyMatrix4(X),$.add(b),le.subVectors(d,$),le.reflect(h).negate(),le.add(d),me.position.copy(re),me.up.set(0,1,0),me.up.applyMatrix4(X),me.up.reflect(h),me.lookAt(le),me.far=2,me.near=0,me.updateMatrixWorld(),me.projectionMatrix.copy(ye.projectionMatrix),fe.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),fe.multiply(me.projectionMatrix),fe.multiply(me.matrixWorldInverse),fe.multiply(this.matrixWorld),a.setFromNormalAndCoplanarPoint(h,d),a.applyMatrix4(me.matrixWorldInverse),Z.set(a.normal.x,a.normal.y,a.normal.z,a.constant);const Pe=me.projectionMatrix;he.x=(Math.sign(Z.x)+Pe.elements[8])/Pe.elements[0],he.y=(Math.sign(Z.y)+Pe.elements[9])/Pe.elements[5],he.z=-1,he.w=(1+Pe.elements[10])/Pe.elements[14],Z.multiplyScalar(2/Z.dot(he)),Pe.elements[2]=Z.x,Pe.elements[6]=Z.y,Pe.elements[10]=Z.z+1-s,Pe.elements[14]=Z.w,this.visible=!1;const Be=Ee.getRenderTarget(),Oe=Ee.xr.enabled,Fe=Ee.shadowMap.autoUpdate;Ee.xr.enabled=!1,Ee.shadowMap.autoUpdate=!1,Ee.setRenderTarget(this._renderTarget),Ee.state.buffers.depth.setMask(!0),Ee.autoClear===!1&&Ee.clear();const Xe=Ae.background;this.transparentReflectionBackground&&(Ae.background=null);const at=!this.transparentReflectionBackground;Xe&&at&&(Xe.userData.flipX=!Xe.userData.flipX),Rn(Ee,{shadowMapRender:!1,backgroundRender:at,opaqueRender:!0,transparentRender:!0,transmissionRender:!1,screenSpaceRendering:!1},()=>Ee.render(Ae,me)),Xe&&at&&(Xe.userData.flipX=!Xe.userData.flipX||void 0),this.transparentReflectionBackground&&(Ae.background=Xe),Ee.xr.enabled=Oe,Ee.shadowMap.autoUpdate=Fe,Ee.setRenderTarget(Be),ge!=null&&ge.enabled&&ye.setViewOffset&&ye.setViewOffset(ge.fullWidth,ge.fullHeight,ge.offsetX,ge.offsetY,ge.width,ge.height);const mt=ye.viewport;mt!==void 0&&Ee.state.viewport(mt),this.visible=!0,this.reflectionTargetNeedsUpdate=!1},this.textureMatrix=fe,this.materialExtension.extraUniforms.tRefDiffuse.value=this._renderTarget.texture,this.materialExtension.extraUniforms.tRefDiffuseSize.value=new _.FM8(this._renderTarget.width,this._renderTarget.height),this.materialExtension.extraUniforms.refTextureMatrix.value=fe}_updateExtension(){var e,i;this.transparentReflectionBackground=this.reflectorModePhysical,(i=(e=this.materialExtension)===null||e===void 0?void 0:e.setDirty)===null||i===void 0||i.call(e)}getRenderTarget(){return this._renderTarget}}hm([lt(Hc.prototype._updateExtension)],Hc.prototype,"enabled",void 0),hm([lt(Hc.prototype._updateExtension)],Hc.prototype,"reflectorModePhysical",void 0),Hc.prototype.isReflector=!0;var ac=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class Wo extends Xi{constructor(e={}){super(),this._transformNeedRefresh=!0,this.dependencies=[Kn],this.visible=!0,this.size=8,this.yOffset=0,this.renderToDepth=!0,this.tonemapGround=!0,this.limitCameraAboveGround=!1,this._cameraLimitsSet=!1,this._cameraLastMaxPolarAngle=Math.PI,this._refreshMaterial=this._refreshMaterial.bind(this),this._refreshTransform=this._refreshTransform.bind(this),this._refreshCameraLimits=this._refreshCameraLimits.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._refreshOptions2=this._refreshOptions2.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this._preRender=this._preRender.bind(this),this._postFrame=this._postFrame.bind(this),this._geometry=new _._12(1,1,1,1),this._geometry.attributes.uv2=this._geometry.attributes.uv.clone(),this._geometry.attributes.uv2.needsUpdate=!0,this._options={shape:"",up:[0,100,0],autoAdjustTransform:!0},this.setOptions(e)}get enabled(){return this.visible}set enabled(e){this.visible=e}get material(){return this._material}get mesh(){return this._iMesh}_createMesh(){return new _.Kj0(this._geometry)}async onAdded(e){var i,s;await super.onAdded(e),e.getPluginByType("TweakpaneUi")&&console.error("TweakpaneUiPlugin must be added after Ground Plugin"),this._manager=e.getPlugin(Kn);const a=this._createMesh();a.userData.physicsMass=0,this._iMesh=await((i=this._manager)===null||i===void 0?void 0:i.addImportedSingle(a,{pseudoCenter:!1,autoScale:!1,addToRoot:!0})),this._mesh=(s=this._iMesh)===null||s===void 0?void 0:s.modelObject,this._mesh&&(this._mesh.userData.userSelectable=!1,this._mesh.castShadow=!0,this._mesh.receiveShadow=!0,this._mesh.name="Ground Plane"),e.scene.addEventListener("sceneUpdate",this._onSceneUpdate),e.scene.addEventListener("addSceneObject",this._onSceneUpdate),e.addEventListener("preRender",this._preRender),e.addEventListener("postFrame",this._postFrame),this.refreshOptions()}_postFrame(){this._transformNeedRefresh&&this._refreshTransform(),this._viewer}_preRender(){this._viewer}async onDispose(e){var i,s;return this._geometry.dispose(),(s=(i=this._iMesh)===null||i===void 0?void 0:i.dispose)===null||s===void 0||s.call(i),super.onDispose(e)}async onRemove(e){return this._removeMaterial(),e.scene.removeEventListener("sceneUpdate",this._onSceneUpdate),e.scene.removeEventListener("addSceneObject",this._onSceneUpdate),e.removeEventListener("postFrame",this._postFrame),e.removeEventListener("preRender",this._preRender),this._manager=void 0,super.onRemove(e)}_removeMaterial(){var e,i;this._material&&((i=(e=this._manager)===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterial(this._material),this._material.userData.renderToDepth=this._material.userData.__renderToDepth,this._material.userData.__renderToDepth=void 0,this._material=void 0)}_onSceneUpdate(e){e.geometryChanged!==!1&&e.updateGround!==!1&&this.refreshTransform()}refreshTransform(){this._transformNeedRefresh=!0}_refreshOptions2(){this.refreshOptions()}refreshOptions(){this._viewer&&(this._refreshMaterial(),this.refreshTransform(),this._refreshCameraLimits())}_refreshCameraLimits(){var e;const i=(e=this._viewer)===null||e===void 0?void 0:e.scene.activeCamera.controls;i&&(i.maxPolarAngle!==void 0?this.limitCameraAboveGround?(this._cameraLimitsSet||(this._cameraLastMaxPolarAngle=i.maxPolarAngle),i.maxPolarAngle=Math.PI/2,this._cameraLimitsSet=!0):this._cameraLimitsSet&&(i.maxPolarAngle=this._cameraLastMaxPolarAngle,this._cameraLimitsSet=!1):console.warn("refreshCameraLimits only available with orbit controls."))}_refreshTransform(){var e,i,s;if(!this._mesh||!this._viewer)return;let a=!1;if(this.visible!==this._mesh.visible&&(this._mesh.visible=this.visible,a=!0),this.enabled){if(this._options.autoAdjustTransform){this._mesh.userData.bboxVisible=!1;const h=this._viewer.scene.getBounds(!0);this._mesh.userData.bboxVisible=!0;const d=h.getCenter(new _.Pa4).sub(new _.Pa4(0,h.getSize(new _.Pa4).y/2+this.yOffset,0));a=a||d.clone().sub(this._mesh.position).length()>1e-4,a&&this._mesh.position.copy(d)}a=a||Math.abs(this._mesh.scale.x-this.size)>1e-4,a&&(this._mesh.scale.setScalar(this.size),this._mesh.setRotationFromEuler(new _.USm(-Math.PI/2,0,0)),this._mesh.matrixWorldNeedsUpdate=!0,(s=(i=this._mesh).setDirty)===null||s===void 0||s.call(i)),this._transformNeedRefresh=!1}else a&&((e=this._viewer)===null||e===void 0||e.scene.setDirty())}_refreshMaterial(){var e,i,s,a,h,d,b,X;if(!this._viewer||!this.enabled)return!1;this._manager||console.error("GroundPlugin requires asset manager");const $=(i=(e=this._manager)===null||e===void 0?void 0:e.materials)===null||i===void 0?void 0:i.findOrCreate((a=(s=this._material)===null||s===void 0?void 0:s.uuid)!==null&&a!==void 0?a:"standard",{name:"BaseGroundMaterial",runtimeMaterial:!0,color:16777215});let Z=!1;return($==null?void 0:$.uuid)!==((h=this._material)===null||h===void 0?void 0:h.uuid)&&(this._removeMaterial(),$&&(this._material=$),!((d=this._material)===null||d===void 0)&&d.uuid||console.warn("No material found for ground"),this._viewer.scene.setDirty(),this._mesh&&this._material&&(this._material.roughness=.2,this._material.metalness=.5,((X=(b=this._mesh)===null||b===void 0?void 0:b.setMaterial)!==null&&X!==void 0?X:re=>{this._mesh&&(this._mesh.material=re.materialObject)})(this._material)),Z=!0),this._material&&(this._material.userData.__renderToDepth===void 0&&(this._material.userData.__renderToDepth=this._material.userData.renderToDepth),this._material.userData.renderToDepth!==this.renderToDepth&&(this._material.userData.renderToDepth=this.renderToDepth),this._material.userData.__postTonemap===void 0&&(this._material.userData.__postTonemap=this._material.userData.postTonemap),this._material.userData.postTonemap!==this.tonemapGround&&(this._material.userData.postTonemap=this.tonemapGround),this._material.materialObject.userData.ssaoDisabled=!0,this._material.materialObject.userData.sscsDisabled=!0),this._viewer.setDirty(this),Z}setOptions(e){Object.assign(this._options,e),this.refreshOptions()}fromJSON(e,i){return super.fromJSON(e,i)?(this.refreshOptions(),this):null}_extraUiConfig(){return[()=>{var e;return(e=this._material)===null||e===void 0?void 0:e.uiConfig}]}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ground",children:[{label:"Visible",type:"checkbox",property:[this,"visible"],limitedUi:!0},{label:"Size",type:"input",property:[this,"size"],limitedUi:!0},{label:"Render to Depth",type:"checkbox",property:[this,"renderToDepth"]},{label:"Limit Camera",type:"checkbox",property:[this,"limitCameraAboveGround"]},{label:"Tonemap",type:"checkbox",property:[this,"tonemapGround"]},{label:"Height",type:"slider",bounds:[-2,2],property:[this,"yOffset"]},...this._extraUiConfig()]}}}ac([kt("material")],Wo.prototype,"_material",void 0),ac([lt(Wo.prototype.refreshTransform),kt()],Wo.prototype,"visible",void 0),ac([lt(Wo.prototype._onSceneUpdate),kt()],Wo.prototype,"size",void 0),ac([lt(Wo.prototype._onSceneUpdate),kt()],Wo.prototype,"yOffset",void 0),ac([lt(Wo.prototype._refreshOptions2),kt()],Wo.prototype,"renderToDepth",void 0),ac([lt(Wo.prototype._refreshOptions2),kt()],Wo.prototype,"tonemapGround",void 0),ac([lt(Wo.prototype._refreshCameraLimits),kt()],Wo.prototype,"limitCameraAboveGround",void 0);var dm=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class Ta extends Wo{constructor(e={},i=!1){super(e),this.bakedShadows=!0,this.groundReflection=!1,this.physicalReflections=!1,this._showDebug=i,i&&this.dependencies.push(Ma),this._onSceneUpdate=this._onSceneUpdate.bind(this)}get shadowBaker(){return this._shadowBaker}_createMesh(){const e=new Hc(this._geometry,this._viewer.renderer.createTarget({type:_.ywz,format:_.wk1,encoding:_.rnI,size:{width:1024,height:1024},generateMipmaps:!0,depthBuffer:!0,minFilter:_.D1R,magFilter:_.wem})),i=e.onBeforeRender;return e.onBeforeRender=(...s)=>{var a,h,d,b,X;let $=(h=(a=this._viewer)===null||a===void 0?void 0:a.getPluginByType("SSReflection"))===null||h===void 0?void 0:h.passes.ssr.passObject;$&&!$.enabled&&($=void 0),$&&($.enabled=!1);let Z=(X=(b=(d=this._viewer)===null||d===void 0?void 0:d.getPluginByType("SSBevelPlugin"))===null||b===void 0?void 0:b.pass)===null||X===void 0?void 0:X.passObject;Z&&!Z.enabled&&(Z=void 0),Z&&(Z.enabled=!1),i(...s),$&&($.enabled=!0),Z&&(Z.enabled=!0)},e}async onAdded(e){var i,s;await super.onAdded(e),this._showDebug&&((i=e.getPlugin(Ma))===null||i===void 0||i.addTexture("bake_ground_1",()=>{var a,h;return(h=(a=this._shadowBaker)===null||a===void 0?void 0:a.light.shadow.map)===null||h===void 0?void 0:h.texture},[100,100,200,200]),(s=e.getPlugin(Ma))===null||s===void 0||s.addTexture("bake_ground_2",()=>{var a,h;return(h=(a=this._shadowBaker)===null||a===void 0?void 0:a.target)===null||h===void 0?void 0:h.texture},[100,400,400,400],"texel = vec4(vec3(unpackRGBAToDepth(texel)), 1.0);"))}_postFrame(){var e;super._postFrame(),this._viewer&&this.enabled&&this.bakedShadows&&((e=this._shadowBaker)===null||e===void 0||e.autoUpdateShadow())}_preRender(){super._preRender(),this._viewer&&(this._mesh.reflectionTargetNeedsUpdate=this._viewer.renderer.frameCount<1)}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_removeMaterial(){var e,i,s,a;if(this._material){if(this._shadowBaker&&this._material.groundMatExtension&&((i=(e=this._material).unregisterMaterialExtensions)===null||i===void 0||i.call(e,[this._shadowBaker.materialExtension]),delete this._material.groundMatExtension),this._material.reflectorMatExtension){const h=this._mesh.materialExtension;h||console.warn("unable to find the extension to unregister"),(a=(s=this._material).unregisterMaterialExtensions)===null||a===void 0||a.call(s,[h]),delete this._material.reflectorMatExtension}super._removeMaterial()}}_onSceneUpdate(e){var i;super._onSceneUpdate(e),e.geometryChanged!==!1&&((i=this._shadowBaker)===null||i===void 0||i.reset())}refreshOptions(){if(!this._viewer)return;this.bakedShadows&&!this._shadowBaker?(this._shadowBaker=new Va(this._viewer),this._shadowBaker.attachedMesh=this._mesh):!this.bakedShadows&&this._shadowBaker&&(this._shadowBaker.reset(),this._shadowBaker.cleanupMaterial());const e=this._mesh;e.isReflector2&&(e.enabled=this.groundReflection,e.reflectorModePhysical=this.physicalReflections),super.refreshOptions(),this._viewer.setDirty(this)}_refreshMaterial(){var e,i,s,a;if(!this._viewer)return!1;const h=super._refreshMaterial();if(!this._material)return h;if(this.groundReflection&&this._mesh.isReflector2&&!this._material.reflectorMatExtension){const d=this._mesh.materialExtension;d.updaters=[this._viewer.scene,this._viewer.renderer],(i=(e=this._material).registerMaterialExtensions)===null||i===void 0||i.call(e,[d]),this._material.reflectorMatExtension=!0}return this.bakedShadows&&this._shadowBaker&&!this._material.groundMatExtension&&((a=(s=this._material).registerMaterialExtensions)===null||a===void 0||a.call(s,[this._shadowBaker.materialExtension]),this._material.groundMatExtension=!0),this._material.materialObject.userData.ssreflDisabled=this.groundReflection,this._material.materialObject.userData.ssreflNonPhysical=!this.physicalReflections,this._viewer.setDirty(this),h}_extraUiConfig(){var e,i,s,a,h,d,b,X,$,Z,re,le,he,fe,me,Ee,Ae,ye,ge,Pe,Be,Oe,Fe,Xe,at,mt,wt,At,Tt,yt;return[{label:"Baked Shadows",type:"checkbox",property:[this,"bakedShadows"]},{label:"Shadow Frames",type:"input",hidden:()=>!this._shadowBaker,stepSize:1,bounds:[1,1e3],property:[this._shadowBaker,"maxFrameNumber"]},{label:"Alpha Vignette",type:"checkbox",hidden:()=>!this._material||this._material.transmission<1e-4&&!this._material.transparent,property:[this._shadowBaker,"alphaVignette"],limitedUi:!0,onChange:()=>{var St,Ft;return(Ft=(St=this._uiConfig)===null||St===void 0?void 0:St.uiRefresh)===null||Ft===void 0?void 0:Ft.call(St,"postFrame",!0)}},{label:"Alpha Vignette Axis",type:"dropdown",hidden:()=>{var St;return!(!((St=this._shadowBaker)===null||St===void 0)&&St.alphaVignette)||!this._material||this._material.transmission<1e-4&&!this._material.transparent},property:[this._shadowBaker,"alphaVignetteAxis"],children:["x","y","xy"].map(St=>({label:St,value:St})),limitedUi:!0},{label:"Planar Reflections",type:"checkbox",property:[this,"groundReflection"],limitedUi:!0},{label:"Physical Reflections",type:"checkbox",property:[this,"physicalReflections"],limitedUi:!0},{label:"Shadow type",type:"dropdown",hidden:()=>!this._shadowBaker,property:[this._shadowBaker,"groundMapMode"],children:[{label:"aoMap"},{label:"map"},{label:"alphaMap"}],limitedUi:!0},{type:"folder",label:"Randomized Light",hidden:()=>!this._shadowBaker,limitedUi:!0,children:[{type:"color",label:"Color",property:[(e=this._shadowBaker)===null||e===void 0?void 0:e.light,"color"]},{type:"slider",label:"Intensity",bounds:[0,100],property:[(i=this._shadowBaker)===null||i===void 0?void 0:i.light,"intensity"]},{type:"checkbox",label:"Shadow Enabled",property:[(a=(s=this._shadowBaker)===null||s===void 0?void 0:s.light)===null||a===void 0?void 0:a.shadowParams,"enabled"],onChange:[(d=(h=this._shadowBaker)===null||h===void 0?void 0:h.light)===null||d===void 0?void 0:d.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(X=(b=this._shadowBaker)===null||b===void 0?void 0:b.light)===null||X===void 0?void 0:X.randomParams,"focus"],onChange:[this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(Z=($=this._shadowBaker)===null||$===void 0?void 0:$.light)===null||Z===void 0?void 0:Z.randomParams,"spread"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,60],property:[(le=(re=this._shadowBaker)===null||re===void 0?void 0:re.light)===null||le===void 0?void 0:le.randomParams,"distanceScale"],onChange:[(fe=(he=this._shadowBaker)===null||he===void 0?void 0:he.light)===null||fe===void 0?void 0:fe.updateShadowParams,this._onSceneUpdate]},{type:"vec3",bounds:[-1,1],property:[(Ee=(me=this._shadowBaker)===null||me===void 0?void 0:me.light)===null||Ee===void 0?void 0:Ee.randomParams,"direction"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"vec3",bounds:[-1,1],property:[(ye=(Ae=this._shadowBaker)===null||Ae===void 0?void 0:Ae.light)===null||ye===void 0?void 0:ye.randomParams,"normalDirection"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,10],property:[(Pe=(ge=this._shadowBaker)===null||ge===void 0?void 0:ge.light)===null||Pe===void 0?void 0:Pe.shadowParams,"radius"],onChange:[(Oe=(Be=this._shadowBaker)===null||Be===void 0?void 0:Be.light)===null||Oe===void 0?void 0:Oe.updateShadowParams,this._onSceneUpdate]},{type:"input",property:[(Xe=(Fe=this._shadowBaker)===null||Fe===void 0?void 0:Fe.light)===null||Xe===void 0?void 0:Xe.shadowParams,"frustumSize"],onChange:[(mt=(at=this._shadowBaker)===null||at===void 0?void 0:at.light)===null||mt===void 0?void 0:mt.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[-.1,.1],property:[(At=(wt=this._shadowBaker)===null||wt===void 0?void 0:wt.light)===null||At===void 0?void 0:At.shadowParams,"bias"],onChange:[(yt=(Tt=this._shadowBaker)===null||Tt===void 0?void 0:Tt.light)===null||yt===void 0?void 0:yt.updateShadowParams,this._onSceneUpdate]}]},...super._extraUiConfig()]}}Ta.PluginType="Ground",dm([lt(Ta.prototype.refreshOptions),kt()],Ta.prototype,"bakedShadows",void 0),dm([lt(Ta.prototype.refreshOptions),kt()],Ta.prototype,"groundReflection",void 0),dm([lt(Ta.prototype.refreshOptions),kt()],Ta.prototype,"physicalReflections",void 0),dm([kt("shadowBaker")],Ta.prototype,"_shadowBaker",void 0);var Du,Oo=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Cl=Du=class extends Fs{constructor(){super({vertexShader:ae.vertexShader,defines:{PASS_STEP:1},uniforms:{tSource:{value:null},tDiffuse:{value:null},opacity:{value:1},tDiffuseSize:{value:new _.FM8},weight:{value:1},tNormalDepth:{value:null}},fragmentShader:Wa+`
uniform float intensity;uniform float opacity;uniform vec2 tDiffuseSize;varying vec2 vUv;uniform float weight;
#if PASS_STEP == 0
uniform vec4 prefilter;vec4 Prefilter(vec4 c){if(getDepth(vUv)>0.999){return vec4(0.);}float brightness=max(c.r,max(c.g,c.b));float soft=brightness+prefilter.x*(prefilter.y-1.);soft=clamp(soft,0.,prefilter.z);soft=soft*soft*prefilter.w;float contribution=max(soft,brightness-prefilter.x);contribution/=max(brightness,0.001);return vec4(c.rgb*contribution,c.a);}
#endif
vec4 Sample(vec2 uv){return tDiffuseTexelToLinear(texture2D(tDiffuse,uv));}vec4 SampleBox(vec2 uv,float delta){vec4 o=vec2(-delta,delta).xxyy/tDiffuseSize.xyxy;vec4 s=Sample(uv+o.xy)+Sample(uv+o.zy)+Sample(uv+o.xw)+Sample(uv+o.zw);return s*0.25;}void main(){
#if PASS_STEP == 0 
gl_FragColor=weight*Prefilter(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 1 
gl_FragColor=weight*(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 2 
gl_FragColor=(SampleBox(vUv,0.5));gl_FragColor.a=1.;
#elif PASS_STEP == 3 
vec4 texel=tSourceTexelToLinear(texture2D(tSource,vUv));vec4 bloom=intensity*SampleBox(vUv,0.5).rgba;float brightness=max(bloom.r,max(bloom.g,bloom.b));texel.rgb+=bloom.rgb;texel.a=min(1.,texel.a+brightness);gl_FragColor=texel;
#elif PASS_STEP == 4 
vec4 texel=vec4(0.);texel.rgb+=intensity*SampleBox(vUv,0.5).rgb;texel.a=1.;gl_FragColor=texel;
#endif
#include <encodings_fragment>
}`},"tDiffuse","tSource"),this.uiConfig=void 0,this.prefilter=new _.Ltg(2,.5,0,0),this.threshold=2,this.softThreshold=.5,this.intensity=.5,this.bloomIterations=4,this.radius=.6,this.power=1,this.bloomDebug=!1,this._weights=[],this._updateWeights=this._updateWeights.bind(this),this._thresholdsUpdated=this._thresholdsUpdated.bind(this),this._updateWeights(),this._thresholdsUpdated(),this.clear=!0,this.userData={setDirty:()=>{this.setDirty()}}}_thresholdsUpdated(){this.prefilter.x=this.threshold,this.prefilter.y=this.softThreshold,this.prefilter.z=2*this.prefilter.x*this.prefilter.y,this.prefilter.w=.125/(this.uniforms.prefilter.value.z+1e-5)}render(c,e,i,s,a){const h=c.baseRenderer;this.material.defines.PASS_STEP=0,this.clear=!0;const d=i;let b=.5,X=d.width*b,$=d.height*b;const Z=[];let re=h.getTempTarget({sizeMultiplier:.5,type:_.cLu});Z.push(re);let le=d;this.material.needsUpdate=!0,this.material.uniforms.weight.value=this._weights[0],super.render(c,re,le,s,a),le=re;let he=1;for(;he<this.bloomIterations&&(X/=2,$/=2,b/=2,!($<2||X<2));he++){re=h.getTempTarget({sizeMultiplier:b,type:_.cLu}),Z.push(re),this.material.defines.PASS_STEP=1;let me=this._weights[he];me=this._weights[he-1]!==0?this._weights[he]/this._weights[he-1]:this._weights[he],this.material.uniforms.weight.value=me,this.material.needsUpdate=!0,super.render(c,re,le,s,a),le=re}this.clear=!1;const fe=c.autoClear;for(c.autoClear=!1,he-=2;he>=0;he--)re=Z[he],Z[he]=void 0,this.material.defines.PASS_STEP=2,this.material.transparent=!0,this.material.blending=_.WMw,this.material.needsUpdate=!0,c.autoClear=!1,super.render(c,re,le,s,a),this.material.blending=_.jFi,h.releaseTempTarget(le),le=re;this.clear=!0,c.autoClear=fe,c.autoClear=!0,this.bloomDebug?(this.material.defines.PASS_STEP=4,this.material.needsUpdate=!0,super.render(c,e,le,s,a)):(this.uniforms.tSource.value=d.texture,this.material.defines.PASS_STEP=3,this.material.needsUpdate=!0,super.render(c,e,le,s,a),this.uniforms.tSource.value=null),h.releaseTempTarget(le)}_updateWeights(){if(!this._weights)return;const c=Math.max(Math.min(this.radius,1),0),e=1/(this.bloomIterations-1);for(let i=0;i<this.bloomIterations;i++){let s=i*e+.1,a=1.2-s;s=Math.pow(s,this.power),a=Math.pow(a,this.power),this._weights[i]=a*(1-c)+s*c}this.setDirty()}};Oo([ot()],Cl.prototype,"prefilter",void 0),Oo([ai("Threshold",[0,2]),lt(Du.prototype._thresholdsUpdated),kt()],Cl.prototype,"threshold",void 0),Oo([ai("Soft Threshold",[0,1]),lt(Du.prototype._thresholdsUpdated),kt()],Cl.prototype,"softThreshold",void 0),Oo([ai("Intensity",[0,3]),kt(),ot()],Cl.prototype,"intensity",void 0),Oo([ai("Iterations",[0,7],1),lt(Du.prototype._updateWeights),kt()],Cl.prototype,"bloomIterations",void 0),Oo([ai("Radius",[0,1],.01),lt(Du.prototype._updateWeights),kt()],Cl.prototype,"radius",void 0),Oo([ai("Power",[.2,10],.01),lt(Du.prototype._updateWeights),kt()],Cl.prototype,"power",void 0),Oo([Xn("Debug")],Cl.prototype,"bloomDebug",void 0),Cl=Du=Oo([ur("Bloom")],Cl);class pm extends Sl{constructor(){super(...arguments),this.passId="bloom",this._beforeFilters=["combinedPost","screen"],this._afterFilters=["render","progressive"],this._requiredFilters=["render"]}passCtor(e){return new Cl}_update(e){var i,s;return(i=e.getPlugin(Or))===null||i===void 0||i.updateShaderProperties((s=this.pass)===null||s===void 0?void 0:s.passObject.material),super._update(e)}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}pm.PluginType="Bloom";var Nd=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Za=class extends Xi{constructor(){super(),this.enabled=!0,this.dependencies=[Kn],this._defines={ANISOTROPY_DEBUG:!1},this._uniforms={anisotropyFactor:{value:1},anisotropyNoise:{value:1},anisotropyDirection:{value:1},anisotropyDirectionMap:{value:null},frameCount:{value:0}},this.materialExtension={shaderExtender:(c,e,i)=>{var s;if(!this.enabled||!e.materialObject.userData._isAnisotropic)return;const a=(s=e.materialObject.userData)===null||s===void 0?void 0:s._anisotropyDirectionMap,h=Ne`
                #include <bsdfs>
                //#if ANISOTROPY_ENABLED
                ${tc}
                ${`uniform float anisotropyFactor;uniform float anisotropyNoise;
#if ANISOTROPY_TEX_MODE == 0
uniform float anisotropyDirection;
#else
uniform sampler2D anisotropyDirectionMap;
#endif
const float MIN_ROUGHNESS=0.05;float D_GGX_Anisotropy(float at,float ab,float ToH,float BoH,float NoH){float a2=at*ab;highp vec3 d=vec3(ab*ToH,at*BoH,a2*NoH);highp float d2=dot(d,d);float b2=a2/d2;return a2*b2*b2*(1./PI);}float V_GGX_SmithCorrelated_Anisotropy(float at,float ab,float ToV,float BoV,float ToL,float BoL,float NoV,float NoL){float lambdaV=NoL*length(vec3(at*ToV,ab*BoV,NoV));float lambdaL=NoV*length(vec3(at*ToL,ab*BoL,NoL));float v=0.5/(lambdaV+lambdaL);return saturate(v);}vec3 indirectAnisotropyBentNormal(const in vec3 normal,const in vec3 viewDir,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){vec3 aDirection=anisotropyFactor>=0.?anisotropicB:anisotropicT;vec3 aTangent=cross(aDirection,viewDir);vec3 aNormal=cross(aTangent,aDirection);float bendFactor=abs(anisotropyFactor)*saturate(5.*max(roughness,MIN_ROUGHNESS));return normalize(mix(normal,aNormal,bendFactor));}vec3 BRDF_GGX_Anisotropy(const in vec3 lightDir,const in vec3 viewDir,const in vec3 normal,const in vec3 f0,const in float f90,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){float alpha=pow2(roughness);vec3 halfDir=normalize(lightDir+viewDir);float dotNL=saturate(dot(normal,lightDir));float dotNV=saturate(dot(normal,viewDir));float dotNH=saturate(dot(normal,halfDir));float dotVH=saturate(dot(viewDir,halfDir));float dotTV=dot(anisotropicT,viewDir);float dotBV=dot(anisotropicB,viewDir);float dotTL=dot(anisotropicT,lightDir);float dotBL=dot(anisotropicB,lightDir);float dotTH=dot(anisotropicT,halfDir);float dotBH=dot(anisotropicB,halfDir);float aspect=sqrt(1.-min(1.-MIN_ROUGHNESS,abs(anisotropyFactor)*0.9));if(anisotropyFactor>0.)aspect=1./aspect;float at=roughness*aspect;float ab=roughness/aspect;vec3 F=F_Schlick(f0,f90,dotVH);float V=V_GGX_SmithCorrelated_Anisotropy(at,ab,dotTV,dotBV,dotTL,dotBL,dotNV,dotNL);float D=D_GGX_Anisotropy(at,ab,dotTH,dotBH,dotNH);return F*(V*D);}`}
            `+(a?en("anisotropyDirectionMap",a,i.capabilities.isWebGL2):"");c.fragmentShader=c.fragmentShader.replace("#include <bsdfs>",h),c.fragmentShader=c.fragmentShader.replace("#include <lights_fragment_begin>",_.WdD.lights_fragment_begin),c.fragmentShader=c.fragmentShader.replace("IncidentLight directLight;",`float rnd=(random2(vUv.xy,frameCount)-0.5)*anisotropyNoise*material.roughness;
#if ANISOTROPY_TEX_MODE < 2
#if ANISOTROPY_TEX_MODE == 0 
float rot=saturate(anisotropyDirection);
#else 
float rot=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).r);
#endif
rot=rot*2.*PI+rnd;vec2 rot2=vec2(sin(rot),cos(rot));
#else 
vec2 rot2=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).rg*2.-1.)+vec2(rnd,rnd);rot2=normalize(rot2);const float anisoSpecMultiplier=0.25;float matSpecAniso=(length(material.specularColor.rgb))*2.*PI;rot2=mix(rot2,vec2(sin(matSpecAniso),cos(matSpecAniso)),anisoSpecMultiplier);rot2=normalize(rot2);
#endif
vec3 anisotropicT=(tangent*rot2.x+bitangent*rot2.y);anisotropicT=normalize(anisotropicT-normal*dot(anisotropicT,normal));vec3 anisotropicB=normalize(cross(normal,anisotropicT));IncidentLight directLight;`).replaceAll("RE_Direct( directLight, geometry, material, reflectedLight )","RE_Direct( directLight, geometry, material, reflectedLight, anisotropicT, anisotropicB )");const d=_.WdD.lights_physical_pars_fragment.replace("void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {","void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight, const in vec3 anisotropicT, const in vec3 anisotropicB ) {").replace("BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness )","BRDF_GGX_Anisotropy( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness, anisotropicT, anisotropicB )");c.fragmentShader=c.fragmentShader.replace("#include <lights_physical_pars_fragment>",d);const b=Ne`
                #if defined( USE_ENVMAP )
                vec3 anisotropyBentNormal = indirectAnisotropyBentNormal(geometry.normal, geometry.viewDir, material.roughness, anisotropicT, anisotropicB);
                #endif
            `+_.WdD.lights_fragment_maps.replace("getIBLIrradiance( geometry.normal )","getIBLIrradiance( anisotropyBentNormal )").replace("getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness )","getIBLRadiance( geometry.viewDir, anisotropyBentNormal, material.roughness )");c.fragmentShader=c.fragmentShader.replace("#include <lights_fragment_maps>",b),c.vertexUvs=!0,c.vertexTangents=!0},onObjectRender:(c,e)=>{var i;const s=e.materialObject.userData;if(!(s!=null&&s._isAnisotropic))return;const a=c;if(!a.isMesh||!a.geometry)return;if(!a.geometry.attributes.tangent)throw new Error("No tangents on the geometry");this._uniforms.anisotropyFactor.value=s._anisotropyFactor,this._uniforms.anisotropyNoise.value=s._anisotropyNoise,this._uniforms.anisotropyDirectionMap.value=!((i=s._anisotropyDirectionMap)===null||i===void 0)&&i.isTexture?s._anisotropyDirectionMap:null,this._uniforms.anisotropyDirection.value=s._anisotropyDirection;let h=this.enabled?1:0;e.materialObject.defines.ANISOTROPY_ENABLED!==h&&(e.materialObject.defines.ANISOTROPY_ENABLED=h,e.materialObject.needsUpdate=!0),h=+this._defines.ANISOTROPY_DEBUG,e.materialObject.defines.ANISOTROPY_DEBUG!==h&&(e.materialObject.defines.ANISOTROPY_DEBUG=h,e.materialObject.needsUpdate=!0),h=s._anisotropyDirectionMode,this._uniforms.anisotropyDirectionMap.value||(h="CONSTANT"),h=h==="DIRECTION"?2:h==="ROTATION"?1:0,e.materialObject.defines.ANISOTROPY_TEX_MODE!==h&&(e.materialObject.defines.ANISOTROPY_TEX_MODE=h,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:c=>{var e,i,s;return(this.enabled?"1":"0")+(!((e=c.materialObject.userData)===null||e===void 0)&&e._isAnisotropic?"1":"0")+((s=(i=c.materialObject.userData)===null||i===void 0?void 0:i._anisotropyDirectionMap)===null||s===void 0?void 0:s.uuid)},isCompatible:c=>c.isMeshStandardMaterial2,updaters:()=>{var c;return[(c=this._viewer)===null||c===void 0?void 0:c.renderer]},getUiConfig:c=>{const e=this._viewer,i=this.makeAnisotropic,s={type:"folder",label:"Anisotropy",children:[{type:"checkbox",label:"Enabled",get value(){return c.materialObject.userData._isAnisotropic||!1},set value(a){var h;a!==c.materialObject.userData._isAnisotropic&&(a?i(c)||e.alert("One or more geometries cannot be made anisotropic."):(c.materialObject.userData._isAnisotropic=!1,c.materialObject.needsUpdate=!0),(h=s.uiRefresh)===null||h===void 0||h.call(s,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Factor",bounds:[-2,2],hidden:()=>!c.materialObject.userData._isAnisotropic,property:[c.materialObject.userData,"_anisotropyFactor"],onChange:this.setDirty},{type:"slider",label:"Noise",bounds:[0,2],hidden:()=>!c.materialObject.userData._isAnisotropic,property:[c.materialObject.userData,"_anisotropyNoise"],onChange:this.setDirty},{type:"image",label:"Texture",hidden:()=>!c.materialObject.userData._isAnisotropic,property:[c.materialObject.userData,"_anisotropyDirectionMap"],onChange:()=>{c.materialObject.needsUpdate=!0,this.setDirty()}},{type:"dropdown",label:"Mode",hidden:()=>!c.materialObject.userData._isAnisotropic,property:[c.materialObject.userData,"_anisotropyDirectionMode"],children:["CONSTANT","ROTATION","DIRECTION"].map(a=>({label:a})),onChange:()=>{c.materialObject.needsUpdate=!0,this.setDirty()}}]};return s}},this.setDirty=()=>{var c;(c=this._viewer)===null||c===void 0||c.setDirty()},this.makeSelectedAnisotropic=()=>{var c,e,i;const s=(i=(e=(c=this._viewer)===null||c===void 0?void 0:c.getPlugin(br))===null||e===void 0?void 0:e.getSelectedObject())===null||i===void 0?void 0:i.material;return(s==null?void 0:s.assetType)==="material"&&this.makeAnisotropic(s)},this._loaderCreate=this._loaderCreate.bind(this)}makeAnisotropic(c){var e;const i=(e=c.materialObject)===null||e===void 0?void 0:e.userData;if(!i)return!1;if(i._isAnisotropic===void 0){const s=i.__appliedMeshes;let a=!0;if(s)for(const{geometry:h}of s)!h||h.index&&h.attributes.position&&h.attributes.normal&&h.attributes.uv||(a=!1),a&&!h.attributes.tangent&&h.computeTangents();if(!a)return!1}return i._isAnisotropic=!0,i._anisotropyFactor===void 0&&(i._anisotropyFactor=1),i._anisotropyNoise===void 0&&(i._anisotropyNoise=0),i._anisotropyDirectionMode===void 0&&(i._anisotropyDirectionMode="DIRECTION"),c.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:c}){c.isGLTFLoader2&&c.register(e=>new fm(e))}async onAdded(c){var e,i,s,a,h;await super.onAdded(c);const d=c.getPlugin(Kn);(e=d==null?void 0:d.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(i=d==null?void 0:d.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),(h=(a=(s=d==null?void 0:d.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||a===void 0?void 0:a.extensions)===null||h===void 0||h.push(Hp)}async onRemove(c){var e,i,s,a;return(i=(e=c.getPlugin(Kn))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this.materialExtension),(a=(s=c.getPlugin(Kn))===null||s===void 0?void 0:s.importer)===null||a===void 0||a.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(c)}};Za.PluginType="AnisotropyPlugin",Za.ANISOTROPY_GLTF_EXTENSION="WEBGI_materials_anisotropy",Nd([Xn("Enabled",c=>({onChange:c.setDirty})),kt()],Za.prototype,"enabled",void 0),Nd([lr("Make Anisotropy",c=>({hidden:()=>{var e;return!(!((e=c._viewer)===null||e===void 0)&&e.getPlugin(br))}}))],Za.prototype,"makeSelectedAnisotropic",void 0),Za=Nd([ur("Anisotropy Materials")],Za);class fm{constructor(e){this.parser=e,this.name=Za.ANISOTROPY_GLTF_EXTENSION}async extendMaterialParams(e,i){var s,a,h;const d=this.parser,b=d.json.materials[e];if(!b.extensions||!b.extensions[this.name])return Promise.resolve();const X=[],$=b.extensions[this.name];i.userData||(i.userData={}),i.userData._isAnisotropic=!0,i.userData._anisotropyFactor=(s=$.anisotropyFactor)!==null&&s!==void 0?s:0,i.userData._anisotropyNoise=(h=(a=$.anisotropyNoiseFactor)!==null&&a!==void 0?a:$.anisotropyNoise)!==null&&h!==void 0?h:0;let{anisotropyDirectionMode:Z,anisotropyDirection:re}=$;return Z||(Z=$.anisotropyTextureMode),re||(re=$.anisotropyRotation),i.userData._anisotropyDirectionMode=Z&&typeof(re==null?void 0:re.index)=="number"?Z:"CONSTANT",Z==="ROTATION"||Z==="DIRECTION"?X.push(d.assignTexture(i.userData,"_anisotropyDirectionMap",re).then(le=>{le.encoding=_.knz})):i.userData._anisotropyDirection=re??0,Promise.all(X)}afterRoot(e){return e.scene.traverse(i=>{var s,a;if(!(!((a=(s=i.material)===null||s===void 0?void 0:s.userData)===null||a===void 0)&&a._isAnisotropic))return;const h=i.geometry;h.attributes.tangent||(h.computeTangents(),h.attributes.tangent.needsUpdate=!0)}),null}}const Hp=c=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._isAnisotropic||(e.userData._anisotropyFactor||0)<.001)return;i.extensions=i.extensions||{};const s={};if(s.anisotropyFactor=e.userData._anisotropyFactor||1,s.anisotropyNoiseFactor=e.userData._anisotropyNoise||0,s.anisotropyDirectionMode=e.userData._anisotropyDirectionMode||"CONSTANT",e.userData._anisotropyDirectionMap&&s.anisotropyDirectionMode!=="CONSTANT"){const a={index:c.processTexture(e.userData._anisotropyDirectionMap)};c.applyTextureTransform(a,e.userData._anisotropyDirectionMap),s.anisotropyDirection=a}else s.anisotropyDirectionMode="CONSTANT",s.anisotropyDirection=e.userData._anisotropyDirection||0;i.extensions[Za.ANISOTROPY_GLTF_EXTENSION]=s,c.extensionsUsed[Za.ANISOTROPY_GLTF_EXTENSION]=!0}});var Wp=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let la=class extends Xi{constructor(){super(),this.enabled=!0,this.dependencies=[Kn],this._defines={},this._uniforms={thinBaseLayerFactors:{value:new _.Ltg},thinNoiseLayerFactors:{value:new _.Ltg},thinColorNoiseParams:{value:new _.Ltg},thinFilmFactor:{value:.8}},this.materialExtension={parsFragmentSnippet:(c,e)=>{var i;return this.enabled&&(!((i=e==null?void 0:e.materialObject.userData._thinFilmLayer)===null||i===void 0)&&i.hasThinFilm)?tc+`
#ifndef VORONOISE_HELPER
#define VORONOISE_HELPER 
float voronoise(in vec2 p,float u,float v){float k=1.+63.*pow(1.-v,6.);vec2 i=floor(p);vec2 f=fract(p);vec2 a=vec2(0.,0.);for(int y=-2;y<=2;y++)for(int x=-2;x<=2;x++){vec2 g=vec2(x,y);vec3 o=hash3(i+g)*vec3(u,u,1.);vec2 d=g-f+o.xy;float w=pow(1.-smoothstep(0.,1.414,length(d)),k);a+=vec2(o.z*w,w);}return a.x/a.y;}vec3 voronoise3(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),voronoise(p-vec2(0.83,0.45),u,v));}vec3 voronoiseNormal(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),1.);}
#endif

#ifndef HSV_HELPERS
#define HSV_HELPERS 
vec3 hsv2rgb(vec3 c){vec4 K=vec4(1.,2./3.,1./3.,3.);vec3 p=abs(fract(c.xxx+K.xyz)*6.-K.www);return c.z*mix(K.xxx,clamp(p-K.xxx,0.,1.),c.y);}vec3 rgb2hsv(vec3 c){vec4 K=vec4(0.,-1./3.,2./3.,-1.);vec4 p=c.g<c.b?vec4(c.bg,K.wz):vec4(c.gb,K.xy);vec4 q=c.r<p.x?vec4(p.xyw,c.r):vec4(c.r,p.yzx);float d=q.x-min(q.w,q.y);float e=1.0e-10;return vec3(abs(q.z+(q.w-q.y)/(6.*d+e)),d/(q.x+e),q.x);}
#endif 

uniform vec4 thinBaseLayerFactors;
uniform vec4 thinNoiseLayerFactors;
uniform vec4 thinColorNoiseParams;
uniform float thinFilmFactor;
        `:""},shaderExtender:(c,e,i)=>{var s;if(!this.enabled||!(!((s=e.materialObject.userData._thinFilmLayer)===null||s===void 0)&&s.hasThinFilm))return;const a="#glMarker beforeAccumulation";c.fragmentShader=c.fragmentShader.replace(a,"vec3 incident=normalize(vViewPosition.xyz);float hWeight=1.-dot(normal,incident);vec3 noiseV=voronoise3(vUv.xy*thinColorNoiseParams.xy*60.,thinColorNoiseParams.z,thinColorNoiseParams.w);float hWeight2=1.-dot(normalize(noiseV),incident);vec3 film=hsv2rgb(vec3(fract(hWeight+thinBaseLayerFactors.x),thinBaseLayerFactors.y,thinBaseLayerFactors.z))*thinBaseLayerFactors.a;vec3 film2=hsv2rgb(vec3(fract(hWeight2+thinNoiseLayerFactors.x),thinNoiseLayerFactors.y,thinNoiseLayerFactors.z))*thinNoiseLayerFactors.a;film=(film+film2)/(thinBaseLayerFactors.a+thinNoiseLayerFactors.a);diffuseColor.rgb=mix(diffuseColor.rgb,film,thinFilmFactor);"+a),c.vertexUvs=!0},onObjectRender:(c,e)=>{var i;const s=(i=e.materialObject.userData)===null||i===void 0?void 0:i._thinFilmLayer;if(!(s!=null&&s.hasThinFilm))return;this._uniforms.thinBaseLayerFactors.value.fromArray(s.baseLayerFactors),this._uniforms.thinNoiseLayerFactors.value.fromArray(s.noiseLayerFactors),this._uniforms.thinColorNoiseParams.value.fromArray(s.colorNoiseParams),this._uniforms.thinFilmFactor.value=s.filmFactor;const a=this.enabled?1:0;e.materialObject.defines.THIN_FILM_LAYER_ENABLED!==a&&(e.materialObject.defines.THIN_FILM_LAYER_ENABLED=a,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:c=>{var e,i;return(this.enabled?"1":"0")+(!((i=(e=c.materialObject.userData)===null||e===void 0?void 0:e._thinFilmLayer)===null||i===void 0)&&i.hasThinFilm?"1":"0")},isCompatible:c=>c.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:c=>{const e=this._viewer,i={type:"folder",label:"ThinFilmLayer",children:[{type:"checkbox",label:"Enabled",get value(){var s;return((s=c.materialObject.userData._thinFilmLayer)===null||s===void 0?void 0:s.hasThinFilm)||!1},set value(s){var a,h;s!==((a=c.materialObject.userData._thinFilmLayer)===null||a===void 0?void 0:a.hasThinFilm)&&(s?Eh(c.materialObject)||e.alert("Cannot add thin film."):(c.materialObject.userData._thinFilmLayer.hasThinFilm=!1,c.materialObject.needsUpdate=!0),(h=i.uiRefresh)===null||h===void 0||h.call(i,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,1],label:"Intensity",hidden:()=>{var s;return!(!((s=c.materialObject.userData._thinFilmLayer)===null||s===void 0)&&s.hasThinFilm)},property:[c.materialObject.userData._thinFilmLayer,"filmFactor"],onChange:this.setDirty}),()=>({type:"vec4",label:"Base Layer",bounds:[0,1],hidden:()=>{var s;return!(!((s=c.materialObject.userData._thinFilmLayer)===null||s===void 0)&&s.hasThinFilm)},property:[c.materialObject.userData._thinFilmLayer,"baseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Layer",bounds:[0,1],hidden:()=>{var s;return!(!((s=c.materialObject.userData._thinFilmLayer)===null||s===void 0)&&s.hasThinFilm)},property:[c.materialObject.userData._thinFilmLayer,"noiseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Params",bounds:[0,1],hidden:()=>{var s;return!(!((s=c.materialObject.userData._thinFilmLayer)===null||s===void 0)&&s.hasThinFilm)},property:[c.materialObject.userData._thinFilmLayer,"colorNoiseParams"],onChange:this.setDirty})]};return i}},this.setDirty=()=>{var c;(c=this._viewer)===null||c===void 0||c.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}addThinFilmLayer(c){return Eh(c.materialObject)}_loaderCreate({loader:c}){c.isGLTFLoader2&&c.register(e=>new mm(e))}async onAdded(c){var e,i,s,a,h;await super.onAdded(c);const d=c.getPlugin(Kn);(e=d==null?void 0:d.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(i=d==null?void 0:d.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),(h=(a=(s=d==null?void 0:d.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||a===void 0?void 0:a.extensions)===null||h===void 0||h.push(gm)}async onRemove(c){var e,i,s,a;return(i=(e=c.getPlugin(Kn))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this.materialExtension),(a=(s=c.getPlugin(Kn))===null||s===void 0?void 0:s.importer)===null||a===void 0||a.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(c)}};function Eh(c){const e=c==null?void 0:c.userData;if(!e)return!1;e._thinFilmLayer||(e._thinFilmLayer={});const i=e._thinFilmLayer;return i.hasThinFilm=!0,i.baseLayerFactors===void 0&&(i.baseLayerFactors=[.3,.6,1,.9]),i.noiseLayerFactors===void 0&&(i.noiseLayerFactors=[.7,.5,.9,.7]),i.colorNoiseParams===void 0&&(i.colorNoiseParams=[.5,.5,.5,.7]),i.filmFactor===void 0&&(i.filmFactor=.3),c.isMaterial&&(c.needsUpdate=!0),!0}la.PluginType="ThinFilmLayerPlugin",la.THIN_FILM_LAYER_GLTF_EXTENSION="WEBGI_materials_thin_film_layer",Wp([Xn("Enabled",c=>({onChange:c.setDirty})),kt()],la.prototype,"enabled",void 0),la=Wp([ur("ThinFilmLayer Materials")],la);class mm{constructor(e){this.parser=e,this.name=la.THIN_FILM_LAYER_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name];return i.userData||(i.userData={}),Eh(i),i.userData._thinFilmLayer=bn(a,i.userData._thinFilmLayer,!1,{}),Promise.resolve()}}const gm=c=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._thinFilmLayer||!e.userData._thinFilmLayer.hasThinFilm)return;i.extensions=i.extensions||{};const s=qn(e.userData._thinFilmLayer,!1);i.extensions[la.THIN_FILM_LAYER_GLTF_EXTENSION]=s,c.extensionsUsed[la.THIN_FILM_LAYER_GLTF_EXTENSION]=!0}});var qp=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let ca=class extends Xi{constructor(){super(),this.enabled=!0,this.dependencies=[Kn],this._defines={},this._uniforms={noiseBumpParams:{value:new _.FM8},noiseBumpScale:{value:.05},noiseBumpFlakeScale:{value:1e3},noiseFlakeClamp:{value:1},noiseFlakeRadius:{value:.5},noiseFlakeRoughnessMod:{value:1}},this.materialExtension={parsFragmentSnippet:(c,e)=>{var i;return this.enabled&&(!((i=e==null?void 0:e.materialObject.userData._noiseBumpMat)===null||i===void 0)&&i.hasBump)?tc+`
#ifndef VORONOI_HELPER
#define VORONOI_HELPER 
float voronoi_distance(vec2 a,vec2 b,float metric){return distance(a,b);}float voronoi_f1_2d(in vec2 coord,in float randomness,in float flakeClamp,in float flakeRadius,inout vec3 outColor){vec2 cellPosition=floor(coord);vec2 localPosition=coord-cellPosition;float minDistance=8.;vec2 targetOffset,targetPosition;for(int j=-1;j<=1;j++){for(int i=-1;i<=1;i++){vec2 cellOffset=vec2(i,j);vec2 pointPosition=cellOffset+hash3(cellPosition+cellOffset).xy*randomness;float distanceToPoint=voronoi_distance(pointPosition,localPosition,1.);if(distanceToPoint<minDistance){targetOffset=cellOffset;minDistance=distanceToPoint;targetPosition=pointPosition;}}}float outDistance=minDistance;float dist=step(flakeRadius,outDistance);outColor=hash3(cellPosition+hash3(cellPosition+targetOffset).xy*randomness+targetOffset);vec3 outColor1=minDistance<flakeRadius?outColor:vec3(0.5,0.5,1.);outDistance=mix(dist,minDistance,flakeClamp);outColor=mix(outColor1,outColor,flakeClamp);return outDistance;}
#endif

uniform vec2 noiseBumpParams;uniform float noiseBumpScale;uniform float noiseBumpFlakeScale;uniform float noiseFlakeClamp;uniform float noiseFlakeRadius;uniform float noiseFlakeRoughnessMod;vec3 perturbNormalArb_nb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
`:""},shaderExtender:(c,e,i)=>{var s;if(!this.enabled||!(!((s=e.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump))return;const a="#glMarker beforeAccumulation";c.fragmentShader=c.fragmentShader.replace(a,`
            vec3 outColor; 
            float voronoiDist = clamp(voronoi_f1_2d( noiseBumpFlakeScale * noiseBumpParams.xy * vUv, 1., noiseFlakeClamp, noiseFlakeRadius, outColor ), 0.0, 1.0);
            normal = perturbNormalArb_nb( - vViewPosition, normal, (2. * outColor.xy - 1.) * noiseBumpScale, faceDirection ); 
            float avg = (outColor.r + outColor.g)*0.5; 
            diffuseColor *= (clamp(avg+0.5, 0.3, 1.));
            float roughnessModifier = mix(1. - avg, 1., noiseFlakeRoughnessMod);
            roughnessFactor *= roughnessModifier;
            
`+a),c.vertexUvs=!0,c.extensionDerivatives=!0},onObjectRender:(c,e)=>{var i;const s=(i=e.materialObject.userData)===null||i===void 0?void 0:i._noiseBumpMat;if(!(s!=null&&s.hasBump))return;this._uniforms.noiseBumpParams.value.fromArray(s.bumpNoiseParams),this._uniforms.noiseBumpScale.value=s.bumpScale,this._uniforms.noiseBumpFlakeScale.value=s.flakeScale,this._uniforms.noiseFlakeClamp.value=s.flakeClamp,this._uniforms.noiseFlakeRadius.value=s.flakeRadius,this._uniforms.noiseFlakeRoughnessMod.value=s.flakeRoughnessMod;const a=this.enabled?1:0;e.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED!==a&&(e.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED=a,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:c=>{var e,i;return(this.enabled?"1":"0")+(!((i=(e=c.materialObject.userData)===null||e===void 0?void 0:e._noiseBumpMat)===null||i===void 0)&&i.hasBump?"1":"0")},isCompatible:c=>c.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:c=>{const e=this._viewer,i={type:"folder",label:"NoiseBumpMaterial",children:[{type:"checkbox",label:"Enabled",get value(){var s;return((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0?void 0:s.hasBump)||!1},set value(s){var a,h;s!==((a=c.materialObject.userData._noiseBumpMat)===null||a===void 0?void 0:a.hasBump)&&(s?l_(c.materialObject)||e.alert("Cannot add noise bump."):(c.materialObject.userData._noiseBumpMat.hasBump=!1,c.materialObject.needsUpdate=!0),(h=i.uiRefresh)===null||h===void 0||h.call(i,"postFrame",!0))},onChange:this.setDirty},()=>({type:"vec4",label:"Bump Noise Params",bounds:[0,1],hidden:()=>{var s;return!(!((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump)},property:[c.materialObject.userData._noiseBumpMat,"bumpNoiseParams"],onChange:this.setDirty}),()=>({type:"slider",label:"Bump Scale",bounds:[0,.01],stepSize:1e-5,hidden:()=>{var s;return!(!((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump)},property:[c.materialObject.userData._noiseBumpMat,"bumpScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Scale",bounds:[100,1e4],stepSize:1e-4,hidden:()=>{var s;return!(!((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump)},property:[c.materialObject.userData._noiseBumpMat,"flakeScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Clamp",bounds:[0,1],stepSize:1,hidden:()=>{var s;return!(!((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump)},property:[c.materialObject.userData._noiseBumpMat,"flakeClamp"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Radius",bounds:[.1,1],stepSize:.01,hidden:()=>{var s;return!(!((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump)},property:[c.materialObject.userData._noiseBumpMat,"flakeRadius"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Roughness Modifier",bounds:[0,1],stepSize:1,hidden:()=>{var s;return!(!((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump)},property:[c.materialObject.userData._noiseBumpMat,"flakeRoughnessMod"],onChange:this.setDirty})]};return i}},this.setDirty=()=>{var c;(c=this._viewer)===null||c===void 0||c.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}addNoiseBumpMaterial(c){return l_(c.materialObject)}_loaderCreate({loader:c}){c.isGLTFLoader2&&c.register(e=>new vy(e))}async onAdded(c){var e,i,s,a,h;await super.onAdded(c);const d=c.getPlugin(Kn);(e=d==null?void 0:d.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(i=d==null?void 0:d.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),(h=(a=(s=d==null?void 0:d.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||a===void 0?void 0:a.extensions)===null||h===void 0||h.push(Ay)}async onRemove(c){var e,i,s,a;return(i=(e=c.getPlugin(Kn))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this.materialExtension),(a=(s=c.getPlugin(Kn))===null||s===void 0?void 0:s.importer)===null||a===void 0||a.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(c)}};function l_(c){const e=c==null?void 0:c.userData;if(!e)return!1;e._noiseBumpMat||(e._noiseBumpMat={});const i=e._noiseBumpMat;return i.hasBump=!0,i.bumpNoiseParams===void 0&&(i.bumpNoiseParams=[.5,.5]),i.bumpScale===void 0&&(i.bumpScale=.05),i.flakeScale===void 0&&(i.flakeScale=.05),i.flakeClamp===void 0&&(i.flakeClamp=1),i.flakeRadius===void 0&&(i.flakeRadius=.3),i.flakeRoughnessMod===void 0&&(i.flakeRoughnessMod=1),c.isMaterial&&(c.needsUpdate=!0),!0}ca.PluginType="NoiseBumpMaterialPlugin",ca.NOISE_BUMP_MATERIAL_GLTF_EXTENSION="WEBGI_materials_noise_bump",qp([Xn("Enabled",c=>({onChange:c.setDirty})),kt()],ca.prototype,"enabled",void 0),ca=qp([ur("NoiseBumpMaterial Materials")],ca);class vy{constructor(e){this.parser=e,this.name=ca.NOISE_BUMP_MATERIAL_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name];return i.userData||(i.userData={}),l_(i),i.userData._noiseBumpMat=bn(a,i.userData._noiseBumpMat,!1,{}),Promise.resolve()}}const Ay=c=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._noiseBumpMat||!e.userData._noiseBumpMat.hasBump)return;i.extensions=i.extensions||{};const s=qn(e.userData._noiseBumpMat,!1);i.extensions[ca.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=s,c.extensionsUsed[ca.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=!0}});var c_,_m=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let ua=c_=class extends Xi{constructor(){super(),this.enabled=!0,this.dependencies=[Kn],this.bicubicFiltering=!0,this._defines={CUSTOM_BUMP_MAP_DEBUG:!1,CUSTOM_BUMP_MAP_BICUBIC:!0},this._uniforms={customBumpUvTransform:{value:new _.Vkp},customBumpScale:{value:.001},customBumpMap:{value:null}},this.materialExtension={parsFragmentSnippet:(c,e)=>this.enabled&&(e!=null&&e.materialObject.userData._hasCustomBump)?`#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
#if CUSTOM_BUMP_MAP_BICUBIC > 0  
vec4 cubic(float v){vec4 n=vec4(1.,2.,3.,4.)-v;vec4 s=n*n*n;float x=s.x;float y=s.y-4.*s.x;float z=s.z-4.*s.y+6.*s.x;float w=6.-x-y-z;return vec4(x,y,z,w)*(1./6.);}vec4 textureBicubic(sampler2D sampler,vec2 texCoords){vec2 texSize=vec2(textureSize(sampler,0));vec2 invTexSize=1./texSize;texCoords=texCoords*texSize-0.5;vec2 fxy=fract(texCoords);texCoords-=fxy;vec4 xcubic=cubic(fxy.x);vec4 ycubic=cubic(fxy.y);vec4 c=texCoords.xxyy+vec2(-0.5,+1.5).xyxy;vec4 s=vec4(xcubic.xz+xcubic.yw,ycubic.xz+ycubic.yw);vec4 offset=c+vec4(xcubic.yw,ycubic.yw)/s;offset*=invTexSize.xxyy;vec4 sample0=texture(sampler,offset.xz);vec4 sample1=texture(sampler,offset.yz);vec4 sample2=texture(sampler,offset.xw);vec4 sample3=texture(sampler,offset.yw);float sx=s.x/(s.x+s.y);float sy=s.z/(s.z+s.w);return mix(mix(sample3,sample2,sx),mix(sample1,sample0,sx),sy);}
#endif
varying vec2 vCustomBumpUv;uniform sampler2D customBumpMap;uniform float customBumpScale;vec2 dHdxy_fwd_cb(){vec2 dSTdx=dFdx(vCustomBumpUv);vec2 dSTdy=dFdy(vCustomBumpUv);
#if CUSTOM_BUMP_MAP_BICUBIC > 0
float Hll=customBumpScale*textureBicubic(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*textureBicubic(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*textureBicubic(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#else
float Hll=customBumpScale*texture2D(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#endif
return vec2(dBx,dBy);}
#ifndef USE_BUMPMAP
vec3 perturbNormalArb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
#endif
#endif
`:"",shaderExtender:(c,e,i)=>{var s;this.enabled&&e.materialObject.userData._hasCustomBump&&(!((s=e.materialObject.userData)===null||s===void 0)&&s._customBumpMap)&&(c.fragmentShader=gs(c.fragmentShader,"#glMarker beforeAccumulation",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
    normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd_cb(), faceDirection );
#endif
                `,{prepend:!0}),c.vertexShader=gs(c.vertexShader,"#include <uv_pars_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                varying vec2 vCustomBumpUv;
                uniform mat3 customBumpUvTransform;
#endif
                `,{prepend:!0}),c.vertexShader=gs(c.vertexShader,"#include <uv_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                vCustomBumpUv = ( customBumpUvTransform * vec3( uv, 1 ) ).xy;
#endif
                `,{prepend:!0}),c.vertexUvs=!0)},onObjectRender:(c,e)=>{var i;const s=e.materialObject.userData;if(!(s!=null&&s._hasCustomBump))return;const a=c;if(!a.isMesh||!a.geometry)return;const h=!((i=s._customBumpMap)===null||i===void 0)&&i.isTexture?s._customBumpMap:null;this._uniforms.customBumpMap.value=h,this._uniforms.customBumpScale.value=h?s._customBumpScale:0,h&&(h.updateMatrix(),this._uniforms.customBumpUvTransform.value.copy(h.matrix));let d=this.enabled&&h?1:0;e.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED!==d&&(e.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED=d,e.materialObject.needsUpdate=!0),d=+this._defines.CUSTOM_BUMP_MAP_DEBUG,e.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG!==d&&(e.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG=d,e.materialObject.needsUpdate=!0),d=+this._defines.CUSTOM_BUMP_MAP_BICUBIC,e.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC!==d&&(e.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC=d,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:c=>{var e,i,s;return(this.enabled?"1":"0")+(!((e=c.materialObject.userData)===null||e===void 0)&&e._hasCustomBump?"1":"0")+((s=(i=c.materialObject.userData)===null||i===void 0?void 0:i._customBumpMap)===null||s===void 0?void 0:s.uuid)},isCompatible:c=>c.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:c=>{const e=this._viewer,i=this.enableCustomBump,s={type:"folder",label:"CustomBumpMap",children:[{type:"checkbox",label:"Enabled",get value(){return c.materialObject.userData._hasCustomBump||!1},set value(a){var h;a!==c.materialObject.userData._hasCustomBump&&(a?i(c)||e.alert("One or more geometries cannot be made anisotropic."):(c.materialObject.userData._hasCustomBump=!1,c.materialObject.needsUpdate=!0),(h=s.uiRefresh)===null||h===void 0||h.call(s,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Bump Scale",hidden:()=>!c.materialObject.userData._hasCustomBump,property:[c.materialObject.userData,"_customBumpScale"],onChange:this.setDirty},{type:"image",label:"Bump Map",hidden:()=>!c.materialObject.userData._hasCustomBump,property:[c.materialObject.userData,"_customBumpMap"],onChange:()=>{c.materialObject.needsUpdate=!0,this.setDirty()}},Er(c.materialObject.userData,"_customBumpMap")]};return s}},this.setDirty=()=>{var c,e,i;(e=(c=this.materialExtension).setDirty)===null||e===void 0||e.call(c),(i=this._viewer)===null||i===void 0||i.setDirty()},this.enableCustomBumpSelected=()=>{var c,e,i;const s=(i=(e=(c=this._viewer)===null||c===void 0?void 0:c.getPlugin(br))===null||e===void 0?void 0:e.getSelectedObject())===null||i===void 0?void 0:i.material;return(s==null?void 0:s.assetType)==="material"&&this.enableCustomBump(s)},this._loaderCreate=this._loaderCreate.bind(this)}enableCustomBump(c,e,i){var s,a;const h=(s=c.materialObject)===null||s===void 0?void 0:s.userData;if(!h)return!1;if(h._hasCustomBump===void 0){const d=h.__appliedMeshes;let b=!0;if(d)for(const{geometry:X}of d)!X||X.attributes.position&&X.attributes.normal&&X.attributes.uv||(b=!1);if(!b)return!1}return h._hasCustomBump=!0,h._customBumpScale=(a=i??h._customBumpScale)!==null&&a!==void 0?a:.001,h._customBumpMap=e??h._customBumpMap,c.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:c}){c.isGLTFLoader2&&c.register(e=>new yy(e))}async onAdded(c){var e,i,s,a,h;await super.onAdded(c);const d=c.getPlugin(Kn);(e=d==null?void 0:d.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(i=d==null?void 0:d.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),(h=(a=(s=d==null?void 0:d.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||a===void 0?void 0:a.extensions)===null||h===void 0||h.push(by)}async onRemove(c){var e,i,s,a;return(i=(e=c.getPlugin(Kn))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this.materialExtension),(a=(s=c.getPlugin(Kn))===null||s===void 0?void 0:s.importer)===null||a===void 0||a.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(c)}};ua.PluginType="CustomBumpMapPlugin",ua.CUSTOM_BUMP_MAP_GLTF_EXTENSION="WEBGI_materials_custom_bump_map",_m([Xn("Enabled",c=>({onChange:c.setDirty})),kt()],ua.prototype,"enabled",void 0),_m([Xn("Bicubic",c=>({onChange:c.setDirty})),Rt("CUSTOM_BUMP_MAP_BICUBIC",void 0,!0,c_.prototype.setDirty),kt()],ua.prototype,"bicubicFiltering",void 0),_m([lr("Enable CustomBumpMap",c=>({hidden:()=>{var e;return!(!((e=c._viewer)===null||e===void 0)&&e.getPlugin(br))}}))],ua.prototype,"enableCustomBumpSelected",void 0),ua=c_=_m([ur("CustomBumpMap Materials")],ua);class yy{constructor(e){this.parser=e,this.name=ua.CUSTOM_BUMP_MAP_GLTF_EXTENSION}async extendMaterialParams(e,i){var s;const a=this.parser,h=a.json.materials[e];if(!h.extensions||!h.extensions[this.name])return Promise.resolve();const d=[],b=h.extensions[this.name];i.userData||(i.userData={}),i.userData._hasCustomBump=!0,i.userData._customBumpScale=(s=b.customBumpScale)!==null&&s!==void 0?s:0;const X=b.customBumpMap;return X&&d.push(a.assignTexture(i.userData,"_customBumpMap",X).then($=>{$.encoding=_.knz})),Promise.all(d)}}const by=c=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._hasCustomBump||(e.userData._customBumpScale||0)<.001)return;i.extensions=i.extensions||{};const s={};if(s.customBumpScale=e.userData._customBumpScale||1,e.userData._customBumpMap){const a={index:c.processTexture(e.userData._customBumpMap)};c.applyTextureTransform(a,e.userData._customBumpMap),s.customBumpMap=a}i.extensions[ua.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=s,c.extensionsUsed[ua.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=!0}});var v0=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Ml=class extends Xi{constructor(){super(),this.enabled=!0,this.dependencies=[Kn],this._defines={},this._uniforms={ccTintColor:{value:new oi},ccThickness:{value:0},ccIor:{value:0}},this.materialExtension={parsFragmentSnippet:(c,e)=>{var i;return this.enabled&&(!((i=e==null?void 0:e.materialObject.userData._clearcoatTint)===null||i===void 0)&&i.enableTint)&&e.materialObject.clearcoat>0?`
uniform vec3 ccTintColor;
uniform float ccThickness;
uniform float ccIor;
vec3 clearcoatTint(const in float dotNV, const in float dotNL, const in float clearcoat) {
    vec3 tint = ( ccThickness > 0. ? 1. - ccTintColor : ccTintColor); // Set thickness < 0 for glow.
    tint = exp(tint * -(ccThickness * ((dotNL + dotNV) / max(dotNL * dotNV, 1e-3)))); // beer's law
    return mix(vec3(1.0), tint, clearcoat);
}
        `:""},shaderExtender:(c,e,i)=>{var s;if(!(this.enabled&&(!((s=e==null?void 0:e.materialObject.userData._clearcoatTint)===null||s===void 0)&&s.enableTint)&&e.materialObject.clearcoat>0))return;const a="outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;",h="float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );";c.fragmentShader.includes(h)&&c.fragmentShader.includes(a)||console.error("ClearcoatTintPlugin: shaderExtender cannot patch shader, version changed?"),c.fragmentShader=c.fragmentShader.replace(h,`
            float dotNVcc = saturate( dot( geometry.clearcoatNormal, -refract(geometry.viewDir, geometry.clearcoatNormal, 1./ccIor) ) );
            `),c.fragmentShader=c.fragmentShader.replace(a,`
            outgoingLight *= clearcoatTint(dotNVcc, dotNVcc, material.clearcoat);
            `+a),c.vertexUvs=!0},onObjectRender:(c,e)=>{var i;const s=(i=e.materialObject.userData)===null||i===void 0?void 0:i._clearcoatTint;if(!(s!=null&&s.enableTint))return;this._uniforms.ccTintColor.value.set(s.tintColor),this._uniforms.ccThickness.value=s.thickness,this._uniforms.ccIor.value=s.ior;const a=this.enabled?1:0;e.materialObject.defines.CLEARCOAT_TINT_ENABLED!==a&&(e.materialObject.defines.CLEARCOAT_TINT_ENABLED=a,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:c=>{var e,i;return(this.enabled?"1":"0")+(!((i=(e=c.materialObject.userData)===null||e===void 0?void 0:e._clearcoatTint)===null||i===void 0)&&i.enableTint?"1":"0")+(c.materialObject.clearcoat>0?"1":"0")},isCompatible:c=>c.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:c=>{const e=this._viewer,i={type:"folder",label:"ClearcoatTint",children:[{type:"checkbox",label:"Enabled",get value(){var s;return((s=c.materialObject.userData._clearcoatTint)===null||s===void 0?void 0:s.enableTint)||!1},set value(s){var a,h;s!==((a=c.materialObject.userData._clearcoatTint)===null||a===void 0?void 0:a.enableTint)&&(s?u_(c.materialObject)||e.alert("Cannot add clearcoat tint."):(c.materialObject.userData._clearcoatTint.enableTint=!1,c.materialObject.needsUpdate=!0),(h=i.uiRefresh)===null||h===void 0||h.call(i,"postFrame",!0))},onChange:this.setDirty},()=>({type:"color",label:"Tint color",hidden:()=>{var s;return!(!((s=c.materialObject.userData._clearcoatTint)===null||s===void 0)&&s.enableTint)},property:[c.materialObject.userData._clearcoatTint,"tintColor"],onChange:this.setDirty}),()=>({type:"input",label:"Thickness",hidden:()=>{var s;return!(!((s=c.materialObject.userData._clearcoatTint)===null||s===void 0)&&s.enableTint)},property:[c.materialObject.userData._clearcoatTint,"thickness"],onChange:this.setDirty}),()=>({type:"slider",bounds:[.8,2.5],label:"IOR",hidden:()=>{var s;return!(!((s=c.materialObject.userData._clearcoatTint)===null||s===void 0)&&s.enableTint)},property:[c.materialObject.userData._clearcoatTint,"ior"],onChange:this.setDirty})]};return i}},this.setDirty=()=>{var c;(c=this._viewer)===null||c===void 0||c.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}addClearcoatTint(c){return u_(c.materialObject)}_loaderCreate({loader:c}){c.isGLTFLoader2&&c.register(e=>new wy(e))}async onAdded(c){var e,i,s,a,h;await super.onAdded(c);const d=c.getPlugin(Kn);(e=d==null?void 0:d.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(i=d==null?void 0:d.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),(h=(a=(s=d==null?void 0:d.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||a===void 0?void 0:a.extensions)===null||h===void 0||h.push(xy)}async onRemove(c){var e,i,s,a;return(i=(e=c.getPlugin(Kn))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this.materialExtension),(a=(s=c.getPlugin(Kn))===null||s===void 0?void 0:s.importer)===null||a===void 0||a.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(c)}};function u_(c){const e=c==null?void 0:c.userData;if(!e)return!1;e._clearcoatTint||(e._clearcoatTint={});const i=e._clearcoatTint;return i.enableTint=!0,i.tintColor===void 0&&(i.tintColor=16777215),i.thickness===void 0&&(i.thickness=.1),i.ior===void 0&&(i.ior=1.5),c.isMaterial&&(c.needsUpdate=!0),!0}Ml.PluginType="ClearcoatTintPlugin",Ml.CLEARCOAT_TINT_GLTF_EXTENSION="WEBGI_materials_clearcoat_tint",v0([Xn("Enabled",c=>({onChange:c.setDirty})),kt()],Ml.prototype,"enabled",void 0),Ml=v0([ur("ClearcoatTint Materials")],Ml);class wy{constructor(e){this.parser=e,this.name=Ml.CLEARCOAT_TINT_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name];return i.userData||(i.userData={}),u_(i),i.userData._clearcoatTint=bn(a,i.userData._clearcoatTint,!1,{}),Promise.resolve()}}const xy=c=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._clearcoatTint||!e.userData._clearcoatTint.enableTint)return;i.extensions=i.extensions||{};const s=qn(e.userData._clearcoatTint,!1);i.extensions[Ml.CLEARCOAT_TINT_GLTF_EXTENSION]=s,c.extensionsUsed[Ml.CLEARCOAT_TINT_GLTF_EXTENSION]=!0}});var el=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Wc=class extends ih{constructor(c,e,i){super(c,e,i??new A0,new oi(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(c,e,i,s,a){if(!this.enabled)return;const h=this.overrideMaterial;h.uniforms.currentProjectionViewMatrix.value.copy(this.camera.projectionMatrix).multiply(this.camera.matrixWorldInverse),this._firstCall&&(h.uniforms.lastProjectionViewMatrix.value.copy(h.uniforms.currentProjectionViewMatrix.value),this._firstCall=!1),super.render(c,e,i,s,a),h.uniforms.lastProjectionViewMatrix.value.copy(h.uniforms.currentProjectionViewMatrix.value)}};el([Xn("Enabled")],Wc.prototype,"enabled",void 0),Wc=el([ur("Velocity Buffer (TAA)")],Wc);class A0 extends _.jyz{constructor(){super({vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 modelMatrixPrevious;void main(){
#include <uv_vertex>
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
vec4 mvPosition=vec4(transformed,1.);
#ifdef USE_INSTANCING
mvPosition=instanceMatrix*mvPosition;
#endif
vWorldPosition=(modelMatrix*mvPosition).xyz;vWorldPositionPrevious=(modelMatrixPrevious*mvPosition).xyz;mvPosition=modelViewMatrix*mvPosition;gl_Position=projectionMatrix*mvPosition;
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
}`,fragmentShader:"varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 currentProjectionViewMatrix;uniform mat4 lastProjectionViewMatrix;vec2 computeScreenSpaceVelocity2(){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(vWorldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(vWorldPositionPrevious,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}void main(){vec2 velocity=clamp(computeScreenSpaceVelocity2(),-1.,1.);velocity=sign(velocity)*pow(abs(velocity),vec2(1./4.));velocity=velocity*0.5+0.5;gl_FragColor=vec4(velocity.x,velocity.y,1.,1.);}",uniforms:{cameraNearFar:{value:new _.FM8(.1,1e3)},alphaMap:{value:null},alphaTest:{value:null},currentProjectionViewMatrix:{value:new _.yGw},lastProjectionViewMatrix:{value:new _.yGw}}}),this.extraUniformsToUpload={modelMatrixPrevious:{value:new _.yGw().identity()}},this._previousWorldMatrices={}}onBeforeRender(e,i,s,a,h){var d,b;const X=this._previousWorldMatrices[h.uuid];this.extraUniformsToUpload.modelMatrixPrevious.value.copy(X??h.matrixWorld),X?X.copy(h.matrixWorld):this._previousWorldMatrices[h.uuid]=h.matrixWorld.clone();let $=h.material;Array.isArray($)&&($=$[0]),this.uniforms.alphaMap.value=(d=$==null?void 0:$.alphaMap)!==null&&d!==void 0?d:null,this.uniforms.alphaTest.value=!$||!$.alphaTest||$.alphaTest<1e-7?.001:$.alphaTest;let Z=this.uniforms.alphaMap.value?1:void 0;Z!==this.defines.USE_ALPHAMAP&&(Z===void 0?delete this.defines.USE_ALPHAMAP:this.defines.USE_ALPHAMAP=Z,this.needsUpdate=!0),Z=$.userData.ALPHA_I_RGBA_PACKING?1:void 0,Z!==this.defines.ALPHA_I_RGBA_PACKING&&(Z===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=Z,this.needsUpdate=!0),this.side=(b=$.side)!==null&&b!==void 0?b:_.ehD}}class vm extends Sl{constructor(e=!0){super(),this.passId="velocityBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._velocityBuffers=[],this.enabled=e}passCtor(e){const i=e.renderer.createTarget({depthBuffer:!0,type:_.ywz});i.texture.name="velocityBuffer",this._velocityBuffers.push(i),e.getPluginByType("debug");const s=new Set,a=new Set;return new class extends Wc{render(h,d,b,X,$){if(e.renderer.frameCount>0)return;const Z=h.getRenderTarget(),re=h.getActiveCubeFace(),le=h.getActiveMipmapLevel();this.scene.traverse(({material:he})=>{he&&((he.transparent&&he.userData.renderToDepth||!he.transparent&&he.transmission===0&&he.userData.renderToDepth===!1)&&(s.add(he),he.transparent=!he.transparent),Math.abs(he.transmission||0)>0&&he.userData.renderToDepth&&(a.add([he,he.transmission]),he.transmission=0))}),Rn(h,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(h,d,i,X,$)),s.forEach(he=>he.transparent=!he.transparent),s.clear(),a.forEach(([he,fe])=>he.transmission=fe),a.clear(),h.setRenderTarget(Z,re,le)}}}_update(e){if(!super._update(e)||e.renderer.frameCount>0)return!1;const i=this.pass.passObject;return i.scene=e.scene.modelObject,e.scene.activeCamera.updateShaderProperties(i.overrideMaterial),i.camera=e.scene.activeCamera.cameraObject,!0}getVelocityBuffer(){return this._velocityBuffers.length>0?this._velocityBuffers[0]:void 0}async onDispose(e){}async onRemove(e){return this._velocityBuffers.forEach(i=>{var s;return e.renderer.disposeTarget((s=i==null?void 0:i.dispose)===null||s===void 0?void 0:s.call(i))}),super.onRemove(e)}updateShaderProperties(e){var i,s;return e.uniforms.tVelocity?e.uniforms.tVelocity.value=this.enabled&&(s=(i=this.getVelocityBuffer())===null||i===void 0?void 0:i.texture)!==null&&s!==void 0?s:null:console.warn("BaseRenderer: no uniform: tVelocity"),this}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}vm.PluginType="VelocityBuffer";class h_ extends Fs{constructor(e,i){super({vertexShader:ae.vertexShader,fragmentShader:i+`
`+Qf+`
#include <common>
varying vec2 vUv;uniform vec2 previousRTSize;uniform mat4 lastProjectionViewMatrix;uniform mat4 currentProjectionViewMatrix;uniform mat4 inverseViewMatrix;uniform vec2 jitterSample;uniform vec2 feedBack;uniform bool firstFrame;
#if HAS_VELOCITY_BUFFER == 1
uniform sampler2D tVelocity;
#endif
vec3 find_closest_fragment_3x3(const in vec2 uv){const vec3 offset=vec3(-1.,1.,0.);vec2 texelSize=1./previousRTSize;vec3 dtr=vec3(-1,1,getDepth(uv+offset.yx*texelSize));vec3 dtc=vec3(0,1,getDepth(uv+offset.zx*texelSize));vec3 dtl=vec3(1,1,getDepth(uv+offset.xx*texelSize));vec3 dml=vec3(-1,0,getDepth(uv+offset.yz*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dmr=vec3(1,0,getDepth(uv+offset.xz*texelSize));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.yy*texelSize));vec3 dbc=vec3(0,-1,getDepth(uv+offset.zy*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.xy*texelSize));vec3 dmin=dtl;if(dmin.z>dtc.z)dmin=dtc;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dml.z)dmin=dml;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dmr.z)dmin=dmr;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbc.z)dmin=dbc;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+texelSize.xy*dmin.xy,dmin.z);}vec3 find_closest_fragment_5tap(const in vec2 uv){vec2 texelSize=1./previousRTSize;vec2 offset=vec2(1.,-1.);vec3 dtl=vec3(-1,1,getDepth(uv+offset.yx*texelSize));vec3 dtr=vec3(1,1,getDepth(uv+offset.xx*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.yy*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.xy*texelSize));vec3 dmin=dtl;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+dmin.xy*texelSize,dmin.z);}vec4 clip_aabb(const in vec4 aabb_min,const in vec4 aabb_max,vec4 p){const float FLT_EPS=1e-8;vec4 p_clip=0.5*(aabb_max+aabb_min);vec4 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=p-p_clip;vec4 v_unit=abs(v_clip/e_clip);float ma_unit=max(v_unit.x,max(v_unit.y,v_unit.z));if(ma_unit>1.)return p_clip+v_clip/ma_unit;else return p;}
#if HAS_VELOCITY_BUFFER == 0
vec2 computeScreenSpaceVelocity(const in vec3 worldPosition){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(worldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(worldPosition,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}
#endif
vec4 computeTAA(const in vec2 uv,const in vec2 screenSpaceVelocity){vec2 jitterOffset=jitterSample/previousRTSize;vec2 uvUnJitter=uv;vec4 currentColor=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter));vec4 previousColor=previousRTTexelToLinear(texture2D(previousRT,uv-screenSpaceVelocity));const vec3 offset=vec3(1.,-1.,0.);vec2 texelSize=1./previousRTSize;float texelSpeed=length(screenSpaceVelocity);vec4 tl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yx*texelSize));vec4 tc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zx*texelSize));vec4 tr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xx*texelSize));vec4 ml=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yz*texelSize));vec4 mc=currentColor;vec4 mr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xz*texelSize));vec4 bl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yy*texelSize));vec4 bc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zy*texelSize));vec4 br=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xy*texelSize));vec4 corners=2.*(tr+bl+br+tl)-2.*mc;mc+=(mc-(corners*0.166667))*2.718282*0.3;mc=max(vec4(0.),mc);vec4 min5=min(tc,min(ml,min(mc,min(mr,bc))));vec4 max5=max(tc,max(ml,max(mc,max(mr,bc))));vec4 cmin=min(min5,min(tl,min(tr,min(bl,br))));vec4 cmax=max(min5,max(tl,max(tr,max(bl,br))));;cmin=0.5*(cmin+min5);cmax=0.5*(cmax+max5);previousColor=clip_aabb(cmin,cmax,previousColor);float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColor.rgb);float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedBack.x,feedBack.y,unbiased_weight_sqr);return mix(currentColor,previousColor,k_feedback);}vec3 getWorldPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return(inverseViewMatrix*vec4(xe,ye,viewDepth,1.)).xyz;}void main(){vec2 jitterOffset=jitterSample/previousRTSize;
#if QUALITY == 1
vec3 c_frag=find_closest_fragment_3x3(vUv);
#else
vec3 c_frag=find_closest_fragment_5tap(vUv);
#endif
if(c_frag.z>=0.999){gl_FragColor=currentRTTexelToLinear(texture2D(currentRT,vUv-jitterOffset));}else{float sampleViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,c_frag.z);vec3 worldPosition=getWorldPositionFromViewZ(c_frag.xy,sampleViewZ);
#if HAS_VELOCITY_BUFFER == 0
vec2 screenSpaceVelocity=computeScreenSpaceVelocity(worldPosition);
#else
vec2 screenSpaceVelocity=(texture2D(tVelocity,vUv).xy*2.-1.);screenSpaceVelocity=sign(screenSpaceVelocity)*pow(abs(screenSpaceVelocity),vec2(4.));
#endif
gl_FragColor=firstFrame?currentRTTexelToLinear(texture2D(currentRT,vUv)):computeTAA(vUv,screenSpaceVelocity);}
#include <encodings_fragment>
}`,uniforms:{currentRT:{value:null},previousRT:{value:null},previousRTSize:{value:new _.FM8},cameraNearFar:{value:new _.FM8},lastProjectionViewMatrix:{value:new _.yGw},currentProjectionViewMatrix:{value:new _.yGw},projection:{value:new _.yGw},inverseViewMatrix:{value:new _.yGw},jitterSample:{value:new _.FM8},firstFrame:{value:!0},tNormalDepth:{value:null},tVelocity:{value:null}},defines:{HAS_VELOCITY_BUFFER:0,QUALITY:1,UNJITTER:0}},"currentRT","previousRT"),this.taaEnabled=!0,this.feedBack=new _.FM8(.88,.97),this.uiConfig={type:"folder",label:"Temporal AA",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:()=>this.onSizeUpdate()},{type:"input",label:"Feedback",property:[this,"feedBack"],onChange:this.setDirty}]},this.onSizeUpdate=this.onSizeUpdate.bind(this),this.target=e,this.clear=!1,this.needsSwap=!0}render(e,i,s,a,h){if(!this.taaEnabled||!this.enabled)return void(this.needsSwap=!1);this.needsSwap=!0;const d=this.uniforms.tVelocity.value?1:0;d!==this.material.defines.HAS_VELOCITY_BUFFER&&(this.material.defines.HAS_VELOCITY_BUFFER=d,this.material.needsUpdate=!0),this.uniforms.previousRT.value=this.target.texture,super.render(e,i,s,a,h),this.uniforms.lastProjectionViewMatrix.value.copy(this.uniforms.currentProjectionViewMatrix.value),this.uniforms.firstFrame.value=!1}updateCameraProperties(e){e&&(this.uniforms.currentProjectionViewMatrix.value.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this.uniforms.inverseViewMatrix.value.copy(e.matrixWorld))}onSizeUpdate(){this.uniforms.firstFrame.value=!0,this.setDirty()}setSize(e,i){super.setSize(e,i),this.onSizeUpdate()}}(function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);h>3&&d&&Object.defineProperty(e,i,d)})([kt(),ot()],h_.prototype,"feedBack",void 0);class Yp extends Sl{constructor(){super(...arguments),this.passId="taa",this._beforeFilters=["progressive"],this._afterFilters=[],this._requiredFilters=["render","progressive"],this.dependencies=[Or]}passCtor(e){if(!e.getPlugin(Ho))throw"Add ProgressivePlugin before TAA";const i=new h_(e.getPlugin(Ho).lastFrame,e.getPlugin(Or).getUnpackSnippet());return e.renderer.addEventListener("resize",i.onSizeUpdate),i}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}async onDispose(e){return this.pass&&e.renderer.removeEventListener("resize",this.pass.passObject.onSizeUpdate),super.onDispose(e)}_update(e){if(!super._update(e))return!1;const i=e.renderer.frameCount,s=this._pass.passObject;if(s.taaEnabled=i<1,!s.taaEnabled)return!1;const a=e.scene.activeCamera;return s.updateShaderProperties([e.getPlugin(Or),a,e.getPluginByType("VelocityBuffer")]),s.target=e.getPlugin(Ho).lastFrame,s.updateCameraProperties(a==null?void 0:a.cameraObject),!0}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}Yp.PluginType="TAA";class Ey{static async GetDataUrl(e,{mimeType:i="image/png",rect:s={x:0,y:0,width:e.width,height:e.height,assumeClientRect:!1},displayPixelRatio:a=1,scale:h=1}){var d,b,X;const $=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");$.width=s.width*h*a,$.height=s.height*h*a,s.assumeClientRect&&(s.x*=e.width/(a*e.clientWidth),s.y*=e.height/(a*e.clientHeight),s.width*=e.width/(a*e.clientWidth),s.height*=e.height/(a*e.clientHeight));const Z=$.getContext("2d");if(!Z)return console.error("snapshot: cannot create context"),"";const re=e.style.background||((d=e.parentElement)===null||d===void 0?void 0:d.style.background)||"";if(re.includes("url")){const he=(b=/url\("(.*)"\)/gi.exec(re))===null||b===void 0?void 0:b[1];if(he){const fe=new Image;fe.src=he,await new Promise((me,Ee)=>{fe.onload=()=>me(),fe.onerror=()=>Ee(),fe.complete&&me()}),Z.drawImage(fe,fe.width*s.x*a/e.width,fe.height*s.y*a/e.height,fe.width*s.width*a/e.width,fe.height*s.height*a/e.height,0,0,$.width,$.height)}}else Z.fillStyle=e.style.background||((X=e.parentElement)===null||X===void 0?void 0:X.style.backgroundColor)||"#00000000",Z.fillRect(0,0,$.width,$.height);Z==null||Z.drawImage(e,s.x*a,s.y*a,s.width*a,s.height*a,0,0,$.width,$.height);const le=Z.canvas.toDataURL(i);return $.remove(),le}static async GetImage(e,i={}){const s=await this.GetDataUrl(e,i);return new Promise((a,h)=>{const d=new Image;d.onload=()=>{a(d)},d.src=s})}static async GetBlob(e,i={}){return await(await fetch(await this.GetDataUrl(e,i))).blob()}static async GetFile(e,i="image.png",s={}){var a;return s.getDataUrl?await this.GetDataUrl(e,s):new File([await this.GetBlob(e,s)],i,{type:(a=s.mimeType)!==null&&a!==void 0?a:"image/png",lastModified:ia()})}}var Xp=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Pu=class extends Xi{constructor(){super(),this.enabled=!0,this.downloadSnapshot=this.downloadSnapshot.bind(this)}async getFile(c,e={}){return e.getDataUrl=!1,await this._getFile(c,e)}async getDataUrl(c={}){var e;return c.getDataUrl=!0,(e=await this._getFile("",c))!==null&&e!==void 0?e:""}async _getFile(c,e={}){var i,s,a;const h=(i=this._viewer)===null||i===void 0?void 0:i.canvas;if(h){const d=this._viewer.renderer.displayCanvasScaling;e.displayPixelRatio!==void 0&&e.displayPixelRatio!==d&&(this._viewer.renderer.displayCanvasScaling=e.displayPixelRatio);const b=(s=this._viewer)===null||s===void 0?void 0:s.getPlugin(Ho);if(e.waitForProgressive&&b&&e.timeout===void 0)for(;!b.isConverged(!0);)await eo(64);else await eo((a=e.timeout)!==null&&a!==void 0?a:200);e.displayPixelRatio=1;const X=await Ey.GetFile(h,c,e);return e.displayPixelRatio=this._viewer.renderer.displayCanvasScaling,this._viewer.renderer.displayCanvasScaling=d,X}}async downloadSnapshot(c="snapshot.png",e={}){const i=await this.getFile(c,e);i&&zl(i)}};Pu.PluginType="CanvasSnipper",Xp([lr("Download .png",{limitedUi:!0})],Pu.prototype,"downloadSnapshot",null),Pu=Xp([ur("Image Export")],Pu);var Ls=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Sy=1,Vs=class{constructor(c,e,i,s,a){this.position=new _.Pa4,this.target=new _.Pa4,this.quaternion=new _._fP,this.up=new _.Pa4,this.name="Camera View",this.snap="",this.focusView=()=>{},this.deleteView=()=>{},this.uiConfig=ou(this.name,this),c&&(this.position=c),e&&(this.target=e),i&&(this.up=i),s&&(this.quaternion=s),a&&(this.snap=a),this.name="Camera View"+Sy++}_nameChanged(){var c,e;this.uiConfig&&(this.uiConfig.label=this.name,(e=(c=this.uiConfig).uiRefresh)===null||e===void 0||e.call(c))}};Ls([kt(),fo()],Vs.prototype,"position",void 0),Ls([kt(),fo()],Vs.prototype,"target",void 0),Ls([kt(),fo()],Vs.prototype,"quaternion",void 0),Ls([kt(),fo()],Vs.prototype,"up",void 0),Ls([kt(),cr()],Vs.prototype,"name",void 0),Ls([su()],Vs.prototype,"snap",void 0),Ls([lr()],Vs.prototype,"focusView",void 0),Ls([lr()],Vs.prototype,"deleteView",void 0),Vs=Ls([ki("CameraView")],Vs);class ys extends Xi{constructor(){super(),this.enabled=!0,this._cameraViews=[],this.viewLooping=!1,this.viewPauseTime=200,this.animEase="easeInOutSine",this.animDuration=1e3,this.rotationOffset=.25,this.interpolateMode="spherical",this.animateOnScroll=!1,this.seekOnScroll=!1,this._animating=!1,this.dependencies=[],this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this._updaters=[],this._lastFrameTime=0,this._fadeDisabled=!1,this._viewQueue=[],this._animationLooping=!1,this._infiniteLooping=!0,this._driver=e=>({start:()=>this._updaters.push({u:e,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(i=>i.u===e),1)}),this.focusNext=(e=!0)=>{if(this._animating||this._cameraViews.length<2)return;let i=this._cameraViews.findIndex(s=>s===this._currentView);i<0&&(i=-1),i+=1,e?i%=this._cameraViews.length:i=Math.min(i,this._cameraViews.length-1),this.focusView(this._cameraViews[i])},this.focusPrevious=(e=!0)=>{if(this._animating||this._cameraViews.length<2||!this._currentView)return;let i=this._cameraViews.findIndex(s=>s===this._currentView);i<0&&(i=0),i-=1,i=e?(i+this._cameraViews.length)%this._cameraViews.length:Math.max(i,0),this.focusView(this._cameraViews[i])},this._popAnimations=[],this.uiConfig={type:"folder",label:"Camera Views",children:[()=>[...this._cameraViews.map(e=>e.uiConfig)],...Ec(this)]},this.addCurrentView=this.addCurrentView.bind(this),this.animateAllViews=this.animateAllViews.bind(this),this.recordAllViews=this.recordAllViews.bind(this),this.resetToFirstView=this.resetToFirstView.bind(this),this._wheel=this._wheel.bind(this),this._pointerMove=this._pointerMove.bind(this),this._postFrame=this._postFrame.bind(this)}get animationLooping(){return this._animationLooping}get animating(){return this._animating}get camViews(){return this._cameraViews}_wheel(e){this.enabled&&(this.seekOnScroll&&!this._animating||Math.abs(e.deltaY)>.001&&(this._scrollAnimationState=-1*Math.sign(e.deltaY)))}_pointerMove(e){var i;if(this.enabled&&!this._animating&&this.seekOnScroll){const s=(i=this._viewer)===null||i===void 0?void 0:i.scene.activeCamera;if(!s)return;const a=new _.$V,h=s.position,d=s.target,b=new _._fP().setFromUnitVectors(s.cameraObject.up,new _.Pa4(0,1,0)),X=b.clone().invert(),$=h.clone().sub(d);$.applyQuaternion(b),a.setFromVector3($),a.theta+=this.rotationOffset*e.movementX/this._viewer.canvas.clientWidth,a.phi+=this.rotationOffset*e.movementY/this._viewer.canvas.clientHeight,a.makeSafe(),$.setFromSpherical(a),$.applyQuaternion(X),h.copy(d).add($),s.positionUpdated(!1),s.targetUpdated()}}async onAdded(e){await super.onAdded(e);let i=!1;e.addEventListener("preFrame",s=>{this.seekOnScroll||this._animating?this._viewer.scene.activeCamera.interactionsEnabled&&(this._viewer.scene.activeCamera.interactionsEnabled=!1,i=!0):i&&(this._viewer.scene.activeCamera.interactionsEnabled=!0,i=!1)}),e.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),window.addEventListener("pointermove",this._pointerMove)}_postFrame(){var e,i;if(!this._viewer)return;if(!this.enabled||!this._animating)return this._lastFrameTime=0,void(this._fadeDisabled&&((e=this._viewer.getPluginByType("FrameFade"))===null||e===void 0||e.enable(ys.PluginType),this._fadeDisabled=!1));const s=ia()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=s-1/60);let a=s-this._lastFrameTime;this._lastFrameTime=s,a*=this.animateOnScroll?this._scrollAnimationState:1;const h=(i=this._viewer.getPluginByType("Progressive"))===null||i===void 0?void 0:i.postFrameConvergedRecordingDelta();if(h&&h>0&&(a=h),h!==0&&(a*=1e3,!(a<=0||(this._updaters.forEach(d=>{let b=a;d.time+b<0&&(b=-d.time),d.time+=b,Math.abs(b)>.001&&d.u(b)}),this._scrollAnimationState<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,this._fadeDisabled)))){const d=this._viewer.getPluginByType("FrameFade");d&&(d.disable(ys.PluginType),this._fadeDisabled=!0)}}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),window.removeEventListener("pointermove",this._pointerMove),super.onRemove(e)}async _animationLoop(){if(!this._animationLooping){for(this._animationLooping=!0;(this.viewLooping||!this._infiniteLooping)&&this.enabled&&!(this._cameraViews.length<1);){if(this._viewQueue.length===0){if(!this._infiniteLooping)break;this._viewQueue.push(...this._cameraViews)}await this.animateToView(this._viewQueue.shift()),await eo(2+this.viewPauseTime)}this._animationLooping=!1}}async animateAllViews(){if(this.enabled&&!(this.viewLooping||this._cameraViews.length<2)){for(;this._viewQueue.length>0;)this._viewQueue.pop();this._viewQueue.push(...this._cameraViews),this._viewQueue.push(this._viewQueue.shift()),this._infiniteLooping=!1,await this._animationLoop(),this._infiniteLooping=!0}}async resetToFirstView(e=100){this.enabled&&(this._currentView=void 0,await this.animateToView(this._cameraViews[0],e),await eo(2))}async recordAllViews(e){var i;if(!this.enabled)return;const s=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("CanvasRecorder");return s&&s.enabled&&!(this._cameraViews.length<1)&&(await this.resetToFirstView(),s.startRecording())?new Promise((a,h)=>{const d=()=>{s.removeEventListener("start",b),s.removeEventListener("stop",d),s.removeEventListener("error",X)},b=async()=>{d(),e==null||e(),await this.animateAllViews();const $=await s.stopRecording();$&&ts($,"recording.mp4"),a()},X=async()=>{d(),h()};s.addEventListener("start",b),s.addEventListener("stop",d),s.addEventListener("error",X)}):void 0}async addCurrentView(){var e,i,s,a,h;if(!this.enabled)return;const d=(e=this._viewer)===null||e===void 0?void 0:e.scene.activeCamera;if(!d)return;const b=this.getCurrentCameraView(d);b.snap=await((s=(i=this._viewer)===null||i===void 0?void 0:i.getPlugin(Pu))===null||s===void 0?void 0:s.getDataUrl({displayPixelRatio:.25,mimeType:"image/jpg"}))||"",this._cameraViews.push(b),(h=(a=this.uiConfig).uiRefresh)===null||h===void 0||h.call(a)}getCurrentCameraView(e){var i;if(e||(e=(i=this._viewer)===null||i===void 0?void 0:i.scene.activeCamera),!e)return new Vs;const s=new _.Pa4,a=e.cameraObject.matrixWorld;s.x=a.elements[4],s.y=a.elements[5],s.z=a.elements[6];const h=new Vs(e.position.clone(),e.target.clone(),s.normalize(),e.cameraObject.quaternion.clone(),"");return h.focusView=async()=>this.focusView(h),h.deleteView=()=>this.deleteView(h),h}async focusView(e){return this.animateToView(e)}deleteView(e){var i,s;const a=this._cameraViews.indexOf(e);a>=0&&this._cameraViews.splice(a,1),(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i)}async stopAllAnimations(){for(this.viewLooping=!1,this._popAnimations.forEach(e=>{var i;return(i=e==null?void 0:e.stop)===null||i===void 0?void 0:i.call(e)}),this._popAnimations=[];this._animating||this._animationLooping;)await eo(100)}async animateToView(e,i,s){var a;const h=(a=this._viewer)===null||a===void 0?void 0:a.scene.activeCamera;if(!h)return;if(this._animating&&(this._popAnimations.forEach(Z=>{var re;return(re=Z==null?void 0:Z.stop)===null||re===void 0?void 0:re.call(Z)}),await eo(100),this._animating))return void console.warn("todo: still animating?");this._currentView=e,this._animating=!0,this.dispatchEvent({type:"startViewChange",view:e}),i===void 0&&(i=this.animDuration);const d=typeof s=="function"?s:lm[s||this.animEase],b=this._driver,X=[];this._popAnimations=[];const $=this._popAnimations;if(this.interpolateMode==="spherical")X.push(async function(Z,re,le,he,fe,me){const Ee=Z.target.clone(),Ae=new _.Pa4,ye=new _.Pa4,ge=Am(Z.cameraObject,Ee),Pe=Am(re,re.target),Be=new _.$V;return Gc({from:0,to:1,duration:le,ease:he,driver:fe,onUpdate:Oe=>{Be.phi=Ud(ge.phi,Pe.phi,Oe),Be.theta=Ud(ge.theta,Pe.theta,Oe),Be.radius=or(ge.radius,Pe.radius,Oe),Ae.copy(Ee).lerp(re.target,Oe),ye.setFromSpherical(Be),ye.add(Ae),Z.position=ye,Z.target=Ae,Z.positionUpdated(!1),Z.targetUpdated()},onComplete:()=>{Z.position=re.position,Z.target=re.target,Z.positionUpdated(!1),Z.targetUpdated()}},me)}(h,e,i,d,b,$));else if(this.interpolateMode==="linear"){X.push(Gc({from:h.position.clone(),to:e.position.clone(),duration:i,ease:d,driver:b,onUpdate:le=>h.position=le,onComplete:()=>h.position=e.position},$)),X.push(Gc({from:h.target.clone(),to:e.target.clone(),duration:i,ease:d,driver:b,onUpdate:le=>{h.target=le,h.targetUpdated()},onComplete:()=>{h.target=e.target,h.targetUpdated()}},$));const Z=h.cameraObject.quaternion.clone(),re=new _._fP;X.push(Gc({from:0,to:1,duration:i,ease:d,driver:b,onUpdate:le=>{re.copy(Z).slerp(e.quaternion,le),h.cameraObject.quaternion.copy(re),h.cameraObject.updateProjectionMatrix()},onComplete:()=>{h.cameraObject.quaternion.copy(e.quaternion),h.cameraObject.updateProjectionMatrix()}},$))}await Promise.all(X),this._animating=!1,this.dispatchEvent({type:"viewChange",view:e}),await eo(10)}fromJSON(e,i){var s,a;return this._cameraViews.forEach(h=>this.deleteView(h)),super.fromJSON(e,i)?(this._cameraViews.forEach(h=>h.focusView=async()=>this.focusView(h)),this._cameraViews.forEach(h=>h.deleteView=()=>this.deleteView(h)),(a=(s=this.uiConfig).uiRefresh)===null||a===void 0||a.call(s),this):null}async animateToObject(e,i=4,s,a,h={min:.5,max:5}){if(!this._viewer)return;const d=new nn().expandByObject(e||this._viewer.scene.modelRoot.modelObject,!1,!0),b=d.getCenter(new _.Pa4),X=d.getSize(new _.Pa4).length()/2;await this.animateToTarget(Math.min(h.max,Math.max(h.min,X*i)),b,s,a)}async animateToTarget(e,i,s,a){const h=this.getCurrentCameraView();h.target.copy(i);const d=new _.Pa4().subVectors(h.target,h.position).normalize();h.position.copy(d.multiplyScalar(-e).add(h.target)),await this.animateToView(h,s,a)}}function Am(c,e){const i=c.position.clone();i.sub(e);const s=new _.$V().setFromVector3(i);return s.makeSafe(),s}function Ud(c,e,i){const s=e-c;return s>=Math.PI?c+(s-2*Math.PI)*i:s<=-Math.PI?c+(s+2*Math.PI)*i:c+s*i}function Cy(c,e,i){const s=(1-i)*Math.cos(c)+i*Math.cos(e),a=(1-i)*Math.sin(c)+i*Math.sin(e);return Math.atan2(a,s)}ys.PluginType="CameraViews",Ls([kt("cameraViews")],ys.prototype,"_cameraViews",void 0),Ls([lt(ys.prototype._animationLoop),kt(),Xn("Loop All Views",{limitedUi:!0})],ys.prototype,"viewLooping",void 0),Ls([kt(),cr("View Pause Time")],ys.prototype,"viewPauseTime",void 0),Ls([kt(),Xs("Ease",Object.keys(lm).map(c=>({label:c})))],ys.prototype,"animEase",void 0),Ls([kt(),ai("Duration",[10,1e4],10,{limitedUi:!0})],ys.prototype,"animDuration",void 0),Ls([kt(),ai("RotationOffset",[.2,.75],.01)],ys.prototype,"rotationOffset",void 0),Ls([kt(),Xs("Interpolation",["spherical","linear"].map(c=>({label:c})))],ys.prototype,"interpolateMode",void 0),Ls([Xn(),kt()],ys.prototype,"seekOnScroll",void 0),Ls([lr("Animate All Views",{limitedUi:!0})],ys.prototype,"animateAllViews",null),Ls([lr("Record All Views")],ys.prototype,"recordAllViews",null),Ls([lr("Add Current View")],ys.prototype,"addCurrentView",null),Ls([lr("Focus Next")],ys.prototype,"focusNext",void 0),Ls([lr("Focus Previous")],ys.prototype,"focusPrevious",void 0);const Fd=new _.Pa4;function jd(c,e,i){let s=c.dot(e);s=Math.min(Math.max(s,-1),1);const a=Math.acos(s)*i;return Fd.copy(c).multiplyScalar(s).sub(e).negate().normalize(),c.multiplyScalar(Math.cos(a)).add(Fd.multiplyScalar(Math.sin(a)))}var zd=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class lc extends Xi{constructor(e=!0){super(),this.enabled=!0,this.light=new um("#cceeff",1),this.lightLayers=1,this._preRender=()=>{var i,s,a;if(!this.enabled)return void(this.light.layers.mask=0);const h=(s=(i=this._viewer)===null||i===void 0?void 0:i.renderer.frameCount)!==null&&s!==void 0?s:0;(h<1||h>5)&&this.light.randomizePosition(h<5?0:h),this.light.layers.mask=this.lightLayers,this.light.updateShadowParams(),(a=this._cameraHelper)===null||a===void 0||a.update()},this._setDirty=this._setDirty.bind(this),this.enabled=e}get cameraHelper(){return this._cameraHelper}async onAdded(e){await super.onAdded(e),this._cameraHelper=new _.Rki(this.light.shadow.camera),this._cameraHelper.visible=!1,this._cameraHelper.userData.bboxVisible=!1,e.scene.add(this._cameraHelper),e.scene.addLight(this.light,{addToRoot:!0}),e.addEventListener("preRender",this._preRender)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),this.light.removeFromParent(),super.onRemove(e)}_setDirty(e=!1){var i,s;e?(i=this._viewer)===null||i===void 0||i.scene.setDirty():(s=this._viewer)===null||s===void 0||s.setDirty()}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Progressive Shadow",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:this._setDirty},{type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Visible",property:[this.light,"visible"],onChange:this._setDirty},{type:"slider",label:"Intensity",bounds:[0,10],property:[this.light,"intensity"],onChange:this._setDirty},{type:"color",label:"Color",property:[this.light,"color"],onChange:this._setDirty},{type:"checkbox",label:"Shadow Enabled",property:[this.light.shadowParams,"enabled"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"focus"],onChange:this._setDirty},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"spread"],onChange:this._setDirty},{type:"slider",bounds:[.01,60],property:[this.light.randomParams,"distanceScale"],onChange:this._setDirty},{type:"vec3",bounds:[-5,5],property:[this.light.randomParams,"direction"],onChange:this._setDirty},{type:"slider",bounds:[.01,10],property:[this.light.shadowParams,"radius"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[.01,30],property:[this.light.shadowParams,"frustumSize"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[-.01,.01],property:[this.light.shadowParams,"bias"],onChange:[this.light.updateShadowParams,this._setDirty]}]}]}}}lc.PluginType="RandomizedDirectionalLight",zd([kt()],lc.prototype,"enabled",void 0),zd([kt("rdLight")],lc.prototype,"light",void 0),zd([kt()],lc.prototype,"lightLayers",void 0);var ym,qc=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let cc=ym=class extends Xi{constructor(c=!1){super(),this.enabled=!1,this.worldRadius=100,this.tripodHeight=10,this._paramsChanged=this._paramsChanged.bind(this),this.enabled=c}_paramsChanged(){var c,e,i,s,a,h,d,b,X,$,Z;const re=(c=this._viewer)===null||c===void 0?void 0:c.getBackground(!0);if(this.enabled&&re&&re!==Vc)if(re.isDataTexture)re.mapping=_.dSO;else if(confirm("Background must be same as environment, do you want to change it?")){const fe=(e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("SimpleBackgroundEnvUiPlugin1");fe?(fe.envmapBg=!0,(s=(i=fe.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)):(a=this._viewer)===null||a===void 0||a.setBackground(Vc)}else this.enabled=!1;const le=(X=(b=(d=(h=this._viewer)===null||h===void 0?void 0:h.renderer)===null||d===void 0?void 0:d.rendererObject)===null||b===void 0?void 0:b.background.getBoxMesh2())===null||X===void 0?void 0:X.material,he=($=le==null?void 0:le.uniforms)!==null&&$!==void 0?$:_.Vj0.cube.uniforms;he.tripodHeight||(he.tripodHeight={value:1}),he.worldRadius||(he.worldRadius={value:1}),he.tripodHeight.value=this.tripodHeight,he.worldRadius.value=this.worldRadius,le&&(!this.enabled&&le.defines.HDRi_GROUND_PROJ?delete le.defines.HDRi_GROUND_PROJ:this.enabled&&(le.defines.HDRi_GROUND_PROJ="1"),le.needsUpdate=!0),(Z=this._viewer)===null||Z===void 0||Z.setDirty()}async onAdded(c){var e,i,s;await super.onAdded(c),!((s=(i=(e=this._viewer)===null||e===void 0?void 0:e.renderer)===null||i===void 0?void 0:i.rendererObject)===null||s===void 0)&&s.background.getBoxMesh()&&console.error("HDRi Ground Plugin must be added before setting any cube or env map"),_.Vj0.cube.fragmentShader=_.Vj0.cube.fragmentShader.replace("void main() {",`
#ifdef HDRi_GROUND_PROJ
float intersectPlane1(const in vec3 r0,const in vec3 rd,const in vec3 n,const in vec3 p0){float t=dot(p0-r0,n)/(dot(n,rd)+1e-6);return t<0.?1000.:t;}float intersectSphere1(in vec3 ro,in vec3 rd,in vec3 sph,in float rad){vec3 oc=ro-sph;float b=dot(oc,rd);float c=dot(oc,oc)-rad*rad;float t=b*b-c;return t<0.?t:-b+sqrt(t);}
#define PI_HALF  1.5707963267948966
uniform float worldRadius;uniform float tripodHeight;vec3 hdriProject(){vec3 p=normalize(vWorldDirection);vec3 camPos=cameraPosition;camPos.y-=tripodHeight;float t=intersectSphere1(camPos,p,vec3(0.,0.,0.),worldRadius);if(t>0.){float t2=intersectPlane1(camPos,p,vec3(0,-1,0),vec3(0.,-tripodHeight,0.));p=(camPos+min(t,t2)*p)/worldRadius;}else p=vec3(0.,1.,0.);return p;}
#endif

void main() {`),_.Vj0.cube.fragmentShader=_.Vj0.cube.fragmentShader.replace("vec3 vReflect = vWorldDirection;",`
vec3 vReflect = 
#ifdef HDRi_GROUND_PROJ
hdriProject()
#else
vWorldDirection
#endif
;
`),c.scene.addEventListener("environmentChanged",this._paramsChanged)}};cc.PluginType="HDRiGroundPlugin",qc([kt(),lt(ym.prototype._paramsChanged),Xn("Enabled")],cc.prototype,"enabled",void 0),qc([kt(),lt(ym.prototype._paramsChanged),ai("World Radius",[1,1e3])],cc.prototype,"worldRadius",void 0),qc([kt(),lt(ym.prototype._paramsChanged),ai("Tripod height",[0,50])],cc.prototype,"tripodHeight",void 0),cc=ym=qc([ur("HDRi Ground")],cc);var Vd=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};const Ga={uniforms:{colorTexture:{value:null},tNormalDepth:{value:null},blurTexture:{value:null},cocTexture:{value:null},cocTextureSize:{value:new _.FM8},cameraNearFar:{value:new _.FM8}},vertexShader:ec,fragmentShader:Wa+`
#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cocTextureSize;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;uniform vec2 crossCenter;uniform float crossRadius;uniform float crossAlpha;uniform vec3 crossColor;float smoothBoundary(float d,float smooothFactor){smooothFactor*=0.5;float value=smoothstep(-smooothFactor,smooothFactor,d);return value;}float circle(vec2 p,float r){return min((length(p)-r),-(length(p)-r-0.01));}float computeCoc(){float depth=getDepth(vUv);if(depth>1.-0.01)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){vec4 blur=blurTextureTexelToLinear(texture2D(blurTexture,vUv));float scale=0.5;blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,-1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,-1.)/cocTextureSize));blur/=5.;vec2 uvNearest=(floor(vUv*cocTextureSize)+0.5)/cocTextureSize;float coc=abs(min(2.*cocTextureTexelToLinear(texture2D(cocTexture,uvNearest)).a-1.,computeCoc()));float cocLower=0.005;float cocHigher=0.3;vec4 outColor=vec4(mix(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,blur.rgb,smoothstep(cocLower,cocHigher,coc)),1.);vec2 d=vUv-crossCenter;if(length(d)>crossRadius+0.05){float dist=circle(d,crossRadius);gl_FragColor=outColor;}else{d.x*=cocTextureSize.x/cocTextureSize.y;float dist=circle(d,crossRadius);dist=smoothBoundary(dist,2.*fwidth(dist));vec4 color=outColor;vec3 dofCircleColor=mix(crossColor,color.rgb,1.-crossAlpha);gl_FragColor=vec4(mix(color.rgb,dofCircleColor,dist),color.a);}
#include <encodings_fragment>
}`},Ru=(nh({uniforms:{cocTexture:{value:null},colorTexture:{value:null},colorTextureSize:{value:new _.FM8},direction:{value:new _.FM8}},vertexShader:ec,fragmentShader:`#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;const float MAXIMUM_BLUR_SIZE=16.;const float SIGMA=5.;const int NUM_SAMPLES=4;float normpdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}vec3 weightedBlur(){float cocIn=2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv)).a-1.;float kernelRadius=MAXIMUM_BLUR_SIZE*cocIn;vec2 invSize=1./colorTextureSize;cocIn*=cocIn*cocIn;float centreSpaceWeight=normpdf(0.,SIGMA)*abs(cocIn);float weightSum=centreSpaceWeight;vec3 centreSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb;vec3 diffuseSum=centreSample*weightSum;vec2 delta=invSize*kernelRadius/float(NUM_SAMPLES);for(int i=1;i<=NUM_SAMPLES;i++){float spaceWeight=normpdf(float(i),SIGMA);vec2 texcoord=direction*delta*float(i);vec4 rightSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv+texcoord));vec4 leftSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv-texcoord));float leftCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv-texcoord)).a-1.);float rightCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv+texcoord)).a-1.);leftCocWeight*=leftCocWeight*leftCocWeight;rightCocWeight*=rightCocWeight*rightCocWeight;diffuseSum+=((leftSample.rgb*leftCocWeight)+(rightSample.rgb*rightCocWeight))*spaceWeight;weightSum+=(spaceWeight*(leftCocWeight+rightCocWeight));}return diffuseSum/weightSum;}void main(){gl_FragColor=vec4(weightedBlur(),1.);
#include <encodings_fragment>
}`},"colorTexture","cocTexture"),nh({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new _.FM8},direction:{value:new _.FM8},frameCount:{value:0},blurRadius:{value:16}},vertexShader:ec,fragmentShader:tc+`
`+_0+`
#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform float blurRadius;vec4 CircularBlur(){vec4 color=colorTextureTexelToLinear(texture2D(colorTexture,vUv));
#ifdef DOF_MODE
float blurDist=blurRadius*(2.*color.a-1.);
#else
float blurDist=blurRadius*color.a;
#endif
float rnd=PI2*random3(vec3(vUv,frameCount*0.1));float costheta=cos(rnd);float sintheta=sin(rnd);vec4 rotationMatrix=vec4(costheta,-sintheta,sintheta,costheta);vec3 colorSum=vec3(0.);float weightSum=0.001;vec2 ofs;vec4 sampleColor;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));sampleColor=colorTextureTexelToLinear(texture2D(colorTexture,vUv+blurDist*ofs/colorTextureSize.xy));
#ifdef DOF_MODE
sampleColor.a=abs(sampleColor.a*2.-1.);sampleColor.a*=sampleColor.a*sampleColor.a;
#endif
colorSum+=sampleColor.rgb*sampleColor.a;weightSum+=sampleColor.a;}
#pragma unroll_loop_end
colorSum/=weightSum;return vec4(saturate(colorSum),1.);}void main(){gl_FragColor=CircularBlur();
#include <encodings_fragment>
}`,defines:{DOF_MODE:1}},"colorTexture"));class Sh extends Fs{constructor(){super(Ga,"colorTexture","cocTexture","blurTexture"),this.dofBlurMaterial=Ru,this.nearFarBlurScale=new _.FM8(.25,.25),this.focalDepthRange=new _.FM8(.5,1.5),this.crossCenter=new _.FM8(.5,.5),this.crossRadius=.04,this.crossAlpha=1,this.crossColor=new oi(16750848),this.uiConfig={type:"folder",label:"Depth of Field",children:[{type:"checkbox",label:"Enabled",limitedUi:!0,property:[this,"enabled"]},{type:"slider",label:"Depth Range",bounds:[.5,3],property:[this.focalDepthRange,"y"]},{type:"slider",label:"Near Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"x"]},{type:"slider",label:"Far Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"y"]}]},this.material.extensions.derivatives=!0,this.computeCocMaterial=nh({uniforms:{colorTexture:{value:null},tNormalDepth:this.uniforms.tNormalDepth,cameraNearFar:this.uniforms.cameraNearFar,nearFarBlurScale:this.uniforms.nearFarBlurScale,focalDepthRange:this.uniforms.focalDepthRange},vertexShader:ec,fragmentShader:Wa+`
#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;float computeCoc(){float depth=getDepth(vUv);if(depth==1.)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*computeCoc()+0.5);
#include <encodings_fragment>
}`},"colorTexture"),this.expandCocMaterial=nh({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new _.FM8},direction:{value:new _.FM8},tNormalDepth:this.uniforms.tNormalDepth,nearFarBlurScale:this.uniforms.nearFarBlurScale},vertexShader:ec,fragmentShader:Wa+`
#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;uniform vec2 nearFarBlurScale;const float MAXIMUM_BLUR_SIZE=4.;float expandNear(const in vec2 offset,const in bool isBackground){float coc=0.;vec2 sampleOffsets=MAXIMUM_BLUR_SIZE*offset/5.;float coc0=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv)).a-1.;float coc1=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-5.*sampleOffsets)).a-1.;float coc2=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-4.*sampleOffsets)).a-1.;float coc3=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-3.*sampleOffsets)).a-1.;float coc4=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-2.*sampleOffsets)).a-1.;float coc5=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-1.*sampleOffsets)).a-1.;float coc6=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+1.*sampleOffsets)).a-1.;float coc7=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+2.*sampleOffsets)).a-1.;float coc8=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+3.*sampleOffsets)).a-1.;float coc9=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+4.*sampleOffsets)).a-1.;float coc10=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+5.*sampleOffsets)).a-1.;if(isBackground){coc=abs(coc0)*0.095474+(abs(coc1)+abs(coc10))*0.084264+(abs(coc2)+abs(coc9))*0.088139+(abs(coc3)+abs(coc8))*0.091276+(abs(coc4)+abs(coc7))*0.093585+(abs(coc5)+abs(coc6))*0.094998;}else{coc=min(coc0,0.);coc=min(coc1*0.3,coc);coc=min(coc2*0.5,coc);coc=min(coc3*0.75,coc);coc=min(coc4*0.8,coc);coc=min(coc5*0.95,coc);coc=min(coc6*0.95,coc);coc=min(coc7*0.8,coc);coc=min(coc8*0.75,coc);coc=min(coc9*0.5,coc);coc=min(coc10*0.3,coc);if(abs(coc0)>abs(coc))coc=coc0;}return coc;}void main(){vec2 offset=2.*direction/colorTextureSize;bool isBackground=getDepth(vUv)>1.-0.001;float coc=expandNear(offset,isBackground);gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*coc+0.5);
#include <encodings_fragment>
}`},"colorTexture")}render(e,i,s,a,h){if(!this.enabled)return;const d=e.baseRenderer,b={minFilter:_.TyD,magFilter:_.TyD,type:_.cLu,encoding:_.rnI,sizeMultiplier:.5,isAntialiased:!1,format:_.wk1,depthBuffer:!1,generateMipmaps:!1},X=d.getTempTarget(b),$=d.getTempTarget(b);if(this.computeCocMaterial.uniforms.colorTexture.value=s.texture,d.blit(void 0,X,{material:this.computeCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=X.texture,this.expandCocMaterial.uniforms.direction.value.set(1,0),d.blit(void 0,$,{material:this.expandCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=$.texture,this.expandCocMaterial.uniforms.direction.value.set(0,1),d.blit(void 0,X,{material:this.expandCocMaterial}),this.dofBlurMaterial.uniforms.frameCount)this.dofBlurMaterial.uniforms.colorTexture.value=X.texture,d.blit(void 0,$,{material:this.dofBlurMaterial});else{const Z=d.getTempTarget(b);this.dofBlurMaterial.uniforms.cocTexture.value=X.texture,this.dofBlurMaterial.uniforms.colorTexture.value=X.texture,this.dofBlurMaterial.uniforms.direction.value.set(1,0),d.blit(void 0,Z,{material:this.dofBlurMaterial}),this.dofBlurMaterial.uniforms.colorTexture.value=Z.texture,this.dofBlurMaterial.uniforms.direction.value.set(0,1),d.blit(void 0,$,{material:this.dofBlurMaterial}),d.releaseTempTarget(Z)}this.material.uniforms.blurTexture.value=$.texture,this.material.uniforms.cocTexture.value=X.texture,super.render(e,i,s,a,h),d.releaseTempTarget(X),d.releaseTempTarget($)}}Vd([kt(),ot()],Sh.prototype,"nearFarBlurScale",void 0),Vd([kt(),ot()],Sh.prototype,"focalDepthRange",void 0),Vd([ot()],Sh.prototype,"crossCenter",void 0),Vd([ot()],Sh.prototype,"crossRadius",void 0),Vd([ot()],Sh.prototype,"crossAlpha",void 0),Vd([ot()],Sh.prototype,"crossColor",void 0);var uc=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class Gd extends Sl{constructor(e=!0,i=!1){super(),this.passId="depthOfField",this._beforeFilters=["progressive","tonemap","screen"],this._afterFilters=["render"],this._requiredFilters=["render"],this.dependencies=[Or],this.enableEdit=!1,this._focalPointHit=new _.Pa4(0,0,0),this.crossFadeTime=200,this._focalPointHitTime=0,this._tempVec=new _.Pa4,this.enabled=e,this.enableEdit=i,this._onObjectHit=this._onObjectHit.bind(this),this.setDirty=this.setDirty.bind(this)}passCtor(e){return new Sh}setFocalPoint(e,i=!0,s=!1){var a,h;this._focalPointHit.copy(e),i&&((h=(a=this._viewer)===null||a===void 0?void 0:a.getPlugin(sc))===null||h===void 0||h.startTransition(this._frameFadeTime)),s&&(this._focalPointHitTime=ia()),this.setDirty()}getFocalPoint(){return this._focalPointHit}get depthRange(){var e,i;return(i=(e=this.pass)===null||e===void 0?void 0:e.passObject.focalDepthRange.y)!==null&&i!==void 0?i:0}set depthRange(e){this.pass&&(this.pass.passObject.focalDepthRange.y=e),this.setDirty()}get nearBlurScale(){var e,i;return(i=(e=this.pass)===null||e===void 0?void 0:e.passObject.nearFarBlurScale.x)!==null&&i!==void 0?i:0}set nearBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.x=e),this.setDirty()}get farBlurScale(){var e,i;return(i=(e=this.pass)===null||e===void 0?void 0:e.passObject.nearFarBlurScale.y)!==null&&i!==void 0?i:0}set farBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.y=e),this.setDirty()}get _frameFadeTime(){return 2.5*this.crossFadeTime}_onObjectHit(e){var i,s;this._pass&&e.intersects.intersect&&this.enabled&&this.enableEdit&&(this._focalPointHit.copy(e.intersects.intersect.point),this._focalPointHitTime=e.time,e.intersects.selectedObject=null,(s=(i=this._viewer)===null||i===void 0?void 0:i.getPlugin(sc))===null||s===void 0||s.startTransition(this._frameFadeTime),this.setDirty())}async onAdded(e){var i;await super.onAdded(e),(i=e.getPluginByType("Picking"))===null||i===void 0||i.addEventListener("hitObject",this._onObjectHit)}async onRemove(e){var i;return(i=e.getPluginByType("Picking"))===null||i===void 0||i.removeEventListener("hitObject",this._onObjectHit),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}_update(e){var i,s;if(!super._update(e))return!1;const a=(i=this.pass)===null||i===void 0?void 0:i.passObject;if(!a)return!1;const h=e.getPlugin(Or);h==null||h.updateShaderProperties(a.material),a.dofBlurMaterial.uniforms.frameCount&&((s=e.renderer)===null||s===void 0||s.updateShaderProperties(a.dofBlurMaterial));const d=e.scene.activeCamera;if(!d)return!1;d.cameraObject.updateMatrixWorld(!0),d.updateShaderProperties(a.material),this._tempVec.subVectors(this._focalPointHit,d.cameraObject.position),a.focalDepthRange.x=this._tempVec.length(),a.focalDepthRange.x*=d.cameraObject.getWorldDirection(new _.Pa4).dot(this._tempVec.normalize());let b=(ia()-this._focalPointHitTime)/this.crossFadeTime;if(b=1-Math.min(1,Math.max(0,b)),Math.abs(b-a.crossAlpha)>.01&&(a.crossAlpha=b,this.setDirty()),b>0){const X=this._tempVec.copy(this._focalPointHit).project(d.cameraObject).addScalar(1).divideScalar(2);a.crossCenter.set(X.x,X.y),a.computeCocMaterial.uniformsNeedUpdate=!0,a.expandCocMaterial.uniformsNeedUpdate=!0}return!0}get uiConfig(){var e,i,s,a,h;if(this._uiConfig)return this._uiConfig;const d=(i=(e=this._pass)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.uiConfig;return d?((a=(s=d.children)===null||s===void 0?void 0:s.map(b=>st(b)))===null||a===void 0||a.flat(2).forEach(b=>b&&(b.onChange=this.setDirty)),(h=d.children)===null||h===void 0||h.push({type:"checkbox",label:"Enable Edit",limitedUi:!0,property:[this,"enableEdit"]}),this._uiConfig=d,d):{}}}Gd.PluginType="DepthOfField",uc([kt()],Gd.prototype,"enableEdit",void 0),uc([kt("focalPoint")],Gd.prototype,"_focalPointHit",void 0),uc([kt()],Gd.prototype,"crossFadeTime",void 0);var Kp,hc=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Tl=Kp=class extends Xi{constructor(c=!0){super(),this.enabled=!0,this.radius=.015,this.intensity=1,this.tolerance=1.5,this._defines={},this.onlySSCSDebug=!1,this.stepCount=2,this.dependencies=[Or,Kn],this.materialExtension={shaderExtender:(e,i,s)=>{if(!e.defines.SSCS_ENABLED)return;const a=Ne`
                #ifndef D_sceneBoundingRadius
                #define D_sceneBoundingRadius
                uniform float sceneBoundingRadius;
                #endif
                float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, vec3 lightDirection ) {
                    vec3 ray_origin_view = -vViewPosition;
                    float rnd = interleavedGradientNoise(gl_FragCoord.xy, frameCount+34.);
                    float cameraDist = length(cameraPositionWorld);
//                    float radius = mix((cameraNearFar.y) + ray_origin_view.z, -ray_origin_view.z - cameraNearFar.x, rnd * 0.5 + 0.5)*sscsRadius;
                    float radius = mix((cameraDist + sceneBoundingRadius) + ray_origin_view.z, -ray_origin_view.z - max(0.0, cameraDist - sceneBoundingRadius), rnd * 0.5 + 0.5)*sscsRadius;
                    vec3 state = vec3(1.,(rnd+0.5)/float(SSCS_STEP_COUNT),2.);
                    traceRay(ray_origin_view, normalize(lightDirection) * radius, sscsTolerance * radius * 2., state, SSCS_STEP_COUNT);
                    state.z = state.z > 0.99 ? 1. : max(0.,min(state.z * state.z * (1.-sscsIntensity), 1.));
                    
                #if defined(SSCS_DEBUG) && SSCS_DEBUG > 0
                    return state.z;
                #endif
            `,h=`
#if SSCS_ENABLED

    uniform float sscsIntensity;
    uniform float sscsRadius;
    uniform float sscsTolerance;

    ${Bg}
    
    #define THREE_PACKING_INCLUDED
    ${Qf}
    
    ${Wa}
    ${tc}
    
    ${kg}

#endif
            
            `+_.WdD.shadowmap_pars_fragment.replace("float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {",`${a}
`).replace("return shadow;","return min(shadow, state.z);");e.fragmentShader=e.fragmentShader.replace("#include <shadowmap_pars_fragment>",h),e.fragmentShader=e.fragmentShader.replace("#include <lights_fragment_begin>",_.WdD.lights_fragment_begin),e.fragmentShader=e.fragmentShader.replace("directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;","directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ], directLight.direction ) : 1.0;").replace("directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;","directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ], directLight.direction ) : 1.0;")},onObjectRender:(e,i,s)=>{var a;const h=i.materialObject;let d=this.enabled&&s.userData.screenSpaceRendering!==!1&&!(!((a=h.userData)===null||a===void 0)&&a.sscsDisabled)?1:0;h.defines.SSCS_ENABLED!==d&&(h.defines.SSCS_ENABLED=d,h.needsUpdate=!0),d=this._defines.SSCS_STEP_COUNT,h.defines.SSCS_STEP_COUNT!==d&&(h.defines.SSCS_STEP_COUNT=d,h.needsUpdate=!0),d=+this._defines.SSCS_DEBUG,h.defines.SSCS_DEBUG!==d&&(h.defines.SSCS_DEBUG=d,h.needsUpdate=!0)},parsFragmentSnippet:()=>`
`,extraUniforms:{...Kp._uniforms},computeCacheKey:e=>this.enabled?"1":"0",isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>{var e,i,s,a,h;return[(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(Or),(i=this._viewer)===null||i===void 0?void 0:i.getPlugin(Ho),(s=this._viewer)===null||s===void 0?void 0:s.scene.activeCamera,(a=this._viewer)===null||a===void 0?void 0:a.renderer,(h=this._viewer)===null||h===void 0?void 0:h.scene]}},this.enabled=c,this.userData={setDirty:()=>{var e;(e=this._viewer)===null||e===void 0||e.setDirty()}}}async onAdded(c){var e,i;await super.onAdded(c),(i=(e=c.getPlugin(Kn))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.registerMaterialExtension(this.materialExtension)}async onRemove(c){var e,i;return(i=(e=c.getPlugin(Kn))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this.materialExtension),super.onRemove(c)}};Tl.PluginType="SSContactShadows",Tl._uniforms={tNormalDepth:{value:null},frameCount:{value:0},projection:{value:new _.yGw},cameraPositionWorld:{value:new _.Pa4},cameraNearFar:{value:new _.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},hc([Xn("Enabled"),kt()],Tl.prototype,"enabled",void 0),hc([ot({uniforms:Kp._uniforms,propKey:"sscsRadius"}),ai("Radius",[1e-4,.1],1e-4),kt()],Tl.prototype,"radius",void 0),hc([ot({uniforms:Kp._uniforms,propKey:"sscsIntensity"}),ai("Intensity",[1e-4,1],1e-4),kt()],Tl.prototype,"intensity",void 0),hc([ot({uniforms:Kp._uniforms,propKey:"sscsTolerance"}),ai("Tolerance",[.1,5]),kt()],Tl.prototype,"tolerance",void 0),hc([Rt("SSCS_DEBUG",void 0,!0),Xn("Debug only SSCS"),kt()],Tl.prototype,"onlySSCSDebug",void 0),hc([Rt("SSCS_STEP_COUNT",void 0,!0),ai("Step count",[1,8],1),kt()],Tl.prototype,"stepCount",void 0),Tl=Kp=hc([ur("Screen Space Contact Shadows")],Tl);class hx{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const i=this.workerCreator();i.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=i}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,i){const s=this.workersResolve[e];if(s&&s(i),this.queue.length){const{resolve:a,msg:h,transfer:d}=this.queue.shift();this.workersResolve[e]=a,this.workers[e].postMessage(h,d)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,i){return new Promise(s=>{const a=this._getIdleWorker();a!==-1?(this._initWorker(a),this.workerStatus|=1<<a,this.workersResolve[a]=s,this.workers[a].postMessage(e,i)):this.queue.push({resolve:s,msg:e,transfer:i})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}class dx{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Il{constructor(e,i,s,a){this._dataView=new DataView(e.buffer,e.byteOffset+i,s),this._littleEndian=a,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,i=0){const s=this._offset;let a=0;for(;this._dataView.getUint8(this._offset)!==i&&a<e;)a++,this._offset++;return a<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+s,a)}}const ha=[171,75,84,88,32,50,48,187,13,10,26,10];function y0(c){return typeof TextDecoder<"u"?new TextDecoder().decode(c):Buffer.from(c).toString("utf8")}let d_,Yc,bm;const b0={env:{emscripten_notify_memory_growth:function(c){bm=new Uint8Array(Yc.exports.memory.buffer)}}};class My{init(){return d_||(d_=typeof fetch<"u"?fetch("data:application/wasm;base64,"+w0).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,b0)).then(this._init):WebAssembly.instantiate(Buffer.from(w0,"base64"),b0).then(this._init),d_)}_init(e){Yc=e.instance,b0.env.emscripten_notify_memory_growth(0)}decode(e,i=0){if(!Yc)throw new Error("ZSTDDecoder: Await .init() before decoding.");const s=e.byteLength,a=Yc.exports.malloc(s);bm.set(e,a),i=i||Number(Yc.exports.ZSTD_findDecompressedSize(a,s));const h=Yc.exports.malloc(i),d=Yc.exports.ZSTD_decompress(h,i,a,s),b=bm.slice(h,h+d);return Yc.exports.free(a),Yc.exports.free(h),b}}const w0="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",Qd=new WeakMap;let wm,x0=0;class dc extends _.aNw{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new hx,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const e=new _.hH6(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const i=e.loadAsync("basis_transcoder.js"),s=new _.hH6(this.manager);s.setPath(this.transcoderPath),s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials);const a=s.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([i,a]).then(([h,d])=>{const b=dc.BasisWorker.toString(),X=["/* constants */","let _EngineFormat = "+JSON.stringify(dc.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(dc.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(dc.BasisFormat),"/* basis_transcoder.js */",h,"/* worker */",b.substring(b.indexOf("{")+1,b.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([X])),this.transcoderBinary=d,this.workerPool.setWorkerCreator(()=>{const $=new Worker(this.workerSourceURL),Z=this.transcoderBinary.slice(0);return $.postMessage({type:"init",config:this.workerConfig,transcoderBinary:Z},[Z]),$})}),x0>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),x0++}return this.transcoderPending}load(e,i,s,a){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const h=new _.hH6(this.manager);h.setResponseType("arraybuffer"),h.setWithCredentials(this.withCredentials),h.load(e,d=>{if(Qd.has(d))return Qd.get(d).promise.then(i).catch(a);this.createTexture(d).then(b=>i?i(b):null).catch(a)},s,a)}_createTextureFrom(e){const{mipmaps:i,width:s,height:a,format:h,type:d,error:b,dfdTransferFn:X,dfdFlags:$}=e;if(d==="error")return Promise.reject(b);const Z=new _.EB7(i,s,a,h,_.ywz);return Z.minFilter=i.length===1?_.wem:_.D1R,Z.magFilter=_.wem,Z.generateMipmaps=!1,Z.needsUpdate=!0,Z.encoding=X===2?_.knz:_.rnI,Z.premultiplyAlpha=!!(1&$),Z}createTexture(e,i={}){const s=function(d){const b=new Uint8Array(d.buffer,d.byteOffset,ha.length);if(b[0]!==ha[0]||b[1]!==ha[1]||b[2]!==ha[2]||b[3]!==ha[3]||b[4]!==ha[4]||b[5]!==ha[5]||b[6]!==ha[6]||b[7]!==ha[7]||b[8]!==ha[8]||b[9]!==ha[9]||b[10]!==ha[10]||b[11]!==ha[11])throw new Error("Missing KTX 2.0 identifier.");const X=new dx,$=17*Uint32Array.BYTES_PER_ELEMENT,Z=new Il(d,ha.length,$,!0);X.vkFormat=Z._nextUint32(),X.typeSize=Z._nextUint32(),X.pixelWidth=Z._nextUint32(),X.pixelHeight=Z._nextUint32(),X.pixelDepth=Z._nextUint32(),X.layerCount=Z._nextUint32(),X.faceCount=Z._nextUint32();const re=Z._nextUint32();X.supercompressionScheme=Z._nextUint32();const le=Z._nextUint32(),he=Z._nextUint32(),fe=Z._nextUint32(),me=Z._nextUint32(),Ee=Z._nextUint64(),Ae=Z._nextUint64(),ye=new Il(d,ha.length+$,3*re*8,!0);for(let kn=0;kn<re;kn++)X.levels.push({levelData:new Uint8Array(d.buffer,d.byteOffset+ye._nextUint64(),ye._nextUint64()),uncompressedByteLength:ye._nextUint64()});const ge=new Il(d,le,he,!0),Pe={vendorId:ge._skip(4)._nextUint16(),descriptorType:ge._nextUint16(),versionNumber:ge._nextUint16(),descriptorBlockSize:ge._nextUint16(),colorModel:ge._nextUint8(),colorPrimaries:ge._nextUint8(),transferFunction:ge._nextUint8(),flags:ge._nextUint8(),texelBlockDimension:[ge._nextUint8(),ge._nextUint8(),ge._nextUint8(),ge._nextUint8()],bytesPlane:[ge._nextUint8(),ge._nextUint8(),ge._nextUint8(),ge._nextUint8(),ge._nextUint8(),ge._nextUint8(),ge._nextUint8(),ge._nextUint8()],samples:[]},Be=(Pe.descriptorBlockSize/4-6)/4;for(let kn=0;kn<Be;kn++){const On={bitOffset:ge._nextUint16(),bitLength:ge._nextUint8(),channelType:ge._nextUint8(),samplePosition:[ge._nextUint8(),ge._nextUint8(),ge._nextUint8(),ge._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&On.channelType?(On.sampleLower=ge._nextInt32(),On.sampleUpper=ge._nextInt32()):(On.sampleLower=ge._nextUint32(),On.sampleUpper=ge._nextUint32()),Pe.samples[kn]=On}X.dataFormatDescriptor.length=0,X.dataFormatDescriptor.push(Pe);const Oe=new Il(d,fe,me,!0);for(;Oe._offset<me;){const kn=Oe._nextUint32(),On=Oe._scan(kn),zn=y0(On),pi=Oe._scan(kn-On.byteLength);X.keyValue[zn]=zn.match(/^ktx/i)?y0(pi):pi,Oe._offset%4&&Oe._skip(4-Oe._offset%4)}if(Ae<=0)return X;const Fe=new Il(d,Ee,Ae,!0),Xe=Fe._nextUint16(),at=Fe._nextUint16(),mt=Fe._nextUint32(),wt=Fe._nextUint32(),At=Fe._nextUint32(),Tt=Fe._nextUint32(),yt=[];for(let kn=0;kn<re;kn++)yt.push({imageFlags:Fe._nextUint32(),rgbSliceByteOffset:Fe._nextUint32(),rgbSliceByteLength:Fe._nextUint32(),alphaSliceByteOffset:Fe._nextUint32(),alphaSliceByteLength:Fe._nextUint32()});const St=Ee+Fe._offset,Ft=St+mt,Mt=Ft+wt,Gt=Mt+At,rn=new Uint8Array(d.buffer,d.byteOffset+St,mt),gn=new Uint8Array(d.buffer,d.byteOffset+Ft,wt),Kt=new Uint8Array(d.buffer,d.byteOffset+Mt,At),In=new Uint8Array(d.buffer,d.byteOffset+Gt,Tt);return X.globalData={endpointCount:Xe,selectorCount:at,imageDescs:yt,endpointsData:rn,selectorsData:gn,tablesData:Kt,extendedData:In},X}(new Uint8Array(e));if(s.vkFormat!==0)return async function(d){const{vkFormat:b,pixelWidth:X,pixelHeight:$,pixelDepth:Z}=d;if(Ty[b]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");const re=d.levels[0];let le,he;if(d.supercompressionScheme===0)le=re.levelData;else{if(d.supercompressionScheme!==2)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");wm||(wm=new Promise(async me=>{const Ee=new My;await Ee.init(),me(Ee)})),le=(await wm).decode(re.levelData,re.uncompressedByteLength)}he=p_[b]===_.VzW?new Float32Array(le.buffer,le.byteOffset,le.byteLength/Float32Array.BYTES_PER_ELEMENT):p_[b]===_.cLu?new Uint16Array(le.buffer,le.byteOffset,le.byteLength/Uint16Array.BYTES_PER_ELEMENT):le;const fe=Z===0?new _.IEO(he,X,$):new _.JUT(he,X,$,Z);return fe.type=p_[b],fe.format=Ty[b],fe.encoding=Iy[b]||_.rnI,fe.needsUpdate=!0,Promise.resolve(fe)}(s);const a=i,h=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:a},[e])).then(d=>this._createTextureFrom(d.data));return Qd.set(e,{promise:h}),h}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),x0--,this}}dc.BasisFormat={ETC1S:0,UASTC_4x4:1},dc.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},dc.EngineFormat={RGBAFormat:_.wk1,RGBA_ASTC_4x4_Format:_.ptH,RGBA_BPTC_Format:_.bsb,RGBA_ETC2_EAC_Format:_.ekQ,RGBA_PVRTC_4BPPV1_Format:_.eaV,RGBA_S3TC_DXT5_Format:_.ILR,RGB_ETC1_Format:_.fto,RGB_ETC2_Format:_.l0P,RGB_PVRTC_4BPPV1_Format:_._AM,RGB_S3TC_DXT1_Format:_.wuA},dc.BasisWorker=function(){let c,e,i;const s=_EngineFormat,a=_TranscoderFormat,h=_BasisFormat;self.addEventListener("message",function(Z){const re=Z.data;switch(re.type){case"init":c=re.config,le=re.transcoderBinary,e=new Promise(he=>{i={wasmBinary:le,onRuntimeInitialized:he},BASIS(i)}).then(()=>{i.initializeBasis(),i.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")});break;case"transcode":e.then(()=>{try{const{width:he,height:fe,hasAlpha:me,mipmaps:Ee,format:Ae,dfdTransferFn:ye,dfdFlags:ge}=function(Be){const Oe=new i.KTX2File(new Uint8Array(Be));function Fe(){Oe.close(),Oe.delete()}if(!Oe.isValid())throw Fe(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const Xe=Oe.isUASTC()?h.UASTC_4x4:h.ETC1S,at=Oe.getWidth(),mt=Oe.getHeight(),wt=Oe.getLevels(),At=Oe.getHasAlpha(),Tt=Oe.getDFDTransferFunc(),yt=Oe.getDFDFlags(),{transcoderFormat:St,engineFormat:Ft}=function(Gt,rn,gn,Kt){let In,kn;const On=Gt===h.ETC1S?b:X;for(let zn=0;zn<On.length;zn++){const pi=On[zn];if(c[pi.if]&&pi.basisFormat.includes(Gt)&&!(Kt&&pi.transcoderFormat.length<2)&&(!pi.needsPowerOfTwo||$(rn)&&$(gn)))return In=pi.transcoderFormat[Kt?1:0],kn=pi.engineFormat[Kt?1:0],{transcoderFormat:In,engineFormat:kn}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),In=a.RGBA32,kn=s.RGBAFormat,{transcoderFormat:In,engineFormat:kn}}(Xe,at,mt,At);if(!at||!mt||!wt)throw Fe(),new Error("THREE.KTX2Loader:	Invalid texture");if(!Oe.startTranscoding())throw Fe(),new Error("THREE.KTX2Loader: .startTranscoding failed");const Mt=[];for(let Gt=0;Gt<wt;Gt++){const rn=Oe.getImageLevelInfo(Gt,0,0),gn=rn.origWidth,Kt=rn.origHeight,In=new Uint8Array(Oe.getImageTranscodedSizeInBytes(Gt,0,0,St));if(!Oe.transcodeImage(In,Gt,0,0,St,0,-1,-1))throw Fe(),new Error("THREE.KTX2Loader: .transcodeImage failed.");Mt.push({data:In,width:gn,height:Kt})}return Fe(),{width:at,height:mt,hasAlpha:At,mipmaps:Mt,format:Ft,dfdTransferFn:Tt,dfdFlags:yt}}(re.buffer),Pe=[];for(let Be=0;Be<Ee.length;++Be)Pe.push(Ee[Be].data.buffer);self.postMessage({type:"transcode",id:re.id,width:he,height:fe,hasAlpha:me,mipmaps:Ee,format:Ae,dfdTransferFn:ye,dfdFlags:ge},Pe)}catch(he){console.error(he),self.postMessage({type:"error",id:re.id,error:he.message})}})}var le});const d=[{if:"astcSupported",basisFormat:[h.UASTC_4x4],transcoderFormat:[a.ASTC_4x4,a.ASTC_4x4],engineFormat:[s.RGBA_ASTC_4x4_Format,s.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[h.ETC1S,h.UASTC_4x4],transcoderFormat:[a.BC7_M5,a.BC7_M5],engineFormat:[s.RGBA_BPTC_Format,s.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[h.ETC1S,h.UASTC_4x4],transcoderFormat:[a.BC1,a.BC3],engineFormat:[s.RGB_S3TC_DXT1_Format,s.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[h.ETC1S,h.UASTC_4x4],transcoderFormat:[a.ETC1,a.ETC2],engineFormat:[s.RGB_ETC2_Format,s.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[h.ETC1S,h.UASTC_4x4],transcoderFormat:[a.ETC1],engineFormat:[s.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[h.ETC1S,h.UASTC_4x4],transcoderFormat:[a.PVRTC1_4_RGB,a.PVRTC1_4_RGBA],engineFormat:[s.RGB_PVRTC_4BPPV1_Format,s.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],b=d.sort(function(Z,re){return Z.priorityETC1S-re.priorityETC1S}),X=d.sort(function(Z,re){return Z.priorityUASTC-re.priorityUASTC});function $(Z){return Z<=2||(Z&Z-1)==0&&Z!==0}};const Ty={109:_.wk1,97:_.wk1,37:_.wk1,43:_.wk1,103:_.av9,83:_.av9,16:_.av9,22:_.av9,100:_.hEm,76:_.hEm,15:_.hEm,9:_.hEm},p_={109:_.VzW,97:_.cLu,37:_.ywz,43:_.ywz,103:_.VzW,83:_.cLu,16:_.ywz,22:_.ywz,100:_.VzW,76:_.cLu,15:_.ywz,9:_.ywz},Iy={43:_.knz,22:_.knz,15:_.knz},f_="KHR_texture_basisu";class m_ extends oe{constructor(){super(...arguments),this.dependencies=[Kn]}async onAdded(e){var i,s,a,h;this._importer||(this._importer=new _s(class extends dc{constructor(d){super(d),this.setTranscoderPath("https://cdn.jsdelivr.net/gh/BinomialLLC/basis_universal@master/webgl/transcoder/build/").detectSupport(e.renderer.rendererObject)}async createTexture(d,b){const X=d.map(Z=>new Uint8Array(Z.slice(0))),$=await super.createTexture(d,b);return $.source._sourceImgBuffer=X,$.userData.mimeType="image/ktx2",$}},["ktx2"],!1)),yr.Importers.push(this._importer),(h=(a=(s=(i=e.getManager())===null||i===void 0?void 0:i.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||a===void 0?void 0:a.extensions)===null||h===void 0||h.push(g_)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&yr.Importers.splice(yr.Importers.indexOf(this._importer),1),this._importer=void 0}}m_.PluginType="KTX2LoadPlugin";const g_=c=>({writeTexture:(e,i)=>{if(e.userData.mimeType!=="image/ktx2")return;if(i.source!==void 0)return void console.warn("ktx2 export: source already set");const s=e.source._sourceImgBuffer;if(!s||!s.length)return void console.warn("ktx2 export: no source buffer for ktx2");i.extensions=i.extensions||{};const a={},h=new Blob(Array.isArray(s)?s:[s],{type:"image/ktx2"});a.source=c.processImageBlob(h,e),i.extensions[f_]=a,c.extensionsUsed[f_]=!0}});class Hd{constructor(e){this.presets=[],this.name="",this.selected=void 0,e&&(this.name=e)}async apply(e,i,s){var a,h;if(!i)return void(this.selected=void 0);let d=this.presets.find(b=>b.path===i.path);return d||(this.presets.push(i),d=i),this.selected=d,(h=(a=e.getManager())===null||a===void 0?void 0:a.importer)===null||h===void 0?void 0:h.importAsset(d,s)}}class E0 extends Hd{constructor(){super(...arguments),this.name="Background"}async apply(e,i){const s=await super.apply(e,i),a=s==null?void 0:s[0];return a&&(a.encoding=_.knz,await e.setBackground(a)),a}}class Dy extends Hd{constructor(){super(...arguments),this.name="Environment"}async apply(e,i){const s=await super.apply(e,i),a=s==null?void 0:s[0];return a&&await e.scene.setEnvironment(a),a}}class Py extends Hd{constructor(){super(...arguments),this.name="GemEnvironment"}async apply(e,i){const s=await super.apply(e,i),a=s==null?void 0:s[0];return nt(e.getPluginByType("Diamond"),"envMap",a),a}}class __ extends Hd{async apply(e,i){var s,a;const h=await super.apply(e,i,{processImported:!1});return h?(a=(s=e.getManager())===null||s===void 0?void 0:s.importer)===null||a===void 0?void 0:a.processImported(h):void 0}}class px extends __{constructor(){super(...arguments),this.name="MaterialLibraries"}async apply(e,i){const s=await super.apply(e,i);return s&&await e.alert("Material Library successfully imported."),s}}class Wd extends Xi{constructor(){super(...arguments),this.toJSON=null,this.enabled=!0,this.presetGroups=[],this.uiConfig={type:"folder",label:"Presets",expanded:!0,limitedUi:!0,children:[()=>this.presetGroups.map(e=>({type:"dropdown",label:e.name,limitedUi:!0,children:[{value:"",label:"none"},...e.presets.map(i=>({label:i.path.split("/").pop(),value:i.path}))],getValue:()=>{var i;return((i=e.selected)===null||i===void 0?void 0:i.path)||""},setValue:i=>{e.apply(this._viewer,e.presets.find(s=>s.path===i))}})),{type:"button",label:"Download Selection",limitedUi:!0,value:()=>{const e=this.exportPresets();zl(new File([JSON.stringify(e,null,2)],"preset.template.json",{type:"application/json"}))}},{type:"button",label:"Export Preset Groups",hidden:!0,limitedUi:!1,value:()=>{const e=this.exportPresetGroups();zl(new File([JSON.stringify(e,null,2)],"presetGroups.json",{type:"application/json"}))}}]}}async onAdded(e){var i,s;await super.onAdded(e),this.presetGroups.push(new E0),this.presetGroups.push(new Dy),this.presetGroups.push(new Py),this.presetGroups.push(new __("Ground")),this.presetGroups.push(new __("CameraViews")),this.presetGroups.push(new __("MaterialConfiguration")),this.presetGroups.push(new px),(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)}exportPresets(){const e=Object.fromEntries(this.presetGroups.map(i=>{var s;return[i.name,((s=i.selected)===null||s===void 0?void 0:s.path)||void 0]}).filter(([,i])=>i));return e.type=Wd.PluginType,e}async fromJSON(e,i){var s,a;if(!super.fromJSON(e,i))return null;const h={...e};delete h.type;const d=[];for(const[b,X]of Object.entries(h)){const $=this.presetGroups.find(le=>le.name===b),Z=$==null?void 0:$.presets;if(!$||!Z)continue;const re=typeof X=="string"?{path:X}:X;d.push($.apply(this._viewer,re))}return await Promise.all(d),(a=(s=this.uiConfig).uiRefresh)===null||a===void 0||a.call(s,"postFrame",!0),this}loadPresetGroups(e){var i;for(const[s,a]of Object.entries(e)){const h=(i=this.presetGroups.find(d=>d.name===s))===null||i===void 0?void 0:i.presets;h==null||h.push(...a)}}exportPresetGroups(){return Object.fromEntries(this.presetGroups.map(e=>[e.name,e.presets.map(i=>i.path)]).filter(([,e])=>e.length>0))}}Wd.PluginType="PresetLibraryPlugin";var Bu=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let tl=class extends Xi{constructor(){super(),this.enabled=!0,this.dependencies=[Kn],this.scenes=[],this.assets={},this.toJSON=void 0,this._isPlaying=!1,this._isPlayingLoop=!1,this._options={},this.minSceneTime=2e3,this.loadScenes=this.loadScenes.bind(this),this.play=this.play.bind(this),this.stop=this.stop.bind(this),this.downloadScenes=this.downloadScenes.bind(this),this.promptLoadScenes=this.promptLoadScenes.bind(this)}get loadedScenes(){return this.scenes.length}async promptLoadScenes(){const c=await ro(!0,!1,"model/gltf");await this.loadScenes(c)}async loadScenes(c){var e,i;const s=await Promise.all(c.map(async a=>await a.arrayBuffer()));for(let a=0;a<c.length;a++){const h=c[a];this.scenes.push({[h.name]:new Uint8Array(s[a])}),this.assets[h.name]={path:h.name,file:h}}(i=(e=this.uiConfig)===null||e===void 0?void 0:e.uiRefresh)===null||i===void 0||i.call(e)}async play(){var c;if(!this._viewer||this._isPlaying||this._isPlayingLoop)return;this._isPlaying=!0,this._isPlayingLoop=!0;const e=this._viewer.getPluginByType("AssetManagerBasicPopupPlugin");e==null||e.enabled,e&&(e.enabled=!1);const i=this._viewer.getPluginByType("FrameFade"),s=this._viewer.getPluginByType("GLTFAnimation"),a=this._viewer.getPluginByType("CameraViews");for(;this._isPlaying;)for(const h of this.scenes){if(!this._isPlaying)break;const d=Object.keys(h);s==null||s.stopAnimation(!1),await(a==null?void 0:a.stopAllAnimations()),this._viewer.scene.removeSceneModels(),this._viewer.renderEnabled=!1;for(const X of d){let $=this.assets[X];$||($={path:X,file:new File([h[X]],X)},this.assets[X]=$),await((c=this._viewer.getManager())===null||c===void 0?void 0:c.addAssetSingle($,this._options))}if(!this._isPlaying)break;this._viewer.renderEnabled=!0,e&&(e.enabled=!1),i&&(i.enabled=!0,await i.startTransition(1e3));const b=[eo(this.minSceneTime)];s&&b.push(s.playAnimation()),a&&b.push(a.animateAllViews()),await Promise.all(b)}this._isPlayingLoop=!1}stop(){this._isPlaying=!1}async downloadScenes(){const c={};for(const i of this.scenes)for(const s of Object.keys(i)){const a=c[s]?s+"_":s;c[a]=i[a]}const e=Dv(c);ts(new Blob([e],{type:"application/zip"}),"scenes.glbloop")}async onAdded(c){await super.onAdded(c);const e=this;yr.Importers.push(new _s(class extends jf{load(i,s,a,h){super.load(i,d=>{e.loadScenes([...d.values()]),s==null||s(null),eo(100).then(e.play)},a,h)}},["glbloop"],!0))}};tl.PluginType="SceneLoopPlugin",Bu([Ha("Loaded scenes")],tl.prototype,"loadedScenes",null),Bu([lr("Load Scenes")],tl.prototype,"promptLoadScenes",null),Bu([Ha("Playing")],tl.prototype,"_isPlaying",void 0),Bu([cr("Min Scene Time")],tl.prototype,"minSceneTime",void 0),Bu([lr("Play")],tl.prototype,"play",null),Bu([lr("Stop")],tl.prototype,"stop",null),Bu([lr("Download Scenes")],tl.prototype,"downloadScenes",null),tl=Bu([ur("Scene Loop")],tl);var v_=__webpackgi_require__(701),Jp=__webpackgi_require__.n(v_),fx=__webpackgi_require__(236),A_=__webpackgi_require__.n(fx),mx=__webpackgi_require__(850),xm=__webpackgi_require__.n(mx),Ry=__webpackgi_require__(182),Xc=__webpackgi_require__.n(Ry),gx=__webpackgi_require__(213),Em=__webpackgi_require__.n(gx),Sm=__webpackgi_require__(798),pc={};Sm.Z&&Sm.Z.locals&&(pc.locals=Sm.Z.locals);var y_,S0=0,nl={};nl.styleTagTransform=Em(),nl.setAttributes=xm(),nl.insert=function(c,e){(e.target||document.head).appendChild(c)},nl.domAPI=A_(),nl.insertStyleElement=Xc(),pc.use=function(c){return nl.options=c||{},S0++||(y_=Jp()(Sm.Z,nl)),pc},pc.unuse=function(){S0>0&&!--S0&&(y_(),y_=null)};var _x=pc;class $p extends Xi{constructor(e){super(),this.enabled=!0,this.dependencies=[Kn],this._mainDiv=ma({id:"assetManager"+e,addToBody:!1,innerHTML:""}),this._contentDiv=ma({id:"assetManager"+e+"Content",addToBody:!1,innerHTML:""}),this.enabled||(this._mainDiv.style.display="none"),this._mainDiv.appendChild(this._contentDiv)}_onEnabledChange(){this.enabled||(this._mainDiv.style.display="none")}async onAdded(e){var i,s,a,h;await super.onAdded(e),e.container.appendChild(this._mainDiv);const d=new Map;(s=(i=e.getManager())===null||i===void 0?void 0:i.importer)===null||s===void 0||s.addEventListener("importFile",b=>{b.state!=="done"?d.set(b.path,{state:b.state,progress:b.progress?100*b.progress:void 0}):d.delete(b.path),this._updateMainDiv(d)}),(h=(a=e.getManager())===null||a===void 0?void 0:a.exporter)===null||h===void 0||h.addEventListener("exportFile",b=>{b.state!=="done"?d.set(b.obj.name,{state:b.state,progress:b.progress?100*b.progress:void 0}):d.delete(b.obj.name),this._updateMainDiv(d)})}}(function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);h>3&&d&&Object.defineProperty(e,i,d)})([Xn("Enabled"),lt($p.prototype._onEnabledChange),kt()],$p.prototype,"enabled",void 0);let il=class extends $p{constructor(){super("Popup");const c=ma({id:"assetManagerPopupClose",addToBody:!1,innerHTML:"&#10005"});c.addEventListener("click",()=>{this._mainDiv.style.display="none"}),this._mainDiv.appendChild(c)}_updateMainDiv(c){if(!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");let e="";c.forEach((i,s)=>{e+=`<span class="processState">${i.state}</span>: ${s.split("/").pop()} ${i.progress?" - "+i.progress.toFixed(0)+"%":""}<br>`}),this._contentDiv.innerHTML=e,c.size===0?this._mainDiv.style.display="none":this._mainDiv.style.display="block"}async onAdded(c){_x.use({target:c.container}),await super.onAdded(c)}};il.PluginType="AssetManagerBasicPopupPlugin",il=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d}([ur("Asset manager popup")],il);class By extends Fs{constructor(e){super({vertexShader:ae.vertexShader,uniforms:{tDiffuse:{value:null}},defines:{},fragmentShader:`
                varying vec2 vUv;
                ${e[0]}
                void main() {
                    gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                    #glMarker
                    ${e[1]}
                }
                `},"tDiffuse"),this.uiConfig=void 0,this.customMaterial=new lu}render(e,i,s,a,h){super.render(e,i,s,a,h),this.needsSwap=!0}}class fc extends Sl{constructor(e=!0,i=!0){super(),this.depthTonemap=e,this.passId="combinedPost",this.dependencies=[Or],this.toJSON=void 0,this._beforeFilters=[],this._afterFilters=["render"],this._requiredFilters=["render"],this._renderToScreen=!0,this._setDirty=this._setDirty.bind(this),this._renderToScreen=i}get renderToScreen(){return this._renderToScreen}async onAdded(e){var i,s;return!((s=(i=this._viewer)===null||i===void 0?void 0:i.screenShader)===null||s===void 0)&&s.isShaderPass2&&(this._renderToScreen=!1),this._renderToScreen&&nt(e.renderer.passes.find(a=>a.passId==="screen"),"enabled",!1,!0,!0),super.onAdded(e)}passCtor(e){var i,s,a,h;const d=e.screenShader,b=["",""];this._renderToScreen&&!d.isShaderPass2&&(b[0]=Array.isArray(d)?d[0]:((i=d)===null||i===void 0?void 0:i.pars)||"",b[1]=Array.isArray(d)?d[1]:typeof d=="string"?d:((s=d)===null||s===void 0?void 0:s.main)||"");const X=new By(b);return nt((h=(a=X.uiConfig)===null||a===void 0?void 0:a.children)===null||h===void 0?void 0:h.find($=>{var Z;return((Z=$)===null||Z===void 0?void 0:Z.label)==="Enabled"}),"hidden",!0,!0),X}_update(e){var i;return!!super._update(e)&&(this._pass.passObject.updateShaderProperties((i=this._viewer)===null||i===void 0?void 0:i.getPlugin(Or)),!0)}_setDirty(){this.pass&&(this.pass.dirty=!0)}get uiConfig(){var e,i,s;return(s=(i=(e=this.pass)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.uiConfig)!==null&&s!==void 0?s:{}}addExtension(e){this.pass.passObject.material.registerMaterialExtensions([e])}}fc.PluginType="CombinedPostPlugin";var Ch=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class ku extends Xi{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[fc]}get uiConfig(){var e;return(e=this._extension)===null||e===void 0?void 0:e.uiConfig}get config(){return this._extension}disposeExtension(){}async onAdded(e){var i;await super.onAdded(e),this._extension=this.generateExtension(e),(i=e.getPlugin(fc))===null||i===void 0||i.addExtension(this._extension)}async onRemove(e){this.disposeExtension(),this._extension=void 0,await super.onRemove(e)}}Ch([kt("extension")],ku.prototype,"_extension",void 0),Ch([kt()],ku.prototype,"enabled",void 0);class ky{constructor(){this.uiConfig=void 0,this.enabled=!0}shaderExtender(e,i,s){this.enabled&&(e.fragmentShader=gs(e.fragmentShader,"#glMarker",` 
            gl_FragColor = LinearTosRGB(gl_FragColor);
            #glMarker
        `))}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}}class b_ extends ku{generateExtension(e){return new ky}}function Cm(c,e,i){return c&~(1<<e)|(i?1:0)<<e}function w_(c,e){return c&~(1<<e)}b_.PluginType="GammaCorrection";var Zp,Mm=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};const Oy=_.dZ3;let hr=Zp=class{constructor(c,e=!0,i=!0){this.depthTonemap=e,this.toneMapping=_.LY2,this.tonemapBackground=!0,this.clipBackground=!1,this.exposure=1,this._renderToScreen=!0,this.enabled=!0,this._rendererState={},this.extraUniforms={tNormalDepth:{value:null},tGBufferFlags:{value:null},opacity:{value:1}},this.parsFragmentSnippet=(s,a)=>this.enabled?Ne`
            ${this.depthTonemap?Wa:""}
            #define USE_DEPTH_TONEMAP ${this.depthTonemap?"1":"0"}
            uniform float opacity;
            ${`float getToneMapBit(in float number){return mod(floor(number/pow(2.,1.)),2.);}vec4 ToneMapping(in vec4 color){vec4 outColor=opacity*color;
#if USE_DEPTH_TONEMAP > 0
bool doTonemap=getToneMapBit(getGBufferFlags(vUv).a*255.)>0.5;float depth=getDepth(vUv);
#if TONEMAP_BACKGROUND < 1 || TRANSPARENT_BACKGROUND > 0
bool isBackground=depth>0.9999;if(isBackground)doTonemap=false;
#endif
if(doTonemap){
#endif
#if defined( TONE_MAPPING )
outColor.rgb=toneMapping(outColor.rgb);
#endif
#if USE_DEPTH_TONEMAP > 0
}else{
#if TRANSPARENT_BACKGROUND > 0
if(isBackground)outColor.a=0.;
#endif
}if(depth<0.00001)outColor.a=0.;
#endif
return outColor;}`}
        `:"",this._combinedPostPlugin=c.getPlugin(fc),this._setDirty=this._setDirty.bind(this),this._renderToScreen=i,this.depthTonemap=e}shaderExtender(c,e,i){this.enabled&&(c.fragmentShader=gs(c.fragmentShader,"#glMarker",` 
            gl_FragColor = ToneMapping(gl_FragColor);
            #glMarker
        `))}onObjectRender(c,e,i){if(!this.enabled)return;const{toneMapping:s,toneMappingExposure:a,outputEncoding:h}=i;this._rendererState.toneMapping=s,this._rendererState.toneMappingExposure=a,this._rendererState.outputEncoding=h;let d=this.tonemapBackground?"1":"0";e.materialObject.defines.TONEMAP_BACKGROUND!==d&&(e.materialObject.defines.TONEMAP_BACKGROUND=d,e.materialObject.needsUpdate=!0),d=this.clipBackground?"1":"0",e.materialObject.defines.TRANSPARENT_BACKGROUND!==d&&(e.materialObject.defines.TRANSPARENT_BACKGROUND=d,e.materialObject.needsUpdate=!0),i.toneMapping=this.toneMapping,i.toneMappingExposure=this.exposure,i.outputEncoding=_.knz,e.materialObject.toneMapped=!0,e.materialObject.needsUpdate=!0}onAfterRender(c,e,i){i.toneMapping=this._rendererState.toneMapping,i.toneMappingExposure=this._rendererState.toneMappingExposure,i.outputEncoding=this._rendererState.outputEncoding}getUiConfig(){return this.uiConfig}computeCacheKey(c){return this.enabled?"1":"0"}isCompatible(c){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var c;(c=this.__setDirty)===null||c===void 0||c.call(this),this._setDirty()}};hr.PluginType="Tonemap",Mm([Xs("Mode",[["Linear",_.EoG],["Reinhard",_.CdI],["Cineon",_.YGz],["ACESFilmic",_.LY2],["Uncharted2",Oy]].map(c=>({label:c[0],value:c[1]})),{limitedUi:!0}),lt(Zp.prototype._setDirty),kt()],hr.prototype,"toneMapping",void 0),Mm([lt(Zp.prototype._setDirty),Xn("Tonemap Background",{limitedUi:!0}),kt()],hr.prototype,"tonemapBackground",void 0),Mm([lt(Zp.prototype._setDirty),Xn("Clip Background"),kt()],hr.prototype,"clipBackground",void 0),Mm([lt(Zp.prototype._setDirty),ai("Exposure",[0,2*Math.PI],.01,{limitedUi:!0}),kt()],hr.prototype,"exposure",void 0),hr=Zp=Mm([ur("Tonemapping")],hr);class x_ extends ku{constructor(e=!0){super(),this.depthTonemap=e,this.depthTonemap=e,this.updateGBuffer=this.updateGBuffer.bind(this)}fromJSON(e,i){return e.pass&&((e={...e}).extension={...e.pass},delete e.extension.enabled,delete e.pass),super.fromJSON(e,i)}async onAdded(e){var i;await super.onAdded(e),(i=e.getPlugin(Or))===null||i===void 0||i.registerGBufferUpdater(this.updateGBuffer)}generateExtension(e){return new hr(e,this.depthTonemap)}get exposure(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.exposure)!==null&&i!==void 0?i:1}set exposure(e){this._extension&&(this._extension.exposure=e,this._extension.setDirty())}get toneMapping(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.toneMapping)!==null&&i!==void 0?i:_.EoG}set toneMapping(e){this._extension&&(this._extension.toneMapping=e,this._extension.setDirty())}updateGBuffer(e,i){var s,a;if(e instanceof _.Kj0&&(!((s=e.material)===null||s===void 0)&&s.userData)){const h=((a=e.material)===null||a===void 0?void 0:a.userData.postTonemap)===!1?0:1;i.w=Cm(i.w,1,h)}}}x_.PluginType="Tonemap",_.WdD.tonemapping_pars_fragment=_.WdD.tonemapping_pars_fragment.replace("vec3 CustomToneMapping( vec3 color ) { return color; }",`

// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/
#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )
vec3 Uncharted2ToneMapping( vec3 color ) {

	// John Hable's filmic operator from Uncharted 2 video game
	color *= toneMappingExposure;
	return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( 1.0 ) ) );

}

vec3 CustomToneMapping( vec3 color ) { return Uncharted2ToneMapping( color ); }

`);var Mh,qd=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Ou=Mh=class{constructor(c){this.enabled=!1,this.lutBackground=!0,this.intensity=1,this.lutMap=void 0,this.lutMap1=void 0,this.lutMap2=void 0,this.extraUniforms={intensity:{value:1},lutSize:{value:1},lutSize1:{value:1},lutSize2:{value:1}},this.parsFragmentSnippet=(e,i)=>this.enabled?`#if USE_LUT == 1
uniform float lutSize;uniform float lutSize1;uniform float lutSize2;uniform float intensity;
#if USE_3DTEXTURE == 1
precision highp sampler3D;uniform sampler3D lut3d;
#if USE_LUT1 == 1
uniform sampler3D lut3d1;
#endif
#if USE_LUT2 == 1
uniform sampler3D lut3d2;
#endif
#else
uniform sampler2D lut;vec3 lutLookup(sampler2D tex,float size,vec3 rgb){float sliceHeight=1./size;float yPixelHeight=1./(size*size);float slice=rgb.b*size;float interp=fract(slice);float slice0=slice-interp;float centeredInterp=interp-0.5;float slice1=slice0+sign(centeredInterp);float greenOffset=clamp(rgb.g*sliceHeight,yPixelHeight*0.5,sliceHeight-yPixelHeight*0.5);vec2 uv0=vec2(rgb.r,slice0*sliceHeight+greenOffset);vec2 uv1=vec2(rgb.r,slice1*sliceHeight+greenOffset);vec3 sample0=texture2D(tex,uv0).rgb;vec3 sample1=texture2D(tex,uv1).rgb;return mix(sample0,sample1,abs(centeredInterp));}
#endif
float getLUTBit(in float number){return mod(number,2.);}float getLUTIndex(in float number){return mod(number,8.);}vec3 getUVW(in float lutSize,in vec4 color){float pixelWidth=1./lutSize;float halfPixelWidth=0.5/lutSize;vec3 uvw=vec3(halfPixelWidth)+color.rgb*(1.-pixelWidth);return uvw;}vec4 colorLookUp(in vec4 color){vec4 outColor;float lutFac=step(0.0001,getLUTBit(getGBufferFlags(vUv).a*255.));
#if USE_3DTEXTURE == 1
float lutIndex=getLUTIndex(getGBufferFlags(vUv).g*255.);if(lutIndex==0.){outColor=vec4(texture(lut3d,getUVW(lutSize,color)).rgb,color.a);}else if(lutIndex==1.){
#if USE_LUT1 == 1
outColor=vec4(texture(lut3d1,getUVW(lutSize1,color)).rgb,color.a);
#endif
}else if(lutIndex==2.){
#if USE_LUT2 == 1
outColor=vec4(texture(lut3d2,getUVW(lutSize2,color)).rgb,color.a);
#endif
}else{outColor=vec4(texture(lut3d,getUVW(lutSize,color)).rgb,color.a);}
#else
outColor=vec4(lutLookup(lut,lutSize,getUVW(lutSize,color)),color.a);
#endif
outColor=mix(color,outColor,lutFac);return vec4(mix(color,outColor,intensity));}
#endif
`:"",this._combinedPostPlugin=c.getPlugin(fc),this._setDirty=this._setDirty.bind(this)}shaderExtender(c,e,i){this.enabled&&(c.fragmentShader=gs(c.fragmentShader,"#glMarker",` 
            #if USE_LUT == 1
                bool isBackground = getDepth(vUv)>0.9999;
                #if LUT_BACKGROUND == 1
                    gl_FragColor = colorLookUp(gl_FragColor);
                #else
                    gl_FragColor = isBackground ? gl_FragColor : colorLookUp(gl_FragColor);
                #endif
            #endif
            #glMarker
        `))}onObjectRender(c,e,i){if(this.enabled){if(this.lutMap){const s=this.lutMap.texture3D?1:0;e.materialObject.defines.USE_3DTEXTURE!==s&&(e.materialObject.defines.USE_3DTEXTURE=s,e.materialObject.needsUpdate=!0);let a=1;this.lutMap.texture3D?(e.materialObject.uniforms.lut3d={value:this.lutMap.texture3D},e.materialObject.uniforms.lut3d.value.needsUpdate=!0,a=this.lutMap.texture3D.image.width):this.lutMap.texture&&(e.materialObject.uniforms.lut={value:this.lutMap.texture},e.materialObject.uniforms.lut.value.needsUpdate=!0,a=this.lutMap.texture.image.width),e.materialObject.uniforms.lutSize.value=a,e.materialObject.uniforms.intensity.value=this.intensity,e.materialObject.defines.USE_LUT=1,e.materialObject.defines.LUT_BACKGROUND=this.lutBackground?1:0}else e.materialObject.defines.USE_3DTEXTURE=0,e.materialObject.defines.USE_LUT=0,e.materialObject.needsUpdate=!0;if(this.lutMap1&&this.lutMap1.texture3D){e.materialObject.uniforms.lut3d1={value:this.lutMap1.texture3D},e.materialObject.uniforms.lut3d1.value.needsUpdate=!0;const s=this.lutMap1.texture3D.image.width;e.materialObject.uniforms.lutSize1.value=s,e.materialObject.defines.USE_LUT1=1,e.materialObject.needsUpdate=!0}else e.materialObject.defines.USE_LUT1=0,e.materialObject.needsUpdate=!0;if(this.lutMap2&&this.lutMap2.texture3D){e.materialObject.uniforms.lut3d2={value:this.lutMap2.texture3D},e.materialObject.uniforms.lut3d2.value.needsUpdate=!0;const s=this.lutMap2.texture3D.image.width;e.materialObject.uniforms.lutSize2.value=s,e.materialObject.defines.USE_LUT2=1,e.materialObject.needsUpdate=!0}else e.materialObject.defines.USE_LUT2=0,e.materialObject.needsUpdate=!0}}getUiConfig(c){const e={type:"folder",label:"LUT",children:[{type:"checkbox",label:"Enabled",get value(){var i,s;return(s=(i=c.materialObject.userData[qo.PluginType])===null||i===void 0?void 0:i.enable)===null||s===void 0||s},set value(i){var s;const a=c.materialObject.userData[qo.PluginType];i!==(a==null?void 0:a.enable)&&(a||Tm(c.materialObject),c.materialObject.userData[qo.PluginType].enable=i,(s=e.uiRefresh)===null||s===void 0||s.call(e,"postFrame",!0))},onChange:this.setDirty},()=>({type:"dropdown",children:[["LUT 0",0],["LUT 1",1],["LUT 2",2]].map(i=>({label:i[0],value:i[1]})),label:"index",hidden:()=>{const i=c.materialObject.userData[qo.PluginType];return!!i&&!i.enable},get value(){var i,s;return(s=(i=c.materialObject.userData[qo.PluginType])===null||i===void 0?void 0:i.index)!==null&&s!==void 0?s:0},set value(i){var s;c.materialObject.userData[qo.PluginType]||Tm(c.materialObject),c.materialObject.userData[qo.PluginType].index=i,(s=e.uiRefresh)===null||s===void 0||s.call(e,"postFrame",!0)},onChange:this.setDirty()})]};return e}computeCacheKey(c){return this.enabled?"1":"0"}isCompatible(c){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var c;(c=this.__setDirty)===null||c===void 0||c.call(this),this._setDirty()}};function Tm(c){const e=c==null?void 0:c.userData;if(!e)return!1;e[qo.PluginType]||(e[qo.PluginType]={});const i=e[qo.PluginType];return i.enable=!0,i.index===void 0&&(i.index=0),c.isMaterial&&(c.needsUpdate=!0),!0}qd([kt(),lt(Mh.prototype._setDirty),Xn("Enable")],Ou.prototype,"enabled",void 0),qd([kt(),lt(Mh.prototype._setDirty),Xn("LUT Background")],Ou.prototype,"lutBackground",void 0),qd([kt(),lt(Mh.prototype._setDirty),ai("Intensity")],Ou.prototype,"intensity",void 0),qd([lt(Mh.prototype._setDirty),su("LUT"),kt()],Ou.prototype,"lutMap",void 0),qd([lt(Mh.prototype._setDirty),su("LUT1"),kt()],Ou.prototype,"lutMap1",void 0),qd([lt(Mh.prototype._setDirty),su("LUT2"),kt()],Ou.prototype,"lutMap2",void 0),Ou=Mh=qd([ur("LUT")],Ou);class qo extends ku{constructor(){super(),this.materialExtension={getUiConfig:e=>{var i;return(i=this._extension)===null||i===void 0?void 0:i.getUiConfig(e)},computeCacheKey:e=>{var i;return(this.enabled?"1":"0")+(!((i=e.materialObject.userData[qo.PluginType])===null||i===void 0)&&i.enable?"1":"0")},isCompatible:e=>!0},this.updateGBuffer=this.updateGBuffer.bind(this)}async onAdded(e){var i,s;await super.onAdded(e),(i=e.getPlugin(Or))===null||i===void 0||i.registerGBufferUpdater(this.updateGBuffer);const a=e.getPlugin(Kn);(s=a==null?void 0:a.materials)===null||s===void 0||s.registerMaterialExtension(this.materialExtension)}generateExtension(e){return new Ou(e)}updateGBuffer(e,i){var s,a;if(e instanceof _.Kj0&&(!((s=e.material)===null||s===void 0)&&s.userData)){const h=(a=e.material)===null||a===void 0?void 0:a.userData[qo.PluginType];if(h){const d=h.enable===!1?0:1;i.w=Cm(i.w,0,d);for(let X=0;X<3;X++)i.y=w_(i.y,X);let b=h.enable?h.index:0;b=Math.min(b,7),i.y=i.y|b}else i.w=Cm(i.w,0,1)}}}qo.PluginType="LUTPlugin1";var Im,E_=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Yd=Im=class{constructor(c){this.enabled=!1,this.power=.5,this.bgcolor=new _.Ilk(0),this.extraUniforms={power:{value:1},bgcolor:{value:new _.Ilk}},this.parsFragmentSnippet=(e,i)=>this.enabled?Ne`
            uniform float power;
            uniform vec3 bgcolor;
            ${"vec4 Vignette(in vec4 color){vec2 uv=vUv*(1.-vUv);float vig=uv.x*uv.y*16.;vig=pow(vig,power);return vec4(mix(color.rgb,vec3(bgcolor),1.-vig),color.a);}"}
        `:"",this._combinedPostPlugin=c.getPlugin(fc),this._setDirty=this._setDirty.bind(this)}shaderExtender(c,e,i){this.enabled&&(c.fragmentShader=gs(c.fragmentShader,"#glMarker",` 
            gl_FragColor = Vignette(gl_FragColor);
            #glMarker
        `))}onObjectRender(c,e,i){this.enabled&&(e.materialObject.uniforms.power.value=this.power,e.materialObject.uniforms.bgcolor.value.copy(this.bgcolor))}getUiConfig(){return this.uiConfig}computeCacheKey(c){return this.enabled?"1":"0"}isCompatible(c){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var c;(c=this.__setDirty)===null||c===void 0||c.call(this),this._setDirty()}};Yd.PluginType="Vignette",E_([lt(Im.prototype._setDirty),Xn("Enable"),kt()],Yd.prototype,"enabled",void 0),E_([lt(Im.prototype._setDirty),ai("Power",[.1,4],.01,{limitedUi:!0}),kt()],Yd.prototype,"power",void 0),E_([lt(Im.prototype._setDirty),ml("Color"),kt()],Yd.prototype,"bgcolor",void 0),Yd=Im=E_([ur("Vignette")],Yd);class S_ extends ku{constructor(){super()}generateExtension(e){return new Yd(e)}get power(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.power)!==null&&i!==void 0?i:1}set power(e){this._extension&&(this._extension.power=e,this._extension.setDirty())}get color(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.bgcolor)!==null&&i!==void 0?i:new _.Ilk}set color(e){this._extension&&(this._extension.bgcolor.copy(e),this._extension.setDirty())}}S_.PluginType="Vignette";var Dm,Pm=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let ef=Dm=class{constructor(c){this.enabled=!1,this.aberrationIntensity=.01,this.extraUniforms={aberrationIntensity:{value:1}},this.parsFragmentSnippet=(e,i)=>this.enabled?Ne`
            uniform float aberrationIntensity;
            ${"vec4 chromaticAberration(){vec2 distFromCenter=vUv-0.5;vec2 aberrated=aberrationIntensity*pow(distFromCenter,vec2(2.));vec4 color=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 outColor=vec4(tDiffuseTexelToLinear(texture2D(tDiffuse,vUv+aberrated)).r,color.g,tDiffuseTexelToLinear(texture2D(tDiffuse,vUv-aberrated)).b,color.a);return outColor;}"}
        `:"",this._combinedPostPlugin=c.getPlugin(fc),this._setDirty=this._setDirty.bind(this)}shaderExtender(c,e,i){this.enabled&&(c.fragmentShader=gs(c.fragmentShader,"#glMarker",` 
            gl_FragColor = chromaticAberration();
            #glMarker
        `))}onObjectRender(c,e,i){this.enabled&&(e.materialObject.uniforms.aberrationIntensity.value=this.aberrationIntensity)}getUiConfig(){return this.uiConfig}computeCacheKey(c){return this.enabled?"1":"0"}isCompatible(c){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var c;(c=this.__setDirty)===null||c===void 0||c.call(this),this._setDirty()}};ef.PluginType="ChromaticAberration",Pm([lt(Dm.prototype._setDirty),Xn("Enable"),kt()],ef.prototype,"enabled",void 0),Pm([lt(Dm.prototype._setDirty),ai("Intensity",[0,.1],.001,{limitedUi:!0}),kt()],ef.prototype,"aberrationIntensity",void 0),ef=Dm=Pm([ur("ChromaticAberration")],ef);class C_ extends ku{constructor(){super()}generateExtension(e){return new ef(e)}get intensity(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.aberrationIntensity)!==null&&i!==void 0?i:1}set intensity(e){this._extension&&(this._extension.aberrationIntensity=e,this._extension.setDirty())}}C_.PluginType="ChromaticAberration";var tf,M_=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Xd=tf=class{constructor(c){this.enabled=!1,this.grainMultiply=!1,this.grainIntensity=10,this.extraUniforms={grainIntensity:{value:1},grainMultiply:{value:1}},this.parsFragmentSnippet=(e,i)=>this.enabled?Ne`
            uniform float grainIntensity;
            uniform bool grainMultiply;
            ${"vec4 grain(in vec4 color){float x=(vUv.x+4.)*(vUv.y+4.)*(10.);vec4 grain=vec4(mod((mod(x,13.)+1.)*(mod(x,123.)+1.),0.01)-0.005)*grainIntensity;vec4 outColor=color;if(grainMultiply){grain=1.-grain;outColor.rgb=color.rgb*vec3(grain);}else{outColor.rgb=color.rgb+vec3(grain);}return outColor;}"}
        `:"",this._combinedPostPlugin=c.getPlugin(fc),this._setDirty=this._setDirty.bind(this)}shaderExtender(c,e,i){this.enabled&&(c.fragmentShader=gs(c.fragmentShader,"#glMarker",` 
            gl_FragColor = grain(gl_FragColor);
            #glMarker
        `))}onObjectRender(c,e,i){this.enabled&&(e.materialObject.uniforms.grainIntensity.value=this.grainIntensity,e.materialObject.uniforms.grainMultiply.value=this.grainMultiply)}getUiConfig(){return this.uiConfig}computeCacheKey(c){return this.enabled?"1":"0"}isCompatible(c){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var c;(c=this.__setDirty)===null||c===void 0||c.call(this),this._setDirty()}};M_([lt(tf.prototype._setDirty),Xn("Enable"),kt()],Xd.prototype,"enabled",void 0),M_([lt(tf.prototype._setDirty),Xn("Multiply"),kt()],Xd.prototype,"grainMultiply",void 0),M_([lt(tf.prototype._setDirty),ai("Intensity",[0,20],.01,{limitedUi:!0}),kt()],Xd.prototype,"grainIntensity",void 0),Xd=tf=M_([ur("FilmicGrain")],Xd);class Kd extends ku{constructor(){super()}generateExtension(e){return new Xd(e)}get intensity(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.grainIntensity)!==null&&i!==void 0?i:1}set intensity(e){this._extension&&(this._extension.grainIntensity=e,this._extension.setDirty())}get multiply(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.grainMultiply)!==null&&i!==void 0&&i}set multiply(e){this._extension&&(this._extension.grainMultiply=e,this._extension.setDirty())}}Kd.PluginType="FilmicGrain";var T_=__webpackgi_require__(44),nf={};T_.Z&&T_.Z.locals&&(nf.locals=T_.Z.locals);var C0,Kc=0,Jc={};Jc.styleTagTransform=Em(),Jc.setAttributes=xm(),Jc.insert=function(c,e){(e.target||document.head).appendChild(c)},Jc.domAPI=A_(),Jc.insertStyleElement=Xc(),nf.use=function(c){return Jc.options=c||{},Kc++||(C0=Jp()(T_.Z,Jc)),nf},nf.unuse=function(){Kc>0&&!--Kc&&(C0(),C0=null)};var M0=nf;let rf=class extends $p{constructor(c=!0){super("LoadingBar"),this.showText=c}_updateMainDiv(c){if(!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");let e=1,i=1;c.forEach((s,a)=>{var h;e+=(h=s.progress)!==null&&h!==void 0?h:99,i+=100}),this._contentDiv.innerHTML=this.showText?(100*e/i).toFixed(0)+"%":"&nbsp;",this._contentDiv.style.width=(100*e/i).toFixed(0)+"%",c.size===0?this._mainDiv.style.display="none":this._mainDiv.style.display="block"}async onAdded(c){M0.use({target:c.container}),await super.onAdded(c)}};async function I_(c,{ground:e=!0,bloom:i=!0,depthTonemap:s=!0,enableDrop:a=!1}={}){await c.addPlugin(Or),await c.addPlugin(Mu),a&&await c.addPlugin(Vf),await c.addPlugin(new Ho(32)),await c.addPlugin(new fc),await c.addPlugin(new C_),await c.addPlugin(new x_(s||!c.useRgbm)),await c.addPlugin(new qo),await c.addPlugin(new S_),await c.addPlugin(new Kd),await c.addPlugin(new b_),await c.addPlugin(Lg),await c.addPlugin(Ug),await c.addPlugin(zs),await c.addPlugin(sc),await c.addPlugin(Os),e&&await c.addPlugin(Ta),i&&await c.addPlugin(pm),await c.addPlugin(Za),await c.addPlugin(la),await c.addPlugin(ca),await c.addPlugin(ua),await c.addPlugin(Ml),await c.addPlugin(vm,!1),await c.addPlugin(Yp),await c.addPlugin(ys),await c.addPlugin(lc,!1),await c.addPlugin(cc,!1),await c.addPlugin(Gd,!1),await c.addPlugin(Tl,!1),await c.addPlugin(m_),await c.addPlugin(Wd),await c.addPlugin(tl)}async function Ly(c,{debug:e=!1,ground:i=!0,bloom:s=!0,depthTonemap:a=!0,importPopup:h=!1,enableDrop:d=!1}={}){var b;const X=new Zl(c);e&&await X.addPlugin(Ma);const $=await X.addPlugin(Kn,void 0,void 0,{storage:caches?await caches.open("webgi-cache-storage"):void 0});return h&&await X.addPlugin(il),await X.addPlugin(rf,!1),await I_(X,{ground:i,bloom:s,depthTonemap:a,enableDrop:d}),X.renderer.refreshPipeline(),(b=$.importer)===null||b===void 0||b.processors.add("model",{forAssetType:"model",process:(Z,re)=>Z}),X}rf.PluginType="AssetManagerLoadingBarPlugin",rf=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d}([ur("Asset manager loading bar")],rf);let vx=0;class T0 extends HTMLElement{constructor(){super(),this._initialized=!1,this._state={src:"",environment:""},this._models={},this._refreshingModels=!1,this._refreshingEnvironment=!1,this.viewerIndex=vx++,this.canvasId="webgi-viewer-"+this.viewerIndex,this.attachShadow({mode:"open"}),this.wrapper=document.createElement("div"),this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.display="block",this.canvas=au(),this.canvas.setAttribute("id",this.canvasId);const e=document.createElement("style");e.textContent=Qe`
            #${this.canvasId}{
              width: 100%; height: 100%; z-index: 1;
              display: block;
            }
        `,this.wrapper.append(this.canvas),this.shadowRoot.append(e,this.wrapper),this._initialize().then(async()=>this.refreshAll())}async refreshAll(){await Promise.all([this.refreshModelSource(),this.refreshEnvironment()])}async _initialize(){this._initialized||(this.viewer=await Ly({canvas:this.canvas,useRgbm:this._getAttr("rgbm","true")==="true",useGBufferDepth:this._getAttr("depth-prepass","true")==="true"},{debug:this._getAttr("debug","false")==="true",ground:this._getAttr("ground","baked")==="baked",bloom:this._getAttr("bloom","true")==="true",depthTonemap:!0}),this._initialized=!0,this.dispatchEvent(new Event("initialized")))}connectedCallback(){console.log("WebGiViewerElement added to page."),this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0)}disconnectedCallback(){console.log("WebGiViewerElement removed from page."),this.viewer&&(this.viewer.enabled=!1)}adoptedCallback(){console.log("WebGiViewerElement moved to new page."),this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0)}static get observedAttributes(){return["src","environment"]}attributeChangedCallback(e,i,s){console.log("WebGiViewerElement attributes changed.",e,i,s),this.refreshAll()}clearModels(){}async refreshModelSource(){if(!this.viewer)return;const e=this._getAttr("src","");if(e===this._state.src||this._refreshingModels)return;this._refreshingModels=!0;const i=[e],s=[],a=[];for(const h of i)!this._models[h]&&h&&(this._models[h]=this.viewer.getManager().importer.importPath(h,{autoScale:this._getAttr("auto-scale","true")==="true",autoCenter:this._getAttr("auto-center","true")==="true",processImported:!1}));for(const[h,d]of Object.entries(this._models))i.includes(h)?s.push(d):a.push(d);await Promise.all([Promise.all(s).then(async h=>Promise.all(h.map(async d=>this.viewer.getManager().importer.processImported(d)))).then(h=>{for(const d of h)for(const b of d)b&&b.assetType==="model"&&this.viewer.scene.addSceneObject(b)}),Promise.all(a).then(h=>{for(const d of h)for(const b of d)b&&b.assetType==="model"&&b.modelObject.removeFromParent()})]),this._state.src=e,this._refreshingModels=!1}async refreshEnvironment(){if(!this.viewer)return;if(!this.hasAttribute("environment"))return void(this._state.environment=null);const e=this._getAttr("environment","");if(e===this._state.src||this._refreshingEnvironment)return;this._refreshingEnvironment=!0;const i=this.viewer.scene.getEnvironment(),s=e?await this.viewer.getManager().importer.importSinglePath(e):void 0;s&&s.assetType!=="texture"||await this.viewer.scene.setEnvironment(s),i==null||i.dispose(),this._state.environment=e,this._refreshingEnvironment=!1}_getAttr(e,i){return this.hasAttribute(e)?this.getAttribute(e):i}}window&&window.customElements&&!window.customElements.get("webgi-viewer")&&window.customElements.define("webgi-viewer",T0);class Ny{constructor(e){var i,s,a;this._basePath=(i=e==null?void 0:e.basePath)!==null&&i!==void 0?i:"",this._assets=(a=(s=e==null?void 0:e.assets)===null||s===void 0?void 0:s.map(h=>this._resolveAsset(h)))!==null&&a!==void 0?a:[]}get basePath(){return this._basePath}get assets(){return this._assets}find(e){const i=this._assets.find(e);return i??void 0}_resolveAsset(e){return{...e,path:eh([this._basePath,e.path])}}}class Ax extends oe{constructor(...e){super(),this._assets=e}addAssetList(e){this._assets.push(e)}removeAssetList(e){const i=this._assets.indexOf(e);i>=0&&this._assets.splice(i,1)}async findAssetRegex(e){for(const i of this._assets){const s=i.find(a=>{var h,d;return a&&(e.test(a.path)||e.test((d=(h=a.file)===null||h===void 0?void 0:h.name)!==null&&d!==void 0?d:""))});if(s)return s}console.warn("Asset not found:",e)}async findAsset(e){return this.findAssetRegex(e.query)}async findAssetSimple(e,i=!1){return this.findAssetRegex(new RegExp(e,i?"i":""))}}var Uy={},I0=function(c){return URL.createObjectURL(new Blob([c],{type:"text/javascript"}))},D0=function(c){return new Worker(c)};try{URL.revokeObjectURL(I0(""))}catch{I0=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},D0=function(e){return new Worker(e,{type:"module"})}}var mr=Uint8Array,bo=Uint16Array,Lu=Uint32Array,Nu=new mr([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),bs=new mr([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Rm=new mr([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),qs=function(c,e){for(var i=new bo(31),s=0;s<31;++s)i[s]=e+=1<<c[s-1];var a=new Lu(i[30]);for(s=1;s<30;++s)for(var h=i[s];h<i[s+1];++h)a[h]=h-i[s]<<5|s;return[i,a]},Bm=qs(Nu,2),P0=Bm[0],D_=Bm[1];P0[28]=258,D_[258]=28;for(var Fy=qs(bs,0),R0=Fy[0],sf=Fy[1],Jd=new bo(32768),Ps=0;Ps<32768;++Ps){var $d=(43690&Ps)>>>1|(21845&Ps)<<1;$d=(61680&($d=(52428&$d)>>>2|(13107&$d)<<2))>>>4|(3855&$d)<<4,Jd[Ps]=((65280&$d)>>>8|(255&$d)<<8)>>>1}var Dl=function(c,e,i){for(var s=c.length,a=0,h=new bo(e);a<s;++a)++h[c[a]-1];var d,b=new bo(e);for(a=0;a<e;++a)b[a]=b[a-1]+h[a-1]<<1;if(i){d=new bo(1<<e);var X=15-e;for(a=0;a<s;++a)if(c[a])for(var $=a<<4|c[a],Z=e-c[a],re=b[c[a]-1]++<<Z,le=re|(1<<Z)-1;re<=le;++re)d[Jd[re]>>>X]=$}else for(d=new bo(s),a=0;a<s;++a)c[a]&&(d[a]=Jd[b[c[a]-1]++]>>>15-c[a]);return d},Yo=new mr(288);for(Ps=0;Ps<144;++Ps)Yo[Ps]=8;for(Ps=144;Ps<256;++Ps)Yo[Ps]=9;for(Ps=256;Ps<280;++Ps)Yo[Ps]=7;for(Ps=280;Ps<288;++Ps)Yo[Ps]=8;var of=new mr(32);for(Ps=0;Ps<32;++Ps)of[Ps]=5;var jy=Dl(Yo,9,0),zy=Dl(Yo,9,1),Vy=Dl(of,5,0),Gy=Dl(of,5,1),P_=function(c){for(var e=c[0],i=1;i<c.length;++i)c[i]>e&&(e=c[i]);return e},Pl=function(c,e,i){var s=e/8|0;return(c[s]|c[s+1]<<8)>>(7&e)&i},R_=function(c,e){var i=e/8|0;return(c[i]|c[i+1]<<8|c[i+2]<<16)>>(7&e)},km=function(c){return(c/8|0)+(7&c&&1)},Rl=function(c,e,i){(e==null||e<0)&&(e=0),(i==null||i>c.length)&&(i=c.length);var s=new(c instanceof bo?bo:c instanceof Lu?Lu:mr)(i-e);return s.set(c.subarray(e,i)),s},Om=function(c,e,i){var s=c.length;if(!s||i&&!i.l&&s<5)return e||new mr(0);var a=!e||i,h=!i||i.i;i||(i={}),e||(e=new mr(3*s));var d=function(pi){var yn=e.length;if(pi>yn){var Ji=new mr(Math.max(2*yn,pi));Ji.set(e),e=Ji}},b=i.f||0,X=i.p||0,$=i.b||0,Z=i.l,re=i.d,le=i.m,he=i.n,fe=8*s;do{if(!Z){i.f=b=Pl(c,X,1);var me=Pl(c,X+1,3);if(X+=3,!me){var Ee=c[(wt=km(X)+4)-4]|c[wt-3]<<8,Ae=wt+Ee;if(Ae>s){if(h)throw"unexpected EOF";break}a&&d($+Ee),e.set(c.subarray(wt,Ae),$),i.b=$+=Ee,i.p=X=8*Ae;continue}if(me==1)Z=zy,re=Gy,le=9,he=5;else{if(me!=2)throw"invalid block type";var ye=Pl(c,X,31)+257,ge=Pl(c,X+10,15)+4,Pe=ye+Pl(c,X+5,31)+1;X+=14;for(var Be=new mr(Pe),Oe=new mr(19),Fe=0;Fe<ge;++Fe)Oe[Rm[Fe]]=Pl(c,X+3*Fe,7);X+=3*ge;var Xe=P_(Oe),at=(1<<Xe)-1,mt=Dl(Oe,Xe,1);for(Fe=0;Fe<Pe;){var wt,At=mt[Pl(c,X,at)];if(X+=15&At,(wt=At>>>4)<16)Be[Fe++]=wt;else{var Tt=0,yt=0;for(wt==16?(yt=3+Pl(c,X,3),X+=2,Tt=Be[Fe-1]):wt==17?(yt=3+Pl(c,X,7),X+=3):wt==18&&(yt=11+Pl(c,X,127),X+=7);yt--;)Be[Fe++]=Tt}}var St=Be.subarray(0,ye),Ft=Be.subarray(ye);le=P_(St),he=P_(Ft),Z=Dl(St,le,1),re=Dl(Ft,he,1)}if(X>fe){if(h)throw"unexpected EOF";break}}a&&d($+131072);for(var Mt=(1<<le)-1,Gt=(1<<he)-1,rn=X;;rn=X){var gn=(Tt=Z[R_(c,X)&Mt])>>>4;if((X+=15&Tt)>fe){if(h)throw"unexpected EOF";break}if(!Tt)throw"invalid length/literal";if(gn<256)e[$++]=gn;else{if(gn==256){rn=X,Z=null;break}var Kt=gn-254;if(gn>264){var In=Nu[Fe=gn-257];Kt=Pl(c,X,(1<<In)-1)+P0[Fe],X+=In}var kn=re[R_(c,X)&Gt],On=kn>>>4;if(!kn)throw"invalid distance";if(X+=15&kn,Ft=R0[On],On>3&&(In=bs[On],Ft+=R_(c,X)&(1<<In)-1,X+=In),X>fe){if(h)throw"unexpected EOF";break}a&&d($+131072);for(var zn=$+Kt;$<zn;$+=4)e[$]=e[$-Ft],e[$+1]=e[$+1-Ft],e[$+2]=e[$+2-Ft],e[$+3]=e[$+3-Ft];$=zn}}i.l=Z,i.p=rn,i.b=$,Z&&(b=1,i.m=le,i.d=re,i.n=he)}while(!b);return $==e.length?e:Rl(e,0,$)},$c=function(c,e,i){i<<=7&e;var s=e/8|0;c[s]|=i,c[s+1]|=i>>>8},af=function(c,e,i){i<<=7&e;var s=e/8|0;c[s]|=i,c[s+1]|=i>>>8,c[s+2]|=i>>>16},B_=function(c,e){for(var i=[],s=0;s<c.length;++s)c[s]&&i.push({s,f:c[s]});var a=i.length,h=i.slice();if(!a)return[Uu,0];if(a==1){var d=new mr(i[0].s+1);return d[i[0].s]=1,[d,1]}i.sort(function(Be,Oe){return Be.f-Oe.f}),i.push({s:-1,f:25001});var b=i[0],X=i[1],$=0,Z=1,re=2;for(i[0]={s:-1,f:b.f+X.f,l:b,r:X};Z!=a-1;)b=i[i[$].f<i[re].f?$++:re++],X=i[$!=Z&&i[$].f<i[re].f?$++:re++],i[Z++]={s:-1,f:b.f+X.f,l:b,r:X};var le=h[0].s;for(s=1;s<a;++s)h[s].s>le&&(le=h[s].s);var he=new bo(le+1),fe=k_(i[Z-1],he,0);if(fe>e){s=0;var me=0,Ee=fe-e,Ae=1<<Ee;for(h.sort(function(Be,Oe){return he[Oe.s]-he[Be.s]||Be.f-Oe.f});s<a;++s){var ye=h[s].s;if(!(he[ye]>e))break;me+=Ae-(1<<fe-he[ye]),he[ye]=e}for(me>>>=Ee;me>0;){var ge=h[s].s;he[ge]<e?me-=1<<e-he[ge]++-1:++s}for(;s>=0&&me;--s){var Pe=h[s].s;he[Pe]==e&&(--he[Pe],++me)}fe=e}return[new mr(he),fe]},k_=function(c,e,i){return c.s==-1?Math.max(k_(c.l,e,i+1),k_(c.r,e,i+1)):e[c.s]=i},B0=function(c){for(var e=c.length;e&&!c[--e];);for(var i=new bo(++e),s=0,a=c[0],h=1,d=function(X){i[s++]=X},b=1;b<=e;++b)if(c[b]==a&&b!=e)++h;else{if(!a&&h>2){for(;h>138;h-=138)d(32754);h>2&&(d(h>10?h-11<<5|28690:h-3<<5|12305),h=0)}else if(h>3){for(d(a),--h;h>6;h-=6)d(8304);h>2&&(d(h-3<<5|8208),h=0)}for(;h--;)d(a);h=1,a=c[b]}return[i.subarray(0,s),e]},lf=function(c,e){for(var i=0,s=0;s<e.length;++s)i+=c[s]*e[s];return i},Lm=function(c,e,i){var s=i.length,a=km(e+2);c[a]=255&s,c[a+1]=s>>>8,c[a+2]=255^c[a],c[a+3]=255^c[a+1];for(var h=0;h<s;++h)c[a+h+4]=i[h];return 8*(a+4+s)},k0=function(c,e,i,s,a,h,d,b,X,$,Z){$c(e,Z++,i),++a[256];for(var re=B_(a,15),le=re[0],he=re[1],fe=B_(h,15),me=fe[0],Ee=fe[1],Ae=B0(le),ye=Ae[0],ge=Ae[1],Pe=B0(me),Be=Pe[0],Oe=Pe[1],Fe=new bo(19),Xe=0;Xe<ye.length;++Xe)Fe[31&ye[Xe]]++;for(Xe=0;Xe<Be.length;++Xe)Fe[31&Be[Xe]]++;for(var at=B_(Fe,7),mt=at[0],wt=at[1],At=19;At>4&&!mt[Rm[At-1]];--At);var Tt,yt,St,Ft,Mt=$+5<<3,Gt=lf(a,Yo)+lf(h,of)+d,rn=lf(a,le)+lf(h,me)+d+14+3*At+lf(Fe,mt)+(2*Fe[16]+3*Fe[17]+7*Fe[18]);if(Mt<=Gt&&Mt<=rn)return Lm(e,Z,c.subarray(X,X+$));if($c(e,Z,1+(rn<Gt)),Z+=2,rn<Gt){Tt=Dl(le,he,0),yt=le,St=Dl(me,Ee,0),Ft=me;var gn=Dl(mt,wt,0);for($c(e,Z,ge-257),$c(e,Z+5,Oe-1),$c(e,Z+10,At-4),Z+=14,Xe=0;Xe<At;++Xe)$c(e,Z+3*Xe,mt[Rm[Xe]]);Z+=3*At;for(var Kt=[ye,Be],In=0;In<2;++In){var kn=Kt[In];for(Xe=0;Xe<kn.length;++Xe){var On=31&kn[Xe];$c(e,Z,gn[On]),Z+=mt[On],On>15&&($c(e,Z,kn[Xe]>>>5&127),Z+=kn[Xe]>>>12)}}}else Tt=jy,yt=Yo,St=Vy,Ft=of;for(Xe=0;Xe<b;++Xe)if(s[Xe]>255){On=s[Xe]>>>18&31,af(e,Z,Tt[On+257]),Z+=yt[On+257],On>7&&($c(e,Z,s[Xe]>>>23&31),Z+=Nu[On]);var zn=31&s[Xe];af(e,Z,St[zn]),Z+=Ft[zn],zn>3&&(af(e,Z,s[Xe]>>>5&8191),Z+=bs[zn])}else af(e,Z,Tt[s[Xe]]),Z+=yt[s[Xe]];return af(e,Z,Tt[256]),Z+yt[256]},Qy=new Lu([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Uu=new mr(0),Hy=function(c,e,i,s,a,h){var d=c.length,b=new mr(s+d+5*(1+Math.ceil(d/7e3))+a),X=b.subarray(s,b.length-a),$=0;if(!e||d<8)for(var Z=0;Z<=d;Z+=65535){var re=Z+65535;re<d?$=Lm(X,$,c.subarray(Z,re)):(X[Z]=h,$=Lm(X,$,c.subarray(Z,d)))}else{for(var le=Qy[e-1],he=le>>>13,fe=8191&le,me=(1<<i)-1,Ee=new bo(32768),Ae=new bo(me+1),ye=Math.ceil(i/3),ge=2*ye,Pe=function($r){return(c[$r]^c[$r+1]<<ye^c[$r+2]<<ge)&me},Be=new Lu(25e3),Oe=new bo(288),Fe=new bo(32),Xe=0,at=0,mt=(Z=0,0),wt=0,At=0;Z<d;++Z){var Tt=Pe(Z),yt=32767&Z,St=Ae[Tt];if(Ee[yt]=St,Ae[Tt]=yt,wt<=Z){var Ft=d-Z;if((Xe>7e3||mt>24576)&&Ft>423){$=k0(c,X,0,Be,Oe,Fe,at,mt,At,Z-At,$),mt=Xe=at=0,At=Z;for(var Mt=0;Mt<286;++Mt)Oe[Mt]=0;for(Mt=0;Mt<30;++Mt)Fe[Mt]=0}var Gt=2,rn=0,gn=fe,Kt=yt-St&32767;if(Ft>2&&Tt==Pe(Z-Kt))for(var In=Math.min(he,Ft)-1,kn=Math.min(32767,Z),On=Math.min(258,Ft);Kt<=kn&&--gn&&yt!=St;){if(c[Z+Gt]==c[Z+Gt-Kt]){for(var zn=0;zn<On&&c[Z+zn]==c[Z+zn-Kt];++zn);if(zn>Gt){if(Gt=zn,rn=Kt,zn>In)break;var pi=Math.min(Kt,zn-2),yn=0;for(Mt=0;Mt<pi;++Mt){var Ji=Z-Kt+Mt+32768&32767,ar=Ji-Ee[Ji]+32768&32767;ar>yn&&(yn=ar,St=Ji)}}}Kt+=(yt=St)-(St=Ee[yt])+32768&32767}if(rn){Be[mt++]=268435456|D_[Gt]<<18|sf[rn];var $i=31&D_[Gt],Pr=31&sf[rn];at+=Nu[$i]+bs[Pr],++Oe[257+$i],++Fe[Pr],wt=Z+Gt,++Xe}else Be[mt++]=c[Z],++Oe[c[Z]]}}$=k0(c,X,h,Be,Oe,Fe,at,mt,At,Z-At,$),!h&&7&$&&($=Lm(X,$+1,Uu))}return Rl(b,0,s+km($)+a)},Wy=function(){for(var c=new Lu(256),e=0;e<256;++e){for(var i=e,s=9;--s;)i=(1&i&&3988292384)^i>>>1;c[e]=i}return c}(),cf=function(){var c=-1;return{p:function(e){for(var i=c,s=0;s<e.length;++s)i=Wy[255&i^e[s]]^i>>>8;c=i},d:function(){return~c}}},O0=function(){var c=1,e=0;return{p:function(i){for(var s=c,a=e,h=i.length,d=0;d!=h;){for(var b=Math.min(d+2655,h);d<b;++d)a+=s+=i[d];s=(65535&s)+15*(s>>16),a=(65535&a)+15*(a>>16)}c=s,e=a},d:function(){return(255&(c%=65521))<<24|c>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},ue=function(c,e,i,s,a){return Hy(c,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(c.length)))):12+e.mem,i,s,!a)},o=function(c,e){var i={};for(var s in c)i[s]=c[s];for(var s in e)i[s]=e[s];return i},g=function(c,e,i){for(var s=c(),a=c.toString(),h=a.slice(a.indexOf("[")+1,a.lastIndexOf("]")).replace(/ /g,"").split(","),d=0;d<s.length;++d){var b=s[d],X=h[d];if(typeof b=="function"){e+=";"+X+"=";var $=b.toString();if(b.prototype)if($.indexOf("[native code]")!=-1){var Z=$.indexOf(" ",8)+1;e+=$.slice(Z,$.indexOf("(",Z))}else for(var re in e+=$,b.prototype)e+=";"+X+".prototype."+re+"="+b.prototype[re].toString();else e+=$}else i[X]=b}return[e,i]},j=[],Y=function(c,e,i,s){var a;if(!j[i]){for(var h="",d={},b=c.length-1,X=0;X<b;++X)h=(a=g(c[X],h,d))[0],d=a[1];j[i]=g(c[b],h,d)}var $=o({},j[i][1]);return function(Z,re,le,he,fe){var me=D0(Uy[re]||(Uy[re]=I0(Z)));return me.onerror=function(Ee){return fe(Ee.error,null)},me.onmessage=function(Ee){return fe(null,Ee.data)},me.postMessage(le,he),me}(j[i][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",i,$,function(Z){var re=[];for(var le in Z)(Z[le]instanceof mr||Z[le]instanceof bo||Z[le]instanceof Lu)&&re.push((Z[le]=new Z[le].constructor(Z[le])).buffer);return re}($),s)},ee=function(){return[mr,bo,Lu,Nu,bs,Rm,P0,R0,zy,Gy,Jd,Dl,P_,Pl,R_,km,Rl,Om,fn,Ce,xe]},ie=function(){return[mr,bo,Lu,Nu,bs,Rm,D_,sf,jy,Yo,Vy,of,Jd,Qy,Uu,Dl,$c,af,B_,k_,B0,lf,Lm,k0,km,Rl,Hy,ue,wn,Ce]},se=function(){return[ct,Bt,$e,cf,Wy]},de=function(){return[dt,ft]},pe=function(){return[Lt,$e,O0]},be=function(){return[Wt]},Ce=function(c){return postMessage(c,[c.buffer])},xe=function(c){return c&&c.size&&new mr(c.size)},Ie=function(c,e,i,s,a,h){var d=Y(i,s,a,function(b,X){d.terminate(),h(b,X)});return d.postMessage([c,e],e.consume?[c.buffer]:[]),function(){d.terminate()}},Re=function(c){return c.ondata=function(e,i){return postMessage([e,i],[e.buffer])},function(e){return c.push(e.data[0],e.data[1])}},De=function(c,e,i,s,a){var h,d=Y(c,s,a,function(b,X){b?(d.terminate(),e.ondata.call(e,b)):(X[1]&&d.terminate(),e.ondata.call(e,b,X[0],X[1]))});d.postMessage(i),e.push=function(b,X){if(h)throw"stream finished";if(!e.ondata)throw"no stream handler";d.postMessage([b,h=X],[b.buffer])},e.terminate=function(){d.terminate()}},ze=function(c,e){return c[e]|c[e+1]<<8},je=function(c,e){return(c[e]|c[e+1]<<8|c[e+2]<<16|c[e+3]<<24)>>>0},Ve=function(c,e){return je(c,e)+4294967296*je(c,e+4)},$e=function(c,e,i){for(;i;++e)c[e]=i,i>>>=8},ct=function(c,e){var i=e.filename;if(c[0]=31,c[1]=139,c[2]=8,c[8]=e.level<2?4:e.level==9?2:0,c[9]=3,e.mtime!=0&&$e(c,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),i){c[3]=8;for(var s=0;s<=i.length;++s)c[s+10]=i.charCodeAt(s)}},dt=function(c){if(c[0]!=31||c[1]!=139||c[2]!=8)throw"invalid gzip data";var e=c[3],i=10;4&e&&(i+=c[10]|2+(c[11]<<8));for(var s=(e>>3&1)+(e>>4&1);s>0;s-=!c[i++]);return i+(2&e)},ft=function(c){var e=c.length;return(c[e-4]|c[e-3]<<8|c[e-2]<<16|c[e-1]<<24)>>>0},Bt=function(c){return 10+(c.filename&&c.filename.length+1||0)},Lt=function(c,e){var i=e.level,s=i==0?0:i<6?1:i==9?3:2;c[0]=120,c[1]=s<<6|(s?32-2*s:1)},Wt=function(c){if((15&c[0])!=8||c[0]>>>4>7||(c[0]<<8|c[1])%31)throw"invalid zlib data";if(32&c[1])throw"invalid zlib data: preset dictionaries not supported"};function qt(c,e){return e||typeof c!="function"||(e=c,c={}),this.ondata=e,c}var Ot=function(){function c(e,i){i||typeof e!="function"||(i=e,e={}),this.ondata=i,this.o=e||{}}return c.prototype.p=function(e,i){this.ondata(ue(e,this.o,0,0,!i),i)},c.prototype.push=function(e,i){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=i,this.p(e,i||!1)},c}(),En=function(){return function(c,e){De([ie,function(){return[Re,Ot]}],this,qt.call(this,c,e),function(i){var s=new Ot(i.data);onmessage=Re(s)},6)}}();function Ln(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return Ie(c,e,[ie],function(s){return Ce(wn(s.data[0],s.data[1]))},0,i)}function wn(c,e){return ue(c,e||{},0,0)}var jn=function(){function c(e){this.s={},this.p=new mr(0),this.ondata=e}return c.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var i=this.p.length,s=new mr(i+e.length);s.set(this.p),s.set(e,i),this.p=s},c.prototype.c=function(e){this.d=this.s.i=e||!1;var i=this.s.b,s=Om(this.p,this.o,this.s);this.ondata(Rl(s,i,this.s.b),this.d),this.o=Rl(s,this.s.b-32768),this.s.b=this.o.length,this.p=Rl(this.p,this.s.p/8|0),this.s.p&=7},c.prototype.push=function(e,i){this.e(e),this.c(i)},c}(),Wn=function(){return function(c){this.ondata=c,De([ee,function(){return[Re,jn]}],this,0,function(){var e=new jn;onmessage=Re(e)},7)}}();function hn(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return Ie(c,e,[ee],function(s){return Ce(fn(s.data[0],xe(s.data[1])))},1,i)}function fn(c,e){return Om(c,e)}var Gn=function(){function c(e,i){this.c=cf(),this.l=0,this.v=1,Ot.call(this,e,i)}return c.prototype.push=function(e,i){Ot.prototype.push.call(this,e,i)},c.prototype.p=function(e,i){this.c.p(e),this.l+=e.length;var s=ue(e,this.o,this.v&&Bt(this.o),i&&8,!i);this.v&&(ct(s,this.o),this.v=0),i&&($e(s,s.length-8,this.c.d()),$e(s,s.length-4,this.l)),this.ondata(s,i)},c}(),Sn=function(){return function(c,e){De([ie,se,function(){return[Re,Ot,Gn]}],this,qt.call(this,c,e),function(i){var s=new Gn(i.data);onmessage=Re(s)},8)}}();function Hn(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return Ie(c,e,[ie,se,function(){return[di]}],function(s){return Ce(di(s.data[0],s.data[1]))},2,i)}function di(c,e){e||(e={});var i=cf(),s=c.length;i.p(c);var a=ue(c,e,Bt(e),8),h=a.length;return ct(a,e),$e(a,h-8,i.d()),$e(a,h-4,s),a}var nr=function(){function c(e){this.v=1,jn.call(this,e)}return c.prototype.push=function(e,i){if(jn.prototype.e.call(this,e),this.v){var s=this.p.length>3?dt(this.p):4;if(s>=this.p.length&&!i)return;this.p=this.p.subarray(s),this.v=0}if(i){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}jn.prototype.c.call(this,i)},c}(),Ci=function(){return function(c){this.ondata=c,De([ee,de,function(){return[Re,jn,nr]}],this,0,function(){var e=new nr;onmessage=Re(e)},9)}}();function sr(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return Ie(c,e,[ee,de,function(){return[Dt]}],function(s){return Ce(Dt(s.data[0]))},3,i)}function Dt(c,e){return Om(c.subarray(dt(c),-8),e||new mr(ft(c)))}var xt=function(){function c(e,i){this.c=O0(),this.v=1,Ot.call(this,e,i)}return c.prototype.push=function(e,i){Ot.prototype.push.call(this,e,i)},c.prototype.p=function(e,i){this.c.p(e);var s=ue(e,this.o,this.v&&2,i&&4,!i);this.v&&(Lt(s,this.o),this.v=0),i&&$e(s,s.length-4,this.c.d()),this.ondata(s,i)},c}(),tn=function(){return function(c,e){De([ie,pe,function(){return[Re,Ot,xt]}],this,qt.call(this,c,e),function(i){var s=new xt(i.data);onmessage=Re(s)},10)}}();function Qt(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return Ie(c,e,[ie,pe,function(){return[It]}],function(s){return Ce(It(s.data[0],s.data[1]))},4,i)}function It(c,e){e||(e={});var i=O0();i.p(c);var s=ue(c,e,2,4);return Lt(s,e),$e(s,s.length-4,i.d()),s}var Ht=function(){function c(e){this.v=1,jn.call(this,e)}return c.prototype.push=function(e,i){if(jn.prototype.e.call(this,e),this.v){if(this.p.length<2&&!i)return;this.p=this.p.subarray(2),this.v=0}if(i){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}jn.prototype.c.call(this,i)},c}(),_n=function(){return function(c){this.ondata=c,De([ee,be,function(){return[Re,jn,Ht]}],this,0,function(){var e=new Ht;onmessage=Re(e)},11)}}();function it(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return Ie(c,e,[ee,be,function(){return[on]}],function(s){return Ce(on(s.data[0],xe(s.data[1])))},5,i)}function on(c,e){return Om((Wt(c),c.subarray(2,-4)),e)}var Xt=function(){function c(e){this.G=nr,this.I=jn,this.Z=Ht,this.ondata=e}return c.prototype.push=function(e,i){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,i);else{if(this.p&&this.p.length){var s=new mr(this.p.length+e.length);s.set(this.p),s.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var a=this,h=function(){a.ondata.apply(a,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(h):(15&this.p[0])!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(h):new this.Z(h),this.s.push(this.p,i),this.p=null}}},c}(),xn=function(){function c(e){this.G=Ci,this.I=Wn,this.Z=_n,this.ondata=e}return c.prototype.push=function(e,i){Xt.prototype.push.call(this,e,i)},c}();function Nn(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return c[0]==31&&c[1]==139&&c[2]==8?sr(c,e,i):(15&c[0])!=8||c[0]>>4>7||(c[0]<<8|c[1])%31?hn(c,e,i):it(c,e,i)}function ti(c,e){return c[0]==31&&c[1]==139&&c[2]==8?Dt(c,e):(15&c[0])!=8||c[0]>>4>7||(c[0]<<8|c[1])%31?fn(c,e):on(c,e)}var wi=function(c,e,i,s){for(var a in c){var h=c[a],d=e+a;h instanceof mr?i[d]=[h,s]:Array.isArray(h)?i[d]=[h[0],o(s,h[1])]:wi(h,d+"/",i,s)}},Gi=typeof TextEncoder<"u"&&new TextEncoder,Ki=typeof TextDecoder<"u"&&new TextDecoder,Di=0;try{Ki.decode(Uu,{stream:!0}),Di=1}catch{}var Ui=function(c){for(var e="",i=0;;){var s=c[i++],a=(s>127)+(s>223)+(s>239);if(i+a>c.length)return[e,Rl(c,i-1)];a?a==3?(s=((15&s)<<18|(63&c[i++])<<12|(63&c[i++])<<6|63&c[i++])-65536,e+=String.fromCharCode(55296|s>>10,56320|1023&s)):e+=1&a?String.fromCharCode((31&s)<<6|63&c[i++]):String.fromCharCode((15&s)<<12|(63&c[i++])<<6|63&c[i++]):e+=String.fromCharCode(s)}},Wr=function(){function c(e){this.ondata=e,Di?this.t=new TextDecoder:this.p=Uu}return c.prototype.push=function(e,i){if(!this.ondata)throw"no callback";if(i=!!i,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),i),i){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var s=new mr(this.p.length+e.length);s.set(this.p),s.set(e,this.p.length);var a=Ui(s),h=a[0],d=a[1];if(i){if(d.length)throw"invalid utf-8 data";this.p=null}else this.p=d;this.ondata(h,i)}},c}(),rl=function(){function c(e){this.ondata=e}return c.prototype.push=function(e,i){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(zi(e),this.d=i||!1)},c}();function zi(c,e){if(e){for(var i=new mr(c.length),s=0;s<c.length;++s)i[s]=c.charCodeAt(s);return i}if(Gi)return Gi.encode(c);var a=c.length,h=new mr(c.length+(c.length>>1)),d=0,b=function(Z){h[d++]=Z};for(s=0;s<a;++s){if(d+5>h.length){var X=new mr(d+8+(a-s<<1));X.set(h),h=X}var $=c.charCodeAt(s);$<128||e?b($):$<2048?(b(192|$>>6),b(128|63&$)):$>55295&&$<57344?(b(240|($=65536+(1047552&$)|1023&c.charCodeAt(++s))>>18),b(128|$>>12&63),b(128|$>>6&63),b(128|63&$)):(b(224|$>>12),b(128|$>>6&63),b(128|63&$))}return Rl(h,0,d)}function qr(c,e){if(e){for(var i="",s=0;s<c.length;s+=16384)i+=String.fromCharCode.apply(null,c.subarray(s,s+16384));return i}if(Ki)return Ki.decode(c);var a=Ui(c),h=a[0];if(a[1].length)throw"invalid utf-8 data";return h}var Jr=function(c){return c==1?3:c<6?2:c==9?1:0},Nm=function(c,e){return e+30+ze(c,e+26)+ze(c,e+28)},ri=function(c,e,i){var s=ze(c,e+28),a=qr(c.subarray(e+46,e+46+s),!(2048&ze(c,e+8))),h=e+46+s,d=je(c,e+20),b=i&&d==4294967295?L0(c,h):[d,je(c,e+24),je(c,e+42)],X=b[0],$=b[1],Z=b[2];return[ze(c,e+10),X,$,a,h+ze(c,e+30)+ze(c,e+32),Z]},L0=function(c,e){for(;ze(c,e)!=1;e+=4+ze(c,e+2));return[Ve(c,e+12),Ve(c,e+4),Ve(c,e+20)]},Fu=function(c){var e=0;if(c)for(var i in c){var s=c[i].length;if(s>65535)throw"extra field too long";e+=s+4}return e},Lo=function(c,e,i,s,a,h,d,b){var X=s.length,$=i.extra,Z=b&&b.length,re=Fu($);$e(c,e,d!=null?33639248:67324752),e+=4,d!=null&&(c[e++]=20,c[e++]=i.os),c[e]=20,e+=2,c[e++]=i.flag<<1|(h==null&&8),c[e++]=a&&8,c[e++]=255&i.compression,c[e++]=i.compression>>8;var le=new Date(i.mtime==null?Date.now():i.mtime),he=le.getFullYear()-1980;if(he<0||he>119)throw"date not in range 1980-2099";if($e(c,e,he<<25|le.getMonth()+1<<21|le.getDate()<<16|le.getHours()<<11|le.getMinutes()<<5|le.getSeconds()>>>1),e+=4,h!=null&&($e(c,e,i.crc),$e(c,e+4,h),$e(c,e+8,i.size)),$e(c,e+12,X),$e(c,e+14,re),e+=16,d!=null&&($e(c,e,Z),$e(c,e+6,i.attrs),$e(c,e+10,d),e+=14),c.set(s,e),e+=X,re)for(var fe in $){var me=$[fe],Ee=me.length;$e(c,e,+fe),$e(c,e+2,Ee),c.set(me,e+4),e+=4+Ee}return Z&&(c.set(b,e),e+=Z),e},O_=function(c,e,i,s,a){$e(c,e,101010256),$e(c,e+8,i),$e(c,e+10,i),$e(c,e+12,s),$e(c,e+16,a)},uf=function(){function c(e){this.filename=e,this.c=cf(),this.size=0,this.compression=0}return c.prototype.process=function(e,i){this.ondata(null,e,i)},c.prototype.push=function(e,i){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,i&&(this.crc=this.c.d()),this.process(e,i||!1)},c}(),qy=function(){function c(e,i){var s=this;i||(i={}),uf.call(this,e),this.d=new Ot(i,function(a,h){s.ondata(null,a,h)}),this.compression=8,this.flag=Jr(i.level)}return c.prototype.process=function(e,i){try{this.d.push(e,i)}catch(s){this.ondata(s,null,i)}},c.prototype.push=function(e,i){uf.prototype.push.call(this,e,i)},c}(),Yy=function(){function c(e,i){var s=this;i||(i={}),uf.call(this,e),this.d=new En(i,function(a,h,d){s.ondata(a,h,d)}),this.compression=8,this.flag=Jr(i.level),this.terminate=this.d.terminate}return c.prototype.process=function(e,i){this.d.push(e,i)},c.prototype.push=function(e,i){uf.prototype.push.call(this,e,i)},c}(),N0=function(){function c(e){this.ondata=e,this.u=[],this.d=1}return c.prototype.add=function(e){var i=this;if(2&this.d)throw"stream finished";var s=zi(e.filename),a=s.length,h=e.comment,d=h&&zi(h),b=a!=e.filename.length||d&&h.length!=d.length,X=a+Fu(e.extra)+30;if(a>65535)throw"filename too long";var $=new mr(X);Lo($,0,e,s,b);var Z=[$],re=function(){for(var Ee=0,Ae=Z;Ee<Ae.length;Ee++){var ye=Ae[Ee];i.ondata(null,ye,!1)}Z=[]},le=this.d;this.d=0;var he=this.u.length,fe=o(e,{f:s,u:b,o:d,t:function(){e.terminate&&e.terminate()},r:function(){if(re(),le){var Ee=i.u[he+1];Ee?Ee.r():i.d=1}le=1}}),me=0;e.ondata=function(Ee,Ae,ye){if(Ee)i.ondata(Ee,Ae,ye),i.terminate();else if(me+=Ae.length,Z.push(Ae),ye){var ge=new mr(16);$e(ge,0,134695760),$e(ge,4,e.crc),$e(ge,8,me),$e(ge,12,e.size),Z.push(ge),fe.c=me,fe.b=X+me+16,fe.crc=e.crc,fe.size=e.size,le&&fe.r(),le=1}else le&&re()},this.u.push(fe)},c.prototype.end=function(){var e=this;if(2&this.d)throw 1&this.d?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},c.prototype.e=function(){for(var e=0,i=0,s=0,a=0,h=this.u;a<h.length;a++)s+=46+($=h[a]).f.length+Fu($.extra)+($.o?$.o.length:0);for(var d=new mr(s+22),b=0,X=this.u;b<X.length;b++){var $=X[b];Lo(d,e,$,$.f,$.u,$.c,i,$.o),e+=46+$.f.length+Fu($.extra)+($.o?$.o.length:0),i+=$.b}O_(d,e,this.u.length,s,i),this.ondata(null,d,!0),this.d=2},c.prototype.terminate=function(){for(var e=0,i=this.u;e<i.length;e++)i[e].t();this.d=2},c}();function Xy(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";var s={};wi(c,"",s,e);var a=Object.keys(s),h=a.length,d=0,b=0,X=h,$=new Array(h),Z=[],re=function(){for(var me=0;me<Z.length;++me)Z[me]()},le=function(){var me=new mr(b+22),Ee=d,Ae=b-d;b=0;for(var ye=0;ye<X;++ye){var ge=$[ye];try{var Pe=ge.c.length;Lo(me,b,ge,ge.f,ge.u,Pe);var Be=30+ge.f.length+Fu(ge.extra),Oe=b+Be;me.set(ge.c,Oe),Lo(me,d,ge,ge.f,ge.u,Pe,b,ge.m),d+=16+Be+(ge.m?ge.m.length:0),b=Oe+Pe}catch(Fe){return i(Fe,null)}}O_(me,d,$.length,Ae,Ee),i(null,me)};h||le();for(var he=function(me){var Ee=a[me],Ae=s[Ee],ye=Ae[0],ge=Ae[1],Pe=cf(),Be=ye.length;Pe.p(ye);var Oe=zi(Ee),Fe=Oe.length,Xe=ge.comment,at=Xe&&zi(Xe),mt=at&&at.length,wt=Fu(ge.extra),At=ge.level==0?0:8,Tt=function(yt,St){if(yt)re(),i(yt,null);else{var Ft=St.length;$[me]=o(ge,{size:Be,crc:Pe.d(),c:St,f:Oe,m:at,u:Fe!=Ee.length||at&&Xe.length!=mt,compression:At}),d+=30+Fe+wt+Ft,b+=76+2*(Fe+wt)+(mt||0)+Ft,--h||le()}};if(Fe>65535&&Tt("filename too long",null),At)if(Be<16e4)try{Tt(null,wn(ye,ge))}catch(yt){Tt(yt,null)}else Z.push(Ln(ye,ge,Tt));else Tt(null,ye)},fe=0;fe<X;++fe)he(fe);return re}function Ky(c,e){e||(e={});var i={},s=[];wi(c,"",i,e);var a=0,h=0;for(var d in i){var b=i[d],X=b[0],$=b[1],Z=$.level==0?0:8,re=(Fe=zi(d)).length,le=$.comment,he=le&&zi(le),fe=he&&he.length,me=Fu($.extra);if(re>65535)throw"filename too long";var Ee=Z?wn(X,$):X,Ae=Ee.length,ye=cf();ye.p(X),s.push(o($,{size:X.length,crc:ye.d(),c:Ee,f:Fe,m:he,u:re!=d.length||he&&le.length!=fe,o:a,compression:Z})),a+=30+re+me+Ae,h+=76+2*(re+me)+(fe||0)+Ae}for(var ge=new mr(h+22),Pe=a,Be=h-a,Oe=0;Oe<s.length;++Oe){var Fe=s[Oe];Lo(ge,Fe.o,Fe,Fe.f,Fe.u,Fe.c.length);var Xe=30+Fe.f.length+Fu(Fe.extra);ge.set(Fe.c,Fe.o+Xe),Lo(ge,a,Fe,Fe.f,Fe.u,Fe.c.length,Fe.o,Fe.m),a+=16+Xe+(Fe.m?Fe.m.length:0)}return O_(ge,a,s.length,Be,Pe),ge}var Th=function(){function c(){}return c.prototype.push=function(e,i){this.ondata(null,e,i)},c.compression=0,c}(),Jy=function(){function c(){var e=this;this.i=new jn(function(i,s){e.ondata(null,i,s)})}return c.prototype.push=function(e,i){try{this.i.push(e,i)}catch(s){this.ondata(s,e,i)}},c.compression=8,c}(),$y=function(){function c(e,i){var s=this;i<32e4?this.i=new jn(function(a,h){s.ondata(null,a,h)}):(this.i=new Wn(function(a,h,d){s.ondata(a,h,d)}),this.terminate=this.i.terminate)}return c.prototype.push=function(e,i){this.i.terminate&&(e=Rl(e,0)),this.i.push(e,i)},c.compression=8,c}(),L_=function(){function c(e){this.onfile=e,this.k=[],this.o={0:Th},this.p=Uu}return c.prototype.push=function(e,i){var s=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var a=Math.min(this.c,e.length),h=e.subarray(0,a);if(this.c-=a,this.d?this.d.push(h,!this.c):this.k[0].push(h),(e=e.subarray(a)).length)return this.push(e,i)}else{var d=0,b=0,X=void 0,$=void 0;this.p.length?e.length?(($=new mr(this.p.length+e.length)).set(this.p),$.set(e,this.p.length)):$=this.p:$=e;for(var Z=$.length,re=this.c,le=re&&this.d,he=function(){var Ee,Ae=je($,b);if(Ae==67324752){d=1,X=b,fe.d=null,fe.c=0;var ye=ze($,b+6),ge=ze($,b+8),Pe=2048&ye,Be=8&ye,Oe=ze($,b+26),Fe=ze($,b+28);if(Z>b+30+Oe+Fe){var Xe=[];fe.k.unshift(Xe),d=2;var at,mt=je($,b+18),wt=je($,b+22),At=qr($.subarray(b+30,b+=30+Oe),!Pe);mt==4294967295?(Ee=Be?[-2]:L0($,b),mt=Ee[0],wt=Ee[1]):Be&&(mt=-1),b+=Fe,fe.c=mt;var Tt={name:At,compression:ge,start:function(){if(!Tt.ondata)throw"no callback";if(mt){var yt=s.o[ge];if(!yt)throw"unknown compression type "+ge;(at=mt<0?new yt(At):new yt(At,mt,wt)).ondata=function(Gt,rn,gn){Tt.ondata(Gt,rn,gn)};for(var St=0,Ft=Xe;St<Ft.length;St++){var Mt=Ft[St];at.push(Mt,!1)}s.k[0]==Xe&&s.c?s.d=at:at.push(Uu,!0)}else Tt.ondata(null,Uu,!0)},terminate:function(){at&&at.terminate&&at.terminate()}};mt>=0&&(Tt.size=mt,Tt.originalSize=wt),fe.onfile(Tt)}return"break"}if(re){if(Ae==134695760)return X=b+=12+(re==-2&&8),d=3,fe.c=0,"break";if(Ae==33639248)return X=b-=4,d=3,fe.c=0,"break"}},fe=this;b<Z-4&&he()!=="break";++b);if(this.p=Uu,re<0){var me=d?$.subarray(0,X-12-(re==-2&&8)-(je($,X-16)==134695760&&4)):$.subarray(0,b);le?le.push(me,!!d):this.k[+(d==2)].push(me)}if(2&d)return this.push($.subarray(b),i);this.p=$.subarray(b)}if(i){if(this.c)throw"invalid zip file";this.p=null}},c.prototype.register=function(e){this.o[e.compression]=e},c}();function yx(c,e){if(typeof e!="function")throw"no callback";for(var i=[],s=function(){for(var le=0;le<i.length;++le)i[le]()},a={},h=c.length-22;je(c,h)!=101010256;--h)if(!h||c.length-h>65558)return void e("invalid zip file",null);var d=ze(c,h+8);d||e(null,{});var b=d,X=je(c,h+16),$=X==4294967295;if($){if(h=je(c,h-12),je(c,h)!=101075792)return void e("invalid zip file",null);b=d=je(c,h+32),X=je(c,h+48)}for(var Z=function(le){var he=ri(c,X,$),fe=he[0],me=he[1],Ee=he[2],Ae=he[3],ye=he[4],ge=he[5],Pe=Nm(c,ge);X=ye;var Be=function(Fe,Xe){Fe?(s(),e(Fe,null)):(a[Ae]=Xe,--d||e(null,a))};if(fe)if(fe==8){var Oe=c.subarray(Pe,Pe+me);if(me<32e4)try{Be(null,fn(Oe,new mr(Ee)))}catch(Fe){Be(Fe,null)}else i.push(hn(Oe,{size:Ee},Be))}else Be("unknown compression type "+fe,null);else Be(null,Rl(c,Pe,Pe+me))},re=0;re<b;++re)Z();return s}function N_(c){for(var e={},i=c.length-22;je(c,i)!=101010256;--i)if(!i||c.length-i>65558)throw"invalid zip file";var s=ze(c,i+8);if(!s)return{};var a=je(c,i+16),h=a==4294967295;if(h){if(i=je(c,i-12),je(c,i)!=101075792)throw"invalid zip file";s=je(c,i+32),a=je(c,i+48)}for(var d=0;d<s;++d){var b=ri(c,a,h),X=b[0],$=b[1],Z=b[2],re=b[3],le=b[4],he=b[5],fe=Nm(c,he);if(a=le,X){if(X!=8)throw"unknown compression type "+X;e[re]=fn(c.subarray(fe,fe+$),new mr(Z))}else e[re]=Rl(c,fe,fe+$)}return e}class Zy extends _.yxD{constructor(e){super(e),this.type=_.cLu}parse(e){const h=Math.pow(2.7182818,2.2),d={l:0,c:0,lc:0};function b(ut,Nt,pt,zt,Yt){for(;pt<ut;)Nt=Nt<<8|In(zt,Yt),pt+=8;pt-=ut,d.l=Nt>>pt&(1<<ut)-1,d.c=Nt,d.lc=pt}const X=new Array(59);function $(ut){return 63&ut}function Z(ut){return ut>>6}const re={c:0,lc:0};function le(ut,Nt,pt,zt){ut=ut<<8|In(pt,zt),Nt+=8,re.c=ut,re.lc=Nt}const he={c:0,lc:0};function fe(ut,Nt,pt,zt,Yt,jt,sn,Qn,ni){if(ut==Nt){zt<8&&(le(pt,zt,Yt,jt),pt=re.c,zt=re.lc);let ui=pt>>(zt-=8);if(ui=new Uint8Array([ui])[0],Qn.value+ui>ni)return!1;const li=sn[Qn.value-1];for(;ui-- >0;)sn[Qn.value++]=li}else{if(!(Qn.value<ni))return!1;sn[Qn.value++]=ut}he.c=pt,he.lc=zt}function me(ut){return 65535&ut}function Ee(ut){const Nt=me(ut);return Nt>32767?Nt-65536:Nt}const Ae={a:0,b:0};function ye(ut,Nt){const pt=Ee(ut),zt=Ee(Nt),Yt=pt+(1&zt)+(zt>>1),jt=Yt,sn=Yt-zt;Ae.a=jt,Ae.b=sn}function ge(ut,Nt){const pt=me(ut),zt=me(Nt),Yt=pt-(zt>>1)&65535,jt=zt+Yt-32768&65535;Ae.a=jt,Ae.b=Yt}function Pe(ut,Nt,pt,zt,Yt,jt,sn){const Qn=sn<16384,ni=pt>Yt?Yt:pt;let ui,li,fi=1;for(;fi<=ni;)fi<<=1;for(fi>>=1,ui=fi,fi>>=1;fi>=1;){li=0;const si=li+jt*(Yt-ui),ii=jt*fi,bi=jt*ui,Yn=zt*fi,xi=zt*ui;let Pi,qi,Rs,fs;for(;li<=si;li+=bi){let Ei=li;const er=li+zt*(pt-ui);for(;Ei<=er;Ei+=xi){const xr=Ei+Yn,Zo=Ei+ii,Fl=Zo+Yn;Qn?(ye(ut[Ei+Nt],ut[Zo+Nt]),Pi=Ae.a,Rs=Ae.b,ye(ut[xr+Nt],ut[Fl+Nt]),qi=Ae.a,fs=Ae.b,ye(Pi,qi),ut[Ei+Nt]=Ae.a,ut[xr+Nt]=Ae.b,ye(Rs,fs),ut[Zo+Nt]=Ae.a,ut[Fl+Nt]=Ae.b):(ge(ut[Ei+Nt],ut[Zo+Nt]),Pi=Ae.a,Rs=Ae.b,ge(ut[xr+Nt],ut[Fl+Nt]),qi=Ae.a,fs=Ae.b,ge(Pi,qi),ut[Ei+Nt]=Ae.a,ut[xr+Nt]=Ae.b,ge(Rs,fs),ut[Zo+Nt]=Ae.a,ut[Fl+Nt]=Ae.b)}if(pt&fi){const xr=Ei+ii;Qn?ye(ut[Ei+Nt],ut[xr+Nt]):ge(ut[Ei+Nt],ut[xr+Nt]),Pi=Ae.a,ut[xr+Nt]=Ae.b,ut[Ei+Nt]=Pi}}if(Yt&fi){let Ei=li;const er=li+zt*(pt-ui);for(;Ei<=er;Ei+=xi){const xr=Ei+Yn;Qn?ye(ut[Ei+Nt],ut[xr+Nt]):ge(ut[Ei+Nt],ut[xr+Nt]),Pi=Ae.a,ut[xr+Nt]=Ae.b,ut[Ei+Nt]=Pi}}ui=fi,fi>>=1}return li}function Be(ut,Nt,pt,zt,Yt,jt){const sn=pt.value,Qn=Kt(Nt,pt),ni=Kt(Nt,pt);pt.value+=4;const ui=Kt(Nt,pt);if(pt.value+=4,Qn<0||Qn>=65537||ni<0||ni>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const li=new Array(65537),fi=new Array(16384);if(function(si){for(let ii=0;ii<16384;ii++)si[ii]={},si[ii].len=0,si[ii].lit=0,si[ii].p=null}(fi),function(si,ii,bi,Yn,xi,Pi){const qi=ii;let Rs=0,fs=0;for(;Yn<=xi;Yn++){if(qi.value-ii.value>bi)return!1;b(6,Rs,fs,si,qi);const Ei=d.l;if(Rs=d.c,fs=d.lc,Pi[Yn]=Ei,Ei==63){if(qi.value-ii.value>bi)throw new Error("Something wrong with hufUnpackEncTable");b(8,Rs,fs,si,qi);let er=d.l+6;if(Rs=d.c,fs=d.lc,Yn+er>xi+1)throw new Error("Something wrong with hufUnpackEncTable");for(;er--;)Pi[Yn++]=0;Yn--}else if(Ei>=59){let er=Ei-59+2;if(Yn+er>xi+1)throw new Error("Something wrong with hufUnpackEncTable");for(;er--;)Pi[Yn++]=0;Yn--}}(function(Ei){for(let xr=0;xr<=58;++xr)X[xr]=0;for(let xr=0;xr<65537;++xr)X[Ei[xr]]+=1;let er=0;for(let xr=58;xr>0;--xr){const Zo=er+X[xr]>>1;X[xr]=er,er=Zo}for(let xr=0;xr<65537;++xr){const Zo=Ei[xr];Zo>0&&(Ei[xr]=Zo|X[Zo]++<<6)}})(Pi)}(ut,pt,zt-(pt.value-sn),Qn,ni,li),ui>8*(zt-(pt.value-sn)))throw new Error("Something wrong with hufUncompress");(function(si,ii,bi,Yn){for(;ii<=bi;ii++){const xi=Z(si[ii]),Pi=$(si[ii]);if(xi>>Pi)throw new Error("Invalid table entry");if(Pi>14){const qi=Yn[xi>>Pi-14];if(qi.len)throw new Error("Invalid table entry");if(qi.lit++,qi.p){const Rs=qi.p;qi.p=new Array(qi.lit);for(let fs=0;fs<qi.lit-1;++fs)qi.p[fs]=Rs[fs]}else qi.p=new Array(1);qi.p[qi.lit-1]=ii}else if(Pi){let qi=0;for(let Rs=1<<14-Pi;Rs>0;Rs--){const fs=Yn[(xi<<14-Pi)+qi];if(fs.len||fs.p)throw new Error("Invalid table entry");fs.len=Pi,fs.lit=ii,qi++}}}})(li,Qn,ni,fi),function(si,ii,bi,Yn,xi,Pi,qi,Rs,fs){let Ei=0,er=0;const xr=qi,Zo=Math.trunc(Yn.value+(xi+7)/8);for(;Yn.value<Zo;)for(le(Ei,er,bi,Yn),Ei=re.c,er=re.lc;er>=14;){const da=ii[Ei>>er-14&16383];if(da.len)er-=da.len,fe(da.lit,Pi,Ei,er,bi,Yn,Rs,fs,xr),Ei=he.c,er=he.lc;else{if(!da.p)throw new Error("hufDecode issues");let dp;for(dp=0;dp<da.lit;dp++){const hg=$(si[da.p[dp]]);for(;er<hg&&Yn.value<Zo;)le(Ei,er,bi,Yn),Ei=re.c,er=re.lc;if(er>=hg&&Z(si[da.p[dp]])==(Ei>>er-hg&(1<<hg)-1)){er-=hg,fe(da.p[dp],Pi,Ei,er,bi,Yn,Rs,fs,xr),Ei=he.c,er=he.lc;break}}if(dp==da.lit)throw new Error("hufDecode issues")}}const Fl=8-xi&7;for(Ei>>=Fl,er-=Fl;er>0;){const da=ii[Ei<<14-er&16383];if(!da.len)throw new Error("hufDecode issues");er-=da.len,fe(da.lit,Pi,Ei,er,bi,Yn,Rs,fs,xr),Ei=he.c,er=he.lc}}(li,fi,ut,pt,ui,ni,jt,Yt,{value:0})}function Oe(ut){for(let Nt=1;Nt<ut.length;Nt++){const pt=ut[Nt-1]+ut[Nt]-128;ut[Nt]=pt}}function Fe(ut,Nt){let pt=0,zt=Math.floor((ut.length+1)/2),Yt=0;const jt=ut.length-1;for(;!(Yt>jt||(Nt[Yt++]=ut[pt++],Yt>jt));)Nt[Yt++]=ut[zt++]}function Xe(ut){let Nt=ut.byteLength;const pt=new Array;let zt=0;const Yt=new DataView(ut);for(;Nt>0;){const jt=Yt.getInt8(zt++);if(jt<0){const sn=-jt;Nt-=sn+1;for(let Qn=0;Qn<sn;Qn++)pt.push(Yt.getUint8(zt++))}else{const sn=jt;Nt-=2;const Qn=Yt.getUint8(zt++);for(let ni=0;ni<sn+1;ni++)pt.push(Qn)}}return pt}function at(ut,Nt,pt){let zt,Yt=1;for(;Yt<64;)zt=Nt[ut.value],zt==65280?Yt=64:zt>>8==255?Yt+=255&zt:(pt[Yt]=zt,Yt++),ut.value++}function mt(ut){const Nt=.5*Math.cos(.7853975),pt=.5*Math.cos(3.14159/16),zt=.5*Math.cos(3.14159/8),Yt=.5*Math.cos(3*3.14159/16),jt=.5*Math.cos(.981746875),sn=.5*Math.cos(3*3.14159/8),Qn=.5*Math.cos(1.374445625),ni=new Array(4),ui=new Array(4),li=new Array(4),fi=new Array(4);for(let si=0;si<8;++si){const ii=8*si;ni[0]=zt*ut[ii+2],ni[1]=sn*ut[ii+2],ni[2]=zt*ut[ii+6],ni[3]=sn*ut[ii+6],ui[0]=pt*ut[ii+1]+Yt*ut[ii+3]+jt*ut[ii+5]+Qn*ut[ii+7],ui[1]=Yt*ut[ii+1]-Qn*ut[ii+3]-pt*ut[ii+5]-jt*ut[ii+7],ui[2]=jt*ut[ii+1]-pt*ut[ii+3]+Qn*ut[ii+5]+Yt*ut[ii+7],ui[3]=Qn*ut[ii+1]-jt*ut[ii+3]+Yt*ut[ii+5]-pt*ut[ii+7],li[0]=Nt*(ut[ii+0]+ut[ii+4]),li[3]=Nt*(ut[ii+0]-ut[ii+4]),li[1]=ni[0]+ni[3],li[2]=ni[1]-ni[2],fi[0]=li[0]+li[1],fi[1]=li[3]+li[2],fi[2]=li[3]-li[2],fi[3]=li[0]-li[1],ut[ii+0]=fi[0]+ui[0],ut[ii+1]=fi[1]+ui[1],ut[ii+2]=fi[2]+ui[2],ut[ii+3]=fi[3]+ui[3],ut[ii+4]=fi[3]-ui[3],ut[ii+5]=fi[2]-ui[2],ut[ii+6]=fi[1]-ui[1],ut[ii+7]=fi[0]-ui[0]}for(let si=0;si<8;++si)ni[0]=zt*ut[16+si],ni[1]=sn*ut[16+si],ni[2]=zt*ut[48+si],ni[3]=sn*ut[48+si],ui[0]=pt*ut[8+si]+Yt*ut[24+si]+jt*ut[40+si]+Qn*ut[56+si],ui[1]=Yt*ut[8+si]-Qn*ut[24+si]-pt*ut[40+si]-jt*ut[56+si],ui[2]=jt*ut[8+si]-pt*ut[24+si]+Qn*ut[40+si]+Yt*ut[56+si],ui[3]=Qn*ut[8+si]-jt*ut[24+si]+Yt*ut[40+si]-pt*ut[56+si],li[0]=Nt*(ut[si]+ut[32+si]),li[3]=Nt*(ut[si]-ut[32+si]),li[1]=ni[0]+ni[3],li[2]=ni[1]-ni[2],fi[0]=li[0]+li[1],fi[1]=li[3]+li[2],fi[2]=li[3]-li[2],fi[3]=li[0]-li[1],ut[0+si]=fi[0]+ui[0],ut[8+si]=fi[1]+ui[1],ut[16+si]=fi[2]+ui[2],ut[24+si]=fi[3]+ui[3],ut[32+si]=fi[3]-ui[3],ut[40+si]=fi[2]-ui[2],ut[48+si]=fi[1]-ui[1],ut[56+si]=fi[0]-ui[0]}function wt(ut){for(let Nt=0;Nt<64;++Nt){const pt=ut[0][Nt],zt=ut[1][Nt],Yt=ut[2][Nt];ut[0][Nt]=pt+1.5747*Yt,ut[1][Nt]=pt-.1873*zt-.4682*Yt,ut[2][Nt]=pt+1.8556*zt}}function At(ut,Nt,pt){for(let Yt=0;Yt<64;++Yt)Nt[pt+Yt]=_.A5E.toHalfFloat((zt=ut[Yt])<=1?Math.sign(zt)*Math.pow(Math.abs(zt),2.2):Math.sign(zt)*Math.pow(h,Math.abs(zt)-1));var zt}function Tt(ut){return new DataView(ut.array.buffer,ut.offset.value,ut.size)}function yt(ut){const Nt=ut.viewer.buffer.slice(ut.offset.value,ut.offset.value+ut.size),pt=new Uint8Array(Xe(Nt)),zt=new Uint8Array(pt.length);return Oe(pt),Fe(pt,zt),new DataView(zt.buffer)}function St(ut){const Nt=ut.array.slice(ut.offset.value,ut.offset.value+ut.size);te===void 0&&console.error("THREE.EXRLoader: External library fflate.min.js required.");const pt=on(Nt),zt=new Uint8Array(pt.length);return Oe(pt),Fe(pt,zt),new DataView(zt.buffer)}function Ft(ut){const Nt=ut.viewer,pt={value:ut.offset.value},zt=new Uint16Array(ut.width*ut.scanlineBlockSize*(ut.channels*ut.type)),Yt=new Uint8Array(8192);let jt=0;const sn=new Array(ut.channels);for(let bi=0;bi<ut.channels;bi++)sn[bi]={},sn[bi].start=jt,sn[bi].end=sn[bi].start,sn[bi].nx=ut.width,sn[bi].ny=ut.lines,sn[bi].size=ut.type,jt+=sn[bi].nx*sn[bi].ny*sn[bi].size;const Qn=Ji(Nt,pt),ni=Ji(Nt,pt);if(ni>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(Qn<=ni)for(let bi=0;bi<ni-Qn+1;bi++)Yt[bi+Qn]=kn(Nt,pt);const ui=new Uint16Array(65536),li=function(bi,Yn){let xi=0;for(let qi=0;qi<65536;++qi)(qi==0||bi[qi>>3]&1<<(7&qi))&&(Yn[xi++]=qi);const Pi=xi-1;for(;xi<65536;)Yn[xi++]=0;return Pi}(Yt,ui),fi=Kt(Nt,pt);Be(ut.array,Nt,pt,fi,zt,jt);for(let bi=0;bi<ut.channels;++bi){const Yn=sn[bi];for(let xi=0;xi<sn[bi].size;++xi)Pe(zt,Yn.start+xi,Yn.nx,Yn.size,Yn.ny,Yn.nx*Yn.size,li)}(function(bi,Yn,xi){for(let Pi=0;Pi<xi;++Pi)Yn[Pi]=bi[Yn[Pi]]})(ui,zt,jt);let si=0;const ii=new Uint8Array(zt.buffer.byteLength);for(let bi=0;bi<ut.lines;bi++)for(let Yn=0;Yn<ut.channels;Yn++){const xi=sn[Yn],Pi=xi.nx*xi.size,qi=new Uint8Array(zt.buffer,2*xi.end,2*Pi);ii.set(qi,si),si+=2*Pi,xi.end+=Pi}return new DataView(ii.buffer)}function Mt(ut){const Nt=ut.array.slice(ut.offset.value,ut.offset.value+ut.size);te===void 0&&console.error("THREE.EXRLoader: External library fflate.min.js required.");const pt=on(Nt),zt=ut.lines*ut.channels*ut.width,Yt=ut.type==1?new Uint16Array(zt):new Uint32Array(zt);let jt=0,sn=0;const Qn=new Array(4);for(let ni=0;ni<ut.lines;ni++)for(let ui=0;ui<ut.channels;ui++){let li=0;switch(ut.type){case 1:Qn[0]=jt,Qn[1]=Qn[0]+ut.width,jt=Qn[1]+ut.width;for(let fi=0;fi<ut.width;++fi)li+=pt[Qn[0]++]<<8|pt[Qn[1]++],Yt[sn]=li,sn++;break;case 2:Qn[0]=jt,Qn[1]=Qn[0]+ut.width,Qn[2]=Qn[1]+ut.width,jt=Qn[2]+ut.width;for(let fi=0;fi<ut.width;++fi)li+=pt[Qn[0]++]<<24|pt[Qn[1]++]<<16|pt[Qn[2]++]<<8,Yt[sn]=li,sn++}}return new DataView(Yt.buffer)}function Gt(ut){const Nt=ut.viewer,pt={value:ut.offset.value},zt=new Uint8Array(ut.width*ut.lines*(ut.channels*ut.type*2)),Yt={version:On(Nt,pt),unknownUncompressedSize:On(Nt,pt),unknownCompressedSize:On(Nt,pt),acCompressedSize:On(Nt,pt),dcCompressedSize:On(Nt,pt),rleCompressedSize:On(Nt,pt),rleUncompressedSize:On(Nt,pt),rleRawSize:On(Nt,pt),totalAcUncompressedCount:On(Nt,pt),totalDcUncompressedCount:On(Nt,pt),acCompression:On(Nt,pt)};if(Yt.version<2)throw new Error("EXRLoader.parse: "+Un.compression+" version "+Yt.version+" is unsupported");const jt=new Array;let sn=Ji(Nt,pt)-2;for(;sn>0;){const Yn=rn(Nt.buffer,pt),xi=kn(Nt,pt),Pi=xi>>2&3,qi=new Int8Array([(xi>>4)-1])[0],Rs=kn(Nt,pt);jt.push({name:Yn,index:qi,type:Rs,compression:Pi}),sn-=Yn.length+3}const Qn=Un.channels,ni=new Array(ut.channels);for(let Yn=0;Yn<ut.channels;++Yn){const xi=ni[Yn]={},Pi=Qn[Yn];xi.name=Pi.name,xi.compression=0,xi.decoded=!1,xi.type=Pi.pixelType,xi.pLinear=Pi.pLinear,xi.width=ut.width,xi.height=ut.lines}const ui={idx:new Array(3)};for(let Yn=0;Yn<ut.channels;++Yn){const xi=ni[Yn];for(let Pi=0;Pi<jt.length;++Pi){const qi=jt[Pi];xi.name==qi.name&&(xi.compression=qi.compression,qi.index>=0&&(ui.idx[qi.index]=Yn),xi.offset=Yn)}}let li,fi,si;if(Yt.acCompressedSize>0)switch(Yt.acCompression){case 0:li=new Uint16Array(Yt.totalAcUncompressedCount),Be(ut.array,Nt,pt,Yt.acCompressedSize,li,Yt.totalAcUncompressedCount);break;case 1:const Yn=on(ut.array.slice(pt.value,pt.value+Yt.totalAcUncompressedCount));li=new Uint16Array(Yn.buffer),pt.value+=Yt.totalAcUncompressedCount}if(Yt.dcCompressedSize>0){const Yn={array:ut.array,offset:pt,size:Yt.dcCompressedSize};fi=new Uint16Array(St(Yn).buffer),pt.value+=Yt.dcCompressedSize}Yt.rleRawSize>0&&(si=Xe(on(ut.array.slice(pt.value,pt.value+Yt.rleCompressedSize)).buffer),pt.value+=Yt.rleCompressedSize);let ii=0;const bi=new Array(ni.length);for(let Yn=0;Yn<bi.length;++Yn)bi[Yn]=new Array;for(let Yn=0;Yn<ut.lines;++Yn)for(let xi=0;xi<ni.length;++xi)bi[xi].push(ii),ii+=ni[xi].width*ut.type*2;(function(Yn,xi,Pi,qi,Rs,fs){let Ei=new DataView(fs.buffer);const er=Pi[Yn.idx[0]].width,xr=Pi[Yn.idx[0]].height,Zo=Math.floor(er/8),Fl=Math.ceil(er/8),da=Math.ceil(xr/8),dp=er-8*(Fl-1),hg=xr-8*(da-1),Z2={value:0},AE=new Array(3),wA=new Array(3),xA=new Array(3),Ku=new Array(3),Hw=new Array(3);for(let Qs=0;Qs<3;++Qs)Hw[Qs]=xi[Yn.idx[Qs]],AE[Qs]=Qs<1?0:AE[Qs-1]+Fl*da,wA[Qs]=new Float32Array(64),xA[Qs]=new Uint16Array(64),Ku[Qs]=new Uint16Array(64*Fl);for(let Qs=0;Qs<da;++Qs){let bv=8;Qs==da-1&&(bv=hg);let wv=8;for(let Es=0;Es<Fl;++Es){Es==Fl-1&&(wv=dp);for(let Us=0;Us<3;++Us)xA[Us].fill(0),xA[Us][0]=Rs[AE[Us]++],at(Z2,qi,xA[Us]),gi=xA[Us],(Ai=wA[Us])[0]=yn(gi[0]),Ai[1]=yn(gi[1]),Ai[2]=yn(gi[5]),Ai[3]=yn(gi[6]),Ai[4]=yn(gi[14]),Ai[5]=yn(gi[15]),Ai[6]=yn(gi[27]),Ai[7]=yn(gi[28]),Ai[8]=yn(gi[2]),Ai[9]=yn(gi[4]),Ai[10]=yn(gi[7]),Ai[11]=yn(gi[13]),Ai[12]=yn(gi[16]),Ai[13]=yn(gi[26]),Ai[14]=yn(gi[29]),Ai[15]=yn(gi[42]),Ai[16]=yn(gi[3]),Ai[17]=yn(gi[8]),Ai[18]=yn(gi[12]),Ai[19]=yn(gi[17]),Ai[20]=yn(gi[25]),Ai[21]=yn(gi[30]),Ai[22]=yn(gi[41]),Ai[23]=yn(gi[43]),Ai[24]=yn(gi[9]),Ai[25]=yn(gi[11]),Ai[26]=yn(gi[18]),Ai[27]=yn(gi[24]),Ai[28]=yn(gi[31]),Ai[29]=yn(gi[40]),Ai[30]=yn(gi[44]),Ai[31]=yn(gi[53]),Ai[32]=yn(gi[10]),Ai[33]=yn(gi[19]),Ai[34]=yn(gi[23]),Ai[35]=yn(gi[32]),Ai[36]=yn(gi[39]),Ai[37]=yn(gi[45]),Ai[38]=yn(gi[52]),Ai[39]=yn(gi[54]),Ai[40]=yn(gi[20]),Ai[41]=yn(gi[22]),Ai[42]=yn(gi[33]),Ai[43]=yn(gi[38]),Ai[44]=yn(gi[46]),Ai[45]=yn(gi[51]),Ai[46]=yn(gi[55]),Ai[47]=yn(gi[60]),Ai[48]=yn(gi[21]),Ai[49]=yn(gi[34]),Ai[50]=yn(gi[37]),Ai[51]=yn(gi[47]),Ai[52]=yn(gi[50]),Ai[53]=yn(gi[56]),Ai[54]=yn(gi[59]),Ai[55]=yn(gi[61]),Ai[56]=yn(gi[35]),Ai[57]=yn(gi[36]),Ai[58]=yn(gi[48]),Ai[59]=yn(gi[49]),Ai[60]=yn(gi[57]),Ai[61]=yn(gi[58]),Ai[62]=yn(gi[62]),Ai[63]=yn(gi[63]),mt(wA[Us]);wt(wA);for(let Us=0;Us<3;++Us)At(wA[Us],Ku[Us],64*Es)}let xc=0;for(let Es=0;Es<3;++Es){const Us=Pi[Yn.idx[Es]].type;for(let pp=8*Qs;pp<8*Qs+bv;++pp){xc=Hw[Es][pp];for(let EA=0;EA<Zo;++EA){const Jh=64*EA+8*(7&pp);Ei.setUint16(xc+0*Us,Ku[Es][Jh+0],!0),Ei.setUint16(xc+2*Us,Ku[Es][Jh+1],!0),Ei.setUint16(xc+4*Us,Ku[Es][Jh+2],!0),Ei.setUint16(xc+6*Us,Ku[Es][Jh+3],!0),Ei.setUint16(xc+8*Us,Ku[Es][Jh+4],!0),Ei.setUint16(xc+10*Us,Ku[Es][Jh+5],!0),Ei.setUint16(xc+12*Us,Ku[Es][Jh+6],!0),Ei.setUint16(xc+14*Us,Ku[Es][Jh+7],!0),xc+=16*Us}}if(Zo!=Fl)for(let pp=8*Qs;pp<8*Qs+bv;++pp){const EA=Hw[Es][pp]+8*Zo*2*Us,Jh=64*Zo+8*(7&pp);for(let Ww=0;Ww<wv;++Ww)Ei.setUint16(EA+2*Ww*Us,Ku[Es][Jh+Ww],!0)}}}var gi,Ai;const iT=new Uint16Array(er);Ei=new DataView(fs.buffer);for(let Qs=0;Qs<3;++Qs){Pi[Yn.idx[Qs]].decoded=!0;const bv=Pi[Yn.idx[Qs]].type;if(Pi[Qs].type==2)for(let wv=0;wv<xr;++wv){const xc=Hw[Qs][wv];for(let Es=0;Es<er;++Es)iT[Es]=Ei.getUint16(xc+2*Es*bv,!0);for(let Es=0;Es<er;++Es)Ei.setFloat32(xc+2*Es*bv,yn(iT[Es]),!0)}}})(ui,bi,ni,li,fi,zt);for(let Yn=0;Yn<ni.length;++Yn){const xi=ni[Yn];if(!xi.decoded){if(xi.compression!==2)throw new Error("EXRLoader.parse: unsupported channel compression");{let Pi=0,qi=0;for(let Rs=0;Rs<ut.lines;++Rs){let fs=bi[Yn][Pi];for(let Ei=0;Ei<xi.width;++Ei){for(let er=0;er<2*xi.type;++er)zt[fs++]=si[qi+er*xi.width*xi.height];qi++}Pi++}}}}return new DataView(zt.buffer)}function rn(ut,Nt){const pt=new Uint8Array(ut);let zt=0;for(;pt[Nt.value+zt]!=0;)zt+=1;const Yt=new TextDecoder().decode(pt.slice(Nt.value,Nt.value+zt));return Nt.value=Nt.value+zt+1,Yt}function gn(ut,Nt){const pt=ut.getInt32(Nt.value,!0);return Nt.value=Nt.value+4,pt}function Kt(ut,Nt){const pt=ut.getUint32(Nt.value,!0);return Nt.value=Nt.value+4,pt}function In(ut,Nt){const pt=ut[Nt.value];return Nt.value=Nt.value+1,pt}function kn(ut,Nt){const pt=ut.getUint8(Nt.value);return Nt.value=Nt.value+1,pt}const On=function(ut,Nt){const pt=Number(ut.getBigInt64(Nt.value,!0));return Nt.value+=8,pt};function zn(ut,Nt){const pt=ut.getFloat32(Nt.value,!0);return Nt.value+=4,pt}function pi(ut,Nt){return _.A5E.toHalfFloat(zn(ut,Nt))}function yn(ut){const Nt=(31744&ut)>>10,pt=1023&ut;return(ut>>15?-1:1)*(Nt?Nt===31?pt?NaN:1/0:Math.pow(2,Nt-15)*(1+pt/1024):pt/1024*6103515625e-14)}function Ji(ut,Nt){const pt=ut.getUint16(Nt.value,!0);return Nt.value+=2,pt}function ar(ut,Nt){return yn(Ji(ut,Nt))}function $i(ut,Nt,pt,zt,Yt){return zt==="string"||zt==="stringvector"||zt==="iccProfile"?function(jt,sn,Qn){const ni=new TextDecoder().decode(new Uint8Array(jt).slice(sn.value,sn.value+Qn));return sn.value=sn.value+Qn,ni}(Nt,pt,Yt):zt==="chlist"?function(jt,sn,Qn,ni){const ui=Qn.value,li=[];for(;Qn.value<ui+ni-1;){const fi=rn(sn,Qn),si=gn(jt,Qn),ii=kn(jt,Qn);Qn.value+=3;const bi=gn(jt,Qn),Yn=gn(jt,Qn);li.push({name:fi,pixelType:si,pLinear:ii,xSampling:bi,ySampling:Yn})}return Qn.value+=1,li}(ut,Nt,pt,Yt):zt==="chromaticities"?function(jt,sn){return{redX:zn(jt,sn),redY:zn(jt,sn),greenX:zn(jt,sn),greenY:zn(jt,sn),blueX:zn(jt,sn),blueY:zn(jt,sn),whiteX:zn(jt,sn),whiteY:zn(jt,sn)}}(ut,pt):zt==="compression"?function(jt,sn){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][kn(jt,sn)]}(ut,pt):zt==="box2i"?function(jt,sn){return{xMin:Kt(jt,sn),yMin:Kt(jt,sn),xMax:Kt(jt,sn),yMax:Kt(jt,sn)}}(ut,pt):zt==="lineOrder"?function(jt,sn){return["INCREASING_Y"][kn(jt,sn)]}(ut,pt):zt==="float"?zn(ut,pt):zt==="v2f"?function(jt,sn){return[zn(jt,sn),zn(jt,sn)]}(ut,pt):zt==="v3f"?function(jt,sn){return[zn(jt,sn),zn(jt,sn),zn(jt,sn)]}(ut,pt):zt==="int"?gn(ut,pt):zt==="rational"?function(jt,sn){return[gn(jt,sn),Kt(jt,sn)]}(ut,pt):zt==="timecode"?function(jt,sn){return[Kt(jt,sn),Kt(jt,sn)]}(ut,pt):zt==="preview"?(pt.value+=Yt,"skipped"):void(pt.value+=Yt)}const Pr=new DataView(e),$r=new Uint8Array(e),an={value:0},Un=function(ut,Nt,pt){const zt={};if(ut.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.");zt.version=ut.getUint8(4);const Yt=ut.getUint8(5);zt.spec={singleTile:!!(2&Yt),longName:!!(4&Yt),deepFormat:!!(8&Yt),multiPart:!!(16&Yt)},pt.value=8;let jt=!0;for(;jt;){const sn=rn(Nt,pt);if(sn==0)jt=!1;else{const Qn=rn(Nt,pt),ni=$i(ut,Nt,pt,Qn,Kt(ut,pt));ni===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${Qn}'.`):zt[sn]=ni}}if(-5&Yt)throw console.error("EXRHeader:",zt),new Error("THREE.EXRLoader: provided file is currently unsupported.");return zt}(Pr,e,an),Fn=function(ut,Nt,pt,zt,Yt){const jt={size:0,viewer:Nt,array:pt,offset:zt,width:ut.dataWindow.xMax-ut.dataWindow.xMin+1,height:ut.dataWindow.yMax-ut.dataWindow.yMin+1,channels:ut.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:ut.channels[0].pixelType,uncompress:null,getter:null,format:null,encoding:null};switch(ut.compression){case"NO_COMPRESSION":jt.lines=1,jt.uncompress=Tt;break;case"RLE_COMPRESSION":jt.lines=1,jt.uncompress=yt;break;case"ZIPS_COMPRESSION":jt.lines=1,jt.uncompress=St;break;case"ZIP_COMPRESSION":jt.lines=16,jt.uncompress=St;break;case"PIZ_COMPRESSION":jt.lines=32,jt.uncompress=Ft;break;case"PXR24_COMPRESSION":jt.lines=16,jt.uncompress=Mt;break;case"DWAA_COMPRESSION":jt.lines=32,jt.uncompress=Gt;break;case"DWAB_COMPRESSION":jt.lines=256,jt.uncompress=Gt;break;default:throw new Error("EXRLoader.parse: "+ut.compression+" is unsupported")}if(jt.scanlineBlockSize=jt.lines,jt.type==1)switch(Yt){case _.VzW:jt.getter=ar,jt.inputSize=2;break;case _.cLu:jt.getter=Ji,jt.inputSize=2}else{if(jt.type!=2)throw new Error("EXRLoader.parse: unsupported pixelType "+jt.type+" for "+ut.compression+".");switch(Yt){case _.VzW:jt.getter=zn,jt.inputSize=4;break;case _.cLu:jt.getter=pi,jt.inputSize=4}}jt.blockCount=(ut.dataWindow.yMax+1)/jt.scanlineBlockSize;for(let Qn=0;Qn<jt.blockCount;Qn++)On(Nt,zt);jt.outputChannels=jt.channels==3?4:jt.channels;const sn=jt.width*jt.height*jt.outputChannels;switch(Yt){case _.VzW:jt.byteArray=new Float32Array(sn),jt.channels<jt.outputChannels&&jt.byteArray.fill(1,0,sn);break;case _.cLu:jt.byteArray=new Uint16Array(sn),jt.channels<jt.outputChannels&&jt.byteArray.fill(15360,0,sn);break;default:console.error("THREE.EXRLoader: unsupported type: ",Yt)}return jt.bytesPerLine=jt.width*jt.inputSize*jt.channels,jt.outputChannels==4?(jt.format=_.wk1,jt.encoding=_.rnI):(jt.format=_.hEm,jt.encoding=_.rnI),jt}(Un,Pr,$r,an,this.type),Zi={value:0},Yr={R:0,G:1,B:2,A:3,Y:0};for(let ut=0;ut<Fn.height/Fn.scanlineBlockSize;ut++){const Nt=Kt(Pr,an);Fn.size=Kt(Pr,an),Fn.lines=Nt+Fn.scanlineBlockSize>Fn.height?Fn.height-Nt:Fn.scanlineBlockSize;const pt=Fn.size<Fn.lines*Fn.bytesPerLine?Fn.uncompress(Fn):Tt(Fn);an.value+=Fn.size;for(let zt=0;zt<Fn.scanlineBlockSize;zt++){const Yt=zt+ut*Fn.scanlineBlockSize;if(Yt>=Fn.height)break;for(let jt=0;jt<Fn.channels;jt++){const sn=Yr[Un.channels[jt].name];for(let Qn=0;Qn<Fn.width;Qn++){Zi.value=(zt*(Fn.channels*Fn.width)+jt*Fn.width+Qn)*Fn.inputSize;const ni=(Fn.height-1-Yt)*(Fn.width*Fn.outputChannels)+Qn*Fn.outputChannels+sn;Fn.byteArray[ni]=Fn.getter(pt,Zi)}}}}return{header:Un,width:Fn.width,height:Fn.height,data:Fn.byteArray,format:Fn.format,encoding:Fn.encoding,type:this.type}}setDataType(e){return this.type=e,this}load(e,i,s,a){return super.load(e,function(h,d){h.encoding=d.encoding,h.minFilter=_.wem,h.magFilter=_.wem,h.generateMipmaps=!1,h.flipY=!1,i&&i(h,d)},s,a)}}class Ct extends oe{constructor(){super(...arguments),this.dependencies=[Kn]}async onAdded(e){this._importer||(this._importer=new _s(class extends Zy{constructor(i){super(i),this.setDataType(Lv(e.renderer.rendererObject))}},["exr"],!1)),yr.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&yr.Importers.splice(yr.Importers.indexOf(this._importer),1),this._importer=void 0}}function An(c,e,i){const s=i.length-c-1;if(e>=i[s])return s-1;if(e<=i[c])return c;let a=c,h=s,d=Math.floor((a+h)/2);for(;e<i[d]||e>=i[d+1];)e<i[d]?h=d:a=d,d=Math.floor((a+h)/2);return d}function Dn(c,e){let i=1;for(let a=2;a<=c;++a)i*=a;let s=1;for(let a=2;a<=e;++a)s*=a;for(let a=2;a<=c-e;++a)s*=a;return i/s}Ct.PluginType="EXRLoadPlugin";class Tn extends _.Hyl{constructor(e,i,s,a,h){super(),this.degree=e,this.knots=i,this.controlPoints=[],this.startKnot=a||0,this.endKnot=h||this.knots.length-1;for(let d=0;d<s.length;++d){const b=s[d];this.controlPoints[d]=new _.Ltg(b.x,b.y,b.z,b.w)}}getPoint(e,i=new _.Pa4){const s=i,a=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),h=function(d,b,X,$){const Z=An(d,$,b),re=function(he,fe,me,Ee){const Ae=[],ye=[],ge=[];Ae[0]=1;for(let Pe=1;Pe<=me;++Pe){ye[Pe]=fe-Ee[he+1-Pe],ge[Pe]=Ee[he+Pe]-fe;let Be=0;for(let Oe=0;Oe<Pe;++Oe){const Fe=ge[Oe+1],Xe=ye[Pe-Oe],at=Ae[Oe]/(Fe+Xe);Ae[Oe]=Be+Fe*at,Be=Xe*at}Ae[Pe]=Be}return Ae}(Z,$,d,b),le=new _.Ltg(0,0,0,0);for(let he=0;he<=d;++he){const fe=X[Z-d+he],me=re[he],Ee=fe.w*me;le.x+=fe.x*Ee,le.y+=fe.y*Ee,le.z+=fe.z*Ee,le.w+=fe.w*me}return le}(this.degree,this.knots,this.controlPoints,a);return h.w!==1&&h.divideScalar(h.w),s.set(h.x,h.y,h.z)}getTangent(e,i=new _.Pa4){const s=i,a=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),h=function(d,b,X,$,Z){const re=function(le,he,fe,me,Ee){const Ae=Ee<le?Ee:le,ye=[],ge=An(le,me,he),Pe=function(Oe,Fe,Xe,at,mt){const wt=[];for(let Mt=0;Mt<=Xe;++Mt)wt[Mt]=0;const At=[];for(let Mt=0;Mt<=at;++Mt)At[Mt]=wt.slice(0);const Tt=[];for(let Mt=0;Mt<=Xe;++Mt)Tt[Mt]=wt.slice(0);Tt[0][0]=1;const yt=wt.slice(0),St=wt.slice(0);for(let Mt=1;Mt<=Xe;++Mt){yt[Mt]=Fe-mt[Oe+1-Mt],St[Mt]=mt[Oe+Mt]-Fe;let Gt=0;for(let rn=0;rn<Mt;++rn){const gn=St[rn+1],Kt=yt[Mt-rn];Tt[Mt][rn]=gn+Kt;const In=Tt[rn][Mt-1]/Tt[Mt][rn];Tt[rn][Mt]=Gt+gn*In,Gt=Kt*In}Tt[Mt][Mt]=Gt}for(let Mt=0;Mt<=Xe;++Mt)At[0][Mt]=Tt[Mt][Xe];for(let Mt=0;Mt<=Xe;++Mt){let Gt=0,rn=1;const gn=[];for(let Kt=0;Kt<=Xe;++Kt)gn[Kt]=wt.slice(0);gn[0][0]=1;for(let Kt=1;Kt<=at;++Kt){let In=0;const kn=Mt-Kt,On=Xe-Kt;Mt>=Kt&&(gn[rn][0]=gn[Gt][0]/Tt[On+1][kn],In=gn[rn][0]*Tt[kn][On]);const zn=Mt-1<=On?Kt-1:Xe-Mt;for(let yn=kn>=-1?1:-kn;yn<=zn;++yn)gn[rn][yn]=(gn[Gt][yn]-gn[Gt][yn-1])/Tt[On+1][kn+yn],In+=gn[rn][yn]*Tt[kn+yn][On];Mt<=On&&(gn[rn][Kt]=-gn[Gt][Kt-1]/Tt[On+1][Mt],In+=gn[rn][Kt]*Tt[Mt][On]),At[Kt][Mt]=In;const pi=Gt;Gt=rn,rn=pi}}let Ft=Xe;for(let Mt=1;Mt<=at;++Mt){for(let Gt=0;Gt<=Xe;++Gt)At[Mt][Gt]*=Ft;Ft*=Xe-Mt}return At}(ge,me,le,Ae,he),Be=[];for(let Oe=0;Oe<fe.length;++Oe){const Fe=fe[Oe].clone(),Xe=Fe.w;Fe.x*=Xe,Fe.y*=Xe,Fe.z*=Xe,Be[Oe]=Fe}for(let Oe=0;Oe<=Ae;++Oe){const Fe=Be[ge-le].clone().multiplyScalar(Pe[Oe][0]);for(let Xe=1;Xe<=le;++Xe)Fe.add(Be[ge-le+Xe].clone().multiplyScalar(Pe[Oe][Xe]));ye[Oe]=Fe}for(let Oe=Ae+1;Oe<=Ee+1;++Oe)ye[Oe]=new _.Ltg(0,0,0);return ye}(d,b,X,$,Z);return function(le){const he=le.length,fe=[],me=[];for(let Ae=0;Ae<he;++Ae){const ye=le[Ae];fe[Ae]=new _.Pa4(ye.x,ye.y,ye.z),me[Ae]=ye.w}const Ee=[];for(let Ae=0;Ae<he;++Ae){const ye=fe[Ae].clone();for(let ge=1;ge<=Ae;++ge)ye.sub(Ee[Ae-ge].clone().multiplyScalar(Dn(Ae,ge)*me[ge]));Ee[Ae]=ye.divideScalar(me[0])}return Ee}(re)}(this.degree,this.knots,this.controlPoints,a,1);return s.copy(h[1]).normalize(),s}}let mn,ei,Qi;class Fi extends _.aNw{constructor(e){super(e)}load(e,i,s,a){const h=this,d=h.path===""?_.Zp0.extractUrlBase(e):h.path,b=new _.hH6(this.manager);b.setPath(h.path),b.setResponseType("arraybuffer"),b.setRequestHeader(h.requestHeader),b.setWithCredentials(h.withCredentials),b.load(e,function(X){try{i(h.parse(X,d))}catch($){a?a($):console.error($),h.manager.itemError(e)}},s,a)}parse(e,i){if(function(a){const h="Kaydara FBX Binary  \0";return a.byteLength>=h.length&&h===Hi(a,0,h.length)}(e))mn=new No().parse(e);else{const a=Hi(e);if(!function(h){const d=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let b=0;function X($){const Z=h[$-1];return h=h.slice(b+$),b++,Z}for(let $=0;$<d.length;++$)if(X(1)===d[$])return!1;return!0}(a))throw new Error("THREE.FBXLoader: Unknown format.");if(U_(a)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+U_(a));mn=new gr().parse(a)}const s=new _.dpR(this.manager).setPath(this.resourcePath||i).setCrossOrigin(this.crossOrigin);return new wr(s,this.manager).parse(mn)}}class wr{constructor(e,i){this.textureLoader=e,this.manager=i}parse(){ei=this.parseConnections();const e=this.parseImages(),i=this.parseTextures(e),s=this.parseMaterials(i),a=this.parseDeformers(),h=new Ns().parse(a);return this.parseScene(a,h,s),Qi}parseConnections(){const e=new Map;return"Connections"in mn&&mn.Connections.connections.forEach(function(i){const s=i[0],a=i[1],h=i[2];e.has(s)||e.set(s,{parents:[],children:[]});const d={ID:a,relationship:h};e.get(s).parents.push(d),e.has(a)||e.set(a,{parents:[],children:[]});const b={ID:s,relationship:h};e.get(a).children.push(b)}),e}parseImages(){const e={},i={};if("Video"in mn.Objects){const s=mn.Objects.Video;for(const a in s){const h=s[a];if(e[parseInt(a)]=h.RelativeFilename||h.Filename,"Content"in h){const d=h.Content instanceof ArrayBuffer&&h.Content.byteLength>0,b=typeof h.Content=="string"&&h.Content!=="";if(d||b){const X=this.parseImage(s[a]);i[h.RelativeFilename||h.Filename]=X}}}}for(const s in e){const a=e[s];i[a]!==void 0?e[s]=i[a]:e[s]=e[s].split("\\").pop()}return e}parseImage(e){const i=e.Content,s=e.RelativeFilename||e.Filename,a=s.slice(s.lastIndexOf(".")+1).toLowerCase();let h;switch(a){case"bmp":h="image/bmp";break;case"jpg":case"jpeg":h="image/jpeg";break;case"png":h="image/png";break;case"tif":h="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",s),h="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+a+'" is not supported.')}if(typeof i=="string")return"data:"+h+";base64,"+i;{const d=new Uint8Array(i);return window.URL.createObjectURL(new Blob([d],{type:h}))}}parseTextures(e){const i=new Map;if("Texture"in mn.Objects){const s=mn.Objects.Texture;for(const a in s){const h=this.parseTexture(s[a],e);i.set(parseInt(a),h)}}return i}parseTexture(e,i){const s=this.loadTexture(e,i);s.ID=e.id,s.name=e.attrName;const a=e.WrapModeU,h=e.WrapModeV,d=a!==void 0?a.value:0,b=h!==void 0?h.value:0;if(s.wrapS=d===0?_.rpg:_.uWy,s.wrapT=b===0?_.rpg:_.uWy,"Scaling"in e){const X=e.Scaling.value;s.repeat.x=X[0],s.repeat.y=X[1]}if("Translation"in e){const X=e.Translation.value;s.offset.x=X[0],s.offset.y=X[1]}return s}loadTexture(e,i){let s;const a=this.textureLoader.path,h=ei.get(e.id).children;let d;h!==void 0&&h.length>0&&i[h[0].ID]!==void 0&&(s=i[h[0].ID],s.indexOf("blob:")!==0&&s.indexOf("data:")!==0||this.textureLoader.setPath(void 0));const b=e.FileName.slice(-3).toLowerCase();if(b==="tga"){const X=this.manager.getHandler(".tga");X===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),d=new _.xEZ):(X.setPath(this.textureLoader.path),d=X.load(s))}else b==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),d=new _.xEZ):d=this.textureLoader.load(s);return this.textureLoader.setPath(a),d}parseMaterials(e){const i=new Map;if("Material"in mn.Objects){const s=mn.Objects.Material;for(const a in s){const h=this.parseMaterial(s[a],e);h!==null&&i.set(parseInt(a),h)}}return i}parseMaterial(e,i){const s=e.id,a=e.attrName;let h=e.ShadingModel;if(typeof h=="object"&&(h=h.value),!ei.has(s))return null;const d=this.parseParameters(e,i,s);let b;switch(h.toLowerCase()){case"phong":b=new _.xoR;break;case"lambert":b=new _.YBo;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',h),b=new _.xoR}return b.setValues(d),b.name=a,b}parseParameters(e,i,s){const a={};e.BumpFactor&&(a.bumpScale=e.BumpFactor.value),e.Diffuse?a.color=new _.Ilk().fromArray(e.Diffuse.value):!e.DiffuseColor||e.DiffuseColor.type!=="Color"&&e.DiffuseColor.type!=="ColorRGB"||(a.color=new _.Ilk().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(a.displacementScale=e.DisplacementFactor.value),e.Emissive?a.emissive=new _.Ilk().fromArray(e.Emissive.value):!e.EmissiveColor||e.EmissiveColor.type!=="Color"&&e.EmissiveColor.type!=="ColorRGB"||(a.emissive=new _.Ilk().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(a.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(a.opacity=parseFloat(e.Opacity.value)),a.opacity<1&&(a.transparent=!0),e.ReflectionFactor&&(a.reflectivity=e.ReflectionFactor.value),e.Shininess&&(a.shininess=e.Shininess.value),e.Specular?a.specular=new _.Ilk().fromArray(e.Specular.value):e.SpecularColor&&e.SpecularColor.type==="Color"&&(a.specular=new _.Ilk().fromArray(e.SpecularColor.value));const h=this;return ei.get(s).children.forEach(function(d){const b=d.relationship;switch(b){case"Bump":a.bumpMap=h.getTexture(i,d.ID);break;case"Maya|TEX_ao_map":a.aoMap=h.getTexture(i,d.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":a.map=h.getTexture(i,d.ID),a.map!==void 0&&(a.map.encoding=_.knz);break;case"DisplacementColor":a.displacementMap=h.getTexture(i,d.ID);break;case"EmissiveColor":a.emissiveMap=h.getTexture(i,d.ID),a.emissiveMap!==void 0&&(a.emissiveMap.encoding=_.knz);break;case"NormalMap":case"Maya|TEX_normal_map":a.normalMap=h.getTexture(i,d.ID);break;case"ReflectionColor":a.envMap=h.getTexture(i,d.ID),a.envMap!==void 0&&(a.envMap.mapping=_.dSO,a.envMap.encoding=_.knz);break;case"SpecularColor":a.specularMap=h.getTexture(i,d.ID),a.specularMap!==void 0&&(a.specularMap.encoding=_.knz);break;case"TransparentColor":case"TransparencyFactor":a.alphaMap=h.getTexture(i,d.ID),a.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",b)}}),a}getTexture(e,i){return"LayeredTexture"in mn.Objects&&i in mn.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),i=ei.get(i).children[0].ID),e.get(i)}parseDeformers(){const e={},i={};if("Deformer"in mn.Objects){const s=mn.Objects.Deformer;for(const a in s){const h=s[a],d=ei.get(parseInt(a));if(h.attrType==="Skin"){const b=this.parseSkeleton(d,s);b.ID=a,d.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),b.geometryID=d.parents[0].ID,e[a]=b}else if(h.attrType==="BlendShape"){const b={id:a};b.rawTargets=this.parseMorphTargets(d,s),b.id=a,d.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),i[a]=b}}}return{skeletons:e,morphTargets:i}}parseSkeleton(e,i){const s=[];return e.children.forEach(function(a){const h=i[a.ID];if(h.attrType!=="Cluster")return;const d={ID:a.ID,indices:[],weights:[],transformLink:new _.yGw().fromArray(h.TransformLink.a)};"Indexes"in h&&(d.indices=h.Indexes.a,d.weights=h.Weights.a),s.push(d)}),{rawBones:s,bones:[]}}parseMorphTargets(e,i){const s=[];for(let a=0;a<e.children.length;a++){const h=e.children[a],d=i[h.ID],b={name:d.attrName,initialWeight:d.DeformPercent,id:d.id,fullWeights:d.FullWeights.a};if(d.attrType!=="BlendShapeChannel")return;b.geoID=ei.get(parseInt(h.ID)).children.filter(function(X){return X.relationship===void 0})[0].ID,s.push(b)}return s}parseScene(e,i,s){Qi=new _.ZAu;const a=this.parseModels(e.skeletons,i,s),h=mn.Objects.Model,d=this;a.forEach(function(X){const $=h[X.ID];d.setLookAtProperties(X,$),ei.get(X.ID).parents.forEach(function(Z){const re=a.get(Z.ID);re!==void 0&&re.add(X)}),X.parent===null&&Qi.add(X)}),this.bindSkeleton(e.skeletons,i,a),this.createAmbientLight(),Qi.traverse(function(X){if(X.userData.transformData){X.parent&&(X.userData.transformData.parentMatrix=X.parent.matrix,X.userData.transformData.parentMatrixWorld=X.parent.matrixWorld);const $=Uo(X.userData.transformData);X.applyMatrix4($),X.updateWorldMatrix()}});const b=new Lr().parse();Qi.children.length===1&&Qi.children[0].isGroup&&(Qi.children[0].animations=b,Qi=Qi.children[0]),Qi.animations=b}parseModels(e,i,s){const a=new Map,h=mn.Objects.Model;for(const d in h){const b=parseInt(d),X=h[d],$=ei.get(b);let Z=this.buildSkeleton($,e,b,X.attrName);if(!Z){switch(X.attrType){case"Camera":Z=this.createCamera($);break;case"Light":Z=this.createLight($);break;case"Mesh":Z=this.createMesh($,i,s);break;case"NurbsCurve":Z=this.createCurve($,i);break;case"LimbNode":case"Root":Z=new _.N$j;break;default:Z=new _.ZAu}Z.name=X.attrName?_.iUV.sanitizeNodeName(X.attrName):"",Z.ID=b}this.getTransformData(Z,X),a.set(b,Z)}return a}buildSkeleton(e,i,s,a){let h=null;return e.parents.forEach(function(d){for(const b in i){const X=i[b];X.rawBones.forEach(function($,Z){if($.ID===d.ID){const re=h;h=new _.N$j,h.matrixWorld.copy($.transformLink),h.name=a?_.iUV.sanitizeNodeName(a):"",h.ID=s,X.bones[Z]=h,re!==null&&h.add(re)}})}}),h}createCamera(e){let i,s;if(e.children.forEach(function(a){const h=mn.Objects.NodeAttribute[a.ID];h!==void 0&&(s=h)}),s===void 0)i=new _.Tme;else{let a=0;s.CameraProjectionType!==void 0&&s.CameraProjectionType.value===1&&(a=1);let h=1;s.NearPlane!==void 0&&(h=s.NearPlane.value/1e3);let d=1e3;s.FarPlane!==void 0&&(d=s.FarPlane.value/1e3);let b=window.innerWidth,X=window.innerHeight;s.AspectWidth!==void 0&&s.AspectHeight!==void 0&&(b=s.AspectWidth.value,X=s.AspectHeight.value);const $=b/X;let Z=45;s.FieldOfView!==void 0&&(Z=s.FieldOfView.value);const re=s.FocalLength?s.FocalLength.value:null;switch(a){case 0:i=new _.cPb(Z,$,h,d),re!==null&&i.setFocalLength(re);break;case 1:i=new _.iKG(-b/2,b/2,X/2,-X/2,h,d);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+a+"."),i=new _.Tme}}return i}createLight(e){let i,s;if(e.children.forEach(function(a){const h=mn.Objects.NodeAttribute[a.ID];h!==void 0&&(s=h)}),s===void 0)i=new _.Tme;else{s.LightType===void 0||s.LightType.value;let a=16777215;s.Color!==void 0&&(a=new _.Ilk().fromArray(s.Color.value));let h=s.Intensity===void 0?1:s.Intensity.value/100;s.CastLightOnObject!==void 0&&s.CastLightOnObject.value===0&&(h=0);let d=0;s.FarAttenuationEnd!==void 0&&(d=s.EnableFarAttenuation!==void 0&&s.EnableFarAttenuation.value===0?0:s.FarAttenuationEnd.value);const b=1;switch(e){case 0:i=new _.cek(a,h,d,b);break;case 1:i=new _.Ox3(a,h);break;case 2:let X=Math.PI/3;s.InnerAngle!==void 0&&(X=_.M8C.degToRad(s.InnerAngle.value));let $=0;s.OuterAngle!==void 0&&($=_.M8C.degToRad(s.OuterAngle.value),$=Math.max($,1)),i=new _.PMe(a,h,d,X,$,b);break;default:console.warn("THREE.FBXLoader: Unknown light type "+s.LightType.value+", defaulting to a PointLight."),i=new _.cek(a,h)}s.CastShadows!==void 0&&s.CastShadows.value===1&&(i.castShadow=!0)}return i}createMesh(e,i,s){let a,h=null,d=null;const b=[];return e.children.forEach(function(X){i.has(X.ID)&&(h=i.get(X.ID)),s.has(X.ID)&&b.push(s.get(X.ID))}),b.length>1?d=b:b.length>0?d=b[0]:(d=new _.xoR({color:13421772}),b.push(d)),"color"in h.attributes&&b.forEach(function(X){X.vertexColors=!0}),h.FBX_Deformer?(a=new _.TUv(h,d),a.normalizeSkinWeights()):a=new _.Kj0(h,d),a}createCurve(e,i){const s=e.children.reduce(function(h,d){return i.has(d.ID)&&(h=i.get(d.ID)),h},null),a=new _.nls({color:3342591,linewidth:1});return new _.x12(s,a)}getTransformData(e,i){const s={};"InheritType"in i&&(s.inheritType=parseInt(i.InheritType.value)),s.eulerOrder="RotationOrder"in i?df(i.RotationOrder.value):"ZYX","Lcl_Translation"in i&&(s.translation=i.Lcl_Translation.value),"PreRotation"in i&&(s.preRotation=i.PreRotation.value),"Lcl_Rotation"in i&&(s.rotation=i.Lcl_Rotation.value),"PostRotation"in i&&(s.postRotation=i.PostRotation.value),"Lcl_Scaling"in i&&(s.scale=i.Lcl_Scaling.value),"ScalingOffset"in i&&(s.scalingOffset=i.ScalingOffset.value),"ScalingPivot"in i&&(s.scalingPivot=i.ScalingPivot.value),"RotationOffset"in i&&(s.rotationOffset=i.RotationOffset.value),"RotationPivot"in i&&(s.rotationPivot=i.RotationPivot.value),e.userData.transformData=s}setLookAtProperties(e,i){"LookAtProperty"in i&&ei.get(e.ID).children.forEach(function(s){if(s.relationship==="LookAtProperty"){const a=mn.Objects.Model[s.ID];if("Lcl_Translation"in a){const h=a.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(h),Qi.add(e.target)):e.lookAt(new _.Pa4().fromArray(h))}}})}bindSkeleton(e,i,s){const a=this.parsePoseNodes();for(const h in e){const d=e[h];ei.get(parseInt(d.ID)).parents.forEach(function(b){if(i.has(b.ID)){const X=b.ID;ei.get(X).parents.forEach(function($){s.has($.ID)&&s.get($.ID).bind(new _.OdW(d.bones),a[$.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in mn.Objects){const i=mn.Objects.Pose;for(const s in i)if(i[s].attrType==="BindPose"&&i[s].NbPoseNodes>0){const a=i[s].PoseNode;Array.isArray(a)?a.forEach(function(h){e[h.Node]=new _.yGw().fromArray(h.Matrix.a)}):e[a.Node]=new _.yGw().fromArray(a.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in mn&&"AmbientColor"in mn.GlobalSettings){const e=mn.GlobalSettings.AmbientColor.value,i=e[0],s=e[1],a=e[2];if(i!==0||s!==0||a!==0){const h=new _.Ilk(i,s,a);Qi.add(new _.Mig(h,1))}}}}class Ns{parse(e){const i=new Map;if("Geometry"in mn.Objects){const s=mn.Objects.Geometry;for(const a in s){const h=ei.get(parseInt(a)),d=this.parseGeometry(h,s[a],e);i.set(parseInt(a),d)}}return i}parseGeometry(e,i,s){switch(i.attrType){case"Mesh":return this.parseMeshGeometry(e,i,s);case"NurbsCurve":return this.parseNurbsGeometry(i)}}parseMeshGeometry(e,i,s){const a=s.skeletons,h=[],d=e.parents.map(function(re){return mn.Objects.Model[re.ID]});if(d.length===0)return;const b=e.children.reduce(function(re,le){return a[le.ID]!==void 0&&(re=a[le.ID]),re},null);e.children.forEach(function(re){s.morphTargets[re.ID]!==void 0&&h.push(s.morphTargets[re.ID])});const X=d[0],$={};"RotationOrder"in X&&($.eulerOrder=df(X.RotationOrder.value)),"InheritType"in X&&($.inheritType=parseInt(X.InheritType.value)),"GeometricTranslation"in X&&($.translation=X.GeometricTranslation.value),"GeometricRotation"in X&&($.rotation=X.GeometricRotation.value),"GeometricScaling"in X&&($.scale=X.GeometricScaling.value);const Z=Uo($);return this.genGeometry(i,b,h,Z)}genGeometry(e,i,s,a){const h=new _.u9r;e.attrName&&(h.name=e.attrName);const d=this.parseGeoNode(e,i),b=this.genBuffers(d),X=new _.a$l(b.vertex,3);if(X.applyMatrix4(a),h.setAttribute("position",X),b.colors.length>0&&h.setAttribute("color",new _.a$l(b.colors,3)),i&&(h.setAttribute("skinIndex",new _.qlB(b.weightsIndices,4)),h.setAttribute("skinWeight",new _.a$l(b.vertexWeights,4)),h.FBX_Deformer=i),b.normal.length>0){const $=new _.Vkp().getNormalMatrix(a),Z=new _.a$l(b.normal,3);Z.applyNormalMatrix($),h.setAttribute("normal",Z)}if(b.uvs.forEach(function($,Z){let re="uv"+(Z+1).toString();Z===0&&(re="uv"),h.setAttribute(re,new _.a$l(b.uvs[Z],2))}),d.material&&d.material.mappingType!=="AllSame"){let $=b.materialIndex[0],Z=0;if(b.materialIndex.forEach(function(re,le){re!==$&&(h.addGroup(Z,le-Z,$),$=re,Z=le)}),h.groups.length>0){const re=h.groups[h.groups.length-1],le=re.start+re.count;le!==b.materialIndex.length&&h.addGroup(le,b.materialIndex.length-le,$)}h.groups.length===0&&h.addGroup(0,b.materialIndex.length,b.materialIndex[0])}return this.addMorphTargets(h,e,s,a),h}parseGeoNode(e,i){const s={};if(s.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],s.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(s.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(s.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(s.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){s.uv=[];let a=0;for(;e.LayerElementUV[a];)e.LayerElementUV[a].UV&&s.uv.push(this.parseUVs(e.LayerElementUV[a])),a++}return s.weightTable={},i!==null&&(s.skeleton=i,i.rawBones.forEach(function(a,h){a.indices.forEach(function(d,b){s.weightTable[d]===void 0&&(s.weightTable[d]=[]),s.weightTable[d].push({id:h,weight:a.weights[b]})})})),s}genBuffers(e){const i={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let s=0,a=0,h=!1,d=[],b=[],X=[],$=[],Z=[],re=[];const le=this;return e.vertexIndices.forEach(function(he,fe){let me,Ee=!1;he<0&&(he^=-1,Ee=!0);let Ae=[],ye=[];if(d.push(3*he,3*he+1,3*he+2),e.color){const ge=Zd(fe,s,he,e.color);X.push(ge[0],ge[1],ge[2])}if(e.skeleton){if(e.weightTable[he]!==void 0&&e.weightTable[he].forEach(function(ge){ye.push(ge.weight),Ae.push(ge.id)}),ye.length>4){h||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),h=!0);const ge=[0,0,0,0],Pe=[0,0,0,0];ye.forEach(function(Be,Oe){let Fe=Be,Xe=Ae[Oe];Pe.forEach(function(at,mt,wt){if(Fe>at){wt[mt]=Fe,Fe=at;const At=ge[mt];ge[mt]=Xe,Xe=At}})}),Ae=ge,ye=Pe}for(;ye.length<4;)ye.push(0),Ae.push(0);for(let ge=0;ge<4;++ge)Z.push(ye[ge]),re.push(Ae[ge])}if(e.normal){const ge=Zd(fe,s,he,e.normal);b.push(ge[0],ge[1],ge[2])}e.material&&e.material.mappingType!=="AllSame"&&(me=Zd(fe,s,he,e.material)[0],me<0&&(console.warn("THREE.FBXLoader: Invalid material index:",me),me=0)),e.uv&&e.uv.forEach(function(ge,Pe){const Be=Zd(fe,s,he,ge);$[Pe]===void 0&&($[Pe]=[]),$[Pe].push(Be[0]),$[Pe].push(Be[1])}),a++,Ee&&(le.genFace(i,e,d,me,b,X,$,Z,re,a),s++,a=0,d=[],b=[],X=[],$=[],Z=[],re=[])}),i}genFace(e,i,s,a,h,d,b,X,$,Z){for(let re=2;re<Z;re++)e.vertex.push(i.vertexPositions[s[0]]),e.vertex.push(i.vertexPositions[s[1]]),e.vertex.push(i.vertexPositions[s[2]]),e.vertex.push(i.vertexPositions[s[3*(re-1)]]),e.vertex.push(i.vertexPositions[s[3*(re-1)+1]]),e.vertex.push(i.vertexPositions[s[3*(re-1)+2]]),e.vertex.push(i.vertexPositions[s[3*re]]),e.vertex.push(i.vertexPositions[s[3*re+1]]),e.vertex.push(i.vertexPositions[s[3*re+2]]),i.skeleton&&(e.vertexWeights.push(X[0]),e.vertexWeights.push(X[1]),e.vertexWeights.push(X[2]),e.vertexWeights.push(X[3]),e.vertexWeights.push(X[4*(re-1)]),e.vertexWeights.push(X[4*(re-1)+1]),e.vertexWeights.push(X[4*(re-1)+2]),e.vertexWeights.push(X[4*(re-1)+3]),e.vertexWeights.push(X[4*re]),e.vertexWeights.push(X[4*re+1]),e.vertexWeights.push(X[4*re+2]),e.vertexWeights.push(X[4*re+3]),e.weightsIndices.push($[0]),e.weightsIndices.push($[1]),e.weightsIndices.push($[2]),e.weightsIndices.push($[3]),e.weightsIndices.push($[4*(re-1)]),e.weightsIndices.push($[4*(re-1)+1]),e.weightsIndices.push($[4*(re-1)+2]),e.weightsIndices.push($[4*(re-1)+3]),e.weightsIndices.push($[4*re]),e.weightsIndices.push($[4*re+1]),e.weightsIndices.push($[4*re+2]),e.weightsIndices.push($[4*re+3])),i.color&&(e.colors.push(d[0]),e.colors.push(d[1]),e.colors.push(d[2]),e.colors.push(d[3*(re-1)]),e.colors.push(d[3*(re-1)+1]),e.colors.push(d[3*(re-1)+2]),e.colors.push(d[3*re]),e.colors.push(d[3*re+1]),e.colors.push(d[3*re+2])),i.material&&i.material.mappingType!=="AllSame"&&(e.materialIndex.push(a),e.materialIndex.push(a),e.materialIndex.push(a)),i.normal&&(e.normal.push(h[0]),e.normal.push(h[1]),e.normal.push(h[2]),e.normal.push(h[3*(re-1)]),e.normal.push(h[3*(re-1)+1]),e.normal.push(h[3*(re-1)+2]),e.normal.push(h[3*re]),e.normal.push(h[3*re+1]),e.normal.push(h[3*re+2])),i.uv&&i.uv.forEach(function(le,he){e.uvs[he]===void 0&&(e.uvs[he]=[]),e.uvs[he].push(b[he][0]),e.uvs[he].push(b[he][1]),e.uvs[he].push(b[he][2*(re-1)]),e.uvs[he].push(b[he][2*(re-1)+1]),e.uvs[he].push(b[he][2*re]),e.uvs[he].push(b[he][2*re+1])})}addMorphTargets(e,i,s,a){if(s.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const h=this;s.forEach(function(d){d.rawTargets.forEach(function(b){const X=mn.Objects.Geometry[b.geoID];X!==void 0&&h.genMorphGeometry(e,i,X,a,b.name)})})}genMorphGeometry(e,i,s,a,h){const d=i.PolygonVertexIndex!==void 0?i.PolygonVertexIndex.a:[],b=s.Vertices!==void 0?s.Vertices.a:[],X=s.Indexes!==void 0?s.Indexes.a:[],$=3*e.attributes.position.count,Z=new Float32Array($);for(let fe=0;fe<X.length;fe++){const me=3*X[fe];Z[me]=b[3*fe],Z[me+1]=b[3*fe+1],Z[me+2]=b[3*fe+2]}const re={vertexIndices:d,vertexPositions:Z},le=this.genBuffers(re),he=new _.a$l(le.vertex,3);he.name=h||s.attrName,he.applyMatrix4(a),e.morphAttributes.position.push(he)}parseNormals(e){const i=e.MappingInformationType,s=e.ReferenceInformationType,a=e.Normals.a;let h=[];return s==="IndexToDirect"&&("NormalIndex"in e?h=e.NormalIndex.a:"NormalsIndex"in e&&(h=e.NormalsIndex.a)),{dataSize:3,buffer:a,indices:h,mappingType:i,referenceType:s}}parseUVs(e){const i=e.MappingInformationType,s=e.ReferenceInformationType,a=e.UV.a;let h=[];return s==="IndexToDirect"&&(h=e.UVIndex.a),{dataSize:2,buffer:a,indices:h,mappingType:i,referenceType:s}}parseVertexColors(e){const i=e.MappingInformationType,s=e.ReferenceInformationType,a=e.Colors.a;let h=[];return s==="IndexToDirect"&&(h=e.ColorIndex.a),{dataSize:4,buffer:a,indices:h,mappingType:i,referenceType:s}}parseMaterialIndices(e){const i=e.MappingInformationType,s=e.ReferenceInformationType;if(i==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:s};const a=e.Materials.a,h=[];for(let d=0;d<a.length;++d)h.push(d);return{dataSize:1,buffer:a,indices:h,mappingType:i,referenceType:s}}parseNurbsGeometry(e){if(Tn===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new _.u9r;const i=parseInt(e.Order);if(isNaN(i))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new _.u9r;const s=i-1,a=e.KnotVector.a,h=[],d=e.Points.a;for(let Z=0,re=d.length;Z<re;Z+=4)h.push(new _.Ltg().fromArray(d,Z));let b,X;if(e.Form==="Closed")h.push(h[0]);else if(e.Form==="Periodic"){b=s,X=a.length-1-b;for(let Z=0;Z<s;++Z)h.push(h[Z])}const $=new Tn(s,a,h,b,X).getPoints(12*h.length);return new _.u9r().setFromPoints($)}}class Lr{parse(){const e=[],i=this.parseClips();if(i!==void 0)for(const s in i){const a=i[s],h=this.addClip(a);e.push(h)}return e}parseClips(){if(mn.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const i=this.parseAnimationLayers(e);return this.parseAnimStacks(i)}parseAnimationCurveNodes(){const e=mn.Objects.AnimationCurveNode,i=new Map;for(const s in e){const a=e[s];if(a.attrName.match(/S|R|T|DeformPercent/)!==null){const h={id:a.id,attr:a.attrName,curves:{}};i.set(h.id,h)}}return i}parseAnimationCurves(e){const i=mn.Objects.AnimationCurve;for(const s in i){const a={id:i[s].id,times:i[s].KeyTime.a.map(Ih),values:i[s].KeyValueFloat.a},h=ei.get(a.id);if(h!==void 0){const d=h.parents[0].ID,b=h.parents[0].relationship;b.match(/X/)?e.get(d).curves.x=a:b.match(/Y/)?e.get(d).curves.y=a:b.match(/Z/)?e.get(d).curves.z=a:b.match(/d|DeformPercent/)&&e.has(d)&&(e.get(d).curves.morph=a)}}}parseAnimationLayers(e){const i=mn.Objects.AnimationLayer,s=new Map;for(const a in i){const h=[],d=ei.get(parseInt(a));d!==void 0&&(d.children.forEach(function(b,X){if(e.has(b.ID)){const $=e.get(b.ID);if($.curves.x!==void 0||$.curves.y!==void 0||$.curves.z!==void 0){if(h[X]===void 0){const Z=ei.get(b.ID).parents.filter(function(re){return re.relationship!==void 0})[0].ID;if(Z!==void 0){const re=mn.Objects.Model[Z.toString()];if(re===void 0)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",b);const le={modelName:re.attrName?_.iUV.sanitizeNodeName(re.attrName):"",ID:re.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Qi.traverse(function(he){he.ID===re.id&&(le.transform=he.matrix,he.userData.transformData&&(le.eulerOrder=he.userData.transformData.eulerOrder))}),le.transform||(le.transform=new _.yGw),"PreRotation"in re&&(le.preRotation=re.PreRotation.value),"PostRotation"in re&&(le.postRotation=re.PostRotation.value),h[X]=le}}h[X]&&(h[X][$.attr]=$)}else if($.curves.morph!==void 0){if(h[X]===void 0){const Z=ei.get(b.ID).parents.filter(function(Ee){return Ee.relationship!==void 0})[0].ID,re=ei.get(Z).parents[0].ID,le=ei.get(re).parents[0].ID,he=ei.get(le).parents[0].ID,fe=mn.Objects.Model[he],me={modelName:fe.attrName?_.iUV.sanitizeNodeName(fe.attrName):"",morphName:mn.Objects.Deformer[Z].attrName};h[X]=me}h[X][$.attr]=$}}}),s.set(parseInt(a),h))}return s}parseAnimStacks(e){const i=mn.Objects.AnimationStack,s={};for(const a in i){const h=ei.get(parseInt(a)).children;h.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const d=e.get(h[0].ID);s[a]={name:i[a].attrName,layer:d}}return s}addClip(e){let i=[];const s=this;return e.layer.forEach(function(a){i=i.concat(s.generateTracks(a))}),new _.m7l(e.name,-1,i)}generateTracks(e){const i=[];let s=new _.Pa4,a=new _._fP,h=new _.Pa4;if(e.transform&&e.transform.decompose(s,a,h),s=s.toArray(),a=new _.USm().setFromQuaternion(a,e.eulerOrder).toArray(),h=h.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const d=this.generateVectorTrack(e.modelName,e.T.curves,s,"position");d!==void 0&&i.push(d)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const d=this.generateRotationTrack(e.modelName,e.R.curves,a,e.preRotation,e.postRotation,e.eulerOrder);d!==void 0&&i.push(d)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const d=this.generateVectorTrack(e.modelName,e.S.curves,h,"scale");d!==void 0&&i.push(d)}if(e.DeformPercent!==void 0){const d=this.generateMorphTrack(e);d!==void 0&&i.push(d)}return i}generateVectorTrack(e,i,s,a){const h=this.getTimesForAllAxes(i),d=this.getKeyframeTrackValues(h,i,s);return new _.yC1(e+"."+a,h,d)}generateRotationTrack(e,i,s,a,h,d){i.x!==void 0&&(this.interpolateRotations(i.x),i.x.values=i.x.values.map(_.M8C.degToRad)),i.y!==void 0&&(this.interpolateRotations(i.y),i.y.values=i.y.values.map(_.M8C.degToRad)),i.z!==void 0&&(this.interpolateRotations(i.z),i.z.values=i.z.values.map(_.M8C.degToRad));const b=this.getTimesForAllAxes(i),X=this.getKeyframeTrackValues(b,i,s);a!==void 0&&((a=a.map(_.M8C.degToRad)).push(d),a=new _.USm().fromArray(a),a=new _._fP().setFromEuler(a)),h!==void 0&&((h=h.map(_.M8C.degToRad)).push(d),h=new _.USm().fromArray(h),h=new _._fP().setFromEuler(h).invert());const $=new _._fP,Z=new _.USm,re=[];for(let le=0;le<X.length;le+=3)Z.set(X[le],X[le+1],X[le+2],d),$.setFromEuler(Z),a!==void 0&&$.premultiply(a),h!==void 0&&$.multiply(h),$.toArray(re,le/3*4);return new _.iLg(e+".quaternion",b,re)}generateMorphTrack(e){const i=e.DeformPercent.curves.morph,s=i.values.map(function(h){return h/100}),a=Qi.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new _.dUE(e.modelName+".morphTargetInfluences["+a+"]",i.times,s)}getTimesForAllAxes(e){let i=[];if(e.x!==void 0&&(i=i.concat(e.x.times)),e.y!==void 0&&(i=i.concat(e.y.times)),e.z!==void 0&&(i=i.concat(e.z.times)),i=i.sort(function(s,a){return s-a}),i.length>1){let s=1,a=i[0];for(let h=1;h<i.length;h++){const d=i[h];d!==a&&(i[s]=d,a=d,s++)}i=i.slice(0,s)}return i}getKeyframeTrackValues(e,i,s){const a=s,h=[];let d=-1,b=-1,X=-1;return e.forEach(function($){if(i.x&&(d=i.x.times.indexOf($)),i.y&&(b=i.y.times.indexOf($)),i.z&&(X=i.z.times.indexOf($)),d!==-1){const Z=i.x.values[d];h.push(Z),a[0]=Z}else h.push(a[0]);if(b!==-1){const Z=i.y.values[b];h.push(Z),a[1]=Z}else h.push(a[1]);if(X!==-1){const Z=i.z.values[X];h.push(Z),a[2]=Z}else h.push(a[2])}),h}interpolateRotations(e){for(let i=1;i<e.values.length;i++){const s=e.values[i-1],a=e.values[i]-s,h=Math.abs(a);if(h>=180){const d=h/180,b=a/d;let X=s+b;const $=e.times[i-1],Z=(e.times[i]-$)/d;let re=$+Z;const le=[],he=[];for(;re<e.times[i];)le.push(re),re+=Z,he.push(X),X+=b;e.times=wo(e.times,i,le),e.values=wo(e.values,i,he)}}}}class gr{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,i){this.currentProp=e,this.currentPropName=i}parse(e){this.currentIndent=0,this.allNodes=new sl,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const i=this,s=e.split(/[\r\n]+/);return s.forEach(function(a,h){const d=a.match(/^[\s\t]*;/),b=a.match(/^[\s\t]*$/);if(d||b)return;const X=a.match("^\\t{"+i.currentIndent+"}(\\w+):(.*){",""),$=a.match("^\\t{"+i.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),Z=a.match("^\\t{"+(i.currentIndent-1)+"}}");X?i.parseNodeBegin(a,X):$?i.parseNodeProperty(a,$,s[++h]):Z?i.popStack():a.match(/^[^\s\t}]/)&&i.parseNodePropertyContinued(a)}),this.allNodes}parseNodeBegin(e,i){const s=i[1].trim().replace(/^"/,"").replace(/"$/,""),a=i[2].split(",").map(function(X){return X.trim().replace(/^"/,"").replace(/"$/,"")}),h={name:s},d=this.parseNodeAttr(a),b=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(s,h):s in b?(s==="PoseNode"?b.PoseNode.push(h):b[s].id!==void 0&&(b[s]={},b[s][b[s].id]=b[s]),d.id!==""&&(b[s][d.id]=h)):typeof d.id=="number"?(b[s]={},b[s][d.id]=h):s!=="Properties70"&&(b[s]=s==="PoseNode"?[h]:h),typeof d.id=="number"&&(h.id=d.id),d.name!==""&&(h.attrName=d.name),d.type!==""&&(h.attrType=d.type),this.pushStack(h)}parseNodeAttr(e){let i=e[0];e[0]!==""&&(i=parseInt(e[0]),isNaN(i)&&(i=e[0]));let s="",a="";return e.length>1&&(s=e[1].replace(/^(\w+)::/,""),a=e[2]),{id:i,name:s,type:a}}parseNodeProperty(e,i,s){let a=i[1].replace(/^"/,"").replace(/"$/,"").trim(),h=i[2].replace(/^"/,"").replace(/"$/,"").trim();a==="Content"&&h===","&&(h=s.replace(/"/g,"").replace(/,$/,"").trim());const d=this.getCurrentNode();if(d.name!=="Properties70"){if(a==="C"){const b=h.split(",").slice(1),X=parseInt(b[0]),$=parseInt(b[1]);let Z=h.split(",").slice(3);Z=Z.map(function(re){return re.trim().replace(/^"/,"")}),a="connections",h=[X,$],function(re,le){for(let he=0,fe=re.length,me=le.length;he<me;he++,fe++)re[fe]=le[he]}(h,Z),d[a]===void 0&&(d[a]=[])}a==="Node"&&(d.id=h),a in d&&Array.isArray(d[a])?d[a].push(h):a!=="a"?d[a]=h:d.a=h,this.setCurrentProp(d,a),a==="a"&&h.slice(-1)!==","&&(d.a=ol(h))}else this.parseNodeSpecialProperty(e,a,h)}parseNodePropertyContinued(e){const i=this.getCurrentNode();i.a+=e,e.slice(-1)!==","&&(i.a=ol(i.a))}parseNodeSpecialProperty(e,i,s){const a=s.split('",').map(function(Z){return Z.trim().replace(/^\"/,"").replace(/\s/,"_")}),h=a[0],d=a[1],b=a[2],X=a[3];let $=a[4];switch(d){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":$=parseFloat($);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":$=ol($)}this.getPrevNode()[h]={type:d,type2:b,flag:X,value:$},this.setCurrentProp(this.getPrevNode(),h)}}class No{parse(e){const i=new hf(e);i.skip(23);const s=i.getUint32();if(s<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+s);const a=new sl;for(;!this.endOfContent(i);){const h=this.parseNode(i,s);h!==null&&a.add(h.name,h)}return a}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,i){const s={},a=i>=7500?e.getUint64():e.getUint32(),h=i>=7500?e.getUint64():e.getUint32();i>=7500?e.getUint64():e.getUint32();const d=e.getUint8(),b=e.getString(d);if(a===0)return null;const X=[];for(let le=0;le<h;le++)X.push(this.parseProperty(e));const $=X.length>0?X[0]:"",Z=X.length>1?X[1]:"",re=X.length>2?X[2]:"";for(s.singleProperty=h===1&&e.getOffset()===a;a>e.getOffset();){const le=this.parseNode(e,i);le!==null&&this.parseSubNode(b,s,le)}return s.propertyList=X,typeof $=="number"&&(s.id=$),Z!==""&&(s.attrName=Z),re!==""&&(s.attrType=re),b!==""&&(s.name=b),s}parseSubNode(e,i,s){if(s.singleProperty===!0){const a=s.propertyList[0];Array.isArray(a)?(i[s.name]=s,s.a=a):i[s.name]=a}else if(e==="Connections"&&s.name==="C"){const a=[];s.propertyList.forEach(function(h,d){d!==0&&a.push(h)}),i.connections===void 0&&(i.connections=[]),i.connections.push(a)}else if(s.name==="Properties70")Object.keys(s).forEach(function(a){i[a]=s[a]});else if(e==="Properties70"&&s.name==="P"){let a=s.propertyList[0],h=s.propertyList[1];const d=s.propertyList[2],b=s.propertyList[3];let X;a.indexOf("Lcl ")===0&&(a=a.replace("Lcl ","Lcl_")),h.indexOf("Lcl ")===0&&(h=h.replace("Lcl ","Lcl_")),X=h==="Color"||h==="ColorRGB"||h==="Vector"||h==="Vector3D"||h.indexOf("Lcl_")===0?[s.propertyList[4],s.propertyList[5],s.propertyList[6]]:s.propertyList[4],i[a]={type:h,type2:d,flag:b,value:X}}else i[s.name]===void 0?typeof s.id=="number"?(i[s.name]={},i[s.name][s.id]=s):i[s.name]=s:s.name==="PoseNode"?(Array.isArray(i[s.name])||(i[s.name]=[i[s.name]]),i[s.name].push(s)):i[s.name][s.id]===void 0&&(i[s.name][s.id]=s)}parseProperty(e){const i=e.getString(1);let s;switch(i){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return s=e.getUint32(),e.getArrayBuffer(s);case"S":return s=e.getUint32(),e.getString(s);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const a=e.getUint32(),h=e.getUint32(),d=e.getUint32();if(h===0)switch(i){case"b":case"c":return e.getBooleanArray(a);case"d":return e.getFloat64Array(a);case"f":return e.getFloat32Array(a);case"i":return e.getInt32Array(a);case"l":return e.getInt64Array(a)}te===void 0&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const b=on(new Uint8Array(e.getArrayBuffer(d))),X=new hf(b.buffer);switch(i){case"b":case"c":return X.getBooleanArray(a);case"d":return X.getFloat64Array(a);case"f":return X.getFloat32Array(a);case"i":return X.getInt32Array(a);case"l":return X.getInt64Array(a)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+i)}}}class hf{constructor(e,i){this.dv=new DataView(e),this.offset=0,this.littleEndian=i===void 0||i}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(1&this.getUint8())==1}getBooleanArray(e){const i=[];for(let s=0;s<e;s++)i.push(this.getBoolean());return i}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getInt32());return i}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,i;return this.littleEndian?(e=this.getUint32(),i=this.getUint32()):(i=this.getUint32(),e=this.getUint32()),2147483648&i?(i=4294967295&~i,e=4294967295&~e,e===4294967295&&(i=i+1&4294967295),e=e+1&4294967295,-(4294967296*i+e)):4294967296*i+e}getInt64Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getInt64());return i}getUint64(){let e,i;return this.littleEndian?(e=this.getUint32(),i=this.getUint32()):(i=this.getUint32(),e=this.getUint32()),4294967296*i+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getFloat32());return i}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getFloat64());return i}getArrayBuffer(e){const i=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,i}getString(e){let i=[];for(let a=0;a<e;a++)i[a]=this.getUint8();const s=i.indexOf(0);return s>=0&&(i=i.slice(0,s)),_.Zp0.decodeText(new Uint8Array(i))}}class sl{add(e,i){this[e]=i}}function U_(c){const e=c.match(/FBXVersion: (\d+)/);if(e)return parseInt(e[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Ih(c){return c/46186158e3}const bx=[];function Zd(c,e,i,s){let a;switch(s.mappingType){case"ByPolygonVertex":a=c;break;case"ByPolygon":a=e;break;case"ByVertice":a=i;break;case"AllSame":a=s.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+s.mappingType)}s.referenceType==="IndexToDirect"&&(a=s.indices[a]);const h=a*s.dataSize,d=h+s.dataSize;return function(b,X,$,Z){for(let re=$,le=0;re<Z;re++,le++)b[le]=X[re];return b}(bx,s.buffer,h,d)}const U0=new _.USm,ju=new _.Pa4;function Uo(c){const e=new _.yGw,i=new _.yGw,s=new _.yGw,a=new _.yGw,h=new _.yGw,d=new _.yGw,b=new _.yGw,X=new _.yGw,$=new _.yGw,Z=new _.yGw,re=new _.yGw,le=new _.yGw,he=c.inheritType?c.inheritType:0;if(c.translation&&e.setPosition(ju.fromArray(c.translation)),c.preRotation){const mt=c.preRotation.map(_.M8C.degToRad);mt.push(c.eulerOrder||_.USm.DefaultOrder),i.makeRotationFromEuler(U0.fromArray(mt))}if(c.rotation){const mt=c.rotation.map(_.M8C.degToRad);mt.push(c.eulerOrder||_.USm.DefaultOrder),s.makeRotationFromEuler(U0.fromArray(mt))}if(c.postRotation){const mt=c.postRotation.map(_.M8C.degToRad);mt.push(c.eulerOrder||_.USm.DefaultOrder),a.makeRotationFromEuler(U0.fromArray(mt)),a.invert()}c.scale&&h.scale(ju.fromArray(c.scale)),c.scalingOffset&&b.setPosition(ju.fromArray(c.scalingOffset)),c.scalingPivot&&d.setPosition(ju.fromArray(c.scalingPivot)),c.rotationOffset&&X.setPosition(ju.fromArray(c.rotationOffset)),c.rotationPivot&&$.setPosition(ju.fromArray(c.rotationPivot)),c.parentMatrixWorld&&(re.copy(c.parentMatrix),Z.copy(c.parentMatrixWorld));const fe=i.clone().multiply(s).multiply(a),me=new _.yGw;me.extractRotation(Z);const Ee=new _.yGw;Ee.copyPosition(Z);const Ae=Ee.clone().invert().multiply(Z),ye=me.clone().invert().multiply(Ae),ge=h,Pe=new _.yGw;if(he===0)Pe.copy(me).multiply(fe).multiply(ye).multiply(ge);else if(he===1)Pe.copy(me).multiply(ye).multiply(fe).multiply(ge);else{const mt=new _.yGw().scale(new _.Pa4().setFromMatrixScale(re)).clone().invert(),wt=ye.clone().multiply(mt);Pe.copy(me).multiply(fe).multiply(wt).multiply(ge)}const Be=$.clone().invert(),Oe=d.clone().invert();let Fe=e.clone().multiply(X).multiply($).multiply(i).multiply(s).multiply(a).multiply(Be).multiply(b).multiply(d).multiply(h).multiply(Oe);const Xe=new _.yGw().copyPosition(Fe),at=Z.clone().multiply(Xe);return le.copyPosition(at),Fe=le.clone().multiply(Pe),Fe.premultiply(Z.invert()),Fe}function df(c){const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return(c=c||0)===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[c]}function ol(c){return c.split(",").map(function(e){return parseFloat(e)})}function Hi(c,e,i){return e===void 0&&(e=0),i===void 0&&(i=c.byteLength),_.Zp0.decodeText(new Uint8Array(c,e,i))}function wo(c,e,i){return c.slice(0,e).concat(i).concat(c.slice(e))}class Um extends oe{constructor(){super(...arguments),this.dependencies=[Kn],this._importer=new _s(Fi,["fbx"],!0)}async onAdded(e){yr.Importers.push(this._importer)}async onDispose(e){}async onRemove(e){yr.Importers.splice(yr.Importers.indexOf(this._importer),1)}}Um.PluginType="FBXLoadPlugin";const F0=new WeakMap;class wx extends _.aNw{constructor(e){super(e),this.libraryPath="",this.libraryPending=null,this.libraryBinary=null,this.libraryConfig={},this.url="",this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={},this.materials=[],this.warnings=[]}setLibraryPath(e){return this.libraryPath=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,i,s,a){const h=new _.hH6(this.manager);h.setPath(this.path),h.setResponseType("arraybuffer"),h.setRequestHeader(this.requestHeader),this.url=e,h.load(e,d=>{if(F0.has(d))return F0.get(d).promise.then(i).catch(a);this.decodeObjects(d,e).then(b=>{b.userData.warnings=this.warnings,i(b)}).catch(b=>a(b))},s,a)}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}decodeObjects(e,i){let s,a;const h=e.byteLength,d=this._getWorker(h).then(b=>(s=b,a=this.workerNextTaskID++,new Promise((X,$)=>{s._callbacks[a]={resolve:X,reject:$},s.postMessage({type:"decode",id:a,buffer:e},[e])}))).then(b=>this._createGeometry(b.data)).catch(b=>{throw b});return d.catch(()=>!0).then(()=>{s&&a&&this._releaseTask(s,a)}),F0.set(e,{url:i,promise:d}),d}parse(e,i,s){this.decodeObjects(e,"").then(a=>{a.userData.warnings=this.warnings,i(a)}).catch(a=>s(a))}_compareMaterials(e){const i={};i.name=e.name,i.color={},i.color.r=e.color.r,i.color.g=e.color.g,i.color.b=e.color.b,i.type=e.type;for(let s=0;s<this.materials.length;s++){const a=this.materials[s],h={};if(h.name=a.name,h.color={},h.color.r=a.color.r,h.color.g=a.color.g,h.color.b=a.color.b,h.type=a.type,JSON.stringify(i)===JSON.stringify(h))return a}return this.materials.push(e),e}_createMaterial(e){if(e===void 0)return new _.Wid({color:new _.Ilk(1,1,1),metalness:.8,name:"default",side:2});const i=e.diffuseColor,s=new _.Ilk(i.r/255,i.g/255,i.b/255);i.r===0&&i.g===0&&i.b===0&&(s.r=1,s.g=1,s.b=1);const a=new _.Wid({color:s,name:e.name,side:2,transparent:e.transparency>0,opacity:1-e.transparency}),h=new _.dpR;for(let d=0;d<e.textures.length;d++){const b=e.textures[d];if(b.image!==null){const X=h.load(b.image);switch(b.type){case"Diffuse":a.map=X;break;case"Bump":a.bumpMap=X;break;case"Transparency":a.alphaMap=X,a.transparent=!0;break;case"Emap":a.envMap=X}X.wrapS=b.wrapU===0?_.rpg:_.uWy,X.wrapT=b.wrapV===0?_.rpg:_.uWy,X.repeat.set(b.repeat[0],b.repeat[1])}}return a}_createGeometry(e){const i=new _.Tme,s=[],a=[],h=[];i.userData.layers=e.layers,i.userData.groups=e.groups,i.userData.settings=e.settings,i.userData.objectType="File3dm",i.userData.materials=null,i.name=this.url;let d=e.objects;const b=e.materials;for(let X=0;X<d.length;X++){const $=d[X],Z=$.attributes;switch($.objectType){case"InstanceDefinition":a.push($);break;case"InstanceReference":h.push($);break;default:let re;if(Z.materialIndex>=0){const he=b[Z.materialIndex];let fe=this._createMaterial(he);fe=this._compareMaterials(fe),re=this._createObject($,fe)}else{const he=this._createMaterial();re=this._createObject($,he)}if(re===void 0)continue;const le=e.layers[Z.layerIndex];re.visible=!le||e.layers[Z.layerIndex].visible,Z.isInstanceDefinitionObject?s.push(re):i.add(re)}}for(let X=0;X<a.length;X++){const $=a[X];d=[];for(let Z=0;Z<$.attributes.objectIds.length;Z++){const re=$.attributes.objectIds[Z];for(let le=0;le<s.length;le++)re===s[le].userData.attributes.id&&d.push(s[le])}for(let Z=0;Z<h.length;Z++){const re=h[Z];if(re.geometry.parentIdefId===$.attributes.id){const le=new _.Tme,he=re.geometry.xform.array,fe=new _.yGw;fe.set(he[0],he[1],he[2],he[3],he[4],he[5],he[6],he[7],he[8],he[9],he[10],he[11],he[12],he[13],he[14],he[15]),le.applyMatrix4(fe);for(let me=0;me<d.length;me++)le.add(d[me].clone(!0));i.add(le)}}}return i.userData.materials=this.materials,i}_createObject(e,i){const s=new _.s4_,a=e.attributes;let h,d,b,X;switch(e.objectType){case"Point":case"PointSet":h=s.parse(e.geometry),h.attributes.hasOwnProperty("color")?d=new _.UY4({vertexColors:!0,sizeAttenuation:!1,size:2}):(b=a.drawColor,X=new _.Ilk(b.r/255,b.g/255,b.b/255),d=new _.UY4({color:X,sizeAttenuation:!1,size:2})),d=this._compareMaterials(d);const $=new _.woe(h,d);return $.userData.attributes=a,$.userData.objectType=e.objectType,a.name&&($.name=a.name),$;case"Mesh":case"Extrusion":case"SubD":case"Brep":if(e.geometry===null)return;h=s.parse(e.geometry),h.attributes.hasOwnProperty("color")&&(i.vertexColors=!0),i===null&&(i=this._createMaterial(),i=this._compareMaterials(i));const Z=new _.Kj0(h,i);return Z.castShadow=a.castsShadows,Z.receiveShadow=a.receivesShadows,Z.userData.attributes=a,Z.userData.objectType=e.objectType,a.name&&(Z.name=a.name),Z;case"Curve":h=s.parse(e.geometry),b=a.drawColor,X=new _.Ilk(b.r/255,b.g/255,b.b/255),d=new _.nls({color:X}),d=this._compareMaterials(d);const re=new _.x12(h,d);return re.userData.attributes=a,re.userData.objectType=e.objectType,a.name&&(re.name=a.name),re;case"TextDot":h=e.geometry;const le=document.createElement("canvas").getContext("2d"),he=`${h.fontHeight}px ${h.fontFace}`;le.font=he;const fe=le.measureText(h.text).width+10,me=h.fontHeight+10,Ee=window.devicePixelRatio;le.canvas.width=fe*Ee,le.canvas.height=me*Ee,le.canvas.style.width=fe+"px",le.canvas.style.height=me+"px",le.setTransform(Ee,0,0,Ee,0,0),le.font=he,le.textBaseline="middle",le.textAlign="center",X=a.drawColor,le.fillStyle=`rgba(${X.r},${X.g},${X.b},${X.a})`,le.fillRect(0,0,fe,me),le.fillStyle="white",le.fillText(h.text,fe/2,me/2);const Ae=new _.ROQ(le.canvas);Ae.minFilter=_.wem,Ae.wrapS=_.uWy,Ae.wrapT=_.uWy,d=new _.xeV({map:Ae,depthTest:!1});const ye=new _.jyi(d);return ye.position.set(h.point[0],h.point[1],h.point[2]),ye.scale.set(fe/10,me/10,1),ye.userData.attributes=a,ye.userData.objectType=e.objectType,a.name&&(ye.name=a.name),ye;case"Light":let ge;switch(h=e.geometry,h.lightStyle.name){case"LightStyle_WorldPoint":ge=new _.cek,ge.castShadow=a.castsShadows,ge.position.set(h.location[0],h.location[1],h.location[2]),ge.shadow.normalBias=.1;break;case"LightStyle_WorldSpot":ge=new _.PMe,ge.castShadow=a.castsShadows,ge.position.set(h.location[0],h.location[1],h.location[2]),ge.target.position.set(h.direction[0],h.direction[1],h.direction[2]),ge.angle=h.spotAngleRadians,ge.shadow.normalBias=.1;break;case"LightStyle_WorldRectangular":ge=new _.T_f;const Pe=Math.abs(h.width[2]),Be=Math.abs(h.length[0]);ge.position.set(h.location[0]-Be/2,h.location[1],h.location[2]-Pe/2),ge.height=Be,ge.width=Pe,ge.lookAt(new _.Pa4(h.direction[0],h.direction[1],h.direction[2]));break;case"LightStyle_WorldDirectional":ge=new _.Ox3,ge.castShadow=a.castsShadows,ge.position.set(h.location[0],h.location[1],h.location[2]),ge.target.position.set(h.direction[0],h.direction[1],h.direction[2]),ge.shadow.normalBias=.1}return ge&&(ge.intensity=h.intensity,b=h.diffuse,X=new _.Ilk(b.r/255,b.g/255,b.b/255),ge.color=X,ge.userData.attributes=a,ge.userData.objectType=e.objectType),ge}}_initLibrary(){if(!this.libraryPending){const e=new _.hH6(this.manager);e.setPath(this.libraryPath);const i=new Promise((h,d)=>{e.load("rhino3dm.js",h,void 0,d)}),s=new _.hH6(this.manager);s.setPath(this.libraryPath),s.setResponseType("arraybuffer");const a=new Promise((h,d)=>{s.load("rhino3dm.wasm",h,void 0,d)});this.libraryPending=Promise.all([i,a]).then(([h,d])=>{this.libraryConfig.wasmBinary=d;const b=F_.toString(),X=["/* rhino3dm.js */",h,"/* worker */",b.substring(b.indexOf("{")+1,b.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([X]))})}return this.libraryPending}_getWorker(e){return this._initLibrary().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",libraryConfig:this.libraryConfig}),s.onmessage=a=>{const h=a.data;switch(h.type){case"warning":this.warnings.push(h.data),console.warn(h.data);break;case"decode":s._callbacks[h.id].resolve(h);break;case"error":s._callbacks[h.id].reject(h);break;default:console.error('THREE.Rhino3dmLoader: Unexpected message, "'+h.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,a){return s._taskLoad>a._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskLoad+=e,i})}_releaseTask(e,i){e._taskLoad-=e._taskCosts[i],delete e._callbacks[i],delete e._taskCosts[i]}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function F_(){let c,e,i,s;function a(b,X){const $=b.geometry(),Z=b.attributes();let re,le,he,fe,me,Ee=$.objectType;switch(Ee){case i.ObjectType.Curve:const Ae=d($,100);he={},le={},fe={},he.itemSize=3,he.type="Float32Array",he.array=[];for(let Oe=0;Oe<Ae.length;Oe++)he.array.push(Ae[Oe][0]),he.array.push(Ae[Oe][1]),he.array.push(Ae[Oe][2]);le.position=he,fe.attributes=le,re={data:fe};break;case i.ObjectType.Point:const ye=$.location;he={};const ge={};le={},fe={},he.itemSize=3,he.type="Float32Array",he.array=[ye[0],ye[1],ye[2]];const Pe=Z.drawColor(X);ge.itemSize=3,ge.type="Float32Array",ge.array=[Pe.r/255,Pe.g/255,Pe.b/255],le.position=he,le.color=ge,fe.attributes=le,re={data:fe};break;case i.ObjectType.PointSet:case i.ObjectType.Mesh:re=$.toThreejsJSON();break;case i.ObjectType.Brep:const Be=$.faces();me=new i.Mesh;for(let Oe=0;Oe<Be.count;Oe++){const Fe=Be.get(Oe),Xe=Fe.getMesh(i.MeshType.Any);Xe&&(me.append(Xe),Xe.delete()),Fe.delete()}me.faces().count>0&&(me.compact(),re=me.toThreejsJSON(),Be.delete()),me.delete();break;case i.ObjectType.Extrusion:me=$.getMesh(i.MeshType.Any),me&&(re=me.toThreejsJSON(),me.delete());break;case i.ObjectType.TextDot:re=h($);break;case i.ObjectType.Light:re=h($),re.lightStyle.name==="LightStyle_WorldLinear"&&self.postMessage({type:"warning",id:s,data:{message:`THREE.3DMLoader: No conversion exists for ${Ee.constructor.name} ${re.lightStyle.name}`,type:"no conversion",guid:Z.id}});break;case i.ObjectType.InstanceReference:re=h($),re.xform=h($.xform),re.xform.array=$.xform.toFloatArray(!0);break;case i.ObjectType.SubD:$.subdivide(3),me=i.Mesh.createFromSubDControlNet($),me&&(re=me.toThreejsJSON(),me.delete());break;default:self.postMessage({type:"warning",id:s,data:{message:`THREE.3DMLoader: Conversion not implemented for ${Ee.constructor.name}`,type:"not implemented",guid:Z.id}})}if(re)return le=h(Z),le.geometry=h($),Z.groupCount>0&&(le.groupIds=Z.getGroupList()),Z.userStringCount>0&&(le.userStrings=Z.getUserStrings()),$.userStringCount>0&&(le.geometry.userStrings=$.getUserStrings()),le.drawColor=Z.drawColor(X),Ee=Ee.constructor.name,Ee=Ee.substring(11,Ee.length),{geometry:re,attributes:le,objectType:Ee};self.postMessage({type:"warning",id:s,data:{message:`THREE.3DMLoader: ${Ee.constructor.name} has no associated mesh geometry.`,type:"missing mesh",guid:Z.id}})}function h(b){const X={};for(const $ in b){const Z=b[$];typeof Z!="function"&&(typeof Z=="object"&&Z!==null&&Z.hasOwnProperty("constructor")?X[$]={name:Z.constructor.name,value:Z.value}:X[$]=Z)}return X}function d(b,X){let $=X,Z=[];const re=[];if(b instanceof i.LineCurve)return[b.pointAtStart,b.pointAtEnd];if(b instanceof i.PolylineCurve){$=b.pointCount;for(let fe=0;fe<$;fe++)Z.push(b.point(fe));return Z}if(b instanceof i.PolyCurve){const fe=b.segmentCount;for(let me=0;me<fe;me++){const Ee=b.segmentCurve(me),Ae=d(Ee,$);Z=Z.concat(Ae),Ee.delete()}return Z}if(b instanceof i.ArcCurve&&($=Math.floor(b.angleDegrees/5),$=$<2?2:$),b instanceof i.NurbsCurve&&b.degree===1){const fe=b.tryGetPolyline();for(let me=0;me<fe.count;me++)Z.push(fe.get(me));return fe.delete(),Z}const le=b.domain,he=$-1;for(let fe=0;fe<$;fe++){const me=le[0]+fe/he*(le[1]-le[0]);if(me===le[0]||me===le[1]){re.push(me);continue}const Ee=b.tangentAt(me),Ae=b.tangentAt(re.slice(-1)[0]),ye=Ee[0]*Ee[0]+Ee[1]*Ee[1]+Ee[2]*Ee[2],ge=Ae[0]*Ae[0]+Ae[1]*Ae[1]+Ae[2]*Ae[2],Pe=Math.sqrt(ye*ge);let Be;if(Pe===0)Be=Math.PI/2;else{const Oe=(Ee.x*Ae.x+Ee.y*Ae.y+Ee.z*Ae.z)/Pe;Be=Math.acos(Math.max(-1,Math.min(1,Oe)))}Be<.1||re.push(me)}return Z=re.map(fe=>b.pointAt(fe)),Z}onmessage=function(b){const X=b.data;switch(X.type){case"init":e=X.libraryConfig;const $=e.wasmBinary;let Z;c=new Promise(function(le){Z={wasmBinary:$,onRuntimeInitialized:le},rhino3dm(Z)}).then(()=>{i=Z});break;case"decode":s=X.id;const re=X.buffer;c.then(()=>{try{const le=function(he,fe){const me=new Uint8Array(fe),Ee=he.File3dm.fromByteArray(me),Ae=[],ye=[],ge=[],Pe=[],Be=[],Oe=[],Fe=[],Xe=Ee.objects(),at=Xe.count;for(let yt=0;yt<at;yt++){const St=Xe.get(yt),Ft=a(St,Ee);St.delete(),Ft&&Ae.push(Ft)}for(let yt=0;yt<Ee.instanceDefinitions().count();yt++){const St=Ee.instanceDefinitions().get(yt),Ft=h(St);Ft.objectIds=St.getObjectIds(),Ae.push({geometry:null,attributes:Ft,objectType:"InstanceDefinition"})}const mt=[he.TextureType.Diffuse,he.TextureType.Bump,he.TextureType.Transparency,he.TextureType.Opacity,he.TextureType.Emap],wt=[he.TextureType.PBR_BaseColor,he.TextureType.PBR_Subsurface,he.TextureType.PBR_SubsurfaceScattering,he.TextureType.PBR_SubsurfaceScatteringRadius,he.TextureType.PBR_Metallic,he.TextureType.PBR_Specular,he.TextureType.PBR_SpecularTint,he.TextureType.PBR_Roughness,he.TextureType.PBR_Anisotropic,he.TextureType.PBR_Anisotropic_Rotation,he.TextureType.PBR_Sheen,he.TextureType.PBR_SheenTint,he.TextureType.PBR_Clearcoat,he.TextureType.PBR_ClearcoatBump,he.TextureType.PBR_ClearcoatRoughness,he.TextureType.PBR_OpacityIor,he.TextureType.PBR_OpacityRoughness,he.TextureType.PBR_Emission,he.TextureType.PBR_AmbientOcclusion,he.TextureType.PBR_Displacement];for(let yt=0;yt<Ee.materials().count();yt++){const St=Ee.materials().get(yt),Ft=St.physicallyBased();let Mt=h(St);const Gt=[];for(let rn=0;rn<mt.length;rn++){const gn=St.getTexture(mt[rn]);if(gn){let Kt=mt[rn].constructor.name;Kt=Kt.substring(12,Kt.length);const In={type:Kt},kn=Ee.getEmbeddedFileAsBase64(gn.fileName);In.wrapU=gn.wrapU,In.wrapV=gn.wrapV,In.wrapW=gn.wrapW;const On=gn.uvwTransform.toFloatArray(!0);In.repeat=[On[0],On[5]],kn?In.image="data:image/png;base64,"+kn:(self.postMessage({type:"warning",id:s,data:{message:`THREE.3DMLoader: Image for ${Kt} texture not embedded in file.`,type:"missing resource"}}),In.image=null),Gt.push(In),gn.delete()}}if(Mt.textures=Gt,Ft.supported){for(let gn=0;gn<wt.length;gn++){const Kt=St.getTexture(wt[gn]);if(Kt){const In=Ee.getEmbeddedFileAsBase64(Kt.fileName);let kn=wt[gn].constructor.name;kn=kn.substring(12,kn.length);const On={type:kn,image:"data:image/png;base64,"+In};Gt.push(On),Kt.delete()}}const rn=h(St.physicallyBased());Mt=Object.assign(rn,Mt)}ye.push(Mt),St.delete(),Ft.delete()}for(let yt=0;yt<Ee.layers().count();yt++){const St=Ee.layers().get(yt),Ft=h(St);ge.push(Ft),St.delete()}for(let yt=0;yt<Ee.views().count();yt++){const St=Ee.views().get(yt),Ft=h(St);Pe.push(Ft),St.delete()}for(let yt=0;yt<Ee.namedViews().count();yt++){const St=Ee.namedViews().get(yt),Ft=h(St);Be.push(Ft),St.delete()}for(let yt=0;yt<Ee.groups().count();yt++){const St=Ee.groups().get(yt),Ft=h(St);Oe.push(Ft),St.delete()}const At=h(Ee.settings()),Tt=Ee.strings().count();for(let yt=0;yt<Tt;yt++)Fe.push(Ee.strings().get(yt));return Ee.delete(),{objects:Ae,materials:ye,layers:ge,views:Pe,namedViews:Be,groups:Oe,strings:Fe,settings:At}}(i,re);self.postMessage({type:"decode",id:X.id,data:le})}catch(le){self.postMessage({type:"error",id:X.id,error:le})}})}}}class eb extends wx{constructor(e){super(e),this.setLibraryPath("https://cdn.jsdelivr.net/npm/rhino3dm@7.15.0/")}async loadAsync(e,i){const s=await super.loadAsync(e,i);return s.rotateX(-Math.PI/2),s}}class j0 extends oe{constructor(){super(...arguments),this.dependencies=[Kn],this._importer=new _s(eb,["3dm"],!0)}async onAdded(e){yr.Importers.push(this._importer)}async onDispose(e){}async onRemove(e){yr.Importers.splice(yr.Importers.indexOf(this._importer),1)}}j0.PluginType="Rhino3dmLoadPlugin";class z0 extends oe{constructor(){super(...arguments),this.dependencies=[Kn]}async onAdded(e){const i=document.createElement("script");i.type="module",i.innerHTML=`
import { MeshoptDecoder } from 'https://cdn.jsdelivr.net/gh/zeux/meshoptimizer@master/js/meshopt_decoder.module.js'
window.MeshoptDecoder = MeshoptDecoder
`,document.head.appendChild(i),this._script=i}async onDispose(e){}async onRemove(e){this._script&&(document.head.removeChild(this._script),this._script=void 0)}}z0.PluginType="GLTFMeshOptPlugin";class xx extends _.aNw{constructor(e){super(e)}load(e,i,s,a){const h=this,d=new _.hH6(this.manager);d.setPath(this.path),d.setResponseType("arraybuffer"),d.setRequestHeader(this.requestHeader),d.setWithCredentials(this.withCredentials),d.load(e,function(b){try{i(h.parse(b))}catch(X){a?a(X):console.error(X),h.manager.itemError(e)}},s,a)}parse(e){function i(h,d,b){for(let X=0,$=h.length;X<$;X++)if(h[X]!==d.getUint8(b+X))return!1;return!0}const s=function(h){if(typeof h=="string"){const d=new Uint8Array(h.length);for(let b=0;b<h.length;b++)d[b]=255&h.charCodeAt(b);return d.buffer||d}return h}(e);return function(h){const d=new DataView(h);if(84+50*d.getUint32(80,!0)===d.byteLength)return!0;const b=[115,111,108,105,100];for(let X=0;X<5;X++)if(i(b,d,X))return!1;return!0}(s)?function(h){const d=new DataView(h),b=d.getUint32(80,!0);let X,$,Z,re,le,he,fe,me,Ee=!1;for(let Pe=0;Pe<70;Pe++)d.getUint32(Pe,!1)==1129270351&&d.getUint8(Pe+4)==82&&d.getUint8(Pe+5)==61&&(Ee=!0,re=new Float32Array(3*b*3),le=d.getUint8(Pe+6)/255,he=d.getUint8(Pe+7)/255,fe=d.getUint8(Pe+8)/255,me=d.getUint8(Pe+9)/255);const Ae=new _.u9r,ye=new Float32Array(3*b*3),ge=new Float32Array(3*b*3);for(let Pe=0;Pe<b;Pe++){const Be=84+50*Pe,Oe=d.getFloat32(Be,!0),Fe=d.getFloat32(Be+4,!0),Xe=d.getFloat32(Be+8,!0);if(Ee){const at=d.getUint16(Be+48,!0);32768&at?(X=le,$=he,Z=fe):(X=(31&at)/31,$=(at>>5&31)/31,Z=(at>>10&31)/31)}for(let at=1;at<=3;at++){const mt=Be+12*at,wt=3*Pe*3+3*(at-1);ye[wt]=d.getFloat32(mt,!0),ye[wt+1]=d.getFloat32(mt+4,!0),ye[wt+2]=d.getFloat32(mt+8,!0),ge[wt]=Oe,ge[wt+1]=Fe,ge[wt+2]=Xe,Ee&&(re[wt]=X,re[wt+1]=$,re[wt+2]=Z)}}return Ae.setAttribute("position",new _.TlE(ye,3)),Ae.setAttribute("normal",new _.TlE(ge,3)),Ee&&(Ae.setAttribute("color",new _.TlE(re,3)),Ae.hasColors=!0,Ae.alpha=me),Ae}(s):function(h){const d=new _.u9r,b=/solid([\s\S]*?)endsolid/g,X=/facet([\s\S]*?)endfacet/g;let $=0;const Z=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,re=new RegExp("vertex"+Z+Z+Z,"g"),le=new RegExp("normal"+Z+Z+Z,"g"),he=[],fe=[],me=new _.Pa4;let Ee,Ae=0,ye=0,ge=0;for(;(Ee=b.exec(h))!==null;){ye=ge;const Pe=Ee[0];for(;(Ee=X.exec(Pe))!==null;){let Fe=0,Xe=0;const at=Ee[0];for(;(Ee=le.exec(at))!==null;)me.x=parseFloat(Ee[1]),me.y=parseFloat(Ee[2]),me.z=parseFloat(Ee[3]),Xe++;for(;(Ee=re.exec(at))!==null;)he.push(parseFloat(Ee[1]),parseFloat(Ee[2]),parseFloat(Ee[3])),fe.push(me.x,me.y,me.z),Fe++,ge++;Xe!==1&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+$),Fe!==3&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+$),$++}const Be=ye,Oe=ge-ye;d.addGroup(Be,Oe,Ae),Ae++}return d.setAttribute("position",new _.a$l(he,3)),d.setAttribute("normal",new _.a$l(fe,3)),d}(typeof(a=e)!="string"?_.Zp0.decodeText(new Uint8Array(a)):a);var a}}class V0 extends oe{constructor(){super(...arguments),this.dependencies=[Kn]}async onAdded(e){this._importer||(this._importer=new _s(xx,["stl"],!0)),yr.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&yr.Importers.splice(yr.Importers.indexOf(this._importer),1),this._importer=void 0}}V0.PluginType="STLLoadPlugin";class tb extends _.aNw{constructor(e){super(e)}load(e,i,s,a){const h=this,d=this.path===""?_.Zp0.extractUrlBase(e):this.path,b=new _.hH6(this.manager);b.setPath(this.path),b.setRequestHeader(this.requestHeader),b.setWithCredentials(this.withCredentials),b.load(e,function(X){try{i(h.parse(X,d))}catch($){a?a($):console.error($),h.manager.itemError(e)}},s,a)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,i){const s=e.split(`
`);let a={};const h=/\s+/,d={};for(let X=0;X<s.length;X++){let $=s[X];if($=$.trim(),$.length===0||$.charAt(0)==="#")continue;const Z=$.indexOf(" ");let re=Z>=0?$.substring(0,Z):$;re=re.toLowerCase();let le=Z>=0?$.substring(Z+1):"";if(le=le.trim(),re==="newmtl")a={name:le},d[le]=a;else if(re==="ka"||re==="kd"||re==="ks"||re==="ke"){const he=le.split(h,3);a[re]=[parseFloat(he[0]),parseFloat(he[1]),parseFloat(he[2])]}else a[re]=le}const b=new nb(this.resourcePath||i,this.materialOptions);return b.setCrossOrigin(this.crossOrigin),b.setManager(this.manager),b.setMaterials(d),b}}class nb{constructor(e="",i={}){this.baseUrl=e,this.options=i,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:_.Wl3,this.wrap=this.options.wrap!==void 0?this.options.wrap:_.rpg}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const i={};for(const s in e){const a=e[s],h={};i[s]=h;for(const d in a){let b=!0,X=a[d];const $=d.toLowerCase();switch($){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(X=[X[0]/255,X[1]/255,X[2]/255]),this.options&&this.options.ignoreZeroRGBs&&X[0]===0&&X[1]===0&&X[2]===0&&(b=!1)}b&&(h[$]=X)}}return i}async preload(){for(const e in this.materialsInfo)await this.create(e)}getIndex(e){return this.nameLookup[e]}async getAsArray(){let e=0;for(const i in this.materialsInfo)this.materialsArray[e]=await this.create(i),this.nameLookup[i]=e,e++;return this.materialsArray}async create(e){return this.materials[e]===void 0&&await this.createMaterial_(e),this.materials[e]}async createMaterial_(e){const i=this,s=this.materialsInfo[e],a={name:e,side:this.side};async function h(X,$){if(a[X])return;const Z=i.getTextureParams($,a);return new Promise((re,le)=>{let he=!1,fe=()=>!he&&(he=!0)&&re();const me=i.loadTexture((Ee=i.baseUrl,typeof(Ae=Z.url)!="string"||Ae===""?"":/^https?:\/\//i.test(Ae)?Ae:Ee+Ae),void 0,ye=>{a[X]=ye,fe()},void 0,fe);var Ee,Ae;setTimeout(fe,50),me.repeat.copy(Z.scale),me.offset.copy(Z.offset),me.wrapS=i.wrap,me.wrapT=i.wrap})}const d=Array.from(Object.keys(s||{}));let b=d.includes("d")||d.includes("D");for(const X of d){const $=s[X];let Z;if($!=="")switch(X.toLowerCase()){case"kd":a.color=new _.Ilk().fromArray($);break;case"ks":a.specular=new _.Ilk().fromArray($);break;case"ke":a.emissive=new _.Ilk().fromArray($);break;case"map_kd":await h("map",$);break;case"map_ks":await h("specularMap",$);break;case"map_ke":await h("emissiveMap",$);break;case"norm":await h("normalMap",$);break;case"map_bump":case"bump":await h("bumpMap",$);break;case"map_d":await h("alphaMap",$),a.transparent=!0;break;case"ns":a.shininess=parseFloat($);break;case"d":Z=parseFloat($),Z<1&&(a.opacity=Z,a.transparent=!0);break;case"tr":if(b)break;Z=parseFloat($),this.options&&this.options.invertTrProperty&&(Z=1-Z),Z>0&&(a.opacity=1-Z,a.transparent=!0)}}return this.materials[e]=new _.xoR(a),this.materials[e]}getTextureParams(e,i){const s={scale:new _.FM8(1,1),offset:new _.FM8(0,0)},a=e.split(/\s+/);let h;return h=a.indexOf("-bm"),h>=0&&(i.bumpScale=parseFloat(a[h+1]),a.splice(h,2)),h=a.indexOf("-s"),h>=0&&(s.scale.set(parseFloat(a[h+1]),parseFloat(a[h+2])),a.splice(h,4)),h=a.indexOf("-o"),h>=0&&(s.offset.set(parseFloat(a[h+1]),parseFloat(a[h+2])),a.splice(h,4)),s.url=a.join(" ").trim(),s}loadTexture(e,i,s,a,h){const d=this.manager!==void 0?this.manager:_.tEQ;let b=d.getHandler(e);b===null&&(b=new _.dpR(d)),b.setCrossOrigin&&b.setCrossOrigin(this.crossOrigin);const X=b.load(e,s,a,h);return i!==void 0&&(X.mapping=i),X}}const Ex=/^[og]\s*(.+)?/,ps=/^mtllib /,Sx=/^usemtl /,zu=/^usemap /,Dh=new _.Pa4,j_=new _.Pa4,pf=new _.Pa4,z_=new _.Pa4,ws=new _.Pa4;function ep(){const c={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,i){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=e,void(this.object.fromDeclaration=i!==!1);const s=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:i!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(a,h){const d=this._finalize(!1);d&&(d.inherited||d.groupCount<=0)&&this.materials.splice(d.index,1);const b={index:this.materials.length,name:a||"",mtllib:Array.isArray(h)&&h.length>0?h[h.length-1]:"",smooth:d!==void 0?d.smooth:this.smooth,groupStart:d!==void 0?d.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(X){const $={index:typeof X=="number"?X:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return $.clone=this.clone.bind($),$}};return this.materials.push(b),b},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(a){const h=this.currentMaterial();if(h&&h.groupEnd===-1&&(h.groupEnd=this.geometry.vertices.length/3,h.groupCount=h.groupEnd-h.groupStart,h.inherited=!1),a&&this.materials.length>1)for(let d=this.materials.length-1;d>=0;d--)this.materials[d].groupCount<=0&&this.materials.splice(d,1);return a&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),h}},s&&s.name&&typeof s.clone=="function"){const a=s.clone(0);a.inherited=!0,this.object.materials.push(a)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,i){const s=parseInt(e,10);return 3*(s>=0?s-1:s+i/3)},parseNormalIndex:function(e,i){const s=parseInt(e,10);return 3*(s>=0?s-1:s+i/3)},parseUVIndex:function(e,i){const s=parseInt(e,10);return 2*(s>=0?s-1:s+i/2)},addVertex:function(e,i,s){const a=this.vertices,h=this.object.geometry.vertices;h.push(a[e+0],a[e+1],a[e+2]),h.push(a[i+0],a[i+1],a[i+2]),h.push(a[s+0],a[s+1],a[s+2])},addVertexPoint:function(e){const i=this.vertices;this.object.geometry.vertices.push(i[e+0],i[e+1],i[e+2])},addVertexLine:function(e){const i=this.vertices;this.object.geometry.vertices.push(i[e+0],i[e+1],i[e+2])},addNormal:function(e,i,s){const a=this.normals,h=this.object.geometry.normals;h.push(a[e+0],a[e+1],a[e+2]),h.push(a[i+0],a[i+1],a[i+2]),h.push(a[s+0],a[s+1],a[s+2])},addFaceNormal:function(e,i,s){const a=this.vertices,h=this.object.geometry.normals;Dh.fromArray(a,e),j_.fromArray(a,i),pf.fromArray(a,s),ws.subVectors(pf,j_),z_.subVectors(Dh,j_),ws.cross(z_),ws.normalize(),h.push(ws.x,ws.y,ws.z),h.push(ws.x,ws.y,ws.z),h.push(ws.x,ws.y,ws.z)},addColor:function(e,i,s){const a=this.colors,h=this.object.geometry.colors;a[e]!==void 0&&h.push(a[e+0],a[e+1],a[e+2]),a[i]!==void 0&&h.push(a[i+0],a[i+1],a[i+2]),a[s]!==void 0&&h.push(a[s+0],a[s+1],a[s+2])},addUV:function(e,i,s){const a=this.uvs,h=this.object.geometry.uvs;h.push(a[e+0],a[e+1]),h.push(a[i+0],a[i+1]),h.push(a[s+0],a[s+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const i=this.uvs;this.object.geometry.uvs.push(i[e+0],i[e+1])},addFace:function(e,i,s,a,h,d,b,X,$){const Z=this.vertices.length;let re=this.parseVertexIndex(e,Z),le=this.parseVertexIndex(i,Z),he=this.parseVertexIndex(s,Z);if(this.addVertex(re,le,he),this.addColor(re,le,he),b!==void 0&&b!==""){const fe=this.normals.length;re=this.parseNormalIndex(b,fe),le=this.parseNormalIndex(X,fe),he=this.parseNormalIndex($,fe),this.addNormal(re,le,he)}else this.addFaceNormal(re,le,he);if(a!==void 0&&a!==""){const fe=this.uvs.length;re=this.parseUVIndex(a,fe),le=this.parseUVIndex(h,fe),he=this.parseUVIndex(d,fe),this.addUV(re,le,he),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const i=this.vertices.length;for(let s=0,a=e.length;s<a;s++){const h=this.parseVertexIndex(e[s],i);this.addVertexPoint(h),this.addColor(h)}},addLineGeometry:function(e,i){this.object.geometry.type="Line";const s=this.vertices.length,a=this.uvs.length;for(let h=0,d=e.length;h<d;h++)this.addVertexLine(this.parseVertexIndex(e[h],s));for(let h=0,d=i.length;h<d;h++)this.addUVLine(this.parseUVIndex(i[h],a))}};return c.startObject("",!1),c}class V_ extends _.aNw{constructor(e){super(e),this.materials=null}load(e,i,s,a){const h=this,d=new _.hH6(this.manager);d.setPath(this.path),d.setRequestHeader(this.requestHeader),d.setWithCredentials(this.withCredentials),d.load(e,async function(b){try{i(await h.parse(b))}catch(X){a?a(X):console.error(X),h.manager.itemError(e)}},s,a)}setMaterials(e){return this.materials=e,this}async parse(e){const i=new ep;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const s=e.split(`
`);let a="",h="",d=0,b=[];const X=typeof"".trimLeft=="function";for(let Z=0,re=s.length;Z<re;Z++)if(a=s[Z],a=X?a.trimLeft():a.trim(),d=a.length,d!==0&&(h=a.charAt(0),h!=="#"))if(h==="v"){const le=a.split(/\s+/);switch(le[0]){case"v":i.vertices.push(parseFloat(le[1]),parseFloat(le[2]),parseFloat(le[3])),le.length>=7?i.colors.push(parseFloat(le[4]),parseFloat(le[5]),parseFloat(le[6])):i.colors.push(void 0,void 0,void 0);break;case"vn":i.normals.push(parseFloat(le[1]),parseFloat(le[2]),parseFloat(le[3]));break;case"vt":i.uvs.push(parseFloat(le[1]),parseFloat(le[2]))}}else if(h==="f"){const le=a.substr(1).trim().split(/\s+/),he=[];for(let me=0,Ee=le.length;me<Ee;me++){const Ae=le[me];if(Ae.length>0){const ye=Ae.split("/");he.push(ye)}}const fe=he[0];for(let me=1,Ee=he.length-1;me<Ee;me++){const Ae=he[me],ye=he[me+1];i.addFace(fe[0],Ae[0],ye[0],fe[1],Ae[1],ye[1],fe[2],Ae[2],ye[2])}}else if(h==="l"){const le=a.substring(1).trim().split(" ");let he=[];const fe=[];if(a.indexOf("/")===-1)he=le;else for(let me=0,Ee=le.length;me<Ee;me++){const Ae=le[me].split("/");Ae[0]!==""&&he.push(Ae[0]),Ae[1]!==""&&fe.push(Ae[1])}i.addLineGeometry(he,fe)}else if(h==="p"){const le=a.substr(1).trim().split(" ");i.addPointGeometry(le)}else if((b=Ex.exec(a))!==null){const le=(" "+b[0].substr(1).trim()).substr(1);i.startObject(le)}else if(Sx.test(a))i.object.startMaterial(a.substring(7).trim(),i.materialLibraries);else if(ps.test(a)){i.materialLibraries.push(a.substring(7).trim());const le=a.substring(7).trim(),he=this.manager.getHandler(le);if(he){const fe=await he.loadAsync(le).catch(me=>{console.warn(me)});fe&&this.setMaterials(fe)}else console.warn("OBJLoader2: Set MTLLoader to loading manager to load materials.")}else if(zu.test(a))console.warn('OBJLoader2: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(h==="s"){if(b=a.split(" "),b.length>1){const he=b[1].trim().toLowerCase();i.object.smooth=he!=="0"&&he!=="off"}else i.object.smooth=!0;const le=i.object.currentMaterial();le&&(le.smooth=i.object.smooth)}else{if(a==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+a+'"')}i.finalize();const $=new _.ZAu;if($.materialLibraries=[].concat(i.materialLibraries),!(i.objects.length===1&&i.objects[0].geometry.vertices.length===0))for(let Z=0,re=i.objects.length;Z<re;Z++){const le=i.objects[Z],he=le.geometry,fe=le.materials,me=he.type==="Line",Ee=he.type==="Points";let Ae=!1;if(he.vertices.length===0)continue;const ye=new _.u9r;ye.setAttribute("position",new _.a$l(he.vertices,3)),he.normals.length>0&&ye.setAttribute("normal",new _.a$l(he.normals,3)),he.colors.length>0&&(Ae=!0,ye.setAttribute("color",new _.a$l(he.colors,3))),he.hasUVIndices===!0&&ye.setAttribute("uv",new _.a$l(he.uvs,2));const ge=[];for(let Be=0,Oe=fe.length;Be<Oe;Be++){const Fe=fe[Be],Xe=Fe.name+"_"+Fe.smooth+"_"+Ae;let at=i.materials[Xe];if(this.materials!==null)if(at=await this.materials.create(Fe.name),!me||!at||at instanceof _.nls){if(Ee&&at&&!(at instanceof _.UY4)){const mt=new _.UY4({size:10,sizeAttenuation:!1});_.F5T.prototype.copy.call(mt,at),mt.color.copy(at.color),mt.map=at.map,at=mt}}else{const mt=new _.nls;_.F5T.prototype.copy.call(mt,at),mt.color.copy(at.color),at=mt}at===void 0&&(at=me?new _.nls:Ee?new _.UY4({size:1,sizeAttenuation:!1}):new _.xoR,at.name=Fe.name,at.flatShading=!Fe.smooth,at.vertexColors=Ae,i.materials[Xe]=at),ge.push(at)}let Pe;if(ge.length>1){for(let Be=0,Oe=fe.length;Be<Oe;Be++){const Fe=fe[Be];ye.addGroup(Fe.groupStart,Fe.groupCount,Be)}Pe=me?new _.ejS(ye,ge):Ee?new _.woe(ye,ge):new _.Kj0(ye,ge)}else Pe=me?new _.ejS(ye,ge[0]):Ee?new _.woe(ye,ge[0]):new _.Kj0(ye,ge[0]);Pe.name=le.name,$.add(Pe)}else if(i.vertices.length>0){const Z=new _.UY4({size:1,sizeAttenuation:!1}),re=new _.u9r;re.setAttribute("position",new _.a$l(i.vertices,3)),i.colors.length>0&&i.colors[0]!==void 0&&(re.setAttribute("color",new _.a$l(i.colors,3)),Z.vertexColors=!0);const le=new _.woe(re,Z);$.add(le)}return $}}class Bl extends oe{constructor(){super(...arguments),this.dependencies=[Kn],this._importer1=new _s(V_,["obj"],!0),this._importer2=new _s(tb,["mtl"],!1)}async onAdded(e){yr.Importers.push(this._importer1),yr.Importers.push(this._importer2)}async onDispose(e){}async onRemove(e){yr.Importers.splice(yr.Importers.indexOf(this._importer1),1),yr.Importers.splice(yr.Importers.indexOf(this._importer2),1)}}Bl.PluginType="ObjMtlLoadPlugin";class mc extends _.DqL{constructor(e){super(e)}parse(e,i){const s=new ib(e,1);return{mipmaps:s.mipmaps(i),width:s.pixelWidth,height:s.pixelHeight,format:s.glInternalFormat,isCubemap:s.numberOfFaces===6,mipmapCount:s.numberOfMipmapLevels}}}class ib{constructor(e,i){this.arrayBuffer=e;const s=new Uint8Array(this.arrayBuffer,0,12);if(s[0]!==171||s[1]!==75||s[2]!==84||s[3]!==88||s[4]!==32||s[5]!==49||s[6]!==49||s[7]!==187||s[8]!==13||s[9]!==10||s[10]!==26||s[11]!==10)return void console.error("texture missing KTX identifier");const a=Uint32Array.BYTES_PER_ELEMENT,h=new DataView(this.arrayBuffer,12,13*a),d=h.getUint32(0,!0)===67305985;this.glType=h.getUint32(1*a,d),this.glTypeSize=h.getUint32(2*a,d),this.glFormat=h.getUint32(3*a,d),this.glInternalFormat=h.getUint32(4*a,d),this.glBaseInternalFormat=h.getUint32(5*a,d),this.pixelWidth=h.getUint32(6*a,d),this.pixelHeight=h.getUint32(7*a,d),this.pixelDepth=h.getUint32(8*a,d),this.numberOfArrayElements=h.getUint32(9*a,d),this.numberOfFaces=h.getUint32(10*a,d),this.numberOfMipmapLevels=h.getUint32(11*a,d),this.bytesOfKeyValueData=h.getUint32(12*a,d),this.glType===0?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),this.pixelHeight!==0&&this.pixelDepth===0?this.numberOfArrayElements===0?this.numberOfFaces===i?this.loadType=0:console.warn("number of faces expected"+i+", but found "+this.numberOfFaces):console.warn("texture arrays not currently supported"):console.warn("only 2D textures currently supported")):console.warn("only compressed formats currently supported")}mipmaps(e){const i=[];let s=64+this.bytesOfKeyValueData,a=this.pixelWidth,h=this.pixelHeight;const d=e?this.numberOfMipmapLevels:1;for(let b=0;b<d;b++){const X=new Int32Array(this.arrayBuffer,s,1)[0];s+=4;for(let $=0;$<this.numberOfFaces;$++){const Z=new Uint8Array(this.arrayBuffer,s,X);i.push({data:Z,width:a,height:h}),s+=X,s+=3-(X+3)%4}a=Math.max(1,.5*a),h=Math.max(1,.5*h)}return i}}class Xo extends oe{constructor(){super(...arguments),this.dependencies=[Kn]}async onAdded(e){this._importer||(this._importer=new _s(mc,["ktx"],!1)),yr.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&yr.Importers.splice(yr.Importers.indexOf(this._importer),1),this._importer=void 0}}Xo.PluginType="KTXLoadPlugin";class Fm extends _.hH6{constructor(e){super(e),this.responseType="blob"}}class rb extends _.hH6{constructor(e){super(e),this.responseType="blob"}load(e,i,s,a){return super.load(e,h=>{try{i==null||i(Pa(h))}catch(d){a==null||a(d)}},s,a)}}class G0{async parseAsync(e,i){var s;return new Blob([JSON.stringify(e,null,(s=i.jsonSpaces)!==null&&s!==void 0?s:2)],{type:"application/json"})}}class yE{async parseAsync(e,i){return new Blob([e],{type:"text/plain"})}}class sb{constructor(){this.pluginCallbacks=[],this.register(function(e){return new rT(e)}),this.register(function(e){return new sT(e)}),this.register(function(e){return new oT(e)}),this.register(function(e){return new cT(e)}),this.register(function(e){return new uT(e)}),this.register(function(e){return new aT(e)}),this.register(function(e){return new hT(e)}),this.register(function(e){return new lT(e)}),this.register(function(e){return new dT(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,i,s,a,h){const d=h||new EE,b=[];for(let X=0,$=this.pluginCallbacks.length;X<$;X++)b.push(this.pluginCallbacks[X](d));d.setPlugins(b),d.write(e,i,a).catch(s)}parseAsync(e,i){const s=this;return new Promise(function(a,h){s.parse(e,a,h,i)})}}const Cx=5121,Mx=5123,gc={};gc[_.TyD]=9728,gc[_.YLQ]=9984,gc[_.aH4]=9986,gc[_.wem]=9729,gc[_.qyh]=9985,gc[_.D1R]=9987,gc[_.uWy]=33071,gc[_.rpg]=10497,gc[_.OoA]=33648;const bE={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"};function Q0(c,e){return c.length===e.length&&c.every(function(i,s){return i===e[s]})}function wE(c){return 4*Math.ceil(c/4)}function Tx(c,e=0){const i=wE(c.byteLength);if(i!==c.byteLength){const s=new Uint8Array(i);if(s.set(new Uint8Array(c)),e!==0)for(let a=c.byteLength;a<i;a++)s[a]=e;return s.buffer}return c}function xE(c,e){if(c.toBlob!==void 0)return new Promise(s=>c.toBlob(s,e));let i;return e==="image/jpeg"?i=.92:e==="image/webp"&&(i=.8),c.convertToBlob({type:e,quality:i})}class EE{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,i,s){this.options=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},s),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const a=this,h=a.buffers,d=a.json;s=a.options;const b=a.extensionsUsed,X=new Blob(h,{type:"application/octet-stream"}),$=Object.keys(b);if($.length>0&&(d.extensionsUsed=$),d.buffers&&d.buffers.length>0&&(d.buffers[0].byteLength=X.size),s.binary===!0){const Z=new FileReader;Z.readAsArrayBuffer(X),Z.onloadend=function(){const re=Tx(Z.result),le=new DataView(new ArrayBuffer(8));le.setUint32(0,re.byteLength,!0),le.setUint32(4,5130562,!0);const he=Tx((fe=JSON.stringify(d),new TextEncoder().encode(fe).buffer),32);var fe;const me=new DataView(new ArrayBuffer(8));me.setUint32(0,he.byteLength,!0),me.setUint32(4,1313821514,!0);const Ee=new ArrayBuffer(12),Ae=new DataView(Ee);Ae.setUint32(0,1179937895,!0),Ae.setUint32(4,2,!0);const ye=12+me.byteLength+he.byteLength+le.byteLength+re.byteLength;Ae.setUint32(8,ye,!0);const ge=new Blob([Ee,me,he,le,re],{type:"application/octet-stream"}),Pe=new FileReader;Pe.readAsArrayBuffer(ge),Pe.onloadend=function(){i(Pe.result)}}}else if(d.buffers&&d.buffers.length>0){const Z=new FileReader;Z.readAsDataURL(X),Z.onloadend=function(){const re=Z.result;d.buffers[0].uri=re,i(d)}}else i(d)}serializeUserData(e,i){if(Object.keys(e.userData).length===0)return;const s=this.options,a=this.extensionsUsed;try{const h=JSON.parse(JSON.stringify(e.userData));if(s.includeCustomExtensions&&h.gltfExtensions){i.extensions===void 0&&(i.extensions={});for(const d in h.gltfExtensions)i.extensions[d]=h.gltfExtensions[d],a[d]=!0;delete h.gltfExtensions}Object.keys(h).length>0&&(i.extras=h)}catch(h){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+h.message),console.warn({...e.userData})}}getUID(e,i=!1){if(this.uids.has(e)===!1){const s=new Map;s.set(!0,this.uid++),s.set(!1,this.uid++),this.uids.set(e,s)}return this.uids.get(e).get(i)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const i=new _.Pa4;for(let s=0,a=e.count;s<a;s++)if(Math.abs(i.fromBufferAttribute(e,s).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const i=this.cache;if(i.attributesNormalized.has(e))return i.attributesNormalized.get(e);const s=e.clone(),a=new _.Pa4;for(let h=0,d=s.count;h<d;h++)a.fromBufferAttribute(s,h),a.x===0&&a.y===0&&a.z===0?a.setX(1):a.normalize(),s.setXYZ(h,a.x,a.y,a.z);return i.attributesNormalized.set(e,s),s}applyTextureTransform(e,i){let s=!1;const a={};i.offset.x===0&&i.offset.y===0||(a.offset=i.offset.toArray(),s=!0),i.rotation!==0&&(a.rotation=i.rotation,s=!0),i.repeat.x===1&&i.repeat.y===1||(a.scale=i.repeat.toArray(),s=!0),s&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=a,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,i){if(e===i)return e;function s(le){return le.encoding===_.knz?function(he){return he<.04045?.0773993808*he:Math.pow(.9478672986*he+.0521327014,2.4)}:function(he){return he}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures.");const a=e?e.image:void 0,h=i?i.image:void 0,d=Math.max(a?a.width:0,h?h.width:0),b=Math.max(a?a.height:0,h?h.height:0),X=document.createElement("canvas");X.width=d,X.height=b;const $=X.getContext("2d");$.fillStyle="#00ffff",$.fillRect(0,0,d,b);const Z=$.getImageData(0,0,d,b);if(a){$.drawImage(a,0,0,d,b);const le=s(e),he=$.getImageData(0,0,d,b).data;for(let fe=2;fe<he.length;fe+=4)Z.data[fe]=256*le(he[fe]/256)}if(h){$.drawImage(h,0,0,d,b);const le=s(i),he=$.getImageData(0,0,d,b).data;for(let fe=1;fe<he.length;fe+=4)Z.data[fe]=256*le(he[fe]/256)}$.putImageData(Z,0,0);const re=(e||i).clone();return re.source=new _.Hw6(X),re.encoding=_.rnI,re}processBuffer(e){const i=this.json,s=this.buffers;return i.buffers||(i.buffers=[{byteLength:0}]),s.push(e),0}processBufferView(e,i,s,a,h){const d=this.json;let b;d.bufferViews||(d.bufferViews=[]),b=i===Cx?1:i===Mx?2:4;const X=wE(a*e.itemSize*b),$=new DataView(new ArrayBuffer(X));let Z=0;for(let le=s;le<s+a;le++)for(let he=0;he<e.itemSize;he++){let fe;e.itemSize>4?fe=e.array[le*e.itemSize+he]:he===0?fe=e.getX(le):he===1?fe=e.getY(le):he===2?fe=e.getZ(le):he===3&&(fe=e.getW(le)),i===5126?$.setFloat32(Z,fe,!0):i===5125?$.setUint32(Z,fe,!0):i===Mx?$.setUint16(Z,fe,!0):i===Cx&&$.setUint8(Z,fe),Z+=b}const re={buffer:this.processBuffer($.buffer),byteOffset:this.byteOffset,byteLength:X};return h!==void 0&&(re.target=h),h===34962&&(re.byteStride=e.itemSize*b),this.byteOffset+=X,d.bufferViews.push(re),{id:d.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const i=this,s=i.json;return s.bufferViews||(s.bufferViews=[]),new Promise(function(a){const h=new FileReader;h.readAsArrayBuffer(e),h.onloadend=function(){const d=Tx(h.result),b={buffer:i.processBuffer(d),byteOffset:i.byteOffset,byteLength:d.byteLength};i.byteOffset+=d.byteLength,a(s.bufferViews.push(b)-1)}})}processAccessor(e,i,s,a){const h=this.options,d=this.json;let b;if(e.array.constructor===Float32Array)b=5126;else if(e.array.constructor===Uint32Array)b=5125;else if(e.array.constructor===Uint16Array)b=Mx;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");b=Cx}if(s===void 0&&(s=0),a===void 0&&(a=e.count),h.truncateDrawRange&&i!==void 0&&i.index===null){const le=s+a,he=i.drawRange.count===1/0?e.count:i.drawRange.start+i.drawRange.count;s=Math.max(s,i.drawRange.start),a=Math.min(le,he)-s,a<0&&(a=0)}if(a===0)return null;const X=function(le,he,fe){const me={min:new Array(le.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(le.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let Ee=he;Ee<he+fe;Ee++)for(let Ae=0;Ae<le.itemSize;Ae++){let ye;le.itemSize>4?ye=le.array[Ee*le.itemSize+Ae]:Ae===0?ye=le.getX(Ee):Ae===1?ye=le.getY(Ee):Ae===2?ye=le.getZ(Ee):Ae===3&&(ye=le.getW(Ee)),me.min[Ae]=Math.min(me.min[Ae],ye),me.max[Ae]=Math.max(me.max[Ae],ye)}return me}(e,s,a);let $;i!==void 0&&($=e===i.index?34963:34962);const Z=this.processBufferView(e,b,s,a,$),re={bufferView:Z.id,byteOffset:Z.byteOffset,componentType:b,count:a,max:X.max,min:X.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[e.itemSize]};return d.accessors||(d.accessors=[]),d.accessors.push(re)-1}processImage(e,i,s,a="image/png"){const h=this,d=h.cache,b=h.json,X=h.options,$=h.pending;d.images.has(e)||d.images.set(e,{});const Z=d.images.get(e),re=a+":flipY/"+s.toString();if(Z[re]!==void 0)return Z[re];b.images||(b.images=[]);const le={mimeType:a},he=typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas");he.width=Math.min(e.width,X.maxTextureSize),he.height=Math.min(e.height,X.maxTextureSize);const fe=he.getContext("2d");if(s===!0&&(fe.translate(0,he.height),fe.scale(1,-1)),e.data!==void 0){i!==_.wk1&&console.error("GLTFExporter: Only RGBAFormat is supported."),(e.width>X.maxTextureSize||e.height>X.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const Ee=new Uint8ClampedArray(e.height*e.width*4);for(let Ae=0;Ae<Ee.length;Ae+=4)Ee[Ae+0]=e.data[Ae+0],Ee[Ae+1]=e.data[Ae+1],Ee[Ae+2]=e.data[Ae+2],Ee[Ae+3]=e.data[Ae+3];fe.putImageData(new ImageData(Ee,e.width,e.height),0,0)}else fe.drawImage(e,0,0,he.width,he.height);X.binary===!0?$.push(xE(he,a).then(Ee=>h.processBufferViewImage(Ee)).then(Ee=>{le.bufferView=Ee})):he.toDataURL!==void 0?le.uri=he.toDataURL(a):$.push(xE(he,a).then(Ee=>new FileReader().readAsDataURL(Ee)).then(Ee=>{le.uri=Ee}));const me=b.images.push(le)-1;return Z[re]=me,me}processSampler(e){const i=this.json;i.samplers||(i.samplers=[]);const s={magFilter:gc[e.magFilter],minFilter:gc[e.minFilter],wrapS:gc[e.wrapS],wrapT:gc[e.wrapT]};return i.samplers.push(s)-1}processTexture(e){const i=this.cache,s=this.json;if(i.textures.has(e))return i.textures.get(e);s.textures||(s.textures=[]);let a=e.userData.mimeType;a==="image/webp"&&(a="image/png"),a==="image/jpg"&&(a="image/jpeg");const h=["image/jpeg","image/png"];a&&!h.includes(a)&&console.error("GLTFExporter: Unsupported mime type: "+a+". Cannot export texture.",e);const d={sampler:this.processSampler(e),source:!a||h.includes(a)?this.processImage(e.image,e.format,e.flipY,a):null};e.name&&(d.name=e.name),this._invokeAll(function(X){X.writeTexture&&X.writeTexture(e,d)});const b=s.textures.push(d)-1;return i.textures.set(e,b),b}processMaterial(e){const i=this.cache,s=this.json;if(i.materials.has(e))return i.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;s.materials||(s.materials=[]);const a={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const h=e.color.toArray().concat([e.opacity]);if(Q0(h,[1,1,1,1])||(a.pbrMetallicRoughness.baseColorFactor=h),e.isMeshStandardMaterial?(a.pbrMetallicRoughness.metallicFactor=e.metalness,a.pbrMetallicRoughness.roughnessFactor=e.roughness):(a.pbrMetallicRoughness.metallicFactor=.5,a.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const b=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),X={index:this.processTexture(b)};this.applyTextureTransform(X,b),a.pbrMetallicRoughness.metallicRoughnessTexture=X}if(e.map){const b={index:this.processTexture(e.map)};this.applyTextureTransform(b,e.map),a.pbrMetallicRoughness.baseColorTexture=b}if(e.emissive){const b=e.emissive.clone().multiplyScalar(e.emissiveIntensity),X=Math.max(b.r,b.g,b.b);if(X>1&&(b.multiplyScalar(1/X),console.warn("THREE.GLTFExporter: Some emissive components exceed 1; emissive has been limited")),X>0&&(a.emissiveFactor=b.toArray()),e.emissiveMap){const $={index:this.processTexture(e.emissiveMap)};this.applyTextureTransform($,e.emissiveMap),a.emissiveTexture=$}}if(e.normalMap){const b={index:this.processTexture(e.normalMap)};e.normalScale&&e.normalScale.x!==1&&(b.scale=e.normalScale.x),this.applyTextureTransform(b,e.normalMap),a.normalTexture=b}if(e.aoMap){const b={index:this.processTexture(e.aoMap),texCoord:1};e.aoMapIntensity!==1&&(b.strength=e.aoMapIntensity),this.applyTextureTransform(b,e.aoMap),a.occlusionTexture=b}e.transparent?a.alphaMode="BLEND":e.alphaTest>0&&(a.alphaMode="MASK",a.alphaCutoff=e.alphaTest),e.side===_.ehD&&(a.doubleSided=!0),e.name!==""&&(a.name=e.name),this.serializeUserData(e,a),this._invokeAll(function(b){b.writeMaterial&&b.writeMaterial(e,a)});const d=s.materials.push(a)-1;return i.materials.set(e,d),d}processMesh(e){const i=this.cache,s=this.json,a=[e.geometry.uuid];if(Array.isArray(e.material))for(let ge=0,Pe=e.material.length;ge<Pe;ge++)a.push(e.material[ge].uuid);else a.push(e.material.uuid);const h=a.join(":");if(i.meshes.has(h))return i.meshes.get(h);const d=e.geometry;let b;b=e.isLineSegments?1:e.isLineLoop?2:e.isLine?3:e.isPoints?0:e.material.wireframe?1:4;const X={},$={},Z=[],re=[],le={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},he=d.getAttribute("normal");he===void 0||this.isNormalizedNormalAttribute(he)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),d.setAttribute("normal",this.createNormalizedNormalAttribute(he)));let fe=null;for(let ge in d.attributes){if(ge.slice(0,5)==="morph")continue;const Pe=d.attributes[ge];if(ge=le[ge]||ge.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(ge)||(ge="_"+ge),i.attributes.has(this.getUID(Pe))){$[ge]=i.attributes.get(this.getUID(Pe));continue}fe=null;const Be=Pe.array;ge!=="JOINTS_0"||Be instanceof Uint16Array||Be instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),fe=new _.TlE(new Uint16Array(Be),Pe.itemSize,Pe.normalized));const Oe=this.processAccessor(fe||Pe,d);Oe!==null&&($[ge]=Oe,i.attributes.set(this.getUID(Pe),Oe))}if(he!==void 0&&d.setAttribute("normal",he),Object.keys($).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const ge=[],Pe=[],Be={};if(e.morphTargetDictionary!==void 0)for(const Oe in e.morphTargetDictionary)Be[e.morphTargetDictionary[Oe]]=Oe;for(let Oe=0;Oe<e.morphTargetInfluences.length;++Oe){const Fe={};let Xe=!1;for(const at in d.morphAttributes){if(at!=="position"&&at!=="normal"){Xe||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),Xe=!0);continue}const mt=d.morphAttributes[at][Oe],wt=at.toUpperCase(),At=d.attributes[at];if(i.attributes.has(this.getUID(mt,!0))){Fe[wt]=i.attributes.get(this.getUID(mt,!0));continue}const Tt=mt.clone();if(!d.morphTargetsRelative)for(let yt=0,St=mt.count;yt<St;yt++)Tt.setXYZ(yt,mt.getX(yt)-At.getX(yt),mt.getY(yt)-At.getY(yt),mt.getZ(yt)-At.getZ(yt));Fe[wt]=this.processAccessor(Tt,d),i.attributes.set(this.getUID(At,!0),Fe[wt])}re.push(Fe),ge.push(e.morphTargetInfluences[Oe]),e.morphTargetDictionary!==void 0&&Pe.push(Be[Oe])}X.weights=ge,Pe.length>0&&(X.extras={},X.extras.targetNames=Pe)}const me=Array.isArray(e.material);if(me&&d.groups.length===0)return null;const Ee=me?e.material:[e.material],Ae=me?d.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let ge=0,Pe=Ae.length;ge<Pe;ge++){const Be={mode:b,attributes:$};if(this.serializeUserData(d,Be),re.length>0&&(Be.targets=re),d.index!==null){let Fe=this.getUID(d.index);Ae[ge].start===void 0&&Ae[ge].count===void 0||(Fe+=":"+Ae[ge].start+":"+Ae[ge].count),i.attributes.has(Fe)?Be.indices=i.attributes.get(Fe):(Be.indices=this.processAccessor(d.index,d,Ae[ge].start,Ae[ge].count),i.attributes.set(Fe,Be.indices)),Be.indices===null&&delete Be.indices}const Oe=this.processMaterial(Ee[Ae[ge].materialIndex]);Oe!==null&&(Be.material=Oe),Z.push(Be)}X.primitives=Z,s.meshes||(s.meshes=[]),this._invokeAll(function(ge){ge.writeMesh&&ge.writeMesh(e,X)});const ye=s.meshes.push(X)-1;return i.meshes.set(h,ye),ye}processCamera(e){const i=this.json;i.cameras||(i.cameras=[]);const s=e.isOrthographicCamera,a={type:s?"orthographic":"perspective"};return s?a.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:a.perspective={aspectRatio:e.aspect,yfov:_.M8C.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(a.name=e.type),i.cameras.push(a)-1}processAnimation(e,i){const s=this.json,a=this.nodeMap;s.animations||(s.animations=[]);const h=(e=sb.Utils.mergeMorphTargetTracks(e.clone(),i)).tracks,d=[],b=[];for(let X=0;X<h.length;++X){const $=h[X],Z=_.iUV.parseTrackName($.name);let re=_.iUV.findNode(i,Z.nodeName);const le=bE[Z.propertyName];if(Z.objectName==="bones"&&(re=re.isSkinnedMesh===!0?re.skeleton.getBoneByName(Z.objectIndex):void 0),!re||!le)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',$.name),null;const he=1;let fe,me=$.values.length/$.times.length;le===bE.morphTargetInfluences&&(me/=re.morphTargetInfluences.length),$.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(fe="CUBICSPLINE",me/=3):fe=$.getInterpolation()===_.Syv?"STEP":"LINEAR",b.push({input:this.processAccessor(new _.TlE($.times,he)),output:this.processAccessor(new _.TlE($.values,me)),interpolation:fe}),d.push({sampler:b.length-1,target:{node:a.get(re),path:le}})}return s.animations.push({name:e.name||"clip_"+s.animations.length,samplers:b,channels:d}),s.animations.length-1}processSkin(e){const i=this.json,s=this.nodeMap,a=i.nodes[s.get(e)],h=e.skeleton;if(h===void 0)return null;const d=e.skeleton.bones[0];if(d===void 0)return null;const b=[],X=new Float32Array(16*h.bones.length),$=new _.yGw;for(let Z=0;Z<h.bones.length;++Z)b.push(s.get(h.bones[Z])),$.copy(h.boneInverses[Z]),$.multiply(e.bindMatrix).toArray(X,16*Z);return i.skins===void 0&&(i.skins=[]),i.skins.push({inverseBindMatrices:this.processAccessor(new _.TlE(X,16)),joints:b,skeleton:s.get(d)}),a.skin=i.skins.length-1}processNode(e){const i=this.json,s=this.options,a=this.nodeMap;i.nodes||(i.nodes=[]);const h={};if(s.trs){const b=e.quaternion.toArray(),X=e.position.toArray(),$=e.scale.toArray();Q0(b,[0,0,0,1])||(h.rotation=b),Q0(X,[0,0,0])||(h.translation=X),Q0($,[1,1,1])||(h.scale=$)}else e.matrixAutoUpdate&&e.updateMatrix(),Q0(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])===!1&&(h.matrix=e.matrix.elements);if(e.name!==""&&(h.name=String(e.name)),this.serializeUserData(e,h),e.isMesh||e.isLine||e.isPoints){const b=this.processMesh(e);b!==null&&(h.mesh=b)}else e.isCamera&&(h.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const b=[];for(let X=0,$=e.children.length;X<$;X++){const Z=e.children[X];if(Z.visible||s.onlyVisible===!1){const re=this.processNode(Z);re!==null&&b.push(re)}}b.length>0&&(h.children=b)}this._invokeAll(function(b){b.writeNode&&b.writeNode(e,h)});const d=i.nodes.push(h)-1;return a.set(e,d),d}processScene(e){const i=this.json,s=this.options;i.scenes||(i.scenes=[],i.scene=0);const a={};e.name!==""&&(a.name=e.name),i.scenes.push(a);const h=[];for(let d=0,b=e.children.length;d<b;d++){const X=e.children[d];if(X.visible||s.onlyVisible===!1){const $=this.processNode(X);$!==null&&h.push($)}}h.length>0&&(a.nodes=h),this.serializeUserData(e,a)}processObjects(e){const i=new _.xsS;i.name="AuxScene";for(let s=0;s<e.length;s++)i.children.push(e[s]);this.processScene(i)}processInput(e){const i=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(a){a.beforeParse&&a.beforeParse(e)});const s=[];for(let a=0;a<e.length;a++)e[a]instanceof _.xsS?this.processScene(e[a]):s.push(e[a]);s.length>0&&this.processObjects(s);for(let a=0;a<this.skins.length;++a)this.processSkin(this.skins[a]);for(let a=0;a<i.animations.length;++a)this.processAnimation(i.animations[a],e[0]);this._invokeAll(function(a){a.afterParse&&a.afterParse(e)})}_invokeAll(e){for(let i=0,s=this.plugins.length;i<s;i++)e(this.plugins[i])}}class rT{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,i){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);const s=this.writer,a=s.json,h=s.extensionsUsed,d={};e.name&&(d.name=e.name),d.color=e.color.toArray(),d.intensity=e.intensity,e.isDirectionalLight?d.type="directional":e.isPointLight?(d.type="point",e.distance>0&&(d.range=e.distance)):e.isSpotLight&&(d.type="spot",e.distance>0&&(d.range=e.distance),d.spot={},d.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,d.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&e.target.position.x===0&&e.target.position.y===0&&e.target.position.z===-1||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),h[this.name]||(a.extensions=a.extensions||{},a.extensions[this.name]={lights:[]},h[this.name]=!0);const b=a.extensions[this.name].lights;b.push(d),i.extensions=i.extensions||{},i.extensions[this.name]={light:b.length-1}}}class sT{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,i){if(!e.isMeshBasicMaterial)return;const s=this.writer.extensionsUsed;i.extensions=i.extensions||{},i.extensions[this.name]={},s[this.name]=!0,i.pbrMetallicRoughness.metallicFactor=0,i.pbrMetallicRoughness.roughnessFactor=.9}}class oT{constructor(e){this.writer=e,this.name="KHR_materials_pbrSpecularGlossiness"}writeMaterial(e,i){if(!e.isGLTFSpecularGlossinessMaterial)return;const s=this.writer,a=s.extensionsUsed,h={};i.pbrMetallicRoughness.baseColorFactor&&(h.diffuseFactor=i.pbrMetallicRoughness.baseColorFactor);const d=[1,1,1];if(e.specular.toArray(d,0),h.specularFactor=d,h.glossinessFactor=e.glossiness,i.pbrMetallicRoughness.baseColorTexture&&(h.diffuseTexture=i.pbrMetallicRoughness.baseColorTexture),e.specularMap){const b={index:s.processTexture(e.specularMap)};s.applyTextureTransform(b,e.specularMap),h.specularGlossinessTexture=b}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class aT{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.clearcoatFactor=e.clearcoat,e.clearcoatMap){const d={index:s.processTexture(e.clearcoatMap)};s.applyTextureTransform(d,e.clearcoatMap),h.clearcoatTexture=d}if(h.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const d={index:s.processTexture(e.clearcoatRoughnessMap)};s.applyTextureTransform(d,e.clearcoatRoughnessMap),h.clearcoatRoughnessTexture=d}if(e.clearcoatNormalMap){const d={index:s.processTexture(e.clearcoatNormalMap)};s.applyTextureTransform(d,e.clearcoatNormalMap),h.clearcoatNormalTexture=d}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class lT{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.iridescenceFactor=e.iridescence,e.iridescenceMap){const d={index:s.processTexture(e.iridescenceMap)};s.applyTextureTransform(d,e.iridescenceMap),h.iridescenceTexture=d}if(h.iridescenceIor=e.iridescenceIOR,h.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],h.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const d={index:s.processTexture(e.iridescenceThicknessMap)};s.applyTextureTransform(d,e.iridescenceThicknessMap),h.iridescenceThicknessTexture=d}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class cT{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.transmissionFactor=e.transmission,e.transmissionMap){const d={index:s.processTexture(e.transmissionMap)};s.applyTextureTransform(d,e.transmissionMap),h.transmissionTexture=d}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class uT{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.thicknessFactor=e.thickness,e.thicknessMap){const d={index:s.processTexture(e.thicknessMap)};s.applyTextureTransform(d,e.thicknessMap),h.thicknessTexture=d}h.attenuationDistance=e.attenuationDistance,h.attenuationColor=e.attenuationColor.toArray(),i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class hT{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.sheen<.01)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.sheenColorFactor=e.sheenColor.toArray(),e.sheenColorMap){const d={index:s.processTexture(e.sheenColorMap)};s.applyTextureTransform(d,e.sheenColorMap),h.sheenColorTexture=d}if(h.sheenRoughnessFactor=e.sheenRoughness,e.sheenRoughnessMap){const d={index:s.processTexture(e.sheenRoughnessMap)};s.applyTextureTransform(d,e.sheenRoughnessMap),h.sheenRoughnessTexture=d}i.extensions=i.extensions||{},i.extensions[this.name]=h,i.extras=i.extras||{},i.extras.sheenFactor=e.sheen,a[this.name]=!0}}class dT{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial)return;const s=this.writer.extensionsUsed,a={};a.ior=e.ior,i.extensions=i.extensions||{},i.extensions[this.name]=a,s[this.name]=!0}}sb.Utils={GLTFWriter:EE,insertKeyframe:function(c,e){const s=c.getValueSize(),a=new c.TimeBufferType(c.times.length+1),h=new c.ValueBufferType(c.values.length+s),d=c.createInterpolant(new c.ValueBufferType(s));let b;if(c.times.length===0){a[0]=e;for(let X=0;X<s;X++)h[X]=0;b=0}else if(e<c.times[0]){if(Math.abs(c.times[0]-e)<.001)return 0;a[0]=e,a.set(c.times,1),h.set(d.evaluate(e),0),h.set(c.values,s),b=0}else if(e>c.times[c.times.length-1]){if(Math.abs(c.times[c.times.length-1]-e)<.001)return c.times.length-1;a[a.length-1]=e,a.set(c.times,0),h.set(c.values,0),h.set(d.evaluate(e),c.values.length),b=a.length-1}else for(let X=0;X<c.times.length;X++){if(Math.abs(c.times[X]-e)<.001)return X;if(c.times[X]<e&&c.times[X+1]>e){a.set(c.times.slice(0,X+1),0),a[X+1]=e,a.set(c.times.slice(X+1),X+2),h.set(c.values.slice(0,(X+1)*s),0),h.set(d.evaluate(e),(X+1)*s),h.set(c.values.slice((X+1)*s),(X+2)*s),b=X+1;break}}return c.times=a,c.values=h,b},mergeMorphTargetTracks:function(c,e){const i=[],s={},a=c.tracks;for(let h=0;h<a.length;++h){let d=a[h];const b=_.iUV.parseTrackName(d.name),X=_.iUV.findNode(e,b.nodeName);if(b.propertyName!=="morphTargetInfluences"||b.propertyIndex===void 0){i.push(d);continue}if(d.createInterpolant!==d.InterpolantFactoryMethodDiscrete&&d.createInterpolant!==d.InterpolantFactoryMethodLinear){if(d.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),d=d.clone(),d.setInterpolation(_.NMF)}const $=X.morphTargetInfluences.length,Z=X.morphTargetDictionary[b.propertyIndex];if(Z===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+b.propertyIndex);let re;if(s[X.uuid]===void 0){re=d.clone();const he=new re.ValueBufferType($*re.times.length);for(let fe=0;fe<re.times.length;fe++)he[fe*$+Z]=re.values[fe];re.name=(b.nodeName||"")+".morphTargetInfluences",re.values=he,s[X.uuid]=re,i.push(re);continue}const le=d.createInterpolant(new d.ValueBufferType(1));re=s[X.uuid];for(let he=0;he<re.times.length;he++)re.values[he*$+Z]=le.evaluate(re.times[he]);for(let he=0;he<d.times.length;he++){const fe=this.insertKeyframe(re,d.times[he]);re.values[fe*$+Z]=d.values[he]}}return c.tracks=i,c}};class SE extends sb.Utils.GLTFWriter{constructor(){super(...arguments),this._defaultMaterial=new _.Wid}serializeUserData(e,i){const s=e.userData,a={};s.__disposed&&console.error("Serializing a disposed object",e),Object.entries(s).forEach(([h,d])=>{(!d||typeof d=="function"||d.isObject3D||d.isTexture||d.isMaterial||d.assetType!=null||h.startsWith("_")||h!=="uuid"&&(ls.includes(h)||Ss.includes(h)||Bs.includes(h)))&&(a[h]=d,delete s[h])}),super.serializeUserData(e,i),Object.entries(a).forEach(([h,d])=>{s[h]=d,delete a[h]})}processObjects(e){var i;e.length===1&&(!((i=e[0])===null||i===void 0)&&i.userData.rootSceneModelRoot)?this.processScene(e[0]):super.processObjects(e)}processMaterial(e){if(this.cache.materials.has(e))return this.cache.materials.get(e);let i=e;i&&!i.isShaderMaterial||(i=this._defaultMaterial);const s=super.processMaterial(i);if(!e||i===e)return s;const a=JSON.stringify(this.json.materials[s]),h=JSON.parse(a);this.serializeUserData(e,h),this._invokeAll(b=>{b.writeMaterial&&b.writeMaterial(e,h)});const d=this.json.materials.push(h)-1;return this.cache.materials.set(e,d),d}processImageBlob(e,i){if(!e)return-1;const s=this.cache,a=this.options,h=this.pending,d=this.json,b=i.image;s.images.has(b)||s.images.set(b,{});const X=s.images.get(b),$=e.type+":flipY/"+i.flipY.toString();if(X[$]!==void 0)return X[$];d.images||(d.images=[]);const Z={mimeType:e.type};a.binary===!0?h.push(new Promise(le=>{this.processBufferViewImage(e).then(he=>{Z.bufferView=he,le()})})):h.push(Pa(e).then(le=>{Z.uri=le}));const re=d.images.push(Z)-1;return X[$]=re,re}processSampler(e){return super.processSampler(e)}processTexture(e){const i=this.cache,s=this.json;if(i.textures.has(e))return i.textures.get(e);const a=e.source.data,h=e.userData.mimeType;e.userData.rootPath&&!this.options.embedUrlImages&&(e.source.data=null,delete e.userData.mimeType);const d=super.processTexture(e),b=s.textures[d];if(!b)return console.error("No texture def",d,e),d;const X=s.images?s.images[b.source]:null;if(X&&(X.extras||(X.extras={}),e.source&&(X.extras.uuid=e.source.uuid),X.extras.t_uuid=e.uuid),e.userData.rootPath&&!this.options.embedUrlImages){if(e.source.data=a,e.userData.mimeType=h,!b)return console.error("textureDef is null",d,e),d;b.source>=0?console.warn("textureDef.source is already set",d,e):b.source=this.processImageUri(e.image,e.userData.rootPath,e.flipY,h)}return b.source<0&&console.error("textureDef.source cannot be saved",b,e),d}processImage(e,i,s,a="image/png"){return e?super.processImage(e,i,s,a):-1}processImageUri(e,i,s,a="image/png"){const h=this.cache,d=this.json;h.images.has(e)||h.images.set(e,{});const b=h.images.get(e),X=a+":flipY/"+s.toString();if(b[X]!==void 0)return b[X];d.images||(d.images=[]);const $={mimeType:a,uri:i,extras:{flipY:s}},Z=d.images.push($)-1;return b[X]=Z,Z}}class Ix extends sb{register(e){return super.register(e)}async parseAsync(e,i){var s;if(!e)throw new Error("No object to export");const a=e.__isGLTFOutput||!Array.isArray(e)&&!e.isObject3D?e:await new Promise((h,d)=>this.parse(e,h,d,i));if(a&&typeof a=="object"&&!a.byteLength)return new Blob([JSON.stringify(a,(h,d)=>h.startsWith("__")?void 0:d,(s=i.jsonSpaces)!==null&&s!==void 0?s:2)],{type:"model/gltf+json"});if(a)return new Blob([a],{type:"model/gltf+binary"});throw new Error("GLTFExporter2.parse() failed")}parse(e,i,s,a={}){var h;const d={binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,externalImagesInExtras:!a.embedUrlImages&&a.externalImagesInExtras||!1,embedUrlImages:(h=a.embedUrlImages)!==null&&h!==void 0&&h,maxTextureSize:1/0,animations:[],includeCustomExtensions:!0};return a.exportExt==="glb"&&(d.binary=!0),a.preserveUUIDs!==!1&&(Array.isArray(e)?e:[e]).forEach(b=>b.traverse(X=>{X.uuid&&(X.userData.gltfUUID=X.uuid)})),(Array.isArray(e)?e:[e]).forEach(b=>b.traverse(X=>{if(X.animations)for(const $ of X.animations)$.__gltfExport===!1||d.animations.includes($)||d.animations.push(...X.animations)})),super.parse(e,b=>{a.preserveUUIDs!==!1&&(Array.isArray(e)?e:[e]).forEach(X=>X.traverse($=>{delete $.userData.gltfUUID})),i(Object.assign(b,{__isGLTFOutput:!0}))},s,d,new SE)}}function CE(c,e){const i=c.getPlugin(Kn).exportViewerConfig();e.json.textures&&e.json.samplers&&e.json.images&&i.resources.textures&&Object.entries(i.resources.textures).forEach(([a,h])=>{e.json.textures.find(b=>{var X,$,Z,re,le;return((X=b.extras)===null||X===void 0?void 0:X.uuid)===a||((Z=($=e.json.samplers[b.sampler])===null||$===void 0?void 0:$.extras)===null||Z===void 0?void 0:Z.uuid)===a||((le=(re=e.json.images[b.source])===null||re===void 0?void 0:re.extras)===null||le===void 0?void 0:le.t_uuid)===a})&&(h.image&&i.resources.images&&i.resources.images[h.image]&&delete i.resources.images[h.image],i.resources.textures[a]={})}),e.json.materials&&i.resources.materials&&Object.entries(i.resources.materials).forEach(([a,h])=>{e.json.materials.find(b=>{var X;return((X=b.extras)===null||X===void 0?void 0:X.uuid)===a})&&(i.resources.materials[a]={})});const s=[];Object.values(i.resources).forEach(a=>{a&&Object.values(a).forEach(h=>{h.url&&(h.url.type==="Uint16Array"&&h.url.data&&(h.url.data instanceof Uint16Array||(h.url.data=new Uint16Array(h.url.data)),s.push(h.url)),h.url.type==="Uint8Array"&&h.url.data&&(h.url.data instanceof Uint8Array||(h.url.data=new Uint8Array(h.url.data)),s.push(h.url)))})});for(const a of s){let h="application/octet-stream";if(a.type==="Uint16Array"&&a.width>0&&a.height>0){const $=pT(a.data,4),Z=new ImageData($,a.width,a.height),re=_.PpQ.getDataURL(Z,!0).split(",")[1];h="image/png",a.data=atob(re),a.encoding="rgbe"}const d=new Blob([a.data],{type:h});e.json.images||(e.json.images=[]);const b={mimeType:h},X=e.json.images.push(b)-1;a.data={image:X},e.pending.push(e.processBufferViewImage(d).then($=>{b.bufferView=$}))}return i}function pT(c,e=3,i){let s,a,h,d,b;const X=c.byteLength/(2*e)|0;i=i||new Uint8ClampedArray(4*X);for(let $=0;$<X;$++){s=c[$*e],a=c[$*e+1],h=c[$*e+2],d=Math.max(Math.max(s,a),h);const Z=Math.ceil(Math.log2(d));b=Math.pow(2,Z-8),i[4*$]=s/b|0,i[4*$+1]=a/b|0,i[4*$+2]=h/b|0,i[4*$+3]=Z+128}return i}function Dx(c,e=Ix,i){var s;if(!c)return;const a=Ph.Exporters.findIndex(d=>d.ext.includes("gltf")||d.ext.includes("glb")),h=[];a>=0?(h.push(...(s=Ph.Exporters[a].extensions)!==null&&s!==void 0?s:[]),Ph.Exporters.splice(a,1)):(h.push(gT),h.push(mT),h.push(fT),h.push(d=>new _T(d)),h.push(d=>new vT(d)),h.push(d=>new AT(d)),h.push(d=>new yT(d))),Ph.Exporters.push({ctor:()=>{const d=new e;return h.forEach(b=>d.register(b)),d.register(b=>({afterParse:X=>{var $,Z;if(!(!(($=(X=Array.isArray(X)?X[0]:X)==null?void 0:X.userData)===null||$===void 0)&&$.rootSceneModelRoot)||((Z=X==null?void 0:X.userData)===null||Z===void 0?void 0:Z.__exportViewerConfig)===!1)return;const re=b.json.scenes[b.json.scene||0];re.extensions||(re.extensions={}),re.extensions[so]=CE(c,b),b.extensionsUsed[so]=!0}})),i==null||i(d),d},ext:["gltf","glb"],extensions:h})}const fT=c=>({writeNode:(e,i)=>{if(!(e!=null&&e.isLight))return;i.extensions||(i.extensions={});const s={};e.shadow&&(s.shadow=e.shadow.toJSON()),Object.keys(s).length>0&&(i.extensions[ya]=s,c.extensionsUsed[ya]=!0)}}),mT=c=>({writeNode:(e,i)=>{if(!(e!=null&&e.isObject3D))return;i.extensions||(i.extensions={});const s={};e.castShadow!==void 0&&(s.castShadow=e.castShadow),e.receiveShadow!==void 0&&(s.receiveShadow=e.receiveShadow),e.visible===!1&&(s.visible=!1),e.frustumCulled===!1&&(s.frustumCulled=!1),e.renderOrder!==0&&(s.renderOrder=e.renderOrder),e.layers.mask!==1&&(s.layers=e.layers.mask),e.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),Object.keys(s).length>0&&(i.extensions[Gl]=s,c.extensionsUsed[Gl]=!0)}}),gT=c=>({writeMaterial(e,i){var s;if(!(e!=null&&e.isMaterial))return;i.extensions||(i.extensions={});const a={};if(e.emissiveIntensity!==void 0&&(!((s=e.emissive)===null||s===void 0)&&s.isColor)){const d=e.emissive.clone().multiplyScalar(e.emissiveIntensity),b=Math.max(d.r,d.g,d.b);b>1&&(a.emissiveIntensity=b)}e.fog!==void 0&&(a.fog=e.fog),e.flatShading!==void 0&&(a.flatShading=e.flatShading),e.blending!==void 0&&(a.blending=e.blending),e.side!==void 0&&e.side!==_.ehD&&(a.side=e.side),e.shadowSide!==void 0&&(a.shadowSide=e.shadowSide),e.depthFunc!==void 0&&(a.depthFunc=e.depthFunc),e.depthTest!==void 0&&(a.depthTest=e.depthTest),e.depthWrite!==void 0&&(a.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(a.colorWrite=e.colorWrite),e.wireframe!==void 0&&(a.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(a.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(a.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(a.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(a.rotation=e.rotation),e.polygonOffset!==void 0&&(a.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(a.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(a.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(a.dithering=e.dithering),e.alphaToCoverage!==void 0&&(a.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(a.premultipliedAlpha=e.premultipliedAlpha),e.toneMapped!==void 0&&(a.toneMapped=e.toneMapped);const h=this.materialExternalResources[e.uuid];h&&Object.entries(h).forEach(([d,b])=>{d.startsWith("_")||(a[d]=qn(b,!1,this.serializedMeta))}),Object.keys(a).length>0&&(i.extensions[oo]=a,c.extensionsUsed[oo]=!0)},materialExternalResources:{},serializedMeta:{images:{},textures:{}},beforeParse(e){if(this.materialExternalResources={},!c.options.externalImagesInExtras)return;const i=[];(Array.isArray(e)?e:[e]).forEach(s=>{s==null||s.traverse(a=>{var h;a&&(!((h=a.material)===null||h===void 0)&&h.isMaterial)&&i.push(a.material)})}),i.forEach(s=>{s&&(this.materialExternalResources[s.uuid]||(this.materialExternalResources[s.uuid]={}),this.materialExternalResources[s.uuid].__materialRef=s,Object.entries(s).forEach(([a,h])=>{a.startsWith("_")||h&&h.isTexture&&h.userData.rootPath&&(s[a]=null,this.materialExternalResources[s.uuid][a]=h)}))})},afterParse(e){const i=Object.values(this.materialExternalResources);if(i.length<1)return;i.forEach(a=>{const h=a.__materialRef;h&&(Object.entries(a).forEach(([d,b])=>{d.startsWith("_")||b&&(h[d]=b)}),delete this.materialExternalResources[h.uuid])});const s=c.json.scenes[c.json.scene||0];s.extensions||(s.extensions={}),s.extensions[oo]={resources:this.serializedMeta},c.extensionsUsed[oo]=!0}});class _T{constructor(e){this.writer=e,this.name=vo}writeMaterial(e,i){if(!e.isMeshStandardMaterial||e.bumpScale===0)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.bumpScale=e.bumpScale,e.bumpMap){const d={index:s.processTexture(e.bumpMap)};s.applyTextureTransform(d,e.bumpMap),h.bumpTexture=d}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class vT{constructor(e){this.writer=e,this.name=Bc}writeMaterial(e,i){if(!e.isMeshStandardMaterial||e.displacementScale===0)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.displacementScale=e.displacementScale,h.displacementBias=e.displacementBias,e.displacementMap){const d={index:s.processTexture(e.displacementMap)};s.applyTextureTransform(d,e.displacementMap),h.displacementTexture=d}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class AT{constructor(e){this.writer=e,this.name=Hl}writeMaterial(e,i){if(!e.isMeshStandardMaterial||e.lightMapIntensity===0)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.lightMapIntensity=e.lightMapIntensity,e.lightMap){const d={index:s.processTexture(e.lightMap)};s.applyTextureTransform(d,e.lightMap),h.lightMapTexture=d}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class yT{constructor(e){this.writer=e,this.name=gu}writeMaterial(e,i){if(!e.isMeshStandardMaterial||!e.alphaMap)return;const s=this.writer,a=s.extensionsUsed,h={};if(e.alphaMap){const d={index:s.processTexture(e.alphaMap)};s.applyTextureTransform(d,e.alphaMap),h.alphaTexture=d}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class Ph extends oe{constructor(e,i={}){super(),this._processors=new oh,this._cachedParsers=[],Dx(e)}get processors(){return this._processors}getExporter(...e){return Ph.Exporters.find(i=>i.ext.some(s=>e.includes(s)))}async exportObject(e,i={}){var s,a,h,d;if(!(e!=null&&e.assetType))return void console.error("Object has no asset type");!((a=(s=e)===null||s===void 0?void 0:s.userData)===null||a===void 0)&&a.rootSceneModelRoot&&i.viewerConfig===!1&&(e.userData.__exportViewerConfig=!1);const b=await this._exportFile(e,i);return!((d=(h=e)===null||h===void 0?void 0:h.userData)===null||d===void 0)&&d.rootSceneModelRoot&&i.viewerConfig===!1&&delete e.userData.__exportViewerConfig,b}async _exportFile(e,i={}){var s,a,h;let d;this.dispatchEvent({type:"exportFile",obj:e,state:"processing"});try{const b=await this.processBeforeExport(e,i),X=(a=(s=i.exportExt)!==null&&s!==void 0?s:b==null?void 0:b.typeExt)!==null&&a!==void 0?a:b==null?void 0:b.ext;if(!b||!X)throw new Error(`Unable to preprocess before export ${X}`);const $=this._getParser(X);this.dispatchEvent({type:"exportFile",obj:e,state:"exporting"});const Z=await $.parseAsync(b.obj,{exportExt:(h=b.ext)!==null&&h!==void 0?h:X,...i});Z.ext=b.ext,d=Z}catch(b){return console.error("AssetExporter: Unable to Export file",e),console.error(b),void this.dispatchEvent({type:"exportFile",obj:e,state:"error",error:b})}return this.dispatchEvent({type:"exportFile",obj:e,state:"done"}),d}_createParser(e){const i=Ph.Exporters.find(a=>a.ext.includes(e));if(!i)throw new Error(`No exporter found for extension ${e}`);const s=i==null?void 0:i.ctor(this);if(!s)throw new Error(`Unable to create parser for extension ${e}`);return this._cachedParsers.push({ext:i.ext,parser:s}),this.dispatchEvent({type:"exporterCreate",exporter:i,parser:s}),s}_getParser(e){var i,s;return(s=(i=this._cachedParsers.find(a=>a.ext.includes(e)))===null||i===void 0?void 0:i.parser)!==null&&s!==void 0?s:this._createParser(e)}async processBeforeExport(e,i={}){switch(e.assetType!=null&&(e=await this._processors.process(e.assetType,e,i)),e.assetType){case"light":return void console.error("AssetExporter: light export not implemented");case"model":return{obj:e,ext:"glb"};case"material":return{obj:e.toJSON(),ext:e.typeSlug||"json",typeExt:"json"};case"texture":return{obj:e.toJSON(),ext:"json"};default:console.error("AssetExporter: unknown asset type",e.assetType)}}dispose(){var e;(e=this._processors)===null||e===void 0||e.dispose()}}Ph.Exporters=[{ctor:()=>new G0,ext:["json"]},{ctor:()=>new yE,ext:["txt","text"]}];class H0 extends Xi{constructor(e){super(),this.enabled=!0,this.exportOptions={compress:!1,name:"scene",viewerConfig:!0,convertMeshToIndexed:!1,embedUrlImages:!1},this.exporter=e,this.exportScene=this.exportScene.bind(this)}async onAdded(e){await super.onAdded(e),this.exporter||(this.exporter=new Ph(e)),this.exporter.processors.add("model",{forAssetType:"model",processAsync:async(i,s)=>{var a;return s.convertMeshToIndexed&&((a=i.modelObject)===null||a===void 0||a.traverse(h=>{var d;h.geometry&&(h.geometry.attributes.index||(d=h.setGeometry)===null||d===void 0||d.call(h,ji(h.geometry)))})),i}})}async onRemove(e){return super.onRemove(e)}async exportScene(e){var i,s;return(i=this.exporter)===null||i===void 0?void 0:i.exportObject((s=this._viewer)===null||s===void 0?void 0:s.scene.modelRoot,e||{...this.exportOptions})}get uiConfig(){if(this._uiConfig)return this._uiConfig;const e=this._viewer;e.addEventListener("addPlugin",s=>{var a;typeof((a=s.plugin)===null||a===void 0?void 0:a.toJSON)=="function"&&console.error("Add all plugins before setting up the export UI, or use `toJSON: any = null` in the plugin ")});const i=Object.entries(e.plugins).filter(([s,a])=>typeof(a==null?void 0:a.toJSON)=="function").map(([s,a])=>({label:s,type:"checkbox",value:!0}));return this._uiConfig={type:"folder",label:"Asset Export",limitedUi:!0,children:[{type:"input",property:[this.exportOptions,"name"],limitedUi:!0},{type:"folder",label:"GLB Export",limitedUi:!0,children:[{type:"checkbox",label:"DRACO Compress",property:[this.exportOptions,"compress"],limitedUi:!0},{type:"checkbox",label:"Scene Settings",property:[this.exportOptions,"viewerConfig"],limitedUi:!0},{type:"checkbox",label:"Indexed meshes only",property:[this.exportOptions,"convertMeshToIndexed"]},{type:"button",label:"Export GLB",limitedUi:!0,value:async()=>{const s=await this.exportScene(this.exportOptions);s&&ts(s,this.exportOptions.name+"."+s.ext)}}]},{type:"folder",label:"Preset/Config export",children:[{type:"folder",label:"Plugins",children:i},{type:"button",label:"Select none",value:()=>{i.forEach(s=>{var a;s.value=!1,(a=s.uiRefresh)===null||a===void 0||a.call(s)})}},{type:"button",label:"Select all",value:()=>{i.forEach(s=>{var a;s.value=!0,(a=s.uiRefresh)===null||a===void 0||a.call(s)})}},{type:"button",label:"Export Plugins",limitedUi:!0,value:async()=>{const s=new Blob([JSON.stringify(e.getPlugin(Kn).exportPluginPresets(i.filter(a=>!!a.value).map(a=>st(a.label)||"")),null,2)],{type:"application/json"});s&&ts(s,this.exportOptions.name+"."+Kn.ViewerTypeSlug)}},{type:"button",label:"Export All Viewer Config",limitedUi:!0,value:async()=>{const s=new Blob([JSON.stringify(e.getPlugin(Kn).exportViewerConfig(!1),null,2)],{type:"application/json"});s&&ts(s,this.exportOptions.name+"."+Kn.ViewerTypeSlug)}}]}]}}}H0.PluginType="AssetExporterPlugin";class Px{constructor(){this._listeners={}}addEventListener(e,i){const s=this._listeners;return s[e]===void 0&&(s[e]=[]),s[e].indexOf(i)===-1&&s[e].push(i),this}removeEventListener(e,i){if(this._listeners===void 0)return this;const s=this._listeners[e];if(s!==void 0){const a=s.indexOf(i);a!==-1&&s.splice(a,1)}return this}dispatchEvent(e){if(this._listeners===void 0)return this;const i=this._listeners[e.type];if(i!==void 0){const s=i.slice(0);for(let a=0,h=s.length;a<h;a++)s[a].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class Rh extends Px{constructor(e,i,s,a={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=i,this._child=s,this._attributes=a,!i.isOnGraph(s))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class bT extends Px{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map(i=>i.getParent())}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map(i=>i.getChild())}disconnectParents(e,i){let s=this.listParentEdges(e);return i&&(s=s.filter(a=>i(a.getParent()))),s.forEach(a=>a.dispose()),this}createEdge(e,i,s,a){return this._registerEdge(new Rh(e,i,s,a))}_registerEdge(e){this._edges.add(e);const i=e.getParent();this._parentEdges.has(i)||this._parentEdges.set(i,new Set),this._parentEdges.get(i).add(e);const s=e.getChild();return this._childEdges.has(s)||this._childEdges.set(s,new Set),this._childEdges.get(s).add(e),e.addEventListener("dispose",()=>this._removeEdge(e)),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function W0(){return W0=Object.assign||function(c){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(c[s]=i[s])}return c},W0.apply(this,arguments)}function Rx(c){return c instanceof Rh}function Bx(c){return Array.isArray(c)&&c[0]instanceof Rh}function kx(c){return!!(c&&typeof c=="object"&&Object.values(c)[0]instanceof Rh)}const xs=Symbol("attributes"),G_=Symbol("immutableKeys");class Ox extends Px{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[xs]=void 0,this[G_]=void 0,this.graph=e,this[G_]=new Set,this[xs]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),i={};for(const s in e){const a=e[s];if(a instanceof Ox){const h=this.graph.createEdge(s,this,a);h.addEventListener("dispose",()=>a.dispose()),this[G_].add(s),i[s]=h}else i[s]=a}return i}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,i){for(const s in this[xs]){const a=this[xs][s];if(Rx(a)){const h=a;h.getChild()===e&&this.setRef(s,i,h.getAttributes())}else if(Bx(a)){const h=a.find(d=>d.getChild()===e);if(h){const d=h.getAttributes();this.removeRef(s,e).addRef(s,i,d)}}else if(kx(a)){const h=a;for(const d in h){const b=h[d];b.getChild()===e&&this.setRefMap(s,d,i,b.getAttributes())}}}return this}get(e){return this[xs][e]}set(e,i){return this[xs][e]=i,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const i=this[xs][e];return i?i.getChild():null}setRef(e,i,s){if(this[G_].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const a=this[xs][e];if(a&&a.dispose(),!i)return this;const h=this.graph.createEdge(e,this,i,s);return h.addEventListener("dispose",()=>{delete this[xs][e],this.dispatchEvent({type:"change",attribute:e})}),this[xs][e]=h,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[xs][e].map(i=>i.getChild())}addRef(e,i,s){const a=this.graph.createEdge(e,this,i,s),h=this[xs][e];return h.push(a),a.addEventListener("dispose",()=>{const d=h.filter(b=>b!==a);h.length=0;for(const b of d)h.push(b);this.dispatchEvent({type:"change",attribute:e})}),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,i){return this[xs][e].filter(s=>s.getChild()===i).forEach(s=>s.dispose()),this}listRefMapKeys(e){return Object.keys(this[xs][e])}listRefMapValues(e){return Object.values(this[xs][e]).map(i=>i.getChild())}getRefMap(e,i){const s=this[xs][e];return s[i]?s[i].getChild():null}setRefMap(e,i,s,a){const h=this[xs][e],d=h[i];if(d&&d.dispose(),!s)return this;a=Object.assign(a||{},{key:i});const b=this.graph.createEdge(e,this,s,W0({},a,{key:i}));return b.addEventListener("dispose",()=>{delete h[i],this.dispatchEvent({type:"change",attribute:e,key:i})}),h[i]=b,this.dispatchEvent({type:"change",attribute:e,key:i})}dispatchEvent(e){return super.dispatchEvent(W0({},e,{target:this})),this.graph.dispatchEvent(W0({},e,{target:this,type:`node:${e.type}`})),this}}var ob,Jn,ab,Vu,xo,Zc,Lx=typeof Float32Array<"u"?Float32Array:Array;function Nx(c){var e=c[0],i=c[1],s=c[2];return Math.hypot(e,i,s)}function wT(c,e,i){var s=e[0],a=e[1],h=e[2],d=i[3]*s+i[7]*a+i[11]*h+i[15];return d=d||1,c[0]=(i[0]*s+i[4]*a+i[8]*h+i[12])/d,c[1]=(i[1]*s+i[5]*a+i[9]*h+i[13])/d,c[2]=(i[2]*s+i[6]*a+i[10]*h+i[14])/d,c}function xT(c,e,i){var s=e[0],a=e[1],h=e[2],d=e[3],b=e[4],X=e[5],$=e[6],Z=e[7],re=e[8],le=e[9],he=e[10],fe=e[11],me=e[12],Ee=e[13],Ae=e[14],ye=e[15],ge=i[0],Pe=i[1],Be=i[2],Oe=i[3];return c[0]=ge*s+Pe*b+Be*re+Oe*me,c[1]=ge*a+Pe*X+Be*le+Oe*Ee,c[2]=ge*h+Pe*$+Be*he+Oe*Ae,c[3]=ge*d+Pe*Z+Be*fe+Oe*ye,ge=i[4],Pe=i[5],Be=i[6],Oe=i[7],c[4]=ge*s+Pe*b+Be*re+Oe*me,c[5]=ge*a+Pe*X+Be*le+Oe*Ee,c[6]=ge*h+Pe*$+Be*he+Oe*Ae,c[7]=ge*d+Pe*Z+Be*fe+Oe*ye,ge=i[8],Pe=i[9],Be=i[10],Oe=i[11],c[8]=ge*s+Pe*b+Be*re+Oe*me,c[9]=ge*a+Pe*X+Be*le+Oe*Ee,c[10]=ge*h+Pe*$+Be*he+Oe*Ae,c[11]=ge*d+Pe*Z+Be*fe+Oe*ye,ge=i[12],Pe=i[13],Be=i[14],Oe=i[15],c[12]=ge*s+Pe*b+Be*re+Oe*me,c[13]=ge*a+Pe*X+Be*le+Oe*Ee,c[14]=ge*h+Pe*$+Be*he+Oe*Ae,c[15]=ge*d+Pe*Z+Be*fe+Oe*ye,c}function ET(c,e){const i={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};for(const s of c.listPrimitives()){const a=s.getAttribute("POSITION");if(!a)continue;let h=[0,0,0],d=[0,0,0];for(let b=0;b<a.getCount();b++)h=a.getElement(b,h),d=wT(d,h,e),Ux(d,i)}return i}function Ux(c,e){for(let i=0;i<3;i++)e.min[i]=Math.min(c[i],e.min[i]),e.max[i]=Math.max(c[i],e.max[i])}Math.hypot||(Math.hypot=function(){for(var c=0,e=arguments.length;e--;)c+=arguments[e]*arguments[e];return Math.sqrt(c)}),ob=new Lx(3),Lx!=Float32Array&&(ob[0]=0,ob[1]=0,ob[2]=0),function(c){c.ACCESSOR="Accessor",c.ANIMATION="Animation",c.ANIMATION_CHANNEL="AnimationChannel",c.ANIMATION_SAMPLER="AnimationSampler",c.BUFFER="Buffer",c.CAMERA="Camera",c.MATERIAL="Material",c.MESH="Mesh",c.PRIMITIVE="Primitive",c.PRIMITIVE_TARGET="PrimitiveTarget",c.NODE="Node",c.ROOT="Root",c.SCENE="Scene",c.SKIN="Skin",c.TEXTURE="Texture",c.TEXTURE_INFO="TextureInfo"}(Jn||(Jn={})),function(c){c.INTERLEAVED="interleaved",c.SEPARATE="separate"}(ab||(ab={})),function(c){c.ARRAY_BUFFER="ARRAY_BUFFER",c.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",c.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",c.OTHER="OTHER"}(Vu||(Vu={})),function(c){c[c.R=4096]="R",c[c.G=256]="G",c[c.B=16]="B",c[c.A=1]="A"}(xo||(xo={})),function(c){c.GLTF="GLTF",c.GLB="GLB"}(Zc||(Zc={}));class Nr{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const i=atob(e.split(",")[1]),s=new Uint8Array(i.length);for(let a=0;a<i.length;a++)s[a]=i.charCodeAt(a);return s}{const i=e.split(",")[1],s=e.indexOf("base64")>=0;return Buffer.from(i,s?"base64":"utf8")}}static encodeText(e){return typeof TextEncoder<"u"?new TextEncoder().encode(e):Buffer.from(e)}static decodeText(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):Buffer.from(e).toString("utf8")}static concat(e){let i=0;for(const h of e)i+=h.byteLength;const s=new Uint8Array(i);let a=0;for(const h of e)s.set(h,a),a+=h.byteLength;return s}static pad(e,i=0){const s=this.padNumber(e.byteLength);if(s===e.byteLength)return e;const a=new Uint8Array(s);if(a.set(e),i!==0)for(let h=e.byteLength;h<s;h++)a[h]=i;return a}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,i){if(e===i)return!0;if(e.byteLength!==i.byteLength)return!1;let s=e.byteLength;for(;s--;)if(e[s]!==i[s])return!1;return!0}static toView(e,i=0,s=1/0){return new Uint8Array(e.buffer,e.byteOffset+i,Math.min(e.byteLength,s))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class kl{static hexToFactor(e,i){e=Math.floor(e);const s=i;return s[0]=(e>>16&255)/255,s[1]=(e>>8&255)/255,s[2]=(255&e)/255,this.convertSRGBToLinear(i,i)}static factorToHex(e){const i=[...e],[s,a,h]=this.convertLinearToSRGB(e,i);return 255*s<<16^255*a<<8^255*h<<0}static convertSRGBToLinear(e,i){const s=e,a=i;for(let h=0;h<3;h++)a[h]=s[h]<.04045?.0773993808*s[h]:Math.pow(.9478672986*s[h]+.0521327014,2.4);return i}static convertLinearToSRGB(e,i){const s=e,a=i;for(let h=0;h<3;h++)a[h]=s[h]<.0031308?12.92*s[h]:1.055*Math.pow(s[h],.41666)-.055;return i}}class lb{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const i=new DataView(e.buffer,e.byteOffset);return Nr.decodeText(e.slice(12,16))===lb.PNG_FRIED_CHUNK_NAME?[i.getUint32(32,!1),i.getUint32(36,!1)]:[i.getUint32(16,!1),i.getUint32(20,!1)]}getChannels(e){return 4}}lb.PNG_FRIED_CHUNK_NAME="CgBI";class tp{static registerFormat(e,i){this.impls[e]=i}static getMimeType(e){for(const i in this.impls)if(this.impls[i].match(e))return i;return null}static getSize(e,i){return this.impls[i]?this.impls[i].getSize(e):null}static getChannels(e,i){return this.impls[i]?this.impls[i].getChannels(e):null}static getMemSize(e,i){if(!this.impls[i])return null;if(this.impls[i].getGPUByteLength)return this.impls[i].getGPUByteLength(e);let s=0;const a=this.getSize(e,i);if(!a)return null;for(;a[0]>1||a[1]>1;)s+=a[0]*a[1]*4,a[0]=Math.max(Math.floor(a[0]/2),1),a[1]=Math.max(Math.floor(a[1]/2),1);return s+=4,s}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":`image/${e}`}}function ST(c,e){if(e>c.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(c.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return c}tp.impls={"image/jpeg":new class{match(c){return c.length>=3&&c[0]===255&&c[1]===216&&c[2]===255}getSize(c){let e,i,s=new DataView(c.buffer,c.byteOffset+4);for(;s.byteLength;){if(e=s.getUint16(0,!1),ST(s,e),i=s.getUint8(e+1),i===192||i===193||i===194)return[s.getUint16(e+7,!1),s.getUint16(e+5,!1)];s=new DataView(c.buffer,s.byteOffset+e+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(c){return 3}},"image/png":new lb};class jm{static basename(e){const i=e.split(/[\\/]/).pop();return i.substring(0,i.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const i=e.match(/data:(image\/\w+)/)[1];return tp.mimeTypeToExtension(i)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}}function ME(c){return Object.prototype.toString.call(c)==="[object Object]"}function np(c){if(ME(c)===!1)return!1;const e=c.constructor;if(e===void 0)return!0;const i=e.prototype;return ME(i)!==!1&&Object.prototype.hasOwnProperty.call(i,"isPrototypeOf")!==!1}class _c{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=_c.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=_c.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=_c.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=_c.Verbosity.ERROR&&console.error(e)}}_c.Verbosity={SILENT:4,ERROR:3,WARN:2,INFO:1,DEBUG:0},_c.DEFAULT_INSTANCE=new _c(_c.Verbosity.INFO);class co{static identity(e){return e}static eq(e,i){if(e.length!==i.length)return!1;for(let s=0;s<e.length;s++)if(Math.abs(e[s]-i[s])>1e-5)return!1;return!0}static denormalize(e,i){switch(i){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static normalize(e,i){switch(i){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static decompose(e,i,s,a){let h=Nx([e[0],e[1],e[2]]);const d=Nx([e[4],e[5],e[6]]),b=Nx([e[8],e[9],e[10]]);(function(le){var he=le[0],fe=le[1],me=le[2],Ee=le[3],Ae=le[4],ye=le[5],ge=le[6],Pe=le[7],Be=le[8],Oe=le[9],Fe=le[10],Xe=le[11],at=le[12],mt=le[13],wt=le[14],At=le[15];return(he*ye-fe*Ae)*(Fe*At-Xe*wt)-(he*ge-me*Ae)*(Oe*At-Xe*mt)+(he*Pe-Ee*Ae)*(Oe*wt-Fe*mt)+(fe*ge-me*ye)*(Be*At-Xe*at)-(fe*Pe-Ee*ye)*(Be*wt-Fe*at)+(me*Pe-Ee*ge)*(Be*mt-Oe*at)})(e)<0&&(h=-h),i[0]=e[12],i[1]=e[13],i[2]=e[14];const X=e.slice(),$=1/h,Z=1/d,re=1/b;X[0]*=$,X[1]*=$,X[2]*=$,X[4]*=Z,X[5]*=Z,X[6]*=Z,X[8]*=re,X[9]*=re,X[10]*=re,function(le,he){var fe=new Lx(3);(function(Tt,yt){var St=yt[0],Ft=yt[1],Mt=yt[2],Gt=yt[4],rn=yt[5],gn=yt[6],Kt=yt[8],In=yt[9],kn=yt[10];Tt[0]=Math.hypot(St,Ft,Mt),Tt[1]=Math.hypot(Gt,rn,gn),Tt[2]=Math.hypot(Kt,In,kn)})(fe,he);var me=1/fe[0],Ee=1/fe[1],Ae=1/fe[2],ye=he[0]*me,ge=he[1]*Ee,Pe=he[2]*Ae,Be=he[4]*me,Oe=he[5]*Ee,Fe=he[6]*Ae,Xe=he[8]*me,at=he[9]*Ee,mt=he[10]*Ae,wt=ye+Oe+mt,At=0;wt>0?(At=2*Math.sqrt(wt+1),le[3]=.25*At,le[0]=(Fe-at)/At,le[1]=(Xe-Pe)/At,le[2]=(ge-Be)/At):ye>Oe&&ye>mt?(At=2*Math.sqrt(1+ye-Oe-mt),le[3]=(Fe-at)/At,le[0]=.25*At,le[1]=(ge+Be)/At,le[2]=(Xe+Pe)/At):Oe>mt?(At=2*Math.sqrt(1+Oe-ye-mt),le[3]=(Xe-Pe)/At,le[0]=(ge+Be)/At,le[1]=.25*At,le[2]=(Fe+at)/At):(At=2*Math.sqrt(1+mt-ye-Oe),le[3]=(ge-Be)/At,le[0]=(Xe+Pe)/At,le[1]=(Fe+at)/At,le[2]=.25*At)}(s,X),a[0]=h,a[1]=d,a[2]=b}static compose(e,i,s,a){const h=a,d=i[0],b=i[1],X=i[2],$=i[3],Z=d+d,re=b+b,le=X+X,he=d*Z,fe=d*re,me=d*le,Ee=b*re,Ae=b*le,ye=X*le,ge=$*Z,Pe=$*re,Be=$*le,Oe=s[0],Fe=s[1],Xe=s[2];return h[0]=(1-(Ee+ye))*Oe,h[1]=(fe+Be)*Oe,h[2]=(me-Pe)*Oe,h[3]=0,h[4]=(fe-Be)*Fe,h[5]=(1-(he+ye))*Fe,h[6]=(Ae+ge)*Fe,h[7]=0,h[8]=(me+Pe)*Xe,h[9]=(Ae-ge)*Xe,h[10]=(1-(he+Ee))*Xe,h[11]=0,h[12]=e[0],h[13]=e[1],h[14]=e[2],h[15]=1,h}}function CT(c,e){if(!!c!=!!e)return!1;const i=c.getChild(),s=e.getChild();return i===s||i.equals(s)}function MT(c,e){if(!!c!=!!e||c.length!==e.length)return!1;for(let i=0;i<c.length;i++){const s=c[i],a=e[i];if(s.getChild()!==a.getChild()&&!s.getChild().equals(a.getChild()))return!1}return!0}function TT(c,e){if(!!c!=!!e)return!1;const i=Object.keys(c),s=Object.keys(e);if(i.length!==s.length)return!1;for(const a in c){const h=c[a],d=e[a];if(!!h!=!!d)return!1;const b=h.getChild(),X=d.getChild();if(b!==X&&!b.equals(X))return!1}return!0}function TE(c,e){if(c===e)return!0;if(!!c!=!!e||!c||!e||c.length!==e.length)return!1;for(let i=0;i<c.length;i++)if(c[i]!==e[i])return!1;return!0}function IE(c,e){if(c===e)return!0;if(!!c!=!!e)return!1;if(!np(c)||!np(e))return c===e;const i=c,s=e;let a,h=0,d=0;for(a in i)h++;for(a in s)d++;if(h!==d)return!1;for(a in i){const b=i[a],X=s[a];if(cb(b)&&cb(X)){if(!TE(b,X))return!1}else if(np(b)&&np(X)){if(!IE(b,X))return!1}else if(b!==X)return!1}return!0}function cb(c){return Array.isArray(c)||ArrayBuffer.isView(c)}const DE="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",PE=new Set,IT=function(){let c="";for(let e=0;e<6;e++)c+=DE.charAt(Math.floor(Math.random()*DE.length));return c};class ff{static dirname(e){const i=e.lastIndexOf("/");return i===-1?"./":e.substring(0,i+1)}static basename(e){return jm.basename(new URL(e,"https://null.example").pathname)}static extension(e){return jm.extension(new URL(e,"https://null.example").pathname)}static resolve(e,i){if(!this.isRelativePath(i))return i;const s=e.split("/"),a=i.split("/");s.pop();for(let h=0;h<a.length;h++)a[h]!=="."&&(a[h]===".."?s.pop():s.push(a[h]));return s.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}ff.DEFAULT_INIT={},ff.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const Bh=c=>c,DT=new Set;class Fx extends Ox{constructor(e,i=""){super(e),this[xs].name=i,this.init(),this.dispatchEvent({type:"create"})}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new this.constructor(this.graph).copy(this,Bh)}copy(e,i=Bh){for(const s in this[xs]){const a=this[xs][s];if(a instanceof Rh)this[G_].has(s)||a.dispose();else if(Array.isArray(a)&&a[0]instanceof Rh)for(const h of a)h.dispose();else if(np(a)&&Object.values(a)[0]instanceof Rh)for(const h in a)a[h].dispose()}for(const s in e[xs]){const a=this[xs][s],h=e[xs][s];if(h instanceof Rh)this[G_].has(s)?a.getChild().copy(i(h.getChild()),i):this.setRef(s,i(h.getChild()),h.getAttributes());else if(Array.isArray(h)&&h[0]instanceof Rh)for(const d of h)this.addRef(s,i(d.getChild()),d.getAttributes());else if(np(h)&&Object.values(h)[0]instanceof Rh)for(const d in h){const b=h[d];this.setRefMap(s,d,i(b.getChild()),b.getAttributes())}else this[xs][s]=np(h)?JSON.parse(JSON.stringify(h)):Array.isArray(h)||h instanceof ArrayBuffer||ArrayBuffer.isView(h)?h.slice():h}return this}equals(e,i=DT){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const s in this[xs]){if(i.has(s))continue;const a=this[xs][s],h=e[xs][s];if(Rx(a)||Rx(h)){if(!CT(a,h))return!1}else if(Bx(a)||Bx(h)){if(!MT(a,h))return!1}else if(kx(a)||kx(h)){if(!TT(a,h))return!1}else if(np(a)||np(h)){if(!IE(a,h))return!1}else if(cb(a)||cb(h)){if(!TE(a,h))return!1}else if(a!==h)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class al extends Fx{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,i){return i&&i.t(this),this.setRefMap("extensions",e,i)}listExtensions(){return this.listRefMapValues("extensions")}}class mi extends al{constructor(...e){super(...e),this.i=co.identity,this.o=co.identity}init(){this.propertyType=Jn.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:mi.Type.SCALAR,componentType:mi.ComponentType.FLOAT,normalized:!1,buffer:null})}copy(e,i=Bh){return super.copy(e,i),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case mi.Type.SCALAR:return 1;case mi.Type.VEC2:return 2;case mi.Type.VEC3:return 3;case mi.Type.VEC4:case mi.Type.MAT2:return 4;case mi.Type.MAT3:return 9;case mi.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case mi.ComponentType.BYTE:case mi.ComponentType.UNSIGNED_BYTE:return 1;case mi.ComponentType.SHORT:case mi.ComponentType.UNSIGNED_SHORT:return 2;case mi.ComponentType.UNSIGNED_INT:case mi.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const i=this.getElementSize();this.getMin(e);for(let s=0;s<i;s++)e[s]=this.o(e[s]);return e}getMin(e){const i=this.get("array"),s=this.getCount(),a=this.getElementSize();for(let h=0;h<a;h++)e[h]=1/0;for(let h=0;h<s*a;h+=a)for(let d=0;d<a;d++){const b=i[h+d];Number.isFinite(b)&&(e[d]=Math.min(e[d],b))}return e}getMaxNormalized(e){const i=this.getElementSize();this.getMax(e);for(let s=0;s<i;s++)e[s]=this.o(e[s]);return e}getMax(e){const i=this.get("array"),s=this.getCount(),a=this.getElementSize();for(let h=0;h<a;h++)e[h]=-1/0;for(let h=0;h<s*a;h+=a)for(let d=0;d<a;d++){const b=i[h+d];Number.isFinite(b)&&(e[d]=Math.max(e[d],b))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return mi.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=i=>co.denormalize(i,this.get("componentType")),this.i=i=>co.normalize(i,this.get("componentType"))):(this.o=co.identity,this.i=co.identity),this}getScalar(e){const i=this.getElementSize();return this.o(this.get("array")[e*i])}setScalar(e,i){return this.get("array")[e*this.getElementSize()]=this.i(i),this}getElement(e,i){const s=this.getElementSize(),a=this.get("array");for(let h=0;h<s;h++)i[h]=this.o(a[e*s+h]);return i}setElement(e,i){const s=this.getElementSize(),a=this.get("array");for(let h=0;h<s;h++)a[e*s+h]=this.i(i[h]);return this}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(i){switch(i.constructor){case Float32Array:return mi.ComponentType.FLOAT;case Uint32Array:return mi.ComponentType.UNSIGNED_INT;case Uint16Array:return mi.ComponentType.UNSIGNED_SHORT;case Uint8Array:return mi.ComponentType.UNSIGNED_BYTE;case Int16Array:return mi.ComponentType.SHORT;case Int8Array:return mi.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):mi.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}mi.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},mi.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class RE extends al{init(){this.propertyType=Jn.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class jx extends al{init(){this.propertyType=Jn.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}jx.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class Q_ extends al{init(){this.propertyType=Jn.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:Q_.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:Vu.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:Vu.OTHER})}}Q_.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class BE extends al{init(){this.propertyType=Jn.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class zm extends al{init(){this.propertyType=Jn.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:zm.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}zm.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class Eo extends Fx{t(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}Eo.EXTENSION_NAME=void 0;class Gs extends al{init(){this.propertyType=Jn.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:Gs.WrapMode.REPEAT,wrapT:Gs.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}Gs.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},Gs.MagFilter={NEAREST:9728,LINEAR:9729},Gs.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:ub,G:hb,B:db,A:PT}=xo;class Vm extends al{init(){this.propertyType=Jn.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:Vm.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new Gs(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new Gs(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new Gs(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new Gs(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new Gs(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const i=this.get("baseColorFactor").slice();return i[3]=e,this.set("baseColorFactor",i)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return kl.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const i=this.get("baseColorFactor").slice();return this.set("baseColorFactor",kl.hexToFactor(e,i))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:ub|hb|db|PT})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return kl.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const i=this.get("emissiveFactor").slice();return this.set("emissiveFactor",kl.hexToFactor(e,i))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:ub|hb|db})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:ub|hb|db})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:ub})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:hb|db})}}Vm.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class kE extends al{init(){this.propertyType=Jn.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class pb extends al{constructor(...e){super(...e),this.u=null}init(){this.propertyType=Jn.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(e,i=Bh){if(i===Bh)throw new Error("Node cannot be copied.");return super.copy(e,i)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return co.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const i=this.get("translation").slice(),s=this.get("rotation").slice(),a=this.get("scale").slice();return co.decompose(e,i,s,a),this.set("translation",i).set("rotation",s).set("scale",a)}getWorldTranslation(){const e=[0,0,0];return co.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return co.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return co.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let a=this;a instanceof pb;a=a.u)e.push(a);let i;const s=e.pop().getMatrix();for(;i=e.pop();)xT(s,s,i.getMatrix());return s}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const i=this[xs].children;return i[i.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const i of this.listChildren())i.traverse(e);return this}}class Gm extends al{init(){this.propertyType=Jn.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:Gm.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:Vu.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,i){return this.setRefMap("attributes",e,i,{usage:Vu.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}Gm.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class RT extends Fx{init(){this.propertyType=Jn.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,i){return this.setRefMap("attributes",e,i,{usage:Vu.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function Ol(){return(Ol=Object.assign||function(c){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(c[s]=i[s])}return c}).apply(this,arguments)}class OE extends al{init(){this.propertyType=Jn.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(e,i=Bh){if(i===Bh)throw new Error("Scene cannot be copied.");return super.copy(e,i)}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const i=this[xs].children;return i[i.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const i of this.listChildren())i.traverse(e);return this}}class LE extends al{init(){this.propertyType=Jn.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:Vu.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class NE extends al{init(){this.propertyType=Jn.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||tp.extensionToMimeType(jm.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e),this.set("mimeType",tp.extensionToMimeType(jm.extension(e))),this}getImage(){return this.get("image")}setImage(e){return this.set("image",Nr.assertView(e))}getSize(){const e=this.get("image");return e?tp.getSize(e,this.getMimeType()):null}}class UE extends al{init(){this.propertyType=Jn.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:"glTF-Transform v2.2.3",version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.h=new Set,e.addEventListener("node:create",i=>{this.l(i.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,i=Bh){if(i===Bh)throw new Error("Root cannot be copied.");this.set("asset",Ol({},e.get("asset"))),this.setName(e.getName()),this.setExtras(Ol({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?i(e.getDefaultScene()):null);for(const s of e.listRefMapKeys("extensions")){const a=e.getExtension(s);this.setExtension(s,i(a))}return this}l(e){return e instanceof OE?this.addRef("scenes",e):e instanceof pb?this.addRef("nodes",e):e instanceof zm?this.addRef("cameras",e):e instanceof LE?this.addRef("skins",e):e instanceof kE?this.addRef("meshes",e):e instanceof Vm?this.addRef("materials",e):e instanceof NE?this.addRef("textures",e):e instanceof RE?this.addRef("animations",e):e instanceof mi?this.addRef("accessors",e):e instanceof BE&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.h)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}g(e){return this.h.add(e),this}p(e){return this.h.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class zx{constructor(){this.m=new bT,this.T=new UE(this.m),this.v=_c.DEFAULT_INSTANCE}getRoot(){return this.T}getGraph(){return this.m}getLogger(){return this.v}setLogger(e){return this.v=e,this}clone(){return new zx().setLogger(this.v).merge(this)}merge(e){for(const h of e.getRoot().listExtensionsUsed()){const d=this.createExtension(h.constructor);h.isRequired()&&d.setRequired(!0)}const i=new Set,s=new Map;i.add(e.T),s.set(e.T,this.T);for(const h of e.m.listEdges())for(const d of[h.getParent(),h.getChild()]){if(i.has(d))continue;let b;b=d.propertyType===Jn.TEXTURE_INFO?d:new d.constructor(this.m),s.set(d,b),i.add(d)}const a=h=>{const d=s.get(h);if(!d)throw new Error("Could resolve property.");return d};for(const h of i){const d=s.get(h);if(!d)throw new Error("Could resolve property.");d.propertyType!==Jn.TEXTURE_INFO&&d.copy(h,a)}return this}async transform(...e){const i=e.map(s=>s.name);for(const s of e)await s(this,{stack:i});return this}createExtension(e){const i=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(s=>s.extensionName===i)||new e(this)}createScene(e=""){return new OE(this.m,e)}createNode(e=""){return new pb(this.m,e)}createCamera(e=""){return new zm(this.m,e)}createSkin(e=""){return new LE(this.m,e)}createMesh(e=""){return new kE(this.m,e)}createPrimitive(){return new Gm(this.m)}createPrimitiveTarget(e=""){return new RT(this.m,e)}createMaterial(e=""){return new Vm(this.m,e)}createTexture(e=""){return new NE(this.m,e)}createAnimation(e=""){return new RE(this.m,e)}createAnimationChannel(e=""){return new jx(this.m,e)}createAnimationSampler(e=""){return new Q_(this.m,e)}createAccessor(e="",i=null){return i||(i=this.getRoot().listBuffers()[0]),new mi(this.m,e).setBuffer(i)}createBuffer(e=""){return new BE(this.m,e)}}class to{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this.S=void 0,this.document=e,e.getRoot().g(this),this.S=s=>{const a=s,h=a.target;h instanceof Eo&&h.extensionName===this.extensionName&&(a.type==="node:create"&&this.M(h),a.type==="node:dispose"&&this.I(h))};const i=e.getGraph();i.addEventListener("node:create",this.S),i.addEventListener("node:dispose",this.S)}dispose(){this.document.getRoot().p(this);const e=this.document.getGraph();e.removeEventListener("node:create",this.S),e.removeEventListener("node:dispose",this.S);for(const i of this.properties)i.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}M(e){return this.properties.add(e),this}I(e){return this.properties.delete(e),this}install(e,i){return this}preread(e,i){return this}prewrite(e,i){return this}}to.EXTENSION_NAME=void 0;class BT{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,i){this.textureInfos.set(e,i),i.texCoord!==void 0&&e.setTexCoord(i.texCoord);const s=this.jsonDoc.json.textures[i.index];if(s.sampler===void 0)return;const a=this.jsonDoc.json.samplers[s.sampler];a.magFilter!==void 0&&e.setMagFilter(a.magFilter),a.minFilter!==void 0&&e.setMinFilter(a.minFilter),a.wrapS!==void 0&&e.setWrapS(a.wrapS),a.wrapT!==void 0&&e.setWrapT(a.wrapT)}}const Vx={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},FE={logger:_c.DEFAULT_INSTANCE,extensions:[],dependencies:{}};function fb(c,e){const i=e.bufferViews[c.bufferView],s=e.jsonDoc.json.bufferViews[c.bufferView],a=Vx[c.componentType],h=mi.getElementSize(c.type),d=a.BYTES_PER_ELEMENT;if(s.byteStride!==void 0&&s.byteStride!==h*d)return function(X,$){const Z=$.bufferViews[X.bufferView],re=$.jsonDoc.json.bufferViews[X.bufferView],le=Vx[X.componentType],he=mi.getElementSize(X.type),fe=le.BYTES_PER_ELEMENT,me=X.byteOffset||0,Ee=new le(X.count*he),Ae=new DataView(Z.buffer,Z.byteOffset,Z.byteLength),ye=re.byteStride;for(let ge=0;ge<X.count;ge++)for(let Pe=0;Pe<he;Pe++){const Be=me+ge*ye+Pe*fe;let Oe;switch(X.componentType){case mi.ComponentType.FLOAT:Oe=Ae.getFloat32(Be,!0);break;case mi.ComponentType.UNSIGNED_INT:Oe=Ae.getUint32(Be,!0);break;case mi.ComponentType.UNSIGNED_SHORT:Oe=Ae.getUint16(Be,!0);break;case mi.ComponentType.UNSIGNED_BYTE:Oe=Ae.getUint8(Be);break;case mi.ComponentType.SHORT:Oe=Ae.getInt16(Be,!0);break;case mi.ComponentType.BYTE:Oe=Ae.getInt8(Be);break;default:throw new Error(`Unexpected componentType "${X.componentType}".`)}Ee[ge*he+Pe]=Oe}return Ee}(c,e);const b=i.byteOffset+(c.byteOffset||0);return new a(i.buffer.slice(b,b+c.count*h*d))}var q0;(function(c){c[c.ARRAY_BUFFER=34962]="ARRAY_BUFFER",c[c.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(q0||(q0={}));class eu{constructor(e,i,s){this.N=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.O=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.N=e,this.jsonDoc=i,this.options=s;const a=e.getRoot(),h=a.listBuffers().length,d=a.listTextures().length;this.bufferURIGenerator=new jE(h>1,s.basename),this.imageURIGenerator=new jE(d>1,s.basename),this.logger=e.getLogger()}createTextureInfoDef(e,i){const s={magFilter:i.getMagFilter()||void 0,minFilter:i.getMinFilter()||void 0,wrapS:i.getWrapS(),wrapT:i.getWrapT()},a=JSON.stringify(s);this.samplerDefIndexMap.has(a)||(this.samplerDefIndexMap.set(a,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(s));const h={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(a)},d=JSON.stringify(h);this.textureDefIndexMap.has(d)||(this.textureDefIndexMap.set(d,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(h));const b={index:this.textureDefIndexMap.get(d)};return i.getTexCoord()!==0&&(b.texCoord=i.getTexCoord()),this.textureInfoDefMap.set(i,b),b}createPropertyDef(e){const i={};return e.getName()&&(i.name=e.getName()),Object.keys(e.getExtras()).length>0&&(i.extras=e.getExtras()),i}createAccessorDef(e){const i=this.createPropertyDef(e);return i.type=e.getType(),i.componentType=e.getComponentType(),i.count=e.getCount(),this.N.getGraph().listParentEdges(e).some(s=>s.getName()==="attributes"&&s.getAttributes().key==="POSITION"||s.getName()==="input")&&(i.max=e.getMax([]).map(Math.fround),i.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(i.normalized=e.getNormalized()),i}createImageData(e,i,s){if(this.options.format===Zc.GLB)this.imageBufferViews.push(i),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:i.byteLength});else{const a=tp.mimeTypeToExtension(s.getMimeType());e.uri=this.imageURIGenerator.createURI(s,a),this.jsonDoc.resources[e.uri]=i}}getAccessorUsage(e){const i=this.O.get(e);if(i)return i;for(const s of this.N.getGraph().listParentEdges(e)){const{usage:a}=s.getAttributes();if(a)return a;s.getParent().propertyType!==Jn.ROOT&&this.N.getLogger().warn(`Missing attribute ".usage" on edge, "${s.getName()}".`)}return eu.BufferViewUsage.OTHER}addAccessorToUsageGroup(e,i){const s=this.O.get(e);if(s&&s!==i)throw new Error(`Accessor with usage "${s}" cannot be reused as "${i}".`);return this.O.set(e,i),this}listAccessorUsageGroups(){const e={};for(const[i,s]of Array.from(this.O.entries()))e[s]=e[s]||[],e[s].push(i);return e}}eu.BufferViewTarget=q0,eu.BufferViewUsage=Vu,eu.USAGE_TO_TARGET={[Vu.ARRAY_BUFFER]:q0.ARRAY_BUFFER,[Vu.ELEMENT_ARRAY_BUFFER]:q0.ELEMENT_ARRAY_BUFFER};class jE{constructor(e,i){this.multiple=void 0,this.basename=void 0,this.counter=1,this.multiple=e,this.basename=i}createURI(e,i){return e.getURI()?e.getURI():this.multiple?`${this.basename}_${this.counter++}.${i}`:`${this.basename}.${i}`}}const{BufferViewUsage:Gx}=eu;var mb;(function(c){c[c.JSON=1313821514]="JSON",c[c.BIN=5130562]="BIN"})(mb||(mb={}));class kT extends class{constructor(){this.v=_c.DEFAULT_INSTANCE,this.h=new Set,this.C={},this.F=ab.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this.v=e,this}registerExtensions(e){for(const i of e)this.h.add(i),i.register();return this}registerDependencies(e){return Object.assign(this.C,e),this}setVertexLayout(e){return this.F=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){return e.match(/^data:application\/octet-stream;/)||this.detectFormat(e)===Zc.GLB?this.U(e):this.P(e)}async readJSON(e){return e=this.j(e),this.L(e),class{static read(i,s=FE){const a=Ol({},FE,s),{json:h}=i,d=new zx;this.validate(i,a);const b=new BT(i),X=h.asset,$=d.getRoot().getAsset();X.copyright&&($.copyright=X.copyright),X.extras&&($.extras=X.extras),h.extras!==void 0&&d.getRoot().setExtras(Ol({},h.extras));const Z=h.extensionsUsed||[],re=h.extensionsRequired||[];for(const ye of a.extensions)if(Z.includes(ye.EXTENSION_NAME)){const ge=d.createExtension(ye).setRequired(re.includes(ye.EXTENSION_NAME));for(const Pe of ge.readDependencies)ge.install(Pe,a.dependencies[Pe])}const le=h.buffers||[];d.getRoot().listExtensionsUsed().filter(ye=>ye.prereadTypes.includes(Jn.BUFFER)).forEach(ye=>ye.preread(b,Jn.BUFFER)),b.buffers=le.map(ye=>{const ge=d.createBuffer(ye.name);return ye.extras&&ge.setExtras(ye.extras),ye.uri&&ye.uri.indexOf("__")!==0&&ge.setURI(ye.uri),ge}),b.bufferViewBuffers=(h.bufferViews||[]).map((ye,ge)=>{if(!b.bufferViews[ge]){const Pe=i.json.buffers[ye.buffer];b.bufferViews[ge]=Nr.toView(Pe.uri?i.resources[Pe.uri]:i.resources["@glb.bin"],ye.byteOffset||0,ye.byteLength)}return b.buffers[ye.buffer]}),b.accessors=(h.accessors||[]).map(ye=>{const ge=d.createAccessor(ye.name,b.bufferViewBuffers[ye.bufferView]).setType(ye.type);if(ye.extras&&ge.setExtras(ye.extras),ye.normalized!==void 0&&ge.setNormalized(ye.normalized),ye.bufferView===void 0&&!ye.sparse)return ge;let Pe;return Pe=ye.sparse!==void 0?function(Be,Oe){const Fe=Vx[Be.componentType],Xe=mi.getElementSize(Be.type);let at;at=Be.bufferView!==void 0?fb(Be,Oe):new Fe(Be.count*Xe);const mt=Be.sparse,wt=mt.count,At=Ol({},Be,mt.indices,{count:wt,type:"SCALAR"}),Tt=Ol({},Be,mt.values,{count:wt}),yt=fb(At,Oe),St=fb(Tt,Oe);for(let Ft=0;Ft<At.count;Ft++)for(let Mt=0;Mt<Xe;Mt++)at[yt[Ft]*Xe+Mt]=St[Ft*Xe+Mt];return at}(ye,b):fb(ye,b),ge.setArray(Pe),ge});const he=h.images||[],fe=h.textures||[];d.getRoot().listExtensionsUsed().filter(ye=>ye.prereadTypes.includes(Jn.TEXTURE)).forEach(ye=>ye.preread(b,Jn.TEXTURE)),b.textures=he.map(ye=>{const ge=d.createTexture(ye.name);if(ye.extras&&ge.setExtras(ye.extras),ye.bufferView!==void 0){const Pe=h.bufferViews[ye.bufferView],Be=i.json.buffers[Pe.buffer],Oe=Pe.byteOffset||0,Fe=(Be.uri?i.resources[Be.uri]:i.resources["@glb.bin"]).slice(Oe,Oe+Pe.byteLength);ge.setImage(Fe)}else ye.uri!==void 0&&(ge.setImage(i.resources[ye.uri]),ye.uri.indexOf("__")!==0&&ge.setURI(ye.uri));if(ye.mimeType!==void 0)ge.setMimeType(ye.mimeType);else if(ye.uri){const Pe=jm.extension(ye.uri);ge.setMimeType(tp.extensionToMimeType(Pe))}return ge}),b.materials=(h.materials||[]).map(ye=>{const ge=d.createMaterial(ye.name);ye.extras&&ge.setExtras(ye.extras),ye.alphaMode!==void 0&&ge.setAlphaMode(ye.alphaMode),ye.alphaCutoff!==void 0&&ge.setAlphaCutoff(ye.alphaCutoff),ye.doubleSided!==void 0&&ge.setDoubleSided(ye.doubleSided);const Pe=ye.pbrMetallicRoughness||{};if(Pe.baseColorFactor!==void 0&&ge.setBaseColorFactor(Pe.baseColorFactor),ye.emissiveFactor!==void 0&&ge.setEmissiveFactor(ye.emissiveFactor),Pe.metallicFactor!==void 0&&ge.setMetallicFactor(Pe.metallicFactor),Pe.roughnessFactor!==void 0&&ge.setRoughnessFactor(Pe.roughnessFactor),Pe.baseColorTexture!==void 0){const Be=Pe.baseColorTexture;ge.setBaseColorTexture(b.textures[fe[Be.index].source]),b.setTextureInfo(ge.getBaseColorTextureInfo(),Be)}if(ye.emissiveTexture!==void 0){const Be=ye.emissiveTexture;ge.setEmissiveTexture(b.textures[fe[Be.index].source]),b.setTextureInfo(ge.getEmissiveTextureInfo(),Be)}if(ye.normalTexture!==void 0){const Be=ye.normalTexture;ge.setNormalTexture(b.textures[fe[Be.index].source]),b.setTextureInfo(ge.getNormalTextureInfo(),Be),ye.normalTexture.scale!==void 0&&ge.setNormalScale(ye.normalTexture.scale)}if(ye.occlusionTexture!==void 0){const Be=ye.occlusionTexture;ge.setOcclusionTexture(b.textures[fe[Be.index].source]),b.setTextureInfo(ge.getOcclusionTextureInfo(),Be),ye.occlusionTexture.strength!==void 0&&ge.setOcclusionStrength(ye.occlusionTexture.strength)}if(Pe.metallicRoughnessTexture!==void 0){const Be=Pe.metallicRoughnessTexture;ge.setMetallicRoughnessTexture(b.textures[fe[Be.index].source]),b.setTextureInfo(ge.getMetallicRoughnessTextureInfo(),Be)}return ge});const me=h.meshes||[];d.getRoot().listExtensionsUsed().filter(ye=>ye.prereadTypes.includes(Jn.PRIMITIVE)).forEach(ye=>ye.preread(b,Jn.PRIMITIVE)),b.meshes=me.map(ye=>{const ge=d.createMesh(ye.name);return ye.extras&&ge.setExtras(ye.extras),ye.weights!==void 0&&ge.setWeights(ye.weights),(ye.primitives||[]).forEach(Pe=>{const Be=d.createPrimitive();Pe.extras&&Be.setExtras(Pe.extras),Pe.material!==void 0&&Be.setMaterial(b.materials[Pe.material]),Pe.mode!==void 0&&Be.setMode(Pe.mode);for(const[Fe,Xe]of Object.entries(Pe.attributes||{}))Be.setAttribute(Fe,b.accessors[Xe]);Pe.indices!==void 0&&Be.setIndices(b.accessors[Pe.indices]);const Oe=ye.extras&&ye.extras.targetNames||[];(Pe.targets||[]).forEach((Fe,Xe)=>{const at=Oe[Xe]||Xe.toString(),mt=d.createPrimitiveTarget(at);for(const[wt,At]of Object.entries(Fe))mt.setAttribute(wt,b.accessors[At]);Be.addTarget(mt)}),ge.addPrimitive(Be)}),ge}),b.cameras=(h.cameras||[]).map(ye=>{const ge=d.createCamera(ye.name).setType(ye.type);if(ye.extras&&ge.setExtras(ye.extras),ye.type===zm.Type.PERSPECTIVE){const Pe=ye.perspective;ge.setYFov(Pe.yfov),ge.setZNear(Pe.znear),Pe.zfar!==void 0&&ge.setZFar(Pe.zfar),Pe.aspectRatio!==void 0&&ge.setAspectRatio(Pe.aspectRatio)}else{const Pe=ye.orthographic;ge.setZNear(Pe.znear).setZFar(Pe.zfar).setXMag(Pe.xmag).setYMag(Pe.ymag)}return ge});const Ee=h.nodes||[];d.getRoot().listExtensionsUsed().filter(ye=>ye.prereadTypes.includes(Jn.NODE)).forEach(ye=>ye.preread(b,Jn.NODE)),b.nodes=Ee.map(ye=>{const ge=d.createNode(ye.name);if(ye.extras&&ge.setExtras(ye.extras),ye.translation!==void 0&&ge.setTranslation(ye.translation),ye.rotation!==void 0&&ge.setRotation(ye.rotation),ye.scale!==void 0&&ge.setScale(ye.scale),ye.matrix!==void 0){const Pe=[0,0,0],Be=[0,0,0,1],Oe=[1,1,1];co.decompose(ye.matrix,Pe,Be,Oe),ge.setTranslation(Pe),ge.setRotation(Be),ge.setScale(Oe)}return ye.weights!==void 0&&ge.setWeights(ye.weights),ge}),b.skins=(h.skins||[]).map(ye=>{const ge=d.createSkin(ye.name);ye.extras&&ge.setExtras(ye.extras),ye.inverseBindMatrices!==void 0&&ge.setInverseBindMatrices(b.accessors[ye.inverseBindMatrices]),ye.skeleton!==void 0&&ge.setSkeleton(b.nodes[ye.skeleton]);for(const Pe of ye.joints)ge.addJoint(b.nodes[Pe]);return ge}),Ee.map((ye,ge)=>{const Pe=b.nodes[ge];(ye.children||[]).forEach(Be=>Pe.addChild(b.nodes[Be])),ye.mesh!==void 0&&Pe.setMesh(b.meshes[ye.mesh]),ye.camera!==void 0&&Pe.setCamera(b.cameras[ye.camera]),ye.skin!==void 0&&Pe.setSkin(b.skins[ye.skin])}),b.animations=(h.animations||[]).map(ye=>{const ge=d.createAnimation(ye.name);ye.extras&&ge.setExtras(ye.extras);const Pe=(ye.samplers||[]).map(Be=>{const Oe=d.createAnimationSampler().setInput(b.accessors[Be.input]).setOutput(b.accessors[Be.output]).setInterpolation(Be.interpolation||Q_.Interpolation.LINEAR);return Be.extras&&Oe.setExtras(Be.extras),ge.addSampler(Oe),Oe});return(ye.channels||[]).forEach(Be=>{const Oe=d.createAnimationChannel().setSampler(Pe[Be.sampler]).setTargetPath(Be.target.path);Be.target.node!==void 0&&Oe.setTargetNode(b.nodes[Be.target.node]),Be.extras&&Oe.setExtras(Be.extras),ge.addChannel(Oe)}),ge});const Ae=h.scenes||[];return d.getRoot().listExtensionsUsed().filter(ye=>ye.prereadTypes.includes(Jn.SCENE)).forEach(ye=>ye.preread(b,Jn.SCENE)),b.scenes=Ae.map(ye=>{const ge=d.createScene(ye.name);return ye.extras&&ge.setExtras(ye.extras),(ye.nodes||[]).map(Pe=>b.nodes[Pe]).forEach(Pe=>ge.addChild(Pe)),ge}),h.scene!==void 0&&d.getRoot().setDefaultScene(b.scenes[h.scene]),d.getRoot().listExtensionsUsed().forEach(ye=>ye.read(b)),d}static validate(i,s){const a=i.json;if(a.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${a.asset.version}".`);if(a.extensionsRequired){for(const h of a.extensionsRequired)if(!s.extensions.find(d=>d.EXTENSION_NAME===h))throw new Error(`Missing required extension, "${h}".`)}if(a.extensionsUsed)for(const h of a.extensionsUsed)s.extensions.find(d=>d.EXTENSION_NAME===h)||s.logger.warn(`Missing optional extension, "${h}".`)}}.read(e,{extensions:Array.from(this.h),dependencies:this.C,logger:this.v})}async binaryToJSON(e){const i=this._(Nr.assertView(e));this.L(i);const s=i.json;if(s.buffers&&s.buffers.some(a=>function(h,d){return d.uri!==void 0&&!(d.uri in h.resources)}(i,a)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(s.images&&s.images.some(a=>function(h,d){return d.uri!==void 0&&!(d.uri in h.resources)&&d.bufferView===void 0}(i,a)))throw new Error("Cannot resolve external images with binaryToJSON().");return i}async readBinary(e){return this.readJSON(await this.binaryToJSON(Nr.assertView(e)))}async writeJSON(e,i={}){if(i.format===Zc.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 01 buffers.");return class{static write(s,a){const h=s.getRoot(),d={asset:Ol({generator:"glTF-Transform v2.2.3"},h.getAsset()),extras:Ol({},h.getExtras())},b={json:d,resources:{}},X=new eu(s,b,a),$=a.logger||_c.DEFAULT_INSTANCE,Z=new Set(a.extensions.map(Ae=>Ae.EXTENSION_NAME)),re=s.getRoot().listExtensionsUsed().filter(Ae=>Z.has(Ae.extensionName)),le=s.getRoot().listExtensionsRequired().filter(Ae=>Z.has(Ae.extensionName));re.length<s.getRoot().listExtensionsUsed().length&&$.debug("Some extensions were not registered for I/O, and will not be written.");for(const Ae of re)for(const ye of Ae.writeDependencies)Ae.install(ye,a.dependencies[ye]);function he(Ae,ye,ge,Pe){const Be=[];let Oe=0;for(const Xe of Ae){const at=X.createAccessorDef(Xe);at.bufferView=d.bufferViews.length;const mt=Xe.getArray(),wt=Nr.pad(Nr.toView(mt));at.byteOffset=Oe,Oe+=wt.byteLength,Be.push(wt),X.accessorIndexMap.set(Xe,d.accessors.length),d.accessors.push(at)}const Fe={buffer:ye,byteOffset:ge,byteLength:Nr.concat(Be).byteLength};return Pe&&(Fe.target=Pe),d.bufferViews.push(Fe),{buffers:Be,byteLength:Oe}}function fe(Ae,ye,ge){const Pe=Ae[0].getCount();let Be=0;for(const at of Ae){const mt=X.createAccessorDef(at);mt.bufferView=d.bufferViews.length,mt.byteOffset=Be;const wt=at.getElementSize(),At=at.getComponentSize();Be+=Nr.padNumber(wt*At),X.accessorIndexMap.set(at,d.accessors.length),d.accessors.push(mt)}const Oe=Pe*Be,Fe=new ArrayBuffer(Oe),Xe=new DataView(Fe);for(let at=0;at<Pe;at++){let mt=0;for(const wt of Ae){const At=wt.getElementSize(),Tt=wt.getComponentSize(),yt=wt.getComponentType(),St=wt.getArray();for(let Ft=0;Ft<At;Ft++){const Mt=at*Be+mt+Ft*Tt,Gt=St[at*At+Ft];switch(yt){case mi.ComponentType.FLOAT:Xe.setFloat32(Mt,Gt,!0);break;case mi.ComponentType.BYTE:Xe.setInt8(Mt,Gt);break;case mi.ComponentType.SHORT:Xe.setInt16(Mt,Gt,!0);break;case mi.ComponentType.UNSIGNED_BYTE:Xe.setUint8(Mt,Gt);break;case mi.ComponentType.UNSIGNED_SHORT:Xe.setUint16(Mt,Gt,!0);break;case mi.ComponentType.UNSIGNED_INT:Xe.setUint32(Mt,Gt,!0);break;default:throw new Error("Unexpected component type: "+yt)}}mt+=Nr.padNumber(At*Tt)}}return d.bufferViews.push({buffer:ye,byteOffset:ge,byteLength:Oe,byteStride:Be,target:eu.BufferViewTarget.ARRAY_BUFFER}),{byteLength:Oe,buffers:[new Uint8Array(Fe)]}}const me=new Map;for(const Ae of s.getGraph().listEdges()){if(Ae.getParent()===h)continue;const ye=Ae.getChild();if(ye instanceof mi){const ge=me.get(ye)||[];ge.push(Ae),me.set(ye,ge)}}if(d.accessors=[],d.bufferViews=[],d.samplers=[],d.textures=[],d.images=h.listTextures().map((Ae,ye)=>{const ge=X.createPropertyDef(Ae);Ae.getMimeType()&&(ge.mimeType=Ae.getMimeType());const Pe=Ae.getImage();return Pe&&X.createImageData(ge,Pe,Ae),X.imageIndexMap.set(Ae,ye),ge}),re.filter(Ae=>Ae.prewriteTypes.includes(Jn.ACCESSOR)).forEach(Ae=>Ae.prewrite(X,Jn.ACCESSOR)),h.listAccessors().forEach(Ae=>{const ye=X.accessorUsageGroupedByParent,ge=X.accessorParents;if(X.accessorIndexMap.has(Ae))return;const Pe=me.get(Ae)||[],Be=X.getAccessorUsage(Ae);if(X.addAccessorToUsageGroup(Ae,Be),ye.has(Be)){const Oe=Pe[0].getParent(),Fe=ge.get(Oe)||new Set;Fe.add(Ae),ge.set(Oe,Fe)}}),re.filter(Ae=>Ae.prewriteTypes.includes(Jn.BUFFER)).forEach(Ae=>Ae.prewrite(X,Jn.BUFFER)),(h.listAccessors().length>0||h.listTextures().length>0||X.otherBufferViews.size>0)&&h.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");d.buffers=[],h.listBuffers().forEach((Ae,ye)=>{const ge=X.createPropertyDef(Ae),Pe=X.accessorUsageGroupedByParent,Be=X.accessorParents,Oe=Ae.listParents().filter(At=>At instanceof mi),Fe=new Set(Oe),Xe=[],at=d.buffers.length;let mt=0;const wt=X.listAccessorUsageGroups();for(const At in wt)if(Pe.has(At))for(const Tt of Array.from(Be.values())){const yt=Array.from(Tt).filter(St=>Fe.has(St)).filter(St=>X.getAccessorUsage(St)===At);if(yt.length)if(At!==Gx.ARRAY_BUFFER||a.vertexLayout===ab.INTERLEAVED){const St=At===Gx.ARRAY_BUFFER?fe(yt,at,mt):he(yt,at,mt);mt+=St.byteLength,Xe.push(...St.buffers)}else for(const St of yt){const Ft=fe([St],at,mt);mt+=Ft.byteLength,Xe.push(...Ft.buffers)}}else{const Tt=wt[At].filter(St=>Fe.has(St));if(!Tt.length)continue;const yt=he(Tt,at,mt,At===Gx.ELEMENT_ARRAY_BUFFER?eu.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0);mt+=yt.byteLength,Xe.push(...yt.buffers)}if(X.imageBufferViews.length&&ye===0){for(let At=0;At<X.imageBufferViews.length;At++)if(d.bufferViews[d.images[At].bufferView].byteOffset=mt,mt+=X.imageBufferViews[At].byteLength,Xe.push(X.imageBufferViews[At]),mt%8){const Tt=8-mt%8;mt+=Tt,Xe.push(new Uint8Array(Tt))}}if(X.otherBufferViews.has(Ae))for(const At of X.otherBufferViews.get(Ae))d.bufferViews.push({buffer:at,byteOffset:mt,byteLength:At.byteLength}),X.otherBufferViewsIndexMap.set(At,d.bufferViews.length-1),mt+=At.byteLength,Xe.push(At);if(mt){let At;a.format===Zc.GLB?At="@glb.bin":(At=X.bufferURIGenerator.createURI(Ae,"bin"),ge.uri=At),ge.byteLength=mt,b.resources[At]=Nr.concat(Xe)}d.buffers.push(ge),X.bufferIndexMap.set(Ae,ye)}),h.listAccessors().find(Ae=>!Ae.getBuffer())&&$.warn("Skipped writing one or more Accessors: no Buffer assigned."),d.materials=h.listMaterials().map((Ae,ye)=>{const ge=X.createPropertyDef(Ae);if(Ae.getAlphaMode()!==Vm.AlphaMode.OPAQUE&&(ge.alphaMode=Ae.getAlphaMode()),Ae.getAlphaMode()===Vm.AlphaMode.MASK&&(ge.alphaCutoff=Ae.getAlphaCutoff()),Ae.getDoubleSided()&&(ge.doubleSided=!0),ge.pbrMetallicRoughness={},co.eq(Ae.getBaseColorFactor(),[1,1,1,1])||(ge.pbrMetallicRoughness.baseColorFactor=Ae.getBaseColorFactor()),co.eq(Ae.getEmissiveFactor(),[0,0,0])||(ge.emissiveFactor=Ae.getEmissiveFactor()),Ae.getRoughnessFactor()!==1&&(ge.pbrMetallicRoughness.roughnessFactor=Ae.getRoughnessFactor()),Ae.getMetallicFactor()!==1&&(ge.pbrMetallicRoughness.metallicFactor=Ae.getMetallicFactor()),Ae.getBaseColorTexture()){const Pe=Ae.getBaseColorTexture(),Be=Ae.getBaseColorTextureInfo();ge.pbrMetallicRoughness.baseColorTexture=X.createTextureInfoDef(Pe,Be)}if(Ae.getEmissiveTexture()){const Pe=Ae.getEmissiveTexture(),Be=Ae.getEmissiveTextureInfo();ge.emissiveTexture=X.createTextureInfoDef(Pe,Be)}if(Ae.getNormalTexture()){const Pe=Ae.getNormalTexture(),Be=Ae.getNormalTextureInfo(),Oe=X.createTextureInfoDef(Pe,Be);Ae.getNormalScale()!==1&&(Oe.scale=Ae.getNormalScale()),ge.normalTexture=Oe}if(Ae.getOcclusionTexture()){const Pe=Ae.getOcclusionTexture(),Be=Ae.getOcclusionTextureInfo(),Oe=X.createTextureInfoDef(Pe,Be);Ae.getOcclusionStrength()!==1&&(Oe.strength=Ae.getOcclusionStrength()),ge.occlusionTexture=Oe}if(Ae.getMetallicRoughnessTexture()){const Pe=Ae.getMetallicRoughnessTexture(),Be=Ae.getMetallicRoughnessTextureInfo();ge.pbrMetallicRoughness.metallicRoughnessTexture=X.createTextureInfoDef(Pe,Be)}return X.materialIndexMap.set(Ae,ye),ge}),d.meshes=h.listMeshes().map((Ae,ye)=>{const ge=X.createPropertyDef(Ae);let Pe=null;return ge.primitives=Ae.listPrimitives().map(Be=>{const Oe={attributes:{}};Oe.mode=Be.getMode();const Fe=Be.getMaterial();Fe&&(Oe.material=X.materialIndexMap.get(Fe)),Object.keys(Be.getExtras()).length&&(Oe.extras=Be.getExtras());const Xe=Be.getIndices();Xe&&(Oe.indices=X.accessorIndexMap.get(Xe));for(const at of Be.listSemantics())Oe.attributes[at]=X.accessorIndexMap.get(Be.getAttribute(at));for(const at of Be.listTargets()){const mt={};for(const wt of at.listSemantics())mt[wt]=X.accessorIndexMap.get(at.getAttribute(wt));Oe.targets=Oe.targets||[],Oe.targets.push(mt)}return Be.listTargets().length&&!Pe&&(Pe=Be.listTargets().map(at=>at.getName())),Oe}),Ae.getWeights().length&&(ge.weights=Ae.getWeights()),Pe&&(ge.extras=ge.extras||{},ge.extras.targetNames=Pe),X.meshIndexMap.set(Ae,ye),ge}),d.cameras=h.listCameras().map((Ae,ye)=>{const ge=X.createPropertyDef(Ae);if(ge.type=Ae.getType(),ge.type===zm.Type.PERSPECTIVE){ge.perspective={znear:Ae.getZNear(),zfar:Ae.getZFar(),yfov:Ae.getYFov()};const Pe=Ae.getAspectRatio();Pe!==null&&(ge.perspective.aspectRatio=Pe)}else ge.orthographic={znear:Ae.getZNear(),zfar:Ae.getZFar(),xmag:Ae.getXMag(),ymag:Ae.getYMag()};return X.cameraIndexMap.set(Ae,ye),ge}),d.nodes=h.listNodes().map((Ae,ye)=>{const ge=X.createPropertyDef(Ae);return co.eq(Ae.getTranslation(),[0,0,0])||(ge.translation=Ae.getTranslation()),co.eq(Ae.getRotation(),[0,0,0,1])||(ge.rotation=Ae.getRotation()),co.eq(Ae.getScale(),[1,1,1])||(ge.scale=Ae.getScale()),Ae.getWeights().length&&(ge.weights=Ae.getWeights()),X.nodeIndexMap.set(Ae,ye),ge}),d.skins=h.listSkins().map((Ae,ye)=>{const ge=X.createPropertyDef(Ae),Pe=Ae.getInverseBindMatrices();Pe&&(ge.inverseBindMatrices=X.accessorIndexMap.get(Pe));const Be=Ae.getSkeleton();return Be&&(ge.skeleton=X.nodeIndexMap.get(Be)),ge.joints=Ae.listJoints().map(Oe=>X.nodeIndexMap.get(Oe)),X.skinIndexMap.set(Ae,ye),ge}),h.listNodes().forEach((Ae,ye)=>{const ge=d.nodes[ye],Pe=Ae.getMesh();Pe&&(ge.mesh=X.meshIndexMap.get(Pe));const Be=Ae.getCamera();Be&&(ge.camera=X.cameraIndexMap.get(Be));const Oe=Ae.getSkin();Oe&&(ge.skin=X.skinIndexMap.get(Oe)),Ae.listChildren().length>0&&(ge.children=Ae.listChildren().map(Fe=>X.nodeIndexMap.get(Fe)))}),d.animations=h.listAnimations().map((Ae,ye)=>{const ge=X.createPropertyDef(Ae),Pe=new Map;return ge.samplers=Ae.listSamplers().map((Be,Oe)=>{const Fe=X.createPropertyDef(Be);return Fe.input=X.accessorIndexMap.get(Be.getInput()),Fe.output=X.accessorIndexMap.get(Be.getOutput()),Fe.interpolation=Be.getInterpolation(),Pe.set(Be,Oe),Fe}),ge.channels=Ae.listChannels().map(Be=>{const Oe=X.createPropertyDef(Be);return Oe.sampler=Pe.get(Be.getSampler()),Oe.target={node:X.nodeIndexMap.get(Be.getTargetNode()),path:Be.getTargetPath()},Oe}),X.animationIndexMap.set(Ae,ye),ge}),d.scenes=h.listScenes().map((Ae,ye)=>{const ge=X.createPropertyDef(Ae);return ge.nodes=Ae.listChildren().map(Pe=>X.nodeIndexMap.get(Pe)),X.sceneIndexMap.set(Ae,ye),ge});const Ee=h.getDefaultScene();return Ee&&(d.scene=h.listScenes().indexOf(Ee)),d.extensionsUsed=re.map(Ae=>Ae.extensionName),d.extensionsRequired=le.map(Ae=>Ae.extensionName),re.forEach(Ae=>Ae.write(X)),function(Ae){const ye=[];for(const ge in Ae){const Pe=Ae[ge];(Array.isArray(Pe)&&Pe.length===0||Pe===null||Pe===""||Pe&&typeof Pe=="object"&&Object.keys(Pe).length===0)&&ye.push(ge)}for(const ge of ye)delete Ae[ge]}(d),b}}.write(e,{format:i.format||Zc.GLTF,basename:i.basename||"",logger:this.v,vertexLayout:this.F,dependencies:Ol({},this.C),extensions:Array.from(this.h)})}async writeBinary(e){const{json:i,resources:s}=await this.writeJSON(e,{format:Zc.GLB}),a=new Uint32Array([1179937895,2,12]),h=JSON.stringify(i),d=Nr.pad(Nr.encodeText(h),32),b=Nr.toView(new Uint32Array([d.byteLength,1313821514])),X=Nr.concat([b,d]);a[a.length-1]+=X.byteLength;const $=Object.values(s)[0];if(!$||!$.byteLength)return Nr.concat([Nr.toView(a),X]);const Z=Nr.pad($,0),re=Nr.toView(new Uint32Array([Z.byteLength,5130562])),le=Nr.concat([re,Z]);return a[a.length-1]+=le.byteLength,Nr.concat([Nr.toView(a),X,le])}detectFormat(e){return(ff.isAbsoluteURL(e)?ff.extension(e):jm.extension(e))==="glb"?Zc.GLB:Zc.GLTF}async P(e){this.lastReadBytes=0;const i=await this.readURI(e,"text");this.lastReadBytes+=i.length;const s={json:JSON.parse(i),resources:{}};return await this.D(s,this.dirname(e)),this.L(s),s}async U(e){const i=await this.readURI(e,"view");this.lastReadBytes=i.byteLength;const s=this._(i);return await this.D(s,this.dirname(e)),this.L(s),s}async D(e,i){var s=this;const a=[...e.json.images||[],...e.json.buffers||[]].map(async function(h){const d=h.uri;if(!d||d.match(/data:/))return Promise.resolve();e.resources[d]=await s.readURI(s.resolve(i,d),"view"),s.lastReadBytes+=e.resources[d].byteLength});await Promise.all(a)}L(e){function i(s){if(s.uri){if(s.uri in e.resources)Nr.assertView(e.resources[s.uri]);else if(s.uri.match(/data:/)){const a=`__${function(){for(let h=0;h<999;h++){const d=IT();if(!PE.has(d))return PE.add(d),d}return""}()}.${jm.extension(s.uri)}`;e.resources[a]=Nr.createBufferFromDataURI(s.uri),s.uri=a}}}(e.json.images||[]).forEach(s=>{if(s.bufferView===void 0&&s.uri===void 0)throw new Error("Missing resource URI or buffer view.");i(s)}),(e.json.buffers||[]).forEach(i)}j(e){const{images:i,buffers:s}=e.json;return e={json:Ol({},e.json),resources:Ol({},e.resources)},i&&(e.json.images=i.map(a=>Ol({},a))),s&&(e.json.buffers=s.map(a=>Ol({},a))),e}_(e){const i=new Uint32Array(e.buffer,e.byteOffset,3);if(i[0]!==1179937895)throw new Error("Invalid glTF asset.");if(i[1]!==2)throw new Error(`Unsupported glTF binary version, "${i[1]}".`);const s=new Uint32Array(e.buffer,e.byteOffset+12,2);if(s[1]!==mb.JSON)throw new Error("Missing required GLB JSON chunk.");const a=s[0],h=Nr.decodeText(Nr.toView(e,20,a)),d=JSON.parse(h),b=20+a;if(e.byteLength<=b)return{json:d,resources:{}};const X=new Uint32Array(e.buffer,e.byteOffset+b,2);if(X[1]!==mb.BIN)throw new Error("Expected GLB BIN in second chunk.");return{json:d,resources:{"@glb.bin":Nr.toView(e,b+8,X[0])}}}}{constructor(e=ff.DEFAULT_INIT){super(),this.V=void 0,this.V=e}async readURI(e,i){const s=await fetch(e,this.V);switch(i){case"view":return new Uint8Array(await s.arrayBuffer());case"text":return s.text()}}resolve(e,i){return ff.resolve(e,i)}dirname(e){return ff.dirname(e)}detectFormat(e){return ff.extension(e)==="glb"?Zc.GLB:Zc.GLTF}}class OT{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Y0{constructor(e,i,s,a){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+i,s),this._littleEndian=a,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,i=0){const s=this._offset;let a=0;for(;this._dataView.getUint8(this._offset)!==i&&a<e;)a++,this._offset++;return a<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+s,a)}}const ll=[171,75,84,88,32,50,48,187,13,10,26,10];function zE(c){return typeof TextDecoder<"u"?new TextDecoder().decode(c):Buffer.from(c).toString("utf8")}function Qx(c){const e=new Uint8Array(c.buffer,c.byteOffset,ll.length);if(e[0]!==ll[0]||e[1]!==ll[1]||e[2]!==ll[2]||e[3]!==ll[3]||e[4]!==ll[4]||e[5]!==ll[5]||e[6]!==ll[6]||e[7]!==ll[7]||e[8]!==ll[8]||e[9]!==ll[9]||e[10]!==ll[10]||e[11]!==ll[11])throw new Error("Missing KTX 2.0 identifier.");const i=new OT,s=17*Uint32Array.BYTES_PER_ELEMENT,a=new Y0(c,ll.length,s,!0);i.vkFormat=a._nextUint32(),i.typeSize=a._nextUint32(),i.pixelWidth=a._nextUint32(),i.pixelHeight=a._nextUint32(),i.pixelDepth=a._nextUint32(),i.layerCount=a._nextUint32(),i.faceCount=a._nextUint32();const h=a._nextUint32();i.supercompressionScheme=a._nextUint32();const d=a._nextUint32(),b=a._nextUint32(),X=a._nextUint32(),$=a._nextUint32(),Z=a._nextUint64(),re=a._nextUint64(),le=new Y0(c,ll.length+s,3*h*8,!0);for(let Mt=0;Mt<h;Mt++)i.levels.push({levelData:new Uint8Array(c.buffer,c.byteOffset+le._nextUint64(),le._nextUint64()),uncompressedByteLength:le._nextUint64()});const he=new Y0(c,d,b,!0),fe={vendorId:he._skip(4)._nextUint16(),descriptorType:he._nextUint16(),versionNumber:he._nextUint16(),descriptorBlockSize:he._nextUint16(),colorModel:he._nextUint8(),colorPrimaries:he._nextUint8(),transferFunction:he._nextUint8(),flags:he._nextUint8(),texelBlockDimension:[he._nextUint8(),he._nextUint8(),he._nextUint8(),he._nextUint8()],bytesPlane:[he._nextUint8(),he._nextUint8(),he._nextUint8(),he._nextUint8(),he._nextUint8(),he._nextUint8(),he._nextUint8(),he._nextUint8()],samples:[]},me=(fe.descriptorBlockSize/4-6)/4;for(let Mt=0;Mt<me;Mt++){const Gt={bitOffset:he._nextUint16(),bitLength:he._nextUint8(),channelType:he._nextUint8(),samplePosition:[he._nextUint8(),he._nextUint8(),he._nextUint8(),he._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&Gt.channelType?(Gt.sampleLower=he._nextInt32(),Gt.sampleUpper=he._nextInt32()):(Gt.sampleLower=he._nextUint32(),Gt.sampleUpper=he._nextUint32()),fe.samples[Mt]=Gt}i.dataFormatDescriptor.length=0,i.dataFormatDescriptor.push(fe);const Ee=new Y0(c,X,$,!0);for(;Ee._offset<$;){const Mt=Ee._nextUint32(),Gt=Ee._scan(Mt),rn=zE(Gt),gn=Ee._scan(Mt-Gt.byteLength);i.keyValue[rn]=rn.match(/^ktx/i)?zE(gn):gn,Ee._offset%4&&Ee._skip(4-Ee._offset%4)}if(re<=0)return i;const Ae=new Y0(c,Z,re,!0),ye=Ae._nextUint16(),ge=Ae._nextUint16(),Pe=Ae._nextUint32(),Be=Ae._nextUint32(),Oe=Ae._nextUint32(),Fe=Ae._nextUint32(),Xe=[];for(let Mt=0;Mt<h;Mt++)Xe.push({imageFlags:Ae._nextUint32(),rgbSliceByteOffset:Ae._nextUint32(),rgbSliceByteLength:Ae._nextUint32(),alphaSliceByteOffset:Ae._nextUint32(),alphaSliceByteLength:Ae._nextUint32()});const at=Z+Ae._offset,mt=at+Pe,wt=mt+Be,At=wt+Oe,Tt=new Uint8Array(c.buffer,c.byteOffset+at,Pe),yt=new Uint8Array(c.buffer,c.byteOffset+mt,Be),St=new Uint8Array(c.buffer,c.byteOffset+wt,Oe),Ft=new Uint8Array(c.buffer,c.byteOffset+At,Fe);return i.globalData={endpointCount:ye,selectorCount:ge,imageDescs:Xe,endpointsData:Tt,selectorsData:yt,tablesData:St,extendedData:Ft},i}class VE extends Eo{init(){this.extensionName="EXT_mesh_gpu_instancing",this.propertyType="InstancedMesh",this.parentTypes=[Jn.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,i){return this.setRefMap("attributes",e,i,{usage:"INSTANCE_ATTRIBUTE"})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}VE.EXTENSION_NAME="EXT_mesh_gpu_instancing";const Qm="EXT_mesh_gpu_instancing";function mf(){return(mf=Object.assign||function(c){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(c[s]=i[s])}return c}).apply(this,arguments)}var X0,H_,So;(class extends to{constructor(...c){super(...c),this.extensionName=Qm,this.provideTypes=[Jn.NODE],this.prewriteTypes=[Jn.ACCESSOR]}createInstancedMesh(){return new VE(this.document.getGraph())}read(c){return(c.jsonDoc.json.nodes||[]).forEach((e,i)=>{if(!e.extensions||!e.extensions[Qm])return;const s=e.extensions[Qm],a=this.createInstancedMesh();for(const h in s.attributes)a.setAttribute(h,c.accessors[s.attributes[h]]);c.nodes[i].setExtension(Qm,a)}),this}prewrite(c){c.accessorUsageGroupedByParent.add("INSTANCE_ATTRIBUTE");for(const e of this.properties)for(const i of e.listAttributes())c.addAccessorToUsageGroup(i,"INSTANCE_ATTRIBUTE");return this}write(c){const e=c.jsonDoc;return this.document.getRoot().listNodes().forEach(i=>{const s=i.getExtension(Qm);if(s){const a=c.nodeIndexMap.get(i),h=e.json.nodes[a],d={attributes:{}};s.listSemantics().forEach(b=>{const X=s.getAttribute(b);d.attributes[b]=c.accessorIndexMap.get(X)}),h.extensions=h.extensions||{},h.extensions[Qm]=d}}),this}}).EXTENSION_NAME=Qm,function(c){c.QUANTIZE="quantize",c.FILTER="filter"}(X0||(X0={})),function(c){c.ATTRIBUTES="ATTRIBUTES",c.TRIANGLES="TRIANGLES",c.INDICES="INDICES"}(H_||(H_={})),function(c){c.NONE="NONE",c.OCTAHEDRAL="OCTAHEDRAL",c.QUATERNION="QUATERNION",c.EXPONENTIAL="EXPONENTIAL"}(So||(So={}));const{BYTE:LT,SHORT:GE,FLOAT:NT}=mi.ComponentType,{normalize:QE,denormalize:Hx}=co;function UT(c,e,i,s){const{filter:a,bits:h}=s,d={array:c.getArray(),byteStride:c.getElementSize()*c.getComponentSize(),componentType:c.getComponentType(),normalized:c.getNormalized()};if(i!==H_.ATTRIBUTES)return d;if(a!==So.NONE){let b=c.getNormalized()?function(X){const $=X.getComponentType(),Z=X.getArray(),re=new Float32Array(Z.length);for(let le=0;le<Z.length;le++)re[le]=Hx(Z[le],$);return re}(c):new Float32Array(d.array);switch(a){case So.EXPONENTIAL:d.byteStride=4*c.getElementSize(),d.componentType=NT,d.normalized=!1,d.array=e.encodeFilterExp(b,c.getCount(),d.byteStride,h);break;case So.OCTAHEDRAL:d.byteStride=h>8?8:4,d.componentType=h>8?GE:LT,d.normalized=!0,b=c.getElementSize()===3?function(X){const $=new Float32Array(4*X.length/3);for(let Z=0,re=X.length/3;Z<re;Z++)$[4*Z]=X[3*Z],$[4*Z+1]=X[3*Z+1],$[4*Z+2]=X[3*Z+2];return $}(b):b,d.array=e.encodeFilterOct(b,c.getCount(),d.byteStride,h);break;case So.QUATERNION:d.byteStride=8,d.componentType=GE,d.normalized=!0,d.array=e.encodeFilterQuat(b,c.getCount(),d.byteStride,h);break;default:throw new Error("Invalid filter.")}d.min=c.getMin([]),d.max=c.getMax([]),c.getNormalized()&&(d.min=d.min.map(X=>Hx(X,c.getComponentType())),d.max=d.max.map(X=>Hx(X,c.getComponentType()))),d.normalized&&(d.min=d.min.map(X=>QE(X,d.componentType)),d.max=d.max.map(X=>QE(X,d.componentType)))}else d.byteStride%4&&(d.array=function(b,X){const $=Nr.padNumber(b.BYTES_PER_ELEMENT*X)/b.BYTES_PER_ELEMENT,Z=new b.constructor(b.length/X*$);for(let re=0;re*X<b.length;re++)for(let le=0;le<X;le++)Z[re*$+le]=b[re*X+le];return Z}(d.array,c.getElementSize()),d.byteStride=d.array.byteLength/c.getCount());return d}function FT(c,e){return e===eu.BufferViewUsage.ELEMENT_ARRAY_BUFFER?c.listParents().some(i=>i instanceof Gm&&i.getMode()===Gm.Mode.TRIANGLES)?H_.TRIANGLES:H_.INDICES:H_.ATTRIBUTES}function jT(c,e){const i=e.getGraph().listParentEdges(c).filter(s=>!(s.getParent()instanceof UE));for(const s of i){const a=s.getName(),h=s.getAttributes().key||"";if(a==="indices")return{filter:So.NONE};if(a==="attributes"){if(h==="POSITION")return{filter:So.NONE};if(h==="TEXCOORD_0")return{filter:So.NONE};if(h==="NORMAL")return{filter:So.OCTAHEDRAL,bits:8};if(h==="TANGENT")return{filter:So.OCTAHEDRAL,bits:8};if(h.startsWith("JOINTS_"))return{filter:So.NONE};if(h.startsWith("WEIGHTS_"))return{filter:So.NONE}}if(a==="output"){const d=HE(c);return d==="rotation"?{filter:So.QUATERNION,bits:16}:d==="translation"||d==="scale"?{filter:So.EXPONENTIAL,bits:12}:{filter:So.NONE}}if(a==="input")return{filter:So.NONE};if(a==="inverseBindMatrices")return{filter:So.NONE}}return{filter:So.NONE}}function HE(c){for(const e of c.listParents())if(e instanceof Q_){for(const i of e.listParents())if(i instanceof jx)return i.getTargetPath()}return null}const cl="EXT_meshopt_compression",WE={method:X0.QUANTIZE};class qE extends to{constructor(...e){super(...e),this.extensionName=cl,this.prereadTypes=[Jn.BUFFER,Jn.PRIMITIVE],this.prewriteTypes=[Jn.BUFFER,Jn.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=WE,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,i){return e==="meshopt.decoder"&&(this._decoder=i),e==="meshopt.encoder"&&(this._encoder=i),this}setEncoderOptions(e){return this._encoderOptions=mf({},WE,e),this}preread(e,i){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${cl}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${cl}]: Missing WASM support.`)}return i===Jn.BUFFER?this._prereadBuffers(e):i===Jn.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const i=e.jsonDoc;(i.json.bufferViews||[]).forEach((s,a)=>{if(!s.extensions||!s.extensions[cl])return;const h=s.extensions[cl],d=h.byteOffset||0,b=h.byteLength||0,X=h.count,$=h.byteStride,Z=new Uint8Array(X*$),re=i.json.buffers[s.buffer],le=Nr.toView(re.uri?i.resources[re.uri]:i.resources["@glb.bin"],d,b);this._decoder.decodeGltfBuffer(Z,X,$,le,h.mode,h.filter),e.bufferViews[a]=Z})}_prereadPrimitives(e){const i=e.jsonDoc;(i.json.bufferViews||[]).forEach(s=>{var a;s.extensions&&s.extensions[cl]&&(a=i.json.buffers[s.buffer]).extensions&&a.extensions.EXT_meshopt_compression&&a.extensions.EXT_meshopt_compression.fallback&&this._decoderFallbackBufferMap.set(e.buffers[s.buffer],e.buffers[s.extensions[cl].buffer])})}read(e){if(!this.isRequired())return this;for(const[i,s]of this._decoderFallbackBufferMap){for(const a of i.listParents())a instanceof mi&&a.swap(i,s);i.dispose()}return this}prewrite(e,i){return i===Jn.ACCESSOR?this._prewriteAccessors(e):i===Jn.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const i=e.jsonDoc.json,s=this._encoder,a=this._encoderOptions,h=this.document.createBuffer(),d=this.document.getRoot().listBuffers().indexOf(h);this._encoderFallbackBuffer=h,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const b of this.document.getRoot().listAccessors()){if(HE(b)==="weights")continue;const X=e.getAccessorUsage(b),$=FT(b,X),Z=a.method===X0.FILTER?jT(b,this.document):{filter:So.NONE},re=UT(b,s,$,Z),{array:le,byteStride:he}=re,fe=b.getBuffer();if(!fe)throw new Error(`${cl}: Missing buffer for accessor.`);const me=this.document.getRoot().listBuffers().indexOf(fe),Ee=[X,$,Z.filter,he,me].join(":");let Ae=this._encoderBufferViews[Ee],ye=this._encoderBufferViewData[Ee],ge=this._encoderBufferViewAccessors[Ee];Ae&&ye||(ge=this._encoderBufferViewAccessors[Ee]=[],ye=this._encoderBufferViewData[Ee]=[],Ae=this._encoderBufferViews[Ee]={buffer:d,target:eu.USAGE_TO_TARGET[X],byteOffset:0,byteLength:0,byteStride:X===eu.BufferViewUsage.ARRAY_BUFFER?he:void 0,extensions:{[cl]:{buffer:me,byteOffset:0,byteLength:0,mode:$,filter:Z.filter!==So.NONE?Z.filter:void 0,byteStride:he,count:0}}});const Pe=e.createAccessorDef(b);Pe.componentType=re.componentType,Pe.normalized=re.normalized,Pe.byteOffset=Ae.byteLength,Pe.min&&re.min&&(Pe.min=re.min),Pe.max&&re.max&&(Pe.max=re.max),e.accessorIndexMap.set(b,i.accessors.length),i.accessors.push(Pe),ge.push(Pe),ye.push(new Uint8Array(le.buffer,le.byteOffset,le.byteLength)),Ae.byteLength+=le.byteLength,Ae.extensions.EXT_meshopt_compression.count+=b.getCount()}}_prewriteBuffers(e){const i=this._encoder;for(const s in this._encoderBufferViews){const a=this._encoderBufferViews[s],h=this._encoderBufferViewData[s],d=this.document.getRoot().listBuffers()[a.extensions[cl].buffer],b=e.otherBufferViews.get(d)||[],{count:X,byteStride:$,mode:Z}=a.extensions[cl],re=Nr.concat(h),le=i.encodeGltfBuffer(re,X,$,Z),he=Nr.pad(le);a.extensions[cl].byteLength=le.byteLength,h.length=0,h.push(he),b.push(he),e.otherBufferViews.set(d,b)}}write(e){let i=0;for(const d in this._encoderBufferViews){const b=this._encoderBufferViews[d],X=e.otherBufferViewsIndexMap.get(this._encoderBufferViewData[d][0]),$=this._encoderBufferViewAccessors[d];for(const le of $)le.bufferView=X;const Z=e.jsonDoc.json.bufferViews[X],re=Z.byteOffset||0;Object.assign(Z,b),Z.byteOffset=i,Z.extensions[cl].byteOffset=re,i+=Nr.padNumber(b.byteLength)}const s=this._encoderFallbackBuffer,a=e.bufferIndexMap.get(s),h=e.jsonDoc.json.buffers[a];return h.byteLength=i,h.extensions={[cl]:{fallback:!0}},s.dispose(),this}}qE.EXTENSION_NAME=cl,qE.EncoderMethod=X0;const YE="EXT_texture_webp";class zT{match(e){return e.length>=12&&e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80}getSize(e){const i=Nr.decodeText(e.slice(0,4)),s=Nr.decodeText(e.slice(8,12));if(i!=="RIFF"||s!=="WEBP")return null;const a=new DataView(e.buffer,e.byteOffset);let h=12;for(;h<a.byteLength;){const d=Nr.decodeText(new Uint8Array([a.getUint8(h),a.getUint8(h+1),a.getUint8(h+2),a.getUint8(h+3)])),b=a.getUint32(h+4,!0);if(d==="VP8 ")return[16383&a.getInt16(h+14,!0),16383&a.getInt16(h+16,!0)];if(d==="VP8L"){const X=a.getUint8(h+9),$=a.getUint8(h+10),Z=a.getUint8(h+11);return[1+((63&$)<<8|X),1+((15&a.getUint8(h+12))<<10|Z<<2|(192&$)>>6)]}h+=8+b+b%2}return null}getChannels(e){return 4}}(class extends to{constructor(...c){super(...c),this.extensionName=YE,this.prereadTypes=[Jn.TEXTURE]}static register(){tp.registerFormat("image/webp",new zT)}preread(c){return(c.jsonDoc.json.textures||[]).forEach(e=>{e.extensions&&e.extensions.EXT_texture_webp&&(e.source=e.extensions.EXT_texture_webp.source)}),this}read(c){return this}write(c){const e=c.jsonDoc;return this.document.getRoot().listTextures().forEach(i=>{if(i.getMimeType()==="image/webp"){const s=c.imageIndexMap.get(i);(e.json.textures||[]).forEach(a=>{a.source===s&&(a.extensions=a.extensions||{},a.extensions.EXT_texture_webp={source:a.source},delete a.source)})}}),this}}).EXTENSION_NAME=YE;const XE="KHR_draco_mesh_compression";let Ko,KE,JE,Ll;function VT(c,e){const i=new Ko.DecoderBuffer;try{if(i.Init(e,e.length),c.GetEncodedGeometryType(i)!==Ko.TRIANGULAR_MESH)throw new Error(`[${XE}] Unknown geometry type.`);const s=new Ko.Mesh;if(!c.DecodeBufferToMesh(i,s).ok()||s.ptr===0)throw new Error(`[${XE}] Decoding failure.`);return s}finally{Ko.destroy(i)}}function GT(c,e){const i=3*e.num_faces();let s,a;if(e.num_points()<=65534){const h=i*Uint16Array.BYTES_PER_ELEMENT;s=Ko._malloc(h),c.GetTrianglesUInt16Array(e,h,s),a=new Uint16Array(Ko.HEAPU16.buffer,s,i).slice()}else{const h=i*Uint32Array.BYTES_PER_ELEMENT;s=Ko._malloc(h),c.GetTrianglesUInt32Array(e,h,s),a=new Uint32Array(Ko.HEAPU32.buffer,s,i).slice()}return Ko._free(s),a}function QT(c,e,i,s){const a=JE[s.componentType],h=KE[s.componentType],d=i.num_components(),b=e.num_points()*d,X=b*h.BYTES_PER_ELEMENT,$=Ko._malloc(X);c.GetAttributeDataArrayForAllPoints(e,i,a,X,$);const Z=new h(Ko.HEAPF32.buffer,$,b).slice();return Ko._free($),Z}var K0,tu;(function(c){c[c.EDGEBREAKER=1]="EDGEBREAKER",c[c.SEQUENTIAL=0]="SEQUENTIAL"})(K0||(K0={})),function(c){c.POSITION="POSITION",c.NORMAL="NORMAL",c.COLOR="COLOR",c.TEX_COORD="TEX_COORD",c.GENERIC="GENERIC"}(tu||(tu={}));const $E={[tu.POSITION]:14,[tu.NORMAL]:10,[tu.COLOR]:8,[tu.TEX_COORD]:12,[tu.GENERIC]:12},ZE={decodeSpeed:5,encodeSpeed:5,method:K0.EDGEBREAKER,quantizationBits:$E,quantizationVolume:"mesh"};function HT(c,e=ZE){const i=mf({},ZE,e);i.quantizationBits=mf({},$E,e.quantizationBits);const s=new Ll.Encoder,a=new Ll.MeshBuilder,h=new Ll.Mesh,d={},b=new Ll.DracoInt8Array;for(const fe of c.listSemantics()){const me=c.getAttribute(fe),Ee=WT(fe),Ae=qT(a,me.getComponentType(),h,Ll[Ee],me.getCount(),me.getElementSize(),me.getArray());if(Ae===-1)throw new Error(`Error compressing "${fe}" attribute.`);if(d[fe]=Ae,i.quantizationVolume==="mesh"||fe!=="POSITION")s.SetAttributeQuantization(Ll[Ee],i.quantizationBits[Ee]);else{if(typeof i.quantizationVolume!="object")throw new Error("Invalid quantization volume state.");{const{quantizationVolume:ye}=i,ge=Math.max(ye.max[0]-ye.min[0],ye.max[1]-ye.min[1],ye.max[2]-ye.min[2]);s.SetAttributeExplicitQuantization(Ll[Ee],i.quantizationBits[Ee],me.getElementSize(),ye.min,ge)}}}const X=c.getIndices();if(!X)throw new Error("Primitive must have indices.");a.AddFacesToMesh(h,X.getCount()/3,X.getArray()),s.SetSpeedOptions(i.encodeSpeed,i.decodeSpeed),s.SetTrackEncodedProperties(!0),i.method===K0.SEQUENTIAL||c.listTargets().length>0?s.SetEncodingMethod(Ll.MESH_SEQUENTIAL_ENCODING):s.SetEncodingMethod(Ll.MESH_EDGEBREAKER_ENCODING);const $=s.EncodeMeshToDracoBuffer(h,b);if($<=0)throw new Error("Error applying Draco compression.");const Z=new Uint8Array($);for(let fe=0;fe<$;++fe)Z[fe]=b.GetValue(fe);const re=c.getAttribute("POSITION").getCount(),le=s.GetNumberOfEncodedPoints(),he=3*s.GetNumberOfEncodedFaces();if(c.listTargets().length>0&&le!==re)throw new Error('Compression reduced vertex count unexpectedly, corrupting morph targets. Applying the "weld" function before compression may resolve the issue.');return Ll.destroy(b),Ll.destroy(h),Ll.destroy(a),Ll.destroy(s),{numVertices:le,numIndices:he,data:Z,attributeIDs:d}}function WT(c){return c==="POSITION"?tu.POSITION:c==="NORMAL"?tu.NORMAL:c.startsWith("COLOR_")?tu.COLOR:c.startsWith("TEXCOORD_")?tu.TEX_COORD:tu.GENERIC}function qT(c,e,i,s,a,h,d){switch(e){case mi.ComponentType.UNSIGNED_BYTE:return c.AddUInt8Attribute(i,s,a,h,d);case mi.ComponentType.BYTE:return c.AddInt8Attribute(i,s,a,h,d);case mi.ComponentType.UNSIGNED_SHORT:return c.AddUInt16Attribute(i,s,a,h,d);case mi.ComponentType.SHORT:return c.AddInt16Attribute(i,s,a,h,d);case mi.ComponentType.UNSIGNED_INT:return c.AddUInt32Attribute(i,s,a,h,d);case mi.ComponentType.FLOAT:return c.AddFloatAttribute(i,s,a,h,d);default:throw new Error(`Unexpected component type, "${e}".`)}}const Fo="KHR_draco_mesh_compression";class J0 extends to{constructor(...e){super(...e),this.extensionName=Fo,this.prereadTypes=[Jn.PRIMITIVE],this.prewriteTypes=[Jn.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,i){return e==="draco3d.decoder"&&(this._decoderModule=i,Ko=this._decoderModule,KE={[mi.ComponentType.FLOAT]:Float32Array,[mi.ComponentType.UNSIGNED_INT]:Uint32Array,[mi.ComponentType.UNSIGNED_SHORT]:Uint16Array,[mi.ComponentType.UNSIGNED_BYTE]:Uint8Array,[mi.ComponentType.SHORT]:Int16Array,[mi.ComponentType.BYTE]:Int8Array},JE={[mi.ComponentType.FLOAT]:Ko.DT_FLOAT32,[mi.ComponentType.UNSIGNED_INT]:Ko.DT_UINT32,[mi.ComponentType.UNSIGNED_SHORT]:Ko.DT_UINT16,[mi.ComponentType.UNSIGNED_BYTE]:Ko.DT_UINT8,[mi.ComponentType.SHORT]:Ko.DT_INT16,[mi.ComponentType.BYTE]:Ko.DT_INT8}),e==="draco3d.encoder"&&(this._encoderModule=i,Ll=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${Fo}] Please install extension dependency, "draco3d.decoder".`);const i=this.document.getLogger(),s=e.jsonDoc,a=new Map;try{const h=s.json.meshes||[];for(const d of h)for(const b of d.primitives){if(!b.extensions||!b.extensions[Fo])continue;const X=b.extensions[Fo];let[$,Z]=a.get(X.bufferView)||[];if(!Z||!$){const re=s.json.bufferViews[X.bufferView],le=s.json.buffers[re.buffer],he=Nr.toView(le.uri?s.resources[le.uri]:s.resources["@glb.bin"],re.byteOffset||0,re.byteLength);$=new this._decoderModule.Decoder,Z=VT($,he),a.set(X.bufferView,[$,Z]),i.debug(`[${Fo}] Decompressed ${he.byteLength} bytes.`)}for(const re in b.attributes){const le=e.jsonDoc.json.accessors[b.attributes[re]],he=$.GetAttributeByUniqueId(Z,X.attributes[re]),fe=QT($,Z,he,le);e.accessors[b.attributes[re]].setArray(fe)}b.indices!==void 0&&e.accessors[b.indices].setArray(GT($,Z))}}finally{for(const[h,d]of Array.from(a.values()))this._decoderModule.destroy(h),this._decoderModule.destroy(d)}return this}read(e){return this}prewrite(e,i){if(!this._encoderModule)throw new Error(`[${Fo}] Please install extension dependency, "draco3d.encoder".`);const s=this.document.getLogger();s.debug(`[${Fo}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const a=function(b){const X=b.getLogger(),$=new Set,Z=new Set;for(const Ee of b.getRoot().listMeshes())for(const Ae of Ee.listPrimitives())Ae.getIndices()?Ae.getMode()!==Gm.Mode.TRIANGLES?(Z.add(Ae),X.warn(`[${Fo}] Skipping Draco compression on non-TRIANGLES primitive.`)):$.add(Ae):(Z.add(Ae),X.warn(`[${Fo}] Skipping Draco compression on non-indexed primitive.`));const re=b.getRoot().listAccessors(),le=new Map;for(let Ee=0;Ee<re.length;Ee++)le.set(re[Ee],Ee);const he=new Map,fe=new Set,me=new Map;for(const Ee of Array.from($)){let Ae=eS(Ee,le);if(fe.has(Ae))me.set(Ee,Ae);else{if(he.has(Ee.getIndices())){const ye=Ee.getIndices(),ge=ye.clone();le.set(ge,b.getRoot().listAccessors().length-1),Ee.swap(ye,ge)}for(const ye of Ee.listAttributes())if(he.has(ye)){const ge=ye.clone();le.set(ge,b.getRoot().listAccessors().length-1),Ee.swap(ye,ge)}Ae=eS(Ee,le),fe.add(Ae),me.set(Ee,Ae),he.set(Ee.getIndices(),Ae);for(const ye of Ee.listAttributes())he.set(ye,Ae)}}for(const Ee of Array.from(he.keys())){const Ae=new Set(Ee.listParents().map(ye=>ye.propertyType));if(Ae.size!==2||!Ae.has(Jn.PRIMITIVE)||!Ae.has(Jn.ROOT))throw new Error(`[${Fo}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const Ee of Array.from($)){const Ae=me.get(Ee),ye=Ee.getIndices();if(he.get(ye)!==Ae||Ee.listAttributes().some(ge=>he.get(ge)!==Ae))throw new Error(`[${Fo}] Draco primitives must share all, or no, accessors.`)}for(const Ee of Array.from(Z)){const Ae=Ee.getIndices();if(he.has(Ae)||Ee.listAttributes().some(ye=>he.has(ye)))throw new Error(`[${Fo}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return me}(this.document),h=new Map;let d="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?s.warn(`[${Fo}]: quantizationVolume=scene requires exactly 1 scene.`):d=function(b){const X={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},$=b.propertyType===Jn.NODE?[b]:b.listChildren();for(const Z of $)Z.traverse(re=>{const le=re.getMesh();if(!le)return;const he=ET(le,re.getWorldMatrix());Ux(he.min,X),Ux(he.max,X)});return X}(this.document.getRoot().listScenes().pop()));for(const b of Array.from(a.keys())){const X=a.get(b);if(!X)throw new Error("Unexpected primitive.");if(h.has(X)){h.set(X,h.get(X));continue}const $=b.getIndices(),Z=e.jsonDoc.json.accessors,re=HT(b,mf({},this._encoderOptions,{quantizationVolume:d}));h.set(X,re);const le=e.createAccessorDef($);le.count=re.numIndices,e.accessorIndexMap.set($,Z.length),Z.push(le);for(const fe of b.listSemantics()){const me=b.getAttribute(fe),Ee=e.createAccessorDef(me);Ee.count=re.numVertices,e.accessorIndexMap.set(me,Z.length),Z.push(Ee)}const he=b.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(he)||e.otherBufferViews.set(he,[]),e.otherBufferViews.get(he).push(re.data)}return s.debug(`[${Fo}] Compressed ${a.size} primitives.`),e.extensionData[Fo]={primitiveHashMap:a,primitiveEncodingMap:h},this}write(e){const i=e.extensionData[Fo];for(const s of this.document.getRoot().listMeshes()){const a=e.jsonDoc.json.meshes[e.meshIndexMap.get(s)];for(let h=0;h<s.listPrimitives().length;h++){const d=s.listPrimitives()[h],b=a.primitives[h],X=i.primitiveHashMap.get(d);if(!X)continue;const $=i.primitiveEncodingMap.get(X);b.extensions=b.extensions||{},b.extensions[Fo]={bufferView:e.otherBufferViewsIndexMap.get($.data),attributes:$.attributeIDs}}}if(!i.primitiveHashMap.size){const s=e.jsonDoc.json;s.extensionsUsed=(s.extensionsUsed||[]).filter(a=>a!==Fo),s.extensionsRequired=(s.extensionsRequired||[]).filter(a=>a!==Fo)}return this}}function eS(c,e){const i=[],s=c.getIndices();i.push(e.get(s));for(const a of c.listAttributes())i.push(e.get(a));return i.sort().join("|")}J0.EXTENSION_NAME=Fo,J0.EncoderMethod=K0;class W_ extends Eo{init(){this.extensionName="KHR_lights_punctual",this.propertyType="Light",this.parentTypes=[Jn.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:W_.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getColorHex(){return kl.factorToHex(this.getColor())}setColorHex(e){const i=this.getColor().slice();return kl.hexToFactor(e,i),this.setColor(i)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}W_.EXTENSION_NAME="KHR_lights_punctual",W_.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const gb="KHR_lights_punctual";class tS extends to{constructor(...e){super(...e),this.extensionName=gb}createLight(e=""){return new W_(this.document.getGraph(),e)}read(e){const i=e.jsonDoc;if(!i.json.extensions||!i.json.extensions.KHR_lights_punctual)return this;const s=(i.json.extensions.KHR_lights_punctual.lights||[]).map(a=>{var h,d;const b=this.createLight().setName(a.name||"").setType(a.type);return a.color!==void 0&&b.setColor(a.color),a.intensity!==void 0&&b.setIntensity(a.intensity),a.range!==void 0&&b.setRange(a.range),((h=a.spot)==null?void 0:h.innerConeAngle)!==void 0&&b.setInnerConeAngle(a.spot.innerConeAngle),((d=a.spot)==null?void 0:d.outerConeAngle)!==void 0&&b.setOuterConeAngle(a.spot.outerConeAngle),b});return i.json.nodes.forEach((a,h)=>{a.extensions&&a.extensions.KHR_lights_punctual&&e.nodes[h].setExtension(gb,s[a.extensions.KHR_lights_punctual.light])}),this}write(e){const i=e.jsonDoc;if(this.properties.size===0)return this;const s=[],a=new Map;for(const h of this.properties){const d=h,b={type:d.getType()};co.eq(d.getColor(),[1,1,1])||(b.color=d.getColor()),d.getIntensity()!==1&&(b.intensity=d.getIntensity()),d.getRange()!=null&&(b.range=d.getRange()),d.getName()&&(b.name=d.getName()),d.getType()===W_.Type.SPOT&&(b.spot={innerConeAngle:d.getInnerConeAngle(),outerConeAngle:d.getOuterConeAngle()}),s.push(b),a.set(d,s.length-1)}return this.document.getRoot().listNodes().forEach(h=>{const d=h.getExtension(gb);if(d){const b=e.nodeIndexMap.get(h),X=i.json.nodes[b];X.extensions=X.extensions||{},X.extensions.KHR_lights_punctual={light:a.get(d)}}}),i.json.extensions=i.json.extensions||{},i.json.extensions.KHR_lights_punctual={lights:s},this}}tS.EXTENSION_NAME=gb;const{R:nS,G:iS,B:YT}=xo;class rS extends Eo{init(){this.extensionName="KHR_materials_clearcoat",this.propertyType="Clearcoat",this.parentTypes=[Jn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new Gs(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new Gs(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new Gs(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:nS})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:iS})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:nS|iS|YT})}}rS.EXTENSION_NAME="KHR_materials_clearcoat";const Hm="KHR_materials_clearcoat";class sS extends to{constructor(...e){super(...e),this.extensionName=Hm}createClearcoat(){return new rS(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions[Hm]){const d=this.createClearcoat();e.materials[h].setExtension(Hm,d);const b=a.extensions[Hm];if(b.clearcoatFactor!==void 0&&d.setClearcoatFactor(b.clearcoatFactor),b.clearcoatRoughnessFactor!==void 0&&d.setClearcoatRoughnessFactor(b.clearcoatRoughnessFactor),b.clearcoatTexture!==void 0){const X=b.clearcoatTexture;d.setClearcoatTexture(e.textures[s[X.index].source]),e.setTextureInfo(d.getClearcoatTextureInfo(),X)}if(b.clearcoatRoughnessTexture!==void 0){const X=b.clearcoatRoughnessTexture;d.setClearcoatRoughnessTexture(e.textures[s[X.index].source]),e.setTextureInfo(d.getClearcoatRoughnessTextureInfo(),X)}if(b.clearcoatNormalTexture!==void 0){const X=b.clearcoatNormalTexture;d.setClearcoatNormalTexture(e.textures[s[X.index].source]),e.setTextureInfo(d.getClearcoatNormalTextureInfo(),X),X.scale!==void 0&&d.setClearcoatNormalScale(X.scale)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(Hm);if(a){const h=e.materialIndexMap.get(s),d=i.json.materials[h];d.extensions=d.extensions||{};const b=d.extensions[Hm]={clearcoatFactor:a.getClearcoatFactor(),clearcoatRoughnessFactor:a.getClearcoatRoughnessFactor()};if(a.getClearcoatTexture()){const X=a.getClearcoatTexture(),$=a.getClearcoatTextureInfo();b.clearcoatTexture=e.createTextureInfoDef(X,$)}if(a.getClearcoatRoughnessTexture()){const X=a.getClearcoatRoughnessTexture(),$=a.getClearcoatRoughnessTextureInfo();b.clearcoatRoughnessTexture=e.createTextureInfoDef(X,$)}if(a.getClearcoatNormalTexture()){const X=a.getClearcoatNormalTexture(),$=a.getClearcoatNormalTextureInfo();b.clearcoatNormalTexture=e.createTextureInfoDef(X,$),a.getClearcoatNormalScale()!==1&&(b.clearcoatNormalTexture.scale=a.getClearcoatNormalScale())}}}),this}}sS.EXTENSION_NAME=Hm;class oS extends Eo{init(){this.extensionName="KHR_materials_emissive_strength",this.propertyType="EmissiveStrength",this.parentTypes=[Jn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}oS.EXTENSION_NAME="KHR_materials_emissive_strength";const Wm="KHR_materials_emissive_strength";class aS extends to{constructor(...e){super(...e),this.extensionName=Wm}createEmissiveStrength(){return new oS(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((i,s)=>{if(i.extensions&&i.extensions[Wm]){const a=this.createEmissiveStrength();e.materials[s].setExtension(Wm,a);const h=i.extensions[Wm];h.emissiveStrength!==void 0&&a.setEmissiveStrength(h.emissiveStrength)}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(Wm);if(a){const h=e.materialIndexMap.get(s),d=i.json.materials[h];d.extensions=d.extensions||{},d.extensions[Wm]={emissiveStrength:a.getEmissiveStrength()}}}),this}}aS.EXTENSION_NAME=Wm;class lS extends Eo{init(){this.extensionName="KHR_materials_ior",this.propertyType="IOR",this.parentTypes=[Jn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:0})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}lS.EXTENSION_NAME="KHR_materials_ior";const _b="KHR_materials_ior";class cS extends to{constructor(...e){super(...e),this.extensionName=_b}createIOR(){return new lS(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((i,s)=>{if(i.extensions&&i.extensions.KHR_materials_ior){const a=this.createIOR();e.materials[s].setExtension(_b,a);const h=i.extensions.KHR_materials_ior;h.ior!==void 0&&a.setIOR(h.ior)}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(_b);if(a){const h=e.materialIndexMap.get(s),d=i.json.materials[h];d.extensions=d.extensions||{},d.extensions.KHR_materials_ior={ior:a.getIOR()}}}),this}}cS.EXTENSION_NAME=_b;const{R:XT,G:KT}=xo;class uS extends Eo{init(){this.extensionName="KHR_materials_iridescence",this.propertyType="Iridescence",this.parentTypes=[Jn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new Gs(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new Gs(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:XT})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:KT})}}uS.EXTENSION_NAME="KHR_materials_iridescence";const qm="KHR_materials_iridescence";class hS extends to{constructor(...e){super(...e),this.extensionName=qm}createIridescence(){return new uS(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions[qm]){const d=this.createIridescence();e.materials[h].setExtension(qm,d);const b=a.extensions[qm];if(b.iridescenceFactor!==void 0&&d.setIridescenceFactor(b.iridescenceFactor),b.iridescenceIor!==void 0&&d.setIridescenceIOR(b.iridescenceIor),b.iridescenceThicknessMinimum!==void 0&&d.setIridescenceThicknessMinimum(b.iridescenceThicknessMinimum),b.iridescenceThicknessMaximum!==void 0&&d.setIridescenceThicknessMaximum(b.iridescenceThicknessMaximum),b.iridescenceTexture!==void 0){const X=b.iridescenceTexture;d.setIridescenceTexture(e.textures[s[X.index].source]),e.setTextureInfo(d.getIridescenceTextureInfo(),X)}if(b.iridescenceThicknessTexture!==void 0){const X=b.iridescenceThicknessTexture;d.setIridescenceThicknessTexture(e.textures[s[X.index].source]),e.setTextureInfo(d.getIridescenceThicknessTextureInfo(),X)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(qm);if(a){const h=e.materialIndexMap.get(s),d=i.json.materials[h];d.extensions=d.extensions||{};const b=d.extensions[qm]={};if(a.getIridescenceFactor()>0&&(b.iridescenceFactor=a.getIridescenceFactor()),a.getIridescenceIOR()!==1.3&&(b.iridescenceIor=a.getIridescenceIOR()),a.getIridescenceThicknessMinimum()!==100&&(b.iridescenceThicknessMinimum=a.getIridescenceThicknessMinimum()),a.getIridescenceThicknessMaximum()!==400&&(b.iridescenceThicknessMaximum=a.getIridescenceThicknessMaximum()),a.getIridescenceTexture()){const X=a.getIridescenceTexture(),$=a.getIridescenceTextureInfo();b.iridescenceTexture=e.createTextureInfoDef(X,$)}if(a.getIridescenceThicknessTexture()){const X=a.getIridescenceThicknessTexture(),$=a.getIridescenceThicknessTextureInfo();b.iridescenceThicknessTexture=e.createTextureInfoDef(X,$)}}}),this}}hS.EXTENSION_NAME=qm;const{R:dS,G:pS,B:fS,A:mS}=xo;class gS extends Eo{init(){this.extensionName="KHR_materials_pbrSpecularGlossiness",this.propertyType="PBRSpecularGlossiness",this.parentTypes=[Jn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new Gs(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new Gs(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseHex(){return kl.factorToHex(this.getDiffuseFactor())}setDiffuseHex(e){const i=this.getDiffuseFactor().slice();return this.setDiffuseFactor(kl.hexToFactor(e,i))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:dS|pS|fS|mS})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:dS|pS|fS|mS})}}gS.EXTENSION_NAME="KHR_materials_pbrSpecularGlossiness";const Ym="KHR_materials_pbrSpecularGlossiness";class _S extends to{constructor(...e){super(...e),this.extensionName=Ym}createPBRSpecularGlossiness(){return new gS(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions[Ym]){const d=this.createPBRSpecularGlossiness();e.materials[h].setExtension(Ym,d);const b=a.extensions[Ym];if(b.diffuseFactor!==void 0&&d.setDiffuseFactor(b.diffuseFactor),b.specularFactor!==void 0&&d.setSpecularFactor(b.specularFactor),b.glossinessFactor!==void 0&&d.setGlossinessFactor(b.glossinessFactor),b.diffuseTexture!==void 0){const X=b.diffuseTexture;d.setDiffuseTexture(e.textures[s[X.index].source]),e.setTextureInfo(d.getDiffuseTextureInfo(),X)}if(b.specularGlossinessTexture!==void 0){const X=b.specularGlossinessTexture;d.setSpecularGlossinessTexture(e.textures[s[X.index].source]),e.setTextureInfo(d.getSpecularGlossinessTextureInfo(),X)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(Ym);if(a){const h=e.materialIndexMap.get(s),d=i.json.materials[h];d.extensions=d.extensions||{};const b=d.extensions[Ym]={diffuseFactor:a.getDiffuseFactor(),specularFactor:a.getSpecularFactor(),glossinessFactor:a.getGlossinessFactor()};if(a.getDiffuseTexture()){const X=a.getDiffuseTexture(),$=a.getDiffuseTextureInfo();b.diffuseTexture=e.createTextureInfoDef(X,$)}if(a.getSpecularGlossinessTexture()){const X=a.getSpecularGlossinessTexture(),$=a.getSpecularGlossinessTextureInfo();b.specularGlossinessTexture=e.createTextureInfoDef(X,$)}}}),this}}_S.EXTENSION_NAME=Ym;const{R:JT,G:$T,B:ZT,A:eI}=xo;class vS extends Eo{init(){this.extensionName="KHR_materials_sheen",this.propertyType="Sheen",this.parentTypes=[Jn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new Gs(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new Gs(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return kl.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}setSheenColorHex(e){const i=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",kl.hexToFactor(e,i))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:JT|$T|ZT})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:eI})}}vS.EXTENSION_NAME="KHR_materials_sheen";const vb="KHR_materials_sheen";class AS extends to{constructor(...e){super(...e),this.extensionName=vb}createSheen(){return new vS(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions.KHR_materials_sheen){const d=this.createSheen();e.materials[h].setExtension(vb,d);const b=a.extensions.KHR_materials_sheen;if(b.sheenColorFactor!==void 0&&d.setSheenColorFactor(b.sheenColorFactor),b.sheenRoughnessFactor!==void 0&&d.setSheenRoughnessFactor(b.sheenRoughnessFactor),b.sheenColorTexture!==void 0){const X=b.sheenColorTexture;d.setSheenColorTexture(e.textures[s[X.index].source]),e.setTextureInfo(d.getSheenColorTextureInfo(),X)}if(b.sheenRoughnessTexture!==void 0){const X=b.sheenRoughnessTexture;d.setSheenRoughnessTexture(e.textures[s[X.index].source]),e.setTextureInfo(d.getSheenRoughnessTextureInfo(),X)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(vb);if(a){const h=e.materialIndexMap.get(s),d=i.json.materials[h];d.extensions=d.extensions||{};const b=d.extensions.KHR_materials_sheen={sheenColorFactor:a.getSheenColorFactor(),sheenRoughnessFactor:a.getSheenRoughnessFactor()};if(a.getSheenColorTexture()){const X=a.getSheenColorTexture(),$=a.getSheenColorTextureInfo();b.sheenColorTexture=e.createTextureInfoDef(X,$)}if(a.getSheenRoughnessTexture()){const X=a.getSheenRoughnessTexture(),$=a.getSheenRoughnessTextureInfo();b.sheenRoughnessTexture=e.createTextureInfoDef(X,$)}}}),this}}AS.EXTENSION_NAME=vb;const{R:tI,G:nI,B:iI,A:rI}=xo;class yS extends Eo{init(){this.extensionName="KHR_materials_specular",this.propertyType="Specular",this.parentTypes=[Jn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new Gs(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new Gs(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularColorHex(){return kl.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(e){const i=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",kl.hexToFactor(e,i))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:rI})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:tI|nI|iI})}}yS.EXTENSION_NAME="KHR_materials_specular";const Xm="KHR_materials_specular";class bS extends to{constructor(...e){super(...e),this.extensionName=Xm}createSpecular(){return new yS(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions[Xm]){const d=this.createSpecular();e.materials[h].setExtension(Xm,d);const b=a.extensions[Xm];if(b.specularFactor!==void 0&&d.setSpecularFactor(b.specularFactor),b.specularColorFactor!==void 0&&d.setSpecularColorFactor(b.specularColorFactor),b.specularTexture!==void 0){const X=b.specularTexture;d.setSpecularTexture(e.textures[s[X.index].source]),e.setTextureInfo(d.getSpecularTextureInfo(),X)}if(b.specularColorTexture!==void 0){const X=b.specularColorTexture;d.setSpecularColorTexture(e.textures[s[X.index].source]),e.setTextureInfo(d.getSpecularColorTextureInfo(),X)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(Xm);if(a){const h=e.materialIndexMap.get(s),d=i.json.materials[h];d.extensions=d.extensions||{};const b=d.extensions[Xm]={};if(a.getSpecularFactor()!==1&&(b.specularFactor=a.getSpecularFactor()),co.eq(a.getSpecularColorFactor(),[1,1,1])||(b.specularColorFactor=a.getSpecularColorFactor()),a.getSpecularTexture()){const X=a.getSpecularTexture(),$=a.getSpecularTextureInfo();b.specularTexture=e.createTextureInfoDef(X,$)}if(a.getSpecularColorTexture()){const X=a.getSpecularColorTexture(),$=a.getSpecularColorTextureInfo();b.specularColorTexture=e.createTextureInfoDef(X,$)}}}),this}}bS.EXTENSION_NAME=Xm;const{R:sI}=xo;class wS extends Eo{init(){this.extensionName="KHR_materials_transmission",this.propertyType="Transmission",this.parentTypes=[Jn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new Gs(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:sI})}}wS.EXTENSION_NAME="KHR_materials_transmission";const Km="KHR_materials_transmission";class xS extends to{constructor(...e){super(...e),this.extensionName=Km}createTransmission(){return new wS(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions[Km]){const d=this.createTransmission();e.materials[h].setExtension(Km,d);const b=a.extensions[Km];if(b.transmissionFactor!==void 0&&d.setTransmissionFactor(b.transmissionFactor),b.transmissionTexture!==void 0){const X=b.transmissionTexture;d.setTransmissionTexture(e.textures[s[X.index].source]),e.setTextureInfo(d.getTransmissionTextureInfo(),X)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(Km);if(a){const h=e.materialIndexMap.get(s),d=i.json.materials[h];d.extensions=d.extensions||{};const b=d.extensions[Km]={transmissionFactor:a.getTransmissionFactor()};if(a.getTransmissionTexture()){const X=a.getTransmissionTexture(),$=a.getTransmissionTextureInfo();b.transmissionTexture=e.createTextureInfoDef(X,$)}}}),this}}xS.EXTENSION_NAME=Km;class ES extends Eo{init(){this.extensionName="KHR_materials_unlit",this.propertyType="Unlit",this.parentTypes=[Jn.MATERIAL]}}ES.EXTENSION_NAME="KHR_materials_unlit";const Ab="KHR_materials_unlit";class SS extends to{constructor(...e){super(...e),this.extensionName=Ab}createUnlit(){return new ES(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((i,s)=>{i.extensions&&i.extensions.KHR_materials_unlit&&e.materials[s].setExtension(Ab,this.createUnlit())}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{if(s.getExtension(Ab)){const a=e.materialIndexMap.get(s),h=i.json.materials[a];h.extensions=h.extensions||{},h.extensions.KHR_materials_unlit={}}}),this}}SS.EXTENSION_NAME=Ab;class CS extends Eo{init(){this.extensionName="KHR_materials_variants",this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}CS.EXTENSION_NAME="KHR_materials_variants";class MS extends Eo{init(){this.extensionName="KHR_materials_variants",this.propertyType="MappingList",this.parentTypes=[Jn.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}MS.EXTENSION_NAME="KHR_materials_variants";class Wx extends Eo{init(){this.extensionName="KHR_materials_variants",this.propertyType="Variant",this.parentTypes=["MappingList"]}}Wx.EXTENSION_NAME="KHR_materials_variants";const kh="KHR_materials_variants";class TS extends to{constructor(...e){super(...e),this.extensionName=kh}createMappingList(){return new MS(this.document.getGraph())}createVariant(e=""){return new Wx(this.document.getGraph(),e)}createMapping(){return new CS(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(e=>e instanceof Wx)}read(e){const i=e.jsonDoc;if(!i.json.extensions||!i.json.extensions[kh])return this;const s=(i.json.extensions[kh].variants||[]).map(a=>this.createVariant().setName(a.name||""));return(i.json.meshes||[]).forEach((a,h)=>{const d=e.meshes[h];(a.primitives||[]).forEach((b,X)=>{if(!b.extensions||!b.extensions[kh])return;const $=this.createMappingList(),Z=b.extensions[kh];for(const re of Z.mappings){const le=this.createMapping();re.material!==void 0&&le.setMaterial(e.materials[re.material]);for(const he of re.variants||[])le.addVariant(s[he]);$.addMapping(le)}d.listPrimitives()[X].setExtension(kh,$)})}),this}write(e){const i=e.jsonDoc,s=this.listVariants();if(!s.length)return this;const a=[],h=new Map;for(const d of s)h.set(d,a.length),a.push(e.createPropertyDef(d));for(const d of this.document.getRoot().listMeshes()){const b=e.meshIndexMap.get(d);d.listPrimitives().forEach((X,$)=>{const Z=X.getExtension(kh);if(!Z)return;const re=e.jsonDoc.json.meshes[b].primitives[$],le=Z.listMappings().map(he=>{const fe=e.createPropertyDef(he),me=he.getMaterial();return me&&(fe.material=e.materialIndexMap.get(me)),fe.variants=he.listVariants().map(Ee=>h.get(Ee)),fe});re.extensions=re.extensions||{},re.extensions[kh]={mappings:le}})}return i.json.extensions=i.json.extensions||{},i.json.extensions[kh]={variants:a},this}}TS.EXTENSION_NAME=kh;const{G:oI}=xo;class IS extends Eo{init(){this.extensionName="KHR_materials_volume",this.propertyType="Volume",this.parentTypes=[Jn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new Gs(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:oI})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}getAttenuationColorHex(){return kl.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(e){const i=this.getAttenuationColor().slice();return this.set("attenuationColor",kl.hexToFactor(e,i))}}IS.EXTENSION_NAME="KHR_materials_volume";const yb="KHR_materials_volume";class DS extends to{constructor(...e){super(...e),this.extensionName=yb}createVolume(){return new IS(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions.KHR_materials_volume){const d=this.createVolume();e.materials[h].setExtension(yb,d);const b=a.extensions.KHR_materials_volume;if(b.thicknessFactor!==void 0&&d.setThicknessFactor(b.thicknessFactor),b.attenuationDistance!==void 0&&d.setAttenuationDistance(b.attenuationDistance),b.attenuationColor!==void 0&&d.setAttenuationColor(b.attenuationColor),b.thicknessTexture!==void 0){const X=b.thicknessTexture;d.setThicknessTexture(e.textures[s[X.index].source]),e.setTextureInfo(d.getThicknessTextureInfo(),X)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(yb);if(a){const h=e.materialIndexMap.get(s),d=i.json.materials[h];d.extensions=d.extensions||{};const b=d.extensions.KHR_materials_volume={};if(a.getThicknessFactor()>0&&(b.thicknessFactor=a.getThicknessFactor()),Number.isFinite(a.getAttenuationDistance())&&(b.attenuationDistance=a.getAttenuationDistance()),co.eq(a.getAttenuationColor(),[1,1,1])||(b.attenuationColor=a.getAttenuationColor()),a.getThicknessTexture()){const X=a.getThicknessTexture(),$=a.getThicknessTextureInfo();b.thicknessTexture=e.createTextureInfoDef(X,$)}}}),this}}DS.EXTENSION_NAME=yb;const PS="KHR_mesh_quantization";class RS extends to{constructor(...e){super(...e),this.extensionName=PS}read(e){return this}write(e){return this}}RS.EXTENSION_NAME=PS;const BS="KHR_texture_basisu";class aI{match(e){return e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10}getSize(e){const i=Qx(e);return[i.pixelWidth,i.pixelHeight]}getChannels(e){const i=Qx(e).dataFormatDescriptor[0];if(i.colorModel===163)return i.samples.length===2&&(15&i.samples[1].channelType)==15?4:3;if(i.colorModel===166)return(15&i.samples[0].channelType)==3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${i.colorModel}".`)}getGPUByteLength(e){const i=Qx(e),s=this.getChannels(e)>3;let a=0;for(let h=0;h<i.levels.length;h++){const d=i.levels[h];a+=d.uncompressedByteLength?d.uncompressedByteLength:Math.max(1,Math.floor(i.pixelWidth/Math.pow(2,h)))/4*(Math.max(1,Math.floor(i.pixelHeight/Math.pow(2,h)))/4)*(s?16:8)}return a}}class kS extends to{constructor(...e){super(...e),this.extensionName=BS,this.prereadTypes=[Jn.TEXTURE]}static register(){tp.registerFormat("image/ktx2",new aI)}preread(e){return e.jsonDoc.json.textures.forEach(i=>{i.extensions&&i.extensions.KHR_texture_basisu&&(i.source=i.extensions.KHR_texture_basisu.source)}),this}read(e){return this}write(e){const i=e.jsonDoc;return this.document.getRoot().listTextures().forEach(s=>{if(s.getMimeType()==="image/ktx2"){const a=e.imageIndexMap.get(s);i.json.textures.forEach(h=>{h.source===a&&(h.extensions=h.extensions||{},h.extensions.KHR_texture_basisu={source:h.source},delete h.source)})}}),this}}kS.EXTENSION_NAME=BS;class OS extends Eo{init(){this.extensionName="KHR_texture_transform",this.propertyType="Transform",this.parentTypes=[Jn.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}OS.EXTENSION_NAME="KHR_texture_transform";const bb="KHR_texture_transform";class LS extends to{constructor(...e){super(...e),this.extensionName=bb}createTransform(){return new OS(this.document.getGraph())}read(e){for(const[i,s]of Array.from(e.textureInfos.entries())){if(!s.extensions||!s.extensions.KHR_texture_transform)continue;const a=this.createTransform(),h=s.extensions.KHR_texture_transform;h.offset!==void 0&&a.setOffset(h.offset),h.rotation!==void 0&&a.setRotation(h.rotation),h.scale!==void 0&&a.setScale(h.scale),h.texCoord!==void 0&&a.setTexCoord(h.texCoord),i.setExtension(bb,a)}return this}write(e){const i=Array.from(e.textureInfoDefMap.entries());for(const[s,a]of i){const h=s.getExtension(bb);if(!h)continue;a.extensions=a.extensions||{};const d={},b=co.eq;b(h.getOffset(),[0,0])||(d.offset=h.getOffset()),h.getRotation()!==0&&(d.rotation=h.getRotation()),b(h.getScale(),[1,1])||(d.scale=h.getScale()),h.getTexCoord()!=null&&(d.texCoord=h.getTexCoord()),a.extensions.KHR_texture_transform=d}return this}}LS.EXTENSION_NAME=bb;const lI=[Jn.ROOT,Jn.SCENE,Jn.NODE,Jn.MESH,Jn.MATERIAL,Jn.TEXTURE,Jn.ANIMATION];class NS extends Eo{init(){this.extensionName="KHR_xmp_json_ld",this.propertyType="Packet",this.parentTypes=lI}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",mf({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const i=this.get("properties");return e in i?i[e]:null}setProperty(e,i){this._assertContext(e);const s=mf({},this.get("properties"));return i?s[e]=i:delete s[e],this.set("properties",s)}toJSONLD(){return mf({"@context":qx(this.get("context"))},qx(this.get("properties")))}fromJSONLD(e){const i=(e=qx(e))["@context"];return i&&this.set("context",i),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`KHR_xmp_json_ld: Missing context for term, "${e}".`)}}function qx(c){return JSON.parse(JSON.stringify(c))}NS.EXTENSION_NAME="KHR_xmp_json_ld";const Yx="KHR_xmp_json_ld";class US extends to{constructor(...e){super(...e),this.extensionName=Yx}createPacket(){return new NS(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var i;const s=(i=e.jsonDoc.json.extensions)==null?void 0:i.KHR_xmp_json_ld;if(!s||!s.packets)return this;const a=e.jsonDoc.json,h=this.document.getRoot(),d=s.packets.map($=>this.createPacket().fromJSONLD($)),b=[[a.asset],a.scenes,a.nodes,a.meshes,a.materials,a.images,a.animations],X=[[h],h.listScenes(),h.listNodes(),h.listMeshes(),h.listMaterials(),h.listTextures(),h.listAnimations()];for(let $=0;$<b.length;$++){const Z=b[$]||[];for(let re=0;re<Z.length;re++){const le=Z[re];le.extensions&&le.extensions.KHR_xmp_json_ld&&X[$][re].setExtension(Yx,d[le.extensions.KHR_xmp_json_ld.packet])}}return this}write(e){const{json:i}=e.jsonDoc,s=[];for(const a of this.properties){s.push(a.toJSONLD());for(const h of a.listParents()){let d;switch(h.propertyType){case Jn.ROOT:d=i.asset;break;case Jn.SCENE:d=i.scenes[e.sceneIndexMap.get(h)];break;case Jn.NODE:d=i.nodes[e.nodeIndexMap.get(h)];break;case Jn.MESH:d=i.meshes[e.meshIndexMap.get(h)];break;case Jn.MATERIAL:d=i.materials[e.materialIndexMap.get(h)];break;case Jn.TEXTURE:d=i.images[e.imageIndexMap.get(h)];break;case Jn.ANIMATION:d=i.animations[e.animationIndexMap.get(h)];break;default:d=null,this.document.getLogger().warn(`[KHR_xmp_json_ld]: Unsupported parent property, "${h.propertyType}"`)}d&&(d.extensions=d.extensions||{},d.extensions.KHR_xmp_json_ld={packet:s.length-1})}}return s.length>0&&(i.extensions=i.extensions||{},i.extensions.KHR_xmp_json_ld={packets:s}),this}}US.EXTENSION_NAME=Yx;const cI=[J0,tS,sS,aS,cS,hS,_S,bS,AS,xS,SS,TS,DS,RS,kS,LS,US];let Xx=class extends ih{constructor(c,e,i){super(c,e,i??new uI,new oi(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(c,e,i,s,a){this.enabled&&super.render(c,e,i,s,a)}};Xx=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d}([ur("High precision Normal Buffer")],Xx);class uI extends _.RSm{constructor(){super()}onBeforeRender(e,i,s,a,h){var d,b;let X=h.material;Array.isArray(X)&&(X=X[0]),this.normalMap=(d=X==null?void 0:X.normalMap)!==null&&d!==void 0?d:null,this.needsUpdate=!0,this.side=(b=X.side)!==null&&b!==void 0?b:_.ehD}}class Jm extends Sl{constructor(e=!0){super(),this.passId="normalBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this.enabled=e}passCtor(e){this._normalTarget=e.renderer.createTarget({depthBuffer:!0,type:_.cLu,minFilter:_.TyD,magFilter:_.TyD,generateMipmaps:!1}),this._normalTarget.texture.name="normalBuffer",this._normalTarget.texture.generateMipmaps=!1;const i=this._normalTarget,s=new Set,a=new Set;return new class extends Xx{render(h,d,b,X,$){const Z=h.getRenderTarget(),re=h.getActiveCubeFace(),le=h.getActiveMipmapLevel();this.scene&&(this.scene.traverse(({material:he})=>{he&&((he.transparent&&he.userData.renderToDepth||!he.transparent&&he.transmission===0&&he.userData.renderToDepth===!1)&&(s.add(he),he.transparent=!he.transparent),Math.abs(he.transmission||0)>0&&he.userData.renderToDepth&&(a.add([he,he.transmission]),he.transmission=0))}),Rn(h,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(h,d,i,X,$)),s.forEach(he=>he.transparent=!he.transparent),s.clear(),a.forEach(([he,fe])=>he.transmission=fe),a.clear(),h.setRenderTarget(Z,re,le))}}}_update(e){if(!super._update(e))return!1;const i=this.pass.passObject;return i.scene=e.scene.modelObject,i.camera=e.scene.activeCamera.cameraObject,!0}getNormalBuffer(){return this._normalTarget}async onDispose(e){}async onRemove(e){var i,s;return e.renderer.disposeTarget((s=(i=this._normalTarget)===null||i===void 0?void 0:i.dispose)===null||s===void 0?void 0:s.call(i)),super.onRemove(e)}updateShaderProperties(e){var i,s;return e.uniforms.tNormalBuffer?e.uniforms.tNormalBuffer.value=this.enabled&&(s=(i=this.getNormalBuffer())===null||i===void 0?void 0:i.texture)!==null&&s!==void 0?s:null:console.warn("BaseRenderer: no uniform: tNormalBuffer"),this}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}Jm.PluginType="NormalBufferPlugin";function FS(c){const e=c==null?void 0:c.userData;if(!e)return!1;e._ssBevel||(e._ssBevel={});const i=e._ssBevel;return i.hasSSBevel=!0,i.radius===void 0&&(i.radius=0),c.isMaterial&&(c.needsUpdate=!0),!0}let Kx=class extends Fs{constructor(c,e,i,s){super({defines:{NUM_SAMPLES:16},uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},edgeMaskBuffer:{value:null},screenSize:{value:new _.FM8},radius:{value:1},samples:{value:null},frameCount:{value:0},cameraPositionWorld:{value:new _.Pa4(1,1,1)}},vertexShader:ec,fragmentShader:`

            ${i}

            ${tc}

            uniform sampler2D tNormalBuffer;uniform sampler2D edgeMaskBuffer;uniform vec2 screenSize;const float depthStep=0.02;uniform vec2 samples[NUM_SAMPLES];uniform vec3 cameraPositionWorld;varying vec2 vUv;
#include <common>
float getBevelRadius(in float number){return floor(number/8.);}vec3 smoothNormal(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 texel=texture2D(tNormalDepth,uv);vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 avgNormal=2.*texture2D(tNormalBuffer,uv).rgb-1.;float depth=pow(unpack16(texel.xy),2.);vec2 invScreenSize=vec2(1.)/screenSize;vec4 mask=texture2D(tGBufferFlags,uv);float weightSum=0.;float radius=getBevelRadius(mask.g*255.)*2.;float randomAngle=6.2*random(frameCount*0.1);float theta=randomAngle;float snTheta=sin(theta);float csTheta=cos(theta);mat2 randomRotationMatrix=mat2(csTheta,snTheta,-snTheta,csTheta);float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(1./(1.+pow(d_,0.5)),0.,1.);for(int i=0;i<5;i++){float x=float(i)-2.;for(int j=0;j<5;j++){float y=float(j)-2.;vec2 offset=randomRotationMatrix*vec2(x,y)*radius*radiusModifier*invScreenSize;vec4 texel=texture2D(tNormalDepth,uv+offset);float offsetDepth=pow(unpack16(texel.xy),2.);float depthWeight=abs(offsetDepth-depth);depthWeight=(1.-step(depthStep,depthWeight));vec3 offsetNormal=2.*texture2D(tNormalBuffer,uv+offset).rgb-1.;if(dot(offsetNormal,offsetNormal)>0.){avgNormal+=offsetNormal*depthWeight;}}}return normalize(avgNormal);}void main(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 normal=vec3(0.);if(edgeMask.x>0.){normal=smoothNormal();}else{normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}gl_FragColor=vec4(vec3(0.5*normal+0.5),1.);}
            
            `},"tDiffuse"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(a,h,d)=>{var b,X;this.enabled&&(!((X=(b=h.materialObject.userData)===null||b===void 0?void 0:b._ssBevel)===null||X===void 0)&&X.hasSSBevel)&&(a.fragmentShader=gs(a.fragmentShader,"#include <normal_fragment_maps>",` 
                normal = 2. * texture2D(tSSBevelMap, viewToScreen(vViewPosition.xyz).xy).rgb - 1.;
                normal = normalize(normal);
                //geometryNormal = normal;
            `))},onObjectRender:(a,h,d)=>{var b,X;if(!this.enabled||!(!((X=(b=h.materialObject.userData)===null||b===void 0?void 0:b._ssBevel)===null||X===void 0)&&X.hasSSBevel))return;const $=h.materialObject,Z=this._target.texture;this.materialExtension.extraUniforms.tSSBevelMap.value!==Z&&(this.materialExtension.extraUniforms.tSSBevelMap.value=Z,$.needsUpdate=!0)},getUiConfig:a=>{const h={type:"folder",label:"SSBevel (Dev)",children:[{type:"checkbox",label:"Enabled",get value(){var d;return((d=a.materialObject.userData._ssBevel)===null||d===void 0?void 0:d.hasSSBevel)||!1},set value(d){var b,X;d!==((b=a.materialObject.userData._ssBevel)===null||b===void 0?void 0:b.hasSSBevel)&&(d?FS(a.materialObject)||alert("Cannot add screen space bevel."):(a.materialObject.userData._ssBevel.hasSSBevel=!1,a.materialObject.needsUpdate=!0),(X=h.uiRefresh)===null||X===void 0||X.call(h,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,8],label:"radius",hidden:()=>{var d;return!(!((d=a.materialObject.userData._ssBevel)===null||d===void 0)&&d.hasSSBevel)},property:[a.materialObject.userData._ssBevel,"radius"],onChange:this.setDirty})]};return h},parsFragmentSnippet:(a,h)=>{var d,b;return this.enabled&&(!((b=(d=h==null?void 0:h.materialObject.userData)===null||d===void 0?void 0:d._ssBevel)===null||b===void 0)&&b.hasSSBevel)?Ne`
            uniform sampler2D tSSBevelMap;
            ${Og}
            `:""},extraUniforms:{tSSBevelMap:{value:null}},computeCacheKey:a=>{var h,d;return(this.enabled?"1":"0")+(!((d=(h=a.materialObject.userData)===null||h===void 0?void 0:h._ssBevel)===null||d===void 0)&&d.hasSSBevel?"1":"0")},isCompatible:a=>a.isMeshStandardMaterial2},this._target=e,this.needsSwap=!1,this.clear=!0,this._viewerApp=s,this._edgeMaterial=new lu({uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},screenSize:{value:null},radius:{value:10},cameraNearFar:{value:new _.FM8(1,1)},cameraPositionWorld:{value:new _.Pa4(1,1,1)}},vertexShader:ec,fragmentShader:"uniform vec2 screenSize;uniform sampler2D tNormalDepth;uniform sampler2D tNormalBuffer;uniform sampler2D tGBufferFlags;uniform float radius;uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;const float depthStep=0.2;const float normalThreshold=0.9;float unpack16(vec2 value){return(value.x*0.996108949416342426275150501169264316558837890625+value.y*0.00389105058365758760263730664519243873655796051025390625);}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}void lookupNormalDepth(out float depth,out vec3 normal,vec2 off){vec2 uv=(gl_FragCoord.st+off)/screenSize;vec4 texel=texture2D(tNormalDepth,uv);depth=mix(cameraNearFar.x,cameraNearFar.y,pow(unpack16(texel.xy),2.));normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}float getBorderWeight(){float depth1,depth2,depth3,depth4;vec3 normal1,normal2,normal3,normal4;float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(3./(1.+pow(d_,0.5)),0.,1.);float modRad=radius;lookupNormalDepth(depth1,normal1,vec2(0.,modRad));lookupNormalDepth(depth2,normal2,vec2(0.,-modRad));lookupNormalDepth(depth3,normal3,vec2(modRad,0.));lookupNormalDepth(depth4,normal4,vec2(-modRad,0.));vec2 uv=(gl_FragCoord.st)/screenSize;float mask=step(0.0001,texture2D(tGBufferFlags,uv).g);float mask1=texture2D(tGBufferFlags,uv+vec2(0.,modRad)/screenSize).b*255.;float mask2=texture2D(tGBufferFlags,uv+vec2(0.,-modRad)/screenSize).b*255.;float mask3=texture2D(tGBufferFlags,uv+vec2(modRad,0.)/screenSize).b*255.;float mask4=texture2D(tGBufferFlags,uv+vec2(-modRad,0.)/screenSize).b*255.;float maskWeight=max(abs(mask1-mask2),abs(mask3-mask4))*255.;maskWeight=(step(maskWeight,0.01));float a1=dot(normal1,normal2);float a2=dot(normal3,normal4);float normalWeight=min(abs(a1),abs(a2));normalWeight=1.-step(normalThreshold,normalWeight);float depthWeight=max(abs(depth1-depth2),abs(depth3-depth4));depthWeight=(step(depthWeight,depthStep));return normalWeight*depthWeight*maskWeight*mask;}void main(){float weight=getBorderWeight();vec2 uv=gl_FragCoord.st/screenSize;vec4 texel=texture2D(tNormalDepth,uv);float depth=pow(unpack16(texel.xy),2.);vec3 outColor=vec3(0.);if(depth>0.999){weight=0.;}else{outColor=vec3(weight);}gl_FragColor=vec4(outColor,1.);}"}),this._separableBlurMaterial=new lu({defines:{KERNEL_RADIUS:3,SIGMA:3},uniforms:{colorTexture:{value:null},maskTexture:{value:null},texSize:{value:new _.FM8(.5,.5)},direction:{value:new _.FM8(.5,.5)}},vertexShader:ec,fragmentShader:"varying vec2 vUv;uniform sampler2D colorTexture;uniform sampler2D maskTexture;uniform vec2 texSize;uniform vec2 direction;float gaussianPdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}void main(){vec2 invSize=1./texSize;float fSigma=float(SIGMA);float weightSum=gaussianPdf(0.,fSigma);vec4 mask=texture2D(maskTexture,vUv);vec3 diffuseSum=texture2D(colorTexture,vUv).rgb*weightSum;for(int i=1;i<KERNEL_RADIUS;i++){float x=float(i);float w=gaussianPdf(x,fSigma);vec2 uvOffset=direction*invSize*x;vec3 sample1=texture2D(colorTexture,vUv+uvOffset).rgb;vec3 sample2=texture2D(colorTexture,vUv-uvOffset).rgb;diffuseSum+=(sample1+sample2)*w;weightSum+=2.*w;}gl_FragColor=vec4(diffuseSum/weightSum,1.);}"})}render(c,e,i,s,a){var h,d;if(!this.enabled)return;const b=c.baseRenderer,X={minFilter:_.wem,magFilter:_.wem,isAntialiased:!1,format:_.wk1,depthBuffer:!1,generateMipmaps:!1},$=b.getTempTarget(X);this._renderEdges(b,$),this._blurEdges(b,$),this._viewerApp.scene.activeCamera.updateShaderProperties(this.material),(h=this._viewerApp.getPlugin(Or))===null||h===void 0||h.updateShaderProperties(this.material),(d=this._viewerApp.getPlugin(Jm))===null||d===void 0||d.updateShaderProperties(this.material),this._viewerApp.renderer.updateShaderProperties(this.material),this.uniforms.edgeMaskBuffer.value=$.texture,super.render(c,this._target,$,s,a),b.releaseTempTarget($)}_initsamples(){const c=[];return c.push(new _.FM8(-8,0).multiplyScalar(.125)),c.push(new _.FM8(-6,-4).multiplyScalar(.125)),c.push(new _.FM8(-3,-2).multiplyScalar(.125)),c.push(new _.FM8(-2,-6).multiplyScalar(.125)),c.push(new _.FM8(1,-1).multiplyScalar(.125)),c.push(new _.FM8(2,-5).multiplyScalar(.125)),c.push(new _.FM8(6,-7).multiplyScalar(.125)),c.push(new _.FM8(5,-3).multiplyScalar(.125)),c.push(new _.FM8(4,1).multiplyScalar(.125)),c.push(new _.FM8(7,4).multiplyScalar(.125)),c.push(new _.FM8(3,5).multiplyScalar(.125)),c.push(new _.FM8(0,7).multiplyScalar(.125)),c.push(new _.FM8(-1,3).multiplyScalar(.125)),c.push(new _.FM8(-4,6).multiplyScalar(.125)),c.push(new _.FM8(-7,8).multiplyScalar(.125)),c.push(new _.FM8(-5,2).multiplyScalar(.125)),c}_blurEdges(c,e){var i,s;const a={minFilter:_.wem,magFilter:_.wem,isAntialiased:!1,format:_.wk1,depthBuffer:!1,generateMipmaps:!1,sizeMultiplier:.5},h=c.getTempTarget(a),d=((i=e.texture.image)===null||i===void 0?void 0:i.width)||1,b=((s=e.texture.image)===null||s===void 0?void 0:s.height)||1;this._separableBlurMaterial.uniforms.texSize.value=new _.FM8(d,b),this._separableBlurMaterial.uniforms.colorTexture.value=e.texture,this._separableBlurMaterial.uniforms.direction.value=new _.FM8(1,0),c.blit(void 0,h,{material:this._separableBlurMaterial}),this._separableBlurMaterial.uniforms.texSize.value=new _.FM8(d/2,b/2),this._separableBlurMaterial.uniforms.colorTexture.value=h.texture,this._separableBlurMaterial.uniforms.direction.value=new _.FM8(0,1),c.blit(void 0,e,{material:this._separableBlurMaterial}),c.releaseTempTarget(h)}_renderEdges(c,e){var i,s,a,h;const d=((i=e.texture.image)===null||i===void 0?void 0:i.width)||1,b=((s=e.texture.image)===null||s===void 0?void 0:s.height)||1;this._edgeMaterial.uniforms.screenSize.value=new _.FM8(d,b),this._viewerApp.scene.activeCamera.updateShaderProperties(this._edgeMaterial),(a=this._viewerApp.getPlugin(Or))===null||a===void 0||a.updateShaderProperties(this._edgeMaterial),(h=this._viewerApp.getPlugin(Jm))===null||h===void 0||h.updateShaderProperties(this._edgeMaterial),c.blit(void 0,e,{material:this._edgeMaterial})}};Kx=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d}([ur("SSBevel")],Kx);class ip extends Sl{constructor(e=!0){super(),this.passId="ssBevel",this._beforeFilters=["render"],this._afterFilters=["gbuffer","normalBuffer"],this._requiredFilters=["render","gbuffer","normalBuffer"],this._lastEnabled=!1,this.dependencies=[Kn,Or,Jm],this.enabled=e,this.setDirty=this.setDirty.bind(this),this._loaderCreate=this._loaderCreate.bind(this),this.updateGBuffer=this.updateGBuffer.bind(this)}get bevelTarget(){return this._bevelTarget}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register(i=>new hI(i))}passCtor(e){var i,s;this._bevelTarget=e.renderer.createTarget({depthBuffer:!0,type:_.cLu,minFilter:_.TyD,magFilter:_.TyD,generateMipmaps:!1}),this._bevelTarget.texture.name="bevelBuffer",this._bevelTarget.texture.generateMipmaps=!1;const a=e.getPluginByType("debug");return a&&a.addTexture("tempBuffer",()=>this._bevelTarget.texture,[440,50,400,200]),new Kx(e.renderer,this._bevelTarget,(s=(i=e.getPlugin(Or))===null||i===void 0?void 0:i.getUnpackSnippet())!==null&&s!==void 0?s:"",e)}async onAdded(e){var i,s,a,h,d,b,X,$;await super.onAdded(e);const Z=e.getPlugin(Kn);return!((i=this.pass)===null||i===void 0)&&i.passObject.materialExtension&&((s=Z==null?void 0:Z.materials)===null||s===void 0||s.registerMaterialExtension((a=this.pass)===null||a===void 0?void 0:a.passObject.materialExtension)),(h=Z==null?void 0:Z.importer)===null||h===void 0||h.addEventListener("loaderCreate",this._loaderCreate),(X=(b=(d=Z==null?void 0:Z.exporter)===null||d===void 0?void 0:d.getExporter("gltf","glb"))===null||b===void 0?void 0:b.extensions)===null||X===void 0||X.push(dI),($=e.getPlugin(Or))===null||$===void 0||$.registerGBufferUpdater(this.updateGBuffer),super.onAdded(e)}async onRemove(e){return e.renderer.disposeTarget(this._bevelTarget),super.onRemove(e)}setDirty(){var e,i,s,a;(e=this._viewer)===null||e===void 0||e.setDirty(),(a=(i=this.pass)===null||i===void 0?void 0:(s=i.passObject.materialExtension).setDirty)===null||a===void 0||a.call(s)}_update(e){var i;let s=this.enabled;if(s&&!this._lastEnabled){const a=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("NormalBufferPlugin");confirm("SS Bevel Plugin needs to enable NormalBufferPlugin. Enable now?")?a.enabled=!0:(this.enabled=!1,a.enabled=!1,s=!1)}return this._lastEnabled=s,s}get uiConfig(){var e,i,s,a,h;const d=(s=(i=(e=this.pass)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.uiConfig)!==null&&s!==void 0?s:{};return(h=(a=d.children)===null||a===void 0?void 0:a.map(b=>st(b)))===null||h===void 0||h.flat(2).forEach(b=>b&&(b.onChange=this.setDirty)),d}updateGBuffer(e,i){var s,a,h;if(e instanceof _.Kj0&&(!((s=e.material)===null||s===void 0)&&s.userData)){for(let b=3;b<8;b++)i.y=w_(i.y,b);let d=!((a=e.material)===null||a===void 0)&&a.userData._ssBevel?(h=e.material)===null||h===void 0?void 0:h.userData._ssBevel.radius:0;d=Math.min(d,31),d<<=3,i.y=i.y|d}}}ip.PluginType="SSBevelPlugin",ip.SSBEVEL_GLTF_EXTENSION="WEBGI_materials_ssbevel";class hI{constructor(e){this.parser=e,this.name=ip.SSBEVEL_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name];return i.userData||(i.userData={}),FS(i),i.userData._ssBevel=bn(a,i.userData._ssBevel,!1,{}),Promise.resolve()}}const dI=c=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._ssBevel||!e.userData._ssBevel.hasSSBevel)return;i.extensions=i.extensions||{};const s=qn(e.userData._ssBevel,!1);i.extensions[ip.SSBEVEL_GLTF_EXTENSION]=s,c.extensionsUsed[ip.SSBEVEL_GLTF_EXTENSION]=!0}});class jS extends Ix{constructor(e){super(),this._loadedLibs=!1,e=e||{method:J0.EncoderMethod.EDGEBREAKER,encodeSpeed:5},this._io=new kT().registerExtensions(cI).registerExtensions([zS,Cb,xb,Eb,Sb,Mb,Tb,Ib,Db,Pb,Rb,Bb,kb,Ob,Lb]),this._encoderOptions=e}preload(){return this._loadLibs(),this}async _loadLibs(){if(this._loadedLibs||!this.loader)return;const e=await Promise.all([this.loader.initEncoder(),this.loader.initDecoder()]);this._io.registerDependencies({"draco3d.encoder":e[0],"draco3d.decoder":e[1]}),this._loadedLibs=!0}async parseAsync(e,{compress:i=!1,...s}){if(!this.loader)return console.error("GLTFDracoExporter: No DRACOLoader2 instance provided"),super.parseAsync(e,s);await this._loadLibs();const a={...s};i&&(a.externalImagesInExtras=!0);const h=await new Promise((re,le)=>this.parse(e,re,le,a)),d=await super.parseAsync(h,a);if(!i)return d;if(!h)throw new Error("GLTFDracoExporter: gltf is null");let b=h;const X=b.byteLength||1/0,$=await(typeof b!="object"||b.byteLength?this._io.readBinary(new Uint8Array(b)):this._io.readJSON({json:b,resources:{}}));if($.createExtension(J0).setRequired(!0).setEncoderOptions(this._encoderOptions),a.exportExt==="glb")b=await this._io.writeBinary($),isFinite(X)&&console.log("DRACO Compression ratio: "+(b.byteLength/X).toFixed(5));else{const re=await this._io.writeJSON($);b=re.json,Object.values(re.resources).filter(le=>le).length>0&&(console.warn("DRACOExporter: extra resources in resources not supported properly"),b.resources=re.resources)}b.__isGLTFOutput=!0;const Z=await super.parseAsync(b,a);return Z.__uncompressed=d,Z}}class Jx extends Xi{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[Kn,H0]}async onAdded(e){await super.onAdded(e);const i=e.getManager().importer;if(!i)throw new Error("GLTFDracoExportPlugin: AssetImporter not found");(function(s,a){Dx(s,jS,h=>{const d=Ms()+".drc",b=h;b.loader=a.registerFile(d),b.loader.setDecoderConfig({type:"js"}),b.loader.preload(!0,!0)})})(e,i)}}Jx.PluginType="GLTFDracoExportPlugin";class pI extends Eo{constructor(){super(...arguments),this.extensionName=so,this.parentTypes=[Jn.SCENE],this.propertyType="ViewerJSON"}init(){}}class zS extends to{constructor(){super(...arguments),this.extensionName=so,this._viewerConfig={},this._texturesRef=[],this.required=!0}read(e){var i;return this._viewerConfig={},(i=e.jsonDoc.json.scenes)===null||i===void 0||i.forEach((s,a)=>{if(s.extensions&&s.extensions[so]){const h=new pI(this.document.getGraph());e.scenes[a].setExtension(so,h);const d=s.extensions[so];this._viewerConfig=d}}),this}write(e){return this.document.getRoot().listScenes().forEach(i=>{var s;if(i.getExtension(so)){const a=(s=e.jsonDoc.json.scenes)===null||s===void 0?void 0:s[e.jsonDoc.json.scene||0];a&&this._viewerConfig!=={}&&(a.extensions=a.extensions||{},a.extensions[so]=this._viewerConfig,this._texturesRef=[],this._viewerConfig={})}}),this}}zS.EXTENSION_NAME=so;class wb extends Eo{constructor(e,i,s){super(e,i),this.parentTypes=[Jn.MATERIAL,Jn.MESH,Jn.NODE,Jn.SCENE],this.propertyType="GenericExtension",this.textures={},this.extensionName=s}addTexture(e,i,s,a=4369){this.setRef(e,s,{channels:a}),this.textures[e]=[i,s]}copy(e,i=Bh){return super.copy(e,i),this}dispose(){Object.values(this.textures).forEach(([e,i])=>{e==null||e.dispose()}),super.dispose()}init(){}}class Nl extends to{constructor(){super(...arguments),this.textureChannels={}}read(e){const i=e.jsonDoc,s=i.json.materials||[],a=i.json.textures||[];return s.forEach((h,d)=>{var b,X;if(h.extensions&&h.extensions[this.extensionName]){const $=new wb(this.document.getGraph(),"",this.extensionName);e.materials[d].setExtension(this.extensionName,$);const Z={...h.extensions[this.extensionName]};for(const[re,le]of Object.entries(Z))if(typeof(le==null?void 0:le.index)=="number"){const he=le,fe=(b=a[he.index])===null||b===void 0?void 0:b.source;if(typeof fe!="number"){console.warn("GLTF Pipeline: source texture not found for texture info",he);continue}const me=e.textures[fe],Ee=new Gs(this.document.getGraph()),Ae=(X=this.textureChannels[re])!==null&&X!==void 0?X:4369;$.addTexture(re,Ee,me,Ae),e.setTextureInfo(Ee,he),delete Z[re]}$.setExtras(Z)}}),(i.json.meshes||[]).forEach((h,d)=>{if(h.extensions&&h.extensions[this.extensionName]){const b=new wb(this.document.getGraph(),"",this.extensionName);e.meshes[d].setExtension(this.extensionName,b);const X=h.extensions[this.extensionName];b.setExtras(X)}}),(i.json.nodes||[]).forEach((h,d)=>{if(h.extensions&&h.extensions[this.extensionName]){const b=new wb(this.document.getGraph(),"",this.extensionName);e.nodes[d].setExtension(this.extensionName,b);const X=h.extensions[this.extensionName];b.setExtras(X)}}),(i.json.scenes||[]).forEach((h,d)=>{if(h.extensions&&h.extensions[this.extensionName]){const b=new wb(this.document.getGraph(),"",this.extensionName);e.scenes[d].setExtension(this.extensionName,b);const X=h.extensions[this.extensionName];b.setExtras(X)}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(this.extensionName);if(a){const h=e.materialIndexMap.get(s),d=i.json.materials[h];d.extensions=d.extensions||{};const b={...a.getExtras()};for(const[X,$]of Object.entries(a.textures)){const Z=$[0],re=$[1];re&&(b[X]=e.createTextureInfoDef(re,Z))}d.extensions[this.extensionName]=b}}),this.document.getRoot().listMeshes().forEach(s=>{const a=s.getExtension(this.extensionName);if(a){const h=e.meshIndexMap.get(s),d=i.json.meshes[h];d.extensions=d.extensions||{},d.extensions[this.extensionName]=a.getExtras()}}),this.document.getRoot().listNodes().forEach(s=>{const a=s.getExtension(this.extensionName);if(a){const h=e.nodeIndexMap.get(s),d=i.json.nodes[h];d.extensions=d.extensions||{},d.extensions[this.extensionName]=a.getExtras()}}),this.document.getRoot().listScenes().forEach(s=>{const a=s.getExtension(this.extensionName);if(a){const h=e.jsonDoc.json.scene||0,d=i.json.scenes[h];if(!d)return;d.extensions=d.extensions||{},d.extensions[this.extensionName]=a.getExtras()}}),this}}class xb extends Nl{constructor(){super(...arguments),this.extensionName=xb.EXTENSION_NAME,this.textureChannels={bumpTexture:xo.R}}}xb.EXTENSION_NAME=vo;class Eb extends Nl{constructor(){super(...arguments),this.extensionName=Eb.EXTENSION_NAME,this.textureChannels={lightMapTexture:xo.R|xo.G|xo.B}}}Eb.EXTENSION_NAME=Hl;class Sb extends Nl{constructor(){super(...arguments),this.extensionName=Sb.EXTENSION_NAME,this.textureChannels={alphaTexture:xo.G}}}Sb.EXTENSION_NAME=gu;class Cb extends Nl{constructor(){super(...arguments),this.extensionName=Cb.EXTENSION_NAME}}Cb.EXTENSION_NAME=zs.DIAMOND_GLTF_EXTENSION;class Mb extends Nl{constructor(){super(...arguments),this.extensionName=Mb.EXTENSION_NAME}}Mb.EXTENSION_NAME=Os.AnimationMarkersExtension;class Tb extends Nl{constructor(){super(...arguments),this.extensionName=Tb.EXTENSION_NAME,this.textureChannels={anisotropyDirection:xo.R|xo.G|xo.B}}}Tb.EXTENSION_NAME=Za.ANISOTROPY_GLTF_EXTENSION;class Ib extends Nl{constructor(){super(...arguments),this.extensionName=Ib.EXTENSION_NAME,this.textureChannels={anisotropyDirection:xo.R|xo.G|xo.B}}}Ib.EXTENSION_NAME=ua.CUSTOM_BUMP_MAP_GLTF_EXTENSION;class Db extends Nl{constructor(){super(...arguments),this.extensionName=Db.EXTENSION_NAME}}Db.EXTENSION_NAME=ya;class Pb extends Nl{constructor(){super(...arguments),this.extensionName=Pb.EXTENSION_NAME}}Pb.EXTENSION_NAME=Gl;class Rb extends Nl{constructor(){super(...arguments),this.extensionName=Rb.EXTENSION_NAME}}Rb.EXTENSION_NAME=oo;class Bb extends Nl{constructor(){super(...arguments),this.extensionName=Bb.EXTENSION_NAME}}Bb.EXTENSION_NAME=Ml.CLEARCOAT_TINT_GLTF_EXTENSION;class kb extends Nl{constructor(){super(...arguments),this.extensionName=kb.EXTENSION_NAME}}kb.EXTENSION_NAME=la.THIN_FILM_LAYER_GLTF_EXTENSION;class Ob extends Nl{constructor(){super(...arguments),this.extensionName=Ob.EXTENSION_NAME}}Ob.EXTENSION_NAME=ip.SSBEVEL_GLTF_EXTENSION;class Lb extends Nl{constructor(){super(...arguments),this.extensionName=Lb.EXTENSION_NAME}}Lb.EXTENSION_NAME=ca.NOISE_BUMP_MATERIAL_GLTF_EXTENSION;class VS extends oe{constructor(){super(...arguments),this.processor={forAssetType:"texture",process:(e,i)=>e}}async onAdded(e){}async onDispose(e){}async onRemove(e){this._pmrem=void 0}}VS.PluginType="PMREMGenerator";const GS=new _.Pa4,fI=new _._fP,QS=new _.Pa4;class mI extends _.Tme{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(i){i.element instanceof Element&&i.element.parentNode!==null&&i.element.parentNode.removeChild(i.element)})})}copy(e,i){return super.copy(e,i),this.element=e.element.cloneNode(!0),this}}const Oh=new _.yGw,gI=new _.yGw;class _I{constructor(e={}){const i=this;let s,a,h,d;const b={camera:{fov:0,style:""},objects:new WeakMap},X=e.element!==void 0?e.element:document.createElement("div");X.style.overflow="hidden",this.domElement=X;const $=document.createElement("div");function Z(fe){return Math.abs(fe)<1e-10?0:fe}function re(fe){const me=fe.elements;return"matrix3d("+Z(me[0])+","+Z(-me[1])+","+Z(me[2])+","+Z(me[3])+","+Z(me[4])+","+Z(-me[5])+","+Z(me[6])+","+Z(me[7])+","+Z(me[8])+","+Z(-me[9])+","+Z(me[10])+","+Z(me[11])+","+Z(me[12])+","+Z(-me[13])+","+Z(me[14])+","+Z(me[15])+")"}function le(fe){const me=fe.elements;return"translate(-50%,-50%)matrix3d("+Z(me[0])+","+Z(me[1])+","+Z(me[2])+","+Z(me[3])+","+Z(-me[4])+","+Z(-me[5])+","+Z(-me[6])+","+Z(-me[7])+","+Z(me[8])+","+Z(me[9])+","+Z(me[10])+","+Z(me[11])+","+Z(me[12])+","+Z(me[13])+","+Z(me[14])+","+Z(me[15])+")"}function he(fe,me,Ee,Ae){if(fe.isCSS3DObject){const ye=fe.visible===!0&&fe.layers.test(Ee.layers)===!0;if(fe.element.style.display=ye===!0?"":"none",ye===!0){let ge;fe.onBeforeRender(i,me,Ee),fe.isCSS3DSprite?(Oh.copy(Ee.matrixWorldInverse),Oh.transpose(),fe.rotation2D!==0&&Oh.multiply(gI.makeRotationZ(fe.rotation2D)),fe.matrixWorld.decompose(GS,fI,QS),Oh.setPosition(GS),Oh.scale(QS),Oh.elements[3]=0,Oh.elements[7]=0,Oh.elements[11]=0,Oh.elements[15]=1,ge=le(Oh)):ge=le(fe.matrixWorld);const Pe=fe.element,Be=b.objects.get(fe);if(Be===void 0||Be.style!==ge){Pe.style.transform=ge;const Oe={style:ge};b.objects.set(fe,Oe)}Pe.parentNode!==$&&$.appendChild(Pe),fe.onAfterRender(i,me,Ee)}}for(let ye=0,ge=fe.children.length;ye<ge;ye++)he(fe.children[ye],me,Ee)}$.style.transformStyle="preserve-3d",$.style.pointerEvents="none",X.appendChild($),this.getSize=function(){return{width:s,height:a}},this.render=function(fe,me){const Ee=me.projectionMatrix.elements[5]*d;let Ae,ye;b.camera.fov!==Ee&&(X.style.perspective=me.isPerspectiveCamera?Ee+"px":"",b.camera.fov=Ee),fe.matrixWorldAutoUpdate===!0&&fe.updateMatrixWorld(),me.parent===null&&me.matrixWorldAutoUpdate===!0&&me.updateMatrixWorld(),me.isOrthographicCamera&&(Ae=-(me.right+me.left)/2,ye=(me.top+me.bottom)/2);const ge=me.isOrthographicCamera?"scale("+Ee+")translate("+Z(Ae)+"px,"+Z(ye)+"px)"+re(me.matrixWorldInverse):"translateZ("+Ee+"px)"+re(me.matrixWorldInverse),Pe=ge+"translate("+h+"px,"+d+"px)";b.camera.style!==Pe&&($.style.transform=Pe,b.camera.style=Pe),he(fe,fe,me)},this.setSize=function(fe,me){s=fe,a=me,h=s/2,d=a/2,X.style.width=fe+"px",X.style.height=me+"px",$.style.width=fe+"px",$.style.height=me+"px"}}}var Nb,Ub=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let rp=Nb=class extends Xi{constructor(c=!0){super(),this._scene=new _.xsS,this.overCanvas=!0,this._trackers=[],this.attachIFrameToSelected=async()=>{var e,i,s,a,h;const d=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(br))===null||i===void 0?void 0:i.getSelectedObject();if(!(d!=null&&d.geometry))return void await((s=this._viewer)===null||s===void 0?void 0:s.alert("No Geometry: Selected object must have a geometry to apply the iframe to"));const b=await((a=this._viewer)===null||a===void 0?void 0:a.prompt("URL: Enter the url for the webpage. (Make sure its allowed to be embedded in an iframe.)","https://webgi.xyz/",!1))||"https://webgi.pixotronics.com/";if(!b)return;const X=await((h=this._viewer)===null||h===void 0?void 0:h.prompt("Width: Enter the width for the object.","512",!1))||"512";X&&this.attachIFrame(d,b,parseInt(X))},this._resizeObserver=new ResizeObserver(()=>{var e;this.enabled&&((e=this._viewer)===null||e===void 0||e.scene.setDirty({sceneUpdate:!0}))}),this.enabled=c,this._refreshCanvasInDOM=this._refreshCanvasInDOM.bind(this),this._refreshEnabled=this._refreshEnabled.bind(this)}_refreshEnabled(){}_refreshCanvasInDOM(){const c=this._viewer;c&&this._renderer&&(c.canvas.remove(),this.overCanvas?this._renderer.domElement.insertAdjacentElement("afterbegin",c.canvas):this._renderer.domElement.appendChild(c.canvas))}_initialize(){if(this._renderer||!this._viewer)return;this._renderer=new _I;const c=this._viewer.renderer.rendererObject.getSize(new _.FM8);this._renderer.setSize(c.width,c.height);const e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.zIndex="0",e.appendChild(this._renderer.domElement),this._viewer.canvas.style.position="absolute",this._viewer.canvas.style.top="0",this._viewer.canvas.style.left="0",this._viewer.canvas.style.zIndex="0",this._viewer.container.appendChild(e),this._refreshCanvasInDOM(),this._viewer.renderer.addEventListener("resize",()=>{if(!this._viewer||!this._renderer)return;const i=this._viewer.renderer.rendererObject.getSize(new _.FM8);this._renderer.setSize(i.width,i.height)})}async onAdded(c){await super.onAdded(c);let e=!0,i=!0;c.addEventListener("postFrame",h=>{var d,b;e&&this.enabled&&(this._renderer||this._initialize(),this._renderer&&(i&&this._trackers.forEach(X=>{var $,Z;let re=!0;const le=X.modelObj.material.side;if(le!==_.ehD){const he=new _.Pa4(0,0,1).applyQuaternion(X.cssObj.quaternion),fe=(Z=($=this._viewer)===null||$===void 0?void 0:$.scene.activeCamera)===null||Z===void 0?void 0:Z.cameraObject,me=he.dot(fe.getWorldDirection(new _.Pa4));re=le===_._Li?me>0:me<0}X.cssObj.element.style.visibility=re?"visible":"hidden"}),this._trackers.filter(X=>X.dirty).forEach(X=>this._syncProperties(X)),(d=this._renderer)===null||d===void 0||d.render(this._scene,(b=c.scene.activeCamera)===null||b===void 0?void 0:b.cameraObject),e=!1))}),c.addEventListener("update",h=>{this.enabled&&(e=this._trackers.length>0)}),c.scene.addEventListener("sceneUpdate",h=>{this.enabled&&(this._trackers.forEach(d=>d.dirty=!0),e=this._trackers.length>0)}),c.scene.addEventListener("activeCameraUpdate",h=>{this.enabled&&(e=this._trackers.length>0,i=!0)});let s=!1;const a=new _.iMs;c.container.addEventListener("mousemove",h=>{if(!this.enabled||!this._viewer||this.overCanvas)return;const d=this._viewer.canvas.getBoundingClientRect(),b=(h.clientX-d.x)/d.width*2-1,X=-(h.clientY-d.y)/d.height*2+1;a.setFromCamera({x:b,y:X},this._viewer.scene.activeCamera.cameraObject);const $=this._trackers.map(re=>re.modelObj),Z=a.intersectObjects($,!1);if(console.log(Z),Z.length)return this._viewer.canvas.style.pointerEvents="none",s=!0,void console.log(this._viewer.canvas.style.pointerEvents);s&&(this._viewer.canvas.style.pointerEvents="auto",s=!1)})}attachIFrame(c,e,i){const s=jb(c.modelObject),a=HS(e,i,i*s.y/s.x,()=>{var h;return(h=c.setDirty)===null||h===void 0?void 0:h.call(c)});return this.attachCSS3DObject(a,c),a}attachCSS3DObject(c,e){var i,s,a,h,d;if(this._trackers.push({cssObj:c,modelObj:e.modelObject,dirty:!0}),c.element&&(this._resizeObserver.observe(c.element),c.element.__isCSS3DObjectElement=!0,console.log(c.element,c.element.__isCSS3DObjectElement)),e.userData.__oldMaterial=e.material,!e.setMaterial)throw"model not processed?";const b=(i=this._viewer)===null||i===void 0?void 0:i.createMaterial("basic",{opacity:0,color:new _.Ilk("black"),blending:_.jFi,side:_.Wl3});if(!b)throw"cannot create mat";b.userData.forcedLinearDepth=0,(s=e.setMaterial)===null||s===void 0||s.call(e,b),Fb(e.modelObject),$x(e.modelObject),jb(e.modelObject),this._scene.add(c),(h=(a=this.uiConfig)===null||a===void 0?void 0:a.uiRefresh)===null||h===void 0||h.call(a),(d=e.setDirty)===null||d===void 0||d.call(e)}_syncProperties(c){const e=c.modelObj,i=c.cssObj;e.updateMatrixWorld();const s=c.cssObj.element.clientWidth<1.5?0:(c.cssObj.element.clientWidth-1.5)/jb(e).x,a=Fb(e);i.quaternion.setFromUnitVectors(new _.Pa4(0,0,1),a),i.position.copy($x(e)),i.scale.set(1,1,1).multiplyScalar(1/s),i.updateMatrixWorld(),i.applyMatrix4(e.matrixWorld),c.dirty=!1}async onDispose(c){return this._resizeObserver.disconnect(),super.onDispose(c)}};function HS(c,e,i,s){const a=document.createElement("div");a.style.width=e.toString()+"px",a.style.height=i.toString()+"px",a.style.backgroundColor="transparent";const h=document.createElement("iframe",{is:"x-frame-bypass"});h.style.width="100%",h.style.height="100%",h.style.border="0px";const d=()=>{var b,X;try{h.contentWindow.name}catch($){(typeof $=="string"?$:(X=(b=$==null?void 0:$.toString)===null||b===void 0?void 0:b.call($))!==null&&X!==void 0?X:"").includes("cross-origin")?console.warn("Trying to load cross-origin scripts, Install chrome extension if not able to load: https://chrome.google.com/webstore/detail/ignore-x-frame-headers/gleekbfjekiniecknbkamfmkohkpodhe"):console.error($)}s(),h.removeEventListener("load",d)};return h.addEventListener("load",d),h.src=c,a.appendChild(h),new mI(a)}function Fb(c){if(c.geometry.userData.geometryNormal)return c.geometry.userData.geometryNormal;const e=c.geometry.attributes.normal,i=new _.Pa4,s=new _.Pa4;for(let a=0,h=e.count;a<h;a++)i.fromBufferAttribute(e,a),s.add(i);return s.normalize(),c.geometry.userData.geometryNormal=s,s}function $x(c){if(c.geometry.userData.geometryCenter)return c.geometry.userData.geometryCenter;const e=c.geometry;if(!e)return new _.Pa4(0,0,0);e.boundingBox||e.computeBoundingBox();const i=e.boundingBox.getCenter(new _.Pa4);return c.geometry.userData.geometryCenter=i,i}function jb(c,e=new _.Pa4(0,0,1)){if(c.geometry.userData.geometrySize)return c.geometry.userData.geometrySize;const i=c.geometry;if(!i)return new _.Pa4(0,0,0);const s=i.clone();s.applyMatrix4(new _.yGw().makeRotationFromQuaternion(new _._fP().setFromUnitVectors(e,Fb(c)).invert())),s.computeBoundingBox();const a=s.boundingBox.getSize(new _.Pa4);return c.geometry.userData.geometrySize=a,s.dispose(),a}rp.PluginType="CSS3DRenderer",Ub([Xn("Enabled"),lt(Nb.prototype._refreshEnabled),kt()],rp.prototype,"enabled",void 0),Ub([Xn("Over canvas"),lt(Nb.prototype._refreshCanvasInDOM),kt()],rp.prototype,"overCanvas",void 0),Ub([lr("Attach iframe")],rp.prototype,"attachIFrameToSelected",void 0),rp=Nb=Ub([ur("CSS3D Renderer")],rp);var gf,$m=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Lh=gf=class{constructor(c){this.enabled=!0,this.enableHighlight=!0,this.enableDynamicSelection=!0,this.outlineIntensity=2,this.highlightTransparency=.84,this.outlineColor=new _.Ilk(13715217),this.transparnecy=0,this._outlineThickness=2,this.extraUniforms={outlineIntensity:{value:1},tDiffuseSize:{value:new _.FM8(1,1)},outlineThickness:{value:2},highlightTransparency:{value:1},outlineColor:{value:new _.Ilk(16777215)},enableHighlight:{value:!0}},this.parsFragmentSnippet=(e,i)=>this.enabled?Ne`
            ${Wa}
            ${"uniform vec2 tDiffuseSize;uniform vec3 outlineColor;uniform float outlineThickness;uniform float outlineIntensity;uniform float highlightTransparency;uniform bool enableHighlight;float getVisibilityBit(in float number){return mod(floor(number/pow(2.,2.)),2.);}float visibility(vec2 uv){float backGround=getDepth(uv)>0.9999?1.:0.;return getVisibilityBit(getGBufferFlags(uv).a*255.)*(1.-backGround);}vec4 outline(in vec4 color){vec2 invSize=1./tDiffuseSize;vec4 uvOffset=outlineThickness*vec4(1.,0.,-1.,1.)*vec4(invSize,invSize);float c=visibility(vUv);float c1=visibility(vUv+uvOffset.xy);float c2=visibility(vUv-uvOffset.xy);float c3=visibility(vUv+uvOffset.yw);float c4=visibility(vUv-uvOffset.yw);float diff1=(c1-c2)*0.5;float diff2=(c3-c4)*0.5;float d=length(vec2(diff1,diff2));float trans=min(1.,10.*(1.-highlightTransparency));vec4 highlightColor=enableHighlight?vec4(c*outlineColor,(1.-highlightTransparency)*c):vec4(0.);vec4 outColor=vec4(outlineColor,trans)*vec4(d)+highlightColor;vec3 finalColor=mix(color.rgb,outlineIntensity*outColor.rgb,outColor.a);return vec4(finalColor.rgb,color.a);}"}
        `:"",this._combinedPostPlugin=c.getPlugin(fc),this._pickingPlugin=c.getPlugin(br),this._setDirty=this._setDirty.bind(this)}shaderExtender(c,e,i){this.enabled&&(c.fragmentShader=gs(c.fragmentShader,"#glMarker",` 
            gl_FragColor = outline(gl_FragColor);
            #glMarker
        `))}onObjectRender(c,e,i){this.enabled&&e.materialObject.uniforms.outlineIntensity&&(e.materialObject.uniforms.outlineIntensity.value=this.outlineIntensity,e.materialObject.uniforms.outlineThickness.value=this._outlineThickness,e.materialObject.uniforms.outlineColor.value.copy(this.outlineColor),e.materialObject.uniforms.enableHighlight.value=this.enableHighlight,e.materialObject.uniforms.highlightTransparency.value=this.transparnecy)}getUiConfig(){return this.uiConfig}computeCacheKey(c){return this.enabled?"1":"0"}isCompatible(c){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var c;(c=this.__setDirty)===null||c===void 0||c.call(this),this._setDirty()}_enable(){var c;(c=this._pickingPlugin)===null||c===void 0||c.enableWidget(!this.enabled),this._setDirty()}};Lh.PluginType="Outline",$m([lt(gf.prototype._enable),Xn("Enable"),kt()],Lh.prototype,"enabled",void 0),$m([lt(gf.prototype._setDirty),Xn("Highlight"),kt()],Lh.prototype,"enableHighlight",void 0),$m([lt(gf.prototype._setDirty),Xn("DynamicSelection"),kt()],Lh.prototype,"enableDynamicSelection",void 0),$m([lt(gf.prototype._setDirty),ai("Intensity",[0,2],.001,{limitedUi:!0}),kt()],Lh.prototype,"outlineIntensity",void 0),$m([lt(gf.prototype._setDirty),ai("Transparency",[0,1],.01,{limitedUi:!0}),kt()],Lh.prototype,"highlightTransparency",void 0),$m([lt(gf.prototype._setDirty),ml("Color"),kt()],Lh.prototype,"outlineColor",void 0),Lh=gf=$m([ur("Outline")],Lh);class zb extends ku{constructor(){super(),this._state="in",this.updateGBuffer=this.updateGBuffer.bind(this)}generateExtension(e){return new Lh(e)}async onAdded(e){var i,s;await super.onAdded(e),(i=e.getPlugin(Or))===null||i===void 0||i.registerGBufferUpdater(this.updateGBuffer),this._pickingPlugin=e.getPlugin(br);const a=this;(s=this._pickingPlugin)===null||s===void 0||s.addEventListener("selectedObjectChanged",()=>{var h;a._animationCallBack||(!((h=this._pickingPlugin)===null||h===void 0)&&h.getSelectedObject()?(this._extension.transparnecy=1,a._animationCallBack=this._startTransparencyAnimation(1,this._extension.highlightTransparency,400)):this._extension.transparnecy=1)}),document.addEventListener("mousemove",h=>{var d;const b=(d=this._pickingPlugin)===null||d===void 0?void 0:d.getSelectedObject();b&&this._extension.enableDynamicSelection?h.target!=e.canvas?a._animationCallBack||a._state!="in"||(a._animationCallBack=this._startTransparencyAnimation(this._extension.highlightTransparency,1,600),a._state="out"):a._animationCallBack||a._state!="out"||(a._animationCallBack=this._startTransparencyAnimation(1,this._extension.highlightTransparency,600),a._state="in"):this._extension.transparnecy=b?this._extension.highlightTransparency:1})}async _startTransparencyAnimation(e,i,s){return s_(this._extension,"transparnecy",{from:e,to:i,duration:s,onComplete:()=>{this._animationCallBack=null}})}updateGBuffer(e,i){var s;if(e instanceof _.Kj0){const a=(s=this._pickingPlugin)===null||s===void 0?void 0:s.getSelectedObject();a&&a.id===e.id?i.w=Cm(i.w,2,1):i.w=Cm(i.w,2,0)}}}zb.PluginType="Outline";const vI=1e4,WS=50;class q_{constructor(e=WS){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(e)}setDecayTime(e){this.naturalFrequency=1/Math.max(.001,e)}update(e,i,s,a){const h=2e-4*this.naturalFrequency;if(e==null||a===0||e===i&&this.velocity===0)return i;if(s<0)return e;const d=e-i,b=this.velocity+this.naturalFrequency*d,X=d+s*b,$=Math.exp(-this.naturalFrequency*s),Z=(b-this.naturalFrequency*X)*$,re=-this.naturalFrequency*(Z+b*$);return Math.abs(Z)<h*Math.abs(a)&&re*d>=0?(this.velocity=0,i):(this.velocity=Z,i+X*$)}}const Zx=new _.Pa4;class qS{constructor(){this.inputSource=null,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new _.Pa4,this.firstRatio=0,this.lastAngle=0,this.goalPosition=new _.Pa4,this.goalYaw=0,this.goalScale=1,this.presentedScene=null,this.placementBox=null,this.placeOnWall=!1,this.placementComplete=!1,this.xr=null,this.session=null,this._hitPosition=new _.Pa4,this._hitMatrix=new _.yGw,this.xDamper=new q_,this.yDamper=new q_,this.zDamper=new q_,this.yawDamper=new q_,this.scaleDamper=new q_,this.onSelectStart=e=>{const i=this.transientHitTestSource;if(i==null)return;const s=this.frame.getHitTestResultsForTransientInput(i),a=this.presentedScene,h=this.placementBox;if(s.length===1){this.inputSource=e.inputSource;const{axes:d}=this.inputSource.gamepad||{axes:[0,0]},b=h.getHit(a,d[0],d[1]);h.show=!0,b!=null?(this.isTranslating=!0,this.lastDragPosition.copy(b)):this.placeOnWall||(this.isRotating=!0,this.lastAngle=1.5*d[0])}else if(s.length===2){h.show=!0,this.isTwoFingering=!0;const{separation:d}=this.fingerPolar(s);this.firstRatio=d/a.scale.x}},this.onSelectEnd=()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1}}async setSession(e,i,s,a){var h;this.transientHitTestSource=await((h=e.requestHitTestSourceForTransientInput)===null||h===void 0?void 0:h.call(e,{profile:"generic-touchscreen"})),this.presentedScene=i,this.placementBox=a,this.xr=s,this.session=e,this.placementComplete=!1,this.goalPosition.copy(i.position),this.goalYaw=i.rotation.y,this.goalScale=i.scale.x,e.addEventListener("selectstart",this.onSelectStart),e.addEventListener("selectend",this.onSelectEnd)}cancel(){this.transientHitTestSource&&(this.transientHitTestSource.cancel(),this.transientHitTestSource=void 0),this.presentedScene=null,this.placeOnWall=!1,this.frame=void 0,this.xr=null,this.placementBox&&(this.placementBox.show=!1,this.placementBox=null),this.session&&(this.session.removeEventListener("selectstart",this.onSelectStart),this.session.removeEventListener("selectend",this.onSelectEnd),this.session=null)}getHitPoint(e){var i;const s=(i=this.xr)===null||i===void 0?void 0:i.getReferenceSpace(),a=s?e.getPose(s):null;return a?(this._hitMatrix.fromArray(a.transform.matrix),this.placeOnWall&&(this.goalYaw=Math.atan2(this._hitMatrix.elements[4],this._hitMatrix.elements[6])),this._hitMatrix.elements[5]>.75!==this.placeOnWall?this._hitPosition.setFromMatrixPosition(this._hitMatrix):null):null}moveScene(e){if(!this.session)return;const i=this.presentedScene,s=i.position,a=i.rotation.y,h=this.placementBox,d=Math.max(h.boundingSize.x,h.boundingSize.y,h.boundingSize.z)/2,b=this.goalPosition,X=i.scale.x;if(!b.equals(s)||this.goalScale!==X){let{x:$,y:Z,z:re}=s;$=this.xDamper.update($,b.x,e,d),Z=this.yDamper.update(Z,b.y,e,d),re=this.zDamper.update(re,b.z,e,d),s.set($,Z,re);const le=this.scaleDamper.update(X,this.goalScale,e,1);if(i.scale.set(le,le,le),!this.isTranslating){const he=b.y-Z;this.placementComplete&&!this.placeOnWall?h.offsetHeight=he/le:he===0&&(this.placementComplete=!0,h.show=!1)}}h.updateOpacity(e),i.rotation.y=this.yawDamper.update(a,this.goalYaw,e,Math.PI)}processInput(e){var i;this.frame=e;const s=this.transientHitTestSource;if(!s||!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;const a=e.getHitTestResultsForTransientInput(s),h=this.presentedScene,d=h.scale.x;if(this.isTwoFingering)if(a.length<2)this.isTwoFingering=!1;else{const{separation:b,deltaYaw:X}=this.fingerPolar(a);if(this.placeOnWall||(this.goalYaw+=X),!h.userData.__scaleDisabled){const $=b/this.firstRatio;this.goalScale=$<1.3&&$>.7692307692307692?1:$}}else if(a.length!==2)if(this.isRotating&&(!((i=this.inputSource)===null||i===void 0)&&i.gamepad)){const b=1.5*this.inputSource.gamepad.axes[0];this.goalYaw+=b-this.lastAngle,this.lastAngle=b}else this.isTranslating&&(console.log("translating"),a.forEach(b=>{if(b.inputSource!==this.inputSource)return;let X=null;if(b.results.length>0&&(X=this.getHitPoint(b.results[0])),X==null&&(X=this.getTouchLocation()),X!=null){if(this.goalPosition.sub(this.lastDragPosition),!this.placeOnWall){const $=X.y-this.lastDragPosition.y;if($<0){this.placementBox.offsetHeight=$/d;const Z=Zx.copy(this.xr.getCamera().position),re=-$/(Z.y-X.y);Z.multiplyScalar(re),X.multiplyScalar(1-re).add(Z)}}this.goalPosition.add(X),this.lastDragPosition.copy(X)}}));else{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;const{separation:b}=this.fingerPolar(a);this.firstRatio=b/d}}getTouchLocation(){var e,i;const{axes:s}=(e=this.inputSource.gamepad)!==null&&e!==void 0?e:{axes:[0,0]},a=this.placementBox.getExpandedHit(this.presentedScene,s[0],s[1]);return a!=null&&(Zx.copy(a).sub((i=this.xr)===null||i===void 0?void 0:i.getCamera().position),Zx.length()>10)?null:a}fingerPolar(e){var i,s,a,h,d,b;const X=(a=(s=(i=e[0].inputSource)===null||i===void 0?void 0:i.gamepad)===null||s===void 0?void 0:s.axes)!==null&&a!==void 0?a:[0,0],$=(b=(d=(h=e[1].inputSource)===null||h===void 0?void 0:h.gamepad)===null||d===void 0?void 0:d.axes)!==null&&b!==void 0?b:[0,0],Z=$[0]-X[0],re=$[1]-X[1],le=Math.atan2(re,Z);let he=this.lastAngle-le;return he>Math.PI?he-=2*Math.PI:he<-Math.PI&&(he+=2*Math.PI),this.lastAngle=le,{separation:Math.sqrt(Z*Z+re*re),deltaYaw:he}}}const Vb=.2,AI=Math.PI/24,YS=new _.FM8,Gb=(c,e,i)=>{let s=e>0?i>0?0:-Math.PI/2:i>0?Math.PI/2:Math.PI;for(let a=0;a<=12;++a)c.push(e+.17*Math.cos(s),i+.17*Math.sin(s),0,e+Vb*Math.cos(s),i+Vb*Math.sin(s),0),s+=AI};class XS extends _.Kj0{constructor(e,i,s=!1){super(((X,$)=>{const Z=new _.u9r,re=[],le=[],he=X.getSize(new _.Pa4),fe=he.x/2,me=($?he.y:he.z)/2;Gb(le,fe,me),Gb(le,-fe,me),Gb(le,-fe,-me),Gb(le,fe,-me);const Ee=le.length/3;for(let ye=0;ye<Ee-2;ye+=2)re.push(ye,ye+1,ye+3,ye,ye+3,ye+2);const Ae=Ee-2;return re.push(Ae,Ae+1,1,Ae,1,0),Z.setAttribute("position",new _.a$l(le,3)),Z.setIndex(re),Z})(e,s)),this.boundingSize=new _.Pa4,this._raycaster=new _.iMs,this._camera=i,this._placeOnWall=s;const a=this.material;a.side=_.Wl3,a.color=new oi(16711935),a.opacity=0,this.userData.bboxVisible=!1;const h=e.getSize(this.boundingSize);console.log(e,s,h,this);const d=h.x/2,b=(s?h.y:h.z)/2;this.hitPlane=new _.Kj0(new _._12(2*(d+Vb),2*(b+Vb))),this.hitPlane.visible=!1,this.add(this.hitPlane),e.getCenter(this.position),s?(this.shadowHeight=e.min.z,this.position.z=this.shadowHeight):(this.rotateX(-Math.PI/2),this.shadowHeight=e.min.y,this.position.y=this.shadowHeight),this.offsetHeight=0}getHit(e,i,s){YS.set(i,-s),this.hitPlane.visible=!0;const a=this._positionAndNormalFromPoint(YS,this.hitPlane);return this.hitPlane.visible=!1,a==null?null:a.position}getExpandedHit(e,i,s){this.hitPlane.scale.set(1e3,1e3,1e3);const a=this.getHit(e,i,s);return this.hitPlane.scale.set(1,1,1),a}set offsetHeight(e){e-=.001,this._placeOnWall?this.position.z=this.shadowHeight+e:this.position.y=this.shadowHeight+e}get offsetHeight(){return this._placeOnWall?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(e){this.material.opacity=e?.75:0}get show(){return this.material.opacity>.01}updateOpacity(e){const i=this.material;this.visible=i.opacity>0}dispose(){var e;const{geometry:i,material:s}=this.hitPlane;i.dispose(),s.dispose(),this.geometry.dispose(),this.material.dispose(),(e=this.parent)===null||e===void 0||e.remove(this)}_positionAndNormalFromPoint(e,i){if(!this._camera)return null;this._raycaster.setFromCamera(e,this._camera);const s=this._raycaster.intersectObject(i,!0);if(s.length===0)return null;const a=s[0];return a.face==null?null:a.uv==null?{position:a.point,normal:a.face.normal,uv:null}:(a.face.normal.applyNormalMatrix(new _.Vkp().getNormalMatrix(a.object.matrixWorld)),{position:a.point,normal:a.face.normal,uv:a.uv})}}class KS extends Xi{constructor(){super(...arguments),this.enabled=!0,this._touchInputHelper=new qS,this._preRender=()=>{if(!(this._dirty&&this._viewer&&this._xrManager&&this._xrSession))return;this._viewer.renderer.composer.renderToScreen=!1,this._xrManager.enabled=!1;const e=this._xrManager.getCamera(),i=e.cameras[0]||e,s=this._viewer.scene.activeCamera;s.cameraObject.projectionMatrix.copy(i.projectionMatrix),s.cameraObject.projectionMatrixInverse.copy(s.cameraObject.projectionMatrix).invert()},this._postRender=()=>{var e,i;if(!this._dirty||!this._viewer||!this._xrSession)return;this._viewer.scene.activeCamera.cameraObject.updateProjectionMatrix();const s=this._viewer.renderer,a=(i=(e=this._xrManager)===null||e===void 0?void 0:e.getCamera())===null||i===void 0?void 0:i.cameras[0].viewport;a?s.rendererObject.setViewport(a):console.warn("no viewport for ar camera"),Rn(s.rendererObject,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!1,transmissionRender:!1,screenSpaceRendering:!1},()=>{Qb.render(s.rendererObject,null,s.composer.readBuffer,0,!1)}),this._xrManager.enabled=!0,this._viewer.renderer.composer.renderToScreen=!0},this._frameCount=0,this._lastTime=0,this._preFrame=({xrFrame:e,deltaTime:i})=>{var s,a;if(this.dirty=!!e&&((s=this._xrManager)===null||s===void 0?void 0:s.isPresenting)||!1,this._viewer.scene.activeCamera.interactionsEnabled=!this._dirty,this._viewer.scene.activeCamera.autoLookAtTarget=!this._dirty,!this._dirty||!e)return void(this._xrSession&&this._xrSessionEnd());if(!this._xrSession&&!this._xrManager.getSession())return console.error("no xr session found, shouldn't happen"),void(this.dirty=!1);this._xrSession||console.log("webxr: AR session init"),this._frameCount++;const h=this._xrManager.getReferenceSpace(),d=e.getViewerPose(h);if(d==null&&this._frameCount,d==null||((a=this._viewer)===null||a===void 0?void 0:a.scene.modelRoot.children.length)===0)return this.dirty=!1,void console.log("no pose or no model");if(!this._xrSession){if(this._xrSession=this._xrManager.getSession()||void 0,!this._xrSession)return;this._frameCount=0,this._cancelHitSources(),this._savePreXRState(),this._preSetupModel(),this._xrSessionStart()}const b=this._viewer.scene.activeCamera;this._xrManager.updateCamera(b.cameraObject),b.setDirty(),this.moveToFloor(e),this._touchInputHelper.processInput(e),this._touchInputHelper.moveScene(i),this._updateShadow()},this.placeOnWall=!1,this._preXRState={viewerBg:null,modelScale:new _.Pa4(1,1,1),modelPosition:new _.Pa4,modelRotation:new _._fP,cameraPosition:new _.Pa4(0,0,5),cameraTarget:new _.Pa4,cameraUp:new _.Pa4(0,1,0),cameraAspect:1,cameraFov:50,cameraZoom:1,cameraNear:.01,cameraFar:100,groundOffset:new _.Pa4,groundScale:1},this._savePreXRState=()=>{if(!this._viewer)return;this._preXRState.viewerBg=this._viewer.getBackground(!0);const e=this._viewer.scene.modelRoot,i=this._viewer.scene.activeCamera;e.updateMatrix(),e.updateMatrixWorld(!0),this._preXRState.modelScale.copy(e.scale),this._preXRState.modelPosition.copy(e.position),this._preXRState.modelRotation.copy(e.quaternion),this._preXRState.cameraPosition.copy(i.position),this._preXRState.cameraTarget.copy(i.target),this._preXRState.cameraUp.copy(i.cameraObject.up),i.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov=i.cameraObject.fov,this._preXRState.cameraAspect=i.cameraObject.aspect),this._preXRState.cameraZoom=i.cameraObject.zoom,this._preXRState.cameraNear=i.cameraObject.near,this._preXRState.cameraFar=i.cameraObject.far;const s=this._viewer.getPluginByType("Ground");s!=null&&s.mesh&&(this._preXRState.groundOffset.subVectors(e.position,s.mesh.modelObject.position),this._preXRState.groundScale=s.mesh.modelObject.scale.x,console.log("ground offset",this._preXRState.groundOffset,this._preXRState.groundScale),s.shadowBaker.enabled=!1)},this._xrSessionStart=()=>{if(!this._xrSession||!this._viewer)return;console.log("webxr: AR session start");const e=20*Math.PI/180,i=this.placeOnWall?void 0:new window.XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(e),z:-Math.cos(e)});this._touchInputHelper.placeOnWall=this.placeOnWall,this._viewer.resize(),(async()=>{var s,a;if(this._xrSession){const h=await this._xrSession.requestReferenceSpace("viewer");this._hitTestSource=await((a=(s=this._xrSession).requestHitTestSource)===null||a===void 0?void 0:a.call(s,{space:h,offsetRay:i}))}this._xrSession&&await this._touchInputHelper.setSession(this._xrSession,this._viewer.scene.modelRoot,this._xrManager,this._placementBox)})()},this._xrSessionEnd=()=>{var e;console.log("webxr: AR session end"),this._frameCount=0,(e=this._xrSession)===null||e===void 0||e.removeEventListener("end",this._xrSessionEnd),this._xrSession=void 0,this._cancelHitSources(),this._viewer&&(this._restorePreXRState(),this._viewer.resize())}}async onAdded(e){await super.onAdded(e);const i=e.renderer.rendererObject.xr;i.enabled=!0,i.cameraAutoUpdate=!1,this._xrManager=i;const s=document.getElementById("tweakpaneUiContainer"),a=s?{root:s}:void 0;document.body.appendChild(class{static createButton(h,d={}){const b=document.createElement("button");function X(){b.style.display="",b.style.cursor="auto",b.style.left="calc(50% - 75px)",b.style.width="150px",b.onmouseenter=null,b.onmouseleave=null,b.onclick=null}function $(Z){Z.style.position="absolute",Z.style.bottom="20px",Z.style.padding="12px 6px",Z.style.border="1px solid #fff",Z.style.borderRadius="4px",Z.style.background="rgba(0,0,0,0.1)",Z.style.color="#fff",Z.style.font="normal 13px sans-serif",Z.style.textAlign="center",Z.style.opacity="0.5",Z.style.outline="none",Z.style.zIndex="999"}if("xr"in navigator)return b.id="ARButton",b.style.display="none",$(b),navigator.xr.isSessionSupported("immersive-ar").then(function(Z){Z?function(){if(d.domOverlay===void 0){const fe=document.createElement("div");fe.style.display="none",document.body.appendChild(fe);const me=document.createElementNS("http://www.w3.org/2000/svg","svg");me.setAttribute("width",38),me.setAttribute("height",38),me.style.position="absolute",me.style.right="20px",me.style.top="20px",me.addEventListener("click",function(){re.end()}),fe.appendChild(me);const Ee=document.createElementNS("http://www.w3.org/2000/svg","path");Ee.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),Ee.setAttribute("stroke","#fff"),Ee.setAttribute("stroke-width",2),me.appendChild(Ee),d.optionalFeatures===void 0&&(d.optionalFeatures=[]),d.optionalFeatures.push("dom-overlay"),d.domOverlay={root:fe}}let re=null;async function le(fe){fe.addEventListener("end",he),h.xr.setReferenceSpaceType("local"),await h.xr.setSession(fe),b.textContent="STOP AR",d.domOverlay.root.style.display="",re=fe}function he(){re.removeEventListener("end",he),b.textContent="START AR",d.domOverlay.root.style.display="none",re=null}b.style.display="",b.style.cursor="pointer",b.style.left="calc(50% - 50px)",b.style.width="100px",b.textContent="START AR",b.onmouseenter=function(){b.style.opacity="1.0"},b.onmouseleave=function(){b.style.opacity="0.5"},b.onclick=function(){re===null?navigator.xr.requestSession("immersive-ar",d).then(le):re.end()}}():(X(),b.textContent="AR NOT SUPPORTED")}).catch(function(Z){X(),console.warn("Exception when trying to call xr.isSessionSupported",Z),b.textContent="AR NOT ALLOWED"}),b;{const Z=document.createElement("a");return window.isSecureContext===!1?(Z.href=document.location.href.replace(/^http:/,"https:"),Z.innerHTML="WEBXR NEEDS HTTPS"):(Z.href="https://immersiveweb.dev/",Z.innerHTML="WEBXR NOT AVAILABLE"),Z.style.left="calc(50% - 90px)",Z.style.width="180px",Z.style.textDecoration="none",$(Z),Z}}}.createButton(e.renderer.rendererObject,{requiredFeatures:["hit-test"],optionalFeatures:["dom-overlay"],domOverlay:a})),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.addEventListener("preFrame",this._preFrame)}_updateShadow(){if(!this._viewer)return;const e=this._viewer.scene.modelRoot,i=this._viewer.getPluginByType("Ground");i&&(i.groundReflection=!1,i.mesh.modelObject.position.copy(this._preXRState.groundOffset).multiplyScalar(e.modelObject.scale.x).sub(e.modelObject.position).negate(),i.mesh.modelObject.scale.setScalar(e.modelObject.scale.x*this._preXRState.groundScale))}moveToFloor(e){if(!this._dirty||!this._hitTestSource||!this._xrManager)return;const i=e.getHitTestResults(this._hitTestSource);if(!i.length)return;const s=i[0],a=this._touchInputHelper.getHitPoint(s);a&&(this._placementBox.show=!0,this._viewer.scene.modelRoot,this.placeOnWall?this._touchInputHelper.goalPosition.copy(a):this._touchInputHelper.goalPosition.y=a.y,this._hitTestSource.cancel(),this._hitTestSource=void 0,console.log("move to initial hit point",a))}_removePlacementBox(){this._placementBox&&(this._placementBox.dispose(),this._placementBox=void 0)}_preSetupModel(){var e;const i=this._viewer.scene.modelRoot,s=this._viewer.scene.activeCamera,a=(e=this._xrManager)===null||e===void 0?void 0:e.getCamera(),h=a.cameras[0]||a;this._removePlacementBox();const d=this._viewer.scene.getBounds(!0,!0);d.getSize(new _.Pa4).length()>.01&&(this._placementBox=new XS(d,a,this.placeOnWall),i.add(this._placementBox),this._placementBox.show=!1);const b=a.getWorldDirection(new _.Pa4);i.rotation.y=Math.atan2(-b.x,-b.z)-0,s.cameraObject.zoom=h.zoom,s.cameraObject.near=h.near,s.cameraObject.far=h.far,s.cameraObject.isPerspectiveCamera?(s.cameraObject.fov=h.fov,s.cameraObject.aspect=h.viewport.width/h.viewport.height):console.warn("Perspective camera required."),s.cameraObject.updateProjectionMatrix(),i.position.set(0,0,0);const X=i.userData.arScale||1;i.scale.set(X,X,X),i.position.copy(a.position).add(b.multiplyScalar(5)),i.visible=!0,this._viewer.setBackground(null)}_restorePreXRState(){if(!this._viewer)return;this._viewer.setBackground(this._preXRState.viewerBg),this._preXRState.viewerBg=null;const e=this._viewer.scene.modelRoot;e.scale.copy(this._preXRState.modelScale),e.position.copy(this._preXRState.modelPosition),e.quaternion.copy(this._preXRState.modelRotation),e.updateMatrix(),e.updateMatrixWorld(!0),e.visible=!0;const i=this._viewer.scene.activeCamera;i.position.copy(this._preXRState.cameraPosition),i.target.copy(this._preXRState.cameraTarget),i.cameraObject.up.copy(this._preXRState.cameraUp),i.cameraObject.near=this._preXRState.cameraNear,i.cameraObject.far=this._preXRState.cameraFar,i.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov!==void 0&&(i.cameraObject.fov=this._preXRState.cameraFov),this._preXRState.cameraAspect!==void 0&&(i.cameraObject.aspect=this._preXRState.cameraAspect)),i.positionUpdated(!1),i.targetUpdated(!0),i.cameraObject.updateMatrixWorld(!0),i.cameraObject.updateProjectionMatrix()}_cancelHitSources(){this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0),this._touchInputHelper.cancel()}}KS.PluginType="WEBXR_ARPlugin";const Qb=new Le({vertexShader:ae.vertexShader,fragmentShader:`
    uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			// gl_FragColor = vec4(1,0,1,1);
			gl_FragColor = texel;

		}
		`,uniforms:ae.uniforms});async function JS(c,e){if(c.createWriter){const s=await c.createWriter();return await s.write(0,e),void await s.close()}const i=await c.createWritable();await i.write(e),await i.close()}async function yI(c,e){const i={};return e&&(i.writable=!0,i.mode="readwrite"),await c.queryPermission(i)==="granted"||await c.requestPermission(i)==="granted"}Qb.renderToScreen=!1,Qb.useExistingRenderTarget=!0,Qb.clear=!1;class $0 extends oe{constructor(e,i){super(),this._state="stopped",this._console=console,this._currentRecording=[],this._currentImages=[],this.stepMode=!1,this._resumeSyncTime=0,this._frameCount=0,this._onstop=a=>{var h;if(this._state="stopped",this._recorder&&this._currentRecording.length>0){const d=new Blob(this._currentRecording,{type:this._options.mimeType});(h=this._recordingCallback)===null||h===void 0||h.call(this,d)}else this._currentImages.length>0&&(this._writeImages([...this._currentImages]),this._currentImages=[]);this._recorder=void 0,this.dispatchEvent({type:"stop"})},this._onstart=a=>{var h;this._state="recording",this._frameCount=0,this.dispatchEvent({type:"start"}),this.stepMode&&((h=this._recorder)===null||h===void 0||h.pause())},this._onresume=a=>{if(!this.stepMode)return;const h=()=>{var b;this._state==="recording"&&((b=this._recorder)===null||b===void 0||b.pause())},d=Math.min(this._resumeSyncTime-ia(),0)+1e3/this._options.frameRate;d>0?eo(d).then(h):h()},this._onpause=a=>{},this._ondataavailable=a=>{a.data&&a.data.size>0&&this._currentRecording.push(a.data)},this._onerror=a=>{this._state="error",this._console.error(a),this.dispatchEvent({type:"error",error:a}),this._recorder=void 0},this._canvas=e;const s=i==null?void 0:i.mimeType;this._options={mimeType:s||"auto",frameRate:30},this._setOptions(i||this._options)}_setOptions(e){var i,s;Object.assign(this._options,e),this._options.mimeType&&this._options.mimeType!=="auto"||(this._options.mimeType=(i=$0.GetSupportedMimeTypes([],["h264"],!0))!==null&&i!==void 0?i:$0.GetSupportedMimeTypes(void 0,void 0,!0)),this._options.mimeType&&!(!((s=this._options.mimeType)===null||s===void 0)&&s.startsWith("video/"))||window.MediaRecorder||(this._console.warn("MediaRecorder is not supported, switching to png"),this._options.mimeType="image/png"),this._options.mimeType||console.warn(new Error("No supported mimetype found"))}setOptions(e){this._setOptions(e)}isRecording(){return this._state==="recording"}start(){var e,i,s;if(this._state==="recording")return void this._console.log("Already recording canvas");if(this._state==="error"&&(this._recorder=void 0,this._console.warn("Resetting from error state.")),this._recorder)return this._state==="paused"?(this.dispatchEvent({type:"starting"}),void this._recorder.resume()):void this._console.warn("Canvas recorder unknown state",this._state);if(this._state==="paused")return this.dispatchEvent({type:"starting"}),void(this._state="recording");const a={mimeType:this._options.mimeType,videoBitsPerSecond:this._options.videoBitsPerSecond};if(this._currentRecording=[],this._currentImages=[],this._frameCount=0,(e=a.mimeType)===null||e===void 0?void 0:e.startsWith("video")){if(!window.MediaRecorder)return this._console.error("MediaRecorder not supported, use image sequence"),void(this._state="error");{const h=this._canvas.captureStream(this.stepMode?0:this._options.frameRate),d=(i=h.getVideoTracks())===null||i===void 0?void 0:i[0];this._track=d,this._recorder=new window.MediaRecorder(h,a),this._recorder.onstop=this._onstop,this._recorder.ondataavailable=this._ondataavailable,this._recorder.onerror=this._onerror,this._recorder.onresume=this._onresume,this._recorder.onstart=this._onstart}}this.dispatchEvent({type:"starting"}),this._recorder?(this._state="recording",(s=this._recorder)===null||s===void 0||s.start()):window&&window.showDirectoryPicker&&window.showDirectoryPicker().then(async h=>{const d=await(h==null?void 0:h.getDirectoryHandle("i-"+Math.floor(Date.now()),{create:!0}));this._imgDirectory=d,this._state="recording",this._onstart({})}).catch(h=>{this._onerror({detail:h})})}async requestFrame(){if(this._state!=="recording")return;this._frameCount++;const e=this._options.mimeType;if(!this._recorder&&e.startsWith("image/")){const i=this._canvas.toDataURL(e,90);this._currentImages.push(["frame_"+String(this._frameCount).padStart(5,"0")+(e.includes("png")?".png":".jpg"),i]),this._currentImages.length>60&&(this._writeImages([...this._currentImages]),this._currentImages=[])}this._recorder&&this._track&&this.stepMode&&(this._resumeSyncTime=ia(),this._track.requestFrame(),this._recorder.resume())}pause(){this._state!=="paused"&&this._state!=="stopped"&&(this._recorder?this._recorder.pause():this._state="paused")}stop(e){this._state!=="stopped"&&(this._state!=="error"?(this._recordingCallback=e,this.dispatchEvent({type:"stopping"}),this._recorder?this._recorder.stop():this._onstop({})):this._console.error("Recorder in error state, cannot stop, call start again."))}get state(){return this._state}dispose(){this._recorder&&this._state!=="error"?this.stop(e=>{this._console.warn("disposed with blob",e),this.dispose()}):this._recorder=void 0}async _writeImages(e){if(!this._imgDirectory)return;const i=await Promise.all(e.map(async([a,h])=>await(await fetch(h)).blob())),s=[];for(let a=0;a<e.length;a++){const h=await this._imgDirectory.getFileHandle(e[a][0],{create:!0});s.push(JS(h,i[a]))}await Promise.all(s)}static GetSupportedMimeTypes(e,i,s=!1){if(!window.MediaRecorder)return s?void 0:[];const a=["webm","ogg","mp4","x-matroska"].filter(b=>!e||e.length<1||e.includes(b)),h=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h.265","h264","h.264","opus"].filter(b=>!i||i.length<1||i.includes(b)),d=[];return a.forEach(b=>{const X=`video/${b}`;h.forEach($=>{[`${X};codecs=${$}`,`${X};codecs:${$}`,`${X};codecs=${$.toUpperCase()}`,`${X};codecs:${$.toUpperCase()}`,`${X}`].forEach(Z=>{MediaRecorder.isTypeSupported(Z)&&d.push(Z)})})}),s?d.length>0?d[0]:void 0:d}}var e1=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class Nh extends Xi{constructor(){super(...arguments),this.enabled=!0,this.convergeMode=!1,this.mimeType="auto",this.videoFrameRate=30,this._renderToScreenDisabled=!1,this._preRender=()=>{var e,i,s;if(this.convergeMode&&(!((e=this._recorder)===null||e===void 0)&&e.isRecording())){const a=this._viewer.renderer.composer.renderToScreen;this._viewer.renderer.composer.renderToScreen=((s=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("Progressive"))===null||s===void 0?void 0:s.isConverged())||!1,a&&!this._viewer.renderer.composer.renderToScreen&&(this._renderToScreenDisabled=!0)}},this._postRender=()=>{var e,i,s;if(!((e=this._recorder)===null||e===void 0)&&e.isRecording()&&(!this.convergeMode||!((s=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("Progressive"))===null||s===void 0)&&s.isConverged(!0))){const a=()=>{var h;return(h=this._recorder)===null||h===void 0?void 0:h.requestFrame()};this.convergeMode?eo(1).then(a):a()}this._renderToScreenDisabled&&(this._viewer.renderer.composer.renderToScreen=!0)},this._refreshUi=()=>{var e,i;(i=(e=this._uiConfig)===null||e===void 0?void 0:e.children)===null||i===void 0||i.map(s=>st(s)).flat(2).forEach(s=>{var a;return(a=s==null?void 0:s.uiRefresh)===null||a===void 0?void 0:a.call(s)})}}get recorder(){return this._recorder}isRecording(){var e,i;return(i=(e=this._recorder)===null||e===void 0?void 0:e.isRecording())!==null&&i!==void 0&&i}refreshRecorderOptions(){this._recorder&&(this._recorder.setOptions({frameRate:this.videoFrameRate,mimeType:this.mimeType}),this._recorder.stepMode=this.convergeMode)}async onAdded(e){await super.onAdded(e),this._recorder=new $0(e.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.scene.addEventListener("addSceneObject",this._refreshUi),this._recorder.addEventListener("starting",()=>this._stateChange(!1)),this._recorder.addEventListener("start",()=>{this.dispatchEvent({type:"start"}),this._stateChange(!this.convergeMode)}),this._recorder.addEventListener("error",()=>{this.dispatchEvent({type:"error"})}),this._recorder.addEventListener("pause",()=>this._stateChange(!1)),this._recorder.addEventListener("resume",()=>this._stateChange(!this.convergeMode)),this._recorder.addEventListener("stop",()=>{this.dispatchEvent({type:"stop"}),this._stateChange(!1)})}_stateChange(e){var i,s,a;this.dirty=e,(i=this._viewer)===null||i===void 0||i.setDirty(),(a=(s=this._uiConfig)===null||s===void 0?void 0:s.children)===null||a===void 0||a.map(h=>st(h)).flat(2).forEach(h=>{var d;return(d=h==null?void 0:h.uiRefresh)===null||d===void 0?void 0:d.call(h)})}async onRemove(e){var i;return e.removeEventListener("preRender",this._preRender),e.removeEventListener("preRender",this._postRender),e.scene.removeEventListener("addSceneObject",this._refreshUi),(i=this._recorder)===null||i===void 0||i.dispose(),super.onRemove(e)}startRecording(){var e;return!!this.enabled&&((e=this.recorder)===null||e===void 0?void 0:e.isRecording())===!1&&(this.recorder.stepMode=this.convergeMode,this.recorder.start(),!0)}async stopRecording(){var e;if(!((e=this.recorder)===null||e===void 0)&&e.isRecording())return new Promise((i,s)=>{var a;return(a=this.recorder)===null||a===void 0?void 0:a.stop(i)})}get uiConfig(){if(this._uiConfig)return this._uiConfig;const e=this;return this._uiConfig={type:"folder",label:"Video Export",children:[{type:"slider",label:"Frame Rate",bounds:[1,60],stepSize:1,property:[this,"videoFrameRate"]},{type:"checkbox",limitedUi:!0,property:[this,"convergeMode"]},{type:"dropdown",label:"Mime type",limitedUi:!0,property:[this,"mimeType"],children:[["Auto Video (x264)","auto"],["PNG sequence","image/png"],["JPEG sequence","image/jpeg"]].map(i=>({label:i[0],value:i[1]}))},{type:"input",disabled:!0,label:"State",limitedUi:!0,get value(){var i,s;return(s=(i=e.recorder)===null||i===void 0?void 0:i.state)!==null&&s!==void 0?s:"not initialized"},set value(i){}},{type:"button",get label(){var i;return!((i=e.recorder)===null||i===void 0)&&i.isRecording()?"Stop Recording":"Start Recording"},value:()=>{var i;!((i=e.recorder)===null||i===void 0)&&i.isRecording()?this.stopRecording().then(s=>{if(s){console.log(s);const a=s.type.split(";")[0].split("/").pop()||"mp4";ts(s,"test."+a)}}):this.startRecording()}},{type:"button",limitedUi:!0,label:"Record Camera Views",hidden:()=>{var i,s;return!!(!((i=e.recorder)===null||i===void 0)&&i.isRecording())||!(!((s=this._viewer)===null||s===void 0)&&s.getPluginByType("CameraViews"))},value:()=>{var i,s;(s=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("CameraViews"))===null||s===void 0||s.recordAllViews()}},{type:"button",limitedUi:!0,label:"Record Camera Views + GLTF Anim",hidden:()=>{var i,s,a,h;return!!(!((i=e.recorder)===null||i===void 0)&&i.isRecording())||!(!((s=this._viewer)===null||s===void 0)&&s.getPluginByType("CameraViews"))||!(!((h=(a=this._viewer)===null||a===void 0?void 0:a.getPluginByType("GLTFAnimation"))===null||h===void 0)&&h.animations.length)},value:()=>{var i,s,a,h;const d=((s=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("GLTFAnimation"))===null||s===void 0?void 0:s.animationState)==="playing";(h=(a=this._viewer)===null||a===void 0?void 0:a.getPluginByType("CameraViews"))===null||h===void 0||h.recordAllViews(()=>{var b,X;(X=(b=this._viewer)===null||b===void 0?void 0:b.getPluginByType("GLTFAnimation"))===null||X===void 0||X.playAnimation()}).then(()=>{var b,X;d||(X=(b=this._viewer)===null||b===void 0?void 0:b.getPluginByType("GLTFAnimation"))===null||X===void 0||X.stopAnimation()})}},{type:"button",limitedUi:!0,label:"Record GLTF Anim",hidden:()=>{var i,s,a;return!!(!((i=e.recorder)===null||i===void 0)&&i.isRecording())||!(!((a=(s=this._viewer)===null||s===void 0?void 0:s.getPluginByType("GLTFAnimation"))===null||a===void 0)&&a.animations.length)},value:async()=>{var i,s;if(!((i=e.recorder)===null||i===void 0)&&i.isRecording())return;const a=(s=this._viewer)===null||s===void 0?void 0:s.getPluginByType("GLTFAnimation");if(!a||!this.startRecording())return;let h=!1;a.loopAnimations&&(h=!0),h&&(a.loopAnimations=!1),await a.playAnimation();const d=await this.stopRecording();if(h&&(a.loopAnimations=!0),d){const b=d.type.split(";")[0].split("/").pop()||"mp4";ts(d,"test."+b)}}}]}}}Nh.PluginType="CanvasRecorder",e1([lt(Nh.prototype.refreshRecorderOptions),kt()],Nh.prototype,"convergeMode",void 0),e1([lt(Nh.prototype.refreshRecorderOptions),kt()],Nh.prototype,"mimeType",void 0),e1([lt(Nh.prototype.refreshRecorderOptions),kt()],Nh.prototype,"videoFrameRate",void 0);var Hb=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};const t1=new _.jyz({uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`});t1.depthTest=!1;const n1=new _.jyz({uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`});n1.depthTest=!1;class Uh extends Wo{constructor(e={},i=!1){super(e),this.contactShadows=!0,this.blurAmount=1,this.shadowScale=1,this.shadowHeight=5,this.shadowCamera=new _.iKG(-1,1,1,-1,.001,this.shadowHeight),this._refreshShadowCameraFrustum=this._refreshShadowCameraFrustum.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._showDebug=i,i&&this.dependencies.push(Ma)}async onAdded(e){const i=e.renderer.createTarget({type:_.ywz,format:_.wk1,encoding:_.rnI,size:{width:512,height:512},generateMipmaps:!1,depthBuffer:!0,minFilter:_.wem,magFilter:_.wem});i.texture.name="groundContactDepthTexture";const s=new _.lRF({depthPacking:_.z81});s.onBeforeCompile=function(h){h.uniforms.opacity.value=1,h.fragmentShader=`
						${h.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), 1.0 );")}
					`};const a=new Nv(i,s,new _.Ilk(0,0,0),0);this._depthPass=a,await super.onAdded(e)}_postFrame(){super._postFrame(),this._viewer}_preRender(){if(super._preRender(),!this._viewer||!this._depthPass)return;this._depthPass.scene=this._viewer.scene.modelObject,this._depthPass.camera=this.shadowCamera,this._depthPass.render(this._viewer.renderer.rendererObject);const e=this._viewer.renderer.getTempTarget({type:_.ywz,format:_.wk1,encoding:_.rnI,size:{width:1024,height:1024},generateMipmaps:!1,depthBuffer:!1,minFilter:_.wem,magFilter:_.wem});this._blurShadow(e),this._blurShadow(e,.4),this._viewer.renderer.releaseTempTarget(e)}_blurShadow(e,i=1){this._viewer&&this._depthPass&&(t1.uniforms.h.value=i*this.blurAmount/256,n1.uniforms.v.value=i*this.blurAmount/256,this._viewer.renderer.blit(this._depthPass.target.texture,e,{material:t1,clear:!0}),this._viewer.renderer.blit(e.texture,this._depthPass.target,{material:n1,clear:!0}))}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_refreshTransform(){super._refreshTransform(),this._mesh&&this._viewer&&(this.shadowCamera.position.copy(this._mesh.getWorldPosition(new _.Pa4)),this.shadowCamera.setRotationFromEuler(new _.USm(Math.PI/2,0,0)),this.shadowCamera.updateMatrixWorld(),this._refreshShadowCameraFrustum(),this._mesh.scale.y=-this.size)}_refreshShadowCameraFrustum(){this.shadowCamera&&(this.shadowCamera.left=-this.size/(2*this.shadowScale),this.shadowCamera.right=this.size/(2*this.shadowScale),this.shadowCamera.top=this.size/(2*this.shadowScale),this.shadowCamera.bottom=-this.size/(2*this.shadowScale),this.shadowCamera.far=this.shadowHeight,this.shadowCamera.updateProjectionMatrix(),this._setDirty())}_setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}_removeMaterial(){this._material&&super._removeMaterial()}refreshOptions(){this._viewer&&super.refreshOptions()}_refreshMaterial(){var e;if(!this._viewer)return!1;const i=super._refreshMaterial();return this._material&&(this._material.alphaMap=((e=this._depthPass)===null||e===void 0?void 0:e.target.texture)||null,i&&(this._material.roughness=1,this._material.metalness=0,this._material.color.set(1118481),this._material.transparent=!0,this._material.materialObject.userData.ssreflDisabled=!0,this._material.materialObject.userData.ssreflNonPhysical=!1)),i}_extraUiConfig(){return[{label:"Contact Shadows",type:"checkbox",property:[this,"contactShadows"]},{label:"Shadow Scale",type:"slider",bounds:[0,2],property:[this,"shadowScale"]},{label:"Shadow Height",type:"slider",bounds:[0,20],property:[this,"shadowHeight"]},{label:"Blur Amount",type:"slider",bounds:[0,10],property:[this,"blurAmount"]},...super._extraUiConfig()]}}Uh.PluginType="ContactShadowGroundPlugin",Hb([lt(Uh.prototype.refreshOptions),kt()],Uh.prototype,"contactShadows",void 0),Hb([kt(),lt(Uh.prototype._setDirty)],Uh.prototype,"blurAmount",void 0),Hb([kt(),lt(Uh.prototype._refreshShadowCameraFrustum)],Uh.prototype,"shadowScale",void 0),Hb([kt(),lt(Uh.prototype._refreshShadowCameraFrustum)],Uh.prototype,"shadowHeight",void 0);const Y_=new _.cPb(45,1,.1,1e3);function i1(c,e,i,s=7,a=new _.Pa4(0,0,1.5)){i=i??c.scene.modelObject;const h=new nn().expandByObject(i??e,!0,!0),d=h.getCenter(new _.Pa4),b=h.getSize(new _.Pa4);Y_.position.copy(d).add(a.clone().multiplyScalar(Math.max(b.x,b.y,b.z))),Y_.lookAt(d),e&&e.traverseVisible(Z=>{Z.layers.enable(s)}),s>0?Y_.layers.set(s):Y_.layers.enableAll();const X=e==null?void 0:e.visible;e&&(e.visible=!0),c.renderer.rendererObject.setRenderTarget(null),c.renderer.rendererObject.render(i,Y_);const $=c.renderer.rendererObject.domElement.toDataURL("image/png");return e&&(e.visible=X,e.traverseVisible(Z=>{Z.layers.disable(s)}),Y_.layers.enableAll()),c.setDirty(),$}class r1{constructor(e){this.viewer=e,this._lights=[],this.shapes={sphere:new _.Kj0(new _.xo$(1)),cube:new _.Kj0(new _.DvJ(1,1,1)),cylinder:new _.Kj0(new _.fHI(.5,.5,1))};const i=new _.xsS;this._channel=7;const s=new _.vmT(16777215,4473924,1);s.position.set(0,10,0),s.layers.set(this._channel),i.add(s),this._lights.push(s),this._scene=i}dispose(){[...this._lights].forEach(e=>e.dispose()),Object.values(this.shapes).forEach(e=>{e.geometry&&e.geometry.dispose()})}generate(e,i="sphere"){const s=this.shapes[i]||new _.Kj0(new _.xo$(1));s.material=e.materialObject,s.geometry.attributes.tangent||s.geometry.computeTangents(),this._scene.add(s),this._scene.environment=this.viewer.scene.getEnvironment();const a=s.material.envMapIntensity;typeof a=="number"&&(s.material.envMapIntensity=Math.max(a,2));const h=i1(this.viewer,s,this._scene,this._channel,new _.Pa4(0,0,1.5));return typeof a=="number"&&(s.material.envMapIntensity=a),this._scene.remove(s),s.material=void 0,h}}class Wb extends Xi{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{var e,i;this.enabled&&((i=(e=this.uiConfig).uiRefresh)===null||i===void 0||i.call(e))},this.dependencies=[Kn],this.variations=[],this._selectedMaterial=()=>{var e,i;return((i=(e=this._picking)===null||e===void 0?void 0:e.getSelectedObject())===null||i===void 0?void 0:i.material)||void 0},this.uiConfig={label:"Material Configurator",type:"folder",children:[()=>{var e;return[{type:"input",label:"uuid",property:[this._selectedMaterial(),"uuid"],hidden:()=>!this._selectedMaterial(),disabled:!0},{type:"input",label:"title",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"title"],onChange:async()=>this.refreshUi()},{type:"dropdown",label:"Preview Type",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"preview"],onChange:async()=>this.refreshUi(),children:["generate:sphere","generate:cube","color","map","emissive",...Object.keys(cu).filter(i=>i.endsWith("Map"))].map(i=>({label:i,value:i}))},...((e=this.getSelectedVariation())===null||e===void 0?void 0:e.materials.map(i=>i.uiConfig?Object.assign(i.uiConfig,{expanded:!1}):{}))||[],{type:"button",label:"Remove All",hidden:()=>!this._selectedMaterial(),value:async()=>{const i=this.getSelectedVariation();i&&await this._viewer.confirm("Material configurator: Remove all variations for this material?")&&(i.materials=[]),this.refreshUi()}},{type:"button",label:"Remove Variation",hidden:()=>!this._selectedMaterial(),value:async()=>{const i=this.getSelectedVariation();i&&await this._viewer.confirm("Material configurator: Remove this variation?")&&this.removeVariation(i)}},{type:"button",label:"Add Variation",hidden:()=>!this._selectedMaterial(),value:()=>this.addVariation(this._selectedMaterial())},{type:"button",label:"Refresh Ui",value:()=>this.refreshUi()}]}]}}async onAdded(e){var i,s;await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("Picking"),this._previewGenerator=new r1(this._viewer),(s=this._picking)===null||s===void 0||s.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}fromJSON(e,i){return this.variations=[],super.fromJSON(e,i)}async onRemove(e){var i,s;return(i=this._previewGenerator)===null||i===void 0||i.dispose(),this._previewGenerator=void 0,(s=this._picking)===null||s===void 0||s.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}findVariation(e){return e?this.variations.find(i=>i.uuid===e):void 0}getSelectedVariation(){var e,i;return this.findVariation((e=this._selectedMaterial())===null||e===void 0?void 0:e.uuid)||this.findVariation((i=this._selectedMaterial())===null||i===void 0?void 0:i.name)}applyVariation(e,i){var s,a;const h=e.materials.find(d=>d.uuid===i);if(h){const d=(a=(s=this._viewer)===null||s===void 0?void 0:s.getManager())===null||a===void 0?void 0:a.materials;let b=d==null?void 0:d.findMaterialsByName(e.uuid);(!b||b.length<1)&&(b=[d==null?void 0:d.findMaterial(e.uuid)]),b.forEach(X=>{if(!X)return;const $=X.name;X.copyProps(h),X.name=$})}}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return!(!this.enabled||!this._viewer||!this._uiNeedRefresh||(this._uiNeedRefresh=!1,this._refreshUiConfig(),0))}removeVariationForMaterial(e){let i=this.findVariation(e.uuid);!i&&e.name.length>0&&(i=this.findVariation(e.name)),i&&this.removeVariation(i)}removeVariation(e){e&&(this.variations.splice(this.variations.indexOf(e),1),this.refreshUi())}addVariation(e){var i;const s=(i=e==null?void 0:e.clone)===null||i===void 0?void 0:i.call(e);if(e&&s){let a=this.findVariation(e.uuid);!a&&e.name.length>0&&(a=this.findVariation(e.name)),a||this.variations.push(a={uuid:e.name.length>0?e.name:e.uuid,title:"Name",preview:"generate:sphere",materials:[]}),a.materials.push(s),this.refreshUi()}}}Wb.PluginType="MaterialConfiguratorBasePlugin",function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);h>3&&d&&Object.defineProperty(e,i,d)}([kt()],Wb.prototype,"variations",void 0);const $S=(c,e=!0)=>{const i=new oi().set(c);return e&&i.convertLinearToSRGB(),`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='16' height='16' fill='%23${i.getHexString()}'/%3E%3C/svg%3E%0A`},ZS=(c,e=!0)=>{const i=new oi().set(c);return e&&i.convertLinearToSRGB(),`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='8' cy='8' r='7' fill='%23${i.getHexString()}'/%3E%3C/svg%3E%0A`},Z0=c=>`data:image/svg+xml,%3Csvg viewBox='0 0 80 14' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext style='font: 8px "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace; fill: white;' x='9' y='9'%3E${c}%3C/text%3E%3C/svg%3E%0A`,s1=async(c,e)=>mo(await $h(c),e),eC=async(c,e)=>await s1(c,e).then(i=>i.toDataURL("image/png"));class Gu{static _initialize(){this._inited=!0,th(Qe`
  .customContextGrid {
    background: #28223C;
    //backdrop-filter: blur(8px);
    border: 0.5px solid rgba(220, 220, 220, 0.3);
    width: auto;
    height: auto;
    position: absolute;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    z-index: 200;
    padding: 0.35rem 0.35rem;
    border-radius: 0.375rem;
    min-width: 5rem;
    pointer-events: auto;
    box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);

    color: white;
    font-size: 0.65rem;
    font-family: Inter, "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
  }
  .customContextGridItems {
    background-color: transparent;
    cursor: pointer;
    border-radius: 0.25rem;
    line-height: 1rem;
    font-weight: 500;
    overflow: hidden;
    margin: 0.12rem;
  }
  .customContextGridItems:hover {
    color: white;
    background-color: #017AFF;
  }
  .customContextGridItemImage{
    width: 100%;
    height: 100%;
  }
  .customContextGridHeading{
    width: 100%;
    padding: 0.12rem;
    font-size: 0.85rem;
  }

        `)}static Create(e,i,s,a,h,d,b){var X;this._inited||this._initialize();const $=Mc(),Z=$?.15:.25,re=$?1.5:2.5,le=ma({classList:["customContextGrid"],addToBody:!1,innerHTML:`
            <div class="customContextGridHeading"> ${i} </div>
            `});le.style.top=h+"px",le.style.left=a+"px",le.style.gap=Z+"rem",le.style.width=(re+Z)*s-Z+"rem",le.dataset.tag=e;for(const he of d){const fe=ma({classList:["customContextGridItems"],addToBody:!1,innerHTML:`
            <img src="${he.image}" class="customContextGridItemImage">
            `});fe.style.width=re+"rem",fe.style.height=re+"rem",le.appendChild(fe),fe.onclick=()=>{var me;return(me=he.onClick)===null||me===void 0?void 0:me.call(he,he.id)},b(fe,he)}return(X=this.Elements)===null||X===void 0||X.push(le),le}static RemoveAll(e){if(e){const i=this.Elements.filter(s=>s.dataset.tag===e);for(const s of i)s.remove();this.Elements=this.Elements.filter(s=>s.dataset.tag!==e)}else{for(const i of this.Elements)i.remove();this.Elements=[]}}static RebuildUi(e){if(this.Elements.length===0)return;e||(e=document.body);for(const s of this.Elements)s.remove();let i=20;for(const s of this.Elements)s.style.top=i+"px",e.appendChild(s),i+=s.clientHeight+20}}function Qu(c){if(c==null)return window;if(c.toString()!=="[object Window]"){var e=c.ownerDocument;return e&&e.defaultView||window}return c}function X_(c){return c instanceof Qu(c).Element||c instanceof Element}function nu(c){return c instanceof Qu(c).HTMLElement||c instanceof HTMLElement}function o1(c){return typeof ShadowRoot<"u"&&(c instanceof Qu(c).ShadowRoot||c instanceof ShadowRoot)}Gu.Elements=[],Gu._inited=!1;var Zm=Math.max,qb=Math.min,K_=Math.round;function J_(c,e){e===void 0&&(e=!1);var i=c.getBoundingClientRect(),s=1,a=1;if(nu(c)&&e){var h=c.offsetHeight,d=c.offsetWidth;d>0&&(s=K_(i.width)/d||1),h>0&&(a=K_(i.height)/h||1)}return{width:i.width/s,height:i.height/a,top:i.top/a,right:i.right/s,bottom:i.bottom/a,left:i.left/s,x:i.left/s,y:i.top/a}}function a1(c){var e=Qu(c);return{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function Fh(c){return c?(c.nodeName||"").toLowerCase():null}function _f(c){return((X_(c)?c.ownerDocument:c.document)||window.document).documentElement}function l1(c){return J_(_f(c)).left+a1(c).scrollLeft}function sp(c){return Qu(c).getComputedStyle(c)}function c1(c){var e=sp(c),i=e.overflow,s=e.overflowX,a=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+a+s)}function bI(c,e,i){i===void 0&&(i=!1);var s,a,h=nu(e),d=nu(e)&&function(re){var le=re.getBoundingClientRect(),he=K_(le.width)/re.offsetWidth||1,fe=K_(le.height)/re.offsetHeight||1;return he!==1||fe!==1}(e),b=_f(e),X=J_(c,d),$={scrollLeft:0,scrollTop:0},Z={x:0,y:0};return(h||!h&&!i)&&((Fh(e)!=="body"||c1(b))&&($=(s=e)!==Qu(s)&&nu(s)?{scrollLeft:(a=s).scrollLeft,scrollTop:a.scrollTop}:a1(s)),nu(e)?((Z=J_(e,!0)).x+=e.clientLeft,Z.y+=e.clientTop):b&&(Z.x=l1(b))),{x:X.left+$.scrollLeft-Z.x,y:X.top+$.scrollTop-Z.y,width:X.width,height:X.height}}function u1(c){var e=J_(c),i=c.offsetWidth,s=c.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-s)<=1&&(s=e.height),{x:c.offsetLeft,y:c.offsetTop,width:i,height:s}}function Yb(c){return Fh(c)==="html"?c:c.assignedSlot||c.parentNode||(o1(c)?c.host:null)||_f(c)}function tC(c){return["html","body","#document"].indexOf(Fh(c))>=0?c.ownerDocument.body:nu(c)&&c1(c)?c:tC(Yb(c))}function eA(c,e){var i;e===void 0&&(e=[]);var s=tC(c),a=s===((i=c.ownerDocument)==null?void 0:i.body),h=Qu(s),d=a?[h].concat(h.visualViewport||[],c1(s)?s:[]):s,b=e.concat(d);return a?b:b.concat(eA(Yb(d)))}function wI(c){return["table","td","th"].indexOf(Fh(c))>=0}function nC(c){return nu(c)&&sp(c).position!=="fixed"?c.offsetParent:null}function tA(c){for(var e=Qu(c),i=nC(c);i&&wI(i)&&sp(i).position==="static";)i=nC(i);return i&&(Fh(i)==="html"||Fh(i)==="body"&&sp(i).position==="static")?e:i||function(s){var a=navigator.userAgent.toLowerCase().indexOf("firefox")!==-1;if(navigator.userAgent.indexOf("Trident")!==-1&&nu(s)&&sp(s).position==="fixed")return null;var h=Yb(s);for(o1(h)&&(h=h.host);nu(h)&&["html","body"].indexOf(Fh(h))<0;){var d=sp(h);if(d.transform!=="none"||d.perspective!=="none"||d.contain==="paint"||["transform","perspective"].indexOf(d.willChange)!==-1||a&&d.willChange==="filter"||a&&d.filter&&d.filter!=="none")return h;h=h.parentNode}return null}(c)||e}var ul="top",vc="bottom",Ac="right",hl="left",Xb="auto",$_=[ul,vc,Ac,hl],eg="start",Z_="end",iC="clippingParents",h1="viewport",ev="popper",rC="reference",d1=$_.reduce(function(c,e){return c.concat([e+"-"+eg,e+"-"+Z_])},[]),p1=[].concat($_,[Xb]).reduce(function(c,e){return c.concat([e,e+"-"+eg,e+"-"+Z_])},[]),sC="beforeRead",oC="read",aC="afterRead",lC="beforeMain",cC="main",uC="afterMain",hC="beforeWrite",dC="write",pC="afterWrite",fC=[sC,oC,aC,lC,cC,uC,hC,dC,pC];function xI(c){var e=new Map,i=new Set,s=[];function a(h){i.add(h.name),[].concat(h.requires||[],h.requiresIfExists||[]).forEach(function(d){if(!i.has(d)){var b=e.get(d);b&&a(b)}}),s.push(h)}return c.forEach(function(h){e.set(h.name,h)}),c.forEach(function(h){i.has(h.name)||a(h)}),s}var mC={placement:"bottom",modifiers:[],strategy:"absolute"};function gC(){for(var c=arguments.length,e=new Array(c),i=0;i<c;i++)e[i]=arguments[i];return!e.some(function(s){return!(s&&typeof s.getBoundingClientRect=="function")})}function Kb(c){c===void 0&&(c={});var e=c,i=e.defaultModifiers,s=i===void 0?[]:i,a=e.defaultOptions,h=a===void 0?mC:a;return function(d,b,X){X===void 0&&(X=h);var $,Z,re={placement:"bottom",orderedModifiers:[],options:Object.assign({},mC,h),modifiersData:{},elements:{reference:d,popper:b},attributes:{},styles:{}},le=[],he=!1,fe={state:re,setOptions:function(Ee){var Ae=typeof Ee=="function"?Ee(re.options):Ee;me(),re.options=Object.assign({},h,re.options,Ae),re.scrollParents={reference:X_(d)?eA(d):d.contextElement?eA(d.contextElement):[],popper:eA(b)};var ye,ge,Pe=function(Be){var Oe=xI(Be);return fC.reduce(function(Fe,Xe){return Fe.concat(Oe.filter(function(at){return at.phase===Xe}))},[])}((ye=[].concat(s,re.options.modifiers),ge=ye.reduce(function(Be,Oe){var Fe=Be[Oe.name];return Be[Oe.name]=Fe?Object.assign({},Fe,Oe,{options:Object.assign({},Fe.options,Oe.options),data:Object.assign({},Fe.data,Oe.data)}):Oe,Be},{}),Object.keys(ge).map(function(Be){return ge[Be]})));return re.orderedModifiers=Pe.filter(function(Be){return Be.enabled}),re.orderedModifiers.forEach(function(Be){var Oe=Be.name,Fe=Be.options,Xe=Fe===void 0?{}:Fe,at=Be.effect;if(typeof at=="function"){var mt=at({state:re,name:Oe,instance:fe,options:Xe});le.push(mt||function(){})}}),fe.update()},forceUpdate:function(){if(!he){var Ee=re.elements,Ae=Ee.reference,ye=Ee.popper;if(gC(Ae,ye)){re.rects={reference:bI(Ae,tA(ye),re.options.strategy==="fixed"),popper:u1(ye)},re.reset=!1,re.placement=re.options.placement,re.orderedModifiers.forEach(function(at){return re.modifiersData[at.name]=Object.assign({},at.data)});for(var ge=0;ge<re.orderedModifiers.length;ge++)if(re.reset!==!0){var Pe=re.orderedModifiers[ge],Be=Pe.fn,Oe=Pe.options,Fe=Oe===void 0?{}:Oe,Xe=Pe.name;typeof Be=="function"&&(re=Be({state:re,options:Fe,name:Xe,instance:fe})||re)}else re.reset=!1,ge=-1}}},update:($=function(){return new Promise(function(Ee){fe.forceUpdate(),Ee(re)})},function(){return Z||(Z=new Promise(function(Ee){Promise.resolve().then(function(){Z=void 0,Ee($())})})),Z}),destroy:function(){me(),he=!0}};if(!gC(d,b))return fe;function me(){le.forEach(function(Ee){return Ee()}),le=[]}return fe.setOptions(X).then(function(Ee){!he&&X.onFirstUpdate&&X.onFirstUpdate(Ee)}),fe}}var EI=Kb(),Jb={passive:!0},f1={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(c){var e=c.state,i=c.instance,s=c.options,a=s.scroll,h=a===void 0||a,d=s.resize,b=d===void 0||d,X=Qu(e.elements.popper),$=[].concat(e.scrollParents.reference,e.scrollParents.popper);return h&&$.forEach(function(Z){Z.addEventListener("scroll",i.update,Jb)}),b&&X.addEventListener("resize",i.update,Jb),function(){h&&$.forEach(function(Z){Z.removeEventListener("scroll",i.update,Jb)}),b&&X.removeEventListener("resize",i.update,Jb)}},data:{}};function jh(c){return c.split("-")[0]}function tv(c){return c.split("-")[1]}function m1(c){return["top","bottom"].indexOf(c)>=0?"x":"y"}function _C(c){var e,i=c.reference,s=c.element,a=c.placement,h=a?jh(a):null,d=a?tv(a):null,b=i.x+i.width/2-s.width/2,X=i.y+i.height/2-s.height/2;switch(h){case ul:e={x:b,y:i.y-s.height};break;case vc:e={x:b,y:i.y+i.height};break;case Ac:e={x:i.x+i.width,y:X};break;case hl:e={x:i.x-s.width,y:X};break;default:e={x:i.x,y:i.y}}var $=h?m1(h):null;if($!=null){var Z=$==="y"?"height":"width";switch(d){case eg:e[$]=e[$]-(i[Z]/2-s[Z]/2);break;case Z_:e[$]=e[$]+(i[Z]/2-s[Z]/2)}}return e}var g1={name:"popperOffsets",enabled:!0,phase:"read",fn:function(c){var e=c.state,i=c.name;e.modifiersData[i]=_C({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})},data:{}},SI={top:"auto",right:"auto",bottom:"auto",left:"auto"};function vC(c){var e,i=c.popper,s=c.popperRect,a=c.placement,h=c.variation,d=c.offsets,b=c.position,X=c.gpuAcceleration,$=c.adaptive,Z=c.roundOffsets,re=c.isFixed,le=d.x,he=le===void 0?0:le,fe=d.y,me=fe===void 0?0:fe,Ee=typeof Z=="function"?Z({x:he,y:me}):{x:he,y:me};he=Ee.x,me=Ee.y;var Ae=d.hasOwnProperty("x"),ye=d.hasOwnProperty("y"),ge=hl,Pe=ul,Be=window;if($){var Oe=tA(i),Fe="clientHeight",Xe="clientWidth";Oe===Qu(i)&&sp(Oe=_f(i)).position!=="static"&&b==="absolute"&&(Fe="scrollHeight",Xe="scrollWidth"),(a===ul||(a===hl||a===Ac)&&h===Z_)&&(Pe=vc,me-=(re&&Oe===Be&&Be.visualViewport?Be.visualViewport.height:Oe[Fe])-s.height,me*=X?1:-1),a!==hl&&(a!==ul&&a!==vc||h!==Z_)||(ge=Ac,he-=(re&&Oe===Be&&Be.visualViewport?Be.visualViewport.width:Oe[Xe])-s.width,he*=X?1:-1)}var at,mt=Object.assign({position:b},$&&SI),wt=Z===!0?function(At){var Tt=At.x,yt=At.y,St=window.devicePixelRatio||1;return{x:K_(Tt*St)/St||0,y:K_(yt*St)/St||0}}({x:he,y:me}):{x:he,y:me};return he=wt.x,me=wt.y,X?Object.assign({},mt,((at={})[Pe]=ye?"0":"",at[ge]=Ae?"0":"",at.transform=(Be.devicePixelRatio||1)<=1?"translate("+he+"px, "+me+"px)":"translate3d("+he+"px, "+me+"px, 0)",at)):Object.assign({},mt,((e={})[Pe]=ye?me+"px":"",e[ge]=Ae?he+"px":"",e.transform="",e))}var _1={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(c){var e=c.state,i=c.options,s=i.gpuAcceleration,a=s===void 0||s,h=i.adaptive,d=h===void 0||h,b=i.roundOffsets,X=b===void 0||b,$={placement:jh(e.placement),variation:tv(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:a,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,vC(Object.assign({},$,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:d,roundOffsets:X})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,vC(Object.assign({},$,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:X})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})},data:{}},$b={name:"applyStyles",enabled:!0,phase:"write",fn:function(c){var e=c.state;Object.keys(e.elements).forEach(function(i){var s=e.styles[i]||{},a=e.attributes[i]||{},h=e.elements[i];nu(h)&&Fh(h)&&(Object.assign(h.style,s),Object.keys(a).forEach(function(d){var b=a[d];b===!1?h.removeAttribute(d):h.setAttribute(d,b===!0?"":b)}))})},effect:function(c){var e=c.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(s){var a=e.elements[s],h=e.attributes[s]||{},d=Object.keys(e.styles.hasOwnProperty(s)?e.styles[s]:i[s]).reduce(function(b,X){return b[X]="",b},{});nu(a)&&Fh(a)&&(Object.assign(a.style,d),Object.keys(h).forEach(function(b){a.removeAttribute(b)}))})}},requires:["computeStyles"]},AC={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(c){var e=c.state,i=c.options,s=c.name,a=i.offset,h=a===void 0?[0,0]:a,d=p1.reduce(function(Z,re){return Z[re]=function(le,he,fe){var me=jh(le),Ee=[hl,ul].indexOf(me)>=0?-1:1,Ae=typeof fe=="function"?fe(Object.assign({},he,{placement:le})):fe,ye=Ae[0],ge=Ae[1];return ye=ye||0,ge=(ge||0)*Ee,[hl,Ac].indexOf(me)>=0?{x:ge,y:ye}:{x:ye,y:ge}}(re,e.rects,h),Z},{}),b=d[e.placement],X=b.x,$=b.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=X,e.modifiersData.popperOffsets.y+=$),e.modifiersData[s]=d}},CI={left:"right",right:"left",bottom:"top",top:"bottom"};function Zb(c){return c.replace(/left|right|bottom|top/g,function(e){return CI[e]})}var MI={start:"end",end:"start"};function yC(c){return c.replace(/start|end/g,function(e){return MI[e]})}function bC(c,e){var i=e.getRootNode&&e.getRootNode();if(c.contains(e))return!0;if(i&&o1(i)){var s=e;do{if(s&&c.isSameNode(s))return!0;s=s.parentNode||s.host}while(s)}return!1}function v1(c){return Object.assign({},c,{left:c.x,top:c.y,right:c.x+c.width,bottom:c.y+c.height})}function wC(c,e){return e===h1?v1(function(i){var s=Qu(i),a=_f(i),h=s.visualViewport,d=a.clientWidth,b=a.clientHeight,X=0,$=0;return h&&(d=h.width,b=h.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(X=h.offsetLeft,$=h.offsetTop)),{width:d,height:b,x:X+l1(i),y:$}}(c)):X_(e)?function(i){var s=J_(i);return s.top=s.top+i.clientTop,s.left=s.left+i.clientLeft,s.bottom=s.top+i.clientHeight,s.right=s.left+i.clientWidth,s.width=i.clientWidth,s.height=i.clientHeight,s.x=s.left,s.y=s.top,s}(e):v1(function(i){var s,a=_f(i),h=a1(i),d=(s=i.ownerDocument)==null?void 0:s.body,b=Zm(a.scrollWidth,a.clientWidth,d?d.scrollWidth:0,d?d.clientWidth:0),X=Zm(a.scrollHeight,a.clientHeight,d?d.scrollHeight:0,d?d.clientHeight:0),$=-h.scrollLeft+l1(i),Z=-h.scrollTop;return sp(d||a).direction==="rtl"&&($+=Zm(a.clientWidth,d?d.clientWidth:0)-b),{width:b,height:X,x:$,y:Z}}(_f(c)))}function xC(c){return Object.assign({},{top:0,right:0,bottom:0,left:0},c)}function EC(c,e){return e.reduce(function(i,s){return i[s]=c,i},{})}function nv(c,e){e===void 0&&(e={});var i=e,s=i.placement,a=s===void 0?c.placement:s,h=i.boundary,d=h===void 0?iC:h,b=i.rootBoundary,X=b===void 0?h1:b,$=i.elementContext,Z=$===void 0?ev:$,re=i.altBoundary,le=re!==void 0&&re,he=i.padding,fe=he===void 0?0:he,me=xC(typeof fe!="number"?fe:EC(fe,$_)),Ee=Z===ev?rC:ev,Ae=c.rects.popper,ye=c.elements[le?Ee:Z],ge=function(wt,At,Tt){var yt=At==="clippingParents"?function(Gt){var rn=eA(Yb(Gt)),gn=["absolute","fixed"].indexOf(sp(Gt).position)>=0&&nu(Gt)?tA(Gt):Gt;return X_(gn)?rn.filter(function(Kt){return X_(Kt)&&bC(Kt,gn)&&Fh(Kt)!=="body"}):[]}(wt):[].concat(At),St=[].concat(yt,[Tt]),Ft=St[0],Mt=St.reduce(function(Gt,rn){var gn=wC(wt,rn);return Gt.top=Zm(gn.top,Gt.top),Gt.right=qb(gn.right,Gt.right),Gt.bottom=qb(gn.bottom,Gt.bottom),Gt.left=Zm(gn.left,Gt.left),Gt},wC(wt,Ft));return Mt.width=Mt.right-Mt.left,Mt.height=Mt.bottom-Mt.top,Mt.x=Mt.left,Mt.y=Mt.top,Mt}(X_(ye)?ye:ye.contextElement||_f(c.elements.popper),d,X),Pe=J_(c.elements.reference),Be=_C({reference:Pe,element:Ae,strategy:"absolute",placement:a}),Oe=v1(Object.assign({},Ae,Be)),Fe=Z===ev?Oe:Pe,Xe={top:ge.top-Fe.top+me.top,bottom:Fe.bottom-ge.bottom+me.bottom,left:ge.left-Fe.left+me.left,right:Fe.right-ge.right+me.right},at=c.modifiersData.offset;if(Z===ev&&at){var mt=at[a];Object.keys(Xe).forEach(function(wt){var At=[Ac,vc].indexOf(wt)>=0?1:-1,Tt=[ul,vc].indexOf(wt)>=0?"y":"x";Xe[wt]+=mt[Tt]*At})}return Xe}var SC={name:"flip",enabled:!0,phase:"main",fn:function(c){var e=c.state,i=c.options,s=c.name;if(!e.modifiersData[s]._skip){for(var a=i.mainAxis,h=a===void 0||a,d=i.altAxis,b=d===void 0||d,X=i.fallbackPlacements,$=i.padding,Z=i.boundary,re=i.rootBoundary,le=i.altBoundary,he=i.flipVariations,fe=he===void 0||he,me=i.allowedAutoPlacements,Ee=e.options.placement,Ae=jh(Ee),ye=X||(Ae!==Ee&&fe?function(Kt){if(jh(Kt)===Xb)return[];var In=Zb(Kt);return[yC(Kt),In,yC(In)]}(Ee):[Zb(Ee)]),ge=[Ee].concat(ye).reduce(function(Kt,In){return Kt.concat(jh(In)===Xb?function(kn,On){On===void 0&&(On={});var zn=On,pi=zn.placement,yn=zn.boundary,Ji=zn.rootBoundary,ar=zn.padding,$i=zn.flipVariations,Pr=zn.allowedAutoPlacements,$r=Pr===void 0?p1:Pr,an=tv(pi),Un=an?$i?d1:d1.filter(function(Yr){return tv(Yr)===an}):$_,Fn=Un.filter(function(Yr){return $r.indexOf(Yr)>=0});Fn.length===0&&(Fn=Un);var Zi=Fn.reduce(function(Yr,ut){return Yr[ut]=nv(kn,{placement:ut,boundary:yn,rootBoundary:Ji,padding:ar})[jh(ut)],Yr},{});return Object.keys(Zi).sort(function(Yr,ut){return Zi[Yr]-Zi[ut]})}(e,{placement:In,boundary:Z,rootBoundary:re,padding:$,flipVariations:fe,allowedAutoPlacements:me}):In)},[]),Pe=e.rects.reference,Be=e.rects.popper,Oe=new Map,Fe=!0,Xe=ge[0],at=0;at<ge.length;at++){var mt=ge[at],wt=jh(mt),At=tv(mt)===eg,Tt=[ul,vc].indexOf(wt)>=0,yt=Tt?"width":"height",St=nv(e,{placement:mt,boundary:Z,rootBoundary:re,altBoundary:le,padding:$}),Ft=Tt?At?Ac:hl:At?vc:ul;Pe[yt]>Be[yt]&&(Ft=Zb(Ft));var Mt=Zb(Ft),Gt=[];if(h&&Gt.push(St[wt]<=0),b&&Gt.push(St[Ft]<=0,St[Mt]<=0),Gt.every(function(Kt){return Kt})){Xe=mt,Fe=!1;break}Oe.set(mt,Gt)}if(Fe)for(var rn=function(Kt){var In=ge.find(function(kn){var On=Oe.get(kn);if(On)return On.slice(0,Kt).every(function(zn){return zn})});if(In)return Xe=In,"break"},gn=fe?3:1;gn>0&&rn(gn)!=="break";gn--);e.placement!==Xe&&(e.modifiersData[s]._skip=!0,e.placement=Xe,e.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function nA(c,e,i){return Zm(c,qb(e,i))}var CC={name:"preventOverflow",enabled:!0,phase:"main",fn:function(c){var e=c.state,i=c.options,s=c.name,a=i.mainAxis,h=a===void 0||a,d=i.altAxis,b=d!==void 0&&d,X=i.boundary,$=i.rootBoundary,Z=i.altBoundary,re=i.padding,le=i.tether,he=le===void 0||le,fe=i.tetherOffset,me=fe===void 0?0:fe,Ee=nv(e,{boundary:X,rootBoundary:$,padding:re,altBoundary:Z}),Ae=jh(e.placement),ye=tv(e.placement),ge=!ye,Pe=m1(Ae),Be=Pe==="x"?"y":"x",Oe=e.modifiersData.popperOffsets,Fe=e.rects.reference,Xe=e.rects.popper,at=typeof me=="function"?me(Object.assign({},e.rects,{placement:e.placement})):me,mt=typeof at=="number"?{mainAxis:at,altAxis:at}:Object.assign({mainAxis:0,altAxis:0},at),wt=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,At={x:0,y:0};if(Oe){if(h){var Tt,yt=Pe==="y"?ul:hl,St=Pe==="y"?vc:Ac,Ft=Pe==="y"?"height":"width",Mt=Oe[Pe],Gt=Mt+Ee[yt],rn=Mt-Ee[St],gn=he?-Xe[Ft]/2:0,Kt=ye===eg?Fe[Ft]:Xe[Ft],In=ye===eg?-Xe[Ft]:-Fe[Ft],kn=e.elements.arrow,On=he&&kn?u1(kn):{width:0,height:0},zn=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},pi=zn[yt],yn=zn[St],Ji=nA(0,Fe[Ft],On[Ft]),ar=ge?Fe[Ft]/2-gn-Ji-pi-mt.mainAxis:Kt-Ji-pi-mt.mainAxis,$i=ge?-Fe[Ft]/2+gn+Ji+yn+mt.mainAxis:In+Ji+yn+mt.mainAxis,Pr=e.elements.arrow&&tA(e.elements.arrow),$r=Pr?Pe==="y"?Pr.clientTop||0:Pr.clientLeft||0:0,an=(Tt=wt==null?void 0:wt[Pe])!=null?Tt:0,Un=Mt+$i-an,Fn=nA(he?qb(Gt,Mt+ar-an-$r):Gt,Mt,he?Zm(rn,Un):rn);Oe[Pe]=Fn,At[Pe]=Fn-Mt}if(b){var Zi,Yr=Pe==="x"?ul:hl,ut=Pe==="x"?vc:Ac,Nt=Oe[Be],pt=Be==="y"?"height":"width",zt=Nt+Ee[Yr],Yt=Nt-Ee[ut],jt=[ul,hl].indexOf(Ae)!==-1,sn=(Zi=wt==null?void 0:wt[Be])!=null?Zi:0,Qn=jt?zt:Nt-Fe[pt]-Xe[pt]-sn+mt.altAxis,ni=jt?Nt+Fe[pt]+Xe[pt]-sn-mt.altAxis:Yt,ui=he&&jt?function(li,fi,si){var ii=nA(li,fi,si);return ii>si?si:ii}(Qn,Nt,ni):nA(he?Qn:zt,Nt,he?ni:Yt);Oe[Be]=ui,At[Be]=ui-Nt}e.modifiersData[s]=At}},requiresIfExists:["offset"]},MC={name:"arrow",enabled:!0,phase:"main",fn:function(c){var e,i=c.state,s=c.name,a=c.options,h=i.elements.arrow,d=i.modifiersData.popperOffsets,b=jh(i.placement),X=m1(b),$=[hl,Ac].indexOf(b)>=0?"height":"width";if(h&&d){var Z=function(Xe,at){return xC(typeof(Xe=typeof Xe=="function"?Xe(Object.assign({},at.rects,{placement:at.placement})):Xe)!="number"?Xe:EC(Xe,$_))}(a.padding,i),re=u1(h),le=X==="y"?ul:hl,he=X==="y"?vc:Ac,fe=i.rects.reference[$]+i.rects.reference[X]-d[X]-i.rects.popper[$],me=d[X]-i.rects.reference[X],Ee=tA(h),Ae=Ee?X==="y"?Ee.clientHeight||0:Ee.clientWidth||0:0,ye=fe/2-me/2,ge=Z[le],Pe=Ae-re[$]-Z[he],Be=Ae/2-re[$]/2+ye,Oe=nA(ge,Be,Pe),Fe=X;i.modifiersData[s]=((e={})[Fe]=Oe,e.centerOffset=Oe-Be,e)}},effect:function(c){var e=c.state,i=c.options.element,s=i===void 0?"[data-popper-arrow]":i;s!=null&&(typeof s!="string"||(s=e.elements.popper.querySelector(s)))&&bC(e.elements.popper,s)&&(e.elements.arrow=s)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function TC(c,e,i){return i===void 0&&(i={x:0,y:0}),{top:c.top-e.height-i.y,right:c.right-e.width+i.x,bottom:c.bottom-e.height+i.y,left:c.left-e.width-i.x}}function IC(c){return[ul,Ac,vc,hl].some(function(e){return c[e]>=0})}var DC={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(c){var e=c.state,i=c.name,s=e.rects.reference,a=e.rects.popper,h=e.modifiersData.preventOverflow,d=nv(e,{elementContext:"reference"}),b=nv(e,{altBoundary:!0}),X=TC(d,s),$=TC(b,a,h),Z=IC(X),re=IC($);e.modifiersData[i]={referenceClippingOffsets:X,popperEscapeOffsets:$,isReferenceHidden:Z,hasPopperEscaped:re},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":Z,"data-popper-escaped":re})}},PC=Kb({defaultModifiers:[f1,g1,_1,$b,AC,SC,CC,MC,DC]}),RC="tippy-content",BC="tippy-arrow",kC="tippy-svg-arrow",tg={passive:!0,capture:!0},OC=function(){return document.body};function A1(c,e,i){if(Array.isArray(c)){var s=c[e];return s??(Array.isArray(i)?i[e]:i)}return c}function y1(c,e){var i={}.toString.call(c);return i.indexOf("[object")===0&&i.indexOf(e+"]")>-1}function LC(c,e){return typeof c=="function"?c.apply(void 0,e):c}function NC(c,e){return e===0?c:function(s){clearTimeout(i),i=setTimeout(function(){c(s)},e)};var i}function iv(c){return[].concat(c)}function UC(c,e){c.indexOf(e)===-1&&c.push(e)}function ew(c){return[].slice.call(c)}function FC(c){return Object.keys(c).reduce(function(e,i){return c[i]!==void 0&&(e[i]=c[i]),e},{})}function iA(){return document.createElement("div")}function tw(c){return["Element","Fragment"].some(function(e){return y1(c,e)})}function b1(c,e){c.forEach(function(i){i&&(i.style.transitionDuration=e+"ms")})}function jC(c,e){c.forEach(function(i){i&&i.setAttribute("data-state",e)})}function w1(c,e,i){var s=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(a){c[s](a,i)})}function zC(c,e){for(var i=e;i;){var s;if(c.contains(i))return!0;i=i.getRootNode==null||(s=i.getRootNode())==null?void 0:s.host}return!1}var zh={isTouch:!1},VC=0;function TI(){zh.isTouch||(zh.isTouch=!0,window.performance&&document.addEventListener("mousemove",GC))}function GC(){var c=performance.now();c-VC<20&&(zh.isTouch=!1,document.removeEventListener("mousemove",GC)),VC=c}function II(){var c,e=document.activeElement;if((c=e)&&c._tippy&&c._tippy.reference===c){var i=e._tippy;e.blur&&!i.state.isVisible&&e.blur()}}var DI=!(typeof window>"u"||typeof document>"u"||!window.msCrypto),Hu=Object.assign({appendTo:OC,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},{animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),PI=Object.keys(Hu);function QC(c){var e=(c.plugins||[]).reduce(function(i,s){var a,h=s.name,d=s.defaultValue;return h&&(i[h]=c[h]!==void 0?c[h]:(a=Hu[h])!=null?a:d),i},{});return Object.assign({},c,e)}function HC(c,e){var i=Object.assign({},e,{content:LC(e.content,[c])},e.ignoreAttributes?{}:function(s,a){return(a?Object.keys(QC(Object.assign({},Hu,{plugins:a}))):PI).reduce(function(h,d){var b=(s.getAttribute("data-tippy-"+d)||"").trim();if(!b)return h;if(d==="content")h[d]=b;else try{h[d]=JSON.parse(b)}catch{h[d]=b}return h},{})}(c,e.plugins));return i.aria=Object.assign({},Hu.aria,i.aria),i.aria={expanded:i.aria.expanded==="auto"?e.interactive:i.aria.expanded,content:i.aria.content==="auto"?e.interactive?null:"describedby":i.aria.content},i}function x1(c,e){c.innerHTML=e}function WC(c){var e=iA();return c===!0?e.className=BC:(e.className=kC,tw(c)?e.appendChild(c):x1(e,c)),e}function qC(c,e){tw(e.content)?(x1(c,""),c.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?x1(c,e.content):c.textContent=e.content)}function E1(c){var e=c.firstElementChild,i=ew(e.children);return{box:e,content:i.find(function(s){return s.classList.contains(RC)}),arrow:i.find(function(s){return s.classList.contains(BC)||s.classList.contains(kC)}),backdrop:i.find(function(s){return s.classList.contains("tippy-backdrop")})}}function YC(c){var e=iA(),i=iA();i.className="tippy-box",i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var s=iA();function a(h,d){var b=E1(e),X=b.box,$=b.content,Z=b.arrow;d.theme?X.setAttribute("data-theme",d.theme):X.removeAttribute("data-theme"),typeof d.animation=="string"?X.setAttribute("data-animation",d.animation):X.removeAttribute("data-animation"),d.inertia?X.setAttribute("data-inertia",""):X.removeAttribute("data-inertia"),X.style.maxWidth=typeof d.maxWidth=="number"?d.maxWidth+"px":d.maxWidth,d.role?X.setAttribute("role",d.role):X.removeAttribute("role"),h.content===d.content&&h.allowHTML===d.allowHTML||qC($,c.props),d.arrow?Z?h.arrow!==d.arrow&&(X.removeChild(Z),X.appendChild(WC(d.arrow))):X.appendChild(WC(d.arrow)):Z&&X.removeChild(Z)}return s.className=RC,s.setAttribute("data-state","hidden"),qC(s,c.props),e.appendChild(i),i.appendChild(s),a(c.props,c.props),{popper:e,onUpdate:a}}YC.$$tippy=!0;var RI=1,nw=[],S1=[];function BI(c,e){var i,s,a,h,d,b,X,$,Z=HC(c,Object.assign({},Hu,QC(FC(e)))),re=!1,le=!1,he=!1,fe=!1,me=[],Ee=NC(Pr,Z.interactiveDebounce),Ae=RI++,ye=($=Z.plugins).filter(function(pt,zt){return $.indexOf(pt)===zt}),ge={id:Ae,reference:c,popper:iA(),popperInstance:null,props:Z,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:ye,clearDelayTimeouts:function(){clearTimeout(i),clearTimeout(s),cancelAnimationFrame(a)},setProps:function(pt){if(!ge.state.isDestroyed){Mt("onBeforeUpdate",[ge,pt]),ar();var zt=ge.props,Yt=HC(c,Object.assign({},zt,FC(pt),{ignoreAttributes:!0}));ge.props=Yt,Ji(),zt.interactiveDebounce!==Yt.interactiveDebounce&&(gn(),Ee=NC(Pr,Yt.interactiveDebounce)),zt.triggerTarget&&!Yt.triggerTarget?iv(zt.triggerTarget).forEach(function(jt){jt.removeAttribute("aria-expanded")}):Yt.triggerTarget&&c.removeAttribute("aria-expanded"),rn(),Ft(),Oe&&Oe(zt,Yt),ge.popperInstance&&(Fn(),Yr().forEach(function(jt){requestAnimationFrame(jt._tippy.popperInstance.forceUpdate)})),Mt("onAfterUpdate",[ge,pt])}},setContent:function(pt){ge.setProps({content:pt})},show:function(){var pt=ge.state.isVisible,zt=ge.state.isDestroyed,Yt=!ge.state.isEnabled,jt=zh.isTouch&&!ge.props.touch,sn=A1(ge.props.duration,0,Hu.duration);if(!(pt||zt||Yt||jt||At().hasAttribute("disabled")||(Mt("onShow",[ge],!1),ge.props.onShow(ge)===!1))){if(ge.state.isVisible=!0,wt()&&(Be.style.visibility="visible"),Ft(),On(),ge.state.isMounted||(Be.style.transition="none"),wt()){var Qn=yt();b1([Qn.box,Qn.content],0)}var ni,ui,li;b=function(){var fi;if(ge.state.isVisible&&!fe){if(fe=!0,Be.offsetHeight,Be.style.transition=ge.props.moveTransition,wt()&&ge.props.animation){var si=yt(),ii=si.box,bi=si.content;b1([ii,bi],sn),jC([ii,bi],"visible")}Gt(),rn(),UC(S1,ge),(fi=ge.popperInstance)==null||fi.forceUpdate(),Mt("onMount",[ge]),ge.props.animation&&wt()&&function(Yn,xi){pi(Yn,function(){ge.state.isShown=!0,Mt("onShown",[ge])})}(sn)}},ui=ge.props.appendTo,li=At(),(ni=ge.props.interactive&&ui===OC||ui==="parent"?li.parentNode:LC(ui,[li])).contains(Be)||ni.appendChild(Be),ge.state.isMounted=!0,Fn()}},hide:function(){var pt=!ge.state.isVisible,zt=ge.state.isDestroyed,Yt=!ge.state.isEnabled,jt=A1(ge.props.duration,1,Hu.duration);if(!(pt||zt||Yt)&&(Mt("onHide",[ge],!1),ge.props.onHide(ge)!==!1)){if(ge.state.isVisible=!1,ge.state.isShown=!1,fe=!1,re=!1,wt()&&(Be.style.visibility="hidden"),gn(),zn(),Ft(!0),wt()){var sn=yt(),Qn=sn.box,ni=sn.content;ge.props.animation&&(b1([Qn,ni],jt),jC([Qn,ni],"hidden"))}Gt(),rn(),ge.props.animation?wt()&&function(ui,li){pi(ui,function(){!ge.state.isVisible&&Be.parentNode&&Be.parentNode.contains(Be)&&li()})}(jt,ge.unmount):ge.unmount()}},hideWithInteractivity:function(pt){Tt().addEventListener("mousemove",Ee),UC(nw,Ee),Ee(pt)},enable:function(){ge.state.isEnabled=!0},disable:function(){ge.hide(),ge.state.isEnabled=!1},unmount:function(){ge.state.isVisible&&ge.hide(),ge.state.isMounted&&(Zi(),Yr().forEach(function(pt){pt._tippy.unmount()}),Be.parentNode&&Be.parentNode.removeChild(Be),S1=S1.filter(function(pt){return pt!==ge}),ge.state.isMounted=!1,Mt("onHidden",[ge]))},destroy:function(){ge.state.isDestroyed||(ge.clearDelayTimeouts(),ge.unmount(),ar(),delete c._tippy,ge.state.isDestroyed=!0,Mt("onDestroy",[ge]))}};if(!Z.render)return ge;var Pe=Z.render(ge),Be=Pe.popper,Oe=Pe.onUpdate;Be.setAttribute("data-tippy-root",""),Be.id="tippy-"+ge.id,ge.popper=Be,c._tippy=ge,Be._tippy=ge;var Fe=ye.map(function(pt){return pt.fn(ge)}),Xe=c.hasAttribute("aria-expanded");return Ji(),rn(),Ft(),Mt("onCreate",[ge]),Z.showOnCreate&&ut(),Be.addEventListener("mouseenter",function(){ge.props.interactive&&ge.state.isVisible&&ge.clearDelayTimeouts()}),Be.addEventListener("mouseleave",function(){ge.props.interactive&&ge.props.trigger.indexOf("mouseenter")>=0&&Tt().addEventListener("mousemove",Ee)}),ge;function at(){var pt=ge.props.touch;return Array.isArray(pt)?pt:[pt,0]}function mt(){return at()[0]==="hold"}function wt(){var pt;return!((pt=ge.props.render)==null||!pt.$$tippy)}function At(){return X||c}function Tt(){var pt,zt,Yt=At().parentNode;return Yt&&(zt=iv(Yt)[0])!=null&&(pt=zt.ownerDocument)!=null&&pt.body?zt.ownerDocument:document}function yt(){return E1(Be)}function St(pt){return ge.state.isMounted&&!ge.state.isVisible||zh.isTouch||h&&h.type==="focus"?0:A1(ge.props.delay,pt?0:1,Hu.delay)}function Ft(pt){pt===void 0&&(pt=!1),Be.style.pointerEvents=ge.props.interactive&&!pt?"":"none",Be.style.zIndex=""+ge.props.zIndex}function Mt(pt,zt,Yt){var jt;Yt===void 0&&(Yt=!0),Fe.forEach(function(sn){sn[pt]&&sn[pt].apply(sn,zt)}),Yt&&(jt=ge.props)[pt].apply(jt,zt)}function Gt(){var pt=ge.props.aria;if(pt.content){var zt="aria-"+pt.content,Yt=Be.id;iv(ge.props.triggerTarget||c).forEach(function(jt){var sn=jt.getAttribute(zt);if(ge.state.isVisible)jt.setAttribute(zt,sn?sn+" "+Yt:Yt);else{var Qn=sn&&sn.replace(Yt,"").trim();Qn?jt.setAttribute(zt,Qn):jt.removeAttribute(zt)}})}}function rn(){!Xe&&ge.props.aria.expanded&&iv(ge.props.triggerTarget||c).forEach(function(pt){ge.props.interactive?pt.setAttribute("aria-expanded",ge.state.isVisible&&pt===At()?"true":"false"):pt.removeAttribute("aria-expanded")})}function gn(){Tt().removeEventListener("mousemove",Ee),nw=nw.filter(function(pt){return pt!==Ee})}function Kt(pt){if(!zh.isTouch||!he&&pt.type!=="mousedown"){var zt=pt.composedPath&&pt.composedPath()[0]||pt.target;if(!ge.props.interactive||!zC(Be,zt)){if(iv(ge.props.triggerTarget||c).some(function(Yt){return zC(Yt,zt)})){if(zh.isTouch||ge.state.isVisible&&ge.props.trigger.indexOf("click")>=0)return}else Mt("onClickOutside",[ge,pt]);ge.props.hideOnClick===!0&&(ge.clearDelayTimeouts(),ge.hide(),le=!0,setTimeout(function(){le=!1}),ge.state.isMounted||zn())}}}function In(){he=!0}function kn(){he=!1}function On(){var pt=Tt();pt.addEventListener("mousedown",Kt,!0),pt.addEventListener("touchend",Kt,tg),pt.addEventListener("touchstart",kn,tg),pt.addEventListener("touchmove",In,tg)}function zn(){var pt=Tt();pt.removeEventListener("mousedown",Kt,!0),pt.removeEventListener("touchend",Kt,tg),pt.removeEventListener("touchstart",kn,tg),pt.removeEventListener("touchmove",In,tg)}function pi(pt,zt){var Yt=yt().box;function jt(sn){sn.target===Yt&&(w1(Yt,"remove",jt),zt())}if(pt===0)return zt();w1(Yt,"remove",d),w1(Yt,"add",jt),d=jt}function yn(pt,zt,Yt){Yt===void 0&&(Yt=!1),iv(ge.props.triggerTarget||c).forEach(function(jt){jt.addEventListener(pt,zt,Yt),me.push({node:jt,eventType:pt,handler:zt,options:Yt})})}function Ji(){var pt;mt()&&(yn("touchstart",$i,{passive:!0}),yn("touchend",$r,{passive:!0})),(pt=ge.props.trigger,pt.split(/\s+/).filter(Boolean)).forEach(function(zt){if(zt!=="manual")switch(yn(zt,$i),zt){case"mouseenter":yn("mouseleave",$r);break;case"focus":yn(DI?"focusout":"blur",an);break;case"focusin":yn("focusout",an)}})}function ar(){me.forEach(function(pt){var zt=pt.node,Yt=pt.eventType,jt=pt.handler,sn=pt.options;zt.removeEventListener(Yt,jt,sn)}),me=[]}function $i(pt){var zt,Yt=!1;if(ge.state.isEnabled&&!Un(pt)&&!le){var jt=((zt=h)==null?void 0:zt.type)==="focus";h=pt,X=pt.currentTarget,rn(),!ge.state.isVisible&&y1(pt,"MouseEvent")&&nw.forEach(function(sn){return sn(pt)}),pt.type==="click"&&(ge.props.trigger.indexOf("mouseenter")<0||re)&&ge.props.hideOnClick!==!1&&ge.state.isVisible?Yt=!0:ut(pt),pt.type==="click"&&(re=!Yt),Yt&&!jt&&Nt(pt)}}function Pr(pt){var zt=pt.target,Yt=At().contains(zt)||Be.contains(zt);if(pt.type!=="mousemove"||!Yt){var jt=Yr().concat(Be).map(function(sn){var Qn,ni=(Qn=sn._tippy.popperInstance)==null?void 0:Qn.state;return ni?{popperRect:sn.getBoundingClientRect(),popperState:ni,props:Z}:null}).filter(Boolean);(function(sn,Qn){var ni=Qn.clientX,ui=Qn.clientY;return sn.every(function(li){var fi=li.popperRect,si=li.popperState,ii=li.props.interactiveBorder,bi=si.placement.split("-")[0],Yn=si.modifiersData.offset;if(!Yn)return!0;var xi=bi==="bottom"?Yn.top.y:0,Pi=bi==="top"?Yn.bottom.y:0,qi=bi==="right"?Yn.left.x:0,Rs=bi==="left"?Yn.right.x:0,fs=fi.top-ui+xi>ii,Ei=ui-fi.bottom-Pi>ii,er=fi.left-ni+qi>ii,xr=ni-fi.right-Rs>ii;return fs||Ei||er||xr})})(jt,pt)&&(gn(),Nt(pt))}}function $r(pt){Un(pt)||ge.props.trigger.indexOf("click")>=0&&re||(ge.props.interactive?ge.hideWithInteractivity(pt):Nt(pt))}function an(pt){ge.props.trigger.indexOf("focusin")<0&&pt.target!==At()||ge.props.interactive&&pt.relatedTarget&&Be.contains(pt.relatedTarget)||Nt(pt)}function Un(pt){return!!zh.isTouch&&mt()!==pt.type.indexOf("touch")>=0}function Fn(){Zi();var pt=ge.props,zt=pt.popperOptions,Yt=pt.placement,jt=pt.offset,sn=pt.getReferenceClientRect,Qn=pt.moveTransition,ni=wt()?E1(Be).arrow:null,ui=sn?{getBoundingClientRect:sn,contextElement:sn.contextElement||At()}:c,li=[{name:"offset",options:{offset:jt}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Qn}},{name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(fi){var si=fi.state;if(wt()){var ii=yt().box;["placement","reference-hidden","escaped"].forEach(function(bi){bi==="placement"?ii.setAttribute("data-placement",si.placement):si.attributes.popper["data-popper-"+bi]?ii.setAttribute("data-"+bi,""):ii.removeAttribute("data-"+bi)}),si.attributes.popper={}}}}];wt()&&ni&&li.push({name:"arrow",options:{element:ni,padding:3}}),li.push.apply(li,(zt==null?void 0:zt.modifiers)||[]),ge.popperInstance=PC(ui,Be,Object.assign({},zt,{placement:Yt,onFirstUpdate:b,modifiers:li}))}function Zi(){ge.popperInstance&&(ge.popperInstance.destroy(),ge.popperInstance=null)}function Yr(){return ew(Be.querySelectorAll("[data-tippy-root]"))}function ut(pt){ge.clearDelayTimeouts(),pt&&Mt("onTrigger",[ge,pt]),On();var zt=St(!0),Yt=at(),jt=Yt[0],sn=Yt[1];zh.isTouch&&jt==="hold"&&sn&&(zt=sn),zt?i=setTimeout(function(){ge.show()},zt):ge.show()}function Nt(pt){if(ge.clearDelayTimeouts(),Mt("onUntrigger",[ge,pt]),ge.state.isVisible){if(!(ge.props.trigger.indexOf("mouseenter")>=0&&ge.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(pt.type)>=0&&re)){var zt=St(!1);zt?s=setTimeout(function(){ge.state.isVisible&&ge.hide()},zt):a=requestAnimationFrame(function(){ge.hide()})}}else zn()}}function rA(c,e){e===void 0&&(e={});var i=Hu.plugins.concat(e.plugins||[]);document.addEventListener("touchstart",TI,tg),window.addEventListener("blur",II);var s,a=Object.assign({},e,{plugins:i}),h=(s=c,tw(s)?[s]:function(d){return y1(d,"NodeList")}(s)?ew(s):Array.isArray(s)?s:ew(document.querySelectorAll(s))).reduce(function(d,b){var X=b&&BI(b,a);return X&&d.push(X),d},[]);return tw(c)?h[0]:h}rA.defaultProps=Hu,rA.setDefaultProps=function(c){Object.keys(c).forEach(function(e){Hu[e]=c[e]})},rA.currentInput=zh,Object.assign({},$b,{effect:function(c){var e=c.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow)}}),rA.setDefaultProps({render:YC});var C1=rA;class ng extends Wb{async _refreshUi(){var e;if(!await super._refreshUi())return!1;Gu.RemoveAll(ng.PluginType);for(const i of this.variations)Gu.Create(ng.PluginType,i.title,5,20,0,i.materials.map(s=>{let a;if(i.preview.startsWith("generate:"))a=this._previewGenerator.generate(s,i.preview.split(":")[1]);else{const h=s[i.preview]||"#ff00ff";a=h.image?na(h.image,100):void 0,a||(a=ZS(h,!0))}return{id:s.uuid,image:a,onClick:h=>this.applyVariation(i,h),tooltip:s.name||s.uuid}}),(s,a)=>C1(s,{placement:"bottom",content:a.tooltip}));return Gu.RebuildUi((e=this._viewer)===null||e===void 0?void 0:e.container),!0}}ng.PluginType="MaterialConfiguratorPlugin";class iw extends Xi{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{var e,i;this.enabled&&((i=(e=this.uiConfig)===null||e===void 0?void 0:e.uiRefresh)===null||i===void 0||i.call(e,"postFrame",!0))},this.dependencies=[Kn],this._selectedObject=()=>{var e;return((e=this._picking)===null||e===void 0?void 0:e.getSelectedObject())||void 0},this._selectedMaterial=()=>{var e;return((e=this._selectedObject())===null||e===void 0?void 0:e.material)||void 0}}async onAdded(e){var i,s;await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("Picking"),this._previewGenerator=new r1(this._viewer),(s=this._picking)===null||s===void 0||s.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}async onRemove(e){var i,s;return(i=this._previewGenerator)===null||i===void 0||i.dispose(),this._previewGenerator=void 0,(s=this._picking)===null||s===void 0||s.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return this._uiNeedRefresh&&this.enabled&&this._refreshUiConfig(),this._uiNeedRefresh=!1,!1}}iw.PluginType="MaterialLibraryBasePlugin",function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);h>3&&d&&Object.defineProperty(e,i,d)}([Xn("Enabled")],iw.prototype,"enabled",void 0);class vf extends iw{constructor(){super(...arguments),this.replaceMaterial=!1,this.uiConfig={type:"folder",label:"Material Library",uuid:Ms(),children:[...Ec(this),()=>{var e;return{type:"dropdown",label:"Apply Material",limitedUi:!0,hidden:()=>!this._selectedObject(),children:[{label:"select one",value:""},[...this._viewer.getPlugin(Kn).materials.getMaterialsOfType((e=this._selectedMaterial())===null||e===void 0?void 0:e.typeSlug).map(i=>({label:i.name||i.uuid,value:i.uuid}))||[]]],getValue:()=>{var i;return(i=this._selectedMaterial())===null||i===void 0?void 0:i.uuid},setValue:i=>{var s,a,h,d,b;const X=(h=(a=(s=this._viewer)===null||s===void 0?void 0:s.getPlugin(Kn))===null||a===void 0?void 0:a.materials)===null||h===void 0?void 0:h.findMaterial(i);if(X)if(this.replaceMaterial)(b=(d=this._selectedObject())===null||d===void 0?void 0:d.setMaterial)===null||b===void 0||b.call(d,X);else{const $=this._selectedMaterial();if($){const Z=$.name,re=$.uuid;$.copyProps(X),$.name=Z,$.uuid=re,$.userData.uuid&&($.userData.uuid=re)}}this._refreshUi()}}}]}}async _refreshUi(){var e,i,s,a;if(!await super._refreshUi())return!1;const h=[jo.TypeSlug,hs.TypeSlug],d=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(Kn))===null||i===void 0?void 0:i.materials,b=h.map(X=>[X,d==null?void 0:d.getMaterialsOfType(X)]);Gu.RemoveAll(vf.PluginType);for(const[X,$]of b)Gu.Create(vf.PluginType,X,5,20,0,(s=$)===null||s===void 0?void 0:s.filter(Z=>!Z.userData.__runtimeMaterial).map(Z=>{let re;const le="generate:sphere";if(le.startsWith("generate:"))re=this._previewGenerator.generate(Z,le.split(":")[1]);else{const he=Z[le]||"#ff00ff";re=he.image?na(he.image,100):void 0,re||(re=$S(he,!0))}return{id:Z.uuid,image:re,onClick:he=>{const fe=d==null?void 0:d.findMaterial(he);if(console.log(fe==null?void 0:fe.name),fe){const me=fe.userData.__appliedMeshes;if(me!=null&&me.size){const Ee=me.keys().next().value;Ee.dispatchEvent({type:"select",value:Ee})}}},tooltip:Z.name||Z.uuid}}),(Z,re)=>C1(Z,{placement:"bottom",content:re.tooltip}));return Gu.RebuildUi((a=this._viewer)===null||a===void 0?void 0:a.container),!0}}function XC(c,e,i,s){c.traverse(a=>{a&&(a.userData.cloneRotI=e,a.userData.rotationCount=i,a.userData.rotationAxis=s,a.addEventListener("beforeRender",h=>function(d,b){var X;b&&(!((X=b.map)===null||X===void 0)&&X.isTexture)&&(b.extraUniformsToUpload||(b.extraUniformsToUpload={}),b.extraUniformsToUpload.uvTransform||(b.extraUniformsToUpload.uvTransform={value:new _.Vkp}),b.extraUniformsToUpload.uvTransform.value.setUvTransform(b.map.offset.x*b.map.repeat.x*d.userData.cloneRotI/(d.userData.rotationCount||1),b.map.offset.y*b.map.repeat.y*d.userData.cloneRotI/(d.userData.rotationCount||1),b.map.repeat.x,b.map.repeat.y,b.map.rotation,b.map.center.x,b.map.center.y))}(a,h.material)))})}function KC(c,e,i,s="x"){var a;if(c.userData.rotationCount>1&&!c.userData.rotationRoot)return c;const h=c.parent;if(!h)throw new Error("No parent");if(c.userData.cloneParent){const b=c.userData.cloneParent;if(!(c=h.children.find(X=>b===X.uuid)))return console.error("Couldn't find clone root, cannot rotate. maybe a serialization issue?",b,h),c}let d=h.children.filter(b=>{var X;return((X=b.userData)===null||X===void 0?void 0:X.cloneParent)===c.uuid}).sort((b,X)=>b.userData.cloneRotI-X.userData.cloneRotI);if(c.userData.rotationCount===e&&e===d.length&&i===void 0&&c.userData.rotationAxis===s)return c;if(i==null&&(i=(a=c.userData.rotationSkips)!==null&&a!==void 0?a:[]),i!==c.userData.rotationSkips&&(c.userData.rotationSkips=[...i]),XC(c,0,e,s),c.userData.rotationRoot=!0,c.visible=!0,e<=d.length){for(let b=e-1;b<d.length;b++)h.remove(d[b]),d[b].traverse(X=>X.userData={__disposed:!0});d=d.slice(0,e)}for(let b=1;b<e;b++){const X=b<=d.length?d[b-1]:c.clone();X.rotation.copy(c.rotation),X.rotation[s]+=b/e*Math.PI*2,XC(X,b,e,s),b>d.length&&h.add(X),X.visible=!i.includes(b)}return c.visible=!i.includes(0),c}vf.PluginType="MaterialLibraryPlugin",function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);h>3&&d&&Object.defineProperty(e,i,d)}([Xn("Replace Material")],vf.prototype,"replaceMaterial",void 0);var rv,sA=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Vh=rv=class extends Xi{constructor(){super(),this.enabled=!0,this.rotations=1,this.axis="x",this.skips="",this._selectedObjectChanged=this._selectedObjectChanged.bind(this)}async onAdded(c){var e;await super.onAdded(c),(e=c.getPluginByType("Picking"))===null||e===void 0||e.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}_selectedObjectChanged(){var c,e,i,s,a,h,d,b,X;if(!this.enabled)return;const $=(e=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Picking"))===null||e===void 0?void 0:e.getSelectedObject();if(!$)return void((s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0));const Z=$.userData.rotationRoot&&(a=$.userData.rotationCount)!==null&&a!==void 0?a:1;this.rotations=Z,this.skips=(d=(h=$.userData.rotationSkips)===null||h===void 0?void 0:h.join(","))!==null&&d!==void 0?d:"",this.axis=$.userData.rotationAxis||"x",(X=(b=this.uiConfig).uiRefresh)===null||X===void 0||X.call(b,"postFrame",!0)}_paramsChanged(){var c,e,i,s,a,h;if(!this.enabled)return;const d=(e=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Picking"))===null||e===void 0?void 0:e.getSelectedObject();if(d){if(this.rotations>1||d.userData.rotationCount){const b=d.userData.rotationCount,X=KC(d,this.rotations,this.skips.split(",").map(Z=>parseInt(Z)).filter(Z=>isFinite(Z)),this.axis),$=X==null?void 0:X.userData.rotationCount;if($&&$!==b){const Z=[];X==null||X.traverseAncestors(re=>{Z.push(re)});for(const re of Z)if(re.userData.autoScaled){$n(re),(i=this._viewer)===null||i===void 0||i.resetCamera({rootObject:re,centerOffset:new _.Pa4(4,4,4)});break}}d.parent&&!d.userData.__disposed||(a=(s=this._viewer)===null||s===void 0?void 0:s.getPluginByType("Picking"))===null||a===void 0||a.setSelectedObject(X,!0)}(h=this._viewer)===null||h===void 0||h.scene.setDirty({frameFade:!1,sceneUpdate:!0})}}};Vh.PluginType="ObjectRotationPlugin",sA([kt(),Xn("Enabled"),lt(rv.prototype._paramsChanged)],Vh.prototype,"enabled",void 0),sA([ai("Rotation Count",[1,100],1,c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPluginByType("Picking"))===null||i===void 0)&&i.getSelectedObject())||!c.rotations}})),lt(rv.prototype._paramsChanged)],Vh.prototype,"rotations",void 0),sA([Xs("Axis",["x","y","z"].map(c=>({label:c})),c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPluginByType("Picking"))===null||i===void 0)&&i.getSelectedObject())||!c.rotations}})),lt(rv.prototype._paramsChanged)],Vh.prototype,"axis",void 0),sA([cr("Rotation Skips",c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPluginByType("Picking"))===null||i===void 0)&&i.getSelectedObject())||!c.rotations}})),lt(rv.prototype._paramsChanged)],Vh.prototype,"skips",void 0),Vh=rv=sA([ur("Object Rotations")],Vh);var ig,sv=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Wu=ig=class extends Xi{constructor(c=!0){super(),this.enabled=!0,this.debugNormals=!1,this.debugHitHeight=!1,this._defines={PARALLAX_NORMAL_MAP_QUALITY:0},this.stepCount=12,this.binaryStepCount=3,this._bumpMapExtension={shaderExtender:(e,i,s)=>{if(i.materialObject.bumpMap&&this.enabled){e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_begin>",""),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>",""),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",`#include <normal_fragment_begin>
#include <normal_fragment_maps>
#include <map_fragment>`);for(const a of["map_fragment","alphamap_fragment","roughnessmap_fragment","metalnessmap_fragment","emissivemap_fragment","transmission_fragment"])e.fragmentShader=e.fragmentShader.replace(`#include <${a}>`,_.WdD[a].replace("vUv","parallaxUv.xy"));(this.debugNormals||this.debugHitHeight)&&(e.fragmentShader=e.fragmentShader.replace("texture2D( map, parallaxUv.xy )",this.debugNormals?"vec4(normal, 1.); normal = geometryNormal":"vec4(parallaxUv.z,0., 0., 1.)")),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>",_.WdD.normal_fragment_maps.replace("#elif defined( TANGENTSPACE_NORMALMAP )","#elif defined( TANGENTSPACE_NORMALMAP ) && !defined( USE_BUMPMAP )").replace("normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );","vec3 parallaxUv = reliefParallaxPerturbNormal(faceDirection, normal);"))}},parsFragmentSnippet:()=>this.enabled?`#ifdef USE_BUMPMAP
mat3 mat3_inverse(mat3 A){mat3 M_t=mat3(vec3(A[0][0],A[1][0],A[2][0]),vec3(A[0][1],A[1][1],A[2][1]),vec3(A[0][2],A[1][2],A[2][2]));float det=dot(cross(M_t[0],M_t[1]),M_t[2]);mat3 adjugate=mat3(cross(M_t[1],M_t[2]),cross(M_t[2],M_t[0]),cross(M_t[0],M_t[1]));return adjugate/det;}float CalculateHeight(in vec2 texCoords){float height=texture2D(bumpMap,texCoords).x;return clamp(height,0.,1.);}const vec2 bumpMapSize=vec2(512,512);vec3 CalculateNormal(in vec2 texCoords){
#if defined( TANGENTSPACE_NORMALMAP ) && 0 
vec3 mapN=texture2D(normalMap,texCoords).xyz;mapN.xy*=normalScale;return normalize(mapN);
#else
vec2 texOffs=1./bumpMapSize;
#if PARALLAX_NORMAL_MAP_QUALITY > 0
float hx[9];hx[0]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,-1.)).r;hx[1]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;hx[2]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,-1.)).r;hx[3]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;hx[4]=texture2D(bumpMap,texCoords.st).r;hx[5]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;hx[6]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,1.)).r;hx[7]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;hx[8]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,1.)).r;vec2 deltaH=vec2(hx[0]-hx[2]+2.*(hx[3]-hx[5])+hx[6]-hx[8],hx[0]-hx[6]+2.*(hx[1]-hx[7])+hx[2]-hx[8]);
#else
float h_xa=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;float h_xb=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;float h_ya=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;float h_yb=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;vec2 deltaH=vec2(h_xa-h_xb,h_ya-h_yb);
#endif
return normalize(vec3(deltaH/texOffs,1.));
#endif
}vec3 ReliefParallax(in float frontFace,in vec3 texDir3D,in vec2 texCoord){float surf_sign=frontFace;float back_face=step(0.,-surf_sign);vec2 texStep=surf_sign*texDir3D.xy/abs(texDir3D.z);vec2 texC=texCoord.st+surf_sign*texStep+back_face*texStep.xy;float mapHeight=1.;float bumpHeightStep=1./float(PARALLAX_MAP_STEPS);float bestBumpHeight=mapHeight+bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_STEPS;i++){if(mapHeight<bestBumpHeight){bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);}}
#pragma unroll_loop_end
bestBumpHeight+=bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_B_STEPS;i++){bumpHeightStep*=0.5;bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);bestBumpHeight+=(bestBumpHeight<mapHeight)?bumpHeightStep:0.;}
#pragma unroll_loop_end
bestBumpHeight-=bumpHeightStep*clamp((bestBumpHeight-mapHeight)/bumpHeightStep,0.,1.);mapHeight=bestBumpHeight;texC-=mapHeight*texStep;return vec3(texC.xy,mapHeight);}vec3 reliefParallaxPerturbNormal(in float faceDirection,inout vec3 normal){if(abs(bumpScale)<0.001)return vec3(vUv,0.);float parallaxHeight;vec2 texCoords=vUv;float face_sign=sign(dot(normal,vViewPosition));vec3 N=normalize(normal);vec3 dp1=dFdx(-vViewPosition);vec3 dp2=dFdy(-vViewPosition);vec2 duv1=dFdx(vUv);vec2 duv2=dFdy(vUv);vec3 dp2perp=cross(dp2,N);vec3 dp1perp=cross(N,dp1);vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(T,T),dot(B,B)));mat3 tbnMat=mat3(T*invmax,B*invmax,N*bumpScale);vec3 tangentPos=normalize(mat3_inverse(tbnMat)*-vViewPosition);vec3 parallaxUv=ReliefParallax(face_sign,tangentPos,vUv);tbnMat[2]=face_sign*N/bumpScale;normal=normalize(tbnMat*CalculateNormal(parallaxUv.xy).xyz);
#ifdef FLIP_SIDED
normal=-normal;
#endif
return parallaxUv;}
#endif 

`.replaceAll("PARALLAX_MAP_STEPS",this._defines.PARALLAX_MAP_STEPS).replaceAll("PARALLAX_MAP_B_STEPS",this._defines.PARALLAX_MAP_B_STEPS):"",isCompatible:e=>e.isMeshStandardMaterial2,computeCacheKey:e=>{var i;return this.enabled+" "+((i=e.materialObject.bumpMap)===null||i===void 0?void 0:i.uuid)+" "+this.debugNormals+" "+this.debugHitHeight+"  "},onObjectRender:(e,{materialObject:i},s)=>{for(const[a,h]of Object.entries(this._defines)){const d=typeof h=="number"?h:h?1:0;i.defines[a]!==d&&(i.defines[a]=d,i.needsUpdate=!0)}}},this.dependencies=[Kn],this.enabled=c,this._updateExtension=this._updateExtension.bind(this)}_updateExtension(){var c,e,i;(e=(c=this._bumpMapExtension)===null||c===void 0?void 0:c.setDirty)===null||e===void 0||e.call(c),(i=this._viewer)===null||i===void 0||i.setDirty()}async onAdded(c){var e,i;return(i=(e=c.getPlugin(Kn))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.registerMaterialExtension(this._bumpMapExtension),super.onAdded(c)}async onRemove(c){var e,i;return(i=(e=c.getPlugin(Kn))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this._bumpMapExtension),super.onRemove(c)}};Wu.PluginType="ReliefParallaxMapping",sv([lt(ig.prototype._updateExtension),Xn("Enabled")],Wu.prototype,"enabled",void 0),sv([lt(ig.prototype._updateExtension),Xn("Debug Normals")],Wu.prototype,"debugNormals",void 0),sv([lt(ig.prototype._updateExtension),Xn("Debug Hit Height")],Wu.prototype,"debugHitHeight",void 0),sv([Rt("PARALLAX_MAP_STEPS",void 0,!0,ig.prototype._updateExtension),ai("Step count",[1,32],1),kt()],Wu.prototype,"stepCount",void 0),sv([Rt("PARALLAX_MAP_B_STEPS",void 0,!0,ig.prototype._updateExtension),ai("Binary search steps",[1,8],1),kt()],Wu.prototype,"binaryStepCount",void 0),Wu=ig=sv([ur("Parallax Mapping")],Wu);var iu=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class yc extends Fs{constructor(e,i,s,a=!1){super({vertexShader:ec,fragmentShader:`

${Bg}
${Qf}
${tc}
${Vv}
${s}

${kg}

varying vec2 vUv;uniform float intensity;uniform float objectRadius;uniform float rayCount;uniform float power;uniform float bias;uniform float falloff;uniform float tolerance;uniform bool autoRadius;uniform vec2 screenSize;vec3 ComputeUniformL(vec3 N,vec2 E){vec3 L;L.xy=E;L.z=interleavedGradientNoise(gl_FragCoord.xy,frameCount*5.);L=L*2.-1.;return L;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=random3(vec3(gl_FragCoord.xy,frameCount+seed));rand_e.y=random3(vec3(gl_FragCoord.yx,rand_e.x+(frameCount)*7.));return rand_e;}vec4 calculateGI(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeUniformL(normal,E);L=normalize(L);L*=sign(dot(L,normal));float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?length(viewPos-screenToView(screenPos.xy+objectRadius/10.,screenPos.z)):mix((cameraNearFar.y)+viewPos.z,-viewPos.z-cameraNearFar.x,L.z*0.5+0.5)*objectRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount*14.+seed)+0.05;rayLen=max(rayLen,0.001);vec3 state=vec3(1.,(r+0.5)/float(RTAO_STEP_COUNT),2.);viewPos+=normal*max(-0.01*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,RTAO_STEP_COUNT);vec3 viewHitP=screenToView(screenHitP.xy,screenHitP.z);vec3 LRes=viewHitP-viewPos;if(state.z>1.)LRes=vec3(9999999.);float dist=length(LRes)*falloff;float EPS=0.01;float zBias=(viewPos.z)*bias;float ao=(max(dot(normal,L)+zBias,0.))/(dist*dist+EPS);
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 hitColor=tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy)).rgb;vec3 hitNormal=getViewNormal(screenHitP.xy);float giWeight=1.;giWeight=saturate2(giWeight/(dist+EPS),1.);giWeight*=saturate2((dot(normal,L)),1.);giWeight*=saturate2((dot(hitNormal,-L)),1.);return vec4(hitColor*giWeight,ao);
#endif
return vec4(0,0,0,ao);}float normpdf(in float x,in float sigma){return exp(-0.5*x*x/(sigma*sigma));}vec4 getLastThis(sampler2D tex,float depth,vec3 normal){vec2 direction=vec2(1,1);vec4 color=clamp(tLastThisTexelToLinear(texture2D(tex,vUv.xy)),0.,5.);return color;}void main(){float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>0.99){discard;gl_FragColor=getLastThis(tLastThis,depth,normal);return;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec4 gi=vec4(0.);gi+=calculateGI(8.,screenPos,normal,1.);if(rayCount>1.5)gi=max(gi,calculateGI(2.,screenPos,normal,0.4));if(rayCount>2.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.5));if(rayCount>3.5)gi=max(gi,calculateGI(1.,screenPos,normal,0.6));if(rayCount>4.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.));gi.a=min(1.,gi.a);gi.a=max(0.,gi.a);gi.rgb=min(vec3(3.),gi.rgb);gi.rgb=max(vec3(0.),gi.rgb);if(frameCount<3.){gl_FragColor=gi;return;}gl_FragColor=(texture2D(tLastThis,vUv));gl_FragColor=((gi+(gl_FragColor)*frameCount)/(frameCount+1.));}

            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:2.14},rayCount:{value:.1},objectRadius:{value:1},autoRadius:{value:!a},power:{value:1.1},bias:{value:.015},falloff:{value:.7},tolerance:{value:1.5},frameCount:{value:0},projection:{value:new _.yGw},screenSize:{value:new _.FM8},cameraPositionWorld:{value:new _.Pa4},cameraNearFar:{value:new _.FM8(.1,1e3)}},defines:{PERSPECTIVE_CAMERA:1,SSGI_ENABLED:a?1:0}},"tDiffuse","tLastFrame","tLastThis"),this.materialExtension={shaderExtender:(h,d,b)=>{if(!h.defines.SSRTAO_ENABLED)return;const X="vec3 totalDiffuse =";h.fragmentShader=h.fragmentShader.replace(X,`

            
            #if defined(SSRTAO_ENABLED) && SSRTAO_ENABLED > 0
vec4 ssgi=tSSGIMapTexelToLinear(texture2D(tSSGIMap,viewToScreen(vViewPosition.xyz).xy));float ambientOcclusion=1.-ssgi.a;ambientOcclusion=max(0.,ambientOcclusion);ambientOcclusion=pow(ambientOcclusion,ssaoPower);ambientOcclusion=min(1.,ambientOcclusion);reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 ssgiColor=ssgi.rgb*ssgiIntensity;reflectedLight.indirectDiffuse+=ssgiColor*(material.diffuseColor.rgb);
#endif
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));float specularOcclusion=saturate(pow(dotNV+ambientOcclusion,exp2(-16.*material.roughness-1.))-1.+ambientOcclusion);reflectedLight.indirectSpecular*=specularOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
#if !defined(SSR_ENABLED) || SSR_ENABLED < 1
reflectedLight.indirectSpecular+=ssgiColor*material.specularColor;
#endif
#endif
#endif
#endif

            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            
${X}`),h.fragmentShader=h.fragmentShader.replace("#include <aomap_fragment>",""),h.vertexUvs=!0},onObjectRender:(h,d,b)=>{var X,$,Z;this.materialExtension.extraUniforms.tSSGIMap.value=(X=this._target)===null||X===void 0?void 0:X.texture;const re=d.materialObject,le=!re.transparent&&re.transmission<.001;let he=this.enabled&&le&&(this.renderWithCamera||this._renderer.frameCount>1)&&b.userData.screenSpaceRendering!==!1&&!(!(($=re.userData)===null||$===void 0)&&$.ssrtaoDisabled)&&!(!((Z=re.userData)===null||Z===void 0)&&Z.ssaoDisabled)?1:0;re.defines.SSRTAO_ENABLED!==he&&(re.defines.SSRTAO_ENABLED=he,re.needsUpdate=!0),he=this.material.defines.SSGI_ENABLED,re.defines.SSGI_ENABLED!==he&&(re.defines.SSGI_ENABLED=he,re.needsUpdate=!0),he=this._target.texture,this.materialExtension.extraUniforms.tSSGIMap.value!==he&&(this.materialExtension.extraUniforms.tSSGIMap.value=he,re.needsUpdate=!0)},parsFragmentSnippet:h=>{var d;return Ne`
            uniform float ssaoPower;
            uniform float ssgiIntensity;
            uniform sampler2D tSSGIMap;
            ${en("tSSGIMap",(d=this._target)===null||d===void 0?void 0:d.texture,h.capabilities.isWebGL2)}

            ${Og}

        `},extraUniforms:{tSSGIMap:{value:null},ssaoPower:this.material.uniforms.power,ssgiIntensity:this.material.uniforms.intensity},computeCacheKey:h=>{var d,b;return this.enabled?"1":"0"+((b=(d=this._target)===null||d===void 0?void 0:d.texture)===null||b===void 0?void 0:b.encoding)},isCompatible:h=>{var d;return!(!((d=h.materialObject.userData)===null||d===void 0)&&d.ssaoDisabled)&&h.isMeshStandardMaterial2}},this.intensity=2,this.power=1.1,this.autoRadius=!0,this.objectRadius=2,this.tolerance=1,this.bias=.15,this.falloff=.7,this.rayCount=2,this.stepCount=4,this.smoothEnabled=!0,this.renderWithCamera=!0,this.uiConfig={type:"folder",label:"SS Global illumination (Dev)",children:[...Ec(this),{type:"checkbox",label:"GI Enabled",hidden:()=>!this._giActivated,property:[this,"ssgiEnabled"]}]},this._renderer=e,this._target=i,this.needsSwap=!0,this._giActivated=a,this.ssgiEnabled=a,this.bilateralPass=new Ng(this._target,s,"rgba")}get ssgiEnabled(){return parseInt(this.material.defines.SSGI_ENABLED)>.5}set ssgiEnabled(e){e=e&&this._giActivated,this.material.defines.SSGI_ENABLED=e?1:0,this.material.needsUpdate=!0}render(e,i,s,a,h){this.needsSwap=!1,!this.renderWithCamera&&this._renderer.frameCount<2||(this._renderer.blit(this._target.texture,i),this.uniforms.tLastThis.value=i.texture,super.render(e,this._target,s,a,h),this.smoothEnabled&&this.bilateralPass.render(e,i,s,a,h))}}iu([kt()],yc.prototype,"bilateralPass",void 0),iu([ai("Intensity",[0,4]),kt(),ot()],yc.prototype,"intensity",void 0),iu([ai("Power",[0,3]),kt(),ot()],yc.prototype,"power",void 0),iu([Xn("Auto radius"),kt(),ot()],yc.prototype,"autoRadius",void 0),iu([ai("Object Radius",[.01,10]),kt(),ot()],yc.prototype,"objectRadius",void 0),iu([ai("Tolerance",[.1,5]),kt(),ot()],yc.prototype,"tolerance",void 0),iu([ai("Bias",[-.3,.3]),kt(),ot()],yc.prototype,"bias",void 0),iu([ai("Falloff",[1e-4,4]),kt(),ot()],yc.prototype,"falloff",void 0),iu([ai("Ray Count",[1,5],1),kt(),ot()],yc.prototype,"rayCount",void 0),iu([ai("Step count",[1,16],1),kt(),Rt("RTAO_STEP_COUNT")],yc.prototype,"stepCount",void 0),iu([Xn("Smooth Enabled"),kt()],yc.prototype,"smoothEnabled",void 0),iu([Xn("Render with Camera")],yc.prototype,"renderWithCamera",void 0);class rw extends Gf{constructor(e=!0){super(),this.dependencies=[Kn,Or,Ho],this._initEnabled=!1,this.setDirty=this.setDirty.bind(this),this._initEnabled=e}get rtgiTarget(){return this._rtgiTarget}async onAdded(e){var i,s;await super.onAdded(e),this.enabled=this._initEnabled,(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)}get enabled(){var e,i;return((i=(e=this.passes.ssrtgi)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.enabled)||!1}set enabled(e){var i;!((i=this.passes.ssrtgi)===null||i===void 0)&&i.passObject&&(this.passes.ssrtgi.passObject.enabled=e)}createPasses(e){var i,s,a;this._rtgiTarget=e.renderer.createTarget({sizeMultiplier:1});let h=!1;return(i=this._viewer)===null||i===void 0||i.getPluginByType("debug"),[yd(e,{passId:"ssrtgi",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new yc(e.renderer,this._rtgiTarget,(a=(s=e.getPlugin(Or))===null||s===void 0?void 0:s.getUnpackSnippet())!==null&&a!==void 0?a:"",!0),update:()=>{var d;let b=this.enabled;if(b&&!h){const X=(d=this._viewer)===null||d===void 0?void 0:d.getPluginByType("SSAO");X!=null&&X.enabled&&(confirm("SSAO Plugin needs to be disabled to enable SSRTGI or SSRTAO. Disable now?")?X.enabled=!1:(this.enabled=!1,b=!1))}h=b,b&&this.passes.ssrtgi.passObject.bilateralPass.updateShaderProperties([e.getPlugin(Or)])}},()=>[e.getPlugin(Or),e.getPlugin(Ho),e.scene.activeCamera,e.renderer])]}async onRemove(e){return e.renderer.disposeTarget(this._rtgiTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get uiConfig(){var e,i,s,a,h;const d=(s=(i=(e=this.passes.ssrtgi)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.uiConfig)!==null&&s!==void 0?s:{};return(h=(a=d.children)===null||a===void 0?void 0:a.map(b=>st(b)))===null||h===void 0||h.flat(2).forEach(b=>b&&(b.onChange=this.setDirty)),d}}rw.PluginType="SSGI";class Af extends Xi{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this.dependencies=[Kn],this.variations=[],this._selectedSwitchNode=()=>{var e;const i=(e=this._picking)===null||e===void 0?void 0:e.getSelectedObject();if(!i)return;const s=this.variations.map(h=>h.name);let a;return i.traverseAncestors(h=>{a||s.includes(h.name)&&(a=h)}),a},this.uiConfig={label:"Switch Node",type:"folder",children:[()=>[{type:"folder",label:"All nodes",expanded:!0,children:[this.variations.map(e=>({type:"input",label:e.title,property:[e,"name"],onChange:()=>this.refreshUi()}))]},{type:"button",label:"Add Node",value:()=>{this.variations.push({name:"switch_node",selected:"",title:"Switch Node",camView:"front",camDistance:1}),this.refreshUi()}},{type:"button",label:"Refresh UI",value:()=>this.refreshUi()},{type:"input",label:"Selected node title",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(i=>i.name===e.name),"title"]:[]},onChange:()=>this.refreshUi()},{type:"slider",bounds:[.01,2],stepSize:.01,label:"Cam Distance",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(i=>i.name===e.name),"camDistance"]:[]}},{type:"dropdown",label:"Cam View",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(i=>i.name===e.name),"camView"]:[]},onChange:()=>this.refreshUi(),children:["top","bottom","front","back","left","right"].map(e=>({label:e,value:e}))}]]}}async onAdded(e){var i,s;await super.onAdded(e),this._picking=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("Picking"),(s=this._picking)===null||s===void 0||s.addEventListener("selectedObjectChanged",()=>{var a,h;(h=(a=this.uiConfig).uiRefresh)===null||h===void 0||h.call(a)}),e.addEventListener("postFrame",()=>{this._uiNeedRefresh&&this._refreshUi()}),e.addEventListener("preRender",()=>{if(this._viewer)for(const a of this.variations){const h=this._viewer.scene.getObjectByName(a.name);if(!h||h.children.length<1)return;a.selected||(a.selected=h.children[0].name||h.children[0].uuid);for(const d of h.children)d.visible=(d.name||d.uuid)===a.selected}}),e.addEventListener("postRender",()=>{if(this._viewer)for(const a of this.variations){const h=this._viewer.scene.getObjectByName(a.name);if(!h||h.children.length<1)return;for(const d of h.children)d.visible=!0}}),this.addEventListener("deserialize",async()=>{await eo(200),this.refreshUi()})}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}_refreshUi(){var e,i,s;if(this.enabled&&this._viewer){this._uiNeedRefresh=!1,Gu.RemoveAll(Af.PluginType);for(const a of this.variations){const h=this._viewer.scene.getObjectByName(a.name);h?(h.children.length<1&&console.warn("SwitchNode does not have enough children",a),Gu.Create(Af.PluginType,a.title,Math.min(5,h.children.length),20,0,h.children.map(d=>{const b=a.camView,X=new _.Pa4((b.includes("right")?1:0)-(b.includes("left")?1:0),(b.includes("top")?1:0)-(b.includes("bottom")?1:0),(b.includes("front")?1:0)-(b.includes("back")?1:0));a.camDistance||(a.camDistance=1);const $=i1(this._viewer,d,void 0,7,X.multiplyScalar(.5*a.camDistance));return{id:d.uuid,image:$,onClick:()=>{var Z;a.selected=d.name||d.uuid,(Z=this._viewer)===null||Z===void 0||Z.scene.setDirty({sceneUpdate:!0,frameFade:!0})},tooltip:d.name||d.uuid}}),(d,b)=>C1(d,{placement:"bottom",content:b.tooltip}))):console.warn("no object found for variation, skipping",a)}Gu.RebuildUi((e=this._viewer)===null||e===void 0?void 0:e.container),(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i)}}}Af.PluginType="SwitchNodePlugin",function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);h>3&&d&&Object.defineProperty(e,i,d)}([kt()],Af.prototype,"variations",void 0);class M1 extends _.u9r{constructor(e,i,s=32,a=64,h=!1,d=new _.FM8(1,1),b="shape"){super(),this.type="TubeShapeGeometry",this.parameters={path:i,shape:e,shapeSegments:s,tubularSegments:a,closed:h,primary:b,shapeScale:d.clone()};const X=i.computeFrenetFrames(a,h);this.frames=X;const $=new _.Pa4,Z=new _.Pa4,re=new _.Pa4,le=new _.FM8;let he=new _.Pa4;const fe=[],me=[],Ee=[],Ae=e.getSpacedPoints(s);for(const Pe of Ae)Pe.multiply(d);(function(){for(let Pe=0;Pe<a;Pe++)ge(Pe);ge(h===!1?a:0),function(){for(let Pe=0;Pe<=a;Pe++)for(let Be=0;Be<=s;Be++)le.x=Pe/a,le.y=Be/s,me.push(le.x,le.y)}(),function(){const Pe=b==="shape",Be=Pe?s:a,Oe=Pe?a:s;for(let Fe=1;Fe<=Be;Fe++)for(let Xe=1;Xe<=Oe;Xe++){const[at,mt]=Pe?[Xe,Fe]:[Fe,Xe],wt=(s+1)*(at-1)+(mt-1),At=(s+1)*at+(mt-1),Tt=(s+1)*at+mt,yt=(s+1)*(at-1)+mt;Ee.push(wt,At,yt),Ee.push(At,Tt,yt)}}()})(),this.setIndex(Ee),this.setAttribute("position",new _.a$l(fe,3)),this.setAttribute("uv",new _.a$l(me,2)),this.computeVertexNormals();const ye=this.attributes.normal;function ge(Pe){he=i.getPointAt(Pe/a,he);const Be=X.normals[Pe],Oe=X.binormals[Pe];for(let Fe=0;Fe<=s;Fe++){const Xe=Ae[Fe%s];Z.set(0,0,0).addScaledVector(Be,Xe.x).addScaledVector(Oe,Xe.y),$.copy(he).add(Z),fe.push($.x,$.y,$.z)}}(function(){for(let Be=1;Be<s;Be++){const Oe=Be+a*(s+1);Z.fromBufferAttribute(ye,Be),re.fromBufferAttribute(ye,Oe),Z.add(re).normalize(),ye.setXYZ(Be,Z.x,Z.y,Z.z),ye.setXYZ(Oe,Z.x,Z.y,Z.z)}for(let Be=1;Be<a;Be++){const Oe=Be*(s+1),Fe=Oe+s;Z.fromBufferAttribute(ye,Oe),re.fromBufferAttribute(ye,Fe),Z.add(re).normalize(),ye.setXYZ(Oe,Z.x,Z.y,Z.z),ye.setXYZ(Fe,Z.x,Z.y,Z.z)}Z.fromBufferAttribute(ye,0),re.fromBufferAttribute(ye,s),Z.add(re);const Pe=a*(s+1);re.fromBufferAttribute(ye,Pe),Z.add(re),re.fromBufferAttribute(ye,Pe+s),Z.add(re),Z.normalize(),ye.setXYZ(0,Z.x,Z.y,Z.z),ye.setXYZ(s,Z.x,Z.y,Z.z),ye.setXYZ(Pe,Z.x,Z.y,Z.z),ye.setXYZ(Pe+s,Z.x,Z.y,Z.z),ye.needsUpdate=!0})()}createSplits(e){this.clearGroups();const i=this.parameters.primary==="shape"?this.parameters.shapeSegments:this.parameters.tubularSegments,s=this.index.count,a=[...e,1].sort();let h=0,d=0;for(const b of a){const X=Math.round(i*b)*s/i;this.addGroup(h,X-h,d++),h=X}return this.groups.length}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e.shape=this.parameters.shape.toJSON(),e}}var T1,yf=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let bc=T1=class extends Xi{constructor(){super(...arguments),this.enabled=!0,this.shapeSegments=32,this.tubularSegments=32,this.shapeScale=new _.FM8(1,1),this.materialSplits="0.3, 0.6",this.horizontalSplits=!0,this.extrudeCirceTube=async()=>{var c,e;const i=(e=(c=this._viewer)===null||c===void 0?void 0:c.getPlugin(br))===null||e===void 0?void 0:e.getSelectedObject();if(!i)return;let s=this._viewer.prompt("Radius: Radius for the circle","1",!0);if(!s)return;s=parseFloat(s);const a=new I1(0,0,s,s,0,2*Math.PI,!0,0);await this.extrudeObject(i,a)}}async onAdded(c){await super.onAdded(c)}static CreateCurve(c,e){var i,s;if(c==="circle")return new I1(0,0,(i=e.radius)!==null&&i!==void 0?i:1,(s=e.radius)!==null&&s!==void 0?s:1,0,2*Math.PI,!0,0);throw new Error("Unknown curve type")}async extrudeObject(c,e,i=this.shapeSegments,s=this.tubularSegments,a=this.shapeScale,h=this.materialSplits.split(",").map(b=>parseFloat(b.trim())),d=this.horizontalSplits){var b,X,$,Z,re,le,he,fe;if(c.userData.isExtrudedTube,c.userData._extrudeSource){const Pe=c.userData._extrudeSource;if(c=(b=c.parent)===null||b===void 0?void 0:b.children.find(Be=>Pe===Be.uuid),!c)return void console.warn("Could not find extrude source with uuid",Pe)}if(c.userData.extrudedObject){const Pe=c.userData.extrudedObject,Be=(X=c.parent)===null||X===void 0?void 0:X.children.find(Oe=>Pe===Oe.uuid);Be&&(Be.removeFromParent(),Be.geometry.dispose(),Be.geometry=null,Be.material=null),delete c.userData.extrudedObject}const me=c.geometry;if(!me)return void(($=this._viewer)===null||$===void 0||$.alert("Extrude: No geometry to extrude"));const Ee=[c.material];let Ae;try{const Pe=T1.ConvertGeometryToFlatShape(me);Ae=new M1(Pe,e,i,s,!0,a,d?"shape":"path"),Ae.computeBoundingBox(),Ae.createSplits(h)}catch(Pe){return void((Z=this._viewer)===null||Z===void 0||Z.alert(typeof Pe=="string"?Pe:Pe==null?void 0:Pe.message))}Ee[0].color.set(16777215);for(let Pe=Ee.length;Pe<Ae.groups.length;Pe++){const Be=Ee[0].clone();Ee.push(Be),Be.color.set(16777215*Math.random())}const ye=new _.Kj0(Ae,Ee);ye.userData._extrudeSource=c.uuid,ye.userData.isExtrudedTube=!0,c.visible=!1,c.userData.bboxVisible=!1,ye.name=c.name+"_extruded";const ge=await((he=(le=(re=this._viewer)===null||re===void 0?void 0:re.getManager())===null||le===void 0?void 0:le.importer)===null||he===void 0?void 0:he.processImportedSingle(ye,{autoCenter:!1,autoScale:!1}));ge&&((fe=c.parent)===null||fe===void 0||fe.add(ge.modelObject),c.userData.extrudedObject=ge.modelObject.uuid,ge.dispatchEvent({type:"select",ui:!0,value:ge}))}static ExtrudeShape(c,e,i,s,a,h,d,b){const X=new M1(c,s,e,i,!0,new _.FM8(a,h),b?"shape":"path");X.computeBoundingBox(),X.createSplits(d);const $=new _.Kj0(X,[]);return $.userData.isExtrudedTube=!0,$}static ConvertGeometryToFlatShape(c,e=!0){if(c.userData.__planarShape)return c.userData.__planarShape;let i=c.attributes.position;if(!i)throw"no position attribute";if(i.count>500)throw"too large to extrude";const s=c;i=s.attributes.position,s.boundingBox||s.computeBoundingBox();const a=s.boundingBox.getSize(new _.Pa4),h=a.x<.001?"x":a.y<.001?"y":a.z<.001?"z":null;if(!h)throw"geometry is not axis aligned not planar";let d=[];for(let X=0;X<i.count;X++){const $=new _.FM8;h==="x"?$.set(i.getY(X),i.getZ(X)):h==="y"?$.set(i.getX(X),i.getZ(X)):$.set(i.getX(X),i.getY(X)),d.push($)}if(e){let X=0;for(let $=0;$<d.length;$++)(d[$].x<d[X].x||d[$].x===d[X].x&&d[$].y<d[X].y)&&(X=$);X!==0&&(d=d.slice(X).concat(d.slice(0,X)))}const b=new _.bnF(d);return c.userData.__planarShape=b,b}};bc.PluginType="ShapeTubeExtrudePlugin",yf([Xn("Enabled")],bc.prototype,"enabled",void 0),yf([ai("Shape Segments (X)",[1,100],1,c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(br))===null||i===void 0)&&i.getSelectedObject())}}))],bc.prototype,"shapeSegments",void 0),yf([ai("Tube Segments (Y)",[1,100],1,c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(br))===null||i===void 0)&&i.getSelectedObject())}}))],bc.prototype,"tubularSegments",void 0),yf([fo("Shape scale",[.01,10],.01,c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(br))===null||i===void 0)&&i.getSelectedObject())}}))],bc.prototype,"shapeScale",void 0),yf([cr("Material Splits",c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(br))===null||i===void 0)&&i.getSelectedObject())}}))],bc.prototype,"materialSplits",void 0),yf([Xn("Horizontal Splits",c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(br))===null||i===void 0)&&i.getSelectedObject())}}))],bc.prototype,"horizontalSplits",void 0),yf([lr("Extrude Circle Tube",c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(br))===null||i===void 0)&&i.getSelectedObject())}}))],bc.prototype,"extrudeCirceTube",void 0),bc=T1=yf([ur("Extrude Tube Shapes")],bc);class I1 extends _.Ny0{getPoint(e,i){return super.getPoint(e,i||new _.Pa4)}}class oA extends Xi{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.fromJSON=void 0,this._lastFrameTime=0,this._updaters=[],this.dependencies=[],this._fadeDisabled=!1,this.disableFrameFade=!0,this._postFrame=()=>{var i,s;if(!this._viewer)return;if(!this.enabled||Object.keys(this.animations).length<1)return this._lastFrameTime=0,void(this._fadeDisabled&&((i=this._viewer.getPluginByType("FrameFade"))===null||i===void 0||i.enable(oA.PluginType),this._fadeDisabled=!1));const a=ia()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=a-1/60);let h=a-this._lastFrameTime;this._lastFrameTime=a;const d=(s=this._viewer.getPluginByType("Progressive"))===null||s===void 0?void 0:s.postFrameConvergedRecordingDelta();if(d&&d>0&&(h=d),d!==0&&(h*=1e3,!(h<=.001)&&(this._updaters.forEach(b=>{let X=h;b.time+X<0&&(X=-b.time),b.time+=X,Math.abs(X)>.001&&b.u(X)}),!this._fadeDisabled&&this.disableFrameFade))){const b=this._viewer.getPluginByType("FrameFade");b&&(b.disable(oA.PluginType),this._fadeDisabled=!0)}},this.defaultDriver=i=>({start:()=>this._updaters.push({u:i,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(s=>s.u===i),1)}),this.animations={},this.enabled=e,this._postFrame=this._postFrame.bind(this)}async onAdded(e){await super.onAdded(e),e.addEventListener("postFrame",this._postFrame)}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),super.onRemove(e)}animate(e){const i=Ms(),s={id:i,options:e,stop:()=>{var a,h,d;!((a=this.animations[i])===null||a===void 0)&&a._stop?(d=(h=this.animations[i])===null||h===void 0?void 0:h._stop)===null||d===void 0||d.call(h):console.warn("Animation not started")}};return this.animations[i]=s,s.promise=new Promise((a,h)=>{const d={driver:this.defaultDriver,onComplete:()=>{var X;(X=e.onComplete)===null||X===void 0||X.call(e),a()},onStop:()=>{var X;(X=e.onStop)===null||X===void 0||X.call(e),a()},...e},b=zp(d);this.animations[i]._stop=b.stop,this.animations[i].options=d}).then(()=>(delete this.animations[i],i)),this.animations[i]}async animateAsync(e){return this.animate(e).promise}}oA.PluginType="PopmotionPlugin";const kI=async c=>Pa(await(await fetch(c)).blob());async function JC(c,e=kI){const i=c.match(/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)/g);if(i)for(const s of i){const a=await e(s);c=c.replace(s,a)}return c}function D1(c,e,{width:i,height:s},a=!0){const h=`
<svg viewBox="0 0 ${i} ${s}" xmlns="http://www.w3.org/2000/svg">
    <style>
    ${e}
    </style>
    <foreignObject x="0" y="0" width="100%" height="100%">
        <div xmlns="http://www.w3.org/1999/xhtml" style="height: 100%; width: 100%; position: absolute: top:0; left:0">
            ${c}
        </div>
    </foreignObject>
</svg>
    `;return a?_t(h):h}async function OI(c,e,i){const s=D1(c,e,i);return await s1(s,i)}async function LI(c,e,i){const s=D1(c,e,i);return await eC(s,i)}var P1,qu,no=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};const dl=c=>({onChange:e=>{e.last&&c.onChange()}});let Jo=P1=class{constructor(){this.text="Custom Text",this.fontSize=100,this.width=1024,this.height=1024,this.xOffset=0,this.yOffset=0,this.boxWidth=1024,this.boxHeight=1024,this.fontFamily="",this.fontPath="",this.maskText=!1,this.innerShadow=!1,this.textColor="#000000",this.bgFillColor="#ffffff",this.svgBackground="#ffffff",this.onChange=()=>{}}set(c){Object.assign(this,c)}reset(){const c=this.onChange;Object.assign(this,new P1),this.onChange=c}toJSON(){return{text:this.text,fontFamily:this.fontFamily,fontPath:this.fontPath,svgBackground:this.svgBackground,width:this.width,height:this.height,xOffset:this.xOffset,yOffset:this.yOffset,boxWidth:this.boxWidth,boxHeight:this.boxHeight,fontSize:this.fontSize,maskText:this.maskText,innerShadow:this.innerShadow,bgFillColor:this.bgFillColor,textColor:this.textColor}}};no([cr("Text",dl)],Jo.prototype,"text",void 0),no([ai("Font Size",[2,400],1,dl)],Jo.prototype,"fontSize",void 0),no([ai("Width",[2,4096],1,dl)],Jo.prototype,"width",void 0),no([ai("Height",[2,4096],1,dl)],Jo.prototype,"height",void 0),no([ai("X Offset",[-1024,1024],1,dl)],Jo.prototype,"xOffset",void 0),no([ai("Y Offset",[-1024,1024],1,dl)],Jo.prototype,"yOffset",void 0),no([ai("V-Width",[2,4096],1,dl)],Jo.prototype,"boxWidth",void 0),no([ai("V-Height",[2,4096],1,dl)],Jo.prototype,"boxHeight",void 0),no([cr("Font",dl)],Jo.prototype,"fontFamily",void 0),no([cr("Font Url",dl)],Jo.prototype,"fontPath",void 0),no([Xn("Mask Text",dl)],Jo.prototype,"maskText",void 0),no([Xn("Inner Shadow",dl)],Jo.prototype,"innerShadow",void 0),no([ml("Text Color",dl)],Jo.prototype,"textColor",void 0),no([ml("BG Fill",dl)],Jo.prototype,"bgFillColor",void 0),no([ml("SVG BG",dl)],Jo.prototype,"svgBackground",void 0),Jo=P1=no([ur("Text SVG Options")],Jo);const $C={woff:"woff",woff2:"woff2",ttf:"truetype",otf:"opentype",eot:"embedded-opentype"},aA=c=>({hidden:()=>{const e=c.getSelected();return!e||!e.userData[wc.PluginType]}});let wc=qu=class extends Xi{constructor(){super(),this.enabled=!0,this.getSelected=()=>{var c,e;return(e=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Picking"))===null||e===void 0?void 0:e.getSelectedObject()},this.options=new Jo,this.applyToMap=!0,this.applyToBumpMap=!1,this.applyToAlphaMap=!0,this.inverseAlphaMap=!1,this._lastMeta=void 0,this.fonts={roboto:"https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2"},this._assetLoadOptions=void 0,this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this.addTextToSelected=this.addTextToSelected.bind(this),this._paramsChanged=this._paramsChanged.bind(this),this.options.onChange=this._paramsChanged}async onAdded(c){var e;await super.onAdded(c),(e=c.getPluginByType("Picking"))===null||e===void 0||e.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}_selectedObjectChanged(){var c,e,i,s,a,h;if(!this.enabled)return;const d=this.getSelected();if(!d)return void((e=(c=this.uiConfig).uiRefresh)===null||e===void 0||e.call(c,"postFrame",!0));const b=d.userData[qu.PluginType];if(!b)return this.options.reset(),this._lastMeta=void 0,void((s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0));this._lastMeta!==b&&(this.options.set(b),this._lastMeta=b),(h=(a=this.uiConfig).uiRefresh)===null||h===void 0||h.call(a,"postFrame",!0)}_paramsChanged(){if(!this.enabled)return;const c=this.getSelected();c&&c.isMesh&&c.userData[qu.PluginType]&&this.updateText(c,this.options.toJSON())}async addTextToSelected(){var c;const e=this.getSelected();e&&e.isMesh?e.material?(e.userData[qu.PluginType]||!e.material.map||await((c=this._viewer)===null||c===void 0?void 0:c.confirm("Add Text: This mesh already has a texture. Adding text will replace the texture. Continue?")))&&await this.addText(e):console.error("no material on mesh"):console.error("no mesh is selected")}async addText(c,e){return this.updateText(c,Object.assign(this.options.toJSON(),e))}async updateText(c,e){var i,s;if(!c.isMesh)return;if(!c.material)return void console.error("updateText: no material on mesh");let a=c.userData[qu.PluginType];a||(c.userData[qu.PluginType]=a={}),Object.assign(a,e);const h=c.material;h.map&&(h.map._isSimpleTextTexture&&h.map.dispose(),h.map=void 0),h.alphaMap&&(h.alphaMap._isSimpleTextTexture&&h.alphaMap.dispose(),h.alphaMap=void 0),h.bumpMap&&(h.bumpMap._isSimpleTextTexture&&h.bumpMap.dispose(),h.bumpMap=void 0);const d=await this.makeTextSvg(a);this.applyToMap&&(h.map=d),this.applyToAlphaMap&&(h.alphaMap=d,h.transparent=!0),this.applyToBumpMap&&(h.bumpMap=d),h.userData.inverseAlphaMap=this.inverseAlphaMap,h.setDirty(),h.needsUpdate=!0,(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)}async makeTextSvg(c){const e=c.fontFamily||"Arial",i=c.fontPath||this.fonts[e]||"";let s=c.style;if(i.length>0){const d=i.split("?")[0].split(".").pop()||"woff";s+=`
`+(i.length>0?`
            @font-face {
                font-family: ${e};
                src: url(${i}) format(${$C[d]||d});
            }`:"")}let a=function({text:d="Custom Text",svgBackground:b="#ffffff",xOffset:X=0,yOffset:$=0,width:Z=1024,height:re=1024,boxWidth:le=1024,boxHeight:he=1024,fontFamily:fe="",fontSize:me=32,maskText:Ee=!0,innerShadow:Ae=!0,bgFillColor:ye="#000000",textColor:ge="#ffffff",style:Pe=""}){return`
<svg style="background-color:${b}" width="${Z}" height="${re}" viewBox="0 0 ${le} ${he}"
 xmlns="http://www.w3.org/2000/svg"
 xmlns:xlink="http://www.w3.org/1999/xlink">
     <defs>
        <style>
        ${Pe}
        </style>
    </defs>

    <g style="overflow:hidden; text-anchor: middle; font-size: ${me}px; font-family: ${fe||"Arial"}">
        <defs>

`+(Ee?`
<mask id="textMask">
<text style="fill:white; font-size: ${me}px;" x="${X+le/2}" y="${he/2+$+me/4}" > ${d} </text>
</mask>
`:"")+`

`+(Ae?`
<filter id="innerShadow" x="-20%" y="-20%" width="140%" height="140%">
<feGaussianBlur in="SourceGraphic" stdDeviation="0.5" result="blur"/>
<feOffset in="blur" dx="1.5" dy="1.5"/>
</filter>
`:"")+`

        </defs>

`+(Ee?`
        <g mask="url(#textMask)">
`:"")+`

        <rect x="0" y="0" width="${le}" height="${he}" style="fill:${ye}"/>
        <text style="${Ae?"filter: url(#innerShadow);":""} fill:${ge};" x="${X+le/2}" y="${he/2+$+me/4}"> ${d} </text>

`+(Ee?`
        </g>
`:"")+`

    </g>
</svg>
`}({...c,fontFamily:e,style:s});a=await JC(a,async d=>this._getAssetData(d)),a=_t(a);const h=await this._viewer.getManager().importer.importSinglePath(a,{generateMipmaps:!1,minFilter:_.wem});return h._isSimpleTextTexture=!0,h.flipY=!1,h.needsUpdate=!0,h}async _getAssetData(c){var e,i;if(c.startsWith("http://www.w3.org"))return c;const s=(i=(e=this._viewer)===null||e===void 0?void 0:e.getManager())===null||i===void 0?void 0:i.importer;if(!s)throw new Error("no importer");this._assetLoadOptions=this._assetLoadOptions||{fileHandler:new rb(s.loadingManager),processImported:!1};try{return await s.importPath(c,this._assetLoadOptions)}catch(a){return console.error(a),""}}};wc.PluginType="SimpleTextPlugin",no([vr(void 0,{params:aA})],wc.prototype,"options",void 0),no([Xn("Apply Map",aA),lt(qu.prototype._paramsChanged)],wc.prototype,"applyToMap",void 0),no([Xn("Apply Bump Map",aA),lt(qu.prototype._paramsChanged)],wc.prototype,"applyToBumpMap",void 0),no([Xn("Apply Alpha Map",aA),lt(qu.prototype._paramsChanged)],wc.prototype,"applyToAlphaMap",void 0),no([Xn("Invert Alpha Map",aA),lt(qu.prototype._paramsChanged)],wc.prototype,"inverseAlphaMap",void 0),no([lr("Add Text",c=>({hidden:()=>!c.getSelected()}))],wc.prototype,"addTextToSelected",null),wc=qu=no([ur("Simple Text")],wc);class R1{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y,this.array[this.top++]=e.z}}class NI{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y}}class Gh{constructor(e){this.plane=null,this.front=null,this.back=null,this.polygons=[],e&&this.build(e)}clone(){const e=new Gh;return e.plane=this.plane&&this.plane.clone(),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.polygons=this.polygons.map(i=>i.clone()),e}invert(){for(let i=0;i<this.polygons.length;i++)this.polygons[i].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();const e=this.front;this.front=this.back,this.back=e}clipPolygons(e){if(!this.plane)return e.slice();let i=new Array,s=new Array;for(let a=0;a<e.length;a++)this.plane.splitPolygon(e[a],i,s,i,s);return this.front&&(i=this.front.clipPolygons(i)),s=this.back?this.back.clipPolygons(s):[],i.concat(s)}clipTo(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)}allPolygons(){let e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e}build(e){if(!e.length)return;this.plane||(this.plane=e[0].plane.clone());const i=[],s=[];for(let a=0;a<e.length;a++)this.plane.splitPolygon(e[a],this.polygons,this.polygons,i,s);i.length&&(this.front||(this.front=new Gh),this.front.build(i)),s.length&&(this.back||(this.back=new Gh),this.back.build(s))}}class Ul{constructor(e=0,i=0,s=0){this.x=e,this.y=i,this.z=s}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}clone(){return new Ul(this.x,this.y,this.z)}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}times(e){return this.x*=e,this.y*=e,this.z*=e,this}dividedBy(e){return this.x/=e,this.y/=e,this.z/=e,this}lerp(e,i){return this.add(new Ul().copy(e).sub(this).times(i))}unit(){return this.dividedBy(this.length())}length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}normalize(){return this.unit()}cross(e){const i=this.clone(),s=i.x,a=i.y,h=i.z,d=e.x,b=e.y,X=e.z;return this.x=a*X-h*b,this.y=h*d-s*X,this.z=s*b-a*d,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}toVector3(){return new _.Pa4(this.x,this.y,this.z)}}class rg{constructor(e,i){this.normal=e,this.w=i,this.normal=e,this.w=i}clone(){return new rg(this.normal.clone(),this.w)}flip(){this.normal.negate(),this.w=-this.w}splitPolygon(e,i,s,a,h){let d=0;const b=[];for(let X=0;X<e.vertices.length;X++){const $=this.normal.dot(e.vertices[X].pos)-this.w,Z=$<-rg.EPSILON?2:$>rg.EPSILON?1:0;d|=Z,b.push(Z)}switch(d){case 0:(this.normal.dot(e.plane.normal)>0?i:s).push(e);break;case 1:a.push(e);break;case 2:h.push(e);break;case 3:{const X=[],$=[];for(let Z=0;Z<e.vertices.length;Z++){const re=(Z+1)%e.vertices.length,le=b[Z],he=b[re],fe=e.vertices[Z],me=e.vertices[re];if(le!=2&&X.push(fe),le!=1&&$.push(le!=2?fe.clone():fe),(le|he)==3){const Ee=(this.w-this.normal.dot(fe.pos))/this.normal.dot(new Ul().copy(me.pos).sub(fe.pos)),Ae=fe.interpolate(me,Ee);X.push(Ae),$.push(Ae.clone())}}X.length>=3&&a.push(new ov(X,e.shared)),$.length>=3&&h.push(new ov($,e.shared));break}}}static fromPoints(e,i,s){const a=new Ul().copy(i).sub(e).cross(new Ul().copy(s).sub(e)).normalize();return new rg(a.clone(),a.dot(e))}}rg.EPSILON=1e-5;class ov{constructor(e,i){this.vertices=e,this.shared=i,this.plane=rg.fromPoints(e[0].pos,e[1].pos,e[2].pos)}clone(){return new ov(this.vertices.map(e=>e.clone()),this.shared)}flip(){this.vertices.reverse().map(e=>e.flip()),this.plane.flip()}}class sw{constructor(e,i,s,a){this.pos=new Ul().copy(e),this.normal=new Ul().copy(i),this.uv=new Ul().copy(s),this.uv.z=0,a&&(this.color=new Ul().copy(a))}clone(){return new sw(this.pos,this.normal,this.uv,this.color)}flip(){this.normal.negate()}interpolate(e,i){return new sw(this.pos.clone().lerp(e.pos,i),this.normal.clone().lerp(e.normal,i),this.uv.clone().lerp(e.uv,i),this.color&&e.color&&this.color.clone().lerp(e.color,i))}}class uo{constructor(){this.polygons=new Array}static fromPolygons(e){const i=new uo;return i.polygons=e,i}static fromGeometry(e,i){let s=[];const a=e.attributes.position,h=e.attributes.normal,d=e.attributes.uv,b=e.attributes.color,X=e.groups;let $;if(e.index)$=e.index.array;else{$=new Array(a.array.length/a.itemSize|0);for(let re=0;re<$.length;re++)$[re]=re}const Z=$.length/3|0;s=new Array(Z);for(let re=0,le=0,he=$.length;re<he;re+=3,le++){const fe=new Array(3);for(let me=0;me<3;me++){const Ee=$[re+me],Ae=3*Ee,ye=2*Ee,ge=a.array[Ae],Pe=a.array[Ae+1],Be=a.array[Ae+2],Oe=h.array[Ae],Fe=h.array[Ae+1],Xe=h.array[Ae+2],at=d==null?void 0:d.array[ye],mt=d==null?void 0:d.array[ye+1];fe[me]=new sw(new Ul(ge,Pe,Be),new Ul(Oe,Fe,Xe),new Ul(at,mt,0),b&&new Ul(b.array[ye],b.array[ye+1],b.array[ye+2]))}if(i===void 0&&X&&X.length>0)for(const me of X)re>=me.start&&re<me.start+me.count&&(s[le]=new ov(fe,me.materialIndex));else s[le]=new ov(fe,i)}return uo.fromPolygons(s.filter(re=>!isNaN(re.plane.normal.x)))}static toGeometry(e,i){let s=0;const a=e.polygons;for(const he of a)s+=he.vertices.length-2;const h=new _.u9r,d=new R1(3*s*3),b=new R1(3*s*3),X=new NI(2*s*3);let $;const Z=[],re=[];for(const he of a){const fe=he.vertices,me=fe.length;he.shared!==void 0&&(Z[he.shared]||(Z[he.shared]=[])),me&&fe[0].color!==void 0&&($||($=new R1(3*s*3)));for(let Ee=3;Ee<=me;Ee++)(he.shared===void 0?re:Z[he.shared]).push(d.top/3,d.top/3+1,d.top/3+2),d.write(fe[0].pos),d.write(fe[Ee-2].pos),d.write(fe[Ee-1].pos),b.write(fe[0].normal),b.write(fe[Ee-2].normal),b.write(fe[Ee-1].normal),X&&(X.write(fe[0].uv),X.write(fe[Ee-2].uv),X.write(fe[Ee-1].uv)),$&&($.write(fe[0].color),$.write(fe[Ee-2].color),$.write(fe[Ee-1].color))}h.setAttribute("position",new _.TlE(d.array,3)),h.setAttribute("normal",new _.TlE(b.array,3)),X&&h.setAttribute("uv",new _.TlE(X.array,2)),$&&h.setAttribute("color",new _.TlE($.array,3));for(let he=0;he<Z.length;he++)Z[he]===void 0&&(Z[he]=[]);if(Z.length){let he=[],fe=0;for(let me=0;me<Z.length;me++)h.addGroup(fe,Z[me].length,me),fe+=Z[me].length,he=he.concat(Z[me]);h.addGroup(fe,re.length,Z.length),he=he.concat(re),h.setIndex(he)}const le=new _.yGw().copy(i).invert();return h.applyMatrix4(le),h.computeBoundingSphere(),h.computeBoundingBox(),h}static fromMesh(e,i){const s=uo.fromGeometry(e.geometry,i),a=new _.Pa4,h=new _.Vkp;h.getNormalMatrix(e.matrix);for(let d=0;d<s.polygons.length;d++){const b=s.polygons[d];for(let X=0;X<b.vertices.length;X++){const $=b.vertices[X];$.pos.copy(a.copy($.pos.toVector3()).applyMatrix4(e.matrix)),$.normal.copy(a.copy($.normal.toVector3()).applyMatrix3(h))}}return s}static toMesh(e,i,s){const a=uo.toGeometry(e,i),h=new _.Kj0(a,s);return h.matrix.copy(i),h.matrix.decompose(h.position,h.quaternion,h.scale),h.rotation.setFromQuaternion(h.quaternion),h.updateMatrixWorld(),h.castShadow=h.receiveShadow=!0,h}static union(e,i){const s=uo.fromMesh(e),a=uo.fromMesh(i);return uo.toMesh(s.union(a),e.matrix,e.material)}static subtract(e,i){const s=uo.fromMesh(e),a=uo.fromMesh(i);return uo.toMesh(s.subtract(a),e.matrix,e.material)}static intersect(e,i){const s=uo.fromMesh(e),a=uo.fromMesh(i);return uo.toMesh(s.intersect(a),e.matrix,e.material)}clone(){const e=new uo;return e.polygons=this.polygons.map(i=>i.clone()).filter(i=>Number.isFinite(i.plane.w)),e}toPolygons(){return this.polygons}union(e){const i=new Gh(this.clone().polygons),s=new Gh(e.clone().polygons);return i.clipTo(s),s.clipTo(i),s.invert(),s.clipTo(i),s.invert(),i.build(s.allPolygons()),uo.fromPolygons(i.allPolygons())}subtract(e){const i=new Gh(this.clone().polygons),s=new Gh(e.clone().polygons);return i.invert(),i.clipTo(s),s.clipTo(i),s.invert(),s.clipTo(i),s.invert(),i.build(s.allPolygons()),i.invert(),uo.fromPolygons(i.allPolygons())}intersect(e){const i=new Gh(this.clone().polygons),s=new Gh(e.clone().polygons);return i.invert(),s.clipTo(i),s.invert(),i.clipTo(s),s.clipTo(i),i.build(s.allPolygons()),i.invert(),uo.fromPolygons(i.allPolygons())}inverse(){const e=this.clone();for(const i of e.polygons)i.flip();return e}toMesh(e,i){return uo.toMesh(this,e,i)}toGeometry(e){return uo.toGeometry(this,e)}}var av=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};const B1=["union","subtract","intersect"];class op extends Xi{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[br],this.rootMesh=new _.Kj0,this.showResult=!1,this.csgSelectedEnabled=!1,this.csgSelectedOperation="union",this._csgNeedsUpdate=!1,this._csgVisible=!1,this._sceneUpdate=this._sceneUpdate.bind(this),this._preFrame=this._preFrame.bind(this),this.makeSelectedCSGBrush=this.makeSelectedCSGBrush.bind(this),this.refreshCSG=this.refreshCSG.bind(this),this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this._updateSelectedProperties=this._updateSelectedProperties.bind(this),this.downloadObject=this.downloadObject.bind(this),this.exportObject=this.exportObject.bind(this)}async onAdded(e){var i;await super.onAdded(e),this.rootObject=await e.createObject3D(),this.rootObject.modelObject.add(this.rootMesh),e.scene.addEventListener("sceneUpdate",this._sceneUpdate),e.addEventListener("preFrame",this._preFrame),(i=e.getPlugin(br))===null||i===void 0||i.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}async makeSelectedCSGBrush(){var e,i;const s=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(br))===null||i===void 0?void 0:i.getSelectedObject();s&&s.geometry&&(s.userData._isCSGMesh||(s.userData.csgBrush||(s.userData.csgBrush={enabled:!0,operation:"union"}),this._selectedObjectChanged()))}refreshCSG(){this._sceneUpdate()}async downloadObject(){const e=await this.exportObject();e&&ts(e,"csg."+e.ext)}async exportObject(){var e,i;const s=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("AssetExporterPlugin"))===null||i===void 0?void 0:i.exporter;if(!s||!this.rootObject)return;const a=this.rootMesh.visible;this.rootMesh.visible=!0;const h=await s.exportObject(this.rootObject.modelObject,{});return this.rootMesh.visible=a,h}_updateSelectedProperties(){var e,i;const s=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(br))===null||i===void 0?void 0:i.getSelectedObject();s&&s.userData.csgBrush&&(s.userData.csgBrush.enabled=this.csgSelectedEnabled,s.userData.csgBrush.operation=this.csgSelectedOperation)}_selectedObjectChanged(){var e,i,s,a,h,d,b,X;const $=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(br))===null||i===void 0?void 0:i.getSelectedObject();$&&(this.csgSelectedEnabled=(a=(s=$.userData.csgBrush)===null||s===void 0?void 0:s.enabled)!==null&&a!==void 0&&a,this.csgSelectedOperation=(d=(h=$.userData.csgBrush)===null||h===void 0?void 0:h.operation)!==null&&d!==void 0?d:"union"),(X=(b=this.uiConfig)===null||b===void 0?void 0:b.uiRefresh)===null||X===void 0||X.call(b,"postFrame",!0)}_preFrame(){var e,i,s;if(!this.rootObject||!this._csgNeedsUpdate&&this._csgVisible===this.showResult)return;const a=this._findCSGMeshes();this._csgNeedsUpdate&&(this._csgNeedsUpdate=!1,(e=this.rootObject)===null||e===void 0||e.modelObject.updateMatrixWorld(!0),((i=this.rootMesh.userData.dispose)!==null&&i!==void 0?i:this.rootMesh.removeFromParent)(),this.rootMesh=this._buildCSGMesh(a)),this.rootMesh&&!this.rootMesh.parent&&((s=this.rootObject)===null||s===void 0||s.modelObject.add(this.rootMesh)),this.showResult?(a.forEach(h=>{h[0].visible=!1}),this.rootObject.visible=!0,this._csgVisible=!0,this.rootObject.setDirty()):(a.forEach(h=>{h[0].visible=!0}),this.rootObject.visible=!1,this._csgVisible=!1,this.rootObject.setDirty())}_findCSGMeshes(){var e;const i=[];return(e=this._viewer)===null||e===void 0||e.scene.traverse(s=>{var a;s.isMesh&&s.geometry&&(!((a=s.userData.csgBrush)===null||a===void 0)&&a.enabled)&&i.push([s,s.userData.csgBrush.operation])}),i}_sceneUpdate(e){var i,s;!((s=(i=e==null?void 0:e.object)===null||i===void 0?void 0:i.userData)===null||s===void 0)&&s._isCSGMesh||(this._csgNeedsUpdate=!0)}}av([Xn("Show Result",c=>({onChange:()=>{var e;return(e=c._viewer)===null||e===void 0?void 0:e.setDirty()}}))],op.prototype,"showResult",void 0),av([lr("Make CSG Brush",c=>({hidden:()=>{var e,i;const s=(i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(br))===null||i===void 0?void 0:i.getSelectedObject();return!(s!=null&&s.userData)||!!s.userData.csgBrush||s.userData._isCSGMesh}}))],op.prototype,"makeSelectedCSGBrush",null),av([Xn("Enabled",c=>({hidden:()=>{var e,i;const s=(i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(br))===null||i===void 0?void 0:i.getSelectedObject();return!s||!s.userData.csgBrush},onChange:c._updateSelectedProperties}))],op.prototype,"csgSelectedEnabled",void 0),av([Xs("Operation",B1.map(c=>({label:c})),c=>({hidden:()=>{var e,i;const s=(i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(br))===null||i===void 0?void 0:i.getSelectedObject();return!s||!s.userData.csgBrush},onChange:c._updateSelectedProperties}))],op.prototype,"csgSelectedOperation",void 0),av([lr("Refresh CSG")],op.prototype,"refreshCSG",null),av([lr("Export Result",c=>({hidden:()=>{var e;return!(!((e=c._viewer)===null||e===void 0)&&e.getPluginByType("AssetExporterPlugin"))}}))],op.prototype,"downloadObject",null);function ZC(c,e){let i=new uo;const s=c.map(h=>h[0].material).flatMap(h=>h);c.forEach(([h,d])=>{if(!B1.includes(d))return void console.error(`Unknown operation ${d}`);h.updateMatrix(),h.updateMatrixWorld();const b=h.matrix;h.matrix=h.matrixWorld;let X=0;X=Array.isArray(h.material)?void 0:s.indexOf(h.material),i=i[d](uo.fromMesh(h,X)),h.matrix=b});const a=i.toMesh(e??new _.yGw().identity(),s);return a.userData._isCSGMesh=!0,a.geometry.groups=a.geometry.groups.filter(h=>h.count>0),a}let ow=class extends op{_buildCSGMesh(c){return ZC(c)}};ow.PluginType="CSGPluginBSP",ow=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d}([ur("CSG Plugin (BSP)")],ow);class ap{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,i){let s=1/0,a=-1/0;for(let h=0,d=e.length;h<d;h++){const b=e[h][i];s=b<s?b:s,a=b>a?b:a}this.min=s,this.max=a}setFromPoints(e,i){let s=1/0,a=-1/0;for(let h=0,d=i.length;h<d;h++){const b=i[h],X=e.dot(b);s=X<s?X:s,a=X>a?X:a}this.min=s,this.max=a}isSeparated(e){return this.min>e.max||e.min>this.max}}ap.prototype.setFromBox=function(){const c=new _.Pa4;return function(e,i){const s=i.min,a=i.max;let h=1/0,d=-1/0;for(let b=0;b<=1;b++)for(let X=0;X<=1;X++)for(let $=0;$<=1;$++){c.x=s.x*b+a.x*(1-b),c.y=s.y*X+a.y*(1-X),c.z=s.z*$+a.z*(1-$);const Z=e.dot(c);h=Math.min(Z,h),d=Math.max(Z,d)}this.min=h,this.max=d}}();const UI=function(){const c=new _.Pa4,e=new _.Pa4,i=new _.Pa4;return function(s,a,h){const d=s.start,b=c,X=a.start,$=e;i.subVectors(d,X),c.subVectors(s.end,a.start),e.subVectors(a.end,a.start);const Z=i.dot($),re=$.dot(b),le=$.dot($),he=i.dot(b),fe=b.dot(b)*le-re*re;let me,Ee;me=fe!==0?(Z*re-he*le)/fe:0,Ee=(Z+me*re)/le,h.x=me,h.y=Ee}}(),k1=function(){const c=new _.FM8,e=new _.Pa4,i=new _.Pa4;return function(s,a,h,d){UI(s,a,c);let b=c.x,X=c.y;if(b>=0&&b<=1&&X>=0&&X<=1)return s.at(b,h),void a.at(X,d);if(b>=0&&b<=1)return X<0?a.at(0,d):a.at(1,d),void s.closestPointToPoint(d,!0,h);if(X>=0&&X<=1)return b<0?s.at(0,h):s.at(1,h),void a.closestPointToPoint(h,!0,d);{let $,Z;$=b<0?s.start:s.end,Z=X<0?a.start:a.end;const re=e,le=i;return s.closestPointToPoint(Z,!0,e),a.closestPointToPoint($,!0,i),re.distanceToSquared(Z)<=le.distanceToSquared($)?(h.copy(re),void d.copy(Z)):(h.copy($),void d.copy(le))}}}(),FI=function(){const c=new _.Pa4,e=new _.Pa4,i=new _.JOQ,s=new _.Zzh;return function(a,h){const{radius:d,center:b}=a,{a:X,b:$,c:Z}=h;if(s.start=X,s.end=$,s.closestPointToPoint(b,!0,c).distanceTo(b)<=d||(s.start=X,s.end=Z,s.closestPointToPoint(b,!0,c).distanceTo(b)<=d)||(s.start=$,s.end=Z,s.closestPointToPoint(b,!0,c).distanceTo(b)<=d))return!0;const re=h.getPlane(i);if(Math.abs(re.distanceToPoint(b))<=d){const le=re.projectPoint(b,e);if(h.containsPoint(le))return!0}return!1}}();function lv(c){return Math.abs(c)<1e-15}class Qh extends _.CJI{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new _.Pa4),this.satBounds=new Array(4).fill().map(()=>new ap),this.points=[this.a,this.b,this.c],this.sphere=new _.aLr,this.plane=new _.JOQ,this.needsUpdate=!0}intersectsSphere(e){return FI(e,this)}update(){const e=this.a,i=this.b,s=this.c,a=this.points,h=this.satAxes,d=this.satBounds,b=h[0],X=d[0];this.getNormal(b),X.setFromPoints(b,a);const $=h[1],Z=d[1];$.subVectors(e,i),Z.setFromPoints($,a);const re=h[2],le=d[2];re.subVectors(i,s),le.setFromPoints(re,a);const he=h[3],fe=d[3];he.subVectors(s,e),fe.setFromPoints(he,a),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(b,e),this.needsUpdate=!1}}Qh.prototype.closestPointToSegment=function(){const c=new _.Pa4,e=new _.Pa4,i=new _.Zzh;return function(s,a=null,h=null){const{start:d,end:b}=s,X=this.points;let $,Z=1/0;for(let re=0;re<3;re++){const le=(re+1)%3;i.start.copy(X[re]),i.end.copy(X[le]),k1(i,s,c,e),$=c.distanceToSquared(e),$<Z&&(Z=$,a&&a.copy(c),h&&h.copy(e))}return this.closestPointToPoint(d,c),$=d.distanceToSquared(c),$<Z&&(Z=$,a&&a.copy(c),h&&h.copy(d)),this.closestPointToPoint(b,c),$=b.distanceToSquared(c),$<Z&&(Z=$,a&&a.copy(c),h&&h.copy(b)),Math.sqrt(Z)}}(),Qh.prototype.intersectsTriangle=function(){const c=new Qh,e=new Array(3),i=new Array(3),s=new ap,a=new ap,h=new _.Pa4,d=new _.Pa4,b=new _.Pa4,X=new _.Pa4,$=new _.Zzh,Z=new _.Zzh,re=new _.Zzh;return function(le,he=null){this.needsUpdate&&this.update(),le.isExtendedTriangle?le.needsUpdate&&le.update():(c.copy(le),c.update(),le=c);const fe=this.plane,me=le.plane;if(Math.abs(fe.normal.dot(me.normal))>1-1e-10){const Ee=this.satBounds,Ae=this.satAxes;i[0]=le.a,i[1]=le.b,i[2]=le.c;for(let Pe=0;Pe<4;Pe++){const Be=Ee[Pe],Oe=Ae[Pe];if(s.setFromPoints(Oe,i),Be.isSeparated(s))return!1}const ye=le.satBounds,ge=le.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let Pe=0;Pe<4;Pe++){const Be=ye[Pe],Oe=ge[Pe];if(s.setFromPoints(Oe,e),Be.isSeparated(s))return!1}for(let Pe=0;Pe<4;Pe++){const Be=Ae[Pe];for(let Oe=0;Oe<4;Oe++){const Fe=ge[Oe];if(h.crossVectors(Be,Fe),s.setFromPoints(h,e),a.setFromPoints(h,i),s.isSeparated(a))return!1}}return he&&(console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),he.start.set(0,0,0),he.end.set(0,0,0)),!0}{const Ee=this.points;let Ae=!1,ye=0;for(let At=0;At<3;At++){const Tt=Ee[At],yt=Ee[(At+1)%3];$.start.copy(Tt),$.end.copy(yt),$.delta(d);const St=Ae?Z.start:Z.end,Ft=lv(me.distanceToPoint(Tt));if(lv(me.normal.dot(d))&&Ft){Z.copy($),ye=2;break}if((me.intersectLine($,St)||Ft)&&!lv(St.distanceTo(yt))){if(ye++,Ae)break;Ae=!0}}if(ye===1&&this.containsPoint(Z.start))return he&&(he.start.copy(Z.start),he.end.copy(Z.start)),!0;if(ye!==2)return!1;const ge=le.points;let Pe=!1,Be=0;for(let At=0;At<3;At++){const Tt=ge[At],yt=ge[(At+1)%3];$.start.copy(Tt),$.end.copy(yt),$.delta(b);const St=Pe?re.start:re.end,Ft=lv(fe.distanceToPoint(Tt));if(lv(fe.normal.dot(b))&&Ft){re.copy($),Be=2;break}if((fe.intersectLine($,St)||Ft)&&!lv(St.distanceTo(yt))){if(Be++,Pe)break;Pe=!0}}if(Be===1&&this.containsPoint(re.start))return he&&(he.start.copy(re.start),he.end.copy(re.start)),!0;if(Be!==2)return!1;if(Z.delta(d),re.delta(b),d.dot(b)<0){let At=re.start;re.start=re.end,re.end=At}const Oe=Z.start.dot(d),Fe=Z.end.dot(d),Xe=re.start.dot(d),at=re.end.dot(d),mt=Fe<Xe,wt=Oe<at;return(Oe===at||Xe===Fe||mt!==wt)&&(he&&(X.subVectors(Z.start,re.start),X.dot(d)>0?he.start.copy(Z.start):he.start.copy(re.start),X.subVectors(Z.end,re.end),X.dot(d)<0?he.end.copy(Z.end):he.end.copy(re.end)),!0)}}}(),Qh.prototype.distanceToPoint=function(){const c=new _.Pa4;return function(e){return this.closestPointToPoint(e,c),e.distanceTo(c)}}(),Qh.prototype.distanceToTriangle=function(){const c=new _.Pa4,e=new _.Pa4,i=["a","b","c"],s=new _.Zzh,a=new _.Zzh;return function(h,d=null,b=null){const X=d||b?s:null;if(this.intersectsTriangle(h,X))return(d||b)&&(d&&X.getCenter(d),b&&X.getCenter(b)),0;let $=1/0;for(let Z=0;Z<3;Z++){let re;const le=i[Z],he=h[le];this.closestPointToPoint(he,c),re=he.distanceToSquared(c),re<$&&($=re,d&&d.copy(c),b&&b.copy(he));const fe=this[le];h.closestPointToPoint(fe,c),re=fe.distanceToSquared(c),re<$&&($=re,d&&d.copy(fe),b&&b.copy(c))}for(let Z=0;Z<3;Z++){const re=i[Z],le=i[(Z+1)%3];s.set(this[re],this[le]);for(let he=0;he<3;he++){const fe=i[he],me=i[(he+1)%3];a.set(h[fe],h[me]),k1(s,a,c,e);const Ee=c.distanceToSquared(e);Ee<$&&($=Ee,d&&d.copy(c),b&&b.copy(e))}}return Math.sqrt($)}}();class eM{constructor(){this.intersectionSet={},this.ids=[]}add(e,i){const{intersectionSet:s,ids:a}=this;s[e]||(s[e]=[],a.push(e)),s[e].push(i)}}const sg=new _.zHn,tM=new _.yGw,pl=new _.CJI,lp=new _.Pa4,nM=new _.Ltg,iM=new _.Ltg,rM=new _.Ltg,O1=new _.Ltg,aw=new _.Ltg,lw=new _.Ltg,L1=new _.Zzh,N1=1e-8;let cw=null;function sM(c){cw=c}function oM(c,e){function i(){return Math.random()-.5}sg.origin.copy(c.a).add(c.b).add(c.c).multiplyScalar(1/3),c.getNormal(sg.direction);let s=0,a=1/0;for(let h=0;h<3;h++){sg.direction.x+=i()*N1,sg.direction.y+=i()*N1,sg.direction.z+=i()*N1;const d=e.raycastFirst(sg,_.ehD);if(d&&sg.direction.dot(d.face.normal)>0&&s++,d!==null&&(a=Math.min(a,d.distance)),a===0||s/3>.5||(h-s+1)/3>.5)break}return a===0?0:s/3>.5?-1:1}function aM(c,e,i,s,a,h,d=!1){const b=i.attributes,X=i.index,$=3*c,Z=X.getX($+0),re=X.getX($+1),le=X.getX($+2);for(const he in h){const fe=b[he],me=h[he];if(!(he in b))throw new Error(`CSG Operations: Attribute ${he} not available on geometry.`);const Ee=fe.itemSize;he==="position"?(pl.a.fromBufferAttribute(fe,Z).applyMatrix4(s),pl.b.fromBufferAttribute(fe,re).applyMatrix4(s),pl.c.fromBufferAttribute(fe,le).applyMatrix4(s),U1(pl.a,pl.b,pl.c,e,3,me,d)):he==="normal"?(pl.a.fromBufferAttribute(fe,Z).applyNormalMatrix(a),pl.b.fromBufferAttribute(fe,re).applyNormalMatrix(a),pl.c.fromBufferAttribute(fe,le).applyNormalMatrix(a),d&&(pl.a.multiplyScalar(-1),pl.b.multiplyScalar(-1),pl.c.multiplyScalar(-1)),U1(pl.a,pl.b,pl.c,e,3,me,d,!0)):(nM.fromBufferAttribute(fe,Z),iM.fromBufferAttribute(fe,re),rM.fromBufferAttribute(fe,le),U1(nM,iM,rM,e,Ee,me,d))}}function lM(c,e,i,s,a,h,d,b=!1){F1(c,s,a,h,d,b),F1(e,s,a,h,d,b),F1(i,s,a,h,d,b)}function cM(c,e,i=!1){switch(c){case 0:if(e===1||e===0&&i)return 1;break;case 1:if(i){if(e===-1)return 0}else if(e===1)return 1;break;case 3:if(e===-1)return 0;if(e===1)return 1;case 4:if(e===-1||e===0&&i)return 1;break;default:throw new Error(`Unrecognized CSG operation enum "${c}".`)}return 2}function U1(c,e,i,s,a,h,d=!1,b=!1){const X=$=>{h.push($.x),a>1&&h.push($.y),a>2&&h.push($.z),a>3&&h.push($.w)};O1.set(0,0,0,0).addScaledVector(c,s.a.x).addScaledVector(e,s.a.y).addScaledVector(i,s.a.z),aw.set(0,0,0,0).addScaledVector(c,s.b.x).addScaledVector(e,s.b.y).addScaledVector(i,s.b.z),lw.set(0,0,0,0).addScaledVector(c,s.c.x).addScaledVector(e,s.c.y).addScaledVector(i,s.c.z),b&&(O1.normalize(),aw.normalize(),lw.normalize()),X(O1),d?(X(lw),X(aw)):(X(aw),X(lw))}function F1(c,e,i,s,a,h=!1){for(const d in a){const b=e[d],X=a[d];if(!(d in e))throw new Error(`CSG Operations: Attribute ${d} no available on geometry.`);const $=b.itemSize;d==="position"?(lp.fromBufferAttribute(b,c).applyMatrix4(i),X.push(lp.x,lp.y,lp.z)):d==="normal"?(lp.fromBufferAttribute(b,c).applyNormalMatrix(s),h&&lp.multiplyScalar(-1),X.push(lp.x,lp.y,lp.z)):(X.push(b.getX(c)),$>1&&X.push(b.getY(c)),$>2&&X.push(b.getZ(c)),$>3&&X.push(b.getW(c)))}}const bf=1e-14,uw=1e-7,Hh=new _.Zzh,Co=new _.Zzh,Yu=new _.Pa4,uM=new _.Pa4,lA=new _.JOQ,jI=new Qh;function cA(c){return c.a.distanceToSquared(c.b)<bf||c.a.distanceToSquared(c.c)<bf||c.b.distanceToSquared(c.c)<bf}class zI extends _.CJI{constructor(...e){super(...e),this.side=null,this.originalSide=null,this.coplanarCount=0}init(){this.side=null,this.originalSide=null,this.coplanarCount=0}initFrom(e){this.side=e.side,this.originalSide=e.originalSide,this.coplanarCount=e.coplanarCount}updateSide(e,i=null,s=-1){if(this.originalSide!==null&&this.side===null)return;Yu.copy(this.a).add(this.b).add(this.c).multiplyScalar(1/3);const a=e.distanceToPoint(Yu)<0?-1:1;i&&s!==-1?a===1&&(this.coplanarCount++,this.coplanarCount===3&&(this.side=0)):(this.originalSide===null&&(this.originalSide=a,this.side=a),a!==this.side&&(this.side=null))}}class VI{constructor(){this._pool=[],this._index=0}getTriangle(){this._index>=this._pool.length&&this._pool.push(new zI);const e=this._pool[this._index++];return e.init(),e}clear(){this._index=0}reset(){this._pool.length=0,this._index=0}}class GI{constructor(){this.trianglePool=new VI,this.triangles=[],this.normal=new _.Pa4}initialize(e){const{triangles:i,trianglePool:s,normal:a}=this;if(i.length=0,s.clear(),Array.isArray(e))for(let h=0,d=e.length;h<d;h++){const b=e[h];if(h===0)b.getNormal(a);else if(Math.abs(1-b.getNormal(Yu).dot(a))>bf)throw new Error("Triangle Splitter: Cannot initialize with triangles that have different normals.");const X=s.getTriangle();X.copy(b),i.push(X)}else{e.getNormal(a);const h=s.getTriangle();h.copy(e),i.push(h)}}splitByTriangle(e){const{normal:i,triangles:s}=this;if(e.getPlane(lA),Math.abs(1-Math.abs(lA.normal.dot(i)))<uw){const a=[e.a,e.b,e.c];for(let h=0;h<3;h++){const d=(h+1)%3,b=a[h],X=a[d];Yu.subVectors(X,b).normalize(),uM.crossVectors(i,Yu),lA.setFromNormalAndCoplanarPoint(uM,b),this.splitByPlane(lA,e,h)}for(let h=0,d=s.length;h<d;h++)s[h].coplanarCount=0}else this.splitByPlane(lA,e)}splitByPlane(e,i=null,s=-1){const{triangles:a,trianglePool:h}=this;let d=null;i!==null&&(d=jI,d.copy(i),d.needsUpdate=!0);for(let b=0,X=a.length;b<X;b++){const $=a[b],{a:Z,b:re,c:le}=$;if(d&&(!d.intersectsTriangle($,Hh)||Hh.distance()<1e-5)){$.updateSide(e,d,s),$.side=null;continue}let he=0,fe=-1,me=0,Ee=0,Ae=!1;const ye=[Z,re,le];for(let ge=0;ge<3;ge++){const Pe=(ge+1)%3;Hh.start.copy(ye[ge]),Hh.end.copy(ye[Pe]);const Be=e.distanceToPoint(Hh.start),Oe=e.distanceToPoint(Hh.end);Math.abs(Be)<bf?Ee++:Be>0&&me++,Math.abs(Be)<uw&&Math.abs(Oe)<uw&&(Ae=!0);let Fe=!!e.intersectLine(Hh,Yu);!Fe&&Math.abs(Oe)<bf&&(Yu.copy(Hh.end),Fe=!0),!Fe||Yu.distanceTo(Hh.start)<bf||(Yu.distanceTo(Hh.end)<bf&&(fe=ge),he===0?Co.start.copy(Yu):Co.end.copy(Yu),he++)}if(!Ae&&Ee<2&&he===2&&Co.distance()>uw)if(fe!==-1){fe=(fe+1)%3;let ge=0;ge===fe&&(ge=(ge+1)%3);let Pe=ge+1;Pe===fe&&(Pe=(Pe+1)%3);const Be=h.getTriangle();Be.a.copy(ye[Pe]),Be.b.copy(Co.end),Be.c.copy(Co.start),cA(Be)||(a.push(Be),Be.initFrom($),Be.updateSide(e,d,s)),$.a.copy(ye[ge]),$.b.copy(Co.start),$.c.copy(Co.end),cA($)?(a.splice(b,1),b--,X--):$.updateSide(e,d,s)}else{const ge=ye.findIndex(Xe=>me>=2?e.distanceToPoint(Xe)<0:e.distanceToPoint(Xe)>0);if(ge===0){let Xe=Co.start;Co.start=Co.end,Co.end=Xe}else if(ge===-1)continue;const Pe=(ge+1)%3,Be=(ge+2)%3,Oe=h.getTriangle(),Fe=h.getTriangle();ye[Pe].distanceToSquared(Co.start)<ye[Be].distanceToSquared(Co.end)?(Oe.a.copy(ye[Pe]),Oe.b.copy(Co.start),Oe.c.copy(Co.end),Fe.a.copy(ye[Pe]),Fe.b.copy(ye[Be]),Fe.c.copy(Co.start)):(Oe.a.copy(ye[Be]),Oe.b.copy(Co.start),Oe.c.copy(Co.end),Fe.a.copy(ye[Pe]),Fe.b.copy(ye[Be]),Fe.c.copy(Co.end)),$.a.copy(ye[ge]),$.b.copy(Co.end),$.c.copy(Co.start),cA(Oe)||(a.push(Oe),Oe.initFrom($),Oe.updateSide(e,d,s)),cA(Fe)||(a.push(Fe),Fe.initFrom($),Fe.updateSide(e,d,s)),cA($)?(a.splice(b,1),b--,X--):$.updateSide(e,d,s)}else he===3&&console.warn("TriangleClipper: Coplanar clip not handled")}}reset(){this.triangles.length=0}}function hM(){return typeof SharedArrayBuffer<"u"}function QI(c){if(c.buffer instanceof SharedArrayBuffer)return c;const e=c.constructor,i=c.buffer,s=new SharedArrayBuffer(i.byteLength),a=new Uint8Array(i);return new Uint8Array(s).set(a,0),new e(s)}class dM{constructor(e,i=500){const s=hM()?SharedArrayBuffer:ArrayBuffer;this.expansionFactor=1.5,this.type=e,this.array=new e(new s(i*e.BYTES_PER_ELEMENT)),this.length=0}expand(e=null){const{type:i,array:s,expansionFactor:a}=this;e===null&&(e=~~(s.length*a));const h=new i(e);h.set(s,0),this.array=h}push(...e){let{array:i,length:s}=this;s+e.length>i.length&&(this.expand(),i=this.array);for(let a=0,h=e.length;a<h;a++)i[s+a]=e[a];this.length+=e.length}clear(){this.length=0}}class HI{constructor(){this.groupAttributes=[{}],this.groupCount=0}getType(e){return this.groupAttributes[0][e].type}getTotalLength(e){const{groupCount:i,groupAttributes:s}=this;let a=0;for(let h=0;h<i;h++)a+=s[h][e].length;return a}getGroupSet(e=0){const{groupAttributes:i}=this;if(i[e])return this.groupCount=Math.max(this.groupCount,e+1),i[e];const s=i[0];for(this.groupCount=Math.max(this.groupCount,e+1);e>=i.length;){const a={};i.push(a);for(const h in s)a[h]=new dM(s[h].type)}return i[e]}getGroupArray(e,i=0){const{groupAttributes:s}=this;if(!s[0][e])throw new Error(`TypedAttributeData: Attribute with "${e}" has not been initialized`);return this.getGroupSet(i)[e]}initializeArray(e,i){const{groupAttributes:s}=this,a=s[0][e];if(a){if(a.type!==i)throw new Error(`TypedAttributeData: Array ${e} already initialized with a different type.`)}else for(let h=0,d=s.length;h<d;h++)s[h][e]=new dM(i)}clear(){this.groupCount=0;const{groupAttributes:e}=this;e.forEach(i=>{for(const s in i)i[s].clear()})}delete(e){this.groupAttributes.forEach(i=>{delete i[e]})}reset(){this.groupAttributes=[]}}class WI{constructor(e){this.triangle=new _.CJI().copy(e),this.intersects={}}addTriangle(e,i){this.intersects[e]=new _.CJI().copy(i)}getIntersectArray(){const e=[],{intersects:i}=this;for(const s in i)e.push(i[s]);return e}}class pM{constructor(){this.data={}}addTriangleIntersection(e,i,s,a){const{data:h}=this;h[e]||(h[e]=new WI(i)),h[e].addTriangle(s,a)}getTrianglesAsArray(e=null){const{data:i}=this,s=[];if(e!==null)e in i&&s.push(i[e].triangle);else for(const a in i)s.push(i[a].triangle);return s}getTriangleIndices(){return Object.keys(this.data).map(e=>parseInt(e))}getIntersectionIndices(e){const{data:i}=this;return i[e]?Object.keys(i[e].intersects).map(s=>parseInt(s)):[]}getIntersectionsAsArray(e=null,i=null){const{data:s}=this,a=new Set,h=[],d=b=>{if(s[b])if(i!==null)s[b].intersects[i]&&h.push(s[b].intersects[i]);else{const X=s[b].intersects;for(const $ in X)a.has($)||(a.add($),h.push(X[$]))}};if(e!==null)d(e);else for(const b in s)d(b);return h}reset(){this.data={}}}class qI{constructor(){this.enabled=!1,this.triangleIntersectsA=new pM,this.triangleIntersectsB=new pM,this.intersectionEdges=[]}addIntersectingTriangles(e,i,s,a){const{triangleIntersectsA:h,triangleIntersectsB:d}=this;h.addTriangleIntersection(e,i,s,a),d.addTriangleIntersection(s,a,e,i)}addEdge(e){this.intersectionEdges.push(e.clone())}reset(){this.triangleIntersectsA.reset(),this.triangleIntersectsB.reset(),this.intersectionEdges=[]}}const wf=new _.yGw,cv=new _.Vkp,og=new _.CJI,hw=new _.CJI,dw=new _.CJI,uA=new _.CJI;function YI(c){for(const e of c)return e}function fM(c,e,i,s,a,h,d,b=0){wf.copy(e.matrixWorld).invert().multiply(c.matrixWorld),cv.getNormalMatrix(c.matrixWorld);const X=c.geometry.groupIndices,$=c.geometry.index,Z=c.geometry.attributes.position,re=e.geometry.boundsTree,le=e.geometry.index,he=e.geometry.attributes.position,fe=i.ids,me=i.intersectionSet;for(let Ee=0,Ae=fe.length;Ee<Ae;Ee++){const ye=fe[Ee],ge=b===-1?0:X[ye]+b,Pe=d.getGroupSet(ge),Be=3*ye,Oe=$.getX(Be+0),Fe=$.getX(Be+1),Xe=$.getX(Be+2);og.a.fromBufferAttribute(Z,Oe).applyMatrix4(wf),og.b.fromBufferAttribute(Z,Fe).applyMatrix4(wf),og.c.fromBufferAttribute(Z,Xe).applyMatrix4(wf),h.initialize(og);const at=me[ye];for(let wt=0,At=at.length;wt<At;wt++){const Tt=3*at[wt],yt=le.getX(Tt+0),St=le.getX(Tt+1),Ft=le.getX(Tt+2);hw.a.fromBufferAttribute(he,yt),hw.b.fromBufferAttribute(he,St),hw.c.fromBufferAttribute(he,Ft),h.splitByTriangle(hw)}const mt=h.triangles;for(let wt=0,At=mt.length;wt<At;wt++){const Tt=mt[wt],yt=cM(s,oM(Tt,re),a);if(yt!==2)switch(og.getBarycoord(Tt.a,uA.a),og.getBarycoord(Tt.b,uA.b),og.getBarycoord(Tt.c,uA.c),yt){case 1:aM(ye,uA,c.geometry,c.matrixWorld,cv,Pe);break;case 0:aM(ye,uA,c.geometry,c.matrixWorld,cv,Pe,!0)}}}return fe.length}function mM(c,e,i,s,a,h,d=0){wf.copy(e.matrixWorld).invert().multiply(c.matrixWorld),cv.getNormalMatrix(c.matrixWorld);const b=e.geometry.boundsTree,X=c.geometry.groupIndices,$=c.geometry.index,Z=c.geometry.attributes,re=Z.position,le=[],he=c.geometry.halfEdges,fe=new Set;for(let me=0,Ee=$.count/3;me<Ee;me++)me in i.intersectionSet||fe.add(me);for(;fe.size>0;){const me=YI(fe);fe.delete(me),le.push(me);const Ee=3*me,Ae=$.getX(Ee+0),ye=$.getX(Ee+1),ge=$.getX(Ee+2);dw.a.fromBufferAttribute(re,Ae).applyMatrix4(wf),dw.b.fromBufferAttribute(re,ye).applyMatrix4(wf),dw.c.fromBufferAttribute(re,ge).applyMatrix4(wf);const Pe=cM(s,oM(dw,b),a);for(;le.length>0;){const Be=le.pop(),Oe=d===-1?0:X[Be]+d,Fe=h.getGroupSet(Oe);for(let At=0;At<3;At++){const Tt=he.getSiblingTriangleIndex(Be,At);Tt!==-1&&fe.has(Tt)&&(le.push(Tt),fe.delete(Tt))}const Xe=3*Be,at=$.getX(Xe+0),mt=$.getX(Xe+1),wt=$.getX(Xe+2);switch(Pe){case 1:lM(at,mt,wt,Z,c.matrixWorld,cv,Fe);break;case 0:lM(wt,mt,at,Z,c.matrixWorld,cv,Fe,a)}}}}const j1=1.25,z1=65535,XI=Math.pow(2,-24);class pw{constructor(){}}function Wh(c,e,i){return i.min.x=e[c],i.min.y=e[c+1],i.min.z=e[c+2],i.max.x=e[c+3],i.max.y=e[c+4],i.max.z=e[c+5],i}function gM(c){let e=-1,i=-1/0;for(let s=0;s<3;s++){const a=c[s+3]-c[s];a>i&&(i=a,e=s)}return e}function _M(c,e){e.set(c)}function vM(c,e,i){let s,a;for(let h=0;h<3;h++){const d=h+3;s=c[h],a=e[h],i[h]=s<a?s:a,s=c[d],a=e[d],i[d]=s>a?s:a}}function fw(c,e,i){for(let s=0;s<3;s++){const a=e[c+2*s],h=e[c+2*s+1],d=a-h,b=a+h;d<i[s]&&(i[s]=d),b>i[s+3]&&(i[s+3]=b)}}function hA(c){const e=c[3]-c[0],i=c[4]-c[1],s=c[5]-c[2];return 2*(e*i+i*s+s*e)}function V1(c,e,i,s,a=null){let h=1/0,d=1/0,b=1/0,X=-1/0,$=-1/0,Z=-1/0,re=1/0,le=1/0,he=1/0,fe=-1/0,me=-1/0,Ee=-1/0;const Ae=a!==null;for(let ye=6*e,ge=6*(e+i);ye<ge;ye+=6){const Pe=c[ye+0],Be=c[ye+1],Oe=Pe-Be,Fe=Pe+Be;Oe<h&&(h=Oe),Fe>X&&(X=Fe),Ae&&Pe<re&&(re=Pe),Ae&&Pe>fe&&(fe=Pe);const Xe=c[ye+2],at=c[ye+3],mt=Xe-at,wt=Xe+at;mt<d&&(d=mt),wt>$&&($=wt),Ae&&Xe<le&&(le=Xe),Ae&&Xe>me&&(me=Xe);const At=c[ye+4],Tt=c[ye+5],yt=At-Tt,St=At+Tt;yt<b&&(b=yt),St>Z&&(Z=St),Ae&&At<he&&(he=At),Ae&&At>Ee&&(Ee=At)}s[0]=h,s[1]=d,s[2]=b,s[3]=X,s[4]=$,s[5]=Z,Ae&&(a[0]=re,a[1]=le,a[2]=he,a[3]=fe,a[4]=me,a[5]=Ee)}const KI=(c,e)=>c.candidate-e.candidate,xf=new Array(32).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),mw=new Float32Array(6);class qh extends _.ZzF{constructor(...e){super(...e),this.isOrientedBox=!0,this.matrix=new _.yGw,this.invMatrix=new _.yGw,this.points=new Array(8).fill().map(()=>new _.Pa4),this.satAxes=new Array(3).fill().map(()=>new _.Pa4),this.satBounds=new Array(3).fill().map(()=>new ap),this.alignedSatBounds=new Array(3).fill().map(()=>new ap),this.needsUpdate=!1}set(e,i,s){super.set(e,i),this.matrix.copy(s),this.needsUpdate=!0}copy(e){super.copy(e),this.matrix.copy(e.matrix),this.needsUpdate=!0}}qh.prototype.update=function(){const c=this.matrix,e=this.min,i=this.max,s=this.points;for(let X=0;X<=1;X++)for(let $=0;$<=1;$++)for(let Z=0;Z<=1;Z++){const re=s[1*X|2*$|4*Z];re.x=X?i.x:e.x,re.y=$?i.y:e.y,re.z=Z?i.z:e.z,re.applyMatrix4(c)}const a=this.satBounds,h=this.satAxes,d=s[0];for(let X=0;X<3;X++){const $=h[X],Z=a[X],re=s[1<<X];$.subVectors(d,re),Z.setFromPoints($,s)}const b=this.alignedSatBounds;b[0].setFromPointsField(s,"x"),b[1].setFromPointsField(s,"y"),b[2].setFromPointsField(s,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},qh.prototype.intersectsBox=function(){const c=new ap;return function(e){this.needsUpdate&&this.update();const i=e.min,s=e.max,a=this.satBounds,h=this.satAxes,d=this.alignedSatBounds;if(c.min=i.x,c.max=s.x,d[0].isSeparated(c)||(c.min=i.y,c.max=s.y,d[1].isSeparated(c))||(c.min=i.z,c.max=s.z,d[2].isSeparated(c)))return!1;for(let b=0;b<3;b++){const X=h[b],$=a[b];if(c.setFromBox(X,e),$.isSeparated(c))return!1}return!0}}(),qh.prototype.intersectsTriangle=function(){const c=new Qh,e=new Array(3),i=new ap,s=new ap,a=new _.Pa4;return function(h){this.needsUpdate&&this.update(),h.isExtendedTriangle?h.needsUpdate&&h.update():(c.copy(h),c.update(),h=c);const d=this.satBounds,b=this.satAxes;e[0]=h.a,e[1]=h.b,e[2]=h.c;for(let re=0;re<3;re++){const le=d[re],he=b[re];if(i.setFromPoints(he,e),le.isSeparated(i))return!1}const X=h.satBounds,$=h.satAxes,Z=this.points;for(let re=0;re<3;re++){const le=X[re],he=$[re];if(i.setFromPoints(he,Z),le.isSeparated(i))return!1}for(let re=0;re<3;re++){const le=b[re];for(let he=0;he<4;he++){const fe=$[he];if(a.crossVectors(le,fe),i.setFromPoints(a,e),s.setFromPoints(a,Z),i.isSeparated(s))return!1}}return!0}}(),qh.prototype.closestPointToPoint=function(c,e){return this.needsUpdate&&this.update(),e.copy(c).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e},qh.prototype.distanceToPoint=function(){const c=new _.Pa4;return function(e){return this.closestPointToPoint(e,c),e.distanceTo(c)}}(),qh.prototype.distanceToBox=function(){const c=["x","y","z"],e=new Array(12).fill().map(()=>new _.Zzh),i=new Array(12).fill().map(()=>new _.Zzh),s=new _.Pa4,a=new _.Pa4;return function(h,d=0,b=null,X=null){if(this.needsUpdate&&this.update(),this.intersectsBox(h))return(b||X)&&(h.getCenter(a),this.closestPointToPoint(a,s),h.closestPointToPoint(s,a),b&&b.copy(s),X&&X.copy(a)),0;const $=d*d,Z=h.min,re=h.max,le=this.points;let he=1/0;for(let me=0;me<8;me++){const Ee=le[me];a.copy(Ee).clamp(Z,re);const Ae=Ee.distanceToSquared(a);if(Ae<he&&(he=Ae,b&&b.copy(Ee),X&&X.copy(a),Ae<$))return Math.sqrt(Ae)}let fe=0;for(let me=0;me<3;me++)for(let Ee=0;Ee<=1;Ee++)for(let Ae=0;Ae<=1;Ae++){const ye=(me+1)%3,ge=(me+2)%3,Pe=1<<me|Ee<<ye|Ae<<ge,Be=le[Ee<<ye|Ae<<ge],Oe=le[Pe];e[fe].set(Be,Oe);const Fe=c[me],Xe=c[ye],at=c[ge],mt=i[fe],wt=mt.start,At=mt.end;wt[Fe]=Z[Fe],wt[Xe]=Ee?Z[Xe]:re[Xe],wt[at]=Ae?Z[at]:re[Xe],At[Fe]=re[Fe],At[Xe]=Ee?Z[Xe]:re[Xe],At[at]=Ae?Z[at]:re[Xe],fe++}for(let me=0;me<=1;me++)for(let Ee=0;Ee<=1;Ee++)for(let Ae=0;Ae<=1;Ae++){a.x=me?re.x:Z.x,a.y=Ee?re.y:Z.y,a.z=Ae?re.z:Z.z,this.closestPointToPoint(a,s);const ye=a.distanceToSquared(s);if(ye<he&&(he=ye,b&&b.copy(s),X&&X.copy(a),ye<$))return Math.sqrt(ye)}for(let me=0;me<12;me++){const Ee=e[me];for(let Ae=0;Ae<12;Ae++){const ye=i[Ae];k1(Ee,ye,s,a);const ge=s.distanceToSquared(a);if(ge<he&&(he=ge,b&&b.copy(s),X&&X.copy(a),ge<$))return Math.sqrt(ge)}}return Math.sqrt(he)}}();const gw=new _.Pa4,_w=new _.Pa4,vw=new _.Pa4,AM=new _.FM8,yM=new _.FM8,bM=new _.FM8,wM=new _.Pa4;function xM(c,e,i,s,a){const h=3*s,d=c.index.getX(h),b=c.index.getX(h+1),X=c.index.getX(h+2),$=function(Z,re,le,he,fe,me,Ee){gw.fromBufferAttribute(re,he),_w.fromBufferAttribute(re,fe),vw.fromBufferAttribute(re,me);const Ae=function(ye,ge,Pe,Be,Oe,Fe){let Xe;return Xe=Fe===_._Li?ye.intersectTriangle(Be,Pe,ge,!0,Oe):ye.intersectTriangle(ge,Pe,Be,Fe!==_.ehD,Oe),Xe===null?null:{distance:ye.origin.distanceTo(Oe),point:Oe.clone()}}(Z,gw,_w,vw,wM,Ee);if(Ae){le&&(AM.fromBufferAttribute(le,he),yM.fromBufferAttribute(le,fe),bM.fromBufferAttribute(le,me),Ae.uv=_.CJI.getUV(wM,gw,_w,vw,AM,yM,bM,new _.FM8));const ye={a:he,b:fe,c:me,normal:new _.Pa4,materialIndex:0};_.CJI.getNormal(gw,_w,vw,ye.normal),Ae.face=ye,Ae.faceIndex=he}return Ae}(i,c.attributes.position,c.attributes.uv,d,b,X,e);return $?($.faceIndex=s,a&&a.push($),$):null}function EM(c,e,i){return c===null?null:(c.point.applyMatrix4(e.matrixWorld),c.distance=c.point.distanceTo(i.ray.origin),c.object=e,c.distance<i.near||c.distance>i.far?null:c)}function Yh(c,e,i,s){const a=c.a,h=c.b,d=c.c;let b=e,X=e+1,$=e+2;i&&(b=i.getX(e),X=i.getX(e+1),$=i.getX(e+2)),a.x=s.getX(b),a.y=s.getY(b),a.z=s.getZ(b),h.x=s.getX(X),h.y=s.getY(X),h.z=s.getZ(X),d.x=s.getX($),d.y=s.getY($),d.z=s.getZ($)}function SM(c,e,i,s,a,h,d){const b=i.index,X=i.attributes.position;for(let $=c,Z=e+c;$<Z;$++)if(Yh(d,3*$,b,X),d.needsUpdate=!0,s(d,$,a,h))return!0;return!1}class CM{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}function Ef(c,e){return e[c+15]===65535}function uv(c,e){return e[c+6]}function dA(c,e){return e[c+14]}function pA(c){return c+8}function fA(c,e){return e[c+6]}const hv=new _.ZzF,Aw=new _.Pa4,JI=["x","y","z"];function G1(c,e,i,s,a){let h=2*c,d=dv,b=Sf,X=Cf;if(Ef(h,b))(function($,Z,re,le,he,fe){for(let me=le,Ee=le+he;me<Ee;me++)xM($,Z,re,me,fe)})(e,i,s,uv(c,X),dA(h,b),a);else{const $=pA(c);yw($,d,s,Aw)&&G1($,e,i,s,a);const Z=fA(c,X);yw(Z,d,s,Aw)&&G1(Z,e,i,s,a)}}function Q1(c,e,i,s){let a=2*c,h=dv,d=Sf,b=Cf;if(Ef(a,d))return function(X,$,Z,re,le){let he=1/0,fe=null;for(let me=re,Ee=re+le;me<Ee;me++){const Ae=xM(X,$,Z,me);Ae&&Ae.distance<he&&(fe=Ae,he=Ae.distance)}return fe}(e,i,s,uv(c,b),dA(a,d));{const X=function(me,Ee){return Ee[me+7]}(c,b),$=JI[X],Z=s.direction[$]>=0;let re,le;Z?(re=pA(c),le=fA(c,b)):(re=fA(c,b),le=pA(c));const he=yw(re,h,s,Aw)?Q1(re,e,i,s):null;if(he){const me=he.point[$];if(Z?me<=h[le+X]:me>=h[le+X+3])return he}const fe=yw(le,h,s,Aw)?Q1(le,e,i,s):null;return he&&fe?he.distance<=fe.distance?he:fe:he||fe||null}}const $I=function(){let c,e;const i=[],s=new CM(()=>new _.ZzF);return function(...h){c=s.getPrimitive(),e=s.getPrimitive(),i.push(c,e);const d=a(...h);s.releasePrimitive(c),s.releasePrimitive(e),i.pop(),i.pop();const b=i.length;return b>0&&(e=i[b-1],c=i[b-2]),d};function a(h,d,b,X,$=null,Z=0,re=0){function le(ye){let ge=2*ye,Pe=Sf,Be=Cf;for(;!Ef(ge,Pe);)ge=2*(ye=pA(ye));return uv(ye,Be)}function he(ye){let ge=2*ye,Pe=Sf,Be=Cf;for(;!Ef(ge,Pe);)ge=2*(ye=fA(ye,Be));return uv(ye,Be)+dA(ge,Pe)}let fe=2*h,me=dv,Ee=Sf,Ae=Cf;if(Ef(fe,Ee)){const ye=uv(h,Ae),ge=dA(fe,Ee);return Wh(h,me,c),X(ye,ge,!1,re,Z+h,c)}{const ye=pA(h),ge=fA(h,Ae);let Pe,Be,Oe,Fe,Xe=ye,at=ge;if($&&(Oe=c,Fe=e,Wh(Xe,me,Oe),Wh(at,me,Fe),Pe=$(Oe),Be=$(Fe),Be<Pe)){Xe=ge,at=ye;const yt=Pe;Pe=Be,Be=yt,Oe=Fe}Oe||(Oe=c,Wh(Xe,me,Oe));const mt=b(Oe,Ef(2*Xe,Ee),Pe,re+1,Z+Xe);let wt;if(mt===2){const yt=le(Xe);wt=X(yt,he(Xe)-yt,!0,re+1,Z+Xe,Oe)}else wt=mt&&a(Xe,d,b,X,$,Z,re+1);if(wt)return!0;Fe=e,Wh(at,me,Fe);const At=b(Fe,Ef(2*at,Ee),Be,re+1,Z+at);let Tt;if(At===2){const yt=le(at);Tt=X(yt,he(at)-yt,!0,re+1,Z+at,Fe)}else Tt=At&&a(at,d,b,X,$,Z,re+1);return!!Tt}}}(),ZI=function(){const c=new Qh,e=new Qh,i=new _.yGw,s=new qh,a=new qh;return function h(d,b,X,$,Z=null){let re=2*d,le=dv,he=Sf,fe=Cf;if(Z===null&&(X.boundingBox||X.computeBoundingBox(),s.set(X.boundingBox.min,X.boundingBox.max,$),Z=s),!Ef(re,he)){const me=d+8,Ee=fe[d+6];return Wh(me,le,hv),Z.intersectsBox(hv)&&h(me,b,X,$,Z)?!0:(Wh(Ee,le,hv),!(!Z.intersectsBox(hv)||!h(Ee,b,X,$,Z)))}{const me=b,Ee=me.index,Ae=me.attributes.position,ye=X.index,ge=X.attributes.position,Pe=uv(d,fe),Be=dA(re,he);if(i.copy($).invert(),X.boundsTree)return Wh(d,le,a),a.matrix.copy(i),a.needsUpdate=!0,X.boundsTree.shapecast({intersectsBounds:Fe=>a.intersectsBox(Fe),intersectsTriangle:Fe=>{Fe.a.applyMatrix4($),Fe.b.applyMatrix4($),Fe.c.applyMatrix4($),Fe.needsUpdate=!0;for(let Xe=3*Pe,at=3*(Be+Pe);Xe<at;Xe+=3)if(Yh(e,Xe,Ee,Ae),e.needsUpdate=!0,Fe.intersectsTriangle(e))return!0;return!1}});for(let Oe=3*Pe,Fe=Be+3*Pe;Oe<Fe;Oe+=3){Yh(c,Oe,Ee,Ae),c.a.applyMatrix4(i),c.b.applyMatrix4(i),c.c.applyMatrix4(i),c.needsUpdate=!0;for(let Xe=0,at=ye.count;Xe<at;Xe+=3)if(Yh(e,Xe,ye,ge),e.needsUpdate=!0,c.intersectsTriangle(e))return!0}}}}();function yw(c,e,i,s){return Wh(c,e,hv),i.intersectBox(hv,s)}const H1=[];let bw,dv,Sf,Cf;function mA(c){bw&&H1.push(bw),bw=c,dv=new Float32Array(c),Sf=new Uint16Array(c),Cf=new Uint32Array(c)}function ww(){bw=null,dv=null,Sf=null,Cf=null,H1.length&&mA(H1.pop())}const W1=Symbol("skip tree generation"),q1=new _.ZzF,Y1=new _.ZzF,pv=new _.yGw,ag=new qh,gA=new qh,_A=new _.Pa4,xw=new _.Pa4,e2=new _.Pa4,t2=new _.Pa4,n2=new _.Pa4,MM=new _.ZzF,Xh=new CM(()=>new Qh);class Ia{static serialize(e,i={}){if(i.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),Ia.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0||arguments[2]});i={cloneBuffers:!0,...i};const s=e.geometry,a=e._roots,h=s.getIndex();let d;return d=i.cloneBuffers?{roots:a.map(b=>b.slice()),index:h.array.slice()}:{roots:a,index:h.array},d}static deserialize(e,i,s={}){if(typeof s=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),Ia.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0||arguments[2]});s={setIndex:!0,...s};const{index:a,roots:h}=e,d=new Ia(i,{...s,[W1]:!0});if(d._roots=h,s.setIndex){const b=i.getIndex();if(b===null){const X=new _.TlE(e.index,1,!1);i.setIndex(X)}else b.array!==a&&(b.array.set(a),b.needsUpdate=!0)}return d}constructor(e,i={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((i=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[W1]:!1},i)).useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,i[W1]||(this._roots=function(s,a){const h=function(he,fe){function me(yt){at&&at(yt/mt)}function Ee(yt,St,Ft,Mt=null,Gt=0){if(!wt&&Gt>=Be&&(wt=!0,Oe&&(console.warn(`MeshBVH: Max depth of ${Be} reached when generating BVH. Consider increasing maxDepth.`),console.warn(he))),Ft<=Fe||Gt>=Be)return me(St+Ft),yt.offset=St,yt.count=Ft,yt;const rn=function(Kt,In,kn,On,zn,pi){let yn=-1,Ji=0;if(pi===0)yn=gM(In),yn!==-1&&(Ji=(In[yn]+In[yn+3])/2);else if(pi===1)yn=gM(Kt),yn!==-1&&(Ji=function(ar,$i,Pr,$r){let an=0;for(let Un=$i,Fn=$i+Pr;Un<Fn;Un++)an+=ar[6*Un+2*$r];return an/Pr}(kn,On,zn,yn));else if(pi===2){const ar=hA(Kt);let $i=j1*zn;const Pr=6*On,$r=6*(On+zn);for(let an=0;an<3;an++){const Un=In[an],Fn=(In[an+3]-Un)/32;if(zn<8){const Zi=[...xf];Zi.length=zn;let Yr=0;for(let Nt=Pr;Nt<$r;Nt+=6,Yr++){const pt=Zi[Yr];pt.candidate=kn[Nt+2*an],pt.count=0;const{bounds:zt,leftCacheBounds:Yt,rightCacheBounds:jt}=pt;for(let sn=0;sn<3;sn++)jt[sn]=1/0,jt[sn+3]=-1/0,Yt[sn]=1/0,Yt[sn+3]=-1/0,zt[sn]=1/0,zt[sn+3]=-1/0;fw(Nt,kn,zt)}Zi.sort(KI);let ut=zn;for(let Nt=0;Nt<ut;Nt++){const pt=Zi[Nt];for(;Nt+1<ut&&Zi[Nt+1].candidate===pt.candidate;)Zi.splice(Nt+1,1),ut--}for(let Nt=Pr;Nt<$r;Nt+=6){const pt=kn[Nt+2*an];for(let zt=0;zt<ut;zt++){const Yt=Zi[zt];pt>=Yt.candidate?fw(Nt,kn,Yt.rightCacheBounds):(fw(Nt,kn,Yt.leftCacheBounds),Yt.count++)}}for(let Nt=0;Nt<ut;Nt++){const pt=Zi[Nt],zt=pt.count,Yt=zn-pt.count,jt=pt.leftCacheBounds,sn=pt.rightCacheBounds;let Qn=0;zt!==0&&(Qn=hA(jt)/ar);let ni=0;Yt!==0&&(ni=hA(sn)/ar);const ui=1+j1*(Qn*zt+ni*Yt);ui<$i&&(yn=an,$i=ui,Ji=pt.candidate)}}else{for(let ut=0;ut<32;ut++){const Nt=xf[ut];Nt.count=0,Nt.candidate=Un+Fn+ut*Fn;const pt=Nt.bounds;for(let zt=0;zt<3;zt++)pt[zt]=1/0,pt[zt+3]=-1/0}for(let ut=Pr;ut<$r;ut+=6){let Nt=~~((kn[ut+2*an]-Un)/Fn);Nt>=32&&(Nt=31);const pt=xf[Nt];pt.count++,fw(ut,kn,pt.bounds)}const Zi=xf[31];_M(Zi.bounds,Zi.rightCacheBounds);for(let ut=30;ut>=0;ut--){const Nt=xf[ut],pt=xf[ut+1];vM(Nt.bounds,pt.rightCacheBounds,Nt.rightCacheBounds)}let Yr=0;for(let ut=0;ut<31;ut++){const Nt=xf[ut],pt=Nt.count,zt=Nt.bounds,Yt=xf[ut+1].rightCacheBounds;pt!==0&&(Yr===0?_M(zt,mw):vM(zt,mw,mw)),Yr+=pt;let jt=0,sn=0;Yr!==0&&(jt=hA(mw)/ar);const Qn=zn-Yr;Qn!==0&&(sn=hA(Yt)/ar);const ni=1+j1*(jt*Yr+sn*Qn);ni<$i&&(yn=an,$i=ni,Ji=Nt.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${pi} used.`);return{axis:yn,pos:Ji}}(yt.boundingData,Mt,ge,St,Ft,Xe);if(rn.axis===-1)return me(St+Ft),yt.offset=St,yt.count=Ft,yt;const gn=function(Kt,In,kn,On,zn){let pi=kn,yn=kn+On-1;const Ji=zn.pos,ar=2*zn.axis;for(;;){for(;pi<=yn&&In[6*pi+ar]<Ji;)pi++;for(;pi<=yn&&In[6*yn+ar]>=Ji;)yn--;if(!(pi<yn))return pi;for(let $i=0;$i<3;$i++){let Pr=Kt[3*pi+$i];Kt[3*pi+$i]=Kt[3*yn+$i],Kt[3*yn+$i]=Pr;let $r=In[6*pi+2*$i+0];In[6*pi+2*$i+0]=In[6*yn+2*$i+0],In[6*yn+2*$i+0]=$r;let an=In[6*pi+2*$i+1];In[6*pi+2*$i+1]=In[6*yn+2*$i+1],In[6*yn+2*$i+1]=an}pi++,yn--}}(Pe,ge,St,Ft,rn);if(gn===St||gn===St+Ft)me(St+Ft),yt.offset=St,yt.count=Ft;else{yt.splitAxis=rn.axis;const Kt=new pw,In=St,kn=gn-St;yt.left=Kt,Kt.boundingData=new Float32Array(6),V1(ge,In,kn,Kt.boundingData,ye),Ee(Kt,In,kn,ye,Gt+1);const On=new pw,zn=gn,pi=Ft-kn;yt.right=On,On.boundingData=new Float32Array(6),V1(ge,zn,pi,On.boundingData,ye),Ee(On,zn,pi,ye,Gt+1)}return yt}(function(yt,St){if(!yt.index){const Ft=yt.attributes.position.count,Mt=St.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;let Gt;Gt=Ft>65535?new Uint32Array(new Mt(4*Ft)):new Uint16Array(new Mt(2*Ft)),yt.setIndex(new _.TlE(Gt,1));for(let rn=0;rn<Ft;rn++)Gt[rn]=rn}})(he,fe);const Ae=new Float32Array(6),ye=new Float32Array(6),ge=function(yt,St){const Ft=yt.attributes.position,Mt=Ft.array,Gt=yt.index.array,rn=Gt.length/3,gn=new Float32Array(6*rn),Kt=Ft.offset||0;let In=3;Ft.isInterleavedBufferAttribute&&(In=Ft.data.stride);for(let kn=0;kn<rn;kn++){const On=3*kn,zn=6*kn,pi=Gt[On+0]*In+Kt,yn=Gt[On+1]*In+Kt,Ji=Gt[On+2]*In+Kt;for(let ar=0;ar<3;ar++){const $i=Mt[pi+ar],Pr=Mt[yn+ar],$r=Mt[Ji+ar];let an=$i;Pr<an&&(an=Pr),$r<an&&(an=$r);let Un=$i;Pr>Un&&(Un=Pr),$r>Un&&(Un=$r);const Fn=(Un-an)/2,Zi=2*ar;gn[zn+Zi+0]=an+Fn,gn[zn+Zi+1]=Fn+(Math.abs(an)+Fn)*XI,an<St[ar]&&(St[ar]=an),Un>St[ar+3]&&(St[ar+3]=Un)}}return gn}(he,Ae),Pe=he.index.array,Be=fe.maxDepth,Oe=fe.verbose,Fe=fe.maxLeafTris,Xe=fe.strategy,at=fe.onProgress,mt=he.index.count/3;let wt=!1;const At=[],Tt=function(yt){if(!yt.groups||!yt.groups.length)return[{offset:0,count:yt.index.count/3}];const St=[],Ft=new Set;for(const Gt of yt.groups)Ft.add(Gt.start),Ft.add(Gt.start+Gt.count);const Mt=Array.from(Ft.values()).sort((Gt,rn)=>Gt-rn);for(let Gt=0;Gt<Mt.length-1;Gt++){const rn=Mt[Gt],gn=Mt[Gt+1];St.push({offset:rn/3,count:(gn-rn)/3})}return St}(he);if(Tt.length===1){const yt=Tt[0],St=new pw;St.boundingData=Ae,function(Ft,Mt,Gt,rn){let gn=1/0,Kt=1/0,In=1/0,kn=-1/0,On=-1/0,zn=-1/0;for(let pi=6*Mt,yn=6*(Mt+Gt);pi<yn;pi+=6){const Ji=Ft[pi+0];Ji<gn&&(gn=Ji),Ji>kn&&(kn=Ji);const ar=Ft[pi+2];ar<Kt&&(Kt=ar),ar>On&&(On=ar);const $i=Ft[pi+4];$i<In&&(In=$i),$i>zn&&(zn=$i)}rn[0]=gn,rn[1]=Kt,rn[2]=In,rn[3]=kn,rn[4]=On,rn[5]=zn}(ge,yt.offset,yt.count,ye),Ee(St,yt.offset,yt.count,ye),At.push(St)}else for(let yt of Tt){const St=new pw;St.boundingData=new Float32Array(6),V1(ge,yt.offset,yt.count,St.boundingData,ye),Ee(St,yt.offset,yt.count,ye),At.push(St)}return At}(s,a);let d,b,X;const $=[],Z=a.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let he=0;he<h.length;he++){const fe=h[he],me=new Z(32*re(fe));d=new Float32Array(me),b=new Uint32Array(me),X=new Uint16Array(me),le(0,fe),$.push(me)}return $;function re(he){return he.count?1:1+re(he.left)+re(he.right)}function le(he,fe){const me=he/4,Ee=he/2,Ae=!!fe.count,ye=fe.boundingData;for(let ge=0;ge<6;ge++)d[me+ge]=ye[ge];if(Ae){const ge=fe.offset,Pe=fe.count;return b[me+6]=ge,X[Ee+14]=Pe,X[Ee+15]=z1,he+32}{const ge=fe.left,Pe=fe.right,Be=fe.splitAxis;let Oe;if(Oe=le(he+32,ge),Oe/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return b[me+6]=Oe/4,Oe=le(Oe,Pe),b[me+7]=Be,Oe}}}(e,i),!e.boundingBox&&i.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new _.ZzF))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));const i=this.geometry,s=i.index.array,a=i.attributes.position,h=a.array,d=a.offset||0;let b,X,$,Z,re=3;a.isInterleavedBufferAttribute&&(re=a.data.stride);let le=0;const he=this._roots;for(let me=0,Ee=he.length;me<Ee;me++)b=he[me],X=new Uint32Array(b),$=new Uint16Array(b),Z=new Float32Array(b),fe(0,le),le+=b.byteLength;function fe(me,Ee,Ae=!1){const ye=2*me;if($[ye+15]===z1){const ge=X[me+6];let Pe=1/0,Be=1/0,Oe=1/0,Fe=-1/0,Xe=-1/0,at=-1/0;for(let mt=3*ge,wt=3*(ge+$[ye+14]);mt<wt;mt++){const At=s[mt]*re+d,Tt=h[At+0],yt=h[At+1],St=h[At+2];Tt<Pe&&(Pe=Tt),Tt>Fe&&(Fe=Tt),yt<Be&&(Be=yt),yt>Xe&&(Xe=yt),St<Oe&&(Oe=St),St>at&&(at=St)}return(Z[me+0]!==Pe||Z[me+1]!==Be||Z[me+2]!==Oe||Z[me+3]!==Fe||Z[me+4]!==Xe||Z[me+5]!==at)&&(Z[me+0]=Pe,Z[me+1]=Be,Z[me+2]=Oe,Z[me+3]=Fe,Z[me+4]=Xe,Z[me+5]=at,!0)}{const ge=me+8,Pe=X[me+6],Be=ge+Ee,Oe=Pe+Ee;let Fe=Ae,Xe=!1,at=!1;e?Fe||(Xe=e.has(Be),at=e.has(Oe),Fe=!Xe&&!at):(Xe=!0,at=!0);const mt=Fe||at;let wt=!1;(Fe||Xe)&&(wt=fe(ge,Ee,Fe));let At=!1;mt&&(At=fe(Pe,Ee,Fe));const Tt=wt||At;if(Tt)for(let yt=0;yt<3;yt++){const St=ge+yt,Ft=Pe+yt,Mt=Z[St],Gt=Z[St+3],rn=Z[Ft],gn=Z[Ft+3];Z[me+yt]=Mt<rn?Mt:rn,Z[me+yt+3]=Gt>gn?Gt:gn}return Tt}}}traverse(e,i=0){const s=this._roots[i],a=new Uint32Array(s),h=new Uint16Array(s);(function d(b,X=0){const $=2*b,Z=h[$+15]===z1;if(Z){const re=a[b+6],le=h[$+14];e(X,Z,new Float32Array(s,4*b,6),re,le)}else{const re=b+8,le=a[b+6],he=a[b+7];e(X,Z,new Float32Array(s,4*b,6),he)||(d(re,X+1),d(le,X+1))}})(0)}raycast(e,i=_.Wl3){const s=this._roots,a=this.geometry,h=[],d=i.isMaterial,b=Array.isArray(i),X=a.groups,$=d?i.side:i;for(let Z=0,re=s.length;Z<re;Z++){const le=b?i[X[Z].materialIndex].side:$,he=h.length;if(mA(s[Z]),G1(0,a,le,e,h),ww(),b){const fe=X[Z].materialIndex;for(let me=he,Ee=h.length;me<Ee;me++)h[me].face.materialIndex=fe}}return h}raycastFirst(e,i=_.Wl3){const s=this._roots,a=this.geometry,h=i.isMaterial,d=Array.isArray(i);let b=null;const X=a.groups,$=h?i.side:i;for(let Z=0,re=s.length;Z<re;Z++){const le=d?i[X[Z].materialIndex].side:$;mA(s[Z]);const he=Q1(0,a,le,e);ww(),he!=null&&(b==null||he.distance<b.distance)&&(b=he,d&&(he.face.materialIndex=X[Z].materialIndex))}return b}intersectsGeometry(e,i){const s=this.geometry;let a=!1;for(const h of this._roots)if(mA(h),a=ZI(0,s,e,i),ww(),a)break;return a}shapecast(e,i,s){const a=this.geometry;if(e instanceof Function){if(i){const le=i;i=(he,fe,me,Ee)=>{const Ae=3*fe;return le(he,Ae,Ae+1,Ae+2,me,Ee)}}e={boundsTraverseOrder:s,intersectsBounds:e,intersectsTriangle:i,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}const h=Xh.getPrimitive();let{boundsTraverseOrder:d,intersectsBounds:b,intersectsRange:X,intersectsTriangle:$}=e;if(X&&$){const le=X;X=(he,fe,me,Ee,Ae)=>!!le(he,fe,me,Ee,Ae)||SM(he,fe,a,$,me,Ee,h)}else X||(X=$?(le,he,fe,me)=>SM(le,he,a,$,fe,me,h):(le,he,fe)=>fe);let Z=!1,re=0;for(const le of this._roots){if(mA(le),Z=$I(0,a,b,X,d,re),ww(),Z)break;re+=le.byteLength}return Xh.releasePrimitive(h),Z}bvhcast(e,i,s){let{intersectsRanges:a,intersectsTriangles:h}=s;const d=this.geometry.index,b=this.geometry.attributes.position,X=e.geometry.index,$=e.geometry.attributes.position;pv.copy(i).invert();const Z=Xh.getPrimitive(),re=Xh.getPrimitive();if(h){let fe=function(me,Ee,Ae,ye,ge,Pe,Be,Oe){for(let Fe=Ae,Xe=Ae+ye;Fe<Xe;Fe++){Yh(re,3*Fe,X,$),re.a.applyMatrix4(i),re.b.applyMatrix4(i),re.c.applyMatrix4(i),re.needsUpdate=!0;for(let at=me,mt=me+Ee;at<mt;at++)if(Yh(Z,3*at,d,b),Z.needsUpdate=!0,h(Z,re,at,Fe,ge,Pe,Be,Oe))return!0}return!1};var he=fe;if(a){const me=a;a=function(Ee,Ae,ye,ge,Pe,Be,Oe,Fe){return!!me(Ee,Ae,ye,ge,Pe,Be,Oe,Fe)||fe(Ee,Ae,ye,ge,Pe,Be,Oe,Fe)}}else a=fe}e.getBoundingBox(Y1),Y1.applyMatrix4(i);const le=this.shapecast({intersectsBounds:fe=>Y1.intersectsBox(fe),intersectsRange:(fe,me,Ee,Ae,ye,ge)=>(q1.copy(ge),q1.applyMatrix4(pv),e.shapecast({intersectsBounds:Pe=>q1.intersectsBox(Pe),intersectsRange:(Pe,Be,Oe,Fe,Xe)=>a(fe,me,Pe,Be,Ae,ye,Fe,Xe)}))});return Xh.releasePrimitive(Z),Xh.releasePrimitive(re),le}intersectsBox(e,i){return ag.set(e.min,e.max,i),ag.needsUpdate=!0,this.shapecast({intersectsBounds:s=>ag.intersectsBox(s),intersectsTriangle:s=>ag.intersectsTriangle(s)})}intersectsSphere(e){return this.shapecast({intersectsBounds:i=>e.intersectsBox(i),intersectsTriangle:i=>i.intersectsSphere(e)})}closestPointToGeometry(e,i,s={},a={},h=0,d=1/0){e.boundingBox||e.computeBoundingBox(),ag.set(e.boundingBox.min,e.boundingBox.max,i),ag.needsUpdate=!0;const b=this.geometry,X=b.attributes.position,$=b.index,Z=e.attributes.position,re=e.index,le=Xh.getPrimitive(),he=Xh.getPrimitive();let fe=xw,me=e2,Ee=null,Ae=null;a&&(Ee=t2,Ae=n2);let ye=1/0,ge=null,Pe=null;return pv.copy(i).invert(),gA.matrix.copy(pv),this.shapecast({boundsTraverseOrder:Be=>ag.distanceToBox(Be),intersectsBounds:(Be,Oe,Fe)=>Fe<ye&&Fe<d&&(Oe&&(gA.min.copy(Be.min),gA.max.copy(Be.max),gA.needsUpdate=!0),!0),intersectsRange:(Be,Oe)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:Fe=>gA.distanceToBox(Fe),intersectsBounds:(Fe,Xe,at)=>at<ye&&at<d,intersectsRange:(Fe,Xe)=>{for(let at=3*Fe,mt=3*(Fe+Xe);at<mt;at+=3){Yh(he,at,re,Z),he.a.applyMatrix4(i),he.b.applyMatrix4(i),he.c.applyMatrix4(i),he.needsUpdate=!0;for(let wt=3*Be,At=3*(Be+Oe);wt<At;wt+=3){Yh(le,wt,$,X),le.needsUpdate=!0;const Tt=le.distanceToTriangle(he,fe,Ee);if(Tt<ye&&(me.copy(fe),Ae&&Ae.copy(Ee),ye=Tt,ge=wt/3,Pe=at/3),Tt<h)return!0}}}});for(let Fe=0,Xe=re?re.count:Z.count;Fe<Xe;Fe+=3){Yh(he,Fe,re,Z),he.a.applyMatrix4(i),he.b.applyMatrix4(i),he.c.applyMatrix4(i),he.needsUpdate=!0;for(let at=3*Be,mt=3*(Be+Oe);at<mt;at+=3){Yh(le,at,$,X),le.needsUpdate=!0;const wt=le.distanceToTriangle(he,fe,Ee);if(wt<ye&&(me.copy(fe),Ae&&Ae.copy(Ee),ye=wt,ge=at/3,Pe=Fe/3),wt<h)return!0}}}}),Xh.releasePrimitive(le),Xh.releasePrimitive(he),ye===1/0?null:(s.point?s.point.copy(me):s.point=me.clone(),s.distance=ye,s.faceIndex=ge,a&&(a.point?a.point.copy(Ae):a.point=Ae.clone(),a.point.applyMatrix4(pv),me.applyMatrix4(pv),a.distance=me.sub(a.point).length(),a.faceIndex=Pe),s)}closestPointToPoint(e,i={},s=0,a=1/0){const h=s*s,d=a*a;let b=1/0,X=null;if(this.shapecast({boundsTraverseOrder:Z=>(_A.copy(e).clamp(Z.min,Z.max),_A.distanceToSquared(e)),intersectsBounds:(Z,re,le)=>le<b&&le<d,intersectsTriangle:(Z,re)=>{Z.closestPointToPoint(e,_A);const le=e.distanceToSquared(_A);return le<b&&(xw.copy(_A),b=le,X=re),le<h}}),b===1/0)return null;const $=Math.sqrt(b);return i.point?i.point.copy(xw):i.point=xw.clone(),i.distance=$,i.faceIndex=X,i}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(i=>{Wh(0,new Float32Array(i),MM),e.union(MM)}),e}}const TM=Ia.prototype.raycast;Ia.prototype.raycast=function(...c){if(c[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycast" has changed. See docs for new signature.');const[e,i,s,a]=c;return TM.call(this,s,e.material).forEach(h=>{(h=EM(h,e,i))&&a.push(h)}),a}return TM.apply(this,c)};const IM=Ia.prototype.raycastFirst;Ia.prototype.raycastFirst=function(...c){if(c[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycastFirst" has changed. See docs for new signature.');const[e,i,s]=c;return EM(IM.call(this,s,e.material),e,i)}return IM.apply(this,c)};const DM=Ia.prototype.closestPointToPoint;Ia.prototype.closestPointToPoint=function(...c){if(c[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "closestPointToPoint" has changed. See docs for new signature.'),c.unshift();const e=c[1],i={};return c[1]=i,DM.apply(this,c),e&&e.copy(i.point),i.distance}return DM.apply(this,c)};const PM=Ia.prototype.closestPointToGeometry;Ia.prototype.closestPointToGeometry=function(...c){const e=c[2],i=c[3];if(e&&e.isVector3||i&&i.isVector3){console.warn('MeshBVH: The function signature and results frame for "closestPointToGeometry" has changed. See docs for new signature.');const s={},a={},h=c[1];return c[2]=s,c[3]=a,PM.apply(this,c),e&&e.copy(s.point),i&&i.copy(a.point).applyMatrix4(h),s.distance}return PM.apply(this,c)};const RM=Ia.prototype.refit;Ia.prototype.refit=function(...c){const e=c[0],i=c[1];if(i&&(i instanceof Set||Array.isArray(i))){console.warn('MeshBVH: The function signature for "refit" has changed. See docs for new signature.');const s=new Set;i.forEach(a=>s.add(a)),e&&e.forEach(a=>s.add(a)),RM.call(this,s)}else RM.apply(this,c)},["intersectsGeometry","shapecast","intersectsBox","intersectsSphere"].forEach(c=>{const e=Ia.prototype[c];Ia.prototype[c]=function(...i){return(i[0]===null||i[0].isMesh)&&(i.shift(),console.warn(`MeshBVH: The function signature for "${c}" has changed and no longer takes Mesh. See docs for new signature.`)),e.apply(this,i)}});const X1=[new _.Pa4,new _.Pa4,new _.Pa4];function K1(c){return~~(1e4*c)}function BM(c){return`${K1(c.x)},${K1(c.y)},${K1(c.z)}`}class i2{constructor(e=null){this.data=null,this.unmatchedEdges=null,this.matchedEdges=null,this.useDrawRange=!0,e&&this.updateFrom(e)}getSiblingTriangleIndex(e,i){const s=this.data[3*e+i];return s===-1?-1:~~(s/3)}getSiblingEdgeIndex(e,i){const s=this.data[3*e+i];return s===-1?-1:s%3}updateFrom(e){const i=new Map,{attributes:s}=e,a=e.index,h=s.position;let d=a?a.count/3:h.count/3;const b=d;let X=0;this.useDrawRange&&(X=e.drawRange.start,e.drawRange.count!==1/0&&(d=~~(e.drawRange.count/3)));let $=this.data;(!$||$.length<3*b)&&($=new Int32Array(3*b)),$.fill(-1);let Z=0,re=0;for(let le=0;le<d;le++){const he=3*le+X;for(let fe=0;fe<3;fe++){let me=he+fe;a&&(me=a.getX(me)),X1[fe].fromBufferAttribute(h,me)}for(let fe=0;fe<3;fe++){const me=(fe+1)%3,Ee=X1[fe],Ae=X1[me],ye=BM(Ee),ge=BM(Ae),Pe=`${ge}_${ye}`;if(i.has(Pe)){const Be=i.get(Pe);$[he+fe]=Be,$[Be]=he+fe,i.delete(Pe),Z--,re++}else{const Be=`${ye}_${ge}`;i.set(Be,he+fe),Z++}}}this.matchedEdges=re,this.unmatchedEdges=Z,this.data=$}}class Ew extends _.Kj0{constructor(...e){super(...e),this.isBrush=!0,this._previousMatrix=new _.yGw,this._previousMatrix.elements.fill(0)}markUpdated(){this._previousMatrix.copy(this.matrix)}isDirty(){const{matrix:e,_previousMatrix:i}=this,s=e.elements,a=i.elements;for(let h=0;h<16;h++)if(s[h]!==a[h])return!0;return!1}prepareGeometry(){const e=this.geometry,i=e.attributes;if(hM())for(const s in i){const a=i[s];if(a.isInterleavedBufferAttribute)throw new Error("Brush: InterleavedBufferAttributes are not supported.");a.array=QI(a.array)}if(e.boundsTree||(e.boundsTree=new Ia(e,{maxLeafTris:3}),e.halfEdges&&e.halfEdges.updateFrom(e)),e.halfEdges||(e.halfEdges=new i2(e)),!e.groupIndices){const s=e.index.count/3,a=new Uint16Array(s),h=e.groups;for(let d=0,b=h.length;d<b;d++){const{start:X,count:$}=h[d];for(let Z=X/3,re=(X+$)/3;Z<re;Z++)a[Z]=d}e.groupIndices=a}}disposeCacheData(){const{geometry:e}=this;e.halfEdges=null,e.boundsTree=null,e.groupIndices=null}}function kM(c,e){let i=e;return Array.isArray(e)||(i=[],c.forEach(s=>{i[s.materialIndex]=e})),i}class r2{constructor(){this.triangleSplitter=new GI,this.attributeData=new HI,this.attributes=["position","uv","normal"],this.useGroups=!0,this.debug=new qI}evaluate(e,i,s,a=new Ew){e.prepareGeometry(),i.prepareGeometry();const{triangleSplitter:h,attributeData:d,attributes:b,useGroups:X,debug:$}=this,Z=a.geometry,re=e.geometry.attributes;for(let Ae=0,ye=b.length;Ae<ye;Ae++){const ge=b[Ae],Pe=re[ge];d.initializeArray(ge,Pe.array.constructor)}for(const Ae in d.attributes)b.includes(Ae)||d.delete(Ae);for(const Ae in Z.attributes)b.includes(Ae)||(Z.deleteAttribute(Ae),Z.dispose());d.clear(),$.enabled&&($.reset(),sM($)),function(Ae,ye,ge,Pe,Be,Oe){const{useGroups:Fe=!0}=Oe,{aIntersections:Xe,bIntersections:at}=function(wt,At){const Tt=new eM,yt=new eM;return tM.copy(wt.matrixWorld).invert().multiply(At.matrixWorld),wt.geometry.boundsTree.bvhcast(At.geometry.boundsTree,tM,{intersectsTriangles:(St,Ft,Mt,Gt)=>(St.intersectsTriangle(Ft,L1)&&L1.distance()>1e-5&&(Tt.add(Mt,Gt),yt.add(Gt,Mt),cw&&(cw.addEdge(L1),cw.addIntersectingTriangles(Mt,St,Gt,Ft))),!1)}),{aIntersections:Tt,bIntersections:yt}}(Ae,ye);let mt;mt=Fe?0:-1,mM(Ae,ye,Xe,ge,!1,Be,mt),fM(Ae,ye,Xe,ge,!1,Pe,Be,mt),mt=Fe?Ae.geometry.groups.length||1:-1,mM(ye,Ae,at,ge,!0,Be,mt),fM(ye,Ae,at,ge,!0,Pe,Be,mt)}(e,i,s,h,d,{useGroups:X}),$.enabled&&sM(null);const le=X&&e.geometry.groups.length!==0?e.geometry.groups.map(Ae=>({...Ae})):[{start:0,count:1/0,materialIndex:0}],he=X&&i.geometry.groups.length!==0?i.geometry.groups.map(Ae=>({...Ae})):[{start:0,count:1/0,materialIndex:0}],fe=kM(le,e.material),me=kM(he,i.material);he.forEach(Ae=>{Ae.materialIndex+=fe.length}),function(Ae,ye,ge,Pe){let Be=!1,Oe=-1;const Fe=Pe.groupCount,Xe=Ae.attributes,at=Pe.groupAttributes[0];for(const wt in at){const At=Pe.getTotalLength(wt,Fe),Tt=at[wt].type;let yt=Xe[wt];if(!yt||yt.array.length<At){const Ft=ye.attributes[wt];yt=new _.TlE(new Tt(At),Ft.itemSize,Ft.normalized),Ae.setAttribute(wt,yt),Be=!0}let St=0;for(let Ft=0;Ft<Fe;Ft++){const{array:Mt,type:Gt,length:rn}=Pe.groupAttributes[Ft][wt],gn=new Gt(Mt.buffer,0,rn);yt.array.set(gn,St),St+=gn.length}yt.needsUpdate=!0,Oe=At/yt.itemSize}Ae.setDrawRange(0,Oe),Ae.clearGroups();let mt=0;for(let wt=0;wt<Fe;wt++){const At=Pe.getGroupArray("position",wt).length/3;if(At!==0){const Tt=ge[wt];Ae.addGroup(mt,At,Tt.materialIndex),mt+=At}}if(Ae.index){const wt=Ae.index.array;if(wt.length<Oe)Ae.index=null,Be=!0;else for(let At=0,Tt=wt.length;At<Tt;At++)wt[At]=At}Ae.boundsTree=null,Be&&Ae.dispose()}(Z,e.geometry,[...le,...he],d);const Ee=Z.groups;if(X){const Ae=new Map,ye=[...fe,...me];let ge=0;for(let Pe=0,Be=ye.length;Pe<Be;Pe++)Ee.find(Oe=>Oe.materialIndex===Pe)?(Ae.set(Pe,ge),ge++):ye[Pe]=null;for(let Pe=0,Be=Ee.length;Pe<Be;Pe++){const Oe=Ee[Pe];Oe.materialIndex=Ae.get(Oe.materialIndex)}a.material=ye.filter(Pe=>Pe)}return a}evaluateHierarchy(e,i=new Ew){e.updateMatrixWorld(!0);const s=(h,d)=>{const b=h.children;for(let X=0,$=b.length;X<$;X++){const Z=b[X];Z.isOperationGroup?s(Z,d):d(Z)}},a=h=>{const d=h.children;let b=!1;for(let $=0,Z=d.length;$<Z;$++){const re=d[$];b=a(re)||b}const X=h.isDirty();if(X&&h.markUpdated(),b&&!h.isOperationGroup){let $;return s(h,Z=>{$=$?this.evaluate($,Z,Z.operation):this.evaluate(h,Z,Z.operation)}),h._cachedGeometry=$.geometry,h._cachedMaterials=$.material,!0}return b||X};return a(e),i.geometry=e._cachedGeometry,i.material=e._cachedMaterials,i}reset(){this.triangleSplitter.reset()}}const OM={union:0,subtract:1,intersect:4,difference:3};function LM(c,e){const i=new r2;i.useGroups=!0,i.attributes=["position","normal","uv"],c.forEach(h=>{for(const d of[...i.attributes])h[0].geometry.getAttribute(d)||i.attributes.splice(i.attributes.indexOf(d),1)});let s=new Ew(new _._12(.01,.01,2,2));c.forEach(([h,d])=>{if(!Object.keys(OM).includes(d))return void console.error(`Unknown operation ${d}`);h.updateMatrix(),h.updateMatrixWorld();const b=new Ew;b.geometry=h.geometry,b.material=h.material,h.matrixWorld.decompose(b.position,b.quaternion,b.scale),b.updateMatrix(),b.updateMatrixWorld(),s=i.evaluate(s,b,OM[d])});const a=s;return a.userData._isCSGMesh=!0,a}let Sw=class extends op{_buildCSGMesh(c){return LM(c)}};Sw.PluginType="CSGPluginBVH",Sw=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d}([ur("CSG Plugin (BVH)")],Sw);class Cw extends Xi{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._cameraChanged=e=>{var i,s,a,h;(s=(i=e.lastCamera)===null||i===void 0?void 0:i.removeControlsCtor)===null||s===void 0||s.call(i,this.controlsKey),(h=(a=e.camera)===null||a===void 0?void 0:a.setControlsCtor)===null||h===void 0||h.call(a,this.controlsKey,this._controlsCtor)}}async onAdded(e){await super.onAdded(e),this._cameraChanged({camera:e.scene.activeCamera}),e.scene.addEventListener("activeCameraChange",this._cameraChanged)}async onRemove(e){return this._cameraChanged({lastCamera:e.scene.activeCamera}),e.scene.removeEventListener("activeCameraChange",this._cameraChanged),super.onRemove(e)}}var NM=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};const s2=new _.Pa4(0,0,1),UM=new _.USm,o2=new _._fP,a2=new _._fP(-Math.sqrt(.5),0,0,Math.sqrt(.5)),fv=new _._fP,l2={type:"change"};let vA=class extends oe{constructor(c){super(),this.enabled=!1,this.lastOrder="XYZ",this.dampingFactor=.05,this.lastQuaternion=new _._fP,this.onDeviceOrientationChangeEvent=e=>{this.deviceOrientation=e},this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this._initQuaternion=new _._fP,this._initQuaternionInvert=new _._fP,this._initQuaternionDest=new _._fP,this._lastTime=-1,window.isSecureContext===!1&&console.error("DeviceOrientationControls2: DeviceOrientationEvent is only available in secure contexts (https)"),this.object=c,this.lastOrder=this.object.rotation.order,this.object.rotation.reorder("YXZ"),this.connect()}connect(){this.onScreenOrientationChangeEvent(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(c=>{c=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(c=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",c)}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0,this._initQuaternion.copy(this.object.quaternion),this._initQuaternionInvert.copy(this.object.quaternion).invert()}disconnect(){window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternion.identity(),this._initQuaternionInvert.identity(),this._initQuaternionDest=new _._fP,this.object.rotation.reorder(this.lastOrder),this.lastOrder="XYZ",this.enabled=!1}update(){if(!this.enabled)return;const c=this.deviceOrientation;if(c){const e=c.alpha!==null?_.M8C.degToRad(c.alpha):0,i=c.beta!==null?_.M8C.degToRad(c.beta):0,s=c.gamma!==null?_.M8C.degToRad(c.gamma):0,a=this.screenOrientation?_.M8C.degToRad(this.screenOrientation.angle):0;this.setObjectQuaternion(e,i,s,a),8*(1-this.lastQuaternion.dot(this.object.quaternion))>1e-6&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(l2))}}dispose(){this.disconnect()}setObjectQuaternion(c,e,i,s){const a=ia()/1e3;UM.set(e,c,-i,"YXZ"),fv.setFromEuler(UM),fv.multiply(a2),fv.multiply(o2.setFromAxisAngle(s2,-s)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(fv).invert(),this._initQuaternionDest.__init=!0),fv.premultiply(this._initQuaternionDest),this.object.quaternion.slerp(fv,this.dampingFactor/(Math.min(1,a-this._lastTime)/(1/60))),this._lastTime=a}};NM([kt(),ai("Damping",[0,1],.01)],vA.prototype,"dampingFactor",void 0),vA=NM([Ju("Device Orientation Controls")],vA);class J1 extends Cw{constructor(){super(...arguments),this.controlsKey="deviceOrientation",this._controlsCtor=(e,i)=>new vA(e)}}J1.PluginType="DeviceOrientationControlsPlugin";var Qa=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};const FM=new _.Pa4,$1=new _.$V,Z1=new _.Pa4,c2={type:"change"};let $o=class extends oe{constructor(c,e){super(),this.enabled=!0,this.enableKeys=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.viewHalfX=0,this.viewHalfY=0,this.lat=0,this.lon=0,this.targetPosition=new _.Pa4,this._lastTime=-1,this.object=c,this.domElement=e,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("mousemove",this.onMouseMove),this.domElement.addEventListener("mousedown",this.onMouseDown),this.domElement.addEventListener("mouseup",this.onMouseUp),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize(),this.setOrientation()}setOrientation(){const c=this.object.quaternion;FM.set(0,0,-1).applyQuaternion(c),$1.setFromVector3(FM),this.lat=90-_.M8C.radToDeg($1.phi),this.lon=_.M8C.radToDeg($1.theta)}handleResize(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}onMouseDown(c){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(c.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0}onMouseUp(c){if(this.activeLook)switch(c.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1}onMouseMove(c){this.domElement===document?(this.mouseX=c.pageX-this.viewHalfX,this.mouseY=c.pageY-this.viewHalfY):(this.mouseX=c.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=c.pageY-this.domElement.offsetTop-this.viewHalfY)}onKeyDown(c){if(this.enableKeys)switch(c.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}}onKeyUp(c){if(this.enableKeys)switch(c.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}}lookAt(c,e,i){return c.isVector3?Z1.copy(c):e===void 0||i===void 0?console.error("FirstPersonControls2.lookAt: y and z parameters are required"):Z1.set(c,e,i),this.object.lookAt(Z1),this.setOrientation(),this}update(){const c=ia(),e=(this._lastTime<0?16:Math.min(c-this._lastTime,1e3))/1e3;if(this._lastTime=c,!this.enabled)return;if(this.heightSpeed){const X=_.M8C.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(X*this.heightCoef)}else this.autoSpeedFactor=0;const i=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(i+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(i),this.moveLeft&&this.object.translateX(-i),this.moveRight&&this.object.translateX(i),this.moveUp&&this.object.translateY(i),this.moveDown&&this.object.translateY(-i);let s=e*this.lookSpeed;this.activeLook||(s=0);let a=1;this.constrainVertical&&(a=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.mouseX*s,this.lookVertical&&(this.lat-=this.mouseY*s*a),this.lat=Math.max(-85,Math.min(85,this.lat));let h=_.M8C.degToRad(90-this.lat);const d=_.M8C.degToRad(this.lon);this.constrainVertical&&(h=_.M8C.mapLinear(h,0,Math.PI,this.verticalMin,this.verticalMax));const b=this.object.position;this.targetPosition.setFromSphericalCoords(1,h,d).add(b),this.object.lookAt(this.targetPosition),this.dispatchEvent(c2)}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("mousedown",this.onMouseDown),this.domElement.removeEventListener("mousemove",this.onMouseMove),this.domElement.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}onContextMenu(c){this.enableKeys&&c.preventDefault()}};Qa([kt(),Xn()],$o.prototype,"enabled",void 0),Qa([kt(),Xn()],$o.prototype,"enableKeys",void 0),Qa([kt(),cr()],$o.prototype,"movementSpeed",void 0),Qa([kt(),cr()],$o.prototype,"lookSpeed",void 0),Qa([kt(),Xn()],$o.prototype,"lookVertical",void 0),Qa([kt(),Xn()],$o.prototype,"autoForward",void 0),Qa([kt(),Xn()],$o.prototype,"activeLook",void 0),Qa([kt(),Xn()],$o.prototype,"heightSpeed",void 0),Qa([kt(),cr()],$o.prototype,"heightCoef",void 0),Qa([kt(),cr()],$o.prototype,"heightMin",void 0),Qa([kt(),cr()],$o.prototype,"heightMax",void 0),Qa([kt(),Xn()],$o.prototype,"constrainVertical",void 0),Qa([kt(),cr()],$o.prototype,"verticalMin",void 0),Qa([kt(),cr()],$o.prototype,"verticalMax",void 0),Qa([kt(),Xn()],$o.prototype,"mouseDragOn",void 0),$o=Qa([ur("First Person Controls")],$o);class eE extends Cw{constructor(){super(...arguments),this.controlsKey="firstPerson",this._controlsCtor=(e,i)=>new $o(e,i)}}eE.PluginType="FirstPersonControlsPlugin";var mv=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};const gv=new _.USm(0,0,0,"YXZ"),_v=new _.Pa4,u2={type:"change"},h2={type:"lock"},d2={type:"unlock"},jM=Math.PI/2;let cp=class extends oe{constructor(c,e){super(),this.isLocked=!1,this.enabled=!0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this.autoLockOnClick=!0,this._movementX=0,this._movementY=0,this._forwardDirection=new _.Pa4(0,0,-1),this.domElement=e,this.object=c,this.onElementClick=this.onElementClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onPointerlockChange=this.onPointerlockChange.bind(this),this.onPointerlockError=this.onPointerlockError.bind(this),this.connect()}onElementClick(c){this.isLocked||this.autoLockOnClick&&(c.preventDefault(),this.lock())}onMouseMove(c){this.isLocked&&(this._movementX+=c.movementX||c.mozMovementX||c.webkitMovementX||0,this._movementY+=c.movementY||c.mozMovementY||c.webkitMovementY||0)}onPointerlockChange(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(h2),this.isLocked=!0):(this.dispatchEvent(d2),this.isLocked=!1)}onPointerlockError(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.addEventListener("click",this.onElementClick)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.removeEventListener("click",this.onElementClick)}dispose(){this.disconnect()}getDirection(c){return c.copy(this._forwardDirection).applyQuaternion(this.object.quaternion)}moveForward(c){_v.setFromMatrixColumn(this.object.matrix,0),_v.crossVectors(this.object.up,_v),this.object.position.addScaledVector(_v,c)}moveRight(c){_v.setFromMatrixColumn(this.object.matrix,0),this.object.position.addScaledVector(_v,c)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}update(){this._movementX<1e-4||this._movementY<1e-4||(gv.setFromQuaternion(this.object.quaternion),gv.y-=.002*this._movementX*this.pointerSpeed,gv.x-=.002*this._movementY*this.pointerSpeed,this._movementX=0,this._movementY=0,gv.x=Math.max(jM-this.maxPolarAngle,Math.min(jM-this.minPolarAngle,gv.x)),this.object.quaternion.setFromEuler(gv),this.dispatchEvent(u2))}};mv([Xn(),kt()],cp.prototype,"enabled",void 0),mv([cr(),kt()],cp.prototype,"minPolarAngle",void 0),mv([cr(),kt()],cp.prototype,"maxPolarAngle",void 0),mv([cr(),kt()],cp.prototype,"pointerSpeed",void 0),mv([Xn(),kt()],cp.prototype,"autoLockOnClick",void 0),cp=mv([Ju("Pointer Lock Controls")],cp);class tE extends Cw{constructor(){super(...arguments),this.controlsKey="pointerLock",this._controlsCtor=(e,i)=>new cp(e,i.ownerDocument?i:i.documentElement)}}tE.PluginType="PointerLockControlsPlugin";var p2=__webpackgi_require__(819);class ru{static _initialize(){this._inited=!0,th(Qe`
          #customContextMenu {
            background: #2c2c2e99;
            backdrop-filter: blur(8px);
            border: 0.5px solid rgba(20, 20, 20, 0.3);
            width: auto;
            height: auto;
            position: absolute;
            display: flex;
            flex-direction: column;
            z-index: 9999;
            padding: 0.35rem 0.20rem;
            border-radius: 0.375rem;
            min-width: 6rem;
            pointer-events: auto;
            box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);
          }

          .customContextMenuItems {
            color: white;
            font-size: 0.65rem;
            font-family: "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
            background-color: transparent;
            cursor: pointer;
            padding: 0.12rem 0.35rem;
            border-radius: 0.25rem;
            line-height: 1rem;
            font-weight: 500;
          }

          .customContextMenuItems:hover {
            color: white;
            background-color: #017AFF;
          }
        `),document.addEventListener("mouseup",e=>{this.Element&&!this.Element.contains(e.target)&&this.Remove()})}static Create(e,i,s){this._inited||this._initialize(),this.Element&&this.Remove();const a=ma({id:"customContextMenu",addToBody:!1});a.style.top=s+"px",a.style.left=i+"px";for(const[h,d]of Object.entries(e)){const b=ma({classList:["customContextMenuItems"],addToBody:!1,innerHTML:h});a.appendChild(b),b.onclick=d}return this.Element=a,a}static Remove(){var e;(e=this.Element)===null||e===void 0||e.remove(),this.Element=void 0}}ru.Element=void 0,ru._inited=!1;var f2=__webpackgi_require__(665);const m2=(c,e,i)=>{var s,a,h;const d=c.controller_,b=(a=(s=d.parent)===null||s===void 0?void 0:s.children)===null||a===void 0?void 0:a.indexOf(d);return!((($,Z)=>Z.controller_.rackController.rack===$.controller_.parent)(c,e)&&b===i||(b!==void 0&&b>=0&&((h=d.parent)===null||h===void 0||h.remove(c)),e.add(c,i),0))},zM=(c,e,i,s)=>{var a,h,d,b,X;let $=e.uiRef;const Z=$==null?void 0:$.expanded;if($||($=c.addFolder({title:""}),$.on("fold",Ee=>{var Ae,ye,ge;let Pe=$.expanded;nt(e,"expanded",Pe,!0),Pe=(Ae=st(e.expanded))!==null&&Ae!==void 0?Ae:Pe,Pe!==$.expanded&&($.expanded=Pe),(ye=e.uiRefresh)===null||ye===void 0||ye.call(e,"postFrame",!0),Pe&&((ge=e.onExpand)===null||ge===void 0||ge.call(e,e))})),!$)return $;$.expanded=(h=(a=st(e.expanded))!==null&&a!==void 0?a:Z)!==null&&h!==void 0&&h;const re=((d=e.children)!==null&&d!==void 0?d:[]).map(Ee=>Ee&&st(Ee)).flat(2).filter(Ee=>Ee);let le=0;for(const Ee of re){let Ae=Ee.uiRef;Ae&&Ae.controller_.viewProps.get("disposed")&&(Ee.uiRef=void 0),Ae=Ee.uiRef,Ae||(i.appendUiObject({uiConfig:Ee},$),Ae=Ee.uiRef),Ae&&m2(Ae,$,le++)&&i.appendUiObject({uiConfig:Ee},$)}let he=$.children;for(;he.length>le;){const Ee=he[he.length-1];$.remove(Ee),he=$.children}$.controller_.props.set("title",(b=st(e.label))!==null&&b!==void 0?b:"");const fe=$.controller_.view.containerElement,me=st(e.domChildren,[]);if((me==null?void 0:me.length)!==void 0){const Ee=[];for(let Ae=0;Ae<fe.children.length;Ae++){const ye=fe.children[Ae];!((X=ye.dataset)===null||X===void 0)&&X.tpCustomDOM&&Ee.push(ye)}for(const Ae of Ee)fe.removeChild(Ae);for(const Ae of me)Ae.parentElement!==fe&&(fe.appendChild(Ae),Ae.dataset.tpCustomDOM="true");$.controller_.foldable.cleanUpTransition()}return $},g2=(c,e,i,s)=>{var a,h;const[d,b]=(a=e.property)!==null&&a!==void 0?a:[void 0,void 0],X=(h=st(e.label))!==null&&h!==void 0?h:b;let $=e.uiRef;return $||($=c.addButton({title:""}),$.on("click",async()=>{var Z;const re=[];e.prompt&&re.push(await i.prompt(...e.prompt));const le=(Z=d&&b?d[b]:void 0)!==null&&Z!==void 0?Z:e.value;if(typeof le=="function"){const he=()=>{i.removeEventListener("postFrame",he),le(...re)};i.addEventListener("postFrame",he)}else console.warn("Invalid action type for button")})),$&&($.title=X??"click me"),$},_2=(c,e,i,s)=>{var a;const h=Object.fromEntries(((a=st(e.children))!==null&&a!==void 0?a:[]).map(d=>st(d)).flat(2).filter(d=>d).map(d=>{var b;const X=st(d.label);return[X,(b=d.value)!==null&&b!==void 0?b:X]}));return Kh(c,e,i,{options:h,...s??{}})},v2=(c,e,i,s)=>{var a,h;const d=st(e.bounds),b=((a=d==null?void 0:d.length)!==null&&a!==void 0?a:0)>=2?d[1]:1,X=((h=d==null?void 0:d.length)!==null&&h!==void 0?h:0)>=1?d[0]:0,$=e.stepSize||void 0;return Kh(c,e,i,{min:X,max:b,step:$,...s??{}})},Mw=(c,e,i,s)=>{var a,h,d;const b=st(e.bounds);if(!b||b.length<1)return Kh(c,e,i,{...s??{}});const X=((a=b.length)!==null&&a!==void 0?a:0)>=2?b[1]:1,$=((h=b.length)!==null&&h!==void 0?h:0)>=1?b[0]:0,Z={min:$,max:X,step:(d=e.stepSize)!==null&&d!==void 0?d:(X-$)/100},re={x:Z,y:Z};e.type!=="vec3"&&e.type!=="vec4"||(re.z=Z),e.type==="vec4"&&(re.w=Z);const le=e.property;if(e.value===void 0&&le&&le[0]&&typeof le[0]=="object"&&le[0][le[1]]&&Array.isArray(le[0][le[1]])){const[he,fe]=le,me=he[fe],Ee=me.length,Ae=new(Ee===2?_.FM8:Ee===3?_.Pa4:_.Ltg)().fromArray(me);e.value=Ae,e.property=void 0,e.onChange=[()=>{he[fe]=Ae.toArray()},...Array.isArray(e.onChange)?e.onChange:[e.onChange]].filter(ye=>ye),e.label===void 0&&(e.label=fe)}return Kh(c,e,i,{...re,...s??{}})},A2=(c,e,i,s)=>{var a;const h=e.property;if(e.value===void 0&&h&&typeof h[0]=="object"&&(!((a=h[0][h[1]])===null||a===void 0)&&a.isColor)){const[d,b]=h,X=new oi().set(d[b]).convertSRGBToLinear();Object.defineProperty(e,"value",{get:()=>{const $=d[b];return $?X.set($).convertLinearToSRGB().getHex():0},set:$=>{const Z=d[b];X.setHex($).convertSRGBToLinear(),Z.isColor?Z.copy(X):typeof Z=="number"?d[b]=X.getHex():typeof Z=="string"&&(d[b]="#"+X.getHexString()),typeof(d==null?void 0:d.setDirty)=="function"&&d.setDirty()}}),e.property=void 0,e.onChange=[...Array.isArray(e.onChange)?e.onChange:[e.onChange]].filter($=>$),e.label===void 0&&(e.label=b)}return(s=s??{}).view="color",st(e.inlinePicker)&&(s.picker="inline"),Kh(c,e,i,s)},Kh=(c,e,i,s)=>{var a;let h=st(e.property);if((e.getValue||e.setValue)&&h&&console.error("specify either property or value, or getValue and setValue",e),h)e.value&&console.warn("Both property and value are defined, value will be ignored",e);else if(e.value===void 0&&(e.getValue||e.setValue)&&(Object.defineProperty(e,"value",{get:()=>{var X;return(X=e.getValue)===null||X===void 0?void 0:X.call(e)},set:X=>{var $;return($=e.setValue)===null||$===void 0?void 0:$.call(e,X)}}),h=[e,"value"]),h||e.value===void 0||(h=[e,"value"]),!h)return void console.error("cannot determine property",e);s=s??{};const d={label:(a=st(e.label))!==null&&a!==void 0?a:h[1],...s};let b=e.uiRef;if(!b&&typeof h[0]=="object"&&h[0]){const[X,$]=h;try{b=e.isMonitor?c.addMonitor(X,$,d):c.addInput(X,$,d).on("change",Z=>{[e.onChange].flat().forEach(re=>typeof re=="function"&&(re==null?void 0:re(Z))),typeof(X==null?void 0:X.setDirty)=="function"&&X.setDirty(Z)})}catch(Z){if(!Z.message.startsWith("No matching controller for"))throw Z;b=void 0}}if(b){for(const[X,$]of Object.entries(d)){const Z=b.controller_.props.value(X);Z!==void 0&&Z.rawValue!==$&&b.controller_.props.set(X,$)}e.type==="slider"&&(d.min!==void 0&&b.controller_.valueController.sliderController.props.set("minValue",d.min),d.max!==void 0&&b.controller_.valueController.sliderController.props.set("maxValue",d.max)),b.refresh()}return b};class VM extends oe{constructor(e=!1,i=!1,s=!1,a=!0,h=document.body){super(),this._refreshQueue={preRender:[],postRender:[],preFrame:[],postFrame:[]},this._lastModeTime={preRender:0,postRender:0,preFrame:0,postFrame:0},this._typeGenerators={panel:zM,folder:zM,input:Kh,slider:v2,dropdown:_2,checkbox:Kh,color:A2,vec:Mw,vec2:Mw,vec3:Mw,vec4:Mw,button:g2,monitor:(b,X,$,Z)=>(X.isMonitor=!0,Kh(b,X,$,Z)),dummy:(b,X,$,Z)=>Kh(b,X,$,Z)},this.alert=async b=>alert(b),this.confirm=async b=>confirm(b),this.prompt=async(b,X,$=!0)=>prompt(b,X),this._expand=e,this._limitedOptions=s;const d=this._createUiContainer();h.appendChild(d),this._pane=new f2.Pane({title:"Configuration",container:d}),this._pane.expanded=this._expand,a&&(this.addEventListener("postFrame",()=>this.refreshQueue("postFrame")),setTimeout(()=>{this.dispatchEvent({type:"postFrame"})},32))}refreshQueue(e){const i=this._refreshQueue[e],s=[],a=ia(),h=a-this._lastModeTime[e];i.forEach(d=>{d[2]>.001?(d[2]-=h,s.push(d)):this._refreshUiObject(d[0],d[1],d[2])}),this._refreshQueue[e]=s,this._lastModeTime[e]=a}addToRefreshQueue(e,i){var s;const a=(s=i[0])===null||s===void 0?void 0:s.uiConfig,h=a==null?void 0:a.uuid,d=this._refreshQueue[e],b=d.find(X=>X[3]===h);b?b[2]=Math.max(b[2],i[2]):d.push([...i,h]),this._refreshQueue[e]=d}dispose(){var e;(e=this._pane)===null||e===void 0||e.dispose(),this._pane=void 0}appendUiObject(e,i){e&&this._appendUiObject(e,i)}_appendUiObject(e,i){var s,a,h,d;const{uiConfig:b}=e??{};if(b&&(!this._limitedOptions||b.limitedUi)&&(i=i??this._pane,b.type)){b.uuid||(b.uuid=Ms()),b.uiRef&&b.uiRefType!==b.type&&this.removeUiConfig(b);const X=(a=(s=this._typeGenerators)[b.type])===null||a===void 0?void 0:a.call(s,i,b,this);X&&(X.hidden=(h=st(b.hidden))!==null&&h!==void 0&&h,X.disabled=(d=st(b.disabled))!==null&&d!==void 0&&d),b.uiRef=X,b.uiRefType=X?b.type:void 0,b.uiRefresh=($="postFrame",Z=!1,re=0)=>{var le;return this._uiObjectRefresh($,(le=e==null?void 0:e.uiConfig)!==null&&le!==void 0?le:b,i,Z,re)}}}removeUiObject(e){this.removeUiConfig(e==null?void 0:e.uiConfig)}removeUiConfig(e){var i,s;e&&e.uiRef&&((s=(i=e.uiRef).dispose)===null||s===void 0||s.call(i),e.uiRef=void 0,e.uiRefType=void 0,e.uiRefresh=void 0)}_uiObjectRefresh(e,i,s,a,h){(a?nE(i,s):[{uiConfig:i,parentFolder:s}]).forEach(d=>{const b=[{uiConfig:d.uiConfig},d.parentFolder,h];e==="immediate"?this._refreshUiObject(...b):this.addToRefreshQueue(e,b)})}_refreshUiObject(e,i,s=0){this._appendUiObject(e,i),s>1e-4&&console.error("no support for immediate delay")}_createUiContainer(){const e=ma({id:"tweakpaneUiContainer",addToBody:!1});return th(Qe`
          :root{
            --tweakpane-ui-container-width: 300px;
          }
          @media only screen and (min-width: 1500px) {
            :root{
              --tweakpane-ui-container-width: 300px;
            }
          }
          @media only screen and (min-width: 2500px) {
            :root{
              --tweakpane-ui-container-width: 500px;
            }
          }
          #tweakpaneUiContainer {
            position: fixed;
            top: 0px;
            padding-right: 4px;
            padding-bottom: 10px;
            right: 10px;
            width: var(--tweakpane-ui-container-width);
            height: auto;
            overflow-y: scroll;
            z-index: 100;
            pointer-events: auto;
            max-height: calc(100% - 6rem);
            border-radius: 0.5rem;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "system-ui", "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
          }
        `),e}}function nE(c,e,i){var s;return i=i??[],c&&(i.push({uiConfig:c,parentFolder:e}),(s=c.children)===null||s===void 0||s.forEach(a=>i=nE(a,c.uiRef,i))),i}class iE{constructor(){iE.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,i,s,a,h,d,b,X,$){const Z=this.elements;return Z[0]=e,Z[1]=a,Z[2]=b,Z[3]=i,Z[4]=h,Z[5]=X,Z[6]=s,Z[7]=d,Z[8]=$,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,s=e.elements;return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],this}extractBasis(e,i,s){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const s=e.elements,a=i.elements,h=this.elements,d=s[0],b=s[3],X=s[6],$=s[1],Z=s[4],re=s[7],le=s[2],he=s[5],fe=s[8],me=a[0],Ee=a[3],Ae=a[6],ye=a[1],ge=a[4],Pe=a[7],Be=a[2],Oe=a[5],Fe=a[8];return h[0]=d*me+b*ye+X*Be,h[3]=d*Ee+b*ge+X*Oe,h[6]=d*Ae+b*Pe+X*Fe,h[1]=$*me+Z*ye+re*Be,h[4]=$*Ee+Z*ge+re*Oe,h[7]=$*Ae+Z*Pe+re*Fe,h[2]=le*me+he*ye+fe*Be,h[5]=le*Ee+he*ge+fe*Oe,h[8]=le*Ae+he*Pe+fe*Fe,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],s=e[1],a=e[2],h=e[3],d=e[4],b=e[5],X=e[6],$=e[7],Z=e[8];return i*d*Z-i*b*$-s*h*Z+s*b*X+a*h*$-a*d*X}invert(){const e=this.elements,i=e[0],s=e[1],a=e[2],h=e[3],d=e[4],b=e[5],X=e[6],$=e[7],Z=e[8],re=Z*d-b*$,le=b*X-Z*h,he=$*h-d*X,fe=i*re+s*le+a*he;if(fe===0)return this.set(0,0,0,0,0,0,0,0,0);const me=1/fe;return e[0]=re*me,e[1]=(a*$-Z*s)*me,e[2]=(b*s-a*d)*me,e[3]=le*me,e[4]=(Z*i-a*X)*me,e[5]=(a*h-b*i)*me,e[6]=he*me,e[7]=(s*X-$*i)*me,e[8]=(d*i-s*h)*me,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,s,a,h,d,b){const X=Math.cos(h),$=Math.sin(h);return this.set(s*X,s*$,-s*(X*d+$*b)+d+e,-a*$,a*X,-a*(-$*d+X*b)+b+i,0,0,1),this}scale(e,i){const s=this.elements;return s[0]*=e,s[3]*=e,s[6]*=e,s[1]*=i,s[4]*=i,s[7]*=i,this}rotate(e){const i=Math.cos(e),s=Math.sin(e),a=this.elements,h=a[0],d=a[3],b=a[6],X=a[1],$=a[4],Z=a[7];return a[0]=i*h+s*X,a[3]=i*d+s*$,a[6]=i*b+s*Z,a[1]=-s*h+i*X,a[4]=-s*d+i*$,a[7]=-s*b+i*Z,this}translate(e,i){const s=this.elements;return s[0]+=e*s[2],s[3]+=e*s[5],s[6]+=e*s[8],s[1]+=i*s[2],s[4]+=i*s[5],s[7]+=i*s[8],this}equals(e){const i=this.elements,s=e.elements;for(let a=0;a<9;a++)if(i[a]!==s[a])return!1;return!0}fromArray(e,i=0){for(let s=0;s<9;s++)this.elements[s]=e[s+i];return this}toArray(e=[],i=0){const s=this.elements;return e[i]=s[0],e[i+1]=s[1],e[i+2]=s[2],e[i+3]=s[3],e[i+4]=s[4],e[i+5]=s[5],e[i+6]=s[6],e[i+7]=s[7],e[i+8]=s[8],e}clone(){return new this.constructor().fromArray(this.elements)}}function GM(c){return document.createElementNS("http://www.w3.org/1999/xhtml",c)}let vv;class y2{constructor(e=null){this.isSource=!0,this.uuid=$t(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const s={uuid:this.uuid,url:""},a=this.data;if(a!==null){let h;if(Array.isArray(a)){h=[];for(let d=0,b=a.length;d<b;d++)a[d].isDataTexture?h.push(rE(a[d].image)):h.push(rE(a[d]))}else h=rE(a);s.url=h}return i||(e.images[this.uuid]=s),s}}function rE(c){if(typeof HTMLImageElement<"u"&&c instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&c instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&c instanceof ImageBitmap)return class{static getDataURL(e,i=!1){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let s;if(e instanceof HTMLCanvasElement)s=e;else{vv===void 0&&(vv=GM("canvas")),vv.width=e.width,vv.height=e.height;const a=vv.getContext("2d");e instanceof ImageData?a.putImageData(e,0,0):a.drawImage(e,0,0,e.width,e.height),s=vv}return!i&&(s.width>2048||s.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),s.toDataURL("image/jpeg",.6)):s.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const i=GM("canvas");i.width=e.width,i.height=e.height;const s=i.getContext("2d");s.drawImage(e,0,0,e.width,e.height);const a=s.getImageData(0,0,e.width,e.height),h=a.data;for(let d=0;d<h.length;d++)h[d]=255*rr(h[d]/255);return s.putImageData(a,0,0),i}if(e.data){const i=e.data.slice(0);for(let s=0;s<i.length;s++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[s]=Math.floor(255*rr(i[s]/255)):i[s]=rr(i[s]);return{data:i,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}.getDataURL(c);if(c.data){let e=[];try{e=Array.from(c.data)}catch(i){i.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(i),e=c.data}return{data:e,width:c.width,height:c.height,type:c.data.constructor.name}}return console.warn("THREE.Texture: Unable to serialize Texture."),{}}let b2=0;class Av extends class{addEventListener(e,i){this._listeners===void 0&&(this._listeners={});const s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(i)===-1&&s[e].push(i)}hasEventListener(e,i){if(this._listeners===void 0)return!1;const s=this._listeners;return s[e]!==void 0&&s[e].indexOf(i)!==-1}removeEventListener(e,i){if(this._listeners===void 0)return;const s=this._listeners[e];if(s!==void 0){const a=s.indexOf(i);a!==-1&&s.splice(a,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const s=i.slice(0);for(let a=0,h=s.length;a<h;a++)s[a].call(this,e);e.target=null}}}{constructor(e=Av.DEFAULT_IMAGE,i=Av.DEFAULT_MAPPING,s=1001,a=1001,h=Tr,d=1008,b=1023,X=1009,$=1,Z=3e3){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:b2++}),this.uuid=$t(),this.name="",this.source=new y2(e),this.mipmaps=[],this.mapping=i,this.wrapS=s,this.wrapT=a,this.magFilter=h,this.minFilter=d,this.anisotropy=$,this.format=b,this.internalFormat=null,this.type=X,this.offset=new dn(0,0),this.repeat=new dn(1,1),this.center=new dn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new iE,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=Z,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const s={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(s.userData=this.userData),i||(e.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==300)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}}Av.DEFAULT_IMAGE=null,Av.DEFAULT_MAPPING=300;var Tw=__webpackgi_require__(898),AA={};Tw.Z&&Tw.Z.locals&&(AA.locals=Tw.Z.locals);var sE,oE=0,lg={};lg.styleTagTransform=Em(),lg.setAttributes=xm(),lg.insert=function(c,e){(e.target||document.head).appendChild(c)},lg.domAPI=A_(),lg.insertStyleElement=Xc(),AA.use=function(c){return lg.options=c||{},oE++||(sE=Jp()(Tw.Z,lg)),AA},AA.unuse=function(){oE>0&&!--oE&&(sE(),sE=null)};var w2=AA;class aE extends VM{constructor(e=!1,i=!1,s=!1,a=document.body){super(e,i,s,!1),this.dependencies=[Kn],this._preRender=()=>this.refreshQueue("preRender"),this._postRender=()=>this.refreshQueue("postRender"),this._postFrame=h=>{this.dispatchEvent(h),this.refreshQueue("postFrame")},this._preFrame=()=>this.refreshQueue("preFrame"),this._plugins=[],this.alert=async h=>this._viewer?this._viewer.alert(h):super.alert(h),this.confirm=async h=>this._viewer?this._viewer.confirm(h):super.confirm(h),this.prompt=async(h,d,b=!0)=>this._viewer?this._viewer.prompt(h,d,b):super.prompt(h,d,b),this._pane.registerPlugin(p2),w2.use({target:a})}async onAdded(e){this._viewer=e,this._typeGenerators.image=(i=>(s,a,h,d)=>{const b=a.property,X="placeholder";if(a.value===void 0&&b&&typeof b[0]=="object"){const[$,Z]=b,re=Z0("Render Target"),le=Z0("Data Texture"),he=Z0("CUBE Texture"),fe=Z0("Compressed Texture"),me={},Ee={};Object.defineProperty(a,"value",{get:()=>{var Ae;let ye,ge=$[Z];if(ge!=null&&ge.get&&(ge=ge.get()),!ge)return X;if(ge.isRenderTargetTexture&&!ge.image.tp_src&&(ge.image.tp_src=re),ge.isDataTexture&&!ge.image.tp_src&&(ge.image.tp_src=le),ge.isCompressedTexture&&!ge.image.tp_src&&(ge.image.tp_src=fe),ge.isTexture?(ge.image&&(ge.image instanceof ImageBitmap||ge.image instanceof HTMLImageElement||ge.image instanceof HTMLVideoElement)&&!ge.image.tp_src&&(ge.image.tp_src=na(ge.image,160)),ge.image&&(ye=ge.image.tp_src_uuid,ye=ye?me[ye]:void 0,ye||(ye=ge.image.tp_src||ge.image.src))):typeof ge=="string"?ye=ge:ge.domainMin?(ye=ge.texture,ge.texture.image&&!ge.texture.image.tp_src&&(ge.texture.image.tp_src=he),ge.texture.image&&(ye=ge.texture.image.tp_src_uuid,ye=ye?me[ye]:void 0,ye||(ye=ge.texture.image.tp_src||ge.texture.image.src))):ge&&console.error("unknown value",ge),ye||(ye=X),ge.image&&!ge.image.tp_src_uuid){const Pe=Ms();ge.image.tp_src_uuid=Pe,Ee[ye]=Pe}return typeof ye=="string"&&(ye=(Ae=me[ye])!==null&&Ae!==void 0?Ae:ye),ye},set:Ae=>{var ye,ge,Pe,Be,Oe,Fe,Xe,at,mt,wt,At;const Tt=$[Z],yt=Ft=>{var Mt;$[Z]=Ft,Ft!=null&&Ft.isTexture&&(Ft.flipY=Ft.isDataTexture?Ft.flipY:(Mt=Tt==null?void 0:Tt.flipY)===null||Mt===void 0||Mt)};if(typeof Ae=="string")return void(typeof Tt=="string"&&yt(Ae));if(!Ae)return void(a.value=X);if(Ae.isPlaceholder)return void(Tt&&(yt(typeof Tt=="string"?"":null),typeof($==null?void 0:$.setDirty)=="function"&&$.setDirty()));let St=Ae.tp_src_uuid;if(St||(St=(ye=Ae.src)!==null&&ye!==void 0?ye:Ae.tp_src,St=(ge=Ee[St])!==null&&ge!==void 0?ge:St,delete Ee[St],Ae.tp_src_uuid=St),St&&(me[St]=Ae),typeof Tt!="string"){if(!((Tt==null?void 0:Tt.image)===Ae||((Pe=Tt==null?void 0:Tt.image)===null||Pe===void 0?void 0:Pe.src)===Ae.src||((Be=Tt==null?void 0:Tt.image)===null||Be===void 0?void 0:Be.tp_src)===Ae.tp_src&&Ae.tp_src!=null||((Oe=Tt==null?void 0:Tt.image)===null||Oe===void 0?void 0:Oe.tp_src)===Ae.src&&Ae.src!=null||((Fe=Tt==null?void 0:Tt.image)===null||Fe===void 0?void 0:Fe.src)===Ae.tp_src&&Ae.tp_src!=null))if(Ae instanceof File){const Ft=i==null?void 0:i.getPlugin(Kn);if(!Ft)throw"Viewer or AssetManagerPlugin not found";(Xe=Ft.importer)===null||Xe===void 0||Xe.importSingle({file:Ae,path:Ae.src}).then(Mt=>{var Gt,rn,gn,Kt;if(Mt){Mt.isDataTexture&&(Mt.needsUpdate=!0);const In=(gn=(rn=(Gt=Ae.src)===null||Gt===void 0?void 0:Gt.split("?"))===null||rn===void 0?void 0:rn[0])===null||gn===void 0?void 0:gn.split(".").pop();Mt.userData&&(Mt.userData.mimeType||(Mt.userData.mimeType="image/"+(["jpg","jpeg"].includes(In)?"jpeg":"png"))),yt(Mt),[a.onChange].flat().forEach(kn=>typeof kn=="function"&&(kn==null?void 0:kn())),typeof($==null?void 0:$.setDirty)=="function"&&$.setDirty(),(Kt=a.uiRefresh)===null||Kt===void 0||Kt.call(a,"postFrame",!1)}})}else{const Ft=new Av(Ae);Ft.assetType="texture",Ft.needsUpdate=!0;const Mt=(wt=(mt=(at=Ae.src)===null||at===void 0?void 0:at.split("?"))===null||mt===void 0?void 0:mt[0])===null||wt===void 0?void 0:wt.split(".").pop();Ft.userData.mimeType||(Ft.userData.mimeType="image/"+(["jpg","jpeg"].includes(Mt)?"jpeg":"png")),yt(Ft);const Gt=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(Z);Ft.encoding=Gt?_.rnI:_.knz,Ft.wrapS=_.rpg,Ft.wrapT=_.rpg,[a.onChange].flat().forEach(rn=>typeof rn=="function"&&(rn==null?void 0:rn())),typeof($==null?void 0:$.setDirty)=="function"&&$.setDirty(),(At=a.uiRefresh)===null||At===void 0||At.call(a,"postFrame",!1)}}else yt(St)}}),a.property=void 0,a.label===void 0&&(a.label=Z)}return(d=d??{}).extensions=[".jpg",".png",".svg",".hdr",".exr",".jpeg",".bmp",".gif",".webp",".cube"],d.imageFit===void 0&&(d.imageFit="contain"),d.clickCallback===void 0&&(d.clickCallback=($,Z)=>{var re;const le=$==null?void 0:$.target,he=le==null?void 0:le.getBoundingClientRect();if(!he)return void Z.click();const fe=a.uiRef.controller_.valueController.value.rawValue,me=fe===X||fe!=null&&fe.isPlaceholder?{}:{"remove image":()=>{var Ae;a.uiRef.controller_.valueController.value.setRawValue("");const[ye,ge]=b||[a,"value"],Pe=typeof ye[ge]=="string";ye[ge]=Pe?"":null,[a.onChange].flat().forEach(Be=>typeof Be=="function"&&(Be==null?void 0:Be())),typeof(ye==null?void 0:ye.setDirty)=="function"&&ye.setDirty(),(Ae=a.uiRefresh)===null||Ae===void 0||Ae.call(a,"postFrame",!1),ru.Remove()},"download image":()=>{var Ae,ye,ge;const[Pe,Be]=b||[a,"value"];let Oe=(ye=(Ae=Pe[Be])===null||Ae===void 0?void 0:Ae.image)!==null&&ye!==void 0?ye:a.uiRef.controller_.valueController.value.rawValue;Oe&&(Oe instanceof ImageBitmap||Oe instanceof HTMLImageElement||Oe instanceof HTMLVideoElement)&&!Oe.src&&(Oe=na(Oe));const Fe=document.createElement("a");document.body.appendChild(Fe),Fe.style.display="none",Fe.href=(ge=Oe==null?void 0:Oe.src)!==null&&ge!==void 0?ge:Oe,Fe.download="image.png",Fe.click(),document.body.removeChild(Fe),ru.Remove()}},Ee=ru.Create({...me,"set/replace image":()=>{Z.click(),ru.Remove()},"from url":async()=>{var Ae,ye;let ge="";if(ge&&(ge.startsWith("http")||ge.startsWith("data:image"))||(ge=""),ge=await h.prompt("Load texture: Enter Image/Texture URL",ge,!0),!ge||!ge.startsWith("http")&&!ge.startsWith("data:image"))return ge!==null&&await h.alert("Loading Image: Invalid URL"),void ru.Remove();const[Pe,Be]=b||[a,"value"],Oe=Pe[Be];if(typeof Oe=="string")Pe[Be]=ge,[a.onChange].flat().forEach(Fe=>typeof Fe=="function"&&(Fe==null?void 0:Fe())),typeof(Pe==null?void 0:Pe.setDirty)=="function"&&Pe.setDirty(),(Ae=a.uiRefresh)===null||Ae===void 0||Ae.call(a,"postFrame",!1);else{const Fe=i==null?void 0:i.getPlugin(Kn);if(!Fe)throw"Viewer or AssetManagerPlugin not found";(ye=Fe.importer)===null||ye===void 0||ye.importSinglePath(ge).then(Xe=>{var at;if(Xe){Xe.isDataTexture?Xe.needsUpdate=!0:Xe&&(Oe==null?void 0:Oe.flipY)!==void 0&&(Xe.flipY=Oe.flipY),Pe[Be]=Xe;const mt=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(Be);Xe.encoding=mt?_.rnI:_.knz,[a.onChange].flat().forEach(wt=>typeof wt=="function"&&(wt==null?void 0:wt())),typeof(Pe==null?void 0:Pe.setDirty)=="function"&&Pe.setDirty(),(at=a.uiRefresh)===null||at===void 0||at.call(a,"postFrame",!1)}})}ru.Remove()},cancel:()=>{ru.Remove()}},2,he.height+8);(re=le.parentElement)===null||re===void 0||re.appendChild(Ee),he.y>.7*document.body.clientHeight&&(Ee.style.top="auto",Ee.style.bottom=he.height+8+"px")}),d.view="input-image",Kh(s,a,h,d)})(this._viewer),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.addEventListener("preFrame",this._preFrame),e.addEventListener("postFrame",this._postFrame)}async onDispose(e){this.dispose()}async onRemove(e){this._viewer=void 0,e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),e.removeEventListener("preFrame",this._preFrame),e.removeEventListener("postFrame",this._postFrame),this.dispose()}setupPluginUi(e){var i;const s=(i=this._viewer)===null||i===void 0?void 0:i.getPlugin(e);if(!s)return void console.warn("plugin not found:",e);this._plugins.push(s),s.uiConfig&&(s.uiConfig.limitedUi=!0),s.uiConfig&&s.uiConfig.hidden===void 0&&(s.uiConfig.hidden=!1),this._appendUiObject(s);const a=s.uiConfig;if(a!=null&&a.uiRef&&s.toJSON){const h=a.uiRef.controller_.view.element,d=ma({innerHTML:"&#8942;",classList:["pluginOptionsButton"],elementTag:"button"});d.onclick=b=>{const X={};typeof s.toJSON=="function"&&(X["download preset"]=async()=>{var Z,re;const le=(re=(Z=this._viewer)===null||Z===void 0?void 0:Z.getPlugin(Kn))===null||re===void 0?void 0:re.exportPluginPreset(s);await ts(new Blob([JSON.stringify(le,null,2)],{type:"application/json"}),"preset."+s.constructor.PluginType+".json"),ru.Remove()}),typeof s.fromJSON=="function"&&(X["upload preset"]=async()=>{var Z,re;ru.Remove();const le=await ro(!1,!1);if(le.length===0)return;const he=le[0],fe=await he.text(),me=JSON.parse(fe);await((re=(Z=this._viewer)===null||Z===void 0?void 0:Z.getPlugin(Kn))===null||re===void 0?void 0:re.importPluginPreset(me,s))});const $=ru.Create(X,h.clientWidth-120,12);h.append($),b.preventDefault()},h.appendChild(d)}return a}setupPlugins(...e){e.forEach(i=>this.setupPluginUi(i))}refreshPluginsEnabled(){this._plugins.forEach(e=>{var i;const s=e.uiConfig;s&&(st(s.hidden)!==!0?(i=s.uiRefresh)===null||i===void 0||i.call(s,"postFrame",!0):s.uiRef&&(s.uiRef.hidden=!0))})}}aE.PluginType="TweakpaneUi";class Iw extends Xi{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.bgUIConfig={label:"Color",type:"color",inlinePicker:!0,srgb:!1,onChange:()=>{if(!this._viewer)return;const e=new oi(this.bgUIConfig.value||16777215).convertSRGBToLinear();this._viewer.setBackground(e.getHex())},expanded:!0,limitedUi:!0},this.uiConfig={label:"Background / Environment",type:"folder",expanded:!1,limitedUi:!0,children:[this.bgUIConfig,{label:"Image",property:[this,"sceneBackground"],type:"image",limitedUi:!0},{label:"EnvMap BG",type:"checkbox",property:[this,"envmapBg"]},()=>({type:"slider",label:"BG Intensity",property:[this._viewer,"backgroundIntensity"],bounds:[0,16]}),{label:"Set Transparent BG",type:"button",hidden:()=>!this._viewer||this._viewer.useRgbm,value:()=>{var e;(e=this._viewer)===null||e===void 0||e.setBackground(null)}},{label:"Environment",property:[this,"sceneEnvironment"],type:"image",limitedUi:!0},{type:"slider",label:"Env Rotation",property:[this,"sceneEnvironmentRotation"],bounds:[0,2*Math.PI],limitedUi:!0},{type:"slider",label:"Env Intensity",property:[this,"sceneEnvironmentIntensity"],bounds:[0,4],limitedUi:!0}]}}get sceneBackground(){var e;const i=(e=this._viewer)===null||e===void 0?void 0:e.getBackground();return i&&(i.isTexture||i.assetType==="texture")?i:null}set sceneBackground(e){var i,s;e?(i=this._viewer)===null||i===void 0||i.setBackground(e):(s=this._viewer)===null||s===void 0||s.setBackground(this.bgUIConfig.value)}get sceneEnvironment(){var e;return(e=this._viewer)===null||e===void 0?void 0:e.scene.getEnvironment()}set sceneEnvironment(e){var i;(i=this._viewer)===null||i===void 0||i.scene.setEnvironment(e)}get sceneEnvironmentRotation(){var e,i,s;return(s=(i=(e=this._viewer)===null||e===void 0?void 0:e.scene.getEnvironment())===null||i===void 0?void 0:i.rotation)!==null&&s!==void 0?s:0}set sceneEnvironmentRotation(e){var i,s;const a=(i=this._viewer)===null||i===void 0?void 0:i.scene.getEnvironment();a&&(a.rotation=e,(s=this._viewer)===null||s===void 0||s.scene.setDirty())}get sceneEnvironmentIntensity(){var e,i;return(i=(e=this._viewer)===null||e===void 0?void 0:e.scene.envMapIntensity)!==null&&i!==void 0?i:1}set sceneEnvironmentIntensity(e){var i;!((i=this._viewer)===null||i===void 0)&&i.scene&&(this._viewer.scene.envMapIntensity=e)}get envmapBg(){var e;return((e=this._viewer)===null||e===void 0?void 0:e.getBackground(!0))===Vc}set envmapBg(e){if(this._viewer)if(e){const i=this._viewer.getBackground(!0);i&&i!==Vc&&(this.lastBgVal=i),this._viewer.setBackground(Vc)}else this._viewer.getBackground()===this._viewer.scene.getEnvironment()&&this._viewer.setBackground(this.lastBgVal||this.bgUIConfig.value)}async onAdded(e){var i;await super.onAdded(e);const s=e.getBackground();this.bgUIConfig.value=typeof s=="string"&&s!==Vc||typeof s=="number"||!((i=s)===null||i===void 0)&&i.isColor?"#"+new oi(s).convertLinearToSRGB().getHexString():"#000000",this.lastBgVal=s}}Iw.PluginType="SimpleBackgroundEnvUiPlugin1";class Dw extends Xi{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this._uiConfig={type:"folder",label:"Scene Objects",children:[],onExpand:()=>{var e,i;(i=(e=this._uiConfig).uiRefresh)===null||i===void 0||i.call(e,"postFrame",!0)}},this._clearSceneButton={type:"button",label:"Clear Scene",value:()=>{var e;(e=this._viewer)===null||e===void 0||e.scene.disposeSceneModels()}},this._sceneUpdate=this._sceneUpdate.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get uiConfig(){var e,i,s;return this._viewer?(this._uiConfig.children=[this._clearSceneButton],this._uiConfig.children.push(...(s=(i=(e=this._viewer)===null||e===void 0?void 0:e.scene.modelRoot.modelObject.children)===null||i===void 0?void 0:i.map(a=>a.assetType==="light"?null:a.uiConfig).filter(a=>a!=null))!==null&&s!==void 0?s:[]),this._uiConfig):this._uiConfig}_sceneUpdate(){var e,i;(i=(e=this._uiConfig)===null||e===void 0?void 0:e.uiRefresh)===null||i===void 0||i.call(e,"postFrame",!0)}}Dw.PluginType="SimpleUi";var x2=__webpackgi_require__(1),E2=__webpackgi_require__.n(x2)();class Pw extends Xi{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.treeView=void 0,this.hierarchyDiv=ma({innerHTML:"",id:"tpHierarchyContainer",addToBody:!1}),this._uiConfig={type:"folder",label:"Hierarchy",children:[]},this._buildData=(i,s)=>(i.push({text:s.name||"unnamed",id:s.uuid,children:s.children.reduce(this._buildData,[])}),i),this._findVisible=(i,s)=>(s.visible&&(s.children.length<1?i.push(s.uuid):i.push(...s.children.reduce(this._findVisible,[]))),i),this._setVisible=i=>{var s,a,h;const d=(s=this._viewer)===null||s===void 0?void 0:s.scene.modelRoot;if(!d||i==null)return;const b=new Set;d.traverse(X=>{X!==d&&(X.visible=i.includes(X.uuid),X.visible&&X.traverseAncestors($=>b.add($)))}),b.forEach(X=>X.visible=!0),(h=(a=this._viewer)===null||a===void 0?void 0:a.scene)===null||h===void 0||h.setDirty({sceneUpdate:!0,fromHierarchyPlugin:!0,updateGround:!1})},this.enabled=e,this.reset=this.reset.bind(this),th(Qe`
#tpHierarchyContainer{
  width: 100%;
  height: auto;
  background-color: transparent;
  color: #e9e9ed;
  margin-top: 0;
}
`)}reset(e){var i;if(e!=null&&e.fromHierarchyPlugin||!(e!=null&&e.hierarchyChanged))return;for(;this.hierarchyDiv.firstChild;)this.hierarchyDiv.firstChild.remove();const s=(i=this._viewer)===null||i===void 0?void 0:i.scene.modelRoot;if(!s)return;const a=s.children.reduce(this._buildData,[]),h=s.children.reduce(this._findVisible,[]);let d=!1;return new Promise((b,X)=>{this.treeView=new E2(this.hierarchyDiv,{closeDepth:1,data:a,loaded:function(){this.values=h,b()},onChange:()=>{d?eo(200).then(()=>{this.treeView&&this._setVisible(this.treeView.values)}):d=!0},onItemLabelClick:$=>{var Z;const re=(Z=this._viewer)===null||Z===void 0?void 0:Z.scene.modelRoot.modelObject.getObjectByProperty("uuid",$);re&&s.visible&&re.dispatchEvent({type:"select",value:re,ui:!0})}})})}async onAdded(e){await super.onAdded(e),this.reset(),e.scene.addEventListener("sceneUpdate",this.reset)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this.reset),super.onRemove(e)}async onDispose(e){return super.onDispose(e)}get uiConfig(){return this._uiConfig.domChildren||(this._uiConfig.domChildren=[this.hierarchyDiv]),this._uiConfig}}Pw.PluginType="HierarchyUiPlugin";class Rw extends Xi{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Lights",children:[{type:"button",label:"Add Directional Light",value:()=>{if(!this._viewer)return;const e=new Ad;e.position.set(0,0,0),e.target.position.set(0,0,-1).normalize(),e.intensity=2,e.shadow.mapSize.set(1024,1024),this._viewer.scene.addLight(e)}}],limitedUi:!0},this.dependencies=[Kn],this._sceneUpdate=e=>{var i,s,a;if(!e.hierarchyChanged)return;const h=[];(i=this._viewer)===null||i===void 0||i.traverseSceneObjects(d=>{if(!d.lightObject)return;const b=d.uiConfig;b&&!h.includes(b)&&h.push(b)}),[...this.uiConfig.children].forEach(d=>{var b;((b=d)===null||b===void 0?void 0:b.type)==="button"||h.includes(d)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(d),1)}),h.forEach(d=>{this.uiConfig.children.includes(d)||this.uiConfig.children.push(d)}),(a=(s=this.uiConfig).uiRefresh)===null||a===void 0||a.call(s,"postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}Rw.PluginType="SimpleLightsUi";class Bw extends Xi{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Cameras (Loaded)",children:[{type:"button",label:"Add Camera",hidden:!0}],limitedUi:!0},this.dependencies=[Kn],this._sceneUpdate=e=>{var i,s,a;if(!e.hierarchyChanged)return;const h=[];(i=this._viewer)===null||i===void 0||i.traverseSceneObjects(d=>{if(!d.cameraObject)return;const b=d.uiConfig;b&&!h.includes(b)&&h.push(b)}),[...this.uiConfig.children].forEach(d=>{var b;((b=d)===null||b===void 0?void 0:b.type)==="button"||h.includes(d)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(d),1)}),h.forEach(d=>{this.uiConfig.children.includes(d)||this.uiConfig.children.push(d)}),(a=(s=this.uiConfig).uiRefresh)===null||a===void 0||a.call(s,"postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}Bw.PluginType="SimpleSceneCamerasUi";var yA,kw=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var b=c.length-1;b>=0;b--)(a=c[b])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let up=yA=class extends Xi{constructor(){super(),this.enabled=!0,this.width=0,this.height=0,this.scale=1,this._sizeChanged=this._sizeChanged.bind(this),this._refresh=this._refresh.bind(this)}refreshSize(){this._sizeChanged()}_sizeChanged(){var c;if(!this._viewer)return;const e={width:Math.round(this.width),height:Math.round(this.height)},i=this._viewer.container.getBoundingClientRect();e.width>=i.width&&delete e.width,e.height>=i.height&&delete e.height,(c=this._viewer)===null||c===void 0||c.setSize(e),this._viewer.renderer.displayCanvasScaling=this.scale}async onAdded(c){await super.onAdded(c);const e=c.canvas.clientWidth,i=c.canvas.clientHeight,s=c.renderer.displayCanvasScaling;this.width=e,this.height=i,this.scale=s,c.renderer.addEventListener("resize",this._refresh),this.addEventListener("deserialize",this._sizeChanged),this._refresh()}async onRemove(c){return this.removeEventListener("deserialize",this._sizeChanged),c.renderer.removeEventListener("resize",this._refresh),super.onRemove(c)}_refresh(){var c,e;(e=(c=this.uiConfig)===null||c===void 0?void 0:c.uiRefresh)===null||e===void 0||e.call(c,"postFrame",!0)}toJSON(c){const e=super.toJSON(c),i=this._viewer.container.getBoundingClientRect();return e.width>=i.width&&delete e.width,e.height>=i.height&&delete e.height,e}};up.PluginType="RendererParamsUiPlugin",kw([kt(),lt(yA.prototype._sizeChanged),ai("Width",void 0,1,c=>({bounds:()=>{var e;return[10,((e=c._viewer)===null||e===void 0?void 0:e.container.getBoundingClientRect().width)||1024]}}))],up.prototype,"width",void 0),kw([kt(),lt(yA.prototype._sizeChanged),ai("Height",void 0,1,c=>({bounds:()=>{var e;return[10,((e=c._viewer)===null||e===void 0?void 0:e.container.getBoundingClientRect().height)||1024]}}))],up.prototype,"height",void 0),kw([kt(),lt(yA.prototype._sizeChanged),ai("Scale",[.25,4],.25,{limitedUi:!0})],up.prototype,"scale",void 0),up=yA=kw([ur("Renderer")],up);class Ow extends Xi{constructor(){super(),this.enabled=!0,this.serializeWithViewer=!1,this._refresh=this._refresh.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._refresh),e.scene.addEventListener("sceneUpdate",this._refresh)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._refresh),e.scene.removeEventListener("sceneUpdate",this._refresh),super.onRemove(e)}toJSON(e){var i;const s=super.toJSON(e);return s.activeCamera=(i=this._viewer)===null||i===void 0?void 0:i.scene.activeCamera.toJSON(),s}fromJSON(e,i){var s;return e.activeCamera&&((s=this._viewer)===null||s===void 0||s.scene.activeCamera.fromJSON(e.activeCamera),delete(e={...e}).activeCamera),super.fromJSON(e,i)}_refresh(){var e,i;this._viewer&&((i=(e=this.uiConfig).uiRefresh)===null||i===void 0||i.call(e,"postFrame",!0))}get uiConfig(){var e;return((e=this._viewer)===null||e===void 0?void 0:e.scene.activeCamera.uiConfig)||{}}}Ow.PluginType="CameraUiPlugin";var S2={create:c=>{let e="button"+(c.type?" "+c.type:""),i=Wi.createDiv(e,c.text);return i.addEventListener("click",c.onClick),i}};let fl={createElement:(c,e,i,s)=>{let a=document.createElement(c);if(e&&(a.className=e),i&&(a.innerHTML=i),s)for(let h in s)a.setAttribute(h,s[h]);return a},createDiv:(c,e,i)=>fl.createElement("div",c,e,i),createDomTree:c=>{if(!c||!c.hasOwnProperty("dom"))return c;let e=c.dom;if(c.children)for(let i in c.children)c.children[i]&&e.appendChild(fl.createDomTree(c.children[i]));return e},removeElement:c=>{c!=null&&c.parentNode.removeChild(c)},appendToBody:c=>{document.body.appendChild(c)},makeIconHTML:c=>{let e="";return c=="ok"&&(e="#tick"),c=="error"&&(e="#cancel"),c=="info"&&(e="#info-button"),c=="caution"&&(e="#danger"),c=="min"&&(e="#line"),c=="close"&&(e="#close"),`<svg class="icon ${c}"><use xlink:href="${e}" /></svg>`},makeNftContent:c=>{let e=null;if(c.type){let i=null;i=typeof c.content=="string"?fl.createDiv("inner-content",c.content):fl.createDomTree({dom:fl.createDiv("inner-content"),children:[c.content]}),e=c.type=="text"?fl.createDomTree({dom:fl.createDiv("content text"),children:[i]}):fl.createDomTree({dom:fl.createDiv("content"),children:[fl.createDiv("state",fl.makeIconHTML(c.type)),i]})}else typeof c.content=="string"&&(e=fl.createDiv("content",c.content));return e},standardizeButtons:(c,e)=>{let i=[];if(e.buttons===void 0)return e.type!="caution"&&e.type!="info"||i.push({key:27,text:"Cancel",onClick:c.close.bind(c,"cancel")}),i.push({key:13,text:"OK",type:"main",onClick:c.close.bind(c,"ok")}),i;i=e.buttons,i.constructor!==Array&&(i=[i]);for(let s in i)!i[s].onClick&&(i[s].onClick=c.close.bind(c,i[s].id));return i},makeButtons:c=>{let e=[];if(c)for(let i in c)e.push(S2.create({text:c[i].text?c[i].text:"OK",type:c[i].normal?null:"main",onClick:c[i].onClick}));return fl.createDomTree({dom:fl.createDiv("button-wrapper"),children:e})},bindButtonKeyEvents:c=>{let e=i=>{for(let s in c)if(c[s].key===i.keyCode)return void c[s].onClick()};return window.addEventListener("keydown",e),e},unbindButtonKeyEvents:c=>{window.removeEventListener("keydown",c)}};var Wi=fl,Mo=__webpackgi_require__(476),Da={"wwise-overlay-in-1":{opacity:"0"},"wwise-overlay-in-2":{opacity:"1"},"wwise-overlay-out-1":{opacity:"0"},"wwise-pop-in-1":{transform:"scale(0.5, 0.5)","margin-top":"50px",opacity:".5"},"wwise-pop-in-2":{transform:"scale(1, 1)","margin-top":"0",opacity:"1"},"wwise-pop-in-3":{transform:"scale(1.05, 1.05)"},"wwise-pop-in-4":{transform:"scale(1, 1)"},"wwise-pop-out-1":{transform:"scale(0.25, 0.25)","margin-top":"50px",opacity:"0"},"wwise-flip-in-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:".2"},"wwise-flip-in-2":{transform:"none",opacity:"1"},"wwise-flip-out-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:"0"},"wwise-top-in-1":{transform:"translateY(-30vh)",opacity:".5"},"wwise-top-in-2":{transform:"none",opacity:"1"},"wwise-top-out-1":{transform:"translateY(-30vh)",opacity:"0"},"wwise-bottom-in-1":{transform:"translateY(30vh)",opacity:".5"},"wwise-bottom-in-2":{transform:"none",opacity:"1"},"wwise-bottom-out-1":{transform:"translateY(30vh)",opacity:"0"},"wwise-left-in-1":{transform:"translateX(-30vw)",opacity:".5"},"wwise-left-in-2":{transform:"none",opacity:"1"},"wwise-left-out-1":{transform:"translateX(-30vw)",opacity:"0"},"wwise-right-in-1":{transform:"translateX(30vw)",opacity:".5"},"wwise-right-in-2":{transform:"none",opacity:"1"},"wwise-right-out-1":{transform:"translateX(30vw)",opacity:"0"},"wwise-min-in-1":{"margin-top":"0",transform:"rotateX(-60deg) scale(0.2, 1.8) translateY(80vh)",opacity:".2"},"wwise-min-in-2":{transform:"none",opacity:"1"},"wwise-min-out-1":{"margin-top":"30vh",transform:"rotateX(-60deg) scale(0.05, 2) translateY(30vh)",opacity:"0"}};let Xu={};Xu.overlay_in=[new Mo.Frame(Da["wwise-overlay-in-1"],0),new Mo.Frame(Da["wwise-overlay-in-2"],400)],Xu.overlay_out=[new Mo.Frame(Da["wwise-overlay-out-1"],300)],Xu.pop_in=[new Mo.Frame(Da["wwise-pop-in-1"],0),new Mo.Frame(Da["wwise-pop-in-2"],{duration:200,"timing-function":"ease-in"}),new Mo.Frame(Da["wwise-pop-in-3"],{duration:100,"timing-function":"linear"}),new Mo.Frame(Da["wwise-pop-in-4"],{duration:100,"timing-function":"linear"})],Xu.pop_out=[new Mo.Frame(Da["wwise-pop-out-1"],{duration:250,"timing-function":"ease-in"})],Xu.flip_in=[new Mo.Frame(Da["wwise-flip-in-1"],0),new Mo.Frame(Da["wwise-flip-in-2"],500)],Xu.flip_out=[new Mo.Frame(Da["wwise-flip-out-1"],400)],Xu.min_in=[new Mo.Frame(Da["wwise-min-in-1"],0),new Mo.Frame(Da["wwise-min-in-2"],350)],Xu.min_out=[new Mo.Frame(Da["wwise-min-out-1"],400)];let QM=["top","bottom","left","right"];for(let c in QM){let e=QM[c];Xu[e+"_in"]=[new Mo.Frame(Da["wwise-"+e+"-in-1"],0),new Mo.Frame(Da["wwise-"+e+"-in-2"],{duration:400,"timing-function":"ease-out"})],Xu[e+"_out"]=[new Mo.Frame(Da["wwise-"+e+"-out-1"],{duration:400,"timing-function":"ease-in"})]}var Lw=Xu;let C2={animation:"pop",topbar:{showClose:!0,showMin:!1},keepOverlay:!1,position:"center",overlay:!1,clickOverlayToClose:!0,removeBackground:!1,noRadius:!1,zIndex:null};class lE{static create(e,i){let s=e.getElementsByClassName("title")[0];s&&(s=s.innerHTML);let a=e.getElementsByClassName("content")[0];return a&&(a=a.innerHTML),Wi.removeElement(e),i.title=s,i.content=a,new lE(i)}constructor(e){this.options=JSON.parse(JSON.stringify(C2));for(let X in e)e[X]!=null&&(this.options[X]=e[X]);let i=this.options.position;if(i.indexOf(" ")==-1&&(i=="left"||i=="right"?i+=" center":i=i=="top"||i=="bottom"?"center "+i:i+" "+i),this.options.position=i,this.options.overlay){let X=document.getElementsByClassName("wwise-overlay");X.length?(this.overlay=X[0],this.hasOverlay=!0):(this.overlay=Wi.createDiv("wwise-overlay"),this.options.zIndex&&(this.overlay.style.zIndex=this.options.zIndex)),this.overlayClickHandler=this.close.bind(this,void 0)}else this.options.clickOverlayToClose=!1;let s="content";if(this.options.topbar){let X=[];this.options.topbar.showMin&&(X.push(Wi.createDiv(null,Wi.makeIconHTML("min"))),X[X.length-1].addEventListener("click",this.min.bind(this))),this.options.topbar.showClose&&(X.push(Wi.createDiv(null,Wi.makeIconHTML("close"))),X[X.length-1].addEventListener("click",this.close.bind(this,void 0)));let $=null;$=typeof this.options.title=="string"?Wi.createDiv("title",this.options.title):Wi.createDomTree({dom:Wi.createDiv("title"),children:[this.options.title]}),this.topbar=Wi.createDomTree({dom:Wi.createDiv("topbar"),children:[{dom:Wi.createDiv("control"),children:X.map(Z=>({dom:Z}))},{dom:$},{dom:Wi.createDiv("clear")}]})}else s+=" no-topbar";typeof this.options.content=="string"?this.content=Wi.createDomTree({dom:Wi.createDiv(s,this.options.content)}):this.content=Wi.createDomTree({dom:Wi.createDiv(s),children:[this.options.content]}),this.options.removeBackground&&(this.content.style.background="initial"),this.window=Wi.createDomTree({dom:Wi.createDiv("wwise"+(this.options.noRadius?" no-radius":"")),children:[this.topbar,this.content]});let a=Wi.createDiv("wwise-wrapper");this.options.zIndex&&(a.style.zIndex=this.options.zIndex),this.wrapper=Wi.createDomTree({dom:a,children:[this.window]}),this.dom=Wi.createDomTree({dom:Wi.createDiv(),children:[this.wrapper]});let h=this.options.position.split(" "),d=-50,b=-50;if(h[0]=="left"?(d=0,this.wrapper.classList.add("left")):h[0]=="right"?(d=-100,this.wrapper.classList.add("right")):h[0]=="center"?this.wrapper.classList.add("h-center"):this.wrapper.style.left=h[0],h[1]=="top"?(b=0,this.wrapper.classList.add("top")):h[1]=="bottom"?(b=-100,this.wrapper.classList.add("bottom")):h[1]=="center"?this.wrapper.classList.add("v-center"):this.wrapper.style.top=i[1],this.window.style.transform=`translate(${d}%, ${b}%)`,this.options.style)for(let X in this.options.style)this.window.style[X]=this.options.style[X];this.options.margin&&(this.wrapper.style.margin=this.options.margin),this.options.draggable&&this.draggable()}open(e){if(this.opened)return;this.promise=new Promise(s=>{this.promiseResolve=s}),this.appendDoms(),this.opened=!0,this.options.clickOverlayToClose&&(this.overlay.addEventListener("click",this.overlayClickHandler),this.overlay.addEventListener("touchstart",this.overlayClickHandler));let i=e?"min":this.options.animation;if(i){i!="min"&&i!="flip"||this.dom.classList.add("wwise-perspective");let s=[new Mo.Queue(this.wrapper,Lw[i+"_in"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.hasOverlay&&s.push(new Mo.Queue(this.overlay,Lw.overlay_in,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(s).then(()=>{this.dom.classList.remove("wwise-perspective")})}return Promise.resolve()}close(e){if(!this.opened)return;this.opened=!1;let i=e?"min":this.options.animation;if(this.overlay&&(this.overlay.removeEventListener("click",this.overlayClickHandler),this.overlay.removeEventListener("touchstart",this.overlayClickHandler)),i){i!="min"&&i!="flip"||this.dom.classList.add("wwise-perspective");let s=[new Mo.Queue(this.wrapper,Lw[i+"_out"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.options.keepOverlay&&s.push(new Mo.Queue(this.overlay,Lw.overlay_out,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(s).then(()=>{this.removeDoms(),this.dom.classList.remove("wwise-perspective"),this.promiseResolve()})}return this.removeDoms(),this.promiseResolve(),Promise.resolve()}min(){return this.close(!0)}resume(){return this.open(!0)}getPromise(){return this.promise}appendDoms(){this.options.overlay&&!this.hasOverlay&&(Wi.appendToBody(this.overlay),document.body.classList.add("wwise-no-scroll"),this.overlay.addEventListener("touchstart",e=>{e.preventDefault()})),Wi.appendToBody(this.dom)}removeDoms(){Wi.removeElement(this.dom),!this.options.keepOverlay&&this.overlay&&(Wi.removeElement(this.overlay),document.body.classList.remove("wwise-no-scroll"))}draggable(e=!0){this.topbar&&(e?(this.draggableMouseMoveHandler=this.handleDraggableMouseMove.bind(this),this.draggableMouseDownHandler=this.handleDraggableMouseDown.bind(this),this.draggableMouseUpHandler=this.handleDraggableMouseUp.bind(this),this.draggableMouseOutHandler=this.handleDraggableMouseOut.bind(this),window.addEventListener("mousemove",this.draggableMouseMoveHandler),window.addEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.addEventListener("mousedown",this.draggableMouseDownHandler),window.addEventListener("mouseup",this.draggableMouseUpHandler)):(window.removeEventListener("mousemove",this.draggableMouseMoveHandler),window.removeEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.removeEventListener("mousedown",this.draggableMouseDownHandler),window.removeEventListener("mouseup",this.draggableMouseUpHandler)))}handleDraggableMouseMove(e){if(this.inDragging){let i={x:e.clientX-this.dragPrev.x,y:e.clientY-this.dragPrev.y},s=window.getComputedStyle(this.wrapper),a=this.options.draggable,h=parseFloat(s.left),d=parseFloat(s.top);if(s.left.indexOf("%")!=-1){h=s.left,h=h.substr(0,h.length-1),h=parseInt(h);let b=window,X=document,$=X.documentElement,Z=X.getElementsByTagName("body")[0];h=h*(b.innerWidth||$.clientWidth||Z.clientWidth)/100}if(s.top.indexOf("%")!=-1){d=s.top,d=d.substr(0,d.length-1),d=parseInt(d);let b=window,X=document,$=X.documentElement,Z=X.getElementsByTagName("body")[0];d=d*(b.innerHeight||$.clientHeight||Z.clientHeight)/100}a!=1&&a!="horizontal"||(this.wrapper.style.left=h+i.x+"px"),a!=1&&a!="vertical"||(this.wrapper.style.top=d+i.y+"px"),this.dragPrev={x:e.clientX,y:e.clientY}}}handleDraggableMouseDown(e){this.inDragging=!0,this.dragPrev={x:e.clientX,y:e.clientY}}handleDraggableMouseUp(e){this.inDragging=!1}handleDraggableMouseOut(e){let i=e.relatedTarget;i&&i.nodeName!="HTML"||(this.inDragging=!1)}}var M2=lE,cE=class{constructor(c){let e=this.options=c;!e.type&&(e.type="ok");let i={topbar:!1};i.content=this.constructContent({type:e.type,title:e.title,text:e.text,content:e.content,buttons:e.buttons}),i.overlay=!0,i.keepOverlay=e.keepOverlay,i.clickOverlayToClose=!1,i.animation=e.animation,i.zIndex=e.zIndex,this.wwise=new M2(i)}constructContent(c){let e=Wi.createDiv("modal"),i=Wi.createDomTree({dom:Wi.createDiv("main "+c.type),children:[Wi.createDiv(null,Wi.makeIconHTML(c.type)),Wi.createDiv("title",c.title),Wi.createDiv("text",c.text)]});this.buttonArr=Wi.standardizeButtons(this,c);let s=Wi.makeButtons(this.buttonArr),a=null;c.content&&(a=typeof c.content=="string"?Wi.createDiv(null,c.content):c.content);let h=null;return s.innerHTML&&(h=Wi.createDomTree({dom:Wi.createDiv("operation "+c.type),children:[s]})),a||h||i.classList.add("no-op"),Wi.createDomTree({dom:e,children:[i,a,h]})}open(){if(this.wwise.opened)return;let c=this.wwise.open();return this.value=void 0,this.promise=new Promise(e=>{this.promiseResolve=e}),this.wwise.getPromise().then(this.handlePromiseResolve.bind(this)),this.keyHandler=Wi.bindButtonKeyEvents(this.buttonArr),this.options.closeAfter&&window.setTimeout(()=>{this.close("timer")},this.options.closeAfter),c}close(c){if(this.wwise.opened)return this.value=c,Wi.unbindButtonKeyEvents(this.keyHandler),this.wwise.close()}getPromise(){return this.promise}handlePromiseResolve(){this.promiseResolve(this.value)}};let T2={showCancel:!1,okText:"OK",cancelText:"Cancel",placeholder:"",validator:null},I2={type:"info",keepOverlay:!1,title:"Input",text:"",zIndex:null};var Nw=__webpackgi_require__(513),bA={};Nw.Z&&Nw.Z.locals&&(bA.locals=Nw.Z.locals);var uE,hE=0,cg={};cg.styleTagTransform=Em(),cg.setAttributes=xm(),cg.insert=function(c,e){(e.target||document.head).appendChild(c)},cg.domAPI=A_(),cg.insertStyleElement=Xc(),bA.use=function(c){return cg.options=c||{},hE++||(uE=Jp()(Nw.Z,cg)),bA},bA.unuse=function(){hE>0&&!--hE&&(uE(),uE=null)};var D2=bA;class dE extends Xi{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._previousMappings={}}async onAdded(e){await super.onAdded(e),this._previousMappings={alert:e.alert,confirm:e.confirm,prompt:e.prompt},Wi.appendToBody=i=>{e.container.appendChild(i)},Wi.makeIconHTML=i=>"",D2.use({target:e.container}),e.alert=async i=>{const s=i==null?void 0:i.split(":")[0],a=new cE({type:"info",title:s??"&ndsp;",text:(i==null?void 0:i.replace(s+":",""))||"",buttons:[{key:13,text:"OK",type:"main",id:"ok"}],animation:"overlay"});return a.open(),a.getPromise()},e.confirm=async i=>{const s=i==null?void 0:i.split(":")[0],a=new cE({type:"info",title:s??"&ndsp;",text:(i==null?void 0:i.replace(s||"","").replace(":",""))||"",buttons:[{id:"no",key:27,text:"No",normal:!0},{id:"yes",key:13,text:"Yes"}],animation:"overlay"});return a.open(),await a.getPromise()==="yes"},e.prompt=async(i,s,a=!0)=>{const h=i==null?void 0:i.split(":")[0],d=new class{constructor(b){this.options=JSON.parse(JSON.stringify(T2));for(let re in b)b[re]!=null&&(this.options[re]=b[re]);let X=this.options,$=JSON.parse(JSON.stringify(I2));for(let re in $)X.hasOwnProperty(re)&&($[re]=X[re]);let Z=[];X.showCancel&&Z.push({key:27,text:X.cancelText,normal:!0,onClick:this.handleCancel.bind(this)}),Z.push({key:13,text:X.okText,onClick:this.handleOk.bind(this)}),$.buttons=Z,this.input=Wi.createElement("input","input",null,{placeholder:X.placeholder}),this.error=Wi.createDiv("error"),$.content=Wi.createDomTree({dom:Wi.createDiv("input-wrapper"),children:[this.input,this.error]}),this.modal=new cE($)}handleCancel(){this.close().then(this.promiseReject.bind(this))}handleOk(){this.options.validator?this.options.validator(this.input.value).then(()=>{this.close().then(this.promiseResolve.bind(this,this.input.value))},b=>{this.error.innerText=b}):this.close().then(this.promiseResolve.bind(this,this.input.value))}open(){if(this.modal.wwise.opened)return;let b=this.modal.open();return this.input.value="",this.error.innerText="",this.input.focus(),this.promise=new Promise((X,$)=>{this.promiseResolve=X,this.promiseReject=$}),b}close(){if(this.modal.wwise.opened)return this.modal.close()}getPromise(){return this.promise}}({type:"info",title:h??"&ndsp;",placeholder:s??"",showCancel:a,animation:"overlay",text:(i==null?void 0:i.replace(h||"","").replace(":",""))||""});return d.open(),await d.getPromise().catch(async()=>null)}}async onRemove(e){return e.alert=this._previousMappings.alert,e.confirm=this._previousMappings.confirm,e.prompt=this._previousMappings.prompt,super.onRemove(e)}}dE.PluginType="WindowiseDialogPlugin";class HM extends Xi{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.uiConfig={type:"folder",label:"Extras",limitedUi:!1,children:[()=>{var e;return{label:(!((e=this._viewer)===null||e===void 0)&&e.useRgbm?"Disable":"Enable")+" RGBM",type:"button",value:async()=>{var i,s;await((i=this._viewer)===null||i===void 0?void 0:i.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&Tc("rgbm",!((s=this._viewer)===null||s===void 0)&&s.useRgbm?"no":"yes",!0)}}},()=>{var e;return{label:(!((e=this._viewer)===null||e===void 0)&&e.getPluginByType("debug")?"Disable":"Enable")+" Debug",type:"button",value:async()=>{var i,s;await((i=this._viewer)===null||i===void 0?void 0:i.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&Tc("debug",!((s=this._viewer)===null||s===void 0)&&s.getPluginByType("debug")?null:"true",!0)}}}]}}}HM.PluginType="ExtrasUiPlugin1";var P2=Kb({defaultModifiers:[f1,g1,_1,$b]}),R2=__webpackgi_require__(388),B2=__webpackgi_require__.n(R2);function k2(c){const e=[];c.traverse(a=>{a.geometry&&e.push(a)});const i={},s={};e.forEach(a=>{var h;if(!i[a.geometry.uuid]){const X=a.geometry.toJSON().data,$=X?B2()({a:X.attributes||{},b:X.index||[]}):"";i[a.geometry.uuid]=$}const d=i[a.geometry.uuid],b=(h=s[d])!==null&&h!==void 0?h:s[d]=[];b.includes(a)||b.push(a)}),Object.values(s).forEach(a=>{if(a.length<2)return;const h=a[0].geometry;a.forEach((d,b)=>{b<1||(d.geometry.dispose(),d.geometry=h)})})}const hp=new _.Pa4,ug=new _.Pa4,Uw=new _.Pa4,pE=new _.Pa4,Fw=new _.Pa4,yv=new _.Pa4;let fE=1;const O2=new _.Pa4(0,1,0);class L2 extends Zu{constructor(e,i){super(e,i),this.targetOffset=new _.Pa4(0,0,0);const s=this.update;this.update=()=>this._update(s)}_update(e){this.target.add(this.targetOffset),hp.copy(this.object.position).sub(this.target),fE=hp.length(),yv.copy(this.target);const i=e();return yv.sub(this.target),hp.copy(this.object.position).sub(this.target),fE/=hp.length(),this.target.add(yv),this.object.position.copy(this.target).add(hp),hp.normalize(),ug.crossVectors(O2,hp).normalize(),Uw.crossVectors(hp,ug).normalize(),pE.crossVectors(ug,Uw).normalize().negate(),ug.length()>.1&&this.object.up.crossVectors(hp.clone().normalize(),ug),this.enablePan&&(Fw.set(0,0,0).addScaledVector(ug,yv.x).addScaledVector(Uw,yv.y).addScaledVector(pE,yv.z),this.targetOffset.add(Fw),this.targetOffset.multiplyScalar(1/fE)),Fw.set(0,0,0).addScaledVector(ug,-this.targetOffset.x).addScaledVector(Uw,-this.targetOffset.y).addScaledVector(pE,-this.targetOffset.z),this.object.lookAt(Fw.add(this.target)),this.object.updateMatrixWorld(),this.object.isCamera&&this.object.updateProjectionMatrix(),this.target.sub(this.targetOffset),i}}class N2 extends Wv{constructor(){super(),this.boundingScaleMultiplier=1.2,this._initGeometry(new _.cJO(1,0))}}function mE(c,e){var i,s;const a=Array.from(((i=c.access)!==null&&i!==void 0?i:"").split(".")),h=a.pop();let d=(s=c.targetObject)!==null&&s!==void 0?s:e;if(!h||h.length===0)return{key:void 0,tar:d};if(d=He(a,d),d&&!(h in d))throw console.error("invalid key",h,d,e,c),"";return{key:h,tar:d}}function gE(c,e,i,s){const{key:a,tar:h}=mE(c,e);return a&&h?cm(h,a,()=>{var d;i&&(!((d=c.updater)===null||d===void 0)&&d.length)&&c.updater.forEach(b=>i[b]()),s==null||s()}):d=>console.warn("Unable to set ",d,a,h,c,e)}async function jw(c,e,i){var s,a,h,d;const{key:b,tar:X}=mE(e,c),$=e.animSet?[WM(X,e.animSet,i,(s=e.animSetParallel)!==null&&s!==void 0&&s)]:[];if(b&&X){const Z=(d=e.updater)!==null&&d!==void 0?d:[],re=async()=>s_(X,b,{...e,onUpdate:le=>{var he;(he=e.onUpdate)===null||he===void 0||he.call(e,le),Z.forEach(fe=>{var me;return(me=i[fe])===null||me===void 0?void 0:me.call(i)})}});e.delay?$.push(eo(e.delay).then(re)):$.push(re())}else(e.duration||e.delay)&&$.push(eo(((a=e.delay)!==null&&a!==void 0?a:0)+((h=e.duration)!==null&&h!==void 0?h:0)));return $.length===1?$[0]:Promise.all($)}async function WM(c,e,i,s=!1){if(s)return Promise.all(e.map(async a=>jw(c,a,i)));for(const a of e)await jw(c,a,i)}function qM(c,e,i,s){var a,h,d,b,X,$,Z;if(!c)return;e||(e=[]);const re=s??{},le=c;for(let he=0,fe=e.length;he<fe;he++){const me=e[he];if(me.uiRef){const Ae=(X=le==null?void 0:le.indexOf(me.uiRef))!==null&&X!==void 0?X:-1;Ae!==he&&(Ae>=0&&(le==null||le.splice(Ae,1)),le==null||le.splice(he,0,me.uiRef))}else{me.uiRef={type:"folder",label:(a=me.name)!==null&&a!==void 0?a:"Animation "+he,children:[]};const Ae=[{type:"button",label:"animate",value:()=>{jw(i,me,re).then(()=>{var ye;return console.log(((ye=me.uiRef)===null||ye===void 0?void 0:ye.label)+" finished")})}}];me.access!==void 0&&Ae.push({type:"input",property:[me,"access"]}),me.from!==void 0&&Ae.push({type:(h=me.uiObjectType)!==null&&h!==void 0?h:"input",property:[me,"from"],onChange:()=>{var ye;gE(me,i)(me.from),(ye=me.updater)===null||ye===void 0||ye.forEach(ge=>ge in re&&re[ge]())}}),me.to!==void 0&&Ae.push({type:(d=me.uiObjectType)!==null&&d!==void 0?d:"input",property:[me,"to"],onChange:()=>{var ye;gE(me,i)(me.to),(ye=me.updater)===null||ye===void 0||ye.forEach(ge=>ge in re&&re[ge]())}}),me.duration!==void 0&&Ae.push({type:"input",property:[me,"duration"]}),me.animSet&&(me.animSetParallel||(me.animSetParallel=!1),Ae.push({type:"input",label:"run parallel",property:[me,"animSetParallel"]})),me.animSet&&Ae.push({type:"folder",label:"AnimSet",expanded:!1,children:[],animSetContainer:!0}),(b=me.uiRef.children)===null||b===void 0||b.push(...Ae),le==null||le.splice(he,0,me.uiRef)}const Ee=($=me.uiRef.children)===null||$===void 0?void 0:$.map(Ae=>st(Ae)).flat(2).find(Ae=>Ae==null?void 0:Ae.animSetContainer);me.animSet&&Ee&&qM(Ee.children,me.animSet,(Z=me.targetObject)!==null&&Z!==void 0?Z:i,s)}}function YM(c,e){return e?c*(1e3/e):0}function U2(c){var e,i=c.from,s=i===void 0?0:i,a=c.velocity,h=a===void 0?0:a,d=c.min,b=c.max,X=c.power,$=X===void 0?.8:X,Z=c.timeConstant,re=Z===void 0?750:Z,le=c.bounceStiffness,he=le===void 0?500:le,fe=c.bounceDamping,me=fe===void 0?10:fe,Ee=c.restDelta,Ae=Ee===void 0?1:Ee,ye=c.modifyTarget,ge=c.driver,Pe=c.onUpdate,Be=c.onComplete;function Oe(St){return d!==void 0&&St<d||b!==void 0&&St>b}function Fe(St){return d===void 0?b:b===void 0||Math.abs(d-St)<Math.abs(b-St)?d:b}function Xe(St){e==null||e.stop(),e=zp(Dr(Dr({},St),{driver:ge,onUpdate:function(Ft){var Mt;Pe==null||Pe(Ft),(Mt=St.onUpdate)===null||Mt===void 0||Mt.call(St,Ft)},onComplete:Be}))}function at(St){Xe(Dr({type:"spring",stiffness:he,damping:me,restDelta:Ae},St))}if(Oe(s))at({from:s,velocity:h,to:Fe(s)});else{var mt=$*h+s;ye!==void 0&&(mt=ye(mt));var wt,At,Tt=Fe(mt),yt=Tt===d?-1:1;Xe({type:"decay",from:s,velocity:h,timeConstant:re,power:$,restDelta:Ae,modifyTarget:ye,onUpdate:Oe(mt)?function(St){wt=At,At=St,h=YM(St-wt,jp().delta),(yt===1&&St>Tt||yt===-1&&St<Tt)&&at({from:St,to:Tt,velocity:h})}:void 0})}return{stop:function(){return e==null?void 0:e.stop()}}}var XM=function(c){return 180*c/Math.PI},F2=function(c,e){return e===void 0&&(e=r0),XM(Math.atan2(e.y-c.y,e.x-c.x))},j2=function(c,e){var i=!0;return e===void 0&&(e=c,i=!1),function(s){return i?s-c+e:(c=s,i=!0,e)}},z2=function(c){return c},_E=function(c){return c===void 0&&(c=z2),function(e,i,s){var a=i-s,h=-(0-e+1)*(0-c(Math.abs(a)));return a<=0?i+h:i-h}},V2=_E(),G2=_E(Math.sqrt),KM=function(c){return c*Math.PI/180},zw=function(c){return c.hasOwnProperty("x")&&c.hasOwnProperty("y")},vE=function(c){return zw(c)&&c.hasOwnProperty("z")},Vw=function(c,e){return Math.abs(c-e)};function Q2(c,e){if(Np(c)&&Np(e))return Vw(c,e);if(zw(c)&&zw(e)){var i=Vw(c.x,e.x),s=Vw(c.y,e.y),a=vE(c)&&vE(e)?Vw(c.z,e.z):0;return Math.sqrt(Math.pow(i,2)+Math.pow(s,2)+Math.pow(a,2))}}var H2=function(c,e,i){return e=KM(e),{x:i*Math.cos(e)+c.x,y:i*Math.sin(e)+c.y}},JM=function(c,e){return e===void 0&&(e=2),e=Math.pow(10,e),Math.round(c*e)/e},$M=function(c,e,i,s){return s===void 0&&(s=0),JM(c+i*(e-c)/Math.max(s,i))},W2=function(c){c===void 0&&(c=50);var e=0,i=0;return function(s){var a=jp().timestamp,h=a!==i?a-i:0,d=h?$M(e,s,h,c):e;return i=a,e=d,d}},q2=function(c){if(typeof c=="number")return function(s){return Math.round(s/c)*c};var e=0,i=c.length;return function(s){var a=Math.abs(c[0]-s);for(e=1;e<i;e++){var h=c[e],d=Math.abs(h-s);if(d===0)return h;if(d>a)return c[e-1];if(e===i-1)return h;a=d}}};function Y2(c,e){return c/(1e3/e)}var X2=function(c,e,i){var s=e-c;return((i-c)%s+s)%s+c},ZM=function(c,e){return 1-3*e+3*c},eT=function(c,e){return 3*e-6*c},tT=function(c){return 3*c},Gw=function(c,e,i){return((ZM(e,i)*c+eT(e,i))*c+tT(e))*c},nT=function(c,e,i){return 3*ZM(e,i)*c*c+2*eT(e,i)*c+tT(e)},Qw=.1;function K2(c,e,i,s){if(c===e&&i===s)return Wg;for(var a=new Float32Array(11),h=0;h<11;++h)a[h]=Gw(h*Qw,c,i);return function(d){return d===0||d===1?d:Gw(function(b){for(var X=0,$=1;$!==10&&a[$]<=b;++$)X+=Qw;--$;var Z=X+(b-a[$])/(a[$+1]-a[$])*Qw,re=nT(Z,c,i);return re>=.001?function(le,he,fe,me){for(var Ee=0;Ee<8;++Ee){var Ae=nT(he,fe,me);if(Ae===0)return he;he-=(Gw(he,fe,me)-le)/Ae}return he}(b,Z,c,i):re===0?Z:function(le,he,fe,me,Ee){var Ae,ye,ge=0;do(Ae=Gw(ye=he+(fe-he)/2,me,Ee)-le)>0?fe=ye:he=ye;while(Math.abs(Ae)>1e-7&&++ge<10);return ye}(b,X,X+Qw,c,i)}(d),e,s)}}var J2=function(c,e){return e===void 0&&(e="end"),function(i){var s=(i=e==="end"?Math.min(i,.999):Math.max(i,.001))*c,a=e==="end"?Math.floor(s):Math.ceil(s);return Cd(0,1,a/c)}};async function $2(c,{debug:e=!1,ground:i=!0,bloom:s=!0,depthTonemap:a=!1,importPopup:h=!0,caching:d=!0}){const b=new Zl(c);b.enabled=!1,e&&await b.addPlugin(Ma),await b.addPlugin(Kn,void 0,void 0,{storage:d&&window.caches?await window.caches.open("webgi-cache-storage"):void 0}),await b.addPlugin(H0),await b.addPlugin(Jx),h&&await b.addPlugin(il),await b.addPlugin(rf),await b.addPlugin(dE),await b.addPlugin(Bl),await b.addPlugin(Um),await b.addPlugin(j0),await b.addPlugin(V0),await b.addPlugin(Ct),await b.addPlugin(Xo),await b.addPlugin(z0),await b.addPlugin(Vf),await b.addPlugin(br,Jf,!1,!0),await I_(b,{ground:i,bloom:s,depthTonemap:a}),await b.addPlugin(zb),await b.addPlugin(rw,!1),await b.addPlugin(Wu,!1),await b.addPlugin(Jm,!1),await b.addPlugin(ip,!1),await b.addPlugin(J1),await b.addPlugin(eE),await b.addPlugin(tE),await b.addPlugin(rp,!1),await b.addPlugin(Vh),await b.addPlugin(bc),await b.addPlugin(wc),await b.addPlugin(ng),await b.addPlugin(Af),await b.addPlugin(vf),await b.addPlugin(Nh),await b.addPlugin(Pu),await b.addPlugin(Pw),await b.addPlugin(Dw),await b.addPlugin(Rw),await b.addPlugin(Bw),await b.addPlugin(up),await b.addPlugin(Ow),await b.addPlugin(Iw);const X=await b.addPlugin(new aE(!Mc()));return b.renderer.refreshPipeline(),b.scene.addEventListener("textureAdded",$=>{$.texture&&b.scene.setEnvironment($.texture)}),X.setupPluginUi(Mu),X.setupPluginUi(up),X.setupPluginUi(Ow),X.setupPluginUi(Vf),X.setupPluginUi(Iw),X.setupPluginUi(H0),X.setupPluginUi(Os),X.setupPluginUi(lc),X.setupPluginUi(Af),X.setupPluginUi(ng),X.setupPluginUi(Pw),X.setupPluginUi(vf),X.setupPluginUi(zs),X.setupPluginUi(br),i&&X.setupPluginUi(Ta),X.setupPluginUi(Lg),X.setupPluginUi(ys),X.setupPluginUi(Nh),X.setupPluginUi(x_),X.setupPluginUi(zb),X.setupPluginUi(C_),X.setupPluginUi(Kd),X.setupPluginUi(qo),X.setupPluginUi(S_),X.setupPluginUi(Gd),X.setupPluginUi(Ug),X.setupPluginUi(Jm),X.setupPluginUi(ip),X.setupPluginUi(Dw),X.setupPluginUi(Vh),X.setupPluginUi(bc),X.setupPluginUi(Ho),X.setupPluginUi(Rw),X.setupPluginUi(Bw),X.setupPluginUi(la),X.setupPluginUi(ca),s&&X.setupPluginUi(pm),X.setupPluginUi(Pu),X.setupPluginUi(Za),X.setupPluginUi(Yp),X.setupPluginUi(cc),X.setupPluginUi(rw),X.setupPluginUi(wc),X.setupPluginUi(sc),X.setupPluginUi(vm),X.setupPluginUi(Wd),X.setupPluginUi(ua),X.setupPluginUi(Wu),X.setupPluginUi(il),X.setupPluginUi(tl),X.setupPluginUi(rp),b.enabled=!0,b}})();__webpackgi_exports__.MWW;__webpackgi_exports__.LY2;__webpackgi_exports__.GYo;__webpackgi_exports__.HRj;__webpackgi_exports__.li4;__webpackgi_exports__.FO5;__webpackgi_exports__.Nlh;__webpackgi_exports__.QvI;__webpackgi_exports__.JHp;__webpackgi_exports__.bGH;__webpackgi_exports__.NDo;__webpackgi_exports__.gSk;__webpackgi_exports__.WMw;__webpackgi_exports__.OTo;__webpackgi_exports__.Se2;__webpackgi_exports__.cum;__webpackgi_exports__.Mig;__webpackgi_exports__.B$7;__webpackgi_exports__.i_9;__webpackgi_exports__.m7l;__webpackgi_exports__.sYA;__webpackgi_exports__.Xcj;__webpackgi_exports__.mzJ;__webpackgi_exports__.ZZA;__webpackgi_exports__.$Ph;__webpackgi_exports__.T__;__webpackgi_exports__.HkE;__webpackgi_exports__.tGC;__webpackgi_exports__.g1S;__webpackgi_exports__.I$C;__webpackgi_exports__.QIH;__webpackgi_exports__._JE;__webpackgi_exports__.SwW;var __webpackgi_exports__AssetManagerPlugin=__webpackgi_exports__.ksm;__webpackgi_exports__.jl_;__webpackgi_exports__.b7R;__webpackgi_exports__.BDV;__webpackgi_exports__.Ea_;__webpackgi_exports__.qff;__webpackgi_exports__.tmC;__webpackgi_exports__.BON;__webpackgi_exports__.P40;__webpackgi_exports__.wLL;__webpackgi_exports__.iHO;__webpackgi_exports__.BbS;__webpackgi_exports__.kqm;__webpackgi_exports__.Hmr;__webpackgi_exports__.SJI;__webpackgi_exports__.mTL;__webpackgi_exports__.y8_;__webpackgi_exports__._Li;__webpackgi_exports__.g56;__webpackgi_exports__.bj3;__webpackgi_exports__.z81;__webpackgi_exports__._MY;__webpackgi_exports__.yEv;var __webpackgi_exports__BloomPlugin=__webpackgi_exports__.dFZ;__webpackgi_exports__.N$j;__webpackgi_exports__._YM;__webpackgi_exports__.TUj;__webpackgi_exports__.ZzF;__webpackgi_exports__.qzb;__webpackgi_exports__.GQ;__webpackgi_exports__.nvb;__webpackgi_exports__.DvJ;__webpackgi_exports__.fQA;__webpackgi_exports__.cPz;__webpackgi_exports__.TlE;__webpackgi_exports__.u9r;__webpackgi_exports__.s4_;__webpackgi_exports__.T95;__webpackgi_exports__.F5w;__webpackgi_exports__.NlP;__webpackgi_exports__.$8Z;__webpackgi_exports__.YYN;__webpackgi_exports__.CtF;__webpackgi_exports__.V1s;__webpackgi_exports__.jOv;__webpackgi_exports__.Rki;__webpackgi_exports__.pzV;__webpackgi_exports__.itZ;__webpackgi_exports__.qKx;__webpackgi_exports__.vlJ;__webpackgi_exports__.nPO;__webpackgi_exports__.zcQ;__webpackgi_exports__.GH1;__webpackgi_exports__.ROQ;__webpackgi_exports__.YN5;__webpackgi_exports__.BVQ;__webpackgi_exports__.YT8;__webpackgi_exports__._DE;__webpackgi_exports__.YGz;__webpackgi_exports__.trn;__webpackgi_exports__.zf8;__webpackgi_exports__.uWy;__webpackgi_exports__.wYQ;__webpackgi_exports__.SUY;__webpackgi_exports__.Ilk;__webpackgi_exports__.R2R;__webpackgi_exports__.epp;__webpackgi_exports__.xmJ;__webpackgi_exports__.GD$;__webpackgi_exports__.EB7;__webpackgi_exports__.DqL;__webpackgi_exports__._3;__webpackgi_exports__.b_z;__webpackgi_exports__.OCn;__webpackgi_exports__._am;__webpackgi_exports__.kB7;__webpackgi_exports__.fY$;__webpackgi_exports__.vxC;__webpackgi_exports__.BtG;__webpackgi_exports__.cBK;__webpackgi_exports__.g8_;__webpackgi_exports__.AXT;__webpackgi_exports__.yj7;__webpackgi_exports__.dYG;__webpackgi_exports__.tm_;__webpackgi_exports__.S2y;__webpackgi_exports__.B02;__webpackgi_exports__.PeU;__webpackgi_exports__.Hyl;__webpackgi_exports__.Wqd;__webpackgi_exports__.Xaj;__webpackgi_exports__.DUb;__webpackgi_exports__.dZ3;__webpackgi_exports__.m_w;__webpackgi_exports__.fHI;__webpackgi_exports__.LBq;__webpackgi_exports__.dHf;__webpackgi_exports__.Qww;__webpackgi_exports__.CGV;__webpackgi_exports__.JUT;__webpackgi_exports__.p3g;__webpackgi_exports__.IEO;__webpackgi_exports__.CN8;__webpackgi_exports__.zob;__webpackgi_exports__.yxD;__webpackgi_exports__.CUS;__webpackgi_exports__.A5E;__webpackgi_exports__.zqG;__webpackgi_exports__.PfX;__webpackgi_exports__.Q1o;__webpackgi_exports__.jfJ;__webpackgi_exports__.T_J;__webpackgi_exports__.tEQ;__webpackgi_exports__.gb4;__webpackgi_exports__.qkB;__webpackgi_exports__.cvk;__webpackgi_exports__.HWo;__webpackgi_exports__.brP;__webpackgi_exports__.$YQ;__webpackgi_exports__.X8d;__webpackgi_exports__.Zdt;__webpackgi_exports__.yNB;__webpackgi_exports__.h7x;__webpackgi_exports__.Ox3;__webpackgi_exports__.qtn;__webpackgi_exports__.cBI;__webpackgi_exports__.cU9;__webpackgi_exports__.DT1;__webpackgi_exports__.Kgo;__webpackgi_exports__.ehD;__webpackgi_exports__.fhJ;__webpackgi_exports__.y1s;__webpackgi_exports__.fSK;__webpackgi_exports__.Vdb;__webpackgi_exports__.l8J;__webpackgi_exports__.dj0;__webpackgi_exports__.QM0;__webpackgi_exports__.OIS;__webpackgi_exports__.q8b;__webpackgi_exports__.TOt;__webpackgi_exports__.xaN;__webpackgi_exports__.Ny0;__webpackgi_exports__.NeD;__webpackgi_exports__.Zof;__webpackgi_exports__.eD;__webpackgi_exports__.jwo;__webpackgi_exports__.dSO;__webpackgi_exports__.Bf4;__webpackgi_exports__.USm;__webpackgi_exports__.pBf;__webpackgi_exports__.eBg;__webpackgi_exports__.$Vf;__webpackgi_exports__.O7d;__webpackgi_exports__.ksq;__webpackgi_exports__.gXf;__webpackgi_exports__.hH6;__webpackgi_exports__.kpi;__webpackgi_exports__.DwZ;__webpackgi_exports__.kN3;__webpackgi_exports__.e62;__webpackgi_exports__.a$l;__webpackgi_exports__.OM3;__webpackgi_exports__.VzW;__webpackgi_exports__.ybr;__webpackgi_exports__.yo9;__webpackgi_exports__.$Bt;__webpackgi_exports__.Wzm;__webpackgi_exports__.Wl3;__webpackgi_exports__.iWj;__webpackgi_exports__.DNz;var __webpackgi_exports__GBufferPlugin=__webpackgi_exports__.m1M;__webpackgi_exports__.ylh;__webpackgi_exports__.v9Y;__webpackgi_exports__.LSk;__webpackgi_exports__.LHE;__webpackgi_exports__.KE0;__webpackgi_exports__.KCF;__webpackgi_exports__.a4n;__webpackgi_exports__.zIH;__webpackgi_exports__.Hfk;__webpackgi_exports__.png;__webpackgi_exports__.tAj;__webpackgi_exports__.Eb_;__webpackgi_exports__.BT2;__webpackgi_exports__._8p;__webpackgi_exports__.V5Z;var __webpackgi_exports__GammaCorrectionPlugin=__webpackgi_exports__.s5b;__webpackgi_exports__.hkn;__webpackgi_exports__.GFY;__webpackgi_exports__.w$m;__webpackgi_exports__.ksN;__webpackgi_exports__.j4z;__webpackgi_exports__.OAl;__webpackgi_exports__.VLJ;__webpackgi_exports__.C73;__webpackgi_exports__.ZAu;__webpackgi_exports__.ibP;__webpackgi_exports__._fI;__webpackgi_exports__.hUN;__webpackgi_exports__.cLu;__webpackgi_exports__.vmT;__webpackgi_exports__.Qpg;__webpackgi_exports__.So8;__webpackgi_exports__.eOv;__webpackgi_exports__.Wjw;__webpackgi_exports__.cJO;__webpackgi_exports__.QRU;__webpackgi_exports__.S3k;__webpackgi_exports__.PpQ;__webpackgi_exports__.AHu;__webpackgi_exports__.q_9;__webpackgi_exports__.ZRs;__webpackgi_exports__.oqc;__webpackgi_exports__.T_x;__webpackgi_exports__.lb7;__webpackgi_exports__.L5s;__webpackgi_exports__.$TI;__webpackgi_exports__.SPe;__webpackgi_exports__.aVm;__webpackgi_exports__.j87;__webpackgi_exports__.RNb;__webpackgi_exports__.Kz5;__webpackgi_exports__.vpT;__webpackgi_exports__.kB5;__webpackgi_exports__._C8;__webpackgi_exports__.Syv;__webpackgi_exports__.NMF;__webpackgi_exports__.pIN;__webpackgi_exports__.eMJ;__webpackgi_exports__.rN7;__webpackgi_exports__.iUp;__webpackgi_exports__.GFd;__webpackgi_exports__.x5V;__webpackgi_exports__.tUh;__webpackgi_exports__.z8B;__webpackgi_exports__.vcl;__webpackgi_exports__.GZb;__webpackgi_exports__.p7y;__webpackgi_exports__.S9g;__webpackgi_exports__.Zr5;__webpackgi_exports__.vCF;__webpackgi_exports__.yt0;__webpackgi_exports__.uXU;__webpackgi_exports__._kC;__webpackgi_exports__.lk7;__webpackgi_exports__.USc;__webpackgi_exports__.x12;__webpackgi_exports__.Zzh;__webpackgi_exports__.nls;__webpackgi_exports__.g_z;__webpackgi_exports__.U7;__webpackgi_exports__.FT0;__webpackgi_exports__.blk;__webpackgi_exports__.ejS;__webpackgi_exports__.rnI;__webpackgi_exports__.wem;__webpackgi_exports__.lfu;__webpackgi_exports__.FDw;__webpackgi_exports__.lRj;__webpackgi_exports__.D1R;__webpackgi_exports__.qyh;__webpackgi_exports__.GUF;__webpackgi_exports__.EoG;__webpackgi_exports__.aNw;__webpackgi_exports__.Zp0;__webpackgi_exports__.lLk;__webpackgi_exports__.jAl;__webpackgi_exports__.uEv;__webpackgi_exports__.YKA;__webpackgi_exports__.cRx;__webpackgi_exports__.Y8D;__webpackgi_exports__.RsA;__webpackgi_exports__.Y0m;__webpackgi_exports__.F5T;__webpackgi_exports__.EDU;__webpackgi_exports__.z$Q;__webpackgi_exports__.KA8;__webpackgi_exports__.XUj;__webpackgi_exports__.Me$;__webpackgi_exports__.u7G;__webpackgi_exports__.PEk;__webpackgi_exports__.BG4;__webpackgi_exports__.M8C;__webpackgi_exports__.Vkp;__webpackgi_exports__.yGw;__webpackgi_exports__.Sm8;__webpackgi_exports__.Kj0;__webpackgi_exports__.vBJ;__webpackgi_exports__.QfV;__webpackgi_exports__.lRF;__webpackgi_exports__.Lun;__webpackgi_exports__.YBo;__webpackgi_exports__.kaV;__webpackgi_exports__.RSm;__webpackgi_exports__.xoR;__webpackgi_exports__.EJi;__webpackgi_exports__.Wid;__webpackgi_exports__.iuj;__webpackgi_exports__.IKL;__webpackgi_exports__.r_;__webpackgi_exports__.OoA;__webpackgi_exports__.qhX;__webpackgi_exports__.qPT;__webpackgi_exports__.M5h;__webpackgi_exports__.Ns1;__webpackgi_exports__.TyD;__webpackgi_exports__.vZf;__webpackgi_exports__.HTd;__webpackgi_exports__.aH4;__webpackgi_exports__.YLQ;__webpackgi_exports__.BVF;__webpackgi_exports__.MyG;__webpackgi_exports__.jFi;__webpackgi_exports__.aCh;__webpackgi_exports__.uL9;__webpackgi_exports__.TNj;__webpackgi_exports__.IFH;__webpackgi_exports__.bdR;__webpackgi_exports__.RPs;__webpackgi_exports__.kM_;__webpackgi_exports__.M6v;__webpackgi_exports__.RvT;__webpackgi_exports__.dUE;__webpackgi_exports__.oe_;__webpackgi_exports__.BuN;__webpackgi_exports__.Tme;__webpackgi_exports__.N9P;__webpackgi_exports__.Gql;__webpackgi_exports__.$XY;__webpackgi_exports__.O9d;__webpackgi_exports__.zEO;__webpackgi_exports__.qfx;__webpackgi_exports__.PA7;__webpackgi_exports__.REq;__webpackgi_exports__.pQR;__webpackgi_exports__.ghN;__webpackgi_exports__.Hy8;__webpackgi_exports__.Wpd;__webpackgi_exports__.LgZ;__webpackgi_exports__.iWC;__webpackgi_exports__.mqn;__webpackgi_exports__.SKe;__webpackgi_exports__.iKG;__webpackgi_exports__.rCq;__webpackgi_exports__._iA;__webpackgi_exports__.ntZ;__webpackgi_exports__.anP;__webpackgi_exports__.X2e;__webpackgi_exports__.FCo;__webpackgi_exports__.y$t;__webpackgi_exports__.cPb;__webpackgi_exports__.lmx;__webpackgi_exports__.JOQ;__webpackgi_exports__.BKK;__webpackgi_exports__._12;__webpackgi_exports__.tJx;__webpackgi_exports__.cek;__webpackgi_exports__.qD0;__webpackgi_exports__.xG9;__webpackgi_exports__.wI8;__webpackgi_exports__.Sgv;__webpackgi_exports__.woe;__webpackgi_exports__.UY4;__webpackgi_exports__.aq0;__webpackgi_exports__.ujx;__webpackgi_exports__.Uol;__webpackgi_exports__.JiH;__webpackgi_exports__.VYz;__webpackgi_exports__._Pm;var __webpackgi_exports__ProgressivePlugin=__webpackgi_exports__.EsW;__webpackgi_exports__.iUV;__webpackgi_exports__.tf;__webpackgi_exports__.ZQ6;__webpackgi_exports__.mXe;__webpackgi_exports__._fP;__webpackgi_exports__.iLg;__webpackgi_exports__.zbs;__webpackgi_exports__.UZH;__webpackgi_exports__.mSO;__webpackgi_exports__.wk1;__webpackgi_exports__.E2K;__webpackgi_exports__.FUD;__webpackgi_exports__.pKu;__webpackgi_exports__.GG6;__webpackgi_exports__.Gih;__webpackgi_exports__.iiP;__webpackgi_exports__.SvJ;__webpackgi_exports__.ptH;__webpackgi_exports__.jZA;__webpackgi_exports__.y2t;__webpackgi_exports__.gi4;__webpackgi_exports__.Djp;__webpackgi_exports__.BG$;__webpackgi_exports__.NYV;__webpackgi_exports__.xJs;__webpackgi_exports__.bsb;__webpackgi_exports__.ekQ;__webpackgi_exports__.CaW;__webpackgi_exports__.eaV;__webpackgi_exports__.BFQ;__webpackgi_exports__.v3W;__webpackgi_exports__.ILR;__webpackgi_exports__.UCm;__webpackgi_exports__.Inb;__webpackgi_exports__.U1$;__webpackgi_exports__.LgE;__webpackgi_exports__.fto;__webpackgi_exports__.l0P;__webpackgi_exports__.vCx;__webpackgi_exports__._AM;__webpackgi_exports__.wuA;__webpackgi_exports__.av9;__webpackgi_exports__.CtA;__webpackgi_exports__.BvQ;__webpackgi_exports__.FZJ;__webpackgi_exports__.FIo;__webpackgi_exports__.zHn;__webpackgi_exports__.iMs;__webpackgi_exports__.T_f;__webpackgi_exports__.hEm;__webpackgi_exports__.D9w;__webpackgi_exports__.sHH;__webpackgi_exports__.CdI;__webpackgi_exports__.rkc;__webpackgi_exports__.rpg;__webpackgi_exports__.ce8;__webpackgi_exports__.rOj;__webpackgi_exports__.P6m;__webpackgi_exports__.JA6;__webpackgi_exports__.V4E;__webpackgi_exports__.o8S;__webpackgi_exports__.flB;__webpackgi_exports__.DUH;__webpackgi_exports__.KI_;var __webpackgi_exports__SSAOPlugin=__webpackgi_exports__.iLN;__webpackgi_exports__.rz_;__webpackgi_exports__.jsw;__webpackgi_exports__.srG;var __webpackgi_exports__SSRPlugin=__webpackgi_exports__.i6Z;__webpackgi_exports__.vfv;__webpackgi_exports__.xsS;__webpackgi_exports__.or;__webpackgi_exports__.EQj;__webpackgi_exports__.ov0;__webpackgi_exports__.WdD;__webpackgi_exports__.Vj0;__webpackgi_exports__.jyz;__webpackgi_exports__.mTM;__webpackgi_exports__.Mn1;__webpackgi_exports__.Hlq;__webpackgi_exports__.Fi7;__webpackgi_exports__.Tn7;__webpackgi_exports__.bnF;__webpackgi_exports__.HW6;__webpackgi_exports__.oa8;__webpackgi_exports__.T_1;__webpackgi_exports__.zHJ;__webpackgi_exports__.iDF;__webpackgi_exports__.iAb;__webpackgi_exports__.d4E;__webpackgi_exports__.lBg;__webpackgi_exports__.JeJ;__webpackgi_exports__.FKY;__webpackgi_exports__.zlZ;__webpackgi_exports__.vkg;__webpackgi_exports__.brh;__webpackgi_exports__.kZK;__webpackgi_exports__.puG;__webpackgi_exports__.OdW;__webpackgi_exports__._YX;__webpackgi_exports__.TUv;__webpackgi_exports__.Hw6;__webpackgi_exports__.aLr;__webpackgi_exports__.Aip;__webpackgi_exports__.xo$;__webpackgi_exports__.bIn;__webpackgi_exports__.$V;__webpackgi_exports__.lDi;__webpackgi_exports__.gti;__webpackgi_exports__.PMe;__webpackgi_exports__.iwP;__webpackgi_exports__.FvO;__webpackgi_exports__.jyi;__webpackgi_exports__.xeV;__webpackgi_exports__.k74;__webpackgi_exports__.RlZ;__webpackgi_exports__.KhW;__webpackgi_exports__.HgB;__webpackgi_exports__.W2J;__webpackgi_exports__.JWc;__webpackgi_exports__.u37;__webpackgi_exports__.Z6B;__webpackgi_exports__.QZ1;__webpackgi_exports__.Ir4;__webpackgi_exports__.NwF;__webpackgi_exports__.Wbm;__webpackgi_exports__.N4l;__webpackgi_exports__.ej9;__webpackgi_exports__.QmN;__webpackgi_exports__.IOt;__webpackgi_exports__.NOD;__webpackgi_exports__.L5g;__webpackgi_exports__.H$k;__webpackgi_exports__.cuP;__webpackgi_exports__.xEZ;__webpackgi_exports__.dpR;__webpackgi_exports__.wOD;__webpackgi_exports__.KNb;var __webpackgi_exports__TonemapPlugin=__webpackgi_exports__.IiN;__webpackgi_exports__.Cne;__webpackgi_exports__.XvJ;__webpackgi_exports__.XZw;__webpackgi_exports__.FE5;__webpackgi_exports__.lVp;__webpackgi_exports__.CJI;__webpackgi_exports__.z$h;__webpackgi_exports__.UlW;__webpackgi_exports__.WwZ;__webpackgi_exports__.Lcc;__webpackgi_exports__.WXh;__webpackgi_exports__.Vjr;__webpackgi_exports__.LuM;__webpackgi_exports__.LP5;__webpackgi_exports__.xfE;__webpackgi_exports__.qlB;__webpackgi_exports__.lCJ;__webpackgi_exports__.WTc;__webpackgi_exports__.rAo;__webpackgi_exports__.LZj;__webpackgi_exports__.xWb;__webpackgi_exports__.gH0;__webpackgi_exports__.rBU;__webpackgi_exports__.rDY;__webpackgi_exports__.ywz;__webpackgi_exports__.wJv;__webpackgi_exports__.JQ4;__webpackgi_exports__.k0A;__webpackgi_exports__.irR;__webpackgi_exports__.LsT;__webpackgi_exports__.q5h;__webpackgi_exports__.TKh;__webpackgi_exports__.tyg;__webpackgi_exports__.Ro5;__webpackgi_exports__.dwk;__webpackgi_exports__.FM8;__webpackgi_exports__.Pa4;__webpackgi_exports__.Ltg;__webpackgi_exports__.yC1;__webpackgi_exports__.lHq;__webpackgi_exports__.fO1;var __webpackgi_exports__ViewerApp=__webpackgi_exports__.oMA;__webpackgi_exports__.JzW;__webpackgi_exports__.QEt;__webpackgi_exports__.b5g;__webpackgi_exports__.Ywn;__webpackgi_exports__.GVz;__webpackgi_exports__.oAp;__webpackgi_exports__.kFz;__webpackgi_exports__.p7A;__webpackgi_exports__.dd2;__webpackgi_exports__.CP7;__webpackgi_exports__.fQK;__webpackgi_exports__.Wd$;__webpackgi_exports__.t1_;__webpackgi_exports__.Uk6;__webpackgi_exports__._sL;__webpackgi_exports__.Pnf;__webpackgi_exports__.c8b;__webpackgi_exports__._lf;__webpackgi_exports__.ad5;__webpackgi_exports__.sZV;__webpackgi_exports__.TfA;__webpackgi_exports__.sKX;__webpackgi_exports__.UdM;__webpackgi_exports__.P0y;__webpackgi_exports__.L_r;__webpackgi_exports__.Bve;__webpackgi_exports__.UeO;__webpackgi_exports__.$nx;__webpackgi_exports__.Bk6;__webpackgi_exports__.EER;__webpackgi_exports__.y4l;__webpackgi_exports__.pQ0;__webpackgi_exports__.wXW;__webpackgi_exports__.r5x;__webpackgi_exports__.MSI;__webpackgi_exports__.EUu;__webpackgi_exports__.jtH;__webpackgi_exports__.T0T;__webpackgi_exports__.gAb;__webpackgi_exports__.iwT;__webpackgi_exports__.je_;__webpackgi_exports__.wBP;__webpackgi_exports__.LU2;__webpackgi_exports__.wQL;__webpackgi_exports__.Zs7;__webpackgi_exports__.sMc;__webpackgi_exports__.x7s;__webpackgi_exports__.Mnd;__webpackgi_exports__.A0_;__webpackgi_exports__.d73;__webpackgi_exports__.HCD;__webpackgi_exports__.RG9;__webpackgi_exports__.G2P;__webpackgi_exports__.XLf;__webpackgi_exports__.CGN;__webpackgi_exports__.RGi;__webpackgi_exports__.mvg;__webpackgi_exports__.Hiy;__webpackgi_exports__.XMc;__webpackgi_exports__.N7M;__webpackgi_exports__.iv;__webpackgi_exports__.n55;__webpackgi_exports__.IaC;__webpackgi_exports__.h9t;__webpackgi_exports__.yDW;__webpackgi_exports__.gJv;__webpackgi_exports__.l$g;__webpackgi_exports__.vQi;__webpackgi_exports__.$MY;__webpackgi_exports__.wJl;__webpackgi_exports__.Z7Y;__webpackgi_exports__.X7D;__webpackgi_exports__.BnX;__webpackgi_exports__.uZ5;__webpackgi_exports__.zVI;__webpackgi_exports__.DpF;__webpackgi_exports__.nNb;__webpackgi_exports__.cqZ;__webpackgi_exports__.pKN;__webpackgi_exports__.d_$;__webpackgi_exports__.DdI;__webpackgi_exports__.rrX;__webpackgi_exports__.KlC;__webpackgi_exports__.KVn;__webpackgi_exports__.oau;__webpackgi_exports__.aw9;__webpackgi_exports__.Aap;__webpackgi_exports__.Dxg;__webpackgi_exports__.MjT;__webpackgi_exports__.F7Q;__webpackgi_exports__.IFq;__webpackgi_exports__.IJl;__webpackgi_exports__.O5A;__webpackgi_exports__.wCn;__webpackgi_exports__.gGT;__webpackgi_exports__.pEc;__webpackgi_exports__.Bi6;__webpackgi_exports__.fi_;__webpackgi_exports__.TT;__webpackgi_exports__.q2Z;__webpackgi_exports__.NyK;__webpackgi_exports__.bgu;__webpackgi_exports__.kcS;__webpackgi_exports__.rRN;__webpackgi_exports__.ivY;__webpackgi_exports__._s1;__webpackgi_exports__._HO;__webpackgi_exports__.tpL;__webpackgi_exports__.DMK;__webpackgi_exports__.LjN;__webpackgi_exports__.iFs;__webpackgi_exports__.qTg;__webpackgi_exports__.Wtl;__webpackgi_exports__.DmK;__webpackgi_exports__.Htt;__webpackgi_exports__.Hx7;__webpackgi_exports__.imt;__webpackgi_exports__.US6;__webpackgi_exports__.vZs;__webpackgi_exports__.TE$;__webpackgi_exports__.lmu;__webpackgi_exports__.SvO;__webpackgi_exports__.YQY;__webpackgi_exports__.mZN;__webpackgi_exports__.VvG;__webpackgi_exports__.omp;__webpackgi_exports__.utz;__webpackgi_exports__.TFV;__webpackgi_exports__.hrz;__webpackgi_exports__.JKM;__webpackgi_exports__.jZf;__webpackgi_exports__.RjL;__webpackgi_exports__.RRI;__webpackgi_exports__.RUq;__webpackgi_exports__._t4;__webpackgi_exports__.YHh;__webpackgi_exports__.R8g;__webpackgi_exports__.Bbl;__webpackgi_exports__.V9r;__webpackgi_exports__.PZ2;__webpackgi_exports__.w7A;__webpackgi_exports__.N6S;__webpackgi_exports__.Uxp;__webpackgi_exports__.tAz;__webpackgi_exports__.R$F;__webpackgi_exports__.N33;__webpackgi_exports__.gw2;__webpackgi_exports__.KlU;__webpackgi_exports__.rfc;__webpackgi_exports__.wo6;__webpackgi_exports__.H4P;__webpackgi_exports__.swA;__webpackgi_exports__._Z3;__webpackgi_exports__.ivc;__webpackgi_exports__.rZ1;__webpackgi_exports__.CpZ;__webpackgi_exports__.dyc;__webpackgi_exports__.MxZ;__webpackgi_exports__.btp;__webpackgi_exports__.mXy;__webpackgi_exports__.Ej0;__webpackgi_exports__.ep4;__webpackgi_exports__.DQP;__webpackgi_exports__.VNr;__webpackgi_exports__.V7q;__webpackgi_exports__.zEk;__webpackgi_exports__.qfq;__webpackgi_exports__.piB;__webpackgi_exports__.IIc;__webpackgi_exports__.rrF;__webpackgi_exports__.naq;__webpackgi_exports__.sXR;__webpackgi_exports__.p5I;__webpackgi_exports__.wps;__webpackgi_exports__.wuo;__webpackgi_exports__.GpE;__webpackgi_exports__.F4b;__webpackgi_exports__.t$v;__webpackgi_exports__.tdn;__webpackgi_exports__.Y9t;__webpackgi_exports__.GEo;__webpackgi_exports__.DH3;__webpackgi_exports__.uxM;__webpackgi_exports__.zH3;__webpackgi_exports__.MLs;__webpackgi_exports__.xXG;__webpackgi_exports__.YM4;__webpackgi_exports__.B3r;__webpackgi_exports__.iAx;__webpackgi_exports__.lDn;__webpackgi_exports__.oaQ;__webpackgi_exports__.CD7;__webpackgi_exports__.Rc0;__webpackgi_exports__.iPG;__webpackgi_exports__.TIc;__webpackgi_exports__.xsC;__webpackgi_exports__.zOc;__webpackgi_exports__.r46;__webpackgi_exports__.z2C;__webpackgi_exports__._X$;__webpackgi_exports__._yn;__webpackgi_exports__.Dyg;__webpackgi_exports__.cUc;__webpackgi_exports__.zGw;__webpackgi_exports__.Ctq;__webpackgi_exports__.$ch;__webpackgi_exports__.k5b;__webpackgi_exports__.kZl;__webpackgi_exports__.OCg;__webpackgi_exports__.YjH;__webpackgi_exports__.Ui8;__webpackgi_exports__.YD2;__webpackgi_exports__.vi9;__webpackgi_exports__.ij3;__webpackgi_exports__.YPW;__webpackgi_exports__.Bg1;__webpackgi_exports__.kon;__webpackgi_exports__.M3g;__webpackgi_exports__.F2z;__webpackgi_exports__.pJF;__webpackgi_exports__.knz;__webpackgi_exports__.Ejo;__webpackgi_exports__.BgY;__webpackgi_exports__.qCG;__webpackgi_exports__.HD9;__webpackgi_exports__.fEB;__webpackgi_exports__.Udc;__webpackgi_exports__.ZQg;__webpackgi_exports__.ofC;__webpackgi_exports__.yRy;__webpackgi_exports__._NL;__webpackgi_exports__.LCA;__webpackgi_exports__.j1w;__webpackgi_exports__.i8J;__webpackgi_exports__.p7C;__webpackgi_exports__.ZAS;__webpackgi_exports__.ipH;__webpackgi_exports__.$TF;__webpackgi_exports__.uZI;__webpackgi_exports__.VWG;__webpackgi_exports__.pQ7;__webpackgi_exports__.STw;__webpackgi_exports__.jc8;__webpackgi_exports__.BL_;__webpackgi_exports__.S6;__webpackgi_exports__.T8U;__webpackgi_exports__.TD6;__webpackgi_exports__.akS;__webpackgi_exports__.QKE;__webpackgi_exports__.dKx;__webpackgi_exports__.OvX;__webpackgi_exports__.VsW;__webpackgi_exports__.YMc;__webpackgi_exports__.aPg;__webpackgi_exports__.LFn;__webpackgi_exports__.wey;__webpackgi_exports__.MaE;__webpackgi_exports__.s4x;__webpackgi_exports__.FJA;__webpackgi_exports__.vIA;__webpackgi_exports__.Spv;__webpackgi_exports__.w8l;__webpackgi_exports__.riG;__webpackgi_exports__.Kbh;__webpackgi_exports__.BFq;__webpackgi_exports__.t8K;__webpackgi_exports__.Q7n;__webpackgi_exports__.KGF;__webpackgi_exports__.e5;__webpackgi_exports__.Rik;__webpackgi_exports__.GZo;__webpackgi_exports__.Bds;__webpackgi_exports__.HTu;__webpackgi_exports__.cTq;__webpackgi_exports__.X_Y;__webpackgi_exports__.dA8;__webpackgi_exports__.bwS;__webpackgi_exports__.Lks;__webpackgi_exports__.Rvq;__webpackgi_exports__.P4F;__webpackgi_exports__.Pd0;__webpackgi_exports__.Pjo;__webpackgi_exports__.Tum;__webpackgi_exports__.dRH;__webpackgi_exports__.RX0;__webpackgi_exports__.reQ;__webpackgi_exports__.cWm;__webpackgi_exports__.NC9;__webpackgi_exports__.$Re;__webpackgi_exports__.Xo9;__webpackgi_exports__.LNO;__webpackgi_exports__.iZP;function _assertThisInitialized(Te){if(Te===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Te}function _inheritsLoose(Te,te){Te.prototype=Object.create(te.prototype),Te.prototype.constructor=Te,Te.__proto__=te}/*!
 * GSAP 3.11.5
 * https://greensock.com
 *
 * @license Copyright 2008-2023, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var _config={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},_defaults$1={duration:.5,overwrite:!1,delay:0},_suppressOverwrites$1,_reverting$1,_context$2,_bigNum$1=1e8,_tinyNum=1/_bigNum$1,_2PI=Math.PI*2,_HALF_PI=_2PI/4,_gsID=0,_sqrt=Math.sqrt,_cos=Math.cos,_sin=Math.sin,_isString$1=function Te(te){return typeof te=="string"},_isFunction$1=function Te(te){return typeof te=="function"},_isNumber$1=function Te(te){return typeof te=="number"},_isUndefined=function Te(te){return typeof te>"u"},_isObject$1=function Te(te){return typeof te=="object"},_isNotFalse=function Te(te){return te!==!1},_windowExists$2=function Te(){return typeof window<"u"},_isFuncOrString=function Te(te){return _isFunction$1(te)||_isString$1(te)},_isTypedArray=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},_isArray=Array.isArray,_strictNumExp=/(?:-?\.?\d|\.)+/gi,_numExp=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,_numWithUnitExp=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,_complexStringNumExp=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,_relExp=/[+-]=-?[.\d]+/,_delimitedValueExp=/[^,'"\[\]\s]+/gi,_unitExp=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,_globalTimeline,_win$3,_coreInitted$2,_doc$3,_globals={},_installScope={},_coreReady,_install=function Te(te){return(_installScope=_merge(te,_globals))&&gsap$2},_missingPlugin=function Te(te,oe){return console.warn("Invalid property",te,"set to",oe,"Missing plugin? gsap.registerPlugin()")},_warn=function Te(te,oe){return!oe&&console.warn(te)},_addGlobal=function Te(te,oe){return te&&(_globals[te]=oe)&&_installScope&&(_installScope[te]=oe)||_globals},_emptyFunc=function Te(){return 0},_startAtRevertConfig={suppressEvents:!0,isStart:!0,kill:!1},_revertConfigNoKill={suppressEvents:!0,kill:!1},_revertConfig={suppressEvents:!0},_reservedProps={},_lazyTweens=[],_lazyLookup={},_lastRenderedFrame,_plugins={},_effects={},_nextGCFrame=30,_harnessPlugins=[],_callbackNames="",_harness=function Te(te){var oe=te[0],_,ae;if(_isObject$1(oe)||_isFunction$1(oe)||(te=[te]),!(_=(oe._gsap||{}).harness)){for(ae=_harnessPlugins.length;ae--&&!_harnessPlugins[ae].targetTest(oe););_=_harnessPlugins[ae]}for(ae=te.length;ae--;)te[ae]&&(te[ae]._gsap||(te[ae]._gsap=new GSCache(te[ae],_)))||te.splice(ae,1);return te},_getCache=function Te(te){return te._gsap||_harness(toArray(te))[0]._gsap},_getProperty=function Te(te,oe,_){return(_=te[oe])&&_isFunction$1(_)?te[oe]():_isUndefined(_)&&te.getAttribute&&te.getAttribute(oe)||_},_forEachName=function Te(te,oe){return(te=te.split(",")).forEach(oe)||te},_round$1=function Te(te){return Math.round(te*1e5)/1e5||0},_roundPrecise=function Te(te){return Math.round(te*1e7)/1e7||0},_parseRelative=function Te(te,oe){var _=oe.charAt(0),ae=parseFloat(oe.substr(2));return te=parseFloat(te),_==="+"?te+ae:_==="-"?te-ae:_==="*"?te*ae:te/ae},_arrayContainsAny=function Te(te,oe){for(var _=oe.length,ae=0;te.indexOf(oe[ae])<0&&++ae<_;);return ae<_},_lazyRender=function Te(){var te=_lazyTweens.length,oe=_lazyTweens.slice(0),_,ae;for(_lazyLookup={},_lazyTweens.length=0,_=0;_<te;_++)ae=oe[_],ae&&ae._lazy&&(ae.render(ae._lazy[0],ae._lazy[1],!0)._lazy=0)},_lazySafeRender=function Te(te,oe,_,ae){_lazyTweens.length&&!_reverting$1&&_lazyRender(),te.render(oe,_,ae||_reverting$1&&oe<0&&(te._initted||te._startAt)),_lazyTweens.length&&!_reverting$1&&_lazyRender()},_numericIfPossible=function Te(te){var oe=parseFloat(te);return(oe||oe===0)&&(te+"").match(_delimitedValueExp).length<2?oe:_isString$1(te)?te.trim():te},_passThrough$1=function Te(te){return te},_setDefaults$1=function Te(te,oe){for(var _ in oe)_ in te||(te[_]=oe[_]);return te},_setKeyframeDefaults=function Te(te){return function(oe,_){for(var ae in _)ae in oe||ae==="duration"&&te||ae==="ease"||(oe[ae]=_[ae])}},_merge=function Te(te,oe){for(var _ in oe)te[_]=oe[_];return te},_mergeDeep=function Te(te,oe){for(var _ in oe)_!=="__proto__"&&_!=="constructor"&&_!=="prototype"&&(te[_]=_isObject$1(oe[_])?Te(te[_]||(te[_]={}),oe[_]):oe[_]);return te},_copyExcluding=function Te(te,oe){var _={},ae;for(ae in te)ae in oe||(_[ae]=te[ae]);return _},_inheritDefaults=function Te(te){var oe=te.parent||_globalTimeline,_=te.keyframes?_setKeyframeDefaults(_isArray(te.keyframes)):_setDefaults$1;if(_isNotFalse(te.inherit))for(;oe;)_(te,oe.vars.defaults),oe=oe.parent||oe._dp;return te},_arraysMatch=function Te(te,oe){for(var _=te.length,ae=_===oe.length;ae&&_--&&te[_]===oe[_];);return _<0},_addLinkedListItem=function Te(te,oe,_,ae,ve){_===void 0&&(_="_first"),ae===void 0&&(ae="_last");var we=te[ae],Me;if(ve)for(Me=oe[ve];we&&we[ve]>Me;)we=we._prev;return we?(oe._next=we._next,we._next=oe):(oe._next=te[_],te[_]=oe),oe._next?oe._next._prev=oe:te[ae]=oe,oe._prev=we,oe.parent=oe._dp=te,oe},_removeLinkedListItem=function Te(te,oe,_,ae){_===void 0&&(_="_first"),ae===void 0&&(ae="_last");var ve=oe._prev,we=oe._next;ve?ve._next=we:te[_]===oe&&(te[_]=we),we?we._prev=ve:te[ae]===oe&&(te[ae]=ve),oe._next=oe._prev=oe.parent=null},_removeFromParent=function Te(te,oe){te.parent&&(!oe||te.parent.autoRemoveChildren)&&te.parent.remove(te),te._act=0},_uncache=function Te(te,oe){if(te&&(!oe||oe._end>te._dur||oe._start<0))for(var _=te;_;)_._dirty=1,_=_.parent;return te},_recacheAncestors=function Te(te){for(var oe=te.parent;oe&&oe.parent;)oe._dirty=1,oe.totalDuration(),oe=oe.parent;return te},_rewindStartAt=function Te(te,oe,_,ae){return te._startAt&&(_reverting$1?te._startAt.revert(_revertConfigNoKill):te.vars.immediateRender&&!te.vars.autoRevert||te._startAt.render(oe,!0,ae))},_hasNoPausedAncestors=function Te(te){return!te||te._ts&&Te(te.parent)},_elapsedCycleDuration=function Te(te){return te._repeat?_animationCycle(te._tTime,te=te.duration()+te._rDelay)*te:0},_animationCycle=function Te(te,oe){var _=Math.floor(te/=oe);return te&&_===te?_-1:_},_parentToChildTotalTime=function Te(te,oe){return(te-oe._start)*oe._ts+(oe._ts>=0?0:oe._dirty?oe.totalDuration():oe._tDur)},_setEnd=function Te(te){return te._end=_roundPrecise(te._start+(te._tDur/Math.abs(te._ts||te._rts||_tinyNum)||0))},_alignPlayhead=function Te(te,oe){var _=te._dp;return _&&_.smoothChildTiming&&te._ts&&(te._start=_roundPrecise(_._time-(te._ts>0?oe/te._ts:((te._dirty?te.totalDuration():te._tDur)-oe)/-te._ts)),_setEnd(te),_._dirty||_uncache(_,te)),te},_postAddChecks=function Te(te,oe){var _;if((oe._time||oe._initted&&!oe._dur)&&(_=_parentToChildTotalTime(te.rawTime(),oe),(!oe._dur||_clamp$1(0,oe.totalDuration(),_)-oe._tTime>_tinyNum)&&oe.render(_,!0)),_uncache(te,oe)._dp&&te._initted&&te._time>=te._dur&&te._ts){if(te._dur<te.duration())for(_=te;_._dp;)_.rawTime()>=0&&_.totalTime(_._tTime),_=_._dp;te._zTime=-_tinyNum}},_addToTimeline=function Te(te,oe,_,ae){return oe.parent&&_removeFromParent(oe),oe._start=_roundPrecise((_isNumber$1(_)?_:_||te!==_globalTimeline?_parsePosition$1(te,_,oe):te._time)+oe._delay),oe._end=_roundPrecise(oe._start+(oe.totalDuration()/Math.abs(oe.timeScale())||0)),_addLinkedListItem(te,oe,"_first","_last",te._sort?"_start":0),_isFromOrFromStart(oe)||(te._recent=oe),ae||_postAddChecks(te,oe),te._ts<0&&_alignPlayhead(te,te._tTime),te},_scrollTrigger=function Te(te,oe){return(_globals.ScrollTrigger||_missingPlugin("scrollTrigger",oe))&&_globals.ScrollTrigger.create(oe,te)},_attemptInitTween=function Te(te,oe,_,ae,ve){if(_initTween(te,oe,ve),!te._initted)return 1;if(!_&&te._pt&&!_reverting$1&&(te._dur&&te.vars.lazy!==!1||!te._dur&&te.vars.lazy)&&_lastRenderedFrame!==_ticker.frame)return _lazyTweens.push(te),te._lazy=[ve,ae],1},_parentPlayheadIsBeforeStart=function Te(te){var oe=te.parent;return oe&&oe._ts&&oe._initted&&!oe._lock&&(oe.rawTime()<0||Te(oe))},_isFromOrFromStart=function Te(te){var oe=te.data;return oe==="isFromStart"||oe==="isStart"},_renderZeroDurationTween=function Te(te,oe,_,ae){var ve=te.ratio,we=oe<0||!oe&&(!te._start&&_parentPlayheadIsBeforeStart(te)&&!(!te._initted&&_isFromOrFromStart(te))||(te._ts<0||te._dp._ts<0)&&!_isFromOrFromStart(te))?0:1,Me=te._rDelay,ke=0,Le,Ye,tt;if(Me&&te._repeat&&(ke=_clamp$1(0,te._tDur,oe),Ye=_animationCycle(ke,Me),te._yoyo&&Ye&1&&(we=1-we),Ye!==_animationCycle(te._tTime,Me)&&(ve=1-we,te.vars.repeatRefresh&&te._initted&&te.invalidate())),we!==ve||_reverting$1||ae||te._zTime===_tinyNum||!oe&&te._zTime){if(!te._initted&&_attemptInitTween(te,oe,ae,_,ke))return;for(tt=te._zTime,te._zTime=oe||(_?_tinyNum:0),_||(_=oe&&!tt),te.ratio=we,te._from&&(we=1-we),te._time=0,te._tTime=ke,Le=te._pt;Le;)Le.r(we,Le.d),Le=Le._next;oe<0&&_rewindStartAt(te,oe,_,!0),te._onUpdate&&!_&&_callback$1(te,"onUpdate"),ke&&te._repeat&&!_&&te.parent&&_callback$1(te,"onRepeat"),(oe>=te._tDur||oe<0)&&te.ratio===we&&(we&&_removeFromParent(te,1),!_&&!_reverting$1&&(_callback$1(te,we?"onComplete":"onReverseComplete",!0),te._prom&&te._prom()))}else te._zTime||(te._zTime=oe)},_findNextPauseTween=function Te(te,oe,_){var ae;if(_>oe)for(ae=te._first;ae&&ae._start<=_;){if(ae.data==="isPause"&&ae._start>oe)return ae;ae=ae._next}else for(ae=te._last;ae&&ae._start>=_;){if(ae.data==="isPause"&&ae._start<oe)return ae;ae=ae._prev}},_setDuration=function Te(te,oe,_,ae){var ve=te._repeat,we=_roundPrecise(oe)||0,Me=te._tTime/te._tDur;return Me&&!ae&&(te._time*=we/te._dur),te._dur=we,te._tDur=ve?ve<0?1e10:_roundPrecise(we*(ve+1)+te._rDelay*ve):we,Me>0&&!ae&&_alignPlayhead(te,te._tTime=te._tDur*Me),te.parent&&_setEnd(te),_||_uncache(te.parent,te),te},_onUpdateTotalDuration=function Te(te){return te instanceof Timeline?_uncache(te):_setDuration(te,te._dur)},_zeroPosition={_start:0,endTime:_emptyFunc,totalDuration:_emptyFunc},_parsePosition$1=function Te(te,oe,_){var ae=te.labels,ve=te._recent||_zeroPosition,we=te.duration()>=_bigNum$1?ve.endTime(!1):te._dur,Me,ke,Le;return _isString$1(oe)&&(isNaN(oe)||oe in ae)?(ke=oe.charAt(0),Le=oe.substr(-1)==="%",Me=oe.indexOf("="),ke==="<"||ke===">"?(Me>=0&&(oe=oe.replace(/=/,"")),(ke==="<"?ve._start:ve.endTime(ve._repeat>=0))+(parseFloat(oe.substr(1))||0)*(Le?(Me<0?ve:_).totalDuration()/100:1)):Me<0?(oe in ae||(ae[oe]=we),ae[oe]):(ke=parseFloat(oe.charAt(Me-1)+oe.substr(Me+1)),Le&&_&&(ke=ke/100*(_isArray(_)?_[0]:_).totalDuration()),Me>1?Te(te,oe.substr(0,Me-1),_)+ke:we+ke)):oe==null?we:+oe},_createTweenType=function Te(te,oe,_){var ae=_isNumber$1(oe[1]),ve=(ae?2:1)+(te<2?0:1),we=oe[ve],Me,ke;if(ae&&(we.duration=oe[1]),we.parent=_,te){for(Me=we,ke=_;ke&&!("immediateRender"in Me);)Me=ke.vars.defaults||{},ke=_isNotFalse(ke.vars.inherit)&&ke.parent;we.immediateRender=_isNotFalse(Me.immediateRender),te<2?we.runBackwards=1:we.startAt=oe[ve-1]}return new Tween(oe[0],we,oe[ve+1])},_conditionalReturn=function Te(te,oe){return te||te===0?oe(te):oe},_clamp$1=function Te(te,oe,_){return _<te?te:_>oe?oe:_},getUnit=function Te(te,oe){return!_isString$1(te)||!(oe=_unitExp.exec(te))?"":oe[1]},clamp=function Te(te,oe,_){return _conditionalReturn(_,function(ae){return _clamp$1(te,oe,ae)})},_slice=[].slice,_isArrayLike=function Te(te,oe){return te&&_isObject$1(te)&&"length"in te&&(!oe&&!te.length||te.length-1 in te&&_isObject$1(te[0]))&&!te.nodeType&&te!==_win$3},_flatten=function Te(te,oe,_){return _===void 0&&(_=[]),te.forEach(function(ae){var ve;return _isString$1(ae)&&!oe||_isArrayLike(ae,1)?(ve=_).push.apply(ve,toArray(ae)):_.push(ae)})||_},toArray=function Te(te,oe,_){return _context$2&&!oe&&_context$2.selector?_context$2.selector(te):_isString$1(te)&&!_&&(_coreInitted$2||!_wake())?_slice.call((oe||_doc$3).querySelectorAll(te),0):_isArray(te)?_flatten(te,_):_isArrayLike(te)?_slice.call(te,0):te?[te]:[]},selector=function Te(te){return te=toArray(te)[0]||_warn("Invalid scope")||{},function(oe){var _=te.current||te.nativeElement||te;return toArray(oe,_.querySelectorAll?_:_===te?_warn("Invalid scope")||_doc$3.createElement("div"):te)}},shuffle=function Te(te){return te.sort(function(){return .5-Math.random()})},distribute=function Te(te){if(_isFunction$1(te))return te;var oe=_isObject$1(te)?te:{each:te},_=_parseEase(oe.ease),ae=oe.from||0,ve=parseFloat(oe.base)||0,we={},Me=ae>0&&ae<1,ke=isNaN(ae)||Me,Le=oe.axis,Ye=ae,tt=ae;return _isString$1(ae)?Ye=tt={center:.5,edges:.5,end:1}[ae]||0:!Me&&ke&&(Ye=ae[0],tt=ae[1]),function(Ke,Ge,et){var Ue=(et||oe).length,nt=we[Ue],He,Ze,st,Et,rt,bt,Ne,Qe,We;if(!nt){if(We=oe.grid==="auto"?0:(oe.grid||[1,_bigNum$1])[1],!We){for(Ne=-_bigNum$1;Ne<(Ne=et[We++].getBoundingClientRect().left)&&We<Ue;);We--}for(nt=we[Ue]=[],He=ke?Math.min(We,Ue)*Ye-.5:ae%We,Ze=We===_bigNum$1?0:ke?Ue*tt/We-.5:ae/We|0,Ne=0,Qe=_bigNum$1,bt=0;bt<Ue;bt++)st=bt%We-He,Et=Ze-(bt/We|0),nt[bt]=rt=Le?Math.abs(Le==="y"?Et:st):_sqrt(st*st+Et*Et),rt>Ne&&(Ne=rt),rt<Qe&&(Qe=rt);ae==="random"&&shuffle(nt),nt.max=Ne-Qe,nt.min=Qe,nt.v=Ue=(parseFloat(oe.amount)||parseFloat(oe.each)*(We>Ue?Ue-1:Le?Le==="y"?Ue/We:We:Math.max(We,Ue/We))||0)*(ae==="edges"?-1:1),nt.b=Ue<0?ve-Ue:ve,nt.u=getUnit(oe.amount||oe.each)||0,_=_&&Ue<0?_invertEase(_):_}return Ue=(nt[Ke]-nt.min)/nt.max||0,_roundPrecise(nt.b+(_?_(Ue):Ue)*nt.v)+nt.u}},_roundModifier=function Te(te){var oe=Math.pow(10,((te+"").split(".")[1]||"").length);return function(_){var ae=_roundPrecise(Math.round(parseFloat(_)/te)*te*oe);return(ae-ae%1)/oe+(_isNumber$1(_)?0:getUnit(_))}},snap=function Te(te,oe){var _=_isArray(te),ae,ve;return!_&&_isObject$1(te)&&(ae=_=te.radius||_bigNum$1,te.values?(te=toArray(te.values),(ve=!_isNumber$1(te[0]))&&(ae*=ae)):te=_roundModifier(te.increment)),_conditionalReturn(oe,_?_isFunction$1(te)?function(we){return ve=te(we),Math.abs(ve-we)<=ae?ve:we}:function(we){for(var Me=parseFloat(ve?we.x:we),ke=parseFloat(ve?we.y:0),Le=_bigNum$1,Ye=0,tt=te.length,Ke,Ge;tt--;)ve?(Ke=te[tt].x-Me,Ge=te[tt].y-ke,Ke=Ke*Ke+Ge*Ge):Ke=Math.abs(te[tt]-Me),Ke<Le&&(Le=Ke,Ye=tt);return Ye=!ae||Le<=ae?te[Ye]:we,ve||Ye===we||_isNumber$1(we)?Ye:Ye+getUnit(we)}:_roundModifier(te))},random=function Te(te,oe,_,ae){return _conditionalReturn(_isArray(te)?!oe:_===!0?!!(_=0):!ae,function(){return _isArray(te)?te[~~(Math.random()*te.length)]:(_=_||1e-5)&&(ae=_<1?Math.pow(10,(_+"").length-2):1)&&Math.floor(Math.round((te-_/2+Math.random()*(oe-te+_*.99))/_)*_*ae)/ae})},pipe=function Te(){for(var te=arguments.length,oe=new Array(te),_=0;_<te;_++)oe[_]=arguments[_];return function(ae){return oe.reduce(function(ve,we){return we(ve)},ae)}},unitize=function Te(te,oe){return function(_){return te(parseFloat(_))+(oe||getUnit(_))}},normalize=function Te(te,oe,_){return mapRange(te,oe,0,1,_)},_wrapArray=function Te(te,oe,_){return _conditionalReturn(_,function(ae){return te[~~oe(ae)]})},wrap=function Te(te,oe,_){var ae=oe-te;return _isArray(te)?_wrapArray(te,Te(0,te.length),oe):_conditionalReturn(_,function(ve){return(ae+(ve-te)%ae)%ae+te})},wrapYoyo=function Te(te,oe,_){var ae=oe-te,ve=ae*2;return _isArray(te)?_wrapArray(te,Te(0,te.length-1),oe):_conditionalReturn(_,function(we){return we=(ve+(we-te)%ve)%ve||0,te+(we>ae?ve-we:we)})},_replaceRandom=function Te(te){for(var oe=0,_="",ae,ve,we,Me;~(ae=te.indexOf("random(",oe));)we=te.indexOf(")",ae),Me=te.charAt(ae+7)==="[",ve=te.substr(ae+7,we-ae-7).match(Me?_delimitedValueExp:_strictNumExp),_+=te.substr(oe,ae-oe)+random(Me?ve:+ve[0],Me?0:+ve[1],+ve[2]||1e-5),oe=we+1;return _+te.substr(oe,te.length-oe)},mapRange=function Te(te,oe,_,ae,ve){var we=oe-te,Me=ae-_;return _conditionalReturn(ve,function(ke){return _+((ke-te)/we*Me||0)})},interpolate=function Te(te,oe,_,ae){var ve=isNaN(te+oe)?0:function(Ge){return(1-Ge)*te+Ge*oe};if(!ve){var we=_isString$1(te),Me={},ke,Le,Ye,tt,Ke;if(_===!0&&(ae=1)&&(_=null),we)te={p:te},oe={p:oe};else if(_isArray(te)&&!_isArray(oe)){for(Ye=[],tt=te.length,Ke=tt-2,Le=1;Le<tt;Le++)Ye.push(Te(te[Le-1],te[Le]));tt--,ve=function(et){et*=tt;var Ue=Math.min(Ke,~~et);return Ye[Ue](et-Ue)},_=oe}else ae||(te=_merge(_isArray(te)?[]:{},te));if(!Ye){for(ke in oe)_addPropTween.call(Me,te,ke,"get",oe[ke]);ve=function(et){return _renderPropTweens(et,Me)||(we?te.p:te)}}}return _conditionalReturn(_,ve)},_getLabelInDirection=function Te(te,oe,_){var ae=te.labels,ve=_bigNum$1,we,Me,ke;for(we in ae)Me=ae[we]-oe,Me<0==!!_&&Me&&ve>(Me=Math.abs(Me))&&(ke=we,ve=Me);return ke},_callback$1=function Te(te,oe,_){var ae=te.vars,ve=ae[oe],we=_context$2,Me=te._ctx,ke,Le,Ye;if(ve)return ke=ae[oe+"Params"],Le=ae.callbackScope||te,_&&_lazyTweens.length&&_lazyRender(),Me&&(_context$2=Me),Ye=ke?ve.apply(Le,ke):ve.call(Le),_context$2=we,Ye},_interrupt=function Te(te){return _removeFromParent(te),te.scrollTrigger&&te.scrollTrigger.kill(!!_reverting$1),te.progress()<1&&_callback$1(te,"onInterrupt"),te},_quickTween,_registerPluginQueue=[],_createPlugin=function Te(te){if(!_windowExists$2()){_registerPluginQueue.push(te);return}te=!te.name&&te.default||te;var oe=te.name,_=_isFunction$1(te),ae=oe&&!_&&te.init?function(){this._props=[]}:te,ve={init:_emptyFunc,render:_renderPropTweens,add:_addPropTween,kill:_killPropTweensOf,modifier:_addPluginModifier,rawVars:0},we={targetTest:0,get:0,getSetter:_getSetter,aliases:{},register:0};if(_wake(),te!==ae){if(_plugins[oe])return;_setDefaults$1(ae,_setDefaults$1(_copyExcluding(te,ve),we)),_merge(ae.prototype,_merge(ve,_copyExcluding(te,we))),_plugins[ae.prop=oe]=ae,te.targetTest&&(_harnessPlugins.push(ae),_reservedProps[oe]=1),oe=(oe==="css"?"CSS":oe.charAt(0).toUpperCase()+oe.substr(1))+"Plugin"}_addGlobal(oe,ae),te.register&&te.register(gsap$2,ae,PropTween)},_255=255,_colorLookup={aqua:[0,_255,_255],lime:[0,_255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,_255],navy:[0,0,128],white:[_255,_255,_255],olive:[128,128,0],yellow:[_255,_255,0],orange:[_255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[_255,0,0],pink:[_255,192,203],cyan:[0,_255,_255],transparent:[_255,_255,_255,0]},_hue=function Te(te,oe,_){return te+=te<0?1:te>1?-1:0,(te*6<1?oe+(_-oe)*te*6:te<.5?_:te*3<2?oe+(_-oe)*(2/3-te)*6:oe)*_255+.5|0},splitColor=function Te(te,oe,_){var ae=te?_isNumber$1(te)?[te>>16,te>>8&_255,te&_255]:0:_colorLookup.black,ve,we,Me,ke,Le,Ye,tt,Ke,Ge,et;if(!ae){if(te.substr(-1)===","&&(te=te.substr(0,te.length-1)),_colorLookup[te])ae=_colorLookup[te];else if(te.charAt(0)==="#"){if(te.length<6&&(ve=te.charAt(1),we=te.charAt(2),Me=te.charAt(3),te="#"+ve+ve+we+we+Me+Me+(te.length===5?te.charAt(4)+te.charAt(4):"")),te.length===9)return ae=parseInt(te.substr(1,6),16),[ae>>16,ae>>8&_255,ae&_255,parseInt(te.substr(7),16)/255];te=parseInt(te.substr(1),16),ae=[te>>16,te>>8&_255,te&_255]}else if(te.substr(0,3)==="hsl"){if(ae=et=te.match(_strictNumExp),!oe)ke=+ae[0]%360/360,Le=+ae[1]/100,Ye=+ae[2]/100,we=Ye<=.5?Ye*(Le+1):Ye+Le-Ye*Le,ve=Ye*2-we,ae.length>3&&(ae[3]*=1),ae[0]=_hue(ke+1/3,ve,we),ae[1]=_hue(ke,ve,we),ae[2]=_hue(ke-1/3,ve,we);else if(~te.indexOf("="))return ae=te.match(_numExp),_&&ae.length<4&&(ae[3]=1),ae}else ae=te.match(_strictNumExp)||_colorLookup.transparent;ae=ae.map(Number)}return oe&&!et&&(ve=ae[0]/_255,we=ae[1]/_255,Me=ae[2]/_255,tt=Math.max(ve,we,Me),Ke=Math.min(ve,we,Me),Ye=(tt+Ke)/2,tt===Ke?ke=Le=0:(Ge=tt-Ke,Le=Ye>.5?Ge/(2-tt-Ke):Ge/(tt+Ke),ke=tt===ve?(we-Me)/Ge+(we<Me?6:0):tt===we?(Me-ve)/Ge+2:(ve-we)/Ge+4,ke*=60),ae[0]=~~(ke+.5),ae[1]=~~(Le*100+.5),ae[2]=~~(Ye*100+.5)),_&&ae.length<4&&(ae[3]=1),ae},_colorOrderData=function Te(te){var oe=[],_=[],ae=-1;return te.split(_colorExp).forEach(function(ve){var we=ve.match(_numWithUnitExp)||[];oe.push.apply(oe,we),_.push(ae+=we.length+1)}),oe.c=_,oe},_formatColors=function Te(te,oe,_){var ae="",ve=(te+ae).match(_colorExp),we=oe?"hsla(":"rgba(",Me=0,ke,Le,Ye,tt;if(!ve)return te;if(ve=ve.map(function(Ke){return(Ke=splitColor(Ke,oe,1))&&we+(oe?Ke[0]+","+Ke[1]+"%,"+Ke[2]+"%,"+Ke[3]:Ke.join(","))+")"}),_&&(Ye=_colorOrderData(te),ke=_.c,ke.join(ae)!==Ye.c.join(ae)))for(Le=te.replace(_colorExp,"1").split(_numWithUnitExp),tt=Le.length-1;Me<tt;Me++)ae+=Le[Me]+(~ke.indexOf(Me)?ve.shift()||we+"0,0,0,0)":(Ye.length?Ye:ve.length?ve:_).shift());if(!Le)for(Le=te.split(_colorExp),tt=Le.length-1;Me<tt;Me++)ae+=Le[Me]+ve[Me];return ae+Le[tt]},_colorExp=function(){var Te="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",te;for(te in _colorLookup)Te+="|"+te+"\\b";return new RegExp(Te+")","gi")}(),_hslExp=/hsl[a]?\(/,_colorStringFilter=function Te(te){var oe=te.join(" "),_;if(_colorExp.lastIndex=0,_colorExp.test(oe))return _=_hslExp.test(oe),te[1]=_formatColors(te[1],_),te[0]=_formatColors(te[0],_,_colorOrderData(te[1])),!0},_tickerActive,_ticker=function(){var Te=Date.now,te=500,oe=33,_=Te(),ae=_,ve=1e3/240,we=ve,Me=[],ke,Le,Ye,tt,Ke,Ge,et=function Ue(nt){var He=Te()-ae,Ze=nt===!0,st,Et,rt,bt;if(He>te&&(_+=He-oe),ae+=He,rt=ae-_,st=rt-we,(st>0||Ze)&&(bt=++tt.frame,Ke=rt-tt.time*1e3,tt.time=rt=rt/1e3,we+=st+(st>=ve?4:ve-st),Et=1),Ze||(ke=Le(Ue)),Et)for(Ge=0;Ge<Me.length;Ge++)Me[Ge](rt,Ke,bt,nt)};return tt={time:0,frame:0,tick:function(){et(!0)},deltaRatio:function(nt){return Ke/(1e3/(nt||60))},wake:function(){_coreReady&&(!_coreInitted$2&&_windowExists$2()&&(_win$3=_coreInitted$2=window,_doc$3=_win$3.document||{},_globals.gsap=gsap$2,(_win$3.gsapVersions||(_win$3.gsapVersions=[])).push(gsap$2.version),_install(_installScope||_win$3.GreenSockGlobals||!_win$3.gsap&&_win$3||{}),Ye=_win$3.requestAnimationFrame,_registerPluginQueue.forEach(_createPlugin)),ke&&tt.sleep(),Le=Ye||function(nt){return setTimeout(nt,we-tt.time*1e3+1|0)},_tickerActive=1,et(2))},sleep:function(){(Ye?_win$3.cancelAnimationFrame:clearTimeout)(ke),_tickerActive=0,Le=_emptyFunc},lagSmoothing:function(nt,He){te=nt||1/0,oe=Math.min(He||33,te)},fps:function(nt){ve=1e3/(nt||240),we=tt.time*1e3+ve},add:function(nt,He,Ze){var st=He?function(Et,rt,bt,Ne){nt(Et,rt,bt,Ne),tt.remove(st)}:nt;return tt.remove(nt),Me[Ze?"unshift":"push"](st),_wake(),st},remove:function(nt,He){~(He=Me.indexOf(nt))&&Me.splice(He,1)&&Ge>=He&&Ge--},_listeners:Me},tt}(),_wake=function Te(){return!_tickerActive&&_ticker.wake()},_easeMap={},_customEaseExp=/^[\d.\-M][\d.\-,\s]/,_quotesExp=/["']/g,_parseObjectInString=function Te(te){for(var oe={},_=te.substr(1,te.length-3).split(":"),ae=_[0],ve=1,we=_.length,Me,ke,Le;ve<we;ve++)ke=_[ve],Me=ve!==we-1?ke.lastIndexOf(","):ke.length,Le=ke.substr(0,Me),oe[ae]=isNaN(Le)?Le.replace(_quotesExp,"").trim():+Le,ae=ke.substr(Me+1).trim();return oe},_valueInParentheses=function Te(te){var oe=te.indexOf("(")+1,_=te.indexOf(")"),ae=te.indexOf("(",oe);return te.substring(oe,~ae&&ae<_?te.indexOf(")",_+1):_)},_configEaseFromString=function Te(te){var oe=(te+"").split("("),_=_easeMap[oe[0]];return _&&oe.length>1&&_.config?_.config.apply(null,~te.indexOf("{")?[_parseObjectInString(oe[1])]:_valueInParentheses(te).split(",").map(_numericIfPossible)):_easeMap._CE&&_customEaseExp.test(te)?_easeMap._CE("",te):_},_invertEase=function Te(te){return function(oe){return 1-te(1-oe)}},_propagateYoyoEase=function Te(te,oe){for(var _=te._first,ae;_;)_ instanceof Timeline?Te(_,oe):_.vars.yoyoEase&&(!_._yoyo||!_._repeat)&&_._yoyo!==oe&&(_.timeline?Te(_.timeline,oe):(ae=_._ease,_._ease=_._yEase,_._yEase=ae,_._yoyo=oe)),_=_._next},_parseEase=function Te(te,oe){return te&&(_isFunction$1(te)?te:_easeMap[te]||_configEaseFromString(te))||oe},_insertEase=function Te(te,oe,_,ae){_===void 0&&(_=function(ke){return 1-oe(1-ke)}),ae===void 0&&(ae=function(ke){return ke<.5?oe(ke*2)/2:1-oe((1-ke)*2)/2});var ve={easeIn:oe,easeOut:_,easeInOut:ae},we;return _forEachName(te,function(Me){_easeMap[Me]=_globals[Me]=ve,_easeMap[we=Me.toLowerCase()]=_;for(var ke in ve)_easeMap[we+(ke==="easeIn"?".in":ke==="easeOut"?".out":".inOut")]=_easeMap[Me+"."+ke]=ve[ke]}),ve},_easeInOutFromOut=function Te(te){return function(oe){return oe<.5?(1-te(1-oe*2))/2:.5+te((oe-.5)*2)/2}},_configElastic=function Te(te,oe,_){var ae=oe>=1?oe:1,ve=(_||(te?.3:.45))/(oe<1?oe:1),we=ve/_2PI*(Math.asin(1/ae)||0),Me=function(Ye){return Ye===1?1:ae*Math.pow(2,-10*Ye)*_sin((Ye-we)*ve)+1},ke=te==="out"?Me:te==="in"?function(Le){return 1-Me(1-Le)}:_easeInOutFromOut(Me);return ve=_2PI/ve,ke.config=function(Le,Ye){return Te(te,Le,Ye)},ke},_configBack=function Te(te,oe){oe===void 0&&(oe=1.70158);var _=function(we){return we?--we*we*((oe+1)*we+oe)+1:0},ae=te==="out"?_:te==="in"?function(ve){return 1-_(1-ve)}:_easeInOutFromOut(_);return ae.config=function(ve){return Te(te,ve)},ae};_forEachName("Linear,Quad,Cubic,Quart,Quint,Strong",function(Te,te){var oe=te<5?te+1:te;_insertEase(Te+",Power"+(oe-1),te?function(_){return Math.pow(_,oe)}:function(_){return _},function(_){return 1-Math.pow(1-_,oe)},function(_){return _<.5?Math.pow(_*2,oe)/2:1-Math.pow((1-_)*2,oe)/2})});_easeMap.Linear.easeNone=_easeMap.none=_easeMap.Linear.easeIn;_insertEase("Elastic",_configElastic("in"),_configElastic("out"),_configElastic());(function(Te,te){var oe=1/te,_=2*oe,ae=2.5*oe,ve=function(Me){return Me<oe?Te*Me*Me:Me<_?Te*Math.pow(Me-1.5/te,2)+.75:Me<ae?Te*(Me-=2.25/te)*Me+.9375:Te*Math.pow(Me-2.625/te,2)+.984375};_insertEase("Bounce",function(we){return 1-ve(1-we)},ve)})(7.5625,2.75);_insertEase("Expo",function(Te){return Te?Math.pow(2,10*(Te-1)):0});_insertEase("Circ",function(Te){return-(_sqrt(1-Te*Te)-1)});_insertEase("Sine",function(Te){return Te===1?1:-_cos(Te*_HALF_PI)+1});_insertEase("Back",_configBack("in"),_configBack("out"),_configBack());_easeMap.SteppedEase=_easeMap.steps=_globals.SteppedEase={config:function Te(te,oe){te===void 0&&(te=1);var _=1/te,ae=te+(oe?0:1),ve=oe?1:0,we=1-_tinyNum;return function(Me){return((ae*_clamp$1(0,we,Me)|0)+ve)*_}}};_defaults$1.ease=_easeMap["quad.out"];_forEachName("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(Te){return _callbackNames+=Te+","+Te+"Params,"});var GSCache=function Te(te,oe){this.id=_gsID++,te._gsap=this,this.target=te,this.harness=oe,this.get=oe?oe.get:_getProperty,this.set=oe?oe.getSetter:_getSetter},Animation=function(){function Te(oe){this.vars=oe,this._delay=+oe.delay||0,(this._repeat=oe.repeat===1/0?-2:oe.repeat||0)&&(this._rDelay=oe.repeatDelay||0,this._yoyo=!!oe.yoyo||!!oe.yoyoEase),this._ts=1,_setDuration(this,+oe.duration,1,1),this.data=oe.data,_context$2&&(this._ctx=_context$2,_context$2.data.push(this)),_tickerActive||_ticker.wake()}var te=Te.prototype;return te.delay=function(_){return _||_===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+_-this._delay),this._delay=_,this):this._delay},te.duration=function(_){return arguments.length?this.totalDuration(this._repeat>0?_+(_+this._rDelay)*this._repeat:_):this.totalDuration()&&this._dur},te.totalDuration=function(_){return arguments.length?(this._dirty=0,_setDuration(this,this._repeat<0?_:(_-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},te.totalTime=function(_,ae){if(_wake(),!arguments.length)return this._tTime;var ve=this._dp;if(ve&&ve.smoothChildTiming&&this._ts){for(_alignPlayhead(this,_),!ve._dp||ve.parent||_postAddChecks(ve,this);ve&&ve.parent;)ve.parent._time!==ve._start+(ve._ts>=0?ve._tTime/ve._ts:(ve.totalDuration()-ve._tTime)/-ve._ts)&&ve.totalTime(ve._tTime,!0),ve=ve.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&_<this._tDur||this._ts<0&&_>0||!this._tDur&&!_)&&_addToTimeline(this._dp,this,this._start-this._delay)}return(this._tTime!==_||!this._dur&&!ae||this._initted&&Math.abs(this._zTime)===_tinyNum||!_&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=_),_lazySafeRender(this,_,ae)),this},te.time=function(_,ae){return arguments.length?this.totalTime(Math.min(this.totalDuration(),_+_elapsedCycleDuration(this))%(this._dur+this._rDelay)||(_?this._dur:0),ae):this._time},te.totalProgress=function(_,ae){return arguments.length?this.totalTime(this.totalDuration()*_,ae):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},te.progress=function(_,ae){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-_:_)+_elapsedCycleDuration(this),ae):this.duration()?Math.min(1,this._time/this._dur):this.ratio},te.iteration=function(_,ae){var ve=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(_-1)*ve,ae):this._repeat?_animationCycle(this._tTime,ve)+1:1},te.timeScale=function(_){if(!arguments.length)return this._rts===-_tinyNum?0:this._rts;if(this._rts===_)return this;var ae=this.parent&&this._ts?_parentToChildTotalTime(this.parent._time,this):this._tTime;return this._rts=+_||0,this._ts=this._ps||_===-_tinyNum?0:this._rts,this.totalTime(_clamp$1(-Math.abs(this._delay),this._tDur,ae),!0),_setEnd(this),_recacheAncestors(this)},te.paused=function(_){return arguments.length?(this._ps!==_&&(this._ps=_,_?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(_wake(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==_tinyNum&&(this._tTime-=_tinyNum)))),this):this._ps},te.startTime=function(_){if(arguments.length){this._start=_;var ae=this.parent||this._dp;return ae&&(ae._sort||!this.parent)&&_addToTimeline(ae,this,_-this._delay),this}return this._start},te.endTime=function(_){return this._start+(_isNotFalse(_)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},te.rawTime=function(_){var ae=this.parent||this._dp;return ae?_&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?_parentToChildTotalTime(ae.rawTime(_),this):this._tTime:this._tTime},te.revert=function(_){_===void 0&&(_=_revertConfig);var ae=_reverting$1;return _reverting$1=_,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(_),this.totalTime(-.01,_.suppressEvents)),this.data!=="nested"&&_.kill!==!1&&this.kill(),_reverting$1=ae,this},te.globalTime=function(_){for(var ae=this,ve=arguments.length?_:ae.rawTime();ae;)ve=ae._start+ve/(ae._ts||1),ae=ae._dp;return!this.parent&&this._sat?this._sat.vars.immediateRender?-1:this._sat.globalTime(_):ve},te.repeat=function(_){return arguments.length?(this._repeat=_===1/0?-2:_,_onUpdateTotalDuration(this)):this._repeat===-2?1/0:this._repeat},te.repeatDelay=function(_){if(arguments.length){var ae=this._time;return this._rDelay=_,_onUpdateTotalDuration(this),ae?this.time(ae):this}return this._rDelay},te.yoyo=function(_){return arguments.length?(this._yoyo=_,this):this._yoyo},te.seek=function(_,ae){return this.totalTime(_parsePosition$1(this,_),_isNotFalse(ae))},te.restart=function(_,ae){return this.play().totalTime(_?-this._delay:0,_isNotFalse(ae))},te.play=function(_,ae){return _!=null&&this.seek(_,ae),this.reversed(!1).paused(!1)},te.reverse=function(_,ae){return _!=null&&this.seek(_||this.totalDuration(),ae),this.reversed(!0).paused(!1)},te.pause=function(_,ae){return _!=null&&this.seek(_,ae),this.paused(!0)},te.resume=function(){return this.paused(!1)},te.reversed=function(_){return arguments.length?(!!_!==this.reversed()&&this.timeScale(-this._rts||(_?-_tinyNum:0)),this):this._rts<0},te.invalidate=function(){return this._initted=this._act=0,this._zTime=-_tinyNum,this},te.isActive=function(){var _=this.parent||this._dp,ae=this._start,ve;return!!(!_||this._ts&&this._initted&&_.isActive()&&(ve=_.rawTime(!0))>=ae&&ve<this.endTime(!0)-_tinyNum)},te.eventCallback=function(_,ae,ve){var we=this.vars;return arguments.length>1?(ae?(we[_]=ae,ve&&(we[_+"Params"]=ve),_==="onUpdate"&&(this._onUpdate=ae)):delete we[_],this):we[_]},te.then=function(_){var ae=this;return new Promise(function(ve){var we=_isFunction$1(_)?_:_passThrough$1,Me=function(){var Le=ae.then;ae.then=null,_isFunction$1(we)&&(we=we(ae))&&(we.then||we===ae)&&(ae.then=Le),ve(we),ae.then=Le};ae._initted&&ae.totalProgress()===1&&ae._ts>=0||!ae._tTime&&ae._ts<0?Me():ae._prom=Me})},te.kill=function(){_interrupt(this)},Te}();_setDefaults$1(Animation.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-_tinyNum,_prom:0,_ps:!1,_rts:1});var Timeline=function(Te){_inheritsLoose(te,Te);function te(_,ae){var ve;return _===void 0&&(_={}),ve=Te.call(this,_)||this,ve.labels={},ve.smoothChildTiming=!!_.smoothChildTiming,ve.autoRemoveChildren=!!_.autoRemoveChildren,ve._sort=_isNotFalse(_.sortChildren),_globalTimeline&&_addToTimeline(_.parent||_globalTimeline,_assertThisInitialized(ve),ae),_.reversed&&ve.reverse(),_.paused&&ve.paused(!0),_.scrollTrigger&&_scrollTrigger(_assertThisInitialized(ve),_.scrollTrigger),ve}var oe=te.prototype;return oe.to=function(ae,ve,we){return _createTweenType(0,arguments,this),this},oe.from=function(ae,ve,we){return _createTweenType(1,arguments,this),this},oe.fromTo=function(ae,ve,we,Me){return _createTweenType(2,arguments,this),this},oe.set=function(ae,ve,we){return ve.duration=0,ve.parent=this,_inheritDefaults(ve).repeatDelay||(ve.repeat=0),ve.immediateRender=!!ve.immediateRender,new Tween(ae,ve,_parsePosition$1(this,we),1),this},oe.call=function(ae,ve,we){return _addToTimeline(this,Tween.delayedCall(0,ae,ve),we)},oe.staggerTo=function(ae,ve,we,Me,ke,Le,Ye){return we.duration=ve,we.stagger=we.stagger||Me,we.onComplete=Le,we.onCompleteParams=Ye,we.parent=this,new Tween(ae,we,_parsePosition$1(this,ke)),this},oe.staggerFrom=function(ae,ve,we,Me,ke,Le,Ye){return we.runBackwards=1,_inheritDefaults(we).immediateRender=_isNotFalse(we.immediateRender),this.staggerTo(ae,ve,we,Me,ke,Le,Ye)},oe.staggerFromTo=function(ae,ve,we,Me,ke,Le,Ye,tt){return Me.startAt=we,_inheritDefaults(Me).immediateRender=_isNotFalse(Me.immediateRender),this.staggerTo(ae,ve,Me,ke,Le,Ye,tt)},oe.render=function(ae,ve,we){var Me=this._time,ke=this._dirty?this.totalDuration():this._tDur,Le=this._dur,Ye=ae<=0?0:_roundPrecise(ae),tt=this._zTime<0!=ae<0&&(this._initted||!Le),Ke,Ge,et,Ue,nt,He,Ze,st,Et,rt,bt,Ne;if(this!==_globalTimeline&&Ye>ke&&ae>=0&&(Ye=ke),Ye!==this._tTime||we||tt){if(Me!==this._time&&Le&&(Ye+=this._time-Me,ae+=this._time-Me),Ke=Ye,Et=this._start,st=this._ts,He=!st,tt&&(Le||(Me=this._zTime),(ae||!ve)&&(this._zTime=ae)),this._repeat){if(bt=this._yoyo,nt=Le+this._rDelay,this._repeat<-1&&ae<0)return this.totalTime(nt*100+ae,ve,we);if(Ke=_roundPrecise(Ye%nt),Ye===ke?(Ue=this._repeat,Ke=Le):(Ue=~~(Ye/nt),Ue&&Ue===Ye/nt&&(Ke=Le,Ue--),Ke>Le&&(Ke=Le)),rt=_animationCycle(this._tTime,nt),!Me&&this._tTime&&rt!==Ue&&this._tTime-rt*nt-this._dur<=0&&(rt=Ue),bt&&Ue&1&&(Ke=Le-Ke,Ne=1),Ue!==rt&&!this._lock){var Qe=bt&&rt&1,We=Qe===(bt&&Ue&1);if(Ue<rt&&(Qe=!Qe),Me=Qe?0:Le,this._lock=1,this.render(Me||(Ne?0:_roundPrecise(Ue*nt)),ve,!Le)._lock=0,this._tTime=Ye,!ve&&this.parent&&_callback$1(this,"onRepeat"),this.vars.repeatRefresh&&!Ne&&(this.invalidate()._lock=1),Me&&Me!==this._time||He!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(Le=this._dur,ke=this._tDur,We&&(this._lock=2,Me=Qe?Le:-1e-4,this.render(Me,!0),this.vars.repeatRefresh&&!Ne&&this.invalidate()),this._lock=0,!this._ts&&!He)return this;_propagateYoyoEase(this,Ne)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(Ze=_findNextPauseTween(this,_roundPrecise(Me),_roundPrecise(Ke)),Ze&&(Ye-=Ke-(Ke=Ze._start))),this._tTime=Ye,this._time=Ke,this._act=!st,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=ae,Me=0),!Me&&Ke&&!ve&&!Ue&&(_callback$1(this,"onStart"),this._tTime!==Ye))return this;if(Ke>=Me&&ae>=0)for(Ge=this._first;Ge;){if(et=Ge._next,(Ge._act||Ke>=Ge._start)&&Ge._ts&&Ze!==Ge){if(Ge.parent!==this)return this.render(ae,ve,we);if(Ge.render(Ge._ts>0?(Ke-Ge._start)*Ge._ts:(Ge._dirty?Ge.totalDuration():Ge._tDur)+(Ke-Ge._start)*Ge._ts,ve,we),Ke!==this._time||!this._ts&&!He){Ze=0,et&&(Ye+=this._zTime=-_tinyNum);break}}Ge=et}else{Ge=this._last;for(var _t=ae<0?ae:Ke;Ge;){if(et=Ge._prev,(Ge._act||_t<=Ge._end)&&Ge._ts&&Ze!==Ge){if(Ge.parent!==this)return this.render(ae,ve,we);if(Ge.render(Ge._ts>0?(_t-Ge._start)*Ge._ts:(Ge._dirty?Ge.totalDuration():Ge._tDur)+(_t-Ge._start)*Ge._ts,ve,we||_reverting$1&&(Ge._initted||Ge._startAt)),Ke!==this._time||!this._ts&&!He){Ze=0,et&&(Ye+=this._zTime=_t?-_tinyNum:_tinyNum);break}}Ge=et}}if(Ze&&!ve&&(this.pause(),Ze.render(Ke>=Me?0:-_tinyNum)._zTime=Ke>=Me?1:-1,this._ts))return this._start=Et,_setEnd(this),this.render(ae,ve,we);this._onUpdate&&!ve&&_callback$1(this,"onUpdate",!0),(Ye===ke&&this._tTime>=this.totalDuration()||!Ye&&Me)&&(Et===this._start||Math.abs(st)!==Math.abs(this._ts))&&(this._lock||((ae||!Le)&&(Ye===ke&&this._ts>0||!Ye&&this._ts<0)&&_removeFromParent(this,1),!ve&&!(ae<0&&!Me)&&(Ye||Me||!ke)&&(_callback$1(this,Ye===ke&&ae>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(Ye<ke&&this.timeScale()>0)&&this._prom())))}return this},oe.add=function(ae,ve){var we=this;if(_isNumber$1(ve)||(ve=_parsePosition$1(this,ve,ae)),!(ae instanceof Animation)){if(_isArray(ae))return ae.forEach(function(Me){return we.add(Me,ve)}),this;if(_isString$1(ae))return this.addLabel(ae,ve);if(_isFunction$1(ae))ae=Tween.delayedCall(0,ae);else return this}return this!==ae?_addToTimeline(this,ae,ve):this},oe.getChildren=function(ae,ve,we,Me){ae===void 0&&(ae=!0),ve===void 0&&(ve=!0),we===void 0&&(we=!0),Me===void 0&&(Me=-_bigNum$1);for(var ke=[],Le=this._first;Le;)Le._start>=Me&&(Le instanceof Tween?ve&&ke.push(Le):(we&&ke.push(Le),ae&&ke.push.apply(ke,Le.getChildren(!0,ve,we)))),Le=Le._next;return ke},oe.getById=function(ae){for(var ve=this.getChildren(1,1,1),we=ve.length;we--;)if(ve[we].vars.id===ae)return ve[we]},oe.remove=function(ae){return _isString$1(ae)?this.removeLabel(ae):_isFunction$1(ae)?this.killTweensOf(ae):(_removeLinkedListItem(this,ae),ae===this._recent&&(this._recent=this._last),_uncache(this))},oe.totalTime=function(ae,ve){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=_roundPrecise(_ticker.time-(this._ts>0?ae/this._ts:(this.totalDuration()-ae)/-this._ts))),Te.prototype.totalTime.call(this,ae,ve),this._forcing=0,this):this._tTime},oe.addLabel=function(ae,ve){return this.labels[ae]=_parsePosition$1(this,ve),this},oe.removeLabel=function(ae){return delete this.labels[ae],this},oe.addPause=function(ae,ve,we){var Me=Tween.delayedCall(0,ve||_emptyFunc,we);return Me.data="isPause",this._hasPause=1,_addToTimeline(this,Me,_parsePosition$1(this,ae))},oe.removePause=function(ae){var ve=this._first;for(ae=_parsePosition$1(this,ae);ve;)ve._start===ae&&ve.data==="isPause"&&_removeFromParent(ve),ve=ve._next},oe.killTweensOf=function(ae,ve,we){for(var Me=this.getTweensOf(ae,we),ke=Me.length;ke--;)_overwritingTween!==Me[ke]&&Me[ke].kill(ae,ve);return this},oe.getTweensOf=function(ae,ve){for(var we=[],Me=toArray(ae),ke=this._first,Le=_isNumber$1(ve),Ye;ke;)ke instanceof Tween?_arrayContainsAny(ke._targets,Me)&&(Le?(!_overwritingTween||ke._initted&&ke._ts)&&ke.globalTime(0)<=ve&&ke.globalTime(ke.totalDuration())>ve:!ve||ke.isActive())&&we.push(ke):(Ye=ke.getTweensOf(Me,ve)).length&&we.push.apply(we,Ye),ke=ke._next;return we},oe.tweenTo=function(ae,ve){ve=ve||{};var we=this,Me=_parsePosition$1(we,ae),ke=ve,Le=ke.startAt,Ye=ke.onStart,tt=ke.onStartParams,Ke=ke.immediateRender,Ge,et=Tween.to(we,_setDefaults$1({ease:ve.ease||"none",lazy:!1,immediateRender:!1,time:Me,overwrite:"auto",duration:ve.duration||Math.abs((Me-(Le&&"time"in Le?Le.time:we._time))/we.timeScale())||_tinyNum,onStart:function(){if(we.pause(),!Ge){var nt=ve.duration||Math.abs((Me-(Le&&"time"in Le?Le.time:we._time))/we.timeScale());et._dur!==nt&&_setDuration(et,nt,0,1).render(et._time,!0,!0),Ge=1}Ye&&Ye.apply(et,tt||[])}},ve));return Ke?et.render(0):et},oe.tweenFromTo=function(ae,ve,we){return this.tweenTo(ve,_setDefaults$1({startAt:{time:_parsePosition$1(this,ae)}},we))},oe.recent=function(){return this._recent},oe.nextLabel=function(ae){return ae===void 0&&(ae=this._time),_getLabelInDirection(this,_parsePosition$1(this,ae))},oe.previousLabel=function(ae){return ae===void 0&&(ae=this._time),_getLabelInDirection(this,_parsePosition$1(this,ae),1)},oe.currentLabel=function(ae){return arguments.length?this.seek(ae,!0):this.previousLabel(this._time+_tinyNum)},oe.shiftChildren=function(ae,ve,we){we===void 0&&(we=0);for(var Me=this._first,ke=this.labels,Le;Me;)Me._start>=we&&(Me._start+=ae,Me._end+=ae),Me=Me._next;if(ve)for(Le in ke)ke[Le]>=we&&(ke[Le]+=ae);return _uncache(this)},oe.invalidate=function(ae){var ve=this._first;for(this._lock=0;ve;)ve.invalidate(ae),ve=ve._next;return Te.prototype.invalidate.call(this,ae)},oe.clear=function(ae){ae===void 0&&(ae=!0);for(var ve=this._first,we;ve;)we=ve._next,this.remove(ve),ve=we;return this._dp&&(this._time=this._tTime=this._pTime=0),ae&&(this.labels={}),_uncache(this)},oe.totalDuration=function(ae){var ve=0,we=this,Me=we._last,ke=_bigNum$1,Le,Ye,tt;if(arguments.length)return we.timeScale((we._repeat<0?we.duration():we.totalDuration())/(we.reversed()?-ae:ae));if(we._dirty){for(tt=we.parent;Me;)Le=Me._prev,Me._dirty&&Me.totalDuration(),Ye=Me._start,Ye>ke&&we._sort&&Me._ts&&!we._lock?(we._lock=1,_addToTimeline(we,Me,Ye-Me._delay,1)._lock=0):ke=Ye,Ye<0&&Me._ts&&(ve-=Ye,(!tt&&!we._dp||tt&&tt.smoothChildTiming)&&(we._start+=Ye/we._ts,we._time-=Ye,we._tTime-=Ye),we.shiftChildren(-Ye,!1,-1/0),ke=0),Me._end>ve&&Me._ts&&(ve=Me._end),Me=Le;_setDuration(we,we===_globalTimeline&&we._time>ve?we._time:ve,1,1),we._dirty=0}return we._tDur},te.updateRoot=function(ae){if(_globalTimeline._ts&&(_lazySafeRender(_globalTimeline,_parentToChildTotalTime(ae,_globalTimeline)),_lastRenderedFrame=_ticker.frame),_ticker.frame>=_nextGCFrame){_nextGCFrame+=_config.autoSleep||120;var ve=_globalTimeline._first;if((!ve||!ve._ts)&&_config.autoSleep&&_ticker._listeners.length<2){for(;ve&&!ve._ts;)ve=ve._next;ve||_ticker.sleep()}}},te}(Animation);_setDefaults$1(Timeline.prototype,{_lock:0,_hasPause:0,_forcing:0});var _addComplexStringPropTween=function Te(te,oe,_,ae,ve,we,Me){var ke=new PropTween(this._pt,te,oe,0,1,_renderComplexString,null,ve),Le=0,Ye=0,tt,Ke,Ge,et,Ue,nt,He,Ze;for(ke.b=_,ke.e=ae,_+="",ae+="",(He=~ae.indexOf("random("))&&(ae=_replaceRandom(ae)),we&&(Ze=[_,ae],we(Ze,te,oe),_=Ze[0],ae=Ze[1]),Ke=_.match(_complexStringNumExp)||[];tt=_complexStringNumExp.exec(ae);)et=tt[0],Ue=ae.substring(Le,tt.index),Ge?Ge=(Ge+1)%5:Ue.substr(-5)==="rgba("&&(Ge=1),et!==Ke[Ye++]&&(nt=parseFloat(Ke[Ye-1])||0,ke._pt={_next:ke._pt,p:Ue||Ye===1?Ue:",",s:nt,c:et.charAt(1)==="="?_parseRelative(nt,et)-nt:parseFloat(et)-nt,m:Ge&&Ge<4?Math.round:0},Le=_complexStringNumExp.lastIndex);return ke.c=Le<ae.length?ae.substring(Le,ae.length):"",ke.fp=Me,(_relExp.test(ae)||He)&&(ke.e=0),this._pt=ke,ke},_addPropTween=function Te(te,oe,_,ae,ve,we,Me,ke,Le,Ye){_isFunction$1(ae)&&(ae=ae(ve||0,te,we));var tt=te[oe],Ke=_!=="get"?_:_isFunction$1(tt)?Le?te[oe.indexOf("set")||!_isFunction$1(te["get"+oe.substr(3)])?oe:"get"+oe.substr(3)](Le):te[oe]():tt,Ge=_isFunction$1(tt)?Le?_setterFuncWithParam:_setterFunc:_setterPlain,et;if(_isString$1(ae)&&(~ae.indexOf("random(")&&(ae=_replaceRandom(ae)),ae.charAt(1)==="="&&(et=_parseRelative(Ke,ae)+(getUnit(Ke)||0),(et||et===0)&&(ae=et))),!Ye||Ke!==ae||_forceAllPropTweens)return!isNaN(Ke*ae)&&ae!==""?(et=new PropTween(this._pt,te,oe,+Ke||0,ae-(Ke||0),typeof tt=="boolean"?_renderBoolean:_renderPlain,0,Ge),Le&&(et.fp=Le),Me&&et.modifier(Me,this,te),this._pt=et):(!tt&&!(oe in te)&&_missingPlugin(oe,ae),_addComplexStringPropTween.call(this,te,oe,Ke,ae,Ge,ke||_config.stringFilter,Le))},_processVars=function Te(te,oe,_,ae,ve){if(_isFunction$1(te)&&(te=_parseFuncOrString(te,ve,oe,_,ae)),!_isObject$1(te)||te.style&&te.nodeType||_isArray(te)||_isTypedArray(te))return _isString$1(te)?_parseFuncOrString(te,ve,oe,_,ae):te;var we={},Me;for(Me in te)we[Me]=_parseFuncOrString(te[Me],ve,oe,_,ae);return we},_checkPlugin=function Te(te,oe,_,ae,ve,we){var Me,ke,Le,Ye;if(_plugins[te]&&(Me=new _plugins[te]).init(ve,Me.rawVars?oe[te]:_processVars(oe[te],ae,ve,we,_),_,ae,we)!==!1&&(_._pt=ke=new PropTween(_._pt,ve,te,0,1,Me.render,Me,0,Me.priority),_!==_quickTween))for(Le=_._ptLookup[_._targets.indexOf(ve)],Ye=Me._props.length;Ye--;)Le[Me._props[Ye]]=ke;return Me},_overwritingTween,_forceAllPropTweens,_initTween=function Te(te,oe,_){var ae=te.vars,ve=ae.ease,we=ae.startAt,Me=ae.immediateRender,ke=ae.lazy,Le=ae.onUpdate,Ye=ae.onUpdateParams,tt=ae.callbackScope,Ke=ae.runBackwards,Ge=ae.yoyoEase,et=ae.keyframes,Ue=ae.autoRevert,nt=te._dur,He=te._startAt,Ze=te._targets,st=te.parent,Et=st&&st.data==="nested"?st.vars.targets:Ze,rt=te._overwrite==="auto"&&!_suppressOverwrites$1,bt=te.timeline,Ne,Qe,We,_t,lt,Ut,dn,nn,un,Zt,pn,ln,vn;if(bt&&(!et||!ve)&&(ve="none"),te._ease=_parseEase(ve,_defaults$1.ease),te._yEase=Ge?_invertEase(_parseEase(Ge===!0?ve:Ge,_defaults$1.ease)):0,Ge&&te._yoyo&&!te._repeat&&(Ge=te._yEase,te._yEase=te._ease,te._ease=Ge),te._from=!bt&&!!ae.runBackwards,!bt||et&&!ae.stagger){if(nn=Ze[0]?_getCache(Ze[0]).harness:0,ln=nn&&ae[nn.prop],Ne=_copyExcluding(ae,_reservedProps),He&&(He._zTime<0&&He.progress(1),oe<0&&Ke&&Me&&!Ue?He.render(-1,!0):He.revert(Ke&&nt?_revertConfigNoKill:_startAtRevertConfig),He._lazy=0),we){if(_removeFromParent(te._startAt=Tween.set(Ze,_setDefaults$1({data:"isStart",overwrite:!1,parent:st,immediateRender:!0,lazy:!He&&_isNotFalse(ke),startAt:null,delay:0,onUpdate:Le,onUpdateParams:Ye,callbackScope:tt,stagger:0},we))),te._startAt._dp=0,te._startAt._sat=te,oe<0&&(_reverting$1||!Me&&!Ue)&&te._startAt.revert(_revertConfigNoKill),Me&&nt&&oe<=0&&_<=0){oe&&(te._zTime=oe);return}}else if(Ke&&nt&&!He){if(oe&&(Me=!1),We=_setDefaults$1({overwrite:!1,data:"isFromStart",lazy:Me&&!He&&_isNotFalse(ke),immediateRender:Me,stagger:0,parent:st},Ne),ln&&(We[nn.prop]=ln),_removeFromParent(te._startAt=Tween.set(Ze,We)),te._startAt._dp=0,te._startAt._sat=te,oe<0&&(_reverting$1?te._startAt.revert(_revertConfigNoKill):te._startAt.render(-1,!0)),te._zTime=oe,!Me)Te(te._startAt,_tinyNum,_tinyNum);else if(!oe)return}for(te._pt=te._ptCache=0,ke=nt&&_isNotFalse(ke)||ke&&!nt,Qe=0;Qe<Ze.length;Qe++){if(lt=Ze[Qe],dn=lt._gsap||_harness(Ze)[Qe]._gsap,te._ptLookup[Qe]=Zt={},_lazyLookup[dn.id]&&_lazyTweens.length&&_lazyRender(),pn=Et===Ze?Qe:Et.indexOf(lt),nn&&(un=new nn).init(lt,ln||Ne,te,pn,Et)!==!1&&(te._pt=_t=new PropTween(te._pt,lt,un.name,0,1,un.render,un,0,un.priority),un._props.forEach(function(ht){Zt[ht]=_t}),un.priority&&(Ut=1)),!nn||ln)for(We in Ne)_plugins[We]&&(un=_checkPlugin(We,Ne,te,pn,lt,Et))?un.priority&&(Ut=1):Zt[We]=_t=_addPropTween.call(te,lt,We,"get",Ne[We],pn,Et,0,ae.stringFilter);te._op&&te._op[Qe]&&te.kill(lt,te._op[Qe]),rt&&te._pt&&(_overwritingTween=te,_globalTimeline.killTweensOf(lt,Zt,te.globalTime(oe)),vn=!te.parent,_overwritingTween=0),te._pt&&ke&&(_lazyLookup[dn.id]=1)}Ut&&_sortPropTweensByPriority(te),te._onInit&&te._onInit(te)}te._onUpdate=Le,te._initted=(!te._op||te._pt)&&!vn,et&&oe<=0&&bt.render(_bigNum$1,!0,!0)},_updatePropTweens=function Te(te,oe,_,ae,ve,we,Me){var ke=(te._pt&&te._ptCache||(te._ptCache={}))[oe],Le,Ye,tt,Ke;if(!ke)for(ke=te._ptCache[oe]=[],tt=te._ptLookup,Ke=te._targets.length;Ke--;){if(Le=tt[Ke][oe],Le&&Le.d&&Le.d._pt)for(Le=Le.d._pt;Le&&Le.p!==oe&&Le.fp!==oe;)Le=Le._next;if(!Le)return _forceAllPropTweens=1,te.vars[oe]="+=0",_initTween(te,Me),_forceAllPropTweens=0,1;ke.push(Le)}for(Ke=ke.length;Ke--;)Ye=ke[Ke],Le=Ye._pt||Ye,Le.s=(ae||ae===0)&&!ve?ae:Le.s+(ae||0)+we*Le.c,Le.c=_-Le.s,Ye.e&&(Ye.e=_round$1(_)+getUnit(Ye.e)),Ye.b&&(Ye.b=Le.s+getUnit(Ye.b))},_addAliasesToVars=function Te(te,oe){var _=te[0]?_getCache(te[0]).harness:0,ae=_&&_.aliases,ve,we,Me,ke;if(!ae)return oe;ve=_merge({},oe);for(we in ae)if(we in ve)for(ke=ae[we].split(","),Me=ke.length;Me--;)ve[ke[Me]]=ve[we];return ve},_parseKeyframe=function Te(te,oe,_,ae){var ve=oe.ease||ae||"power1.inOut",we,Me;if(_isArray(oe))Me=_[te]||(_[te]=[]),oe.forEach(function(ke,Le){return Me.push({t:Le/(oe.length-1)*100,v:ke,e:ve})});else for(we in oe)Me=_[we]||(_[we]=[]),we==="ease"||Me.push({t:parseFloat(te),v:oe[we],e:ve})},_parseFuncOrString=function Te(te,oe,_,ae,ve){return _isFunction$1(te)?te.call(oe,_,ae,ve):_isString$1(te)&&~te.indexOf("random(")?_replaceRandom(te):te},_staggerTweenProps=_callbackNames+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",_staggerPropsToSkip={};_forEachName(_staggerTweenProps+",id,stagger,delay,duration,paused,scrollTrigger",function(Te){return _staggerPropsToSkip[Te]=1});var Tween=function(Te){_inheritsLoose(te,Te);function te(_,ae,ve,we){var Me;typeof ae=="number"&&(ve.duration=ae,ae=ve,ve=null),Me=Te.call(this,we?ae:_inheritDefaults(ae))||this;var ke=Me.vars,Le=ke.duration,Ye=ke.delay,tt=ke.immediateRender,Ke=ke.stagger,Ge=ke.overwrite,et=ke.keyframes,Ue=ke.defaults,nt=ke.scrollTrigger,He=ke.yoyoEase,Ze=ae.parent||_globalTimeline,st=(_isArray(_)||_isTypedArray(_)?_isNumber$1(_[0]):"length"in ae)?[_]:toArray(_),Et,rt,bt,Ne,Qe,We,_t,lt;if(Me._targets=st.length?_harness(st):_warn("GSAP target "+_+" not found. https://greensock.com",!_config.nullTargetWarn)||[],Me._ptLookup=[],Me._overwrite=Ge,et||Ke||_isFuncOrString(Le)||_isFuncOrString(Ye)){if(ae=Me.vars,Et=Me.timeline=new Timeline({data:"nested",defaults:Ue||{},targets:Ze&&Ze.data==="nested"?Ze.vars.targets:st}),Et.kill(),Et.parent=Et._dp=_assertThisInitialized(Me),Et._start=0,Ke||_isFuncOrString(Le)||_isFuncOrString(Ye)){if(Ne=st.length,_t=Ke&&distribute(Ke),_isObject$1(Ke))for(Qe in Ke)~_staggerTweenProps.indexOf(Qe)&&(lt||(lt={}),lt[Qe]=Ke[Qe]);for(rt=0;rt<Ne;rt++)bt=_copyExcluding(ae,_staggerPropsToSkip),bt.stagger=0,He&&(bt.yoyoEase=He),lt&&_merge(bt,lt),We=st[rt],bt.duration=+_parseFuncOrString(Le,_assertThisInitialized(Me),rt,We,st),bt.delay=(+_parseFuncOrString(Ye,_assertThisInitialized(Me),rt,We,st)||0)-Me._delay,!Ke&&Ne===1&&bt.delay&&(Me._delay=Ye=bt.delay,Me._start+=Ye,bt.delay=0),Et.to(We,bt,_t?_t(rt,We,st):0),Et._ease=_easeMap.none;Et.duration()?Le=Ye=0:Me.timeline=0}else if(et){_inheritDefaults(_setDefaults$1(Et.vars.defaults,{ease:"none"})),Et._ease=_parseEase(et.ease||ae.ease||"none");var Ut=0,dn,nn,un;if(_isArray(et))et.forEach(function(Zt){return Et.to(st,Zt,">")}),Et.duration();else{bt={};for(Qe in et)Qe==="ease"||Qe==="easeEach"||_parseKeyframe(Qe,et[Qe],bt,et.easeEach);for(Qe in bt)for(dn=bt[Qe].sort(function(Zt,pn){return Zt.t-pn.t}),Ut=0,rt=0;rt<dn.length;rt++)nn=dn[rt],un={ease:nn.e,duration:(nn.t-(rt?dn[rt-1].t:0))/100*Le},un[Qe]=nn.v,Et.to(st,un,Ut),Ut+=un.duration;Et.duration()<Le&&Et.to({},{duration:Le-Et.duration()})}}Le||Me.duration(Le=Et.duration())}else Me.timeline=0;return Ge===!0&&!_suppressOverwrites$1&&(_overwritingTween=_assertThisInitialized(Me),_globalTimeline.killTweensOf(st),_overwritingTween=0),_addToTimeline(Ze,_assertThisInitialized(Me),ve),ae.reversed&&Me.reverse(),ae.paused&&Me.paused(!0),(tt||!Le&&!et&&Me._start===_roundPrecise(Ze._time)&&_isNotFalse(tt)&&_hasNoPausedAncestors(_assertThisInitialized(Me))&&Ze.data!=="nested")&&(Me._tTime=-_tinyNum,Me.render(Math.max(0,-Ye)||0)),nt&&_scrollTrigger(_assertThisInitialized(Me),nt),Me}var oe=te.prototype;return oe.render=function(ae,ve,we){var Me=this._time,ke=this._tDur,Le=this._dur,Ye=ae<0,tt=ae>ke-_tinyNum&&!Ye?ke:ae<_tinyNum?0:ae,Ke,Ge,et,Ue,nt,He,Ze,st,Et;if(!Le)_renderZeroDurationTween(this,ae,ve,we);else if(tt!==this._tTime||!ae||we||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==Ye){if(Ke=tt,st=this.timeline,this._repeat){if(Ue=Le+this._rDelay,this._repeat<-1&&Ye)return this.totalTime(Ue*100+ae,ve,we);if(Ke=_roundPrecise(tt%Ue),tt===ke?(et=this._repeat,Ke=Le):(et=~~(tt/Ue),et&&et===tt/Ue&&(Ke=Le,et--),Ke>Le&&(Ke=Le)),He=this._yoyo&&et&1,He&&(Et=this._yEase,Ke=Le-Ke),nt=_animationCycle(this._tTime,Ue),Ke===Me&&!we&&this._initted)return this._tTime=tt,this;et!==nt&&(st&&this._yEase&&_propagateYoyoEase(st,He),this.vars.repeatRefresh&&!He&&!this._lock&&(this._lock=we=1,this.render(_roundPrecise(Ue*et),!0).invalidate()._lock=0))}if(!this._initted){if(_attemptInitTween(this,Ye?ae:Ke,we,ve,tt))return this._tTime=0,this;if(Me!==this._time)return this;if(Le!==this._dur)return this.render(ae,ve,we)}if(this._tTime=tt,this._time=Ke,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=Ze=(Et||this._ease)(Ke/Le),this._from&&(this.ratio=Ze=1-Ze),Ke&&!Me&&!ve&&!et&&(_callback$1(this,"onStart"),this._tTime!==tt))return this;for(Ge=this._pt;Ge;)Ge.r(Ze,Ge.d),Ge=Ge._next;st&&st.render(ae<0?ae:!Ke&&He?-_tinyNum:st._dur*st._ease(Ke/this._dur),ve,we)||this._startAt&&(this._zTime=ae),this._onUpdate&&!ve&&(Ye&&_rewindStartAt(this,ae,ve,we),_callback$1(this,"onUpdate")),this._repeat&&et!==nt&&this.vars.onRepeat&&!ve&&this.parent&&_callback$1(this,"onRepeat"),(tt===this._tDur||!tt)&&this._tTime===tt&&(Ye&&!this._onUpdate&&_rewindStartAt(this,ae,!0,!0),(ae||!Le)&&(tt===this._tDur&&this._ts>0||!tt&&this._ts<0)&&_removeFromParent(this,1),!ve&&!(Ye&&!Me)&&(tt||Me||He)&&(_callback$1(this,tt===ke?"onComplete":"onReverseComplete",!0),this._prom&&!(tt<ke&&this.timeScale()>0)&&this._prom()))}return this},oe.targets=function(){return this._targets},oe.invalidate=function(ae){return(!ae||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(ae),Te.prototype.invalidate.call(this,ae)},oe.resetTo=function(ae,ve,we,Me){_tickerActive||_ticker.wake(),this._ts||this.play();var ke=Math.min(this._dur,(this._dp._time-this._start)*this._ts),Le;return this._initted||_initTween(this,ke),Le=this._ease(ke/this._dur),_updatePropTweens(this,ae,ve,we,Me,Le,ke)?this.resetTo(ae,ve,we,Me):(_alignPlayhead(this,0),this.parent||_addLinkedListItem(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},oe.kill=function(ae,ve){if(ve===void 0&&(ve="all"),!ae&&(!ve||ve==="all"))return this._lazy=this._pt=0,this.parent?_interrupt(this):this;if(this.timeline){var we=this.timeline.totalDuration();return this.timeline.killTweensOf(ae,ve,_overwritingTween&&_overwritingTween.vars.overwrite!==!0)._first||_interrupt(this),this.parent&&we!==this.timeline.totalDuration()&&_setDuration(this,this._dur*this.timeline._tDur/we,0,1),this}var Me=this._targets,ke=ae?toArray(ae):Me,Le=this._ptLookup,Ye=this._pt,tt,Ke,Ge,et,Ue,nt,He;if((!ve||ve==="all")&&_arraysMatch(Me,ke))return ve==="all"&&(this._pt=0),_interrupt(this);for(tt=this._op=this._op||[],ve!=="all"&&(_isString$1(ve)&&(Ue={},_forEachName(ve,function(Ze){return Ue[Ze]=1}),ve=Ue),ve=_addAliasesToVars(Me,ve)),He=Me.length;He--;)if(~ke.indexOf(Me[He])){Ke=Le[He],ve==="all"?(tt[He]=ve,et=Ke,Ge={}):(Ge=tt[He]=tt[He]||{},et=ve);for(Ue in et)nt=Ke&&Ke[Ue],nt&&((!("kill"in nt.d)||nt.d.kill(Ue)===!0)&&_removeLinkedListItem(this,nt,"_pt"),delete Ke[Ue]),Ge!=="all"&&(Ge[Ue]=1)}return this._initted&&!this._pt&&Ye&&_interrupt(this),this},te.to=function(ae,ve){return new te(ae,ve,arguments[2])},te.from=function(ae,ve){return _createTweenType(1,arguments)},te.delayedCall=function(ae,ve,we,Me){return new te(ve,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:ae,onComplete:ve,onReverseComplete:ve,onCompleteParams:we,onReverseCompleteParams:we,callbackScope:Me})},te.fromTo=function(ae,ve,we){return _createTweenType(2,arguments)},te.set=function(ae,ve){return ve.duration=0,ve.repeatDelay||(ve.repeat=0),new te(ae,ve)},te.killTweensOf=function(ae,ve,we){return _globalTimeline.killTweensOf(ae,ve,we)},te}(Animation);_setDefaults$1(Tween.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});_forEachName("staggerTo,staggerFrom,staggerFromTo",function(Te){Tween[Te]=function(){var te=new Timeline,oe=_slice.call(arguments,0);return oe.splice(Te==="staggerFromTo"?5:4,0,0),te[Te].apply(te,oe)}});var _setterPlain=function Te(te,oe,_){return te[oe]=_},_setterFunc=function Te(te,oe,_){return te[oe](_)},_setterFuncWithParam=function Te(te,oe,_,ae){return te[oe](ae.fp,_)},_setterAttribute=function Te(te,oe,_){return te.setAttribute(oe,_)},_getSetter=function Te(te,oe){return _isFunction$1(te[oe])?_setterFunc:_isUndefined(te[oe])&&te.setAttribute?_setterAttribute:_setterPlain},_renderPlain=function Te(te,oe){return oe.set(oe.t,oe.p,Math.round((oe.s+oe.c*te)*1e6)/1e6,oe)},_renderBoolean=function Te(te,oe){return oe.set(oe.t,oe.p,!!(oe.s+oe.c*te),oe)},_renderComplexString=function Te(te,oe){var _=oe._pt,ae="";if(!te&&oe.b)ae=oe.b;else if(te===1&&oe.e)ae=oe.e;else{for(;_;)ae=_.p+(_.m?_.m(_.s+_.c*te):Math.round((_.s+_.c*te)*1e4)/1e4)+ae,_=_._next;ae+=oe.c}oe.set(oe.t,oe.p,ae,oe)},_renderPropTweens=function Te(te,oe){for(var _=oe._pt;_;)_.r(te,_.d),_=_._next},_addPluginModifier=function Te(te,oe,_,ae){for(var ve=this._pt,we;ve;)we=ve._next,ve.p===ae&&ve.modifier(te,oe,_),ve=we},_killPropTweensOf=function Te(te){for(var oe=this._pt,_,ae;oe;)ae=oe._next,oe.p===te&&!oe.op||oe.op===te?_removeLinkedListItem(this,oe,"_pt"):oe.dep||(_=1),oe=ae;return!_},_setterWithModifier=function Te(te,oe,_,ae){ae.mSet(te,oe,ae.m.call(ae.tween,_,ae.mt),ae)},_sortPropTweensByPriority=function Te(te){for(var oe=te._pt,_,ae,ve,we;oe;){for(_=oe._next,ae=ve;ae&&ae.pr>oe.pr;)ae=ae._next;(oe._prev=ae?ae._prev:we)?oe._prev._next=oe:ve=oe,(oe._next=ae)?ae._prev=oe:we=oe,oe=_}te._pt=ve},PropTween=function(){function Te(oe,_,ae,ve,we,Me,ke,Le,Ye){this.t=_,this.s=ve,this.c=we,this.p=ae,this.r=Me||_renderPlain,this.d=ke||this,this.set=Le||_setterPlain,this.pr=Ye||0,this._next=oe,oe&&(oe._prev=this)}var te=Te.prototype;return te.modifier=function(_,ae,ve){this.mSet=this.mSet||this.set,this.set=_setterWithModifier,this.m=_,this.mt=ve,this.tween=ae},Te}();_forEachName(_callbackNames+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(Te){return _reservedProps[Te]=1});_globals.TweenMax=_globals.TweenLite=Tween;_globals.TimelineLite=_globals.TimelineMax=Timeline;_globalTimeline=new Timeline({sortChildren:!1,defaults:_defaults$1,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});_config.stringFilter=_colorStringFilter;var _media=[],_listeners$1={},_emptyArray$1=[],_lastMediaTime=0,_dispatch$1=function Te(te){return(_listeners$1[te]||_emptyArray$1).map(function(oe){return oe()})},_onMediaChange=function Te(){var te=Date.now(),oe=[];te-_lastMediaTime>2&&(_dispatch$1("matchMediaInit"),_media.forEach(function(_){var ae=_.queries,ve=_.conditions,we,Me,ke,Le;for(Me in ae)we=_win$3.matchMedia(ae[Me]).matches,we&&(ke=1),we!==ve[Me]&&(ve[Me]=we,Le=1);Le&&(_.revert(),ke&&oe.push(_))}),_dispatch$1("matchMediaRevert"),oe.forEach(function(_){return _.onMatch(_)}),_lastMediaTime=te,_dispatch$1("matchMedia"))},Context=function(){function Te(oe,_){this.selector=_&&selector(_),this.data=[],this._r=[],this.isReverted=!1,oe&&this.add(oe)}var te=Te.prototype;return te.add=function(_,ae,ve){_isFunction$1(_)&&(ve=ae,ae=_,_=_isFunction$1);var we=this,Me=function(){var Le=_context$2,Ye=we.selector,tt;return Le&&Le!==we&&Le.data.push(we),ve&&(we.selector=selector(ve)),_context$2=we,tt=ae.apply(we,arguments),_isFunction$1(tt)&&we._r.push(tt),_context$2=Le,we.selector=Ye,we.isReverted=!1,tt};return we.last=Me,_===_isFunction$1?Me(we):_?we[_]=Me:Me},te.ignore=function(_){var ae=_context$2;_context$2=null,_(this),_context$2=ae},te.getTweens=function(){var _=[];return this.data.forEach(function(ae){return ae instanceof Te?_.push.apply(_,ae.getTweens()):ae instanceof Tween&&!(ae.parent&&ae.parent.data==="nested")&&_.push(ae)}),_},te.clear=function(){this._r.length=this.data.length=0},te.kill=function(_,ae){var ve=this;if(_){var we=this.getTweens();this.data.forEach(function(ke){ke.data==="isFlip"&&(ke.revert(),ke.getChildren(!0,!0,!1).forEach(function(Le){return we.splice(we.indexOf(Le),1)}))}),we.map(function(ke){return{g:ke.globalTime(0),t:ke}}).sort(function(ke,Le){return Le.g-ke.g||-1}).forEach(function(ke){return ke.t.revert(_)}),this.data.forEach(function(ke){return!(ke instanceof Animation)&&ke.revert&&ke.revert(_)}),this._r.forEach(function(ke){return ke(_,ve)}),this.isReverted=!0}else this.data.forEach(function(ke){return ke.kill&&ke.kill()});if(this.clear(),ae){var Me=_media.indexOf(this);~Me&&_media.splice(Me,1)}},te.revert=function(_){this.kill(_||{})},Te}(),MatchMedia=function(){function Te(oe){this.contexts=[],this.scope=oe}var te=Te.prototype;return te.add=function(_,ae,ve){_isObject$1(_)||(_={matches:_});var we=new Context(0,ve||this.scope),Me=we.conditions={},ke,Le,Ye;this.contexts.push(we),ae=we.add("onMatch",ae),we.queries=_;for(Le in _)Le==="all"?Ye=1:(ke=_win$3.matchMedia(_[Le]),ke&&(_media.indexOf(we)<0&&_media.push(we),(Me[Le]=ke.matches)&&(Ye=1),ke.addListener?ke.addListener(_onMediaChange):ke.addEventListener("change",_onMediaChange)));return Ye&&ae(we),this},te.revert=function(_){this.kill(_||{})},te.kill=function(_){this.contexts.forEach(function(ae){return ae.kill(_,!0)})},Te}(),_gsap={registerPlugin:function Te(){for(var te=arguments.length,oe=new Array(te),_=0;_<te;_++)oe[_]=arguments[_];oe.forEach(function(ae){return _createPlugin(ae)})},timeline:function Te(te){return new Timeline(te)},getTweensOf:function Te(te,oe){return _globalTimeline.getTweensOf(te,oe)},getProperty:function Te(te,oe,_,ae){_isString$1(te)&&(te=toArray(te)[0]);var ve=_getCache(te||{}).get,we=_?_passThrough$1:_numericIfPossible;return _==="native"&&(_=""),te&&(oe?we((_plugins[oe]&&_plugins[oe].get||ve)(te,oe,_,ae)):function(Me,ke,Le){return we((_plugins[Me]&&_plugins[Me].get||ve)(te,Me,ke,Le))})},quickSetter:function Te(te,oe,_){if(te=toArray(te),te.length>1){var ae=te.map(function(Ye){return gsap$2.quickSetter(Ye,oe,_)}),ve=ae.length;return function(Ye){for(var tt=ve;tt--;)ae[tt](Ye)}}te=te[0]||{};var we=_plugins[oe],Me=_getCache(te),ke=Me.harness&&(Me.harness.aliases||{})[oe]||oe,Le=we?function(Ye){var tt=new we;_quickTween._pt=0,tt.init(te,_?Ye+_:Ye,_quickTween,0,[te]),tt.render(1,tt),_quickTween._pt&&_renderPropTweens(1,_quickTween)}:Me.set(te,ke);return we?Le:function(Ye){return Le(te,ke,_?Ye+_:Ye,Me,1)}},quickTo:function Te(te,oe,_){var ae,ve=gsap$2.to(te,_merge((ae={},ae[oe]="+=0.1",ae.paused=!0,ae),_||{})),we=function(ke,Le,Ye){return ve.resetTo(oe,ke,Le,Ye)};return we.tween=ve,we},isTweening:function Te(te){return _globalTimeline.getTweensOf(te,!0).length>0},defaults:function Te(te){return te&&te.ease&&(te.ease=_parseEase(te.ease,_defaults$1.ease)),_mergeDeep(_defaults$1,te||{})},config:function Te(te){return _mergeDeep(_config,te||{})},registerEffect:function Te(te){var oe=te.name,_=te.effect,ae=te.plugins,ve=te.defaults,we=te.extendTimeline;(ae||"").split(",").forEach(function(Me){return Me&&!_plugins[Me]&&!_globals[Me]&&_warn(oe+" effect requires "+Me+" plugin.")}),_effects[oe]=function(Me,ke,Le){return _(toArray(Me),_setDefaults$1(ke||{},ve),Le)},we&&(Timeline.prototype[oe]=function(Me,ke,Le){return this.add(_effects[oe](Me,_isObject$1(ke)?ke:(Le=ke)&&{},this),Le)})},registerEase:function Te(te,oe){_easeMap[te]=_parseEase(oe)},parseEase:function Te(te,oe){return arguments.length?_parseEase(te,oe):_easeMap},getById:function Te(te){return _globalTimeline.getById(te)},exportRoot:function Te(te,oe){te===void 0&&(te={});var _=new Timeline(te),ae,ve;for(_.smoothChildTiming=_isNotFalse(te.smoothChildTiming),_globalTimeline.remove(_),_._dp=0,_._time=_._tTime=_globalTimeline._time,ae=_globalTimeline._first;ae;)ve=ae._next,(oe||!(!ae._dur&&ae instanceof Tween&&ae.vars.onComplete===ae._targets[0]))&&_addToTimeline(_,ae,ae._start-ae._delay),ae=ve;return _addToTimeline(_globalTimeline,_,0),_},context:function Te(te,oe){return te?new Context(te,oe):_context$2},matchMedia:function Te(te){return new MatchMedia(te)},matchMediaRefresh:function Te(){return _media.forEach(function(te){var oe=te.conditions,_,ae;for(ae in oe)oe[ae]&&(oe[ae]=!1,_=1);_&&te.revert()})||_onMediaChange()},addEventListener:function Te(te,oe){var _=_listeners$1[te]||(_listeners$1[te]=[]);~_.indexOf(oe)||_.push(oe)},removeEventListener:function Te(te,oe){var _=_listeners$1[te],ae=_&&_.indexOf(oe);ae>=0&&_.splice(ae,1)},utils:{wrap,wrapYoyo,distribute,random,snap,normalize,getUnit,clamp,splitColor,toArray,selector,mapRange,pipe,unitize,interpolate,shuffle},install:_install,effects:_effects,ticker:_ticker,updateRoot:Timeline.updateRoot,plugins:_plugins,globalTimeline:_globalTimeline,core:{PropTween,globals:_addGlobal,Tween,Timeline,Animation,getCache:_getCache,_removeLinkedListItem,reverting:function Te(){return _reverting$1},context:function Te(te){return te&&_context$2&&(_context$2.data.push(te),te._ctx=_context$2),_context$2},suppressOverwrites:function Te(te){return _suppressOverwrites$1=te}}};_forEachName("to,from,fromTo,delayedCall,set,killTweensOf",function(Te){return _gsap[Te]=Tween[Te]});_ticker.add(Timeline.updateRoot);_quickTween=_gsap.to({},{duration:0});var _getPluginPropTween=function Te(te,oe){for(var _=te._pt;_&&_.p!==oe&&_.op!==oe&&_.fp!==oe;)_=_._next;return _},_addModifiers=function Te(te,oe){var _=te._targets,ae,ve,we;for(ae in oe)for(ve=_.length;ve--;)we=te._ptLookup[ve][ae],we&&(we=we.d)&&(we._pt&&(we=_getPluginPropTween(we,ae)),we&&we.modifier&&we.modifier(oe[ae],te,_[ve],ae))},_buildModifierPlugin=function Te(te,oe){return{name:te,rawVars:1,init:function(ae,ve,we){we._onInit=function(Me){var ke,Le;if(_isString$1(ve)&&(ke={},_forEachName(ve,function(Ye){return ke[Ye]=1}),ve=ke),oe){ke={};for(Le in ve)ke[Le]=oe(ve[Le]);ve=ke}_addModifiers(Me,ve)}}}},gsap$2=_gsap.registerPlugin({name:"attr",init:function Te(te,oe,_,ae,ve){var we,Me,ke;this.tween=_;for(we in oe)ke=te.getAttribute(we)||"",Me=this.add(te,"setAttribute",(ke||0)+"",oe[we],ae,ve,0,0,we),Me.op=we,Me.b=ke,this._props.push(we)},render:function Te(te,oe){for(var _=oe._pt;_;)_reverting$1?_.set(_.t,_.p,_.b,_):_.r(te,_.d),_=_._next}},{name:"endArray",init:function Te(te,oe){for(var _=oe.length;_--;)this.add(te,_,te[_]||0,oe[_],0,0,0,0,0,1)}},_buildModifierPlugin("roundProps",_roundModifier),_buildModifierPlugin("modifiers"),_buildModifierPlugin("snap",snap))||_gsap;Tween.version=Timeline.version=gsap$2.version="3.11.5";_coreReady=1;_windowExists$2()&&_wake();_easeMap.Power0;_easeMap.Power1;_easeMap.Power2;_easeMap.Power3;_easeMap.Power4;_easeMap.Linear;_easeMap.Quad;_easeMap.Cubic;_easeMap.Quart;_easeMap.Quint;_easeMap.Strong;_easeMap.Elastic;_easeMap.Back;_easeMap.SteppedEase;_easeMap.Bounce;_easeMap.Sine;_easeMap.Expo;_easeMap.Circ;/*!
 * CSSPlugin 3.11.5
 * https://greensock.com
 *
 * Copyright 2008-2023, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var _win$2,_doc$2,_docElement,_pluginInitted,_tempDiv,_recentSetterPlugin,_reverting,_windowExists$1=function Te(){return typeof window<"u"},_transformProps={},_RAD2DEG=180/Math.PI,_DEG2RAD=Math.PI/180,_atan2=Math.atan2,_bigNum=1e8,_capsExp$1=/([A-Z])/g,_horizontalExp=/(left|right|width|margin|padding|x)/i,_complexExp=/[\s,\(]\S/,_propertyAliases={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},_renderCSSProp=function Te(te,oe){return oe.set(oe.t,oe.p,Math.round((oe.s+oe.c*te)*1e4)/1e4+oe.u,oe)},_renderPropWithEnd=function Te(te,oe){return oe.set(oe.t,oe.p,te===1?oe.e:Math.round((oe.s+oe.c*te)*1e4)/1e4+oe.u,oe)},_renderCSSPropWithBeginning=function Te(te,oe){return oe.set(oe.t,oe.p,te?Math.round((oe.s+oe.c*te)*1e4)/1e4+oe.u:oe.b,oe)},_renderRoundedCSSProp=function Te(te,oe){var _=oe.s+oe.c*te;oe.set(oe.t,oe.p,~~(_+(_<0?-.5:.5))+oe.u,oe)},_renderNonTweeningValue=function Te(te,oe){return oe.set(oe.t,oe.p,te?oe.e:oe.b,oe)},_renderNonTweeningValueOnlyAtEnd=function Te(te,oe){return oe.set(oe.t,oe.p,te!==1?oe.b:oe.e,oe)},_setterCSSStyle=function Te(te,oe,_){return te.style[oe]=_},_setterCSSProp=function Te(te,oe,_){return te.style.setProperty(oe,_)},_setterTransform=function Te(te,oe,_){return te._gsap[oe]=_},_setterScale=function Te(te,oe,_){return te._gsap.scaleX=te._gsap.scaleY=_},_setterScaleWithRender=function Te(te,oe,_,ae,ve){var we=te._gsap;we.scaleX=we.scaleY=_,we.renderTransform(ve,we)},_setterTransformWithRender=function Te(te,oe,_,ae,ve){var we=te._gsap;we[oe]=_,we.renderTransform(ve,we)},_transformProp$1="transform",_transformOriginProp=_transformProp$1+"Origin",_saveStyle=function Te(te,oe){var _=this,ae=this.target,ve=ae.style;if(te in _transformProps){if(this.tfm=this.tfm||{},te!=="transform")te=_propertyAliases[te]||te,~te.indexOf(",")?te.split(",").forEach(function(we){return _.tfm[we]=_get(ae,we)}):this.tfm[te]=ae._gsap.x?ae._gsap[te]:_get(ae,te);else return _propertyAliases.transform.split(",").forEach(function(we){return Te.call(_,we,oe)});if(this.props.indexOf(_transformProp$1)>=0)return;ae._gsap.svg&&(this.svgo=ae.getAttribute("data-svg-origin"),this.props.push(_transformOriginProp,oe,"")),te=_transformProp$1}(ve||oe)&&this.props.push(te,oe,ve[te])},_removeIndependentTransforms=function Te(te){te.translate&&(te.removeProperty("translate"),te.removeProperty("scale"),te.removeProperty("rotate"))},_revertStyle=function Te(){var te=this.props,oe=this.target,_=oe.style,ae=oe._gsap,ve,we;for(ve=0;ve<te.length;ve+=3)te[ve+1]?oe[te[ve]]=te[ve+2]:te[ve+2]?_[te[ve]]=te[ve+2]:_.removeProperty(te[ve].substr(0,2)==="--"?te[ve]:te[ve].replace(_capsExp$1,"-$1").toLowerCase());if(this.tfm){for(we in this.tfm)ae[we]=this.tfm[we];ae.svg&&(ae.renderTransform(),oe.setAttribute("data-svg-origin",this.svgo||"")),ve=_reverting(),(!ve||!ve.isStart)&&!_[_transformProp$1]&&(_removeIndependentTransforms(_),ae.uncache=1)}},_getStyleSaver=function Te(te,oe){var _={target:te,props:[],revert:_revertStyle,save:_saveStyle};return te._gsap||gsap$2.core.getCache(te),oe&&oe.split(",").forEach(function(ae){return _.save(ae)}),_},_supports3D,_createElement=function Te(te,oe){var _=_doc$2.createElementNS?_doc$2.createElementNS((oe||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),te):_doc$2.createElement(te);return _.style?_:_doc$2.createElement(te)},_getComputedProperty=function Te(te,oe,_){var ae=getComputedStyle(te);return ae[oe]||ae.getPropertyValue(oe.replace(_capsExp$1,"-$1").toLowerCase())||ae.getPropertyValue(oe)||!_&&Te(te,_checkPropPrefix(oe)||oe,1)||""},_prefixes="O,Moz,ms,Ms,Webkit".split(","),_checkPropPrefix=function Te(te,oe,_){var ae=oe||_tempDiv,ve=ae.style,we=5;if(te in ve&&!_)return te;for(te=te.charAt(0).toUpperCase()+te.substr(1);we--&&!(_prefixes[we]+te in ve););return we<0?null:(we===3?"ms":we>=0?_prefixes[we]:"")+te},_initCore$1=function Te(){_windowExists$1()&&window.document&&(_win$2=window,_doc$2=_win$2.document,_docElement=_doc$2.documentElement,_tempDiv=_createElement("div")||{style:{}},_createElement("div"),_transformProp$1=_checkPropPrefix(_transformProp$1),_transformOriginProp=_transformProp$1+"Origin",_tempDiv.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",_supports3D=!!_checkPropPrefix("perspective"),_reverting=gsap$2.core.reverting,_pluginInitted=1)},_getBBoxHack=function Te(te){var oe=_createElement("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),_=this.parentNode,ae=this.nextSibling,ve=this.style.cssText,we;if(_docElement.appendChild(oe),oe.appendChild(this),this.style.display="block",te)try{we=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=Te}catch{}else this._gsapBBox&&(we=this._gsapBBox());return _&&(ae?_.insertBefore(this,ae):_.appendChild(this)),_docElement.removeChild(oe),this.style.cssText=ve,we},_getAttributeFallbacks=function Te(te,oe){for(var _=oe.length;_--;)if(te.hasAttribute(oe[_]))return te.getAttribute(oe[_])},_getBBox=function Te(te){var oe;try{oe=te.getBBox()}catch{oe=_getBBoxHack.call(te,!0)}return oe&&(oe.width||oe.height)||te.getBBox===_getBBoxHack||(oe=_getBBoxHack.call(te,!0)),oe&&!oe.width&&!oe.x&&!oe.y?{x:+_getAttributeFallbacks(te,["x","cx","x1"])||0,y:+_getAttributeFallbacks(te,["y","cy","y1"])||0,width:0,height:0}:oe},_isSVG=function Te(te){return!!(te.getCTM&&(!te.parentNode||te.ownerSVGElement)&&_getBBox(te))},_removeProperty=function Te(te,oe){if(oe){var _=te.style;oe in _transformProps&&oe!==_transformOriginProp&&(oe=_transformProp$1),_.removeProperty?((oe.substr(0,2)==="ms"||oe.substr(0,6)==="webkit")&&(oe="-"+oe),_.removeProperty(oe.replace(_capsExp$1,"-$1").toLowerCase())):_.removeAttribute(oe)}},_addNonTweeningPT=function Te(te,oe,_,ae,ve,we){var Me=new PropTween(te._pt,oe,_,0,1,we?_renderNonTweeningValueOnlyAtEnd:_renderNonTweeningValue);return te._pt=Me,Me.b=ae,Me.e=ve,te._props.push(_),Me},_nonConvertibleUnits={deg:1,rad:1,turn:1},_nonStandardLayouts={grid:1,flex:1},_convertToUnit=function Te(te,oe,_,ae){var ve=parseFloat(_)||0,we=(_+"").trim().substr((ve+"").length)||"px",Me=_tempDiv.style,ke=_horizontalExp.test(oe),Le=te.tagName.toLowerCase()==="svg",Ye=(Le?"client":"offset")+(ke?"Width":"Height"),tt=100,Ke=ae==="px",Ge=ae==="%",et,Ue,nt,He;return ae===we||!ve||_nonConvertibleUnits[ae]||_nonConvertibleUnits[we]?ve:(we!=="px"&&!Ke&&(ve=Te(te,oe,_,"px")),He=te.getCTM&&_isSVG(te),(Ge||we==="%")&&(_transformProps[oe]||~oe.indexOf("adius"))?(et=He?te.getBBox()[ke?"width":"height"]:te[Ye],_round$1(Ge?ve/et*tt:ve/100*et)):(Me[ke?"width":"height"]=tt+(Ke?we:ae),Ue=~oe.indexOf("adius")||ae==="em"&&te.appendChild&&!Le?te:te.parentNode,He&&(Ue=(te.ownerSVGElement||{}).parentNode),(!Ue||Ue===_doc$2||!Ue.appendChild)&&(Ue=_doc$2.body),nt=Ue._gsap,nt&&Ge&&nt.width&&ke&&nt.time===_ticker.time&&!nt.uncache?_round$1(ve/nt.width*tt):((Ge||we==="%")&&!_nonStandardLayouts[_getComputedProperty(Ue,"display")]&&(Me.position=_getComputedProperty(te,"position")),Ue===te&&(Me.position="static"),Ue.appendChild(_tempDiv),et=_tempDiv[Ye],Ue.removeChild(_tempDiv),Me.position="absolute",ke&&Ge&&(nt=_getCache(Ue),nt.time=_ticker.time,nt.width=Ue[Ye]),_round$1(Ke?et*ve/tt:et&&ve?tt/et*ve:0))))},_get=function Te(te,oe,_,ae){var ve;return _pluginInitted||_initCore$1(),oe in _propertyAliases&&oe!=="transform"&&(oe=_propertyAliases[oe],~oe.indexOf(",")&&(oe=oe.split(",")[0])),_transformProps[oe]&&oe!=="transform"?(ve=_parseTransform(te,ae),ve=oe!=="transformOrigin"?ve[oe]:ve.svg?ve.origin:_firstTwoOnly(_getComputedProperty(te,_transformOriginProp))+" "+ve.zOrigin+"px"):(ve=te.style[oe],(!ve||ve==="auto"||ae||~(ve+"").indexOf("calc("))&&(ve=_specialProps[oe]&&_specialProps[oe](te,oe,_)||_getComputedProperty(te,oe)||_getProperty(te,oe)||(oe==="opacity"?1:0))),_&&!~(ve+"").trim().indexOf(" ")?_convertToUnit(te,oe,ve,_)+_:ve},_tweenComplexCSSString=function Te(te,oe,_,ae){if(!_||_==="none"){var ve=_checkPropPrefix(oe,te,1),we=ve&&_getComputedProperty(te,ve,1);we&&we!==_?(oe=ve,_=we):oe==="borderColor"&&(_=_getComputedProperty(te,"borderTopColor"))}var Me=new PropTween(this._pt,te.style,oe,0,1,_renderComplexString),ke=0,Le=0,Ye,tt,Ke,Ge,et,Ue,nt,He,Ze,st,Et,rt;if(Me.b=_,Me.e=ae,_+="",ae+="",ae==="auto"&&(te.style[oe]=ae,ae=_getComputedProperty(te,oe)||ae,te.style[oe]=_),Ye=[_,ae],_colorStringFilter(Ye),_=Ye[0],ae=Ye[1],Ke=_.match(_numWithUnitExp)||[],rt=ae.match(_numWithUnitExp)||[],rt.length){for(;tt=_numWithUnitExp.exec(ae);)nt=tt[0],Ze=ae.substring(ke,tt.index),et?et=(et+1)%5:(Ze.substr(-5)==="rgba("||Ze.substr(-5)==="hsla(")&&(et=1),nt!==(Ue=Ke[Le++]||"")&&(Ge=parseFloat(Ue)||0,Et=Ue.substr((Ge+"").length),nt.charAt(1)==="="&&(nt=_parseRelative(Ge,nt)+Et),He=parseFloat(nt),st=nt.substr((He+"").length),ke=_numWithUnitExp.lastIndex-st.length,st||(st=st||_config.units[oe]||Et,ke===ae.length&&(ae+=st,Me.e+=st)),Et!==st&&(Ge=_convertToUnit(te,oe,Ue,st)||0),Me._pt={_next:Me._pt,p:Ze||Le===1?Ze:",",s:Ge,c:He-Ge,m:et&&et<4||oe==="zIndex"?Math.round:0});Me.c=ke<ae.length?ae.substring(ke,ae.length):""}else Me.r=oe==="display"&&ae==="none"?_renderNonTweeningValueOnlyAtEnd:_renderNonTweeningValue;return _relExp.test(ae)&&(Me.e=0),this._pt=Me,Me},_keywordToPercent={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},_convertKeywordsToPercentages=function Te(te){var oe=te.split(" "),_=oe[0],ae=oe[1]||"50%";return(_==="top"||_==="bottom"||ae==="left"||ae==="right")&&(te=_,_=ae,ae=te),oe[0]=_keywordToPercent[_]||_,oe[1]=_keywordToPercent[ae]||ae,oe.join(" ")},_renderClearProps=function Te(te,oe){if(oe.tween&&oe.tween._time===oe.tween._dur){var _=oe.t,ae=_.style,ve=oe.u,we=_._gsap,Me,ke,Le;if(ve==="all"||ve===!0)ae.cssText="",ke=1;else for(ve=ve.split(","),Le=ve.length;--Le>-1;)Me=ve[Le],_transformProps[Me]&&(ke=1,Me=Me==="transformOrigin"?_transformOriginProp:_transformProp$1),_removeProperty(_,Me);ke&&(_removeProperty(_,_transformProp$1),we&&(we.svg&&_.removeAttribute("transform"),_parseTransform(_,1),we.uncache=1,_removeIndependentTransforms(ae)))}},_specialProps={clearProps:function Te(te,oe,_,ae,ve){if(ve.data!=="isFromStart"){var we=te._pt=new PropTween(te._pt,oe,_,0,0,_renderClearProps);return we.u=ae,we.pr=-10,we.tween=ve,te._props.push(_),1}}},_identity2DMatrix=[1,0,0,1,0,0],_rotationalProperties={},_isNullTransform=function Te(te){return te==="matrix(1, 0, 0, 1, 0, 0)"||te==="none"||!te},_getComputedTransformMatrixAsArray=function Te(te){var oe=_getComputedProperty(te,_transformProp$1);return _isNullTransform(oe)?_identity2DMatrix:oe.substr(7).match(_numExp).map(_round$1)},_getMatrix=function Te(te,oe){var _=te._gsap||_getCache(te),ae=te.style,ve=_getComputedTransformMatrixAsArray(te),we,Me,ke,Le;return _.svg&&te.getAttribute("transform")?(ke=te.transform.baseVal.consolidate().matrix,ve=[ke.a,ke.b,ke.c,ke.d,ke.e,ke.f],ve.join(",")==="1,0,0,1,0,0"?_identity2DMatrix:ve):(ve===_identity2DMatrix&&!te.offsetParent&&te!==_docElement&&!_.svg&&(ke=ae.display,ae.display="block",we=te.parentNode,(!we||!te.offsetParent)&&(Le=1,Me=te.nextElementSibling,_docElement.appendChild(te)),ve=_getComputedTransformMatrixAsArray(te),ke?ae.display=ke:_removeProperty(te,"display"),Le&&(Me?we.insertBefore(te,Me):we?we.appendChild(te):_docElement.removeChild(te))),oe&&ve.length>6?[ve[0],ve[1],ve[4],ve[5],ve[12],ve[13]]:ve)},_applySVGOrigin=function Te(te,oe,_,ae,ve,we){var Me=te._gsap,ke=ve||_getMatrix(te,!0),Le=Me.xOrigin||0,Ye=Me.yOrigin||0,tt=Me.xOffset||0,Ke=Me.yOffset||0,Ge=ke[0],et=ke[1],Ue=ke[2],nt=ke[3],He=ke[4],Ze=ke[5],st=oe.split(" "),Et=parseFloat(st[0])||0,rt=parseFloat(st[1])||0,bt,Ne,Qe,We;_?ke!==_identity2DMatrix&&(Ne=Ge*nt-et*Ue)&&(Qe=Et*(nt/Ne)+rt*(-Ue/Ne)+(Ue*Ze-nt*He)/Ne,We=Et*(-et/Ne)+rt*(Ge/Ne)-(Ge*Ze-et*He)/Ne,Et=Qe,rt=We):(bt=_getBBox(te),Et=bt.x+(~st[0].indexOf("%")?Et/100*bt.width:Et),rt=bt.y+(~(st[1]||st[0]).indexOf("%")?rt/100*bt.height:rt)),ae||ae!==!1&&Me.smooth?(He=Et-Le,Ze=rt-Ye,Me.xOffset=tt+(He*Ge+Ze*Ue)-He,Me.yOffset=Ke+(He*et+Ze*nt)-Ze):Me.xOffset=Me.yOffset=0,Me.xOrigin=Et,Me.yOrigin=rt,Me.smooth=!!ae,Me.origin=oe,Me.originIsAbsolute=!!_,te.style[_transformOriginProp]="0px 0px",we&&(_addNonTweeningPT(we,Me,"xOrigin",Le,Et),_addNonTweeningPT(we,Me,"yOrigin",Ye,rt),_addNonTweeningPT(we,Me,"xOffset",tt,Me.xOffset),_addNonTweeningPT(we,Me,"yOffset",Ke,Me.yOffset)),te.setAttribute("data-svg-origin",Et+" "+rt)},_parseTransform=function Te(te,oe){var _=te._gsap||new GSCache(te);if("x"in _&&!oe&&!_.uncache)return _;var ae=te.style,ve=_.scaleX<0,we="px",Me="deg",ke=getComputedStyle(te),Le=_getComputedProperty(te,_transformOriginProp)||"0",Ye,tt,Ke,Ge,et,Ue,nt,He,Ze,st,Et,rt,bt,Ne,Qe,We,_t,lt,Ut,dn,nn,un,Zt,pn,ln,vn,ht,Jt,en,Cn,Vt,Je;return Ye=tt=Ke=Ue=nt=He=Ze=st=Et=0,Ge=et=1,_.svg=!!(te.getCTM&&_isSVG(te)),ke.translate&&((ke.translate!=="none"||ke.scale!=="none"||ke.rotate!=="none")&&(ae[_transformProp$1]=(ke.translate!=="none"?"translate3d("+(ke.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(ke.rotate!=="none"?"rotate("+ke.rotate+") ":"")+(ke.scale!=="none"?"scale("+ke.scale.split(" ").join(",")+") ":"")+(ke[_transformProp$1]!=="none"?ke[_transformProp$1]:"")),ae.scale=ae.rotate=ae.translate="none"),Ne=_getMatrix(te,_.svg),_.svg&&(_.uncache?(ln=te.getBBox(),Le=_.xOrigin-ln.x+"px "+(_.yOrigin-ln.y)+"px",pn=""):pn=!oe&&te.getAttribute("data-svg-origin"),_applySVGOrigin(te,pn||Le,!!pn||_.originIsAbsolute,_.smooth!==!1,Ne)),rt=_.xOrigin||0,bt=_.yOrigin||0,Ne!==_identity2DMatrix&&(lt=Ne[0],Ut=Ne[1],dn=Ne[2],nn=Ne[3],Ye=un=Ne[4],tt=Zt=Ne[5],Ne.length===6?(Ge=Math.sqrt(lt*lt+Ut*Ut),et=Math.sqrt(nn*nn+dn*dn),Ue=lt||Ut?_atan2(Ut,lt)*_RAD2DEG:0,Ze=dn||nn?_atan2(dn,nn)*_RAD2DEG+Ue:0,Ze&&(et*=Math.abs(Math.cos(Ze*_DEG2RAD))),_.svg&&(Ye-=rt-(rt*lt+bt*dn),tt-=bt-(rt*Ut+bt*nn))):(Je=Ne[6],Cn=Ne[7],ht=Ne[8],Jt=Ne[9],en=Ne[10],Vt=Ne[11],Ye=Ne[12],tt=Ne[13],Ke=Ne[14],Qe=_atan2(Je,en),nt=Qe*_RAD2DEG,Qe&&(We=Math.cos(-Qe),_t=Math.sin(-Qe),pn=un*We+ht*_t,ln=Zt*We+Jt*_t,vn=Je*We+en*_t,ht=un*-_t+ht*We,Jt=Zt*-_t+Jt*We,en=Je*-_t+en*We,Vt=Cn*-_t+Vt*We,un=pn,Zt=ln,Je=vn),Qe=_atan2(-dn,en),He=Qe*_RAD2DEG,Qe&&(We=Math.cos(-Qe),_t=Math.sin(-Qe),pn=lt*We-ht*_t,ln=Ut*We-Jt*_t,vn=dn*We-en*_t,Vt=nn*_t+Vt*We,lt=pn,Ut=ln,dn=vn),Qe=_atan2(Ut,lt),Ue=Qe*_RAD2DEG,Qe&&(We=Math.cos(Qe),_t=Math.sin(Qe),pn=lt*We+Ut*_t,ln=un*We+Zt*_t,Ut=Ut*We-lt*_t,Zt=Zt*We-un*_t,lt=pn,un=ln),nt&&Math.abs(nt)+Math.abs(Ue)>359.9&&(nt=Ue=0,He=180-He),Ge=_round$1(Math.sqrt(lt*lt+Ut*Ut+dn*dn)),et=_round$1(Math.sqrt(Zt*Zt+Je*Je)),Qe=_atan2(un,Zt),Ze=Math.abs(Qe)>2e-4?Qe*_RAD2DEG:0,Et=Vt?1/(Vt<0?-Vt:Vt):0),_.svg&&(pn=te.getAttribute("transform"),_.forceCSS=te.setAttribute("transform","")||!_isNullTransform(_getComputedProperty(te,_transformProp$1)),pn&&te.setAttribute("transform",pn))),Math.abs(Ze)>90&&Math.abs(Ze)<270&&(ve?(Ge*=-1,Ze+=Ue<=0?180:-180,Ue+=Ue<=0?180:-180):(et*=-1,Ze+=Ze<=0?180:-180)),oe=oe||_.uncache,_.x=Ye-((_.xPercent=Ye&&(!oe&&_.xPercent||(Math.round(te.offsetWidth/2)===Math.round(-Ye)?-50:0)))?te.offsetWidth*_.xPercent/100:0)+we,_.y=tt-((_.yPercent=tt&&(!oe&&_.yPercent||(Math.round(te.offsetHeight/2)===Math.round(-tt)?-50:0)))?te.offsetHeight*_.yPercent/100:0)+we,_.z=Ke+we,_.scaleX=_round$1(Ge),_.scaleY=_round$1(et),_.rotation=_round$1(Ue)+Me,_.rotationX=_round$1(nt)+Me,_.rotationY=_round$1(He)+Me,_.skewX=Ze+Me,_.skewY=st+Me,_.transformPerspective=Et+we,(_.zOrigin=parseFloat(Le.split(" ")[2])||0)&&(ae[_transformOriginProp]=_firstTwoOnly(Le)),_.xOffset=_.yOffset=0,_.force3D=_config.force3D,_.renderTransform=_.svg?_renderSVGTransforms:_supports3D?_renderCSSTransforms:_renderNon3DTransforms,_.uncache=0,_},_firstTwoOnly=function Te(te){return(te=te.split(" "))[0]+" "+te[1]},_addPxTranslate=function Te(te,oe,_){var ae=getUnit(oe);return _round$1(parseFloat(oe)+parseFloat(_convertToUnit(te,"x",_+"px",ae)))+ae},_renderNon3DTransforms=function Te(te,oe){oe.z="0px",oe.rotationY=oe.rotationX="0deg",oe.force3D=0,_renderCSSTransforms(te,oe)},_zeroDeg="0deg",_zeroPx="0px",_endParenthesis=") ",_renderCSSTransforms=function Te(te,oe){var _=oe||this,ae=_.xPercent,ve=_.yPercent,we=_.x,Me=_.y,ke=_.z,Le=_.rotation,Ye=_.rotationY,tt=_.rotationX,Ke=_.skewX,Ge=_.skewY,et=_.scaleX,Ue=_.scaleY,nt=_.transformPerspective,He=_.force3D,Ze=_.target,st=_.zOrigin,Et="",rt=He==="auto"&&te&&te!==1||He===!0;if(st&&(tt!==_zeroDeg||Ye!==_zeroDeg)){var bt=parseFloat(Ye)*_DEG2RAD,Ne=Math.sin(bt),Qe=Math.cos(bt),We;bt=parseFloat(tt)*_DEG2RAD,We=Math.cos(bt),we=_addPxTranslate(Ze,we,Ne*We*-st),Me=_addPxTranslate(Ze,Me,-Math.sin(bt)*-st),ke=_addPxTranslate(Ze,ke,Qe*We*-st+st)}nt!==_zeroPx&&(Et+="perspective("+nt+_endParenthesis),(ae||ve)&&(Et+="translate("+ae+"%, "+ve+"%) "),(rt||we!==_zeroPx||Me!==_zeroPx||ke!==_zeroPx)&&(Et+=ke!==_zeroPx||rt?"translate3d("+we+", "+Me+", "+ke+") ":"translate("+we+", "+Me+_endParenthesis),Le!==_zeroDeg&&(Et+="rotate("+Le+_endParenthesis),Ye!==_zeroDeg&&(Et+="rotateY("+Ye+_endParenthesis),tt!==_zeroDeg&&(Et+="rotateX("+tt+_endParenthesis),(Ke!==_zeroDeg||Ge!==_zeroDeg)&&(Et+="skew("+Ke+", "+Ge+_endParenthesis),(et!==1||Ue!==1)&&(Et+="scale("+et+", "+Ue+_endParenthesis),Ze.style[_transformProp$1]=Et||"translate(0, 0)"},_renderSVGTransforms=function Te(te,oe){var _=oe||this,ae=_.xPercent,ve=_.yPercent,we=_.x,Me=_.y,ke=_.rotation,Le=_.skewX,Ye=_.skewY,tt=_.scaleX,Ke=_.scaleY,Ge=_.target,et=_.xOrigin,Ue=_.yOrigin,nt=_.xOffset,He=_.yOffset,Ze=_.forceCSS,st=parseFloat(we),Et=parseFloat(Me),rt,bt,Ne,Qe,We;ke=parseFloat(ke),Le=parseFloat(Le),Ye=parseFloat(Ye),Ye&&(Ye=parseFloat(Ye),Le+=Ye,ke+=Ye),ke||Le?(ke*=_DEG2RAD,Le*=_DEG2RAD,rt=Math.cos(ke)*tt,bt=Math.sin(ke)*tt,Ne=Math.sin(ke-Le)*-Ke,Qe=Math.cos(ke-Le)*Ke,Le&&(Ye*=_DEG2RAD,We=Math.tan(Le-Ye),We=Math.sqrt(1+We*We),Ne*=We,Qe*=We,Ye&&(We=Math.tan(Ye),We=Math.sqrt(1+We*We),rt*=We,bt*=We)),rt=_round$1(rt),bt=_round$1(bt),Ne=_round$1(Ne),Qe=_round$1(Qe)):(rt=tt,Qe=Ke,bt=Ne=0),(st&&!~(we+"").indexOf("px")||Et&&!~(Me+"").indexOf("px"))&&(st=_convertToUnit(Ge,"x",we,"px"),Et=_convertToUnit(Ge,"y",Me,"px")),(et||Ue||nt||He)&&(st=_round$1(st+et-(et*rt+Ue*Ne)+nt),Et=_round$1(Et+Ue-(et*bt+Ue*Qe)+He)),(ae||ve)&&(We=Ge.getBBox(),st=_round$1(st+ae/100*We.width),Et=_round$1(Et+ve/100*We.height)),We="matrix("+rt+","+bt+","+Ne+","+Qe+","+st+","+Et+")",Ge.setAttribute("transform",We),Ze&&(Ge.style[_transformProp$1]=We)},_addRotationalPropTween=function Te(te,oe,_,ae,ve){var we=360,Me=_isString$1(ve),ke=parseFloat(ve)*(Me&&~ve.indexOf("rad")?_RAD2DEG:1),Le=ke-ae,Ye=ae+Le+"deg",tt,Ke;return Me&&(tt=ve.split("_")[1],tt==="short"&&(Le%=we,Le!==Le%(we/2)&&(Le+=Le<0?we:-we)),tt==="cw"&&Le<0?Le=(Le+we*_bigNum)%we-~~(Le/we)*we:tt==="ccw"&&Le>0&&(Le=(Le-we*_bigNum)%we-~~(Le/we)*we)),te._pt=Ke=new PropTween(te._pt,oe,_,ae,Le,_renderPropWithEnd),Ke.e=Ye,Ke.u="deg",te._props.push(_),Ke},_assign=function Te(te,oe){for(var _ in oe)te[_]=oe[_];return te},_addRawTransformPTs=function Te(te,oe,_){var ae=_assign({},_._gsap),ve="perspective,force3D,transformOrigin,svgOrigin",we=_.style,Me,ke,Le,Ye,tt,Ke,Ge,et;ae.svg?(Le=_.getAttribute("transform"),_.setAttribute("transform",""),we[_transformProp$1]=oe,Me=_parseTransform(_,1),_removeProperty(_,_transformProp$1),_.setAttribute("transform",Le)):(Le=getComputedStyle(_)[_transformProp$1],we[_transformProp$1]=oe,Me=_parseTransform(_,1),we[_transformProp$1]=Le);for(ke in _transformProps)Le=ae[ke],Ye=Me[ke],Le!==Ye&&ve.indexOf(ke)<0&&(Ge=getUnit(Le),et=getUnit(Ye),tt=Ge!==et?_convertToUnit(_,ke,Le,et):parseFloat(Le),Ke=parseFloat(Ye),te._pt=new PropTween(te._pt,Me,ke,tt,Ke-tt,_renderCSSProp),te._pt.u=et||0,te._props.push(ke));_assign(Me,ae)};_forEachName("padding,margin,Width,Radius",function(Te,te){var oe="Top",_="Right",ae="Bottom",ve="Left",we=(te<3?[oe,_,ae,ve]:[oe+ve,oe+_,ae+_,ae+ve]).map(function(Me){return te<2?Te+Me:"border"+Me+Te});_specialProps[te>1?"border"+Te:Te]=function(Me,ke,Le,Ye,tt){var Ke,Ge;if(arguments.length<4)return Ke=we.map(function(et){return _get(Me,et,Le)}),Ge=Ke.join(" "),Ge.split(Ke[0]).length===5?Ke[0]:Ge;Ke=(Ye+"").split(" "),Ge={},we.forEach(function(et,Ue){return Ge[et]=Ke[Ue]=Ke[Ue]||Ke[(Ue-1)/2|0]}),Me.init(ke,Ge,tt)}});var CSSPlugin={name:"css",register:_initCore$1,targetTest:function Te(te){return te.style&&te.nodeType},init:function Te(te,oe,_,ae,ve){var we=this._props,Me=te.style,ke=_.vars.startAt,Le,Ye,tt,Ke,Ge,et,Ue,nt,He,Ze,st,Et,rt,bt,Ne,Qe;_pluginInitted||_initCore$1(),this.styles=this.styles||_getStyleSaver(te),Qe=this.styles.props,this.tween=_;for(Ue in oe)if(Ue!=="autoRound"&&(Ye=oe[Ue],!(_plugins[Ue]&&_checkPlugin(Ue,oe,_,ae,te,ve)))){if(Ge=typeof Ye,et=_specialProps[Ue],Ge==="function"&&(Ye=Ye.call(_,ae,te,ve),Ge=typeof Ye),Ge==="string"&&~Ye.indexOf("random(")&&(Ye=_replaceRandom(Ye)),et)et(this,te,Ue,Ye,_)&&(Ne=1);else if(Ue.substr(0,2)==="--")Le=(getComputedStyle(te).getPropertyValue(Ue)+"").trim(),Ye+="",_colorExp.lastIndex=0,_colorExp.test(Le)||(nt=getUnit(Le),He=getUnit(Ye)),He?nt!==He&&(Le=_convertToUnit(te,Ue,Le,He)+He):nt&&(Ye+=nt),this.add(Me,"setProperty",Le,Ye,ae,ve,0,0,Ue),we.push(Ue),Qe.push(Ue,0,Me[Ue]);else if(Ge!=="undefined"){if(ke&&Ue in ke?(Le=typeof ke[Ue]=="function"?ke[Ue].call(_,ae,te,ve):ke[Ue],_isString$1(Le)&&~Le.indexOf("random(")&&(Le=_replaceRandom(Le)),getUnit(Le+"")||(Le+=_config.units[Ue]||getUnit(_get(te,Ue))||""),(Le+"").charAt(1)==="="&&(Le=_get(te,Ue))):Le=_get(te,Ue),Ke=parseFloat(Le),Ze=Ge==="string"&&Ye.charAt(1)==="="&&Ye.substr(0,2),Ze&&(Ye=Ye.substr(2)),tt=parseFloat(Ye),Ue in _propertyAliases&&(Ue==="autoAlpha"&&(Ke===1&&_get(te,"visibility")==="hidden"&&tt&&(Ke=0),Qe.push("visibility",0,Me.visibility),_addNonTweeningPT(this,Me,"visibility",Ke?"inherit":"hidden",tt?"inherit":"hidden",!tt)),Ue!=="scale"&&Ue!=="transform"&&(Ue=_propertyAliases[Ue],~Ue.indexOf(",")&&(Ue=Ue.split(",")[0]))),st=Ue in _transformProps,st){if(this.styles.save(Ue),Et||(rt=te._gsap,rt.renderTransform&&!oe.parseTransform||_parseTransform(te,oe.parseTransform),bt=oe.smoothOrigin!==!1&&rt.smooth,Et=this._pt=new PropTween(this._pt,Me,_transformProp$1,0,1,rt.renderTransform,rt,0,-1),Et.dep=1),Ue==="scale")this._pt=new PropTween(this._pt,rt,"scaleY",rt.scaleY,(Ze?_parseRelative(rt.scaleY,Ze+tt):tt)-rt.scaleY||0,_renderCSSProp),this._pt.u=0,we.push("scaleY",Ue),Ue+="X";else if(Ue==="transformOrigin"){Qe.push(_transformOriginProp,0,Me[_transformOriginProp]),Ye=_convertKeywordsToPercentages(Ye),rt.svg?_applySVGOrigin(te,Ye,0,bt,0,this):(He=parseFloat(Ye.split(" ")[2])||0,He!==rt.zOrigin&&_addNonTweeningPT(this,rt,"zOrigin",rt.zOrigin,He),_addNonTweeningPT(this,Me,Ue,_firstTwoOnly(Le),_firstTwoOnly(Ye)));continue}else if(Ue==="svgOrigin"){_applySVGOrigin(te,Ye,1,bt,0,this);continue}else if(Ue in _rotationalProperties){_addRotationalPropTween(this,rt,Ue,Ke,Ze?_parseRelative(Ke,Ze+Ye):Ye);continue}else if(Ue==="smoothOrigin"){_addNonTweeningPT(this,rt,"smooth",rt.smooth,Ye);continue}else if(Ue==="force3D"){rt[Ue]=Ye;continue}else if(Ue==="transform"){_addRawTransformPTs(this,Ye,te);continue}}else Ue in Me||(Ue=_checkPropPrefix(Ue)||Ue);if(st||(tt||tt===0)&&(Ke||Ke===0)&&!_complexExp.test(Ye)&&Ue in Me)nt=(Le+"").substr((Ke+"").length),tt||(tt=0),He=getUnit(Ye)||(Ue in _config.units?_config.units[Ue]:nt),nt!==He&&(Ke=_convertToUnit(te,Ue,Le,He)),this._pt=new PropTween(this._pt,st?rt:Me,Ue,Ke,(Ze?_parseRelative(Ke,Ze+tt):tt)-Ke,!st&&(He==="px"||Ue==="zIndex")&&oe.autoRound!==!1?_renderRoundedCSSProp:_renderCSSProp),this._pt.u=He||0,nt!==He&&He!=="%"&&(this._pt.b=Le,this._pt.r=_renderCSSPropWithBeginning);else if(Ue in Me)_tweenComplexCSSString.call(this,te,Ue,Le,Ze?Ze+Ye:Ye);else if(Ue in te)this.add(te,Ue,Le||te[Ue],Ze?Ze+Ye:Ye,ae,ve);else if(Ue!=="parseTransform"){_missingPlugin(Ue,Ye);continue}st||(Ue in Me?Qe.push(Ue,0,Me[Ue]):Qe.push(Ue,1,Le||te[Ue])),we.push(Ue)}}Ne&&_sortPropTweensByPriority(this)},render:function Te(te,oe){if(oe.tween._time||!_reverting())for(var _=oe._pt;_;)_.r(te,_.d),_=_._next;else oe.styles.revert()},get:_get,aliases:_propertyAliases,getSetter:function Te(te,oe,_){var ae=_propertyAliases[oe];return ae&&ae.indexOf(",")<0&&(oe=ae),oe in _transformProps&&oe!==_transformOriginProp&&(te._gsap.x||_get(te,"x"))?_&&_recentSetterPlugin===_?oe==="scale"?_setterScale:_setterTransform:(_recentSetterPlugin=_||{})&&(oe==="scale"?_setterScaleWithRender:_setterTransformWithRender):te.style&&!_isUndefined(te.style[oe])?_setterCSSStyle:~oe.indexOf("-")?_setterCSSProp:_getSetter(te,oe)},core:{_removeProperty,_getMatrix}};gsap$2.utils.checkPrefix=_checkPropPrefix;gsap$2.core.getStyleSaver=_getStyleSaver;(function(Te,te,oe,_){var ae=_forEachName(Te+","+te+","+oe,function(ve){_transformProps[ve]=1});_forEachName(te,function(ve){_config.units[ve]="deg",_rotationalProperties[ve]=1}),_propertyAliases[ae[13]]=Te+","+te,_forEachName(_,function(ve){var we=ve.split(":");_propertyAliases[we[1]]=ae[we[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");_forEachName("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(Te){_config.units[Te]="px"});gsap$2.registerPlugin(CSSPlugin);var gsapWithCSS=gsap$2.registerPlugin(CSSPlugin)||gsap$2;gsapWithCSS.core.Tween;function _defineProperties(Te,te){for(var oe=0;oe<te.length;oe++){var _=te[oe];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(Te,_.key,_)}}function _createClass(Te,te,oe){return te&&_defineProperties(Te.prototype,te),oe&&_defineProperties(Te,oe),Te}/*!
 * Observer 3.11.5
 * https://greensock.com
 *
 * @license Copyright 2008-2023, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var gsap$1,_coreInitted$1,_win$1,_doc$1,_docEl$1,_body$1,_isTouch,_pointerType,ScrollTrigger$1,_root$1,_normalizer$1,_eventTypes,_context$1,_getGSAP$1=function Te(){return gsap$1||typeof window<"u"&&(gsap$1=window.gsap)&&gsap$1.registerPlugin&&gsap$1},_startup$1=1,_observers=[],_scrollers=[],_proxies=[],_getTime$1=Date.now,_bridge=function Te(te,oe){return oe},_integrate=function Te(){var te=ScrollTrigger$1.core,oe=te.bridge||{},_=te._scrollers,ae=te._proxies;_.push.apply(_,_scrollers),ae.push.apply(ae,_proxies),_scrollers=_,_proxies=ae,_bridge=function(we,Me){return oe[we](Me)}},_getProxyProp=function Te(te,oe){return~_proxies.indexOf(te)&&_proxies[_proxies.indexOf(te)+1][oe]},_isViewport$1=function Te(te){return!!~_root$1.indexOf(te)},_addListener$1=function Te(te,oe,_,ae,ve){return te.addEventListener(oe,_,{passive:!ae,capture:!!ve})},_removeListener$1=function Te(te,oe,_,ae){return te.removeEventListener(oe,_,!!ae)},_scrollLeft="scrollLeft",_scrollTop="scrollTop",_onScroll$1=function Te(){return _normalizer$1&&_normalizer$1.isPressed||_scrollers.cache++},_scrollCacheFunc=function Te(te,oe){var _=function ae(ve){if(ve||ve===0){_startup$1&&(_win$1.history.scrollRestoration="manual");var we=_normalizer$1&&_normalizer$1.isPressed;ve=ae.v=Math.round(ve)||(_normalizer$1&&_normalizer$1.iOS?1:0),te(ve),ae.cacheID=_scrollers.cache,we&&_bridge("ss",ve)}else(oe||_scrollers.cache!==ae.cacheID||_bridge("ref"))&&(ae.cacheID=_scrollers.cache,ae.v=te());return ae.v+ae.offset};return _.offset=0,te&&_},_horizontal={s:_scrollLeft,p:"left",p2:"Left",os:"right",os2:"Right",d:"width",d2:"Width",a:"x",sc:_scrollCacheFunc(function(Te){return arguments.length?_win$1.scrollTo(Te,_vertical.sc()):_win$1.pageXOffset||_doc$1[_scrollLeft]||_docEl$1[_scrollLeft]||_body$1[_scrollLeft]||0})},_vertical={s:_scrollTop,p:"top",p2:"Top",os:"bottom",os2:"Bottom",d:"height",d2:"Height",a:"y",op:_horizontal,sc:_scrollCacheFunc(function(Te){return arguments.length?_win$1.scrollTo(_horizontal.sc(),Te):_win$1.pageYOffset||_doc$1[_scrollTop]||_docEl$1[_scrollTop]||_body$1[_scrollTop]||0})},_getTarget=function Te(te){return gsap$1.utils.toArray(te)[0]||(typeof te=="string"&&gsap$1.config().nullTargetWarn!==!1?console.warn("Element not found:",te):null)},_getScrollFunc=function Te(te,oe){var _=oe.s,ae=oe.sc;_isViewport$1(te)&&(te=_doc$1.scrollingElement||_docEl$1);var ve=_scrollers.indexOf(te),we=ae===_vertical.sc?1:2;!~ve&&(ve=_scrollers.push(te)-1),_scrollers[ve+we]||te.addEventListener("scroll",_onScroll$1);var Me=_scrollers[ve+we],ke=Me||(_scrollers[ve+we]=_scrollCacheFunc(_getProxyProp(te,_),!0)||(_isViewport$1(te)?ae:_scrollCacheFunc(function(Le){return arguments.length?te[_]=Le:te[_]})));return ke.target=te,Me||(ke.smooth=gsap$1.getProperty(te,"scrollBehavior")==="smooth"),ke},_getVelocityProp=function Te(te,oe,_){var ae=te,ve=te,we=_getTime$1(),Me=we,ke=oe||50,Le=Math.max(500,ke*3),Ye=function(et,Ue){var nt=_getTime$1();Ue||nt-we>ke?(ve=ae,ae=et,Me=we,we=nt):_?ae+=et:ae=ve+(et-ve)/(nt-Me)*(we-Me)},tt=function(){ve=ae=_?0:ae,Me=we=0},Ke=function(et){var Ue=Me,nt=ve,He=_getTime$1();return(et||et===0)&&et!==ae&&Ye(et),we===Me||He-Me>Le?0:(ae+(_?nt:-nt))/((_?He:we)-Ue)*1e3};return{update:Ye,reset:tt,getVelocity:Ke}},_getEvent=function Te(te,oe){return oe&&!te._gsapAllow&&te.preventDefault(),te.changedTouches?te.changedTouches[0]:te},_getAbsoluteMax=function Te(te){var oe=Math.max.apply(Math,te),_=Math.min.apply(Math,te);return Math.abs(oe)>=Math.abs(_)?oe:_},_setScrollTrigger=function Te(){ScrollTrigger$1=gsap$1.core.globals().ScrollTrigger,ScrollTrigger$1&&ScrollTrigger$1.core&&_integrate()},_initCore=function Te(te){return gsap$1=te||_getGSAP$1(),gsap$1&&typeof document<"u"&&document.body&&(_win$1=window,_doc$1=document,_docEl$1=_doc$1.documentElement,_body$1=_doc$1.body,_root$1=[_win$1,_doc$1,_docEl$1,_body$1],gsap$1.utils.clamp,_context$1=gsap$1.core.context||function(){},_pointerType="onpointerenter"in _body$1?"pointer":"mouse",_isTouch=Observer.isTouch=_win$1.matchMedia&&_win$1.matchMedia("(hover: none), (pointer: coarse)").matches?1:"ontouchstart"in _win$1||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?2:0,_eventTypes=Observer.eventTypes=("ontouchstart"in _docEl$1?"touchstart,touchmove,touchcancel,touchend":"onpointerdown"in _docEl$1?"pointerdown,pointermove,pointercancel,pointerup":"mousedown,mousemove,mouseup,mouseup").split(","),setTimeout(function(){return _startup$1=0},500),_setScrollTrigger(),_coreInitted$1=1),_coreInitted$1};_horizontal.op=_vertical;_scrollers.cache=0;var Observer=function(){function Te(oe){this.init(oe)}var te=Te.prototype;return te.init=function(_){_coreInitted$1||_initCore(gsap$1)||console.warn("Please gsap.registerPlugin(Observer)"),ScrollTrigger$1||_setScrollTrigger();var ae=_.tolerance,ve=_.dragMinimum,we=_.type,Me=_.target,ke=_.lineHeight,Le=_.debounce,Ye=_.preventDefault,tt=_.onStop,Ke=_.onStopDelay,Ge=_.ignore,et=_.wheelSpeed,Ue=_.event,nt=_.onDragStart,He=_.onDragEnd,Ze=_.onDrag,st=_.onPress,Et=_.onRelease,rt=_.onRight,bt=_.onLeft,Ne=_.onUp,Qe=_.onDown,We=_.onChangeX,_t=_.onChangeY,lt=_.onChange,Ut=_.onToggleX,dn=_.onToggleY,nn=_.onHover,un=_.onHoverEnd,Zt=_.onMove,pn=_.ignoreCheck,ln=_.isNormalizer,vn=_.onGestureStart,ht=_.onGestureEnd,Jt=_.onWheel,en=_.onEnable,Cn=_.onDisable,Vt=_.onClick,Je=_.scrollSpeed,ot=_.capture,Rt=_.allowClicks,Mn=_.lockAxis,Pn=_.onLockAxis;this.target=Me=_getTarget(Me)||_docEl$1,this.vars=_,Ge&&(Ge=gsap$1.utils.toArray(Ge)),ae=ae||1e-9,ve=ve||0,et=et||1,Je=Je||1,we=we||"wheel,touch,pointer",Le=Le!==!1,ke||(ke=parseFloat(_win$1.getComputedStyle(_body$1).lineHeight)||22);var Rn,hi,$n,ji,Li,dr,Ri,$t=this,ir=0,or=0,ms=_getScrollFunc(Me,_horizontal),Rr=_getScrollFunc(Me,_vertical),Cr=ms(),Mr=Rr(),Tr=~we.indexOf("touch")&&!~we.indexOf("pointer")&&_eventTypes[0]==="pointerdown",Is=_isViewport$1(Me),pr=Me.ownerDocument||_doc$1,rr=[0,0,0],ss=[0,0,0],Gr=0,Br=function(){return Gr=_getTime$1()},pa=function(qn,bn){return($t.event=qn)&&Ge&&~Ge.indexOf(qn.target)||bn&&Tr&&qn.pointerType!=="touch"||pn&&pn(qn,bn)},Qr=function(){$t._vx.reset(),$t._vy.reset(),hi.pause(),tt&&tt($t)},Hs=function(){var qn=$t.deltaX=_getAbsoluteMax(rr),bn=$t.deltaY=_getAbsoluteMax(ss),Mi=Math.abs(qn)>=ae,ki=Math.abs(bn)>=ae;lt&&(Mi||ki)&&lt($t,qn,bn,rr,ss),Mi&&(rt&&$t.deltaX>0&&rt($t),bt&&$t.deltaX<0&&bt($t),We&&We($t),Ut&&$t.deltaX<0!=ir<0&&Ut($t),ir=$t.deltaX,rr[0]=rr[1]=rr[2]=0),ki&&(Qe&&$t.deltaY>0&&Qe($t),Ne&&$t.deltaY<0&&Ne($t),_t&&_t($t),dn&&$t.deltaY<0!=or<0&&dn($t),or=$t.deltaY,ss[0]=ss[1]=ss[2]=0),(ji||$n)&&(Zt&&Zt($t),$n&&(Ze($t),$n=!1),ji=!1),dr&&!(dr=!1)&&Pn&&Pn($t),Li&&(Jt($t),Li=!1),Rn=0},Ur=function(qn,bn,Mi){rr[Mi]+=qn,ss[Mi]+=bn,$t._vx.update(qn),$t._vy.update(bn),Le?Rn||(Rn=requestAnimationFrame(Hs)):Hs()},ho=function(qn,bn){Mn&&!Ri&&($t.axis=Ri=Math.abs(qn)>Math.abs(bn)?"x":"y",dr=!0),Ri!=="y"&&(rr[2]+=qn,$t._vx.update(qn,!0)),Ri!=="x"&&(ss[2]+=bn,$t._vy.update(bn,!0)),Le?Rn||(Rn=requestAnimationFrame(Hs)):Hs()},fa=function(qn){if(!pa(qn,1)){qn=_getEvent(qn,Ye);var bn=qn.clientX,Mi=qn.clientY,ki=bn-$t.x,Ii=Mi-$t.y,Fr=$t.isDragging;$t.x=bn,$t.y=Mi,(Fr||Math.abs($t.startX-bn)>=ve||Math.abs($t.startY-Mi)>=ve)&&(Ze&&($n=!0),Fr||($t.isDragging=!0),ho(ki,Ii),Fr||nt&&nt($t))}},oi=$t.onPress=function(Bi){pa(Bi,1)||Bi&&Bi.button||($t.axis=Ri=null,hi.pause(),$t.isPressed=!0,Bi=_getEvent(Bi),ir=or=0,$t.startX=$t.x=Bi.clientX,$t.startY=$t.y=Bi.clientY,$t._vx.reset(),$t._vy.reset(),_addListener$1(ln?Me:pr,_eventTypes[1],fa,Ye,!0),$t.deltaX=$t.deltaY=0,st&&st($t))},Er=$t.onRelease=function(Bi){if(!pa(Bi,1)){_removeListener$1(ln?Me:pr,_eventTypes[1],fa,!0);var qn=!isNaN($t.y-$t.startY),bn=$t.isDragging&&(Math.abs($t.x-$t.startX)>3||Math.abs($t.y-$t.startY)>3),Mi=_getEvent(Bi);!bn&&qn&&($t._vx.reset(),$t._vy.reset(),Ye&&Rt&&gsap$1.delayedCall(.08,function(){if(_getTime$1()-Gr>300&&!Bi.defaultPrevented){if(Bi.target.click)Bi.target.click();else if(pr.createEvent){var ki=pr.createEvent("MouseEvents");ki.initMouseEvent("click",!0,!0,_win$1,1,Mi.screenX,Mi.screenY,Mi.clientX,Mi.clientY,!1,!1,!1,!1,0,null),Bi.target.dispatchEvent(ki)}}})),$t.isDragging=$t.isGesturing=$t.isPressed=!1,tt&&!ln&&hi.restart(!0),He&&bn&&He($t),Et&&Et($t,bn)}},Bs=function(qn){return qn.touches&&qn.touches.length>1&&($t.isGesturing=!0)&&vn(qn,$t.isDragging)},as=function(){return($t.isGesturing=!1)||ht($t)},po=function(qn){if(!pa(qn)){var bn=ms(),Mi=Rr();Ur((bn-Cr)*Je,(Mi-Mr)*Je,1),Cr=bn,Mr=Mi,tt&&hi.restart(!0)}},io=function(qn){if(!pa(qn)){qn=_getEvent(qn,Ye),Jt&&(Li=!0);var bn=(qn.deltaMode===1?ke:qn.deltaMode===2?_win$1.innerHeight:1)*et;Ur(qn.deltaX*bn,qn.deltaY*bn,0),tt&&!ln&&hi.restart(!0)}},ea=function(qn){if(!pa(qn)){var bn=qn.clientX,Mi=qn.clientY,ki=bn-$t.x,Ii=Mi-$t.y;$t.x=bn,$t.y=Mi,ji=!0,(ki||Ii)&&ho(ki,Ii)}},kt=function(qn){$t.event=qn,nn($t)},Zr=function(qn){$t.event=qn,un($t)},To=function(qn){return pa(qn)||_getEvent(qn,Ye)&&Vt($t)};hi=$t._dc=gsap$1.delayedCall(Ke||.25,Qr).pause(),$t.deltaX=$t.deltaY=0,$t._vx=_getVelocityProp(0,50,!0),$t._vy=_getVelocityProp(0,50,!0),$t.scrollX=ms,$t.scrollY=Rr,$t.isDragging=$t.isGesturing=$t.isPressed=!1,_context$1(this),$t.enable=function(Bi){return $t.isEnabled||(_addListener$1(Is?pr:Me,"scroll",_onScroll$1),we.indexOf("scroll")>=0&&_addListener$1(Is?pr:Me,"scroll",po,Ye,ot),we.indexOf("wheel")>=0&&_addListener$1(Me,"wheel",io,Ye,ot),(we.indexOf("touch")>=0&&_isTouch||we.indexOf("pointer")>=0)&&(_addListener$1(Me,_eventTypes[0],oi,Ye,ot),_addListener$1(pr,_eventTypes[2],Er),_addListener$1(pr,_eventTypes[3],Er),Rt&&_addListener$1(Me,"click",Br,!1,!0),Vt&&_addListener$1(Me,"click",To),vn&&_addListener$1(pr,"gesturestart",Bs),ht&&_addListener$1(pr,"gestureend",as),nn&&_addListener$1(Me,_pointerType+"enter",kt),un&&_addListener$1(Me,_pointerType+"leave",Zr),Zt&&_addListener$1(Me,_pointerType+"move",ea)),$t.isEnabled=!0,Bi&&Bi.type&&oi(Bi),en&&en($t)),$t},$t.disable=function(){$t.isEnabled&&(_observers.filter(function(Bi){return Bi!==$t&&_isViewport$1(Bi.target)}).length||_removeListener$1(Is?pr:Me,"scroll",_onScroll$1),$t.isPressed&&($t._vx.reset(),$t._vy.reset(),_removeListener$1(ln?Me:pr,_eventTypes[1],fa,!0)),_removeListener$1(Is?pr:Me,"scroll",po,ot),_removeListener$1(Me,"wheel",io,ot),_removeListener$1(Me,_eventTypes[0],oi,ot),_removeListener$1(pr,_eventTypes[2],Er),_removeListener$1(pr,_eventTypes[3],Er),_removeListener$1(Me,"click",Br,!0),_removeListener$1(Me,"click",To),_removeListener$1(pr,"gesturestart",Bs),_removeListener$1(pr,"gestureend",as),_removeListener$1(Me,_pointerType+"enter",kt),_removeListener$1(Me,_pointerType+"leave",Zr),_removeListener$1(Me,_pointerType+"move",ea),$t.isEnabled=$t.isPressed=$t.isDragging=!1,Cn&&Cn($t))},$t.kill=$t.revert=function(){$t.disable();var Bi=_observers.indexOf($t);Bi>=0&&_observers.splice(Bi,1),_normalizer$1===$t&&(_normalizer$1=0)},_observers.push($t),ln&&_isViewport$1(Me)&&(_normalizer$1=$t),$t.enable(Ue)},_createClass(Te,[{key:"velocityX",get:function(){return this._vx.getVelocity()}},{key:"velocityY",get:function(){return this._vy.getVelocity()}}]),Te}();Observer.version="3.11.5";Observer.create=function(Te){return new Observer(Te)};Observer.register=_initCore;Observer.getAll=function(){return _observers.slice()};Observer.getById=function(Te){return _observers.filter(function(te){return te.vars.id===Te})[0]};_getGSAP$1()&&gsap$1.registerPlugin(Observer);/*!
 * ScrollTrigger 3.11.5
 * https://greensock.com
 *
 * @license Copyright 2008-2023, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var gsap,_coreInitted,_win,_doc,_docEl,_body,_root,_resizeDelay,_toArray,_clamp,_time2,_syncInterval,_refreshing,_pointerIsDown,_transformProp,_i,_prevWidth,_prevHeight,_autoRefresh,_sort,_suppressOverwrites,_ignoreResize,_normalizer,_ignoreMobileResize,_baseScreenHeight,_baseScreenWidth,_fixIOSBug,_context,_scrollRestoration,_limitCallbacks,_startup=1,_getTime=Date.now,_time1=_getTime(),_lastScrollTime=0,_enabled=0,_rafBugFix=function Te(){return _enabled&&requestAnimationFrame(Te)},_pointerDownHandler=function Te(){return _pointerIsDown=1},_pointerUpHandler=function Te(){return _pointerIsDown=0},_passThrough=function Te(te){return te},_round=function Te(te){return Math.round(te*1e5)/1e5||0},_windowExists=function Te(){return typeof window<"u"},_getGSAP=function Te(){return gsap||_windowExists()&&(gsap=window.gsap)&&gsap.registerPlugin&&gsap},_isViewport=function Te(te){return!!~_root.indexOf(te)},_getBoundsFunc=function Te(te){return _getProxyProp(te,"getBoundingClientRect")||(_isViewport(te)?function(){return _winOffsets.width=_win.innerWidth,_winOffsets.height=_win.innerHeight,_winOffsets}:function(){return _getBounds(te)})},_getSizeFunc=function Te(te,oe,_){var ae=_.d,ve=_.d2,we=_.a;return(we=_getProxyProp(te,"getBoundingClientRect"))?function(){return we()[ae]}:function(){return(oe?_win["inner"+ve]:te["client"+ve])||0}},_getOffsetsFunc=function Te(te,oe){return!oe||~_proxies.indexOf(te)?_getBoundsFunc(te):function(){return _winOffsets}},_maxScroll=function Te(te,oe){var _=oe.s,ae=oe.d2,ve=oe.d,we=oe.a;return Math.max(0,(_="scroll"+ae)&&(we=_getProxyProp(te,_))?we()-_getBoundsFunc(te)()[ve]:_isViewport(te)?(_docEl[_]||_body[_])-(_win["inner"+ae]||_docEl["client"+ae]||_body["client"+ae]):te[_]-te["offset"+ae])},_iterateAutoRefresh=function Te(te,oe){for(var _=0;_<_autoRefresh.length;_+=3)(!oe||~oe.indexOf(_autoRefresh[_+1]))&&te(_autoRefresh[_],_autoRefresh[_+1],_autoRefresh[_+2])},_isString=function Te(te){return typeof te=="string"},_isFunction=function Te(te){return typeof te=="function"},_isNumber=function Te(te){return typeof te=="number"},_isObject=function Te(te){return typeof te=="object"},_endAnimation=function Te(te,oe,_){return te&&te.progress(oe?0:1)&&_&&te.pause()},_callback=function Te(te,oe){if(te.enabled){var _=oe(te);_&&_.totalTime&&(te.callbackAnimation=_)}},_abs=Math.abs,_left="left",_top="top",_right="right",_bottom="bottom",_width="width",_height="height",_Right="Right",_Left="Left",_Top="Top",_Bottom="Bottom",_padding="padding",_margin="margin",_Width="Width",_Height="Height",_px="px",_getComputedStyle=function Te(te){return _win.getComputedStyle(te)},_makePositionable=function Te(te){var oe=_getComputedStyle(te).position;te.style.position=oe==="absolute"||oe==="fixed"?oe:"relative"},_setDefaults=function Te(te,oe){for(var _ in oe)_ in te||(te[_]=oe[_]);return te},_getBounds=function Te(te,oe){var _=oe&&_getComputedStyle(te)[_transformProp]!=="matrix(1, 0, 0, 1, 0, 0)"&&gsap.to(te,{x:0,y:0,xPercent:0,yPercent:0,rotation:0,rotationX:0,rotationY:0,scale:1,skewX:0,skewY:0}).progress(1),ae=te.getBoundingClientRect();return _&&_.progress(0).kill(),ae},_getSize=function Te(te,oe){var _=oe.d2;return te["offset"+_]||te["client"+_]||0},_getLabelRatioArray=function Te(te){var oe=[],_=te.labels,ae=te.duration(),ve;for(ve in _)oe.push(_[ve]/ae);return oe},_getClosestLabel=function Te(te){return function(oe){return gsap.utils.snap(_getLabelRatioArray(te),oe)}},_snapDirectional=function Te(te){var oe=gsap.utils.snap(te),_=Array.isArray(te)&&te.slice(0).sort(function(ae,ve){return ae-ve});return _?function(ae,ve,we){we===void 0&&(we=.001);var Me;if(!ve)return oe(ae);if(ve>0){for(ae-=we,Me=0;Me<_.length;Me++)if(_[Me]>=ae)return _[Me];return _[Me-1]}else for(Me=_.length,ae+=we;Me--;)if(_[Me]<=ae)return _[Me];return _[0]}:function(ae,ve,we){we===void 0&&(we=.001);var Me=oe(ae);return!ve||Math.abs(Me-ae)<we||Me-ae<0==ve<0?Me:oe(ve<0?ae-te:ae+te)}},_getLabelAtDirection=function Te(te){return function(oe,_){return _snapDirectional(_getLabelRatioArray(te))(oe,_.direction)}},_multiListener=function Te(te,oe,_,ae){return _.split(",").forEach(function(ve){return te(oe,ve,ae)})},_addListener=function Te(te,oe,_,ae,ve){return te.addEventListener(oe,_,{passive:!ae,capture:!!ve})},_removeListener=function Te(te,oe,_,ae){return te.removeEventListener(oe,_,!!ae)},_wheelListener=function Te(te,oe,_){_=_&&_.wheelHandler,_&&(te(oe,"wheel",_),te(oe,"touchmove",_))},_markerDefaults={startColor:"green",endColor:"red",indent:0,fontSize:"16px",fontWeight:"normal"},_defaults={toggleActions:"play",anticipatePin:0},_keywords={top:0,left:0,center:.5,bottom:1,right:1},_offsetToPx=function Te(te,oe){if(_isString(te)){var _=te.indexOf("="),ae=~_?+(te.charAt(_-1)+1)*parseFloat(te.substr(_+1)):0;~_&&(te.indexOf("%")>_&&(ae*=oe/100),te=te.substr(0,_-1)),te=ae+(te in _keywords?_keywords[te]*oe:~te.indexOf("%")?parseFloat(te)*oe/100:parseFloat(te)||0)}return te},_createMarker=function Te(te,oe,_,ae,ve,we,Me,ke){var Le=ve.startColor,Ye=ve.endColor,tt=ve.fontSize,Ke=ve.indent,Ge=ve.fontWeight,et=_doc.createElement("div"),Ue=_isViewport(_)||_getProxyProp(_,"pinType")==="fixed",nt=te.indexOf("scroller")!==-1,He=Ue?_body:_,Ze=te.indexOf("start")!==-1,st=Ze?Le:Ye,Et="border-color:"+st+";font-size:"+tt+";color:"+st+";font-weight:"+Ge+";pointer-events:none;white-space:nowrap;font-family:sans-serif,Arial;z-index:1000;padding:4px 8px;border-width:0;border-style:solid;";return Et+="position:"+((nt||ke)&&Ue?"fixed;":"absolute;"),(nt||ke||!Ue)&&(Et+=(ae===_vertical?_right:_bottom)+":"+(we+parseFloat(Ke))+"px;"),Me&&(Et+="box-sizing:border-box;text-align:left;width:"+Me.offsetWidth+"px;"),et._isStart=Ze,et.setAttribute("class","gsap-marker-"+te+(oe?" marker-"+oe:"")),et.style.cssText=Et,et.innerText=oe||oe===0?te+"-"+oe:te,He.children[0]?He.insertBefore(et,He.children[0]):He.appendChild(et),et._offset=et["offset"+ae.op.d2],_positionMarker(et,0,ae,Ze),et},_positionMarker=function Te(te,oe,_,ae){var ve={display:"block"},we=_[ae?"os2":"p2"],Me=_[ae?"p2":"os2"];te._isFlipped=ae,ve[_.a+"Percent"]=ae?-100:0,ve[_.a]=ae?"1px":0,ve["border"+we+_Width]=1,ve["border"+Me+_Width]=0,ve[_.p]=oe+"px",gsap.set(te,ve)},_triggers=[],_ids={},_rafID,_sync=function Te(){return _getTime()-_lastScrollTime>34&&(_rafID||(_rafID=requestAnimationFrame(_updateAll)))},_onScroll=function Te(){(!_normalizer||!_normalizer.isPressed||_normalizer.startX>_body.clientWidth)&&(_scrollers.cache++,_normalizer?_rafID||(_rafID=requestAnimationFrame(_updateAll)):_updateAll(),_lastScrollTime||_dispatch("scrollStart"),_lastScrollTime=_getTime())},_setBaseDimensions=function Te(){_baseScreenWidth=_win.innerWidth,_baseScreenHeight=_win.innerHeight},_onResize=function Te(){_scrollers.cache++,!_refreshing&&!_ignoreResize&&!_doc.fullscreenElement&&!_doc.webkitFullscreenElement&&(!_ignoreMobileResize||_baseScreenWidth!==_win.innerWidth||Math.abs(_win.innerHeight-_baseScreenHeight)>_win.innerHeight*.25)&&_resizeDelay.restart(!0)},_listeners={},_emptyArray=[],_softRefresh=function Te(){return _removeListener(ScrollTrigger,"scrollEnd",Te)||_refreshAll(!0)},_dispatch=function Te(te){return _listeners[te]&&_listeners[te].map(function(oe){return oe()})||_emptyArray},_savedStyles=[],_revertRecorded=function Te(te){for(var oe=0;oe<_savedStyles.length;oe+=5)(!te||_savedStyles[oe+4]&&_savedStyles[oe+4].query===te)&&(_savedStyles[oe].style.cssText=_savedStyles[oe+1],_savedStyles[oe].getBBox&&_savedStyles[oe].setAttribute("transform",_savedStyles[oe+2]||""),_savedStyles[oe+3].uncache=1)},_revertAll=function Te(te,oe){var _;for(_i=0;_i<_triggers.length;_i++)_=_triggers[_i],_&&(!oe||_._ctx===oe)&&(te?_.kill(1):_.revert(!0,!0));oe&&_revertRecorded(oe),oe||_dispatch("revert")},_clearScrollMemory=function Te(te,oe){_scrollers.cache++,(oe||!_refreshingAll)&&_scrollers.forEach(function(_){return _isFunction(_)&&_.cacheID++&&(_.rec=0)}),_isString(te)&&(_win.history.scrollRestoration=_scrollRestoration=te)},_refreshingAll,_refreshID=0,_queueRefreshID,_queueRefreshAll=function Te(){if(_queueRefreshID!==_refreshID){var te=_queueRefreshID=_refreshID;requestAnimationFrame(function(){return te===_refreshID&&_refreshAll(!0)})}},_refreshAll=function Te(te,oe){if(_lastScrollTime&&!te){_addListener(ScrollTrigger,"scrollEnd",_softRefresh);return}_refreshingAll=ScrollTrigger.isRefreshing=!0,_scrollers.forEach(function(ae){return _isFunction(ae)&&ae.cacheID++&&(ae.rec=ae())});var _=_dispatch("refreshInit");_sort&&ScrollTrigger.sort(),oe||_revertAll(),_scrollers.forEach(function(ae){_isFunction(ae)&&(ae.smooth&&(ae.target.style.scrollBehavior="auto"),ae(0))}),_triggers.slice(0).forEach(function(ae){return ae.refresh()}),_triggers.forEach(function(ae,ve){if(ae._subPinOffset&&ae.pin){var we=ae.vars.horizontal?"offsetWidth":"offsetHeight",Me=ae.pin[we];ae.revert(!0,1),ae.adjustPinSpacing(ae.pin[we]-Me),ae.refresh()}}),_triggers.forEach(function(ae){return ae.vars.end==="max"&&ae.setPositions(ae.start,Math.max(ae.start+1,_maxScroll(ae.scroller,ae._dir)))}),_.forEach(function(ae){return ae&&ae.render&&ae.render(-1)}),_scrollers.forEach(function(ae){_isFunction(ae)&&(ae.smooth&&requestAnimationFrame(function(){return ae.target.style.scrollBehavior="smooth"}),ae.rec&&ae(ae.rec))}),_clearScrollMemory(_scrollRestoration,1),_resizeDelay.pause(),_refreshID++,_refreshingAll=2,_updateAll(2),_triggers.forEach(function(ae){return _isFunction(ae.vars.onRefresh)&&ae.vars.onRefresh(ae)}),_refreshingAll=ScrollTrigger.isRefreshing=!1,_dispatch("refresh")},_lastScroll=0,_direction=1,_primary,_updateAll=function Te(te){if(!_refreshingAll||te===2){ScrollTrigger.isUpdating=!0,_primary&&_primary.update(0);var oe=_triggers.length,_=_getTime(),ae=_-_time1>=50,ve=oe&&_triggers[0].scroll();if(_direction=_lastScroll>ve?-1:1,_refreshingAll||(_lastScroll=ve),ae&&(_lastScrollTime&&!_pointerIsDown&&_-_lastScrollTime>200&&(_lastScrollTime=0,_dispatch("scrollEnd")),_time2=_time1,_time1=_),_direction<0){for(_i=oe;_i-- >0;)_triggers[_i]&&_triggers[_i].update(0,ae);_direction=1}else for(_i=0;_i<oe;_i++)_triggers[_i]&&_triggers[_i].update(0,ae);ScrollTrigger.isUpdating=!1}_rafID=0},_propNamesToCopy=[_left,_top,_bottom,_right,_margin+_Bottom,_margin+_Right,_margin+_Top,_margin+_Left,"display","flexShrink","float","zIndex","gridColumnStart","gridColumnEnd","gridRowStart","gridRowEnd","gridArea","justifySelf","alignSelf","placeSelf","order"],_stateProps=_propNamesToCopy.concat([_width,_height,"boxSizing","max"+_Width,"max"+_Height,"position",_margin,_padding,_padding+_Top,_padding+_Right,_padding+_Bottom,_padding+_Left]),_swapPinOut=function Te(te,oe,_){_setState(_);var ae=te._gsap;if(ae.spacerIsNative)_setState(ae.spacerState);else if(te._gsap.swappedIn){var ve=oe.parentNode;ve&&(ve.insertBefore(te,oe),ve.removeChild(oe))}te._gsap.swappedIn=!1},_swapPinIn=function Te(te,oe,_,ae){if(!te._gsap.swappedIn){for(var ve=_propNamesToCopy.length,we=oe.style,Me=te.style,ke;ve--;)ke=_propNamesToCopy[ve],we[ke]=_[ke];we.position=_.position==="absolute"?"absolute":"relative",_.display==="inline"&&(we.display="inline-block"),Me[_bottom]=Me[_right]="auto",we.flexBasis=_.flexBasis||"auto",we.overflow="visible",we.boxSizing="border-box",we[_width]=_getSize(te,_horizontal)+_px,we[_height]=_getSize(te,_vertical)+_px,we[_padding]=Me[_margin]=Me[_top]=Me[_left]="0",_setState(ae),Me[_width]=Me["max"+_Width]=_[_width],Me[_height]=Me["max"+_Height]=_[_height],Me[_padding]=_[_padding],te.parentNode!==oe&&(te.parentNode.insertBefore(oe,te),oe.appendChild(te)),te._gsap.swappedIn=!0}},_capsExp=/([A-Z])/g,_setState=function Te(te){if(te){var oe=te.t.style,_=te.length,ae=0,ve,we;for((te.t._gsap||gsap.core.getCache(te.t)).uncache=1;ae<_;ae+=2)we=te[ae+1],ve=te[ae],we?oe[ve]=we:oe[ve]&&oe.removeProperty(ve.replace(_capsExp,"-$1").toLowerCase())}},_getState=function Te(te){for(var oe=_stateProps.length,_=te.style,ae=[],ve=0;ve<oe;ve++)ae.push(_stateProps[ve],_[_stateProps[ve]]);return ae.t=te,ae},_copyState=function Te(te,oe,_){for(var ae=[],ve=te.length,we=_?8:0,Me;we<ve;we+=2)Me=te[we],ae.push(Me,Me in oe?oe[Me]:te[we+1]);return ae.t=te.t,ae},_winOffsets={left:0,top:0},_parsePosition=function Te(te,oe,_,ae,ve,we,Me,ke,Le,Ye,tt,Ke,Ge){_isFunction(te)&&(te=te(ke)),_isString(te)&&te.substr(0,3)==="max"&&(te=Ke+(te.charAt(4)==="="?_offsetToPx("0"+te.substr(3),_):0));var et=Ge?Ge.time():0,Ue,nt,He;if(Ge&&Ge.seek(0),_isNumber(te))Ge&&(te=gsap.utils.mapRange(Ge.scrollTrigger.start,Ge.scrollTrigger.end,0,Ke,te)),Me&&_positionMarker(Me,_,ae,!0);else{_isFunction(oe)&&(oe=oe(ke));var Ze=(te||"0").split(" "),st,Et,rt,bt;He=_getTarget(oe)||_body,st=_getBounds(He)||{},(!st||!st.left&&!st.top)&&_getComputedStyle(He).display==="none"&&(bt=He.style.display,He.style.display="block",st=_getBounds(He),bt?He.style.display=bt:He.style.removeProperty("display")),Et=_offsetToPx(Ze[0],st[ae.d]),rt=_offsetToPx(Ze[1]||"0",_),te=st[ae.p]-Le[ae.p]-Ye+Et+ve-rt,Me&&_positionMarker(Me,rt,ae,_-rt<20||Me._isStart&&rt>20),_-=_-rt}if(we){var Ne=te+_,Qe=we._isStart;Ue="scroll"+ae.d2,_positionMarker(we,Ne,ae,Qe&&Ne>20||!Qe&&(tt?Math.max(_body[Ue],_docEl[Ue]):we.parentNode[Ue])<=Ne+1),tt&&(Le=_getBounds(Me),tt&&(we.style[ae.op.p]=Le[ae.op.p]-ae.op.m-we._offset+_px))}return Ge&&He&&(Ue=_getBounds(He),Ge.seek(Ke),nt=_getBounds(He),Ge._caScrollDist=Ue[ae.p]-nt[ae.p],te=te/Ge._caScrollDist*Ke),Ge&&Ge.seek(et),Ge?te:Math.round(te)},_prefixExp=/(webkit|moz|length|cssText|inset)/i,_reparent=function Te(te,oe,_,ae){if(te.parentNode!==oe){var ve=te.style,we,Me;if(oe===_body){te._stOrig=ve.cssText,Me=_getComputedStyle(te);for(we in Me)!+we&&!_prefixExp.test(we)&&Me[we]&&typeof ve[we]=="string"&&we!=="0"&&(ve[we]=Me[we]);ve.top=_,ve.left=ae}else ve.cssText=te._stOrig;gsap.core.getCache(te).uncache=1,oe.appendChild(te)}},_interruptionTracker=function Te(te,oe,_){var ae=oe,ve=ae;return function(we){var Me=Math.round(te());return Me!==ae&&Me!==ve&&Math.abs(Me-ae)>3&&Math.abs(Me-ve)>3&&(we=Me,_&&_()),ve=ae,ae=we,we}},_getTweenCreator=function Te(te,oe){var _=_getScrollFunc(te,oe),ae="_scroll"+oe.p2,ve=function we(Me,ke,Le,Ye,tt){var Ke=we.tween,Ge=ke.onComplete,et={};Le=Le||_();var Ue=_interruptionTracker(_,Le,function(){Ke.kill(),we.tween=0});return tt=Ye&&tt||0,Ye=Ye||Me-Le,Ke&&Ke.kill(),ke[ae]=Me,ke.modifiers=et,et[ae]=function(){return Ue(Le+Ye*Ke.ratio+tt*Ke.ratio*Ke.ratio)},ke.onUpdate=function(){_scrollers.cache++,_updateAll()},ke.onComplete=function(){we.tween=0,Ge&&Ge.call(Ke)},Ke=we.tween=gsap.to(te,ke),Ke};return te[ae]=_,_.wheelHandler=function(){return ve.tween&&ve.tween.kill()&&(ve.tween=0)},_addListener(te,"wheel",_.wheelHandler),ScrollTrigger.isTouch&&_addListener(te,"touchmove",_.wheelHandler),ve},ScrollTrigger=function(){function Te(oe,_){_coreInitted||Te.register(gsap)||console.warn("Please gsap.registerPlugin(ScrollTrigger)"),this.init(oe,_)}var te=Te.prototype;return te.init=function(_,ae){if(this.progress=this.start=0,this.vars&&this.kill(!0,!0),!_enabled){this.update=this.refresh=this.kill=_passThrough;return}_=_setDefaults(_isString(_)||_isNumber(_)||_.nodeType?{trigger:_}:_,_defaults);var ve=_,we=ve.onUpdate,Me=ve.toggleClass,ke=ve.id,Le=ve.onToggle,Ye=ve.onRefresh,tt=ve.scrub,Ke=ve.trigger,Ge=ve.pin,et=ve.pinSpacing,Ue=ve.invalidateOnRefresh,nt=ve.anticipatePin,He=ve.onScrubComplete,Ze=ve.onSnapComplete,st=ve.once,Et=ve.snap,rt=ve.pinReparent,bt=ve.pinSpacer,Ne=ve.containerAnimation,Qe=ve.fastScrollEnd,We=ve.preventOverlaps,_t=_.horizontal||_.containerAnimation&&_.horizontal!==!1?_horizontal:_vertical,lt=!tt&&tt!==0,Ut=_getTarget(_.scroller||_win),dn=gsap.core.getCache(Ut),nn=_isViewport(Ut),un=("pinType"in _?_.pinType:_getProxyProp(Ut,"pinType")||nn&&"fixed")==="fixed",Zt=[_.onEnter,_.onLeave,_.onEnterBack,_.onLeaveBack],pn=lt&&_.toggleActions.split(" "),ln="markers"in _?_.markers:_defaults.markers,vn=nn?0:parseFloat(_getComputedStyle(Ut)["border"+_t.p2+_Width])||0,ht=this,Jt=_.onRefreshInit&&function(){return _.onRefreshInit(ht)},en=_getSizeFunc(Ut,nn,_t),Cn=_getOffsetsFunc(Ut,nn),Vt=0,Je=0,ot=_getScrollFunc(Ut,_t),Rt,Mn,Pn,Rn,hi,$n,ji,Li,dr,Ri,$t,ir,or,ms,Rr,Cr,Mr,Tr,Is,pr,rr,ss,Gr,Br,pa,Qr,Hs,Ur,ho,fa,oi,Er,Bs,as,po,io,ea,kt,Zr;if(_context(ht),ht._dir=_t,nt*=45,ht.scroller=Ut,ht.scroll=Ne?Ne.time.bind(Ne):ot,Rn=ot(),ht.vars=_,ae=ae||_.animation,"refreshPriority"in _&&(_sort=1,_.refreshPriority===-9999&&(_primary=ht)),dn.tweenScroll=dn.tweenScroll||{top:_getTweenCreator(Ut,_vertical),left:_getTweenCreator(Ut,_horizontal)},ht.tweenTo=Rt=dn.tweenScroll[_t.p],ht.scrubDuration=function(bn){Er=_isNumber(bn)&&bn,Er?oi?oi.duration(bn):oi=gsap.to(ae,{ease:"expo",totalProgress:"+=0.001",duration:Er,paused:!0,onComplete:function(){return He&&He(ht)}}):(oi&&oi.progress(1).kill(),oi=0)},ae&&(ae.vars.lazy=!1,ae._initted||ae.vars.immediateRender!==!1&&_.immediateRender!==!1&&ae.duration()&&ae.render(0,!0,!0),ht.animation=ae.pause(),ae.scrollTrigger=ht,ht.scrubDuration(tt),oi&&oi.resetTo&&oi.resetTo("totalProgress",0),ho=0,ke||(ke=ae.vars.id)),_triggers.push(ht),Et&&((!_isObject(Et)||Et.push)&&(Et={snapTo:Et}),"scrollBehavior"in _body.style&&gsap.set(nn?[_body,_docEl]:Ut,{scrollBehavior:"auto"}),_scrollers.forEach(function(bn){return _isFunction(bn)&&bn.target===(nn?_doc.scrollingElement||_docEl:Ut)&&(bn.smooth=!1)}),Pn=_isFunction(Et.snapTo)?Et.snapTo:Et.snapTo==="labels"?_getClosestLabel(ae):Et.snapTo==="labelsDirectional"?_getLabelAtDirection(ae):Et.directional!==!1?function(bn,Mi){return _snapDirectional(Et.snapTo)(bn,_getTime()-Je<500?0:Mi.direction)}:gsap.utils.snap(Et.snapTo),Bs=Et.duration||{min:.1,max:2},Bs=_isObject(Bs)?_clamp(Bs.min,Bs.max):_clamp(Bs,Bs),as=gsap.delayedCall(Et.delay||Er/2||.1,function(){var bn=ot(),Mi=_getTime()-Je<500,ki=Rt.tween;if((Mi||Math.abs(ht.getVelocity())<10)&&!ki&&!_pointerIsDown&&Vt!==bn){var Ii=(bn-$n)/or,Fr=ae&&!lt?ae.totalProgress():Ii,Sr=Mi?0:(Fr-fa)/(_getTime()-_time2)*1e3||0,_r=gsap.utils.clamp(-Ii,1-Ii,_abs(Sr/2)*Sr/.185),ls=Ii+(Et.inertia===!1?0:_r),Ss=_clamp(0,1,Pn(ls,ht)),Ir=Math.round($n+Ss*or),es=Et,Io=es.onStart,Cs=es.onInterrupt,kr=es.onComplete;if(bn<=ji&&bn>=$n&&Ir!==bn){if(ki&&!ki._initted&&ki.data<=_abs(Ir-bn))return;Et.inertia===!1&&(_r=Ss-Ii),Rt(Ir,{duration:Bs(_abs(Math.max(_abs(ls-Fr),_abs(Ss-Fr))*.185/Sr/.05||0)),ease:Et.ease||"power3",data:_abs(Ir-bn),onInterrupt:function(){return as.restart(!0)&&Cs&&Cs(ht)},onComplete:function(){ht.update(),Vt=ot(),ho=fa=ae&&!lt?ae.totalProgress():ht.progress,Ze&&Ze(ht),kr&&kr(ht)}},bn,_r*or,Ir-bn-_r*or),Io&&Io(ht,Rt.tween)}}else ht.isActive&&Vt!==bn&&as.restart(!0)}).pause()),ke&&(_ids[ke]=ht),Ke=ht.trigger=_getTarget(Ke||Ge),Zr=Ke&&Ke._gsap&&Ke._gsap.stRevert,Zr&&(Zr=Zr(ht)),Ge=Ge===!0?Ke:_getTarget(Ge),_isString(Me)&&(Me={targets:Ke,className:Me}),Ge&&(et===!1||et===_margin||(et=!et&&Ge.parentNode&&Ge.parentNode.style&&_getComputedStyle(Ge.parentNode).display==="flex"?!1:_padding),ht.pin=Ge,Mn=gsap.core.getCache(Ge),Mn.spacer?ms=Mn.pinState:(bt&&(bt=_getTarget(bt),bt&&!bt.nodeType&&(bt=bt.current||bt.nativeElement),Mn.spacerIsNative=!!bt,bt&&(Mn.spacerState=_getState(bt))),Mn.spacer=Mr=bt||_doc.createElement("div"),Mr.classList.add("pin-spacer"),ke&&Mr.classList.add("pin-spacer-"+ke),Mn.pinState=ms=_getState(Ge)),_.force3D!==!1&&gsap.set(Ge,{force3D:!0}),ht.spacer=Mr=Mn.spacer,Ur=_getComputedStyle(Ge),Gr=Ur[et+_t.os2],Is=gsap.getProperty(Ge),pr=gsap.quickSetter(Ge,_t.a,_px),_swapPinIn(Ge,Mr,Ur),Cr=_getState(Ge)),ln){ir=_isObject(ln)?_setDefaults(ln,_markerDefaults):_markerDefaults,Ri=_createMarker("scroller-start",ke,Ut,_t,ir,0),$t=_createMarker("scroller-end",ke,Ut,_t,ir,0,Ri),Tr=Ri["offset"+_t.op.d2];var To=_getTarget(_getProxyProp(Ut,"content")||Ut);Li=this.markerStart=_createMarker("start",ke,To,_t,ir,Tr,0,Ne),dr=this.markerEnd=_createMarker("end",ke,To,_t,ir,Tr,0,Ne),Ne&&(kt=gsap.quickSetter([Li,dr],_t.a,_px)),!un&&!(_proxies.length&&_getProxyProp(Ut,"fixedMarkers")===!0)&&(_makePositionable(nn?_body:Ut),gsap.set([Ri,$t],{force3D:!0}),pa=gsap.quickSetter(Ri,_t.a,_px),Hs=gsap.quickSetter($t,_t.a,_px))}if(Ne){var Bi=Ne.vars.onUpdate,qn=Ne.vars.onUpdateParams;Ne.eventCallback("onUpdate",function(){ht.update(0,0,1),Bi&&Bi.apply(Ne,qn||[])})}ht.previous=function(){return _triggers[_triggers.indexOf(ht)-1]},ht.next=function(){return _triggers[_triggers.indexOf(ht)+1]},ht.revert=function(bn,Mi){if(!Mi)return ht.kill(!0);var ki=bn!==!1||!ht.enabled,Ii=_refreshing;ki!==ht.isReverted&&(ki&&(io=Math.max(ot(),ht.scroll.rec||0),po=ht.progress,ea=ae&&ae.progress()),Li&&[Li,dr,Ri,$t].forEach(function(Fr){return Fr.style.display=ki?"none":"block"}),ki&&(_refreshing=ht,ht.update(ki)),Ge&&(!rt||!ht.isActive)&&(ki?_swapPinOut(Ge,Mr,ms):_swapPinIn(Ge,Mr,_getComputedStyle(Ge),Br)),ki||ht.update(ki),_refreshing=Ii,ht.isReverted=ki)},ht.refresh=function(bn,Mi){if(!((_refreshing||!ht.enabled)&&!Mi)){if(Ge&&bn&&_lastScrollTime){_addListener(Te,"scrollEnd",_softRefresh);return}!_refreshingAll&&Jt&&Jt(ht),_refreshing=ht,Je=_getTime(),Rt.tween&&(Rt.tween.kill(),Rt.tween=0),oi&&oi.pause(),Ue&&ae&&ae.revert({kill:!1}).invalidate(),ht.isReverted||ht.revert(!0,!0),ht._subPinOffset=!1;for(var ki=en(),Ii=Cn(),Fr=Ne?Ne.duration():_maxScroll(Ut,_t),Sr=or<=.01,_r=0,ls=0,Ss=_.end,Ir=_.endTrigger||Ke,es=_.start||(_.start===0||!Ke?0:Ge?"0 0":"0 100%"),Io=ht.pinnedContainer=_.pinnedContainer&&_getTarget(_.pinnedContainer),Cs=Ke&&Math.max(0,_triggers.indexOf(ht))||0,kr=Cs,Hr,Vi,Ys,Ms,os,vr,Xn,Ha,ai,fo,Xs;kr--;)vr=_triggers[kr],vr.end||vr.refresh(0,1)||(_refreshing=ht),Xn=vr.pin,Xn&&(Xn===Ke||Xn===Ge||Xn===Io)&&!vr.isReverted&&(fo||(fo=[]),fo.unshift(vr),vr.revert(!0,!0)),vr!==_triggers[kr]&&(Cs--,kr--);for(_isFunction(es)&&(es=es(ht)),$n=_parsePosition(es,Ke,ki,_t,ot(),Li,Ri,ht,Ii,vn,un,Fr,Ne)||(Ge?-.001:0),_isFunction(Ss)&&(Ss=Ss(ht)),_isString(Ss)&&!Ss.indexOf("+=")&&(~Ss.indexOf(" ")?Ss=(_isString(es)?es.split(" ")[0]:"")+Ss:(_r=_offsetToPx(Ss.substr(2),ki),Ss=_isString(es)?es:(Ne?gsap.utils.mapRange(0,Ne.duration(),Ne.scrollTrigger.start,Ne.scrollTrigger.end,$n):$n)+_r,Ir=Ke)),ji=Math.max($n,_parsePosition(Ss||(Ir?"100% 0":Fr),Ir,ki,_t,ot()+_r,dr,$t,ht,Ii,vn,un,Fr,Ne))||-.001,or=ji-$n||($n-=.01)&&.001,_r=0,kr=Cs;kr--;)vr=_triggers[kr],Xn=vr.pin,Xn&&vr.start-vr._pinPush<=$n&&!Ne&&vr.end>0&&(Hr=vr.end-vr.start,(Xn===Ke&&vr.start-vr._pinPush<$n||Xn===Io)&&!_isNumber(es)&&(_r+=Hr*(1-vr.progress)),Xn===Ge&&(ls+=Hr));if($n+=_r,ji+=_r,Sr&&(po=gsap.utils.clamp(0,1,gsap.utils.normalize($n,ji,io))),ht._pinPush=ls,Li&&_r&&(Hr={},Hr[_t.a]="+="+_r,Io&&(Hr[_t.p]="-="+ot()),gsap.set([Li,dr],Hr)),Ge)Hr=_getComputedStyle(Ge),Ms=_t===_vertical,Ys=ot(),rr=parseFloat(Is(_t.a))+ls,!Fr&&ji>1&&(Xs=(nn?_doc.scrollingElement||_docEl:Ut).style,Xs={style:Xs,value:Xs["overflow"+_t.a.toUpperCase()]},Xs.style["overflow"+_t.a.toUpperCase()]="scroll"),_swapPinIn(Ge,Mr,Hr),Cr=_getState(Ge),Vi=_getBounds(Ge,!0),Ha=un&&_getScrollFunc(Ut,Ms?_horizontal:_vertical)(),et&&(Br=[et+_t.os2,or+ls+_px],Br.t=Mr,kr=et===_padding?_getSize(Ge,_t)+or+ls:0,kr&&Br.push(_t.d,kr+_px),_setState(Br),Io&&_triggers.forEach(function(lr){lr.pin===Io&&lr.vars.pinSpacing!==!1&&(lr._subPinOffset=!0)}),un&&ot(io)),un&&(os={top:Vi.top+(Ms?Ys-$n:Ha)+_px,left:Vi.left+(Ms?Ha:Ys-$n)+_px,boxSizing:"border-box",position:"fixed"},os[_width]=os["max"+_Width]=Math.ceil(Vi.width)+_px,os[_height]=os["max"+_Height]=Math.ceil(Vi.height)+_px,os[_margin]=os[_margin+_Top]=os[_margin+_Right]=os[_margin+_Bottom]=os[_margin+_Left]="0",os[_padding]=Hr[_padding],os[_padding+_Top]=Hr[_padding+_Top],os[_padding+_Right]=Hr[_padding+_Right],os[_padding+_Bottom]=Hr[_padding+_Bottom],os[_padding+_Left]=Hr[_padding+_Left],Rr=_copyState(ms,os,rt),_refreshingAll&&ot(0)),ae?(ai=ae._initted,_suppressOverwrites(1),ae.render(ae.duration(),!0,!0),ss=Is(_t.a)-rr+or+ls,Qr=Math.abs(or-ss)>1,un&&Qr&&Rr.splice(Rr.length-2,2),ae.render(0,!0,!0),ai||ae.invalidate(!0),ae.parent||ae.totalTime(ae.totalTime()),_suppressOverwrites(0)):ss=or,Xs&&(Xs.value?Xs.style["overflow"+_t.a.toUpperCase()]=Xs.value:Xs.style.removeProperty("overflow-"+_t.a));else if(Ke&&ot()&&!Ne)for(Vi=Ke.parentNode;Vi&&Vi!==_body;)Vi._pinOffset&&($n-=Vi._pinOffset,ji-=Vi._pinOffset),Vi=Vi.parentNode;fo&&fo.forEach(function(lr){return lr.revert(!1,!0)}),ht.start=$n,ht.end=ji,Rn=hi=_refreshingAll?io:ot(),!Ne&&!_refreshingAll&&(Rn<io&&ot(io),ht.scroll.rec=0),ht.revert(!1,!0),as&&(Vt=-1,ht.isActive&&ot($n+or*po),as.restart(!0)),_refreshing=0,ae&&lt&&(ae._initted||ea)&&ae.progress()!==ea&&ae.progress(ea,!0).render(ae.time(),!0,!0),(Sr||po!==ht.progress||Ne)&&(ae&&!lt&&ae.totalProgress(Ne&&$n<-.001&&!po?gsap.utils.normalize($n,ji,0):po,!0),ht.progress=(Rn-$n)/or===po?0:po),Ge&&et&&(Mr._pinOffset=Math.round(ht.progress*ss)),oi&&oi.invalidate(),Ye&&!_refreshingAll&&Ye(ht)}},ht.getVelocity=function(){return(ot()-hi)/(_getTime()-_time2)*1e3||0},ht.endAnimation=function(){_endAnimation(ht.callbackAnimation),ae&&(oi?oi.progress(1):ae.paused()?lt||_endAnimation(ae,ht.direction<0,1):_endAnimation(ae,ae.reversed()))},ht.labelToScroll=function(bn){return ae&&ae.labels&&($n||ht.refresh()||$n)+ae.labels[bn]/ae.duration()*or||0},ht.getTrailing=function(bn){var Mi=_triggers.indexOf(ht),ki=ht.direction>0?_triggers.slice(0,Mi).reverse():_triggers.slice(Mi+1);return(_isString(bn)?ki.filter(function(Ii){return Ii.vars.preventOverlaps===bn}):ki).filter(function(Ii){return ht.direction>0?Ii.end<=$n:Ii.start>=ji})},ht.update=function(bn,Mi,ki){if(!(Ne&&!ki&&!bn)){var Ii=_refreshingAll===!0?io:ht.scroll(),Fr=bn?0:(Ii-$n)/or,Sr=Fr<0?0:Fr>1?1:Fr||0,_r=ht.progress,ls,Ss,Ir,es,Io,Cs,kr,Hr;if(Mi&&(hi=Rn,Rn=Ne?ot():Ii,Et&&(fa=ho,ho=ae&&!lt?ae.totalProgress():Sr)),nt&&!Sr&&Ge&&!_refreshing&&!_startup&&_lastScrollTime&&$n<Ii+(Ii-hi)/(_getTime()-_time2)*nt&&(Sr=1e-4),Sr!==_r&&ht.enabled){if(ls=ht.isActive=!!Sr&&Sr<1,Ss=!!_r&&_r<1,Cs=ls!==Ss,Io=Cs||!!Sr!=!!_r,ht.direction=Sr>_r?1:-1,ht.progress=Sr,Io&&!_refreshing&&(Ir=Sr&&!_r?0:Sr===1?1:_r===1?2:3,lt&&(es=!Cs&&pn[Ir+1]!=="none"&&pn[Ir+1]||pn[Ir],Hr=ae&&(es==="complete"||es==="reset"||es in ae))),We&&(Cs||Hr)&&(Hr||tt||!ae)&&(_isFunction(We)?We(ht):ht.getTrailing(We).forEach(function(os){return os.endAnimation()})),lt||(oi&&!_refreshing&&!_startup?(oi._dp._time-oi._start!==oi._time&&oi.render(oi._dp._time-oi._start),oi.resetTo?oi.resetTo("totalProgress",Sr,ae._tTime/ae._tDur):(oi.vars.totalProgress=Sr,oi.invalidate().restart())):ae&&ae.totalProgress(Sr,!!_refreshing)),Ge){if(bn&&et&&(Mr.style[et+_t.os2]=Gr),!un)pr(_round(rr+ss*Sr));else if(Io){if(kr=!bn&&Sr>_r&&ji+1>Ii&&Ii+1>=_maxScroll(Ut,_t),rt)if(!bn&&(ls||kr)){var Vi=_getBounds(Ge,!0),Ys=Ii-$n;_reparent(Ge,_body,Vi.top+(_t===_vertical?Ys:0)+_px,Vi.left+(_t===_vertical?0:Ys)+_px)}else _reparent(Ge,Mr);_setState(ls||kr?Rr:Cr),Qr&&Sr<1&&ls||pr(rr+(Sr===1&&!kr?ss:0))}}Et&&!Rt.tween&&!_refreshing&&!_startup&&as.restart(!0),Me&&(Cs||st&&Sr&&(Sr<1||!_limitCallbacks))&&_toArray(Me.targets).forEach(function(os){return os.classList[ls||st?"add":"remove"](Me.className)}),we&&!lt&&!bn&&we(ht),Io&&!_refreshing?(lt&&(Hr&&(es==="complete"?ae.pause().totalProgress(1):es==="reset"?ae.restart(!0).pause():es==="restart"?ae.restart(!0):ae[es]()),we&&we(ht)),(Cs||!_limitCallbacks)&&(Le&&Cs&&_callback(ht,Le),Zt[Ir]&&_callback(ht,Zt[Ir]),st&&(Sr===1?ht.kill(!1,1):Zt[Ir]=0),Cs||(Ir=Sr===1?1:3,Zt[Ir]&&_callback(ht,Zt[Ir]))),Qe&&!ls&&Math.abs(ht.getVelocity())>(_isNumber(Qe)?Qe:2500)&&(_endAnimation(ht.callbackAnimation),oi?oi.progress(1):_endAnimation(ae,es==="reverse"?1:!Sr,1))):lt&&we&&!_refreshing&&we(ht)}if(Hs){var Ms=Ne?Ii/Ne.duration()*(Ne._caScrollDist||0):Ii;pa(Ms+(Ri._isFlipped?1:0)),Hs(Ms)}kt&&kt(-Ii/Ne.duration()*(Ne._caScrollDist||0))}},ht.enable=function(bn,Mi){ht.enabled||(ht.enabled=!0,_addListener(Ut,"resize",_onResize),_addListener(nn?_doc:Ut,"scroll",_onScroll),Jt&&_addListener(Te,"refreshInit",Jt),bn!==!1&&(ht.progress=po=0,Rn=hi=Vt=ot()),Mi!==!1&&ht.refresh())},ht.getTween=function(bn){return bn&&Rt?Rt.tween:oi},ht.setPositions=function(bn,Mi){Ge&&(rr+=bn-$n,ss+=Mi-bn-or,et===_padding&&ht.adjustPinSpacing(Mi-bn-or)),ht.start=$n=bn,ht.end=ji=Mi,or=Mi-bn,ht.update()},ht.adjustPinSpacing=function(bn){if(Br&&bn){var Mi=Br.indexOf(_t.d)+1;Br[Mi]=parseFloat(Br[Mi])+bn+_px,Br[1]=parseFloat(Br[1])+bn+_px,_setState(Br)}},ht.disable=function(bn,Mi){if(ht.enabled&&(bn!==!1&&ht.revert(!0,!0),ht.enabled=ht.isActive=!1,Mi||oi&&oi.pause(),io=0,Mn&&(Mn.uncache=1),Jt&&_removeListener(Te,"refreshInit",Jt),as&&(as.pause(),Rt.tween&&Rt.tween.kill()&&(Rt.tween=0)),!nn)){for(var ki=_triggers.length;ki--;)if(_triggers[ki].scroller===Ut&&_triggers[ki]!==ht)return;_removeListener(Ut,"resize",_onResize),_removeListener(Ut,"scroll",_onScroll)}},ht.kill=function(bn,Mi){ht.disable(bn,Mi),oi&&!Mi&&oi.kill(),ke&&delete _ids[ke];var ki=_triggers.indexOf(ht);ki>=0&&_triggers.splice(ki,1),ki===_i&&_direction>0&&_i--,ki=0,_triggers.forEach(function(Ii){return Ii.scroller===ht.scroller&&(ki=1)}),ki||_refreshingAll||(ht.scroll.rec=0),ae&&(ae.scrollTrigger=null,bn&&ae.revert({kill:!1}),Mi||ae.kill()),Li&&[Li,dr,Ri,$t].forEach(function(Ii){return Ii.parentNode&&Ii.parentNode.removeChild(Ii)}),_primary===ht&&(_primary=0),Ge&&(Mn&&(Mn.uncache=1),ki=0,_triggers.forEach(function(Ii){return Ii.pin===Ge&&ki++}),ki||(Mn.spacer=0)),_.onKill&&_.onKill(ht)},ht.enable(!1,!1),Zr&&Zr(ht),!ae||!ae.add||or?ht.refresh():gsap.delayedCall(.01,function(){return $n||ji||ht.refresh()})&&(or=.01)&&($n=ji=0),Ge&&_queueRefreshAll()},Te.register=function(_){return _coreInitted||(gsap=_||_getGSAP(),_windowExists()&&window.document&&Te.enable(),_coreInitted=_enabled),_coreInitted},Te.defaults=function(_){if(_)for(var ae in _)_defaults[ae]=_[ae];return _defaults},Te.disable=function(_,ae){_enabled=0,_triggers.forEach(function(we){return we[ae?"kill":"disable"](_)}),_removeListener(_win,"wheel",_onScroll),_removeListener(_doc,"scroll",_onScroll),clearInterval(_syncInterval),_removeListener(_doc,"touchcancel",_passThrough),_removeListener(_body,"touchstart",_passThrough),_multiListener(_removeListener,_doc,"pointerdown,touchstart,mousedown",_pointerDownHandler),_multiListener(_removeListener,_doc,"pointerup,touchend,mouseup",_pointerUpHandler),_resizeDelay.kill(),_iterateAutoRefresh(_removeListener);for(var ve=0;ve<_scrollers.length;ve+=3)_wheelListener(_removeListener,_scrollers[ve],_scrollers[ve+1]),_wheelListener(_removeListener,_scrollers[ve],_scrollers[ve+2])},Te.enable=function(){if(_win=window,_doc=document,_docEl=_doc.documentElement,_body=_doc.body,gsap&&(_toArray=gsap.utils.toArray,_clamp=gsap.utils.clamp,_context=gsap.core.context||_passThrough,_suppressOverwrites=gsap.core.suppressOverwrites||_passThrough,_scrollRestoration=_win.history.scrollRestoration||"auto",_lastScroll=_win.pageYOffset,gsap.core.globals("ScrollTrigger",Te),_body)){_enabled=1,_rafBugFix(),Observer.register(gsap),Te.isTouch=Observer.isTouch,_fixIOSBug=Observer.isTouch&&/(iPad|iPhone|iPod|Mac)/g.test(navigator.userAgent),_addListener(_win,"wheel",_onScroll),_root=[_win,_doc,_docEl,_body],gsap.matchMedia?(Te.matchMedia=function(ke){var Le=gsap.matchMedia(),Ye;for(Ye in ke)Le.add(Ye,ke[Ye]);return Le},gsap.addEventListener("matchMediaInit",function(){return _revertAll()}),gsap.addEventListener("matchMediaRevert",function(){return _revertRecorded()}),gsap.addEventListener("matchMedia",function(){_refreshAll(0,1),_dispatch("matchMedia")}),gsap.matchMedia("(orientation: portrait)",function(){return _setBaseDimensions(),_setBaseDimensions})):console.warn("Requires GSAP 3.11.0 or later"),_setBaseDimensions(),_addListener(_doc,"scroll",_onScroll);var _=_body.style,ae=_.borderTopStyle,ve=gsap.core.Animation.prototype,we,Me;for(ve.revert||Object.defineProperty(ve,"revert",{value:function(){return this.time(-.01,!0)}}),_.borderTopStyle="solid",we=_getBounds(_body),_vertical.m=Math.round(we.top+_vertical.sc())||0,_horizontal.m=Math.round(we.left+_horizontal.sc())||0,ae?_.borderTopStyle=ae:_.removeProperty("border-top-style"),_syncInterval=setInterval(_sync,250),gsap.delayedCall(.5,function(){return _startup=0}),_addListener(_doc,"touchcancel",_passThrough),_addListener(_body,"touchstart",_passThrough),_multiListener(_addListener,_doc,"pointerdown,touchstart,mousedown",_pointerDownHandler),_multiListener(_addListener,_doc,"pointerup,touchend,mouseup",_pointerUpHandler),_transformProp=gsap.utils.checkPrefix("transform"),_stateProps.push(_transformProp),_coreInitted=_getTime(),_resizeDelay=gsap.delayedCall(.2,_refreshAll).pause(),_autoRefresh=[_doc,"visibilitychange",function(){var ke=_win.innerWidth,Le=_win.innerHeight;_doc.hidden?(_prevWidth=ke,_prevHeight=Le):(_prevWidth!==ke||_prevHeight!==Le)&&_onResize()},_doc,"DOMContentLoaded",_refreshAll,_win,"load",_refreshAll,_win,"resize",_onResize],_iterateAutoRefresh(_addListener),_triggers.forEach(function(ke){return ke.enable(0,1)}),Me=0;Me<_scrollers.length;Me+=3)_wheelListener(_removeListener,_scrollers[Me],_scrollers[Me+1]),_wheelListener(_removeListener,_scrollers[Me],_scrollers[Me+2])}},Te.config=function(_){"limitCallbacks"in _&&(_limitCallbacks=!!_.limitCallbacks);var ae=_.syncInterval;ae&&clearInterval(_syncInterval)||(_syncInterval=ae)&&setInterval(_sync,ae),"ignoreMobileResize"in _&&(_ignoreMobileResize=Te.isTouch===1&&_.ignoreMobileResize),"autoRefreshEvents"in _&&(_iterateAutoRefresh(_removeListener)||_iterateAutoRefresh(_addListener,_.autoRefreshEvents||"none"),_ignoreResize=(_.autoRefreshEvents+"").indexOf("resize")===-1)},Te.scrollerProxy=function(_,ae){var ve=_getTarget(_),we=_scrollers.indexOf(ve),Me=_isViewport(ve);~we&&_scrollers.splice(we,Me?6:2),ae&&(Me?_proxies.unshift(_win,ae,_body,ae,_docEl,ae):_proxies.unshift(ve,ae))},Te.clearMatchMedia=function(_){_triggers.forEach(function(ae){return ae._ctx&&ae._ctx.query===_&&ae._ctx.kill(!0,!0)})},Te.isInViewport=function(_,ae,ve){var we=(_isString(_)?_getTarget(_):_).getBoundingClientRect(),Me=we[ve?_width:_height]*ae||0;return ve?we.right-Me>0&&we.left+Me<_win.innerWidth:we.bottom-Me>0&&we.top+Me<_win.innerHeight},Te.positionInViewport=function(_,ae,ve){_isString(_)&&(_=_getTarget(_));var we=_.getBoundingClientRect(),Me=we[ve?_width:_height],ke=ae==null?Me/2:ae in _keywords?_keywords[ae]*Me:~ae.indexOf("%")?parseFloat(ae)*Me/100:parseFloat(ae)||0;return ve?(we.left+ke)/_win.innerWidth:(we.top+ke)/_win.innerHeight},Te.killAll=function(_){if(_triggers.slice(0).forEach(function(ve){return ve.vars.id!=="ScrollSmoother"&&ve.kill()}),_!==!0){var ae=_listeners.killAll||[];_listeners={},ae.forEach(function(ve){return ve()})}},Te}();ScrollTrigger.version="3.11.5";ScrollTrigger.saveStyles=function(Te){return Te?_toArray(Te).forEach(function(te){if(te&&te.style){var oe=_savedStyles.indexOf(te);oe>=0&&_savedStyles.splice(oe,5),_savedStyles.push(te,te.style.cssText,te.getBBox&&te.getAttribute("transform"),gsap.core.getCache(te),_context())}}):_savedStyles};ScrollTrigger.revert=function(Te,te){return _revertAll(!Te,te)};ScrollTrigger.create=function(Te,te){return new ScrollTrigger(Te,te)};ScrollTrigger.refresh=function(Te){return Te?_onResize():(_coreInitted||ScrollTrigger.register())&&_refreshAll(!0)};ScrollTrigger.update=function(Te){return++_scrollers.cache&&_updateAll(Te===!0?2:0)};ScrollTrigger.clearScrollMemory=_clearScrollMemory;ScrollTrigger.maxScroll=function(Te,te){return _maxScroll(Te,te?_horizontal:_vertical)};ScrollTrigger.getScrollFunc=function(Te,te){return _getScrollFunc(_getTarget(Te),te?_horizontal:_vertical)};ScrollTrigger.getById=function(Te){return _ids[Te]};ScrollTrigger.getAll=function(){return _triggers.filter(function(Te){return Te.vars.id!=="ScrollSmoother"})};ScrollTrigger.isScrolling=function(){return!!_lastScrollTime};ScrollTrigger.snapDirectional=_snapDirectional;ScrollTrigger.addEventListener=function(Te,te){var oe=_listeners[Te]||(_listeners[Te]=[]);~oe.indexOf(te)||oe.push(te)};ScrollTrigger.removeEventListener=function(Te,te){var oe=_listeners[Te],_=oe&&oe.indexOf(te);_>=0&&oe.splice(_,1)};ScrollTrigger.batch=function(Te,te){var oe=[],_={},ae=te.interval||.016,ve=te.batchMax||1e9,we=function(Le,Ye){var tt=[],Ke=[],Ge=gsap.delayedCall(ae,function(){Ye(tt,Ke),tt=[],Ke=[]}).pause();return function(et){tt.length||Ge.restart(!0),tt.push(et.trigger),Ke.push(et),ve<=tt.length&&Ge.progress(1)}},Me;for(Me in te)_[Me]=Me.substr(0,2)==="on"&&_isFunction(te[Me])&&Me!=="onRefreshInit"?we(Me,te[Me]):te[Me];return _isFunction(ve)&&(ve=ve(),_addListener(ScrollTrigger,"refresh",function(){return ve=te.batchMax()})),_toArray(Te).forEach(function(ke){var Le={};for(Me in _)Le[Me]=_[Me];Le.trigger=ke,oe.push(ScrollTrigger.create(Le))}),oe};var _clampScrollAndGetDurationMultiplier=function Te(te,oe,_,ae){return oe>ae?te(ae):oe<0&&te(0),_>ae?(ae-oe)/(_-oe):_<0?oe/(oe-_):1},_allowNativePanning=function Te(te,oe){oe===!0?te.style.removeProperty("touch-action"):te.style.touchAction=oe===!0?"auto":oe?"pan-"+oe+(Observer.isTouch?" pinch-zoom":""):"none",te===_docEl&&Te(_body,oe)},_overflow={auto:1,scroll:1},_nestedScroll=function Te(te){var oe=te.event,_=te.target,ae=te.axis,ve=(oe.changedTouches?oe.changedTouches[0]:oe).target,we=ve._gsap||gsap.core.getCache(ve),Me=_getTime(),ke;if(!we._isScrollT||Me-we._isScrollT>2e3){for(;ve&&ve!==_body&&(ve.scrollHeight<=ve.clientHeight&&ve.scrollWidth<=ve.clientWidth||!(_overflow[(ke=_getComputedStyle(ve)).overflowY]||_overflow[ke.overflowX]));)ve=ve.parentNode;we._isScroll=ve&&ve!==_&&!_isViewport(ve)&&(_overflow[(ke=_getComputedStyle(ve)).overflowY]||_overflow[ke.overflowX]),we._isScrollT=Me}(we._isScroll||ae==="x")&&(oe.stopPropagation(),oe._gsapAllow=!0)},_inputObserver=function Te(te,oe,_,ae){return Observer.create({target:te,capture:!0,debounce:!1,lockAxis:!0,type:oe,onWheel:ae=ae&&_nestedScroll,onPress:ae,onDrag:ae,onScroll:ae,onEnable:function(){return _&&_addListener(_doc,Observer.eventTypes[0],_captureInputs,!1,!0)},onDisable:function(){return _removeListener(_doc,Observer.eventTypes[0],_captureInputs,!0)}})},_inputExp=/(input|label|select|textarea)/i,_inputIsFocused,_captureInputs=function Te(te){var oe=_inputExp.test(te.target.tagName);(oe||_inputIsFocused)&&(te._gsapAllow=!0,_inputIsFocused=oe)},_getScrollNormalizer=function Te(te){_isObject(te)||(te={}),te.preventDefault=te.isNormalizer=te.allowClicks=!0,te.type||(te.type="wheel,touch"),te.debounce=!!te.debounce,te.id=te.id||"normalizer";var oe=te,_=oe.normalizeScrollX,ae=oe.momentum,ve=oe.allowNestedScroll,we=oe.onRelease,Me,ke,Le=_getTarget(te.target)||_docEl,Ye=gsap.core.globals().ScrollSmoother,tt=Ye&&Ye.get(),Ke=_fixIOSBug&&(te.content&&_getTarget(te.content)||tt&&te.content!==!1&&!tt.smooth()&&tt.content()),Ge=_getScrollFunc(Le,_vertical),et=_getScrollFunc(Le,_horizontal),Ue=1,nt=(Observer.isTouch&&_win.visualViewport?_win.visualViewport.scale*_win.visualViewport.width:_win.outerWidth)/_win.innerWidth,He=0,Ze=_isFunction(ae)?function(){return ae(Me)}:function(){return ae||2.8},st,Et,rt=_inputObserver(Le,te.type,!0,ve),bt=function(){return Et=!1},Ne=_passThrough,Qe=_passThrough,We=function(){ke=_maxScroll(Le,_vertical),Qe=_clamp(_fixIOSBug?1:0,ke),_&&(Ne=_clamp(0,_maxScroll(Le,_horizontal))),st=_refreshID},_t=function(){Ke._gsap.y=_round(parseFloat(Ke._gsap.y)+Ge.offset)+"px",Ke.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+parseFloat(Ke._gsap.y)+", 0, 1)",Ge.offset=Ge.cacheID=0},lt=function(){if(Et){requestAnimationFrame(bt);var ln=_round(Me.deltaY/2),vn=Qe(Ge.v-ln);if(Ke&&vn!==Ge.v+Ge.offset){Ge.offset=vn-Ge.v;var ht=_round((parseFloat(Ke&&Ke._gsap.y)||0)-Ge.offset);Ke.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+ht+", 0, 1)",Ke._gsap.y=ht+"px",Ge.cacheID=_scrollers.cache,_updateAll()}return!0}Ge.offset&&_t(),Et=!0},Ut,dn,nn,un,Zt=function(){We(),Ut.isActive()&&Ut.vars.scrollY>ke&&(Ge()>ke?Ut.progress(1)&&Ge(ke):Ut.resetTo("scrollY",ke))};return Ke&&gsap.set(Ke,{y:"+=0"}),te.ignoreCheck=function(pn){return _fixIOSBug&&pn.type==="touchmove"&&lt()||Ue>1.05&&pn.type!=="touchstart"||Me.isGesturing||pn.touches&&pn.touches.length>1},te.onPress=function(){Et=!1;var pn=Ue;Ue=_round((_win.visualViewport&&_win.visualViewport.scale||1)/nt),Ut.pause(),pn!==Ue&&_allowNativePanning(Le,Ue>1.01?!0:_?!1:"x"),dn=et(),nn=Ge(),We(),st=_refreshID},te.onRelease=te.onGestureStart=function(pn,ln){if(Ge.offset&&_t(),!ln)un.restart(!0);else{_scrollers.cache++;var vn=Ze(),ht,Jt;_&&(ht=et(),Jt=ht+vn*.05*-pn.velocityX/.227,vn*=_clampScrollAndGetDurationMultiplier(et,ht,Jt,_maxScroll(Le,_horizontal)),Ut.vars.scrollX=Ne(Jt)),ht=Ge(),Jt=ht+vn*.05*-pn.velocityY/.227,vn*=_clampScrollAndGetDurationMultiplier(Ge,ht,Jt,_maxScroll(Le,_vertical)),Ut.vars.scrollY=Qe(Jt),Ut.invalidate().duration(vn).play(.01),(_fixIOSBug&&Ut.vars.scrollY>=ke||ht>=ke-1)&&gsap.to({},{onUpdate:Zt,duration:vn})}we&&we(pn)},te.onWheel=function(){Ut._ts&&Ut.pause(),_getTime()-He>1e3&&(st=0,He=_getTime())},te.onChange=function(pn,ln,vn,ht,Jt){if(_refreshID!==st&&We(),ln&&_&&et(Ne(ht[2]===ln?dn+(pn.startX-pn.x):et()+ln-ht[1])),vn){Ge.offset&&_t();var en=Jt[2]===vn,Cn=en?nn+pn.startY-pn.y:Ge()+vn-Jt[1],Vt=Qe(Cn);en&&Cn!==Vt&&(nn+=Vt-Cn),Ge(Vt)}(vn||ln)&&_updateAll()},te.onEnable=function(){_allowNativePanning(Le,_?!1:"x"),ScrollTrigger.addEventListener("refresh",Zt),_addListener(_win,"resize",Zt),Ge.smooth&&(Ge.target.style.scrollBehavior="auto",Ge.smooth=et.smooth=!1),rt.enable()},te.onDisable=function(){_allowNativePanning(Le,!0),_removeListener(_win,"resize",Zt),ScrollTrigger.removeEventListener("refresh",Zt),rt.kill()},te.lockAxis=te.lockAxis!==!1,Me=new Observer(te),Me.iOS=_fixIOSBug,_fixIOSBug&&!Ge()&&Ge(1),_fixIOSBug&&gsap.ticker.add(_passThrough),un=Me._dc,Ut=gsap.to(Me,{ease:"power4",paused:!0,scrollX:_?"+=0.1":"+=0",scrollY:"+=0.1",modifiers:{scrollY:_interruptionTracker(Ge,Ge(),function(){return Ut.pause()})},onUpdate:_updateAll,onComplete:un.vars.onComplete}),Me};ScrollTrigger.sort=function(Te){return _triggers.sort(Te||function(te,oe){return(te.vars.refreshPriority||0)*-1e6+te.start-(oe.start+(oe.vars.refreshPriority||0)*-1e6)})};ScrollTrigger.observe=function(Te){return new Observer(Te)};ScrollTrigger.normalizeScroll=function(Te){if(typeof Te>"u")return _normalizer;if(Te===!0&&_normalizer)return _normalizer.enable();if(Te===!1)return _normalizer&&_normalizer.kill();var te=Te instanceof Observer?Te:_getScrollNormalizer(Te);return _normalizer&&_normalizer.target===te.target&&_normalizer.kill(),_isViewport(te.target)&&(_normalizer=te),te};ScrollTrigger.core={_getVelocityProp,_inputObserver,_scrollers,_proxies,bridge:{ss:function Te(){_lastScrollTime||_dispatch("scrollStart"),_lastScrollTime=_getTime()},ref:function Te(){return _refreshing}}};_getGSAP()&&gsap.registerPlugin(ScrollTrigger);const scrollAnimation=(Te,te,oe)=>{gsapWithCSS.timeline().to(Te,{x:-3.38,y:-10.74,z:-5.93,scrollTrigger:{trigger:".sound-section",start:"top bottom",end:"top top",scrub:2,immediateRender:!1},onUpdate:oe}).to(te,{x:1.52,y:.77,z:-1.08,scrollTrigger:{trigger:".sound-section",start:"top bottom",end:"top top",scrub:2,immediateRender:!1},onUpdate:oe}).to(".jumbotron-section",{opacity:0,scrollTrigger:{trigger:".sound-section",start:"top bottom",end:"top top",scrub:2,immediateRender:!1},onUpdate:oe}).to(".sound-section-content",{opacity:1,scrollTrigger:{trigger:".sound-section",start:"top bottom",end:"top top",scrub:2,immediateRender:!1},onUpdate:oe}).to(Te,{x:1.56,y:5,z:.011,scrollTrigger:{trigger:".display-section",start:"top bottom",end:"top top",scrub:2,immediateRender:!1},onUpdate:oe}).to(te,{x:-.55,y:.32,z:0,scrollTrigger:{trigger:".display-section",start:"top bottom",end:"top top",scrub:2,immediateRender:!1},onUpdate:oe}).to(".display-section",{opacity:1,scrollTrigger:{trigger:".display-section",start:"top bottom",end:"top top",scrub:2,immediateRender:!1},onUpdate:oe})};gsapWithCSS.registerPlugin(ScrollTrigger);reactExports.forwardRef((Te,te)=>{const oe=React.useRef(null),[_,ae]=React.useState(null),[ve,we]=React.useState(null),[Me,ke]=React.useState(null),[Le,Ye]=React.useState(null),tt=React.useRef(null),[Ke,Ge]=React.useState(!1);reactExports.useImperativeHandle(te,()=>({triggerPreview(){Ge(!0),tt.current.style.pointerEvents="all",Te.contentRef.current.style.opacity="0",gsapWithCSS.to(Le,{x:13.04,y:-2.01,z:2.29,duration:2,onUpdate:()=>{_.setDirty(),Me.positionTargetUpdated(!0)}}),gsapWithCSS.to(ve,{x:.11,y:0,z:0,duration:2}),_.scene.activeCamera.setCameraOptions({controlsEnabled:!0})}}));const et=React.useCallback((He,Ze,st)=>{He&&Ze&&st&&scrollAnimation(He,Ze,st)},[]),Ue=React.useCallback(async()=>{const He=new __webpackgi_exports__ViewerApp({canvas:oe.current});ae(He);const Ze=await He.addPlugin(__webpackgi_exports__AssetManagerPlugin),st=He.scene.activeCamera,Et=st.position,rt=st.target;ke(st),Ye(Le),we(rt),await He.addPlugin(__webpackgi_exports__GBufferPlugin),await He.addPlugin(new __webpackgi_exports__ProgressivePlugin(32)),await He.addPlugin(new __webpackgi_exports__TonemapPlugin(!0)),await He.addPlugin(__webpackgi_exports__GammaCorrectionPlugin),await He.addPlugin(__webpackgi_exports__SSRPlugin),await He.addPlugin(__webpackgi_exports__SSAOPlugin),await He.addPlugin(__webpackgi_exports__BloomPlugin),He.renderer.refreshPipeline(),await Ze.addFromPath("scene-black.glb"),He.getPlugin(__webpackgi_exports__TonemapPlugin).config.clipBackground=!0,He.scene.activeCamera.setCameraOptions({controlsEnabled:!1}),window.scrollTo(0,0);let bt=!0;const Ne=()=>{bt=!0,He.setDirty()};He.addEventListener("preFrame",()=>{bt&&(st.positionTargetUpdated(!0),bt=!1)}),et(Et,rt,Ne)},[]);React.useEffect(()=>{Ue()},[]);const nt=reactExports.useCallback(()=>{tt.current.style.pointerEvents="none",Te.contentRef.current.style.opacity="1",_.scene.activeCamera.setCameraOptions({controlsEnabled:!1}),Ge(!1),gsapWithCSS.to(Le,{x:1.56,y:5,z:.011,scrollTrigger:{trigger:".display-section",start:"top bottom",end:"top top",scrub:2,immediateRender:!1},onUpdate:()=>{_.setDirty(),Me.positionTargetUpdated(!0)}}),gsapWithCSS.to(ve,{x:-.55,y:.32,z:0,scrollTrigger:{trigger:".display-section",start:"top bottom",end:"top top",scrub:2,immediateRender:!1}})},[tt,_,Le,Me,ve]);return jsxs("div",{ref:tt,id:"webgi-canvas-container",children:[jsx("canvas",{id:"webgi-canvas",ref:oe}),Ke&&jsx("button",{className:"button",onClick:nt,children:"Exit"})]})});
